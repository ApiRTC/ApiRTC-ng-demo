var ls=Object.defineProperty,cs=Object.defineProperties,ds=Object.getOwnPropertyDescriptors,Oo=Object.getOwnPropertySymbols,us=Object.prototype.hasOwnProperty,hs=Object.prototype.propertyIsEnumerable,_o=(tt,Wt,Ke)=>Wt in tt?ls(tt,Wt,{enumerable:!0,configurable:!0,writable:!0,value:Ke}):tt[Wt]=Ke,si=(tt,Wt)=>{for(var Ke in Wt||(Wt={}))us.call(Wt,Ke)&&_o(tt,Ke,Wt[Ke]);if(Oo)for(var Ke of Oo(Wt))hs.call(Wt,Ke)&&_o(tt,Ke,Wt[Ke]);return tt},gr=(tt,Wt)=>cs(tt,ds(Wt));!function(tt,Wt){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=tt.document?Wt(tt,!0):function(Ke){if(!Ke.document)throw new Error("jQuery requires a window with a document");return Wt(Ke)}:Wt(tt)}("undefined"!=typeof window?window:this,function(tt,Wt){"use strict";var Ke=[],F=Object.getPrototypeOf,Y=Ke.slice,e=Ke.flat?function(g){return Ke.flat.call(g)}:function(g){return Ke.concat.apply([],g)},i=Ke.push,c=Ke.indexOf,d={},L=d.toString,w=d.hasOwnProperty,A=w.toString,C=A.call(Object),S={},n=function(g){return"function"==typeof g&&"number"!=typeof g.nodeType&&"function"!=typeof g.item},v=function(g){return null!=g&&g===g.window},R=tt.document,p={type:!0,src:!0,nonce:!0,noModule:!0};function o(g,k,J){var Z,he,fe=(J=J||R).createElement("script");if(fe.text=g,k)for(Z in p)(he=k[Z]||k.getAttribute&&k.getAttribute(Z))&&fe.setAttribute(Z,he);J.head.appendChild(fe).parentNode.removeChild(fe)}function f(g){return null==g?g+"":"object"==typeof g||"function"==typeof g?d[L.call(g)]||"object":typeof g}var I="3.6.0",l=function(g,k){return new l.fn.init(g,k)};function V(g){var k=!!g&&"length"in g&&g.length,J=f(g);return!n(g)&&!v(g)&&("array"===J||0===k||"number"==typeof k&&0<k&&k-1 in g)}l.fn=l.prototype={jquery:I,constructor:l,length:0,toArray:function(){return Y.call(this)},get:function(g){return null==g?Y.call(this):g<0?this[g+this.length]:this[g]},pushStack:function(g){var k=l.merge(this.constructor(),g);return k.prevObject=this,k},each:function(g){return l.each(this,g)},map:function(g){return this.pushStack(l.map(this,function(k,J){return g.call(k,J,k)}))},slice:function(){return this.pushStack(Y.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(l.grep(this,function(g,k){return(k+1)%2}))},odd:function(){return this.pushStack(l.grep(this,function(g,k){return k%2}))},eq:function(g){var k=this.length,J=+g+(g<0?k:0);return this.pushStack(0<=J&&J<k?[this[J]]:[])},end:function(){return this.prevObject||this.constructor()},push:i,sort:Ke.sort,splice:Ke.splice},l.extend=l.fn.extend=function(){var g,k,J,Z,he,fe,ve=arguments[0]||{},_e=1,De=arguments.length,Ve=!1;for("boolean"==typeof ve&&(Ve=ve,ve=arguments[_e]||{},_e++),"object"==typeof ve||n(ve)||(ve={}),_e===De&&(ve=this,_e--);_e<De;_e++)if(null!=(g=arguments[_e]))for(k in g)Z=g[k],"__proto__"!==k&&ve!==Z&&(Ve&&Z&&(l.isPlainObject(Z)||(he=Array.isArray(Z)))?(J=ve[k],fe=he&&!Array.isArray(J)?[]:he||l.isPlainObject(J)?J:{},he=!1,ve[k]=l.extend(Ve,fe,Z)):void 0!==Z&&(ve[k]=Z));return ve},l.extend({expando:"jQuery"+(I+Math.random()).replace(/\D/g,""),isReady:!0,error:function(g){throw new Error(g)},noop:function(){},isPlainObject:function(g){var k,J;return!(!g||"[object Object]"!==L.call(g)||(k=F(g))&&("function"!=typeof(J=w.call(k,"constructor")&&k.constructor)||A.call(J)!==C))},isEmptyObject:function(g){var k;for(k in g)return!1;return!0},globalEval:function(g,k,J){o(g,{nonce:k&&k.nonce},J)},each:function(g,k){var J,Z=0;if(V(g))for(J=g.length;Z<J&&!1!==k.call(g[Z],Z,g[Z]);Z++);else for(Z in g)if(!1===k.call(g[Z],Z,g[Z]))break;return g},makeArray:function(g,k){var J=k||[];return null!=g&&(V(Object(g))?l.merge(J,"string"==typeof g?[g]:g):i.call(J,g)),J},inArray:function(g,k,J){return null==k?-1:c.call(k,g,J)},merge:function(g,k){for(var J=+k.length,Z=0,he=g.length;Z<J;Z++)g[he++]=k[Z];return g.length=he,g},grep:function(g,k,J){for(var Z=[],he=0,fe=g.length,ve=!J;he<fe;he++)!k(g[he],he)!==ve&&Z.push(g[he]);return Z},map:function(g,k,J){var Z,he,fe=0,ve=[];if(V(g))for(Z=g.length;fe<Z;fe++)null!=(he=k(g[fe],fe,J))&&ve.push(he);else for(fe in g)null!=(he=k(g[fe],fe,J))&&ve.push(he);return e(ve)},guid:1,support:S}),"function"==typeof Symbol&&(l.fn[Symbol.iterator]=Ke[Symbol.iterator]),l.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(g,k){d["[object "+k+"]"]=k.toLowerCase()});var T=function(g){var k,J,Z,he,fe,ve,_e,De,Ve,Ye,ot,Je,Xe,Te,j,se,Me,Le,$e,mt="sizzle"+1*new Date,St=g.document,Xt=0,Ht=0,Qt=Sa(),li=Sa(),Li=Sa(),bi=Sa(),Vi=function(Ce,Ae){return Ce===Ae&&(ot=!0),0},$t={}.hasOwnProperty,wi=[],Dt=wi.pop,ii=wi.push,hi=wi.push,tn=wi.slice,In=function(Ce,Ae){for(var je=0,st=Ce.length;je<st;je++)if(Ce[je]===Ae)return je;return-1},An="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Zt="[\\x20\\t\\r\\n\\f]",Si="(?:\\\\[\\da-fA-F]{1,6}"+Zt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Ei="\\["+Zt+"*("+Si+")(?:"+Zt+"*([*^$|!~]?=)"+Zt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+Si+"))|)"+Zt+"*\\]",pn=":("+Si+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Ei+")*)|.*)\\)|)",Fi=new RegExp(Zt+"+","g"),fn=new RegExp("^"+Zt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Zt+"+$","g"),ga=new RegExp("^"+Zt+"*,"+Zt+"*"),ca=new RegExp("^"+Zt+"*([>+~]|"+Zt+")"+Zt+"*"),mn=new RegExp(Zt+"|>"),Ti=new RegExp(pn),Va=new RegExp("^"+Si+"$"),Bn={ID:new RegExp("^#("+Si+")"),CLASS:new RegExp("^\\.("+Si+")"),TAG:new RegExp("^("+Si+"|[*])"),ATTR:new RegExp("^"+Ei),PSEUDO:new RegExp("^"+pn),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Zt+"*(even|odd|(([+-]|)(\\d*)n|)"+Zt+"*(?:([+-]|)"+Zt+"*(\\d+)|))"+Zt+"*\\)|)","i"),bool:new RegExp("^(?:"+An+")$","i"),needsContext:new RegExp("^"+Zt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Zt+"*((?:-\\d)?\\d*)"+Zt+"*\\)|)(?=[^-]|$)","i")},$a=/HTML$/i,Za=/^(?:input|select|textarea|button)$/i,nn=/^h\d$/i,an=/^[^{]+\{\s*\[native \w/,Gn=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,gn=/[+~]/,Ji=new RegExp("\\\\[\\da-fA-F]{1,6}"+Zt+"?|\\\\([^\\r\\n\\f])","g"),Xn=function(Ce,Ae){var je="0x"+Ce.slice(1)-65536;return Ae||(je<0?String.fromCharCode(je+65536):String.fromCharCode(je>>10|55296,1023&je|56320))},Ma=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,er=function(Ce,Ae){return Ae?"\0"===Ce?"\ufffd":Ce.slice(0,-1)+"\\"+Ce.charCodeAt(Ce.length-1).toString(16)+" ":"\\"+Ce},tr=function(){Je()},Aa=Ia(function(Ce){return!0===Ce.disabled&&"fieldset"===Ce.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{hi.apply(wi=tn.call(St.childNodes),St.childNodes)}catch(Ce){hi={apply:wi.length?function(Ae,je){ii.apply(Ae,tn.call(je))}:function(Ae,je){for(var st=Ae.length,Fe=0;Ae[st++]=je[Fe++];);Ae.length=st-1}}}function ni(Ce,Ae,je,st){var Fe,dt,Tt,_t,Nt,Kt,Jt,Gt=Ae&&Ae.ownerDocument,pi=Ae?Ae.nodeType:9;if(je=je||[],"string"!=typeof Ce||!Ce||1!==pi&&9!==pi&&11!==pi)return je;if(!st&&(Je(Ae),Ae=Ae||Xe,j)){if(11!==pi&&(Nt=Gn.exec(Ce)))if(Fe=Nt[1]){if(9===pi){if(!(Tt=Ae.getElementById(Fe)))return je;if(Tt.id===Fe)return je.push(Tt),je}else if(Gt&&(Tt=Gt.getElementById(Fe))&&$e(Ae,Tt)&&Tt.id===Fe)return je.push(Tt),je}else{if(Nt[2])return hi.apply(je,Ae.getElementsByTagName(Ce)),je;if((Fe=Nt[3])&&J.getElementsByClassName&&Ae.getElementsByClassName)return hi.apply(je,Ae.getElementsByClassName(Fe)),je}if(J.qsa&&!bi[Ce+" "]&&(!se||!se.test(Ce))&&(1!==pi||"object"!==Ae.nodeName.toLowerCase())){if(Jt=Ce,Gt=Ae,1===pi&&(mn.test(Ce)||ca.test(Ce))){for((Gt=gn.test(Ce)&&Rn(Ae.parentNode)||Ae)===Ae&&J.scope||((_t=Ae.getAttribute("id"))?_t=_t.replace(Ma,er):Ae.setAttribute("id",_t=mt)),dt=(Kt=ve(Ce)).length;dt--;)Kt[dt]=(_t?"#"+_t:":scope")+" "+_a(Kt[dt]);Jt=Kt.join(",")}try{return hi.apply(je,Gt.querySelectorAll(Jt)),je}catch(xi){bi(Ce,!0)}finally{_t===mt&&Ae.removeAttribute("id")}}}return De(Ce.replace(fn,"$1"),Ae,je,st)}function Sa(){var Ce=[];return function Ae(je,st){return Ce.push(je+" ")>Z.cacheLength&&delete Ae[Ce.shift()],Ae[je+" "]=st}}function Dn(Ce){return Ce[mt]=!0,Ce}function On(Ce){var Ae=Xe.createElement("fieldset");try{return!!Ce(Ae)}catch(je){return!1}finally{Ae.parentNode&&Ae.parentNode.removeChild(Ae),Ae=null}}function Ta(Ce,Ae){for(var je=Ce.split("|"),st=je.length;st--;)Z.attrHandle[je[st]]=Ae}function ir(Ce,Ae){var je=Ae&&Ce,st=je&&1===Ce.nodeType&&1===Ae.nodeType&&Ce.sourceIndex-Ae.sourceIndex;if(st)return st;if(je)for(;je=je.nextSibling;)if(je===Ae)return-1;return Ce?1:-1}function Ot(Ce){return function(Ae){return"input"===Ae.nodeName.toLowerCase()&&Ae.type===Ce}}function Oa(Ce){return function(Ae){var je=Ae.nodeName.toLowerCase();return("input"===je||"button"===je)&&Ae.type===Ce}}function qe(Ce){return function(Ae){return"form"in Ae?Ae.parentNode&&!1===Ae.disabled?"label"in Ae?"label"in Ae.parentNode?Ae.parentNode.disabled===Ce:Ae.disabled===Ce:Ae.isDisabled===Ce||Ae.isDisabled!==!Ce&&Aa(Ae)===Ce:Ae.disabled===Ce:"label"in Ae&&Ae.disabled===Ce}}function ut(Ce){return Dn(function(Ae){return Ae=+Ae,Dn(function(je,st){for(var Fe,dt=Ce([],je.length,Ae),Tt=dt.length;Tt--;)je[Fe=dt[Tt]]&&(je[Fe]=!(st[Fe]=je[Fe]))})})}function Rn(Ce){return Ce&&void 0!==Ce.getElementsByTagName&&Ce}for(k in J=ni.support={},fe=ni.isXML=function(Ce){var je=Ce&&(Ce.ownerDocument||Ce).documentElement;return!$a.test(Ce&&Ce.namespaceURI||je&&je.nodeName||"HTML")},Je=ni.setDocument=function(Ce){var Ae,je,st=Ce?Ce.ownerDocument||Ce:St;return st!=Xe&&9===st.nodeType&&st.documentElement&&(Te=(Xe=st).documentElement,j=!fe(Xe),St!=Xe&&(je=Xe.defaultView)&&je.top!==je&&(je.addEventListener?je.addEventListener("unload",tr,!1):je.attachEvent&&je.attachEvent("onunload",tr)),J.scope=On(function(Fe){return Te.appendChild(Fe).appendChild(Xe.createElement("div")),void 0!==Fe.querySelectorAll&&!Fe.querySelectorAll(":scope fieldset div").length}),J.attributes=On(function(Fe){return Fe.className="i",!Fe.getAttribute("className")}),J.getElementsByTagName=On(function(Fe){return Fe.appendChild(Xe.createComment("")),!Fe.getElementsByTagName("*").length}),J.getElementsByClassName=an.test(Xe.getElementsByClassName),J.getById=On(function(Fe){return Te.appendChild(Fe).id=mt,!Xe.getElementsByName||!Xe.getElementsByName(mt).length}),J.getById?(Z.filter.ID=function(Fe){var dt=Fe.replace(Ji,Xn);return function(Tt){return Tt.getAttribute("id")===dt}},Z.find.ID=function(Fe,dt){if(void 0!==dt.getElementById&&j){var Tt=dt.getElementById(Fe);return Tt?[Tt]:[]}}):(Z.filter.ID=function(Fe){var dt=Fe.replace(Ji,Xn);return function(Tt){var _t=void 0!==Tt.getAttributeNode&&Tt.getAttributeNode("id");return _t&&_t.value===dt}},Z.find.ID=function(Fe,dt){if(void 0!==dt.getElementById&&j){var Tt,_t,Nt,Kt=dt.getElementById(Fe);if(Kt){if((Tt=Kt.getAttributeNode("id"))&&Tt.value===Fe)return[Kt];for(Nt=dt.getElementsByName(Fe),_t=0;Kt=Nt[_t++];)if((Tt=Kt.getAttributeNode("id"))&&Tt.value===Fe)return[Kt]}return[]}}),Z.find.TAG=J.getElementsByTagName?function(Fe,dt){return void 0!==dt.getElementsByTagName?dt.getElementsByTagName(Fe):J.qsa?dt.querySelectorAll(Fe):void 0}:function(Fe,dt){var Tt,_t=[],Nt=0,Kt=dt.getElementsByTagName(Fe);if("*"===Fe){for(;Tt=Kt[Nt++];)1===Tt.nodeType&&_t.push(Tt);return _t}return Kt},Z.find.CLASS=J.getElementsByClassName&&function(Fe,dt){if(void 0!==dt.getElementsByClassName&&j)return dt.getElementsByClassName(Fe)},Me=[],se=[],(J.qsa=an.test(Xe.querySelectorAll))&&(On(function(Fe){var dt;Te.appendChild(Fe).innerHTML="<a id='"+mt+"'></a><select id='"+mt+"-\r\\' msallowcapture=''><option selected=''></option></select>",Fe.querySelectorAll("[msallowcapture^='']").length&&se.push("[*^$]="+Zt+"*(?:''|\"\")"),Fe.querySelectorAll("[selected]").length||se.push("\\["+Zt+"*(?:value|"+An+")"),Fe.querySelectorAll("[id~="+mt+"-]").length||se.push("~="),(dt=Xe.createElement("input")).setAttribute("name",""),Fe.appendChild(dt),Fe.querySelectorAll("[name='']").length||se.push("\\["+Zt+"*name"+Zt+"*="+Zt+"*(?:''|\"\")"),Fe.querySelectorAll(":checked").length||se.push(":checked"),Fe.querySelectorAll("a#"+mt+"+*").length||se.push(".#.+[+~]"),Fe.querySelectorAll("\\\f"),se.push("[\\r\\n\\f]")}),On(function(Fe){Fe.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var dt=Xe.createElement("input");dt.setAttribute("type","hidden"),Fe.appendChild(dt).setAttribute("name","D"),Fe.querySelectorAll("[name=d]").length&&se.push("name"+Zt+"*[*^$|!~]?="),2!==Fe.querySelectorAll(":enabled").length&&se.push(":enabled",":disabled"),Te.appendChild(Fe).disabled=!0,2!==Fe.querySelectorAll(":disabled").length&&se.push(":enabled",":disabled"),Fe.querySelectorAll("*,:x"),se.push(",.*:")})),(J.matchesSelector=an.test(Le=Te.matches||Te.webkitMatchesSelector||Te.mozMatchesSelector||Te.oMatchesSelector||Te.msMatchesSelector))&&On(function(Fe){J.disconnectedMatch=Le.call(Fe,"*"),Le.call(Fe,"[s!='']:x"),Me.push("!=",pn)}),se=se.length&&new RegExp(se.join("|")),Me=Me.length&&new RegExp(Me.join("|")),Ae=an.test(Te.compareDocumentPosition),$e=Ae||an.test(Te.contains)?function(Fe,dt){var Tt=9===Fe.nodeType?Fe.documentElement:Fe,_t=dt&&dt.parentNode;return Fe===_t||!(!_t||1!==_t.nodeType||!(Tt.contains?Tt.contains(_t):Fe.compareDocumentPosition&&16&Fe.compareDocumentPosition(_t)))}:function(Fe,dt){if(dt)for(;dt=dt.parentNode;)if(dt===Fe)return!0;return!1},Vi=Ae?function(Fe,dt){if(Fe===dt)return ot=!0,0;var Tt=!Fe.compareDocumentPosition-!dt.compareDocumentPosition;return Tt||(1&(Tt=(Fe.ownerDocument||Fe)==(dt.ownerDocument||dt)?Fe.compareDocumentPosition(dt):1)||!J.sortDetached&&dt.compareDocumentPosition(Fe)===Tt?Fe==Xe||Fe.ownerDocument==St&&$e(St,Fe)?-1:dt==Xe||dt.ownerDocument==St&&$e(St,dt)?1:Ye?In(Ye,Fe)-In(Ye,dt):0:4&Tt?-1:1)}:function(Fe,dt){if(Fe===dt)return ot=!0,0;var Tt,_t=0,Nt=Fe.parentNode,Kt=dt.parentNode,Jt=[Fe],Gt=[dt];if(!Nt||!Kt)return Fe==Xe?-1:dt==Xe?1:Nt?-1:Kt?1:Ye?In(Ye,Fe)-In(Ye,dt):0;if(Nt===Kt)return ir(Fe,dt);for(Tt=Fe;Tt=Tt.parentNode;)Jt.unshift(Tt);for(Tt=dt;Tt=Tt.parentNode;)Gt.unshift(Tt);for(;Jt[_t]===Gt[_t];)_t++;return _t?ir(Jt[_t],Gt[_t]):Jt[_t]==St?-1:Gt[_t]==St?1:0}),Xe},ni.matches=function(Ce,Ae){return ni(Ce,null,null,Ae)},ni.matchesSelector=function(Ce,Ae){if(Je(Ce),J.matchesSelector&&j&&!bi[Ae+" "]&&(!Me||!Me.test(Ae))&&(!se||!se.test(Ae)))try{var je=Le.call(Ce,Ae);if(je||J.disconnectedMatch||Ce.document&&11!==Ce.document.nodeType)return je}catch(st){bi(Ae,!0)}return 0<ni(Ae,Xe,null,[Ce]).length},ni.contains=function(Ce,Ae){return(Ce.ownerDocument||Ce)!=Xe&&Je(Ce),$e(Ce,Ae)},ni.attr=function(Ce,Ae){(Ce.ownerDocument||Ce)!=Xe&&Je(Ce);var je=Z.attrHandle[Ae.toLowerCase()],st=je&&$t.call(Z.attrHandle,Ae.toLowerCase())?je(Ce,Ae,!j):void 0;return void 0!==st?st:J.attributes||!j?Ce.getAttribute(Ae):(st=Ce.getAttributeNode(Ae))&&st.specified?st.value:null},ni.escape=function(Ce){return(Ce+"").replace(Ma,er)},ni.error=function(Ce){throw new Error("Syntax error, unrecognized expression: "+Ce)},ni.uniqueSort=function(Ce){var Ae,je=[],st=0,Fe=0;if(ot=!J.detectDuplicates,Ye=!J.sortStable&&Ce.slice(0),Ce.sort(Vi),ot){for(;Ae=Ce[Fe++];)Ae===Ce[Fe]&&(st=je.push(Fe));for(;st--;)Ce.splice(je[st],1)}return Ye=null,Ce},he=ni.getText=function(Ce){var Ae,je="",st=0,Fe=Ce.nodeType;if(Fe){if(1===Fe||9===Fe||11===Fe){if("string"==typeof Ce.textContent)return Ce.textContent;for(Ce=Ce.firstChild;Ce;Ce=Ce.nextSibling)je+=he(Ce)}else if(3===Fe||4===Fe)return Ce.nodeValue}else for(;Ae=Ce[st++];)je+=he(Ae);return je},(Z=ni.selectors={cacheLength:50,createPseudo:Dn,match:Bn,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Ce){return Ce[1]=Ce[1].replace(Ji,Xn),Ce[3]=(Ce[3]||Ce[4]||Ce[5]||"").replace(Ji,Xn),"~="===Ce[2]&&(Ce[3]=" "+Ce[3]+" "),Ce.slice(0,4)},CHILD:function(Ce){return Ce[1]=Ce[1].toLowerCase(),"nth"===Ce[1].slice(0,3)?(Ce[3]||ni.error(Ce[0]),Ce[4]=+(Ce[4]?Ce[5]+(Ce[6]||1):2*("even"===Ce[3]||"odd"===Ce[3])),Ce[5]=+(Ce[7]+Ce[8]||"odd"===Ce[3])):Ce[3]&&ni.error(Ce[0]),Ce},PSEUDO:function(Ce){var Ae,je=!Ce[6]&&Ce[2];return Bn.CHILD.test(Ce[0])?null:(Ce[3]?Ce[2]=Ce[4]||Ce[5]||"":je&&Ti.test(je)&&(Ae=ve(je,!0))&&(Ae=je.indexOf(")",je.length-Ae)-je.length)&&(Ce[0]=Ce[0].slice(0,Ae),Ce[2]=je.slice(0,Ae)),Ce.slice(0,3))}},filter:{TAG:function(Ce){var Ae=Ce.replace(Ji,Xn).toLowerCase();return"*"===Ce?function(){return!0}:function(je){return je.nodeName&&je.nodeName.toLowerCase()===Ae}},CLASS:function(Ce){var Ae=Qt[Ce+" "];return Ae||(Ae=new RegExp("(^|"+Zt+")"+Ce+"("+Zt+"|$)"))&&Qt(Ce,function(je){return Ae.test("string"==typeof je.className&&je.className||void 0!==je.getAttribute&&je.getAttribute("class")||"")})},ATTR:function(Ce,Ae,je){return function(st){var Fe=ni.attr(st,Ce);return null==Fe?"!="===Ae:!Ae||(Fe+="","="===Ae?Fe===je:"!="===Ae?Fe!==je:"^="===Ae?je&&0===Fe.indexOf(je):"*="===Ae?je&&-1<Fe.indexOf(je):"$="===Ae?je&&Fe.slice(-je.length)===je:"~="===Ae?-1<(" "+Fe.replace(Fi," ")+" ").indexOf(je):"|="===Ae&&(Fe===je||Fe.slice(0,je.length+1)===je+"-"))}},CHILD:function(Ce,Ae,je,st,Fe){var dt="nth"!==Ce.slice(0,3),Tt="last"!==Ce.slice(-4),_t="of-type"===Ae;return 1===st&&0===Fe?function(Nt){return!!Nt.parentNode}:function(Nt,Kt,Jt){var Gt,pi,xi,ti,Yi,Xi,vn=dt!==Tt?"nextSibling":"previousSibling",Ri=Nt.parentNode,kn=_t&&Nt.nodeName.toLowerCase(),sn=!Jt&&!_t,Wi=!1;if(Ri){if(dt){for(;vn;){for(ti=Nt;ti=ti[vn];)if(_t?ti.nodeName.toLowerCase()===kn:1===ti.nodeType)return!1;Xi=vn="only"===Ce&&!Xi&&"nextSibling"}return!0}if(Xi=[Tt?Ri.firstChild:Ri.lastChild],Tt&&sn){for(Wi=(Yi=(Gt=(pi=(xi=(ti=Ri)[mt]||(ti[mt]={}))[ti.uniqueID]||(xi[ti.uniqueID]={}))[Ce]||[])[0]===Xt&&Gt[1])&&Gt[2],ti=Yi&&Ri.childNodes[Yi];ti=++Yi&&ti&&ti[vn]||(Wi=Yi=0)||Xi.pop();)if(1===ti.nodeType&&++Wi&&ti===Nt){pi[Ce]=[Xt,Yi,Wi];break}}else if(sn&&(Wi=Yi=(Gt=(pi=(xi=(ti=Nt)[mt]||(ti[mt]={}))[ti.uniqueID]||(xi[ti.uniqueID]={}))[Ce]||[])[0]===Xt&&Gt[1]),!1===Wi)for(;(ti=++Yi&&ti&&ti[vn]||(Wi=Yi=0)||Xi.pop())&&((_t?ti.nodeName.toLowerCase()!==kn:1!==ti.nodeType)||!++Wi||(sn&&((pi=(xi=ti[mt]||(ti[mt]={}))[ti.uniqueID]||(xi[ti.uniqueID]={}))[Ce]=[Xt,Wi]),ti!==Nt)););return(Wi-=Fe)===st||Wi%st==0&&0<=Wi/st}}},PSEUDO:function(Ce,Ae){var je,st=Z.pseudos[Ce]||Z.setFilters[Ce.toLowerCase()]||ni.error("unsupported pseudo: "+Ce);return st[mt]?st(Ae):1<st.length?(je=[Ce,Ce,"",Ae],Z.setFilters.hasOwnProperty(Ce.toLowerCase())?Dn(function(Fe,dt){for(var Tt,_t=st(Fe,Ae),Nt=_t.length;Nt--;)Fe[Tt=In(Fe,_t[Nt])]=!(dt[Tt]=_t[Nt])}):function(Fe){return st(Fe,0,je)}):st}},pseudos:{not:Dn(function(Ce){var Ae=[],je=[],st=_e(Ce.replace(fn,"$1"));return st[mt]?Dn(function(Fe,dt,Tt,_t){for(var Nt,Kt=st(Fe,null,_t,[]),Jt=Fe.length;Jt--;)(Nt=Kt[Jt])&&(Fe[Jt]=!(dt[Jt]=Nt))}):function(Fe,dt,Tt){return Ae[0]=Fe,st(Ae,null,Tt,je),Ae[0]=null,!je.pop()}}),has:Dn(function(Ce){return function(Ae){return 0<ni(Ce,Ae).length}}),contains:Dn(function(Ce){return Ce=Ce.replace(Ji,Xn),function(Ae){return-1<(Ae.textContent||he(Ae)).indexOf(Ce)}}),lang:Dn(function(Ce){return Va.test(Ce||"")||ni.error("unsupported lang: "+Ce),Ce=Ce.replace(Ji,Xn).toLowerCase(),function(Ae){var je;do{if(je=j?Ae.lang:Ae.getAttribute("xml:lang")||Ae.getAttribute("lang"))return(je=je.toLowerCase())===Ce||0===je.indexOf(Ce+"-")}while((Ae=Ae.parentNode)&&1===Ae.nodeType);return!1}}),target:function(Ce){var Ae=g.location&&g.location.hash;return Ae&&Ae.slice(1)===Ce.id},root:function(Ce){return Ce===Te},focus:function(Ce){return Ce===Xe.activeElement&&(!Xe.hasFocus||Xe.hasFocus())&&!!(Ce.type||Ce.href||~Ce.tabIndex)},enabled:qe(!1),disabled:qe(!0),checked:function(Ce){var Ae=Ce.nodeName.toLowerCase();return"input"===Ae&&!!Ce.checked||"option"===Ae&&!!Ce.selected},selected:function(Ce){return!0===Ce.selected},empty:function(Ce){for(Ce=Ce.firstChild;Ce;Ce=Ce.nextSibling)if(Ce.nodeType<6)return!1;return!0},parent:function(Ce){return!Z.pseudos.empty(Ce)},header:function(Ce){return nn.test(Ce.nodeName)},input:function(Ce){return Za.test(Ce.nodeName)},button:function(Ce){var Ae=Ce.nodeName.toLowerCase();return"input"===Ae&&"button"===Ce.type||"button"===Ae},text:function(Ce){var Ae;return"input"===Ce.nodeName.toLowerCase()&&"text"===Ce.type&&(null==(Ae=Ce.getAttribute("type"))||"text"===Ae.toLowerCase())},first:ut(function(){return[0]}),last:ut(function(Ce,Ae){return[Ae-1]}),eq:ut(function(Ce,Ae,je){return[je<0?je+Ae:je]}),even:ut(function(Ce,Ae){for(var je=0;je<Ae;je+=2)Ce.push(je);return Ce}),odd:ut(function(Ce,Ae){for(var je=1;je<Ae;je+=2)Ce.push(je);return Ce}),lt:ut(function(Ce,Ae,je){for(var st=je<0?je+Ae:Ae<je?Ae:je;0<=--st;)Ce.push(st);return Ce}),gt:ut(function(Ce,Ae,je){for(var st=je<0?je+Ae:je;++st<Ae;)Ce.push(st);return Ce})}}).pseudos.nth=Z.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Z.pseudos[k]=Ot(k);for(k in{submit:!0,reset:!0})Z.pseudos[k]=Oa(k);function zi(){}function _a(Ce){for(var Ae=0,je=Ce.length,st="";Ae<je;Ae++)st+=Ce[Ae].value;return st}function Ia(Ce,Ae,je){var st=Ae.dir,Fe=Ae.next,dt=Fe||st,Tt=je&&"parentNode"===dt,_t=Ht++;return Ae.first?function(Nt,Kt,Jt){for(;Nt=Nt[st];)if(1===Nt.nodeType||Tt)return Ce(Nt,Kt,Jt);return!1}:function(Nt,Kt,Jt){var Gt,pi,xi,ti=[Xt,_t];if(Jt){for(;Nt=Nt[st];)if((1===Nt.nodeType||Tt)&&Ce(Nt,Kt,Jt))return!0}else for(;Nt=Nt[st];)if(1===Nt.nodeType||Tt)if(pi=(xi=Nt[mt]||(Nt[mt]={}))[Nt.uniqueID]||(xi[Nt.uniqueID]={}),Fe&&Fe===Nt.nodeName.toLowerCase())Nt=Nt[st]||Nt;else{if((Gt=pi[dt])&&Gt[0]===Xt&&Gt[1]===_t)return ti[2]=Gt[2];if((pi[dt]=ti)[2]=Ce(Nt,Kt,Jt))return!0}return!1}}function Fa(Ce){return 1<Ce.length?function(Ae,je,st){for(var Fe=Ce.length;Fe--;)if(!Ce[Fe](Ae,je,st))return!1;return!0}:Ce[0]}function Da(Ce,Ae,je,st,Fe){for(var dt,Tt=[],_t=0,Nt=Ce.length,Kt=null!=Ae;_t<Nt;_t++)(dt=Ce[_t])&&(je&&!je(dt,st,Fe)||(Tt.push(dt),Kt&&Ae.push(_t)));return Tt}function da(Ce,Ae,je,st,Fe,dt){return st&&!st[mt]&&(st=da(st)),Fe&&!Fe[mt]&&(Fe=da(Fe,dt)),Dn(function(Tt,_t,Nt,Kt){var Jt,Gt,pi,xi=[],ti=[],Yi=_t.length,Xi=Tt||function(kn,sn,Wi){for(var Sn=0,va=sn.length;Sn<va;Sn++)ni(kn,sn[Sn],Wi);return Wi}(Ae||"*",Nt.nodeType?[Nt]:Nt,[]),vn=!Ce||!Tt&&Ae?Xi:Da(Xi,xi,Ce,Nt,Kt),Ri=je?Fe||(Tt?Ce:Yi||st)?[]:_t:vn;if(je&&je(vn,Ri,Nt,Kt),st)for(Jt=Da(Ri,ti),st(Jt,[],Nt,Kt),Gt=Jt.length;Gt--;)(pi=Jt[Gt])&&(Ri[ti[Gt]]=!(vn[ti[Gt]]=pi));if(Tt){if(Fe||Ce){if(Fe){for(Jt=[],Gt=Ri.length;Gt--;)(pi=Ri[Gt])&&Jt.push(vn[Gt]=pi);Fe(null,Ri=[],Jt,Kt)}for(Gt=Ri.length;Gt--;)(pi=Ri[Gt])&&-1<(Jt=Fe?In(Tt,pi):xi[Gt])&&(Tt[Jt]=!(_t[Jt]=pi))}}else Ri=Da(Ri===_t?Ri.splice(Yi,Ri.length):Ri),Fe?Fe(null,_t,Ri,Kt):hi.apply(_t,Ri)})}function ua(Ce){for(var Ae,je,st,Fe=Ce.length,dt=Z.relative[Ce[0].type],Tt=dt||Z.relative[" "],_t=dt?1:0,Nt=Ia(function(Gt){return Gt===Ae},Tt,!0),Kt=Ia(function(Gt){return-1<In(Ae,Gt)},Tt,!0),Jt=[function(Gt,pi,xi){var ti=!dt&&(xi||pi!==Ve)||((Ae=pi).nodeType?Nt(Gt,pi,xi):Kt(Gt,pi,xi));return Ae=null,ti}];_t<Fe;_t++)if(je=Z.relative[Ce[_t].type])Jt=[Ia(Fa(Jt),je)];else{if((je=Z.filter[Ce[_t].type].apply(null,Ce[_t].matches))[mt]){for(st=++_t;st<Fe&&!Z.relative[Ce[st].type];st++);return da(1<_t&&Fa(Jt),1<_t&&_a(Ce.slice(0,_t-1).concat({value:" "===Ce[_t-2].type?"*":""})).replace(fn,"$1"),je,_t<st&&ua(Ce.slice(_t,st)),st<Fe&&ua(Ce=Ce.slice(st)),st<Fe&&_a(Ce))}Jt.push(je)}return Fa(Jt)}return zi.prototype=Z.filters=Z.pseudos,Z.setFilters=new zi,ve=ni.tokenize=function(Ce,Ae){var je,st,Fe,dt,Tt,_t,Nt,Kt=li[Ce+" "];if(Kt)return Ae?0:Kt.slice(0);for(Tt=Ce,_t=[],Nt=Z.preFilter;Tt;){for(dt in je&&!(st=ga.exec(Tt))||(st&&(Tt=Tt.slice(st[0].length)||Tt),_t.push(Fe=[])),je=!1,(st=ca.exec(Tt))&&(je=st.shift(),Fe.push({value:je,type:st[0].replace(fn," ")}),Tt=Tt.slice(je.length)),Z.filter)!(st=Bn[dt].exec(Tt))||Nt[dt]&&!(st=Nt[dt](st))||(je=st.shift(),Fe.push({value:je,type:dt,matches:st}),Tt=Tt.slice(je.length));if(!je)break}return Ae?Tt.length:Tt?ni.error(Ce):li(Ce,_t).slice(0)},_e=ni.compile=function(Ce,Ae){var je,st,Fe,dt,Tt,_t,Nt=[],Kt=[],Jt=Li[Ce+" "];if(!Jt){for(Ae||(Ae=ve(Ce)),je=Ae.length;je--;)(Jt=ua(Ae[je]))[mt]?Nt.push(Jt):Kt.push(Jt);(Jt=Li(Ce,(st=Kt,dt=0<(Fe=Nt).length,Tt=0<st.length,_t=function(Gt,pi,xi,ti,Yi){var Xi,vn,Ri,kn=0,sn="0",Wi=Gt&&[],Sn=[],va=Ve,nr=Gt||Tt&&Z.find.TAG("*",Yi),Ba=Xt+=null==va?1:Math.random()||.1,Ga=nr.length;for(Yi&&(Ve=pi==Xe||pi||Yi);sn!==Ga&&null!=(Xi=nr[sn]);sn++){if(Tt&&Xi){for(vn=0,pi||Xi.ownerDocument==Xe||(Je(Xi),xi=!j);Ri=st[vn++];)if(Ri(Xi,pi||Xe,xi)){ti.push(Xi);break}Yi&&(Xt=Ba)}dt&&((Xi=!Ri&&Xi)&&kn--,Gt&&Wi.push(Xi))}if(kn+=sn,dt&&sn!==kn){for(vn=0;Ri=Fe[vn++];)Ri(Wi,Sn,pi,xi);if(Gt){if(0<kn)for(;sn--;)Wi[sn]||Sn[sn]||(Sn[sn]=Dt.call(ti));Sn=Da(Sn)}hi.apply(ti,Sn),Yi&&!Gt&&0<Sn.length&&1<kn+Fe.length&&ni.uniqueSort(ti)}return Yi&&(Xt=Ba,Ve=va),Wi},dt?Dn(_t):_t))).selector=Ce}return Jt},De=ni.select=function(Ce,Ae,je,st){var Fe,dt,Tt,_t,Nt,Kt="function"==typeof Ce&&Ce,Jt=!st&&ve(Ce=Kt.selector||Ce);if(je=je||[],1===Jt.length){if(2<(dt=Jt[0]=Jt[0].slice(0)).length&&"ID"===(Tt=dt[0]).type&&9===Ae.nodeType&&j&&Z.relative[dt[1].type]){if(!(Ae=(Z.find.ID(Tt.matches[0].replace(Ji,Xn),Ae)||[])[0]))return je;Kt&&(Ae=Ae.parentNode),Ce=Ce.slice(dt.shift().value.length)}for(Fe=Bn.needsContext.test(Ce)?0:dt.length;Fe--&&!Z.relative[_t=(Tt=dt[Fe]).type];)if((Nt=Z.find[_t])&&(st=Nt(Tt.matches[0].replace(Ji,Xn),gn.test(dt[0].type)&&Rn(Ae.parentNode)||Ae))){if(dt.splice(Fe,1),!(Ce=st.length&&_a(dt)))return hi.apply(je,st),je;break}}return(Kt||_e(Ce,Jt))(st,Ae,!j,je,!Ae||gn.test(Ce)&&Rn(Ae.parentNode)||Ae),je},J.sortStable=mt.split("").sort(Vi).join("")===mt,J.detectDuplicates=!!ot,Je(),J.sortDetached=On(function(Ce){return 1&Ce.compareDocumentPosition(Xe.createElement("fieldset"))}),On(function(Ce){return Ce.innerHTML="<a href='#'></a>","#"===Ce.firstChild.getAttribute("href")})||Ta("type|href|height|width",function(Ce,Ae,je){if(!je)return Ce.getAttribute(Ae,"type"===Ae.toLowerCase()?1:2)}),J.attributes&&On(function(Ce){return Ce.innerHTML="<input/>",Ce.firstChild.setAttribute("value",""),""===Ce.firstChild.getAttribute("value")})||Ta("value",function(Ce,Ae,je){if(!je&&"input"===Ce.nodeName.toLowerCase())return Ce.defaultValue}),On(function(Ce){return null==Ce.getAttribute("disabled")})||Ta(An,function(Ce,Ae,je){var st;if(!je)return!0===Ce[Ae]?Ae.toLowerCase():(st=Ce.getAttributeNode(Ae))&&st.specified?st.value:null}),ni}(tt);l.find=T,l.expr=T.selectors,l.expr[":"]=l.expr.pseudos,l.uniqueSort=l.unique=T.uniqueSort,l.text=T.getText,l.isXMLDoc=T.isXML,l.contains=T.contains,l.escapeSelector=T.escape;var b=function(g,k,J){for(var Z=[],he=void 0!==J;(g=g[k])&&9!==g.nodeType;)if(1===g.nodeType){if(he&&l(g).is(J))break;Z.push(g)}return Z},H=function(g,k){for(var J=[];g;g=g.nextSibling)1===g.nodeType&&g!==k&&J.push(g);return J},ne=l.expr.match.needsContext;function le(g,k){return g.nodeName&&g.nodeName.toLowerCase()===k.toLowerCase()}var W=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function be(g,k,J){return n(k)?l.grep(g,function(Z,he){return!!k.call(Z,he,Z)!==J}):k.nodeType?l.grep(g,function(Z){return Z===k!==J}):"string"!=typeof k?l.grep(g,function(Z){return-1<c.call(k,Z)!==J}):l.filter(k,g,J)}l.filter=function(g,k,J){var Z=k[0];return J&&(g=":not("+g+")"),1===k.length&&1===Z.nodeType?l.find.matchesSelector(Z,g)?[Z]:[]:l.find.matches(g,l.grep(k,function(he){return 1===he.nodeType}))},l.fn.extend({find:function(g){var k,J,Z=this.length,he=this;if("string"!=typeof g)return this.pushStack(l(g).filter(function(){for(k=0;k<Z;k++)if(l.contains(he[k],this))return!0}));for(J=this.pushStack([]),k=0;k<Z;k++)l.find(g,he[k],J);return 1<Z?l.uniqueSort(J):J},filter:function(g){return this.pushStack(be(this,g||[],!1))},not:function(g){return this.pushStack(be(this,g||[],!0))},is:function(g){return!!be(this,"string"==typeof g&&ne.test(g)?l(g):g||[],!1).length}});var de,ce=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(l.fn.init=function(g,k,J){var Z,he;if(!g)return this;if(J=J||de,"string"==typeof g){if(!(Z="<"===g[0]&&">"===g[g.length-1]&&3<=g.length?[null,g,null]:ce.exec(g))||!Z[1]&&k)return!k||k.jquery?(k||J).find(g):this.constructor(k).find(g);if(Z[1]){if(l.merge(this,l.parseHTML(Z[1],(k=k instanceof l?k[0]:k)&&k.nodeType?k.ownerDocument||k:R,!0)),W.test(Z[1])&&l.isPlainObject(k))for(Z in k)n(this[Z])?this[Z](k[Z]):this.attr(Z,k[Z]);return this}return(he=R.getElementById(Z[2]))&&(this[0]=he,this.length=1),this}return g.nodeType?(this[0]=g,this.length=1,this):n(g)?void 0!==J.ready?J.ready(g):g(l):l.makeArray(g,this)}).prototype=l.fn,de=l(R);var Ee=/^(?:parents|prev(?:Until|All))/,Ne={children:!0,contents:!0,next:!0,prev:!0};function Oe(g,k){for(;(g=g[k])&&1!==g.nodeType;);return g}l.fn.extend({has:function(g){var k=l(g,this),J=k.length;return this.filter(function(){for(var Z=0;Z<J;Z++)if(l.contains(this,k[Z]))return!0})},closest:function(g,k){var J,Z=0,he=this.length,fe=[],ve="string"!=typeof g&&l(g);if(!ne.test(g))for(;Z<he;Z++)for(J=this[Z];J&&J!==k;J=J.parentNode)if(J.nodeType<11&&(ve?-1<ve.index(J):1===J.nodeType&&l.find.matchesSelector(J,g))){fe.push(J);break}return this.pushStack(1<fe.length?l.uniqueSort(fe):fe)},index:function(g){return g?"string"==typeof g?c.call(l(g),this[0]):c.call(this,g.jquery?g[0]:g):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(g,k){return this.pushStack(l.uniqueSort(l.merge(this.get(),l(g,k))))},addBack:function(g){return this.add(null==g?this.prevObject:this.prevObject.filter(g))}}),l.each({parent:function(g){var k=g.parentNode;return k&&11!==k.nodeType?k:null},parents:function(g){return b(g,"parentNode")},parentsUntil:function(g,k,J){return b(g,"parentNode",J)},next:function(g){return Oe(g,"nextSibling")},prev:function(g){return Oe(g,"previousSibling")},nextAll:function(g){return b(g,"nextSibling")},prevAll:function(g){return b(g,"previousSibling")},nextUntil:function(g,k,J){return b(g,"nextSibling",J)},prevUntil:function(g,k,J){return b(g,"previousSibling",J)},siblings:function(g){return H((g.parentNode||{}).firstChild,g)},children:function(g){return H(g.firstChild)},contents:function(g){return null!=g.contentDocument&&F(g.contentDocument)?g.contentDocument:(le(g,"template")&&(g=g.content||g),l.merge([],g.childNodes))}},function(g,k){l.fn[g]=function(J,Z){var he=l.map(this,k,J);return"Until"!==g.slice(-5)&&(Z=J),Z&&"string"==typeof Z&&(he=l.filter(Z,he)),1<this.length&&(Ne[g]||l.uniqueSort(he),Ee.test(g)&&he.reverse()),this.pushStack(he)}});var He=/[^\x20\t\r\n\f]+/g;function ke(g){return g}function ze(g){throw g}function we(g,k,J,Z){var he;try{g&&n(he=g.promise)?he.call(g).done(k).fail(J):g&&n(he=g.then)?he.call(g,k,J):k.apply(void 0,[g].slice(Z))}catch(fe){J.apply(void 0,[fe])}}l.Callbacks=function(g){var J;g="string"==typeof g?(J={},l.each(g.match(He)||[],function(Je,Xe){J[Xe]=!0}),J):l.extend({},g);var Z,he,fe,ve,_e=[],De=[],Ve=-1,Ye=function(){for(ve=ve||g.once,fe=Z=!0;De.length;Ve=-1)for(he=De.shift();++Ve<_e.length;)!1===_e[Ve].apply(he[0],he[1])&&g.stopOnFalse&&(Ve=_e.length,he=!1);g.memory||(he=!1),Z=!1,ve&&(_e=he?[]:"")},ot={add:function(){return _e&&(he&&!Z&&(Ve=_e.length-1,De.push(he)),function Je(Xe){l.each(Xe,function(Te,j){n(j)?g.unique&&ot.has(j)||_e.push(j):j&&j.length&&"string"!==f(j)&&Je(j)})}(arguments),he&&!Z&&Ye()),this},remove:function(){return l.each(arguments,function(Je,Xe){for(var Te;-1<(Te=l.inArray(Xe,_e,Te));)_e.splice(Te,1),Te<=Ve&&Ve--}),this},has:function(Je){return Je?-1<l.inArray(Je,_e):0<_e.length},empty:function(){return _e&&(_e=[]),this},disable:function(){return ve=De=[],_e=he="",this},disabled:function(){return!_e},lock:function(){return ve=De=[],he||Z||(_e=he=""),this},locked:function(){return!!ve},fireWith:function(Je,Xe){return ve||(Xe=[Je,(Xe=Xe||[]).slice?Xe.slice():Xe],De.push(Xe),Z||Ye()),this},fire:function(){return ot.fireWith(this,arguments),this},fired:function(){return!!fe}};return ot},l.extend({Deferred:function(g){var k=[["notify","progress",l.Callbacks("memory"),l.Callbacks("memory"),2],["resolve","done",l.Callbacks("once memory"),l.Callbacks("once memory"),0,"resolved"],["reject","fail",l.Callbacks("once memory"),l.Callbacks("once memory"),1,"rejected"]],J="pending",Z={state:function(){return J},always:function(){return he.done(arguments).fail(arguments),this},catch:function(fe){return Z.then(null,fe)},pipe:function(){var fe=arguments;return l.Deferred(function(ve){l.each(k,function(_e,De){var Ve=n(fe[De[4]])&&fe[De[4]];he[De[1]](function(){var Ye=Ve&&Ve.apply(this,arguments);Ye&&n(Ye.promise)?Ye.promise().progress(ve.notify).done(ve.resolve).fail(ve.reject):ve[De[0]+"With"](this,Ve?[Ye]:arguments)})}),fe=null}).promise()},then:function(fe,ve,_e){var De=0;function Ve(Ye,ot,Je,Xe){return function(){var Te=this,j=arguments,se=function(){var Le,$e;if(!(Ye<De)){if((Le=Je.apply(Te,j))===ot.promise())throw new TypeError("Thenable self-resolution");n($e=Le&&("object"==typeof Le||"function"==typeof Le)&&Le.then)?Xe?$e.call(Le,Ve(De,ot,ke,Xe),Ve(De,ot,ze,Xe)):(De++,$e.call(Le,Ve(De,ot,ke,Xe),Ve(De,ot,ze,Xe),Ve(De,ot,ke,ot.notifyWith))):(Je!==ke&&(Te=void 0,j=[Le]),(Xe||ot.resolveWith)(Te,j))}},Me=Xe?se:function(){try{se()}catch(Le){l.Deferred.exceptionHook&&l.Deferred.exceptionHook(Le,Me.stackTrace),De<=Ye+1&&(Je!==ze&&(Te=void 0,j=[Le]),ot.rejectWith(Te,j))}};Ye?Me():(l.Deferred.getStackHook&&(Me.stackTrace=l.Deferred.getStackHook()),tt.setTimeout(Me))}}return l.Deferred(function(Ye){k[0][3].add(Ve(0,Ye,n(_e)?_e:ke,Ye.notifyWith)),k[1][3].add(Ve(0,Ye,n(fe)?fe:ke)),k[2][3].add(Ve(0,Ye,n(ve)?ve:ze))}).promise()},promise:function(fe){return null!=fe?l.extend(fe,Z):Z}},he={};return l.each(k,function(fe,ve){var _e=ve[2],De=ve[5];Z[ve[1]]=_e.add,De&&_e.add(function(){J=De},k[3-fe][2].disable,k[3-fe][3].disable,k[0][2].lock,k[0][3].lock),_e.add(ve[3].fire),he[ve[0]]=function(){return he[ve[0]+"With"](this===he?void 0:this,arguments),this},he[ve[0]+"With"]=_e.fireWith}),Z.promise(he),g&&g.call(he,he),he},when:function(g){var k=arguments.length,J=k,Z=Array(J),he=Y.call(arguments),fe=l.Deferred(),ve=function(_e){return function(De){Z[_e]=this,he[_e]=1<arguments.length?Y.call(arguments):De,--k||fe.resolveWith(Z,he)}};if(k<=1&&(we(g,fe.done(ve(J)).resolve,fe.reject,!k),"pending"===fe.state()||n(he[J]&&he[J].then)))return fe.then();for(;J--;)we(he[J],ve(J),fe.reject);return fe.promise()}});var gt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;l.Deferred.exceptionHook=function(g,k){tt.console&&tt.console.warn&&g&&gt.test(g.name)&&tt.console.warn("jQuery.Deferred exception: "+g.message,g.stack,k)},l.readyException=function(g){tt.setTimeout(function(){throw g})};var ft=l.Deferred();function at(){R.removeEventListener("DOMContentLoaded",at),tt.removeEventListener("load",at),l.ready()}l.fn.ready=function(g){return ft.then(g).catch(function(k){l.readyException(k)}),this},l.extend({isReady:!1,readyWait:1,ready:function(g){(!0===g?--l.readyWait:l.isReady)||(l.isReady=!0)!==g&&0<--l.readyWait||ft.resolveWith(R,[l])}}),l.ready.then=ft.then,"complete"===R.readyState||"loading"!==R.readyState&&!R.documentElement.doScroll?tt.setTimeout(l.ready):(R.addEventListener("DOMContentLoaded",at),tt.addEventListener("load",at));var Ze=function(g,k,J,Z,he,fe,ve){var _e=0,De=g.length,Ve=null==J;if("object"===f(J))for(_e in he=!0,J)Ze(g,k,_e,J[_e],!0,fe,ve);else if(void 0!==Z&&(he=!0,n(Z)||(ve=!0),Ve&&(ve?(k.call(g,Z),k=null):(Ve=k,k=function(Ye,ot,Je){return Ve.call(l(Ye),Je)})),k))for(;_e<De;_e++)k(g[_e],J,ve?Z:Z.call(g[_e],_e,k(g[_e],J)));return he?g:Ve?k.call(g):De?k(g[0],J):fe},ie=/^-ms-/,bt=/-([a-z])/g;function Rt(g,k){return k.toUpperCase()}function Ct(g){return g.replace(ie,"ms-").replace(bt,Rt)}var et=function(g){return 1===g.nodeType||9===g.nodeType||!+g.nodeType};function wt(){this.expando=l.expando+wt.uid++}wt.uid=1,wt.prototype={cache:function(g){var k=g[this.expando];return k||(k={},et(g)&&(g.nodeType?g[this.expando]=k:Object.defineProperty(g,this.expando,{value:k,configurable:!0}))),k},set:function(g,k,J){var Z,he=this.cache(g);if("string"==typeof k)he[Ct(k)]=J;else for(Z in k)he[Ct(Z)]=k[Z];return he},get:function(g,k){return void 0===k?this.cache(g):g[this.expando]&&g[this.expando][Ct(k)]},access:function(g,k,J){return void 0===k||k&&"string"==typeof k&&void 0===J?this.get(g,k):(this.set(g,k,J),void 0!==J?J:k)},remove:function(g,k){var J,Z=g[this.expando];if(void 0!==Z){if(void 0!==k)for((J=(k=Array.isArray(k)?k.map(Ct):(k=Ct(k))in Z?[k]:k.match(He)||[]).length);J--;)delete Z[k[J]];(void 0===k||l.isEmptyObject(Z))&&(g.nodeType?g[this.expando]=void 0:delete g[this.expando])}},hasData:function(g){var k=g[this.expando];return void 0!==k&&!l.isEmptyObject(k)}};var Be=new wt,Lt=new wt,jt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ge=/[A-Z]/g;function Pt(g,k,J){var Z,he;if(void 0===J&&1===g.nodeType)if(Z="data-"+k.replace(Ge,"-$&").toLowerCase(),"string"==typeof(J=g.getAttribute(Z))){try{J="true"===(he=J)||"false"!==he&&("null"===he?null:he===+he+""?+he:jt.test(he)?JSON.parse(he):he)}catch(fe){}Lt.set(g,k,J)}else J=void 0;return J}l.extend({hasData:function(g){return Lt.hasData(g)||Be.hasData(g)},data:function(g,k,J){return Lt.access(g,k,J)},removeData:function(g,k){Lt.remove(g,k)},_data:function(g,k,J){return Be.access(g,k,J)},_removeData:function(g,k){Be.remove(g,k)}}),l.fn.extend({data:function(g,k){var J,Z,he,fe=this[0],ve=fe&&fe.attributes;if(void 0===g){if(this.length&&(he=Lt.get(fe),1===fe.nodeType&&!Be.get(fe,"hasDataAttrs"))){for(J=ve.length;J--;)ve[J]&&0===(Z=ve[J].name).indexOf("data-")&&(Z=Ct(Z.slice(5)),Pt(fe,Z,he[Z]));Be.set(fe,"hasDataAttrs",!0)}return he}return"object"==typeof g?this.each(function(){Lt.set(this,g)}):Ze(this,function(_e){var De;if(fe&&void 0===_e)return void 0!==(De=Lt.get(fe,g))||void 0!==(De=Pt(fe,g))?De:void 0;this.each(function(){Lt.set(this,g,_e)})},null,k,1<arguments.length,null,!0)},removeData:function(g){return this.each(function(){Lt.remove(this,g)})}}),l.extend({queue:function(g,k,J){var Z;if(g)return Z=Be.get(g,k=(k||"fx")+"queue"),J&&(!Z||Array.isArray(J)?Z=Be.access(g,k,l.makeArray(J)):Z.push(J)),Z||[]},dequeue:function(g,k){var J=l.queue(g,k=k||"fx"),Z=J.length,he=J.shift(),fe=l._queueHooks(g,k);"inprogress"===he&&(he=J.shift(),Z--),he&&("fx"===k&&J.unshift("inprogress"),delete fe.stop,he.call(g,function(){l.dequeue(g,k)},fe)),!Z&&fe&&fe.empty.fire()},_queueHooks:function(g,k){var J=k+"queueHooks";return Be.get(g,J)||Be.access(g,J,{empty:l.Callbacks("once memory").add(function(){Be.remove(g,[k+"queue",J])})})}}),l.fn.extend({queue:function(g,k){var J=2;return"string"!=typeof g&&(k=g,g="fx",J--),arguments.length<J?l.queue(this[0],g):void 0===k?this:this.each(function(){var Z=l.queue(this,g,k);l._queueHooks(this,g),"fx"===g&&"inprogress"!==Z[0]&&l.dequeue(this,g)})},dequeue:function(g){return this.each(function(){l.dequeue(this,g)})},clearQueue:function(g){return this.queue(g||"fx",[])},promise:function(g,k){var J,Z=1,he=l.Deferred(),fe=this,ve=this.length,_e=function(){--Z||he.resolveWith(fe,[fe])};for("string"!=typeof g&&(k=g,g=void 0),g=g||"fx";ve--;)(J=Be.get(fe[ve],g+"queueHooks"))&&J.empty&&(Z++,J.empty.add(_e));return _e(),he.promise(k)}});var z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,M=new RegExp("^(?:([+-])=|)("+z+")([a-z%]*)$","i"),t=["Top","Right","Bottom","Left"],u=R.documentElement,h=function(g){return l.contains(g.ownerDocument,g)},y={composed:!0};u.getRootNode&&(h=function(g){return l.contains(g.ownerDocument,g)||g.getRootNode(y)===g.ownerDocument});var a=function(g,k){return"none"===(g=k||g).style.display||""===g.style.display&&h(g)&&"none"===l.css(g,"display")};function m(g,k,J,Z){var he,fe,ve=20,_e=Z?function(){return Z.cur()}:function(){return l.css(g,k,"")},De=_e(),Ve=J&&J[3]||(l.cssNumber[k]?"":"px"),Ye=g.nodeType&&(l.cssNumber[k]||"px"!==Ve&&+De)&&M.exec(l.css(g,k));if(Ye&&Ye[3]!==Ve){for(Ve=Ve||Ye[3],Ye=+(De/=2)||1;ve--;)l.style(g,k,Ye+Ve),(1-fe)*(1-(fe=_e()/De||.5))<=0&&(ve=0),Ye/=fe;l.style(g,k,(Ye*=2)+Ve),J=J||[]}return J&&(Ye=+Ye||+De||0,he=J[1]?Ye+(J[1]+1)*J[2]:+J[2],Z&&(Z.unit=Ve,Z.start=Ye,Z.end=he)),he}var _={};function P(g,k){for(var J,Z,he,fe,ve,_e,De,Ve=[],Ye=0,ot=g.length;Ye<ot;Ye++)(Z=g[Ye]).style&&(J=Z.style.display,k?("none"===J&&(Ve[Ye]=Be.get(Z,"display")||null,Ve[Ye]||(Z.style.display="")),""===Z.style.display&&a(Z)&&(Ve[Ye]=(De=ve=fe=void 0,ve=(he=Z).ownerDocument,(De=_[_e=he.nodeName])||(fe=ve.body.appendChild(ve.createElement(_e)),De=l.css(fe,"display"),fe.parentNode.removeChild(fe),"none"===De&&(De="block"),_[_e]=De)))):"none"!==J&&(Ve[Ye]="none",Be.set(Z,"display",J)));for(Ye=0;Ye<ot;Ye++)null!=Ve[Ye]&&(g[Ye].style.display=Ve[Ye]);return g}l.fn.extend({show:function(){return P(this,!0)},hide:function(){return P(this)},toggle:function(g){return"boolean"==typeof g?g?this.show():this.hide():this.each(function(){a(this)?l(this).show():l(this).hide()})}});var x,oe,K=/^(?:checkbox|radio)$/i,X=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,me=/^$|^module$|\/(?:java|ecma)script/i;x=R.createDocumentFragment().appendChild(R.createElement("div")),(oe=R.createElement("input")).setAttribute("type","radio"),oe.setAttribute("checked","checked"),oe.setAttribute("name","t"),x.appendChild(oe),S.checkClone=x.cloneNode(!0).cloneNode(!0).lastChild.checked,x.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!x.cloneNode(!0).lastChild.defaultValue,x.innerHTML="<option></option>",S.option=!!x.lastChild;var Q={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function re(g,k){var J;return J=void 0!==g.getElementsByTagName?g.getElementsByTagName(k||"*"):void 0!==g.querySelectorAll?g.querySelectorAll(k||"*"):[],void 0===k||k&&le(g,k)?l.merge([g],J):J}function ye(g,k){for(var J=0,Z=g.length;J<Z;J++)Be.set(g[J],"globalEval",!k||Be.get(k[J],"globalEval"))}Q.tbody=Q.tfoot=Q.colgroup=Q.caption=Q.thead,Q.th=Q.td,S.option||(Q.optgroup=Q.option=[1,"<select multiple='multiple'>","</select>"]);var Se=/<|&#?\w+;/;function ge(g,k,J,Z,he){for(var fe,ve,_e,De,Ve,Ye,ot=k.createDocumentFragment(),Je=[],Xe=0,Te=g.length;Xe<Te;Xe++)if((fe=g[Xe])||0===fe)if("object"===f(fe))l.merge(Je,fe.nodeType?[fe]:fe);else if(Se.test(fe)){for(ve=ve||ot.appendChild(k.createElement("div")),_e=(X.exec(fe)||["",""])[1].toLowerCase(),ve.innerHTML=(De=Q[_e]||Q._default)[1]+l.htmlPrefilter(fe)+De[2],Ye=De[0];Ye--;)ve=ve.lastChild;l.merge(Je,ve.childNodes),(ve=ot.firstChild).textContent=""}else Je.push(k.createTextNode(fe));for(ot.textContent="",Xe=0;fe=Je[Xe++];)if(Z&&-1<l.inArray(fe,Z))he&&he.push(fe);else if(Ve=h(fe),ve=re(ot.appendChild(fe),"script"),Ve&&ye(ve),J)for(Ye=0;fe=ve[Ye++];)me.test(fe.type||"")&&J.push(fe);return ot}var Pe=/^([^.]*)(?:\.(.+)|)/;function xe(){return!0}function We(){return!1}function rt(g,k){return g===function(){try{return R.activeElement}catch(J){}}()==("focus"===k)}function Et(g,k,J,Z,he,fe){var ve,_e;if("object"==typeof k){for(_e in"string"!=typeof J&&(Z=Z||J,J=void 0),k)Et(g,_e,J,Z,k[_e],fe);return g}if(null==Z&&null==he?(he=J,Z=J=void 0):null==he&&("string"==typeof J?(he=Z,Z=void 0):(he=Z,Z=J,J=void 0)),!1===he)he=We;else if(!he)return g;return 1===fe&&(ve=he,(he=function(De){return l().off(De),ve.apply(this,arguments)}).guid=ve.guid||(ve.guid=l.guid++)),g.each(function(){l.event.add(this,k,he,Z,J)})}function Qe(g,k,J){J?(Be.set(g,k,!1),l.event.add(g,k,{namespace:!1,handler:function(Z){var he,fe,ve=Be.get(this,k);if(1&Z.isTrigger&&this[k]){if(ve.length)(l.event.special[k]||{}).delegateType&&Z.stopPropagation();else if(ve=Y.call(arguments),Be.set(this,k,ve),he=J(this,k),this[k](),ve!==(fe=Be.get(this,k))||he?Be.set(this,k,!1):fe={},ve!==fe)return Z.stopImmediatePropagation(),Z.preventDefault(),fe&&fe.value}else ve.length&&(Be.set(this,k,{value:l.event.trigger(l.extend(ve[0],l.Event.prototype),ve.slice(1),this)}),Z.stopImmediatePropagation())}})):void 0===Be.get(g,k)&&l.event.add(g,k,xe)}l.event={global:{},add:function(g,k,J,Z,he){var fe,ve,_e,De,Ve,Ye,ot,Je,Xe,Te,j,se=Be.get(g);if(et(g))for(J.handler&&(J=(fe=J).handler,he=fe.selector),he&&l.find.matchesSelector(u,he),J.guid||(J.guid=l.guid++),(De=se.events)||(De=se.events=Object.create(null)),(ve=se.handle)||(ve=se.handle=function(Me){return void 0!==l&&l.event.triggered!==Me.type?l.event.dispatch.apply(g,arguments):void 0}),Ve=(k=(k||"").match(He)||[""]).length;Ve--;)Xe=j=(_e=Pe.exec(k[Ve])||[])[1],Te=(_e[2]||"").split(".").sort(),Xe&&(ot=l.event.special[Xe]||{},ot=l.event.special[Xe=(he?ot.delegateType:ot.bindType)||Xe]||{},Ye=l.extend({type:Xe,origType:j,data:Z,handler:J,guid:J.guid,selector:he,needsContext:he&&l.expr.match.needsContext.test(he),namespace:Te.join(".")},fe),(Je=De[Xe])||((Je=De[Xe]=[]).delegateCount=0,ot.setup&&!1!==ot.setup.call(g,Z,Te,ve)||g.addEventListener&&g.addEventListener(Xe,ve)),ot.add&&(ot.add.call(g,Ye),Ye.handler.guid||(Ye.handler.guid=J.guid)),he?Je.splice(Je.delegateCount++,0,Ye):Je.push(Ye),l.event.global[Xe]=!0)},remove:function(g,k,J,Z,he){var fe,ve,_e,De,Ve,Ye,ot,Je,Xe,Te,j,se=Be.hasData(g)&&Be.get(g);if(se&&(De=se.events)){for(Ve=(k=(k||"").match(He)||[""]).length;Ve--;)if(Xe=j=(_e=Pe.exec(k[Ve])||[])[1],Te=(_e[2]||"").split(".").sort(),Xe){for(ot=l.event.special[Xe]||{},Je=De[Xe=(Z?ot.delegateType:ot.bindType)||Xe]||[],_e=_e[2]&&new RegExp("(^|\\.)"+Te.join("\\.(?:.*\\.|)")+"(\\.|$)"),ve=fe=Je.length;fe--;)Ye=Je[fe],!he&&j!==Ye.origType||J&&J.guid!==Ye.guid||_e&&!_e.test(Ye.namespace)||Z&&Z!==Ye.selector&&("**"!==Z||!Ye.selector)||(Je.splice(fe,1),Ye.selector&&Je.delegateCount--,ot.remove&&ot.remove.call(g,Ye));ve&&!Je.length&&(ot.teardown&&!1!==ot.teardown.call(g,Te,se.handle)||l.removeEvent(g,Xe,se.handle),delete De[Xe])}else for(Xe in De)l.event.remove(g,Xe+k[Ve],J,Z,!0);l.isEmptyObject(De)&&Be.remove(g,"handle events")}},dispatch:function(g){var k,J,Z,he,fe,ve,_e=new Array(arguments.length),De=l.event.fix(g),Ve=(Be.get(this,"events")||Object.create(null))[De.type]||[],Ye=l.event.special[De.type]||{};for(_e[0]=De,k=1;k<arguments.length;k++)_e[k]=arguments[k];if(De.delegateTarget=this,!Ye.preDispatch||!1!==Ye.preDispatch.call(this,De)){for(ve=l.event.handlers.call(this,De,Ve),k=0;(he=ve[k++])&&!De.isPropagationStopped();)for(De.currentTarget=he.elem,J=0;(fe=he.handlers[J++])&&!De.isImmediatePropagationStopped();)De.rnamespace&&!1!==fe.namespace&&!De.rnamespace.test(fe.namespace)||(De.handleObj=fe,De.data=fe.data,void 0!==(Z=((l.event.special[fe.origType]||{}).handle||fe.handler).apply(he.elem,_e))&&!1===(De.result=Z)&&(De.preventDefault(),De.stopPropagation()));return Ye.postDispatch&&Ye.postDispatch.call(this,De),De.result}},handlers:function(g,k){var J,Z,he,fe,ve,_e=[],De=k.delegateCount,Ve=g.target;if(De&&Ve.nodeType&&!("click"===g.type&&1<=g.button))for(;Ve!==this;Ve=Ve.parentNode||this)if(1===Ve.nodeType&&("click"!==g.type||!0!==Ve.disabled)){for(fe=[],ve={},J=0;J<De;J++)void 0===ve[he=(Z=k[J]).selector+" "]&&(ve[he]=Z.needsContext?-1<l(he,this).index(Ve):l.find(he,this,null,[Ve]).length),ve[he]&&fe.push(Z);fe.length&&_e.push({elem:Ve,handlers:fe})}return Ve=this,De<k.length&&_e.push({elem:Ve,handlers:k.slice(De)}),_e},addProp:function(g,k){Object.defineProperty(l.Event.prototype,g,{enumerable:!0,configurable:!0,get:n(k)?function(){if(this.originalEvent)return k(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[g]},set:function(J){Object.defineProperty(this,g,{enumerable:!0,configurable:!0,writable:!0,value:J})}})},fix:function(g){return g[l.expando]?g:new l.Event(g)},special:{load:{noBubble:!0},click:{setup:function(g){var k=this||g;return K.test(k.type)&&k.click&&le(k,"input")&&Qe(k,"click",xe),!1},trigger:function(g){var k=this||g;return K.test(k.type)&&k.click&&le(k,"input")&&Qe(k,"click"),!0},_default:function(g){var k=g.target;return K.test(k.type)&&k.click&&le(k,"input")&&Be.get(k,"click")||le(k,"a")}},beforeunload:{postDispatch:function(g){void 0!==g.result&&g.originalEvent&&(g.originalEvent.returnValue=g.result)}}}},l.removeEvent=function(g,k,J){g.removeEventListener&&g.removeEventListener(k,J)},l.Event=function(g,k){if(!(this instanceof l.Event))return new l.Event(g,k);g&&g.type?(this.originalEvent=g,this.type=g.type,this.isDefaultPrevented=g.defaultPrevented||void 0===g.defaultPrevented&&!1===g.returnValue?xe:We,this.target=g.target&&3===g.target.nodeType?g.target.parentNode:g.target,this.currentTarget=g.currentTarget,this.relatedTarget=g.relatedTarget):this.type=g,k&&l.extend(this,k),this.timeStamp=g&&g.timeStamp||Date.now(),this[l.expando]=!0},l.Event.prototype={constructor:l.Event,isDefaultPrevented:We,isPropagationStopped:We,isImmediatePropagationStopped:We,isSimulated:!1,preventDefault:function(){var g=this.originalEvent;this.isDefaultPrevented=xe,g&&!this.isSimulated&&g.preventDefault()},stopPropagation:function(){var g=this.originalEvent;this.isPropagationStopped=xe,g&&!this.isSimulated&&g.stopPropagation()},stopImmediatePropagation:function(){var g=this.originalEvent;this.isImmediatePropagationStopped=xe,g&&!this.isSimulated&&g.stopImmediatePropagation(),this.stopPropagation()}},l.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},l.event.addProp),l.each({focus:"focusin",blur:"focusout"},function(g,k){l.event.special[g]={setup:function(){return Qe(this,g,rt),!1},trigger:function(){return Qe(this,g),!0},_default:function(){return!0},delegateType:k}}),l.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(g,k){l.event.special[g]={delegateType:k,bindType:k,handle:function(J){var Z,he=J.relatedTarget,fe=J.handleObj;return he&&(he===this||l.contains(this,he))||(J.type=fe.origType,Z=fe.handler.apply(this,arguments),J.type=k),Z}}}),l.fn.extend({on:function(g,k,J,Z){return Et(this,g,k,J,Z)},one:function(g,k,J,Z){return Et(this,g,k,J,Z,1)},off:function(g,k,J){var Z,he;if(g&&g.preventDefault&&g.handleObj)return Z=g.handleObj,l(g.delegateTarget).off(Z.namespace?Z.origType+"."+Z.namespace:Z.origType,Z.selector,Z.handler),this;if("object"==typeof g){for(he in g)this.off(he,k,g[he]);return this}return!1!==k&&"function"!=typeof k||(J=k,k=void 0),!1===J&&(J=We),this.each(function(){l.event.remove(this,g,J,k)})}});var yt=/<script|<style|<link/i,ct=/checked\s*(?:[^=]|=\s*.checked.)/i,ht=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function mi(g,k){return le(g,"table")&&le(11!==k.nodeType?k:k.firstChild,"tr")&&l(g).children("tbody")[0]||g}function Bi(g){return g.type=(null!==g.getAttribute("type"))+"/"+g.type,g}function Yt(g){return"true/"===(g.type||"").slice(0,5)?g.type=g.type.slice(5):g.removeAttribute("type"),g}function oi(g,k){var J,Z,he,fe,ve,_e;if(1===k.nodeType){if(Be.hasData(g)&&(_e=Be.get(g).events))for(he in Be.remove(k,"handle events"),_e)for(J=0,Z=_e[he].length;J<Z;J++)l.event.add(k,he,_e[he][J]);Lt.hasData(g)&&(fe=Lt.access(g),ve=l.extend({},fe),Lt.set(k,ve))}}function ei(g,k,J,Z){k=e(k);var he,fe,ve,_e,De,Ve,Ye=0,ot=g.length,Je=ot-1,Xe=k[0],Te=n(Xe);if(Te||1<ot&&"string"==typeof Xe&&!S.checkClone&&ct.test(Xe))return g.each(function(j){var se=g.eq(j);Te&&(k[0]=Xe.call(this,j,se.html())),ei(se,k,J,Z)});if(ot&&(fe=(he=ge(k,g[0].ownerDocument,!1,g,Z)).firstChild,1===he.childNodes.length&&(he=fe),fe||Z)){for(_e=(ve=l.map(re(he,"script"),Bi)).length;Ye<ot;Ye++)De=he,Ye!==Je&&(De=l.clone(De,!0,!0),_e&&l.merge(ve,re(De,"script"))),J.call(g[Ye],De,Ye);if(_e)for(Ve=ve[ve.length-1].ownerDocument,l.map(ve,Yt),Ye=0;Ye<_e;Ye++)me.test((De=ve[Ye]).type||"")&&!Be.access(De,"globalEval")&&l.contains(Ve,De)&&(De.src&&"module"!==(De.type||"").toLowerCase()?l._evalUrl&&!De.noModule&&l._evalUrl(De.src,{nonce:De.nonce||De.getAttribute("nonce")},Ve):o(De.textContent.replace(ht,""),De,Ve))}return g}function Ci(g,k,J){for(var Z,he=k?l.filter(k,g):g,fe=0;null!=(Z=he[fe]);fe++)J||1!==Z.nodeType||l.cleanData(re(Z)),Z.parentNode&&(J&&h(Z)&&ye(re(Z,"script")),Z.parentNode.removeChild(Z));return g}l.extend({htmlPrefilter:function(g){return g},clone:function(g,k,J){var Z,he,fe,ve,_e,De,Ve,Ye=g.cloneNode(!0),ot=h(g);if(!(S.noCloneChecked||1!==g.nodeType&&11!==g.nodeType||l.isXMLDoc(g)))for(ve=re(Ye),Z=0,he=(fe=re(g)).length;Z<he;Z++)_e=fe[Z],"input"===(Ve=(De=ve[Z]).nodeName.toLowerCase())&&K.test(_e.type)?De.checked=_e.checked:"input"!==Ve&&"textarea"!==Ve||(De.defaultValue=_e.defaultValue);if(k)if(J)for(fe=fe||re(g),ve=ve||re(Ye),Z=0,he=fe.length;Z<he;Z++)oi(fe[Z],ve[Z]);else oi(g,Ye);return 0<(ve=re(Ye,"script")).length&&ye(ve,!ot&&re(g,"script")),Ye},cleanData:function(g){for(var k,J,Z,he=l.event.special,fe=0;void 0!==(J=g[fe]);fe++)if(et(J)){if(k=J[Be.expando]){if(k.events)for(Z in k.events)he[Z]?l.event.remove(J,Z):l.removeEvent(J,Z,k.handle);J[Be.expando]=void 0}J[Lt.expando]&&(J[Lt.expando]=void 0)}}}),l.fn.extend({detach:function(g){return Ci(this,g,!0)},remove:function(g){return Ci(this,g)},text:function(g){return Ze(this,function(k){return void 0===k?l.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=k)})},null,g,arguments.length)},append:function(){return ei(this,arguments,function(g){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||mi(this,g).appendChild(g)})},prepend:function(){return ei(this,arguments,function(g){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var k=mi(this,g);k.insertBefore(g,k.firstChild)}})},before:function(){return ei(this,arguments,function(g){this.parentNode&&this.parentNode.insertBefore(g,this)})},after:function(){return ei(this,arguments,function(g){this.parentNode&&this.parentNode.insertBefore(g,this.nextSibling)})},empty:function(){for(var g,k=0;null!=(g=this[k]);k++)1===g.nodeType&&(l.cleanData(re(g,!1)),g.textContent="");return this},clone:function(g,k){return g=null!=g&&g,k=null==k?g:k,this.map(function(){return l.clone(this,g,k)})},html:function(g){return Ze(this,function(k){var J=this[0]||{},Z=0,he=this.length;if(void 0===k&&1===J.nodeType)return J.innerHTML;if("string"==typeof k&&!yt.test(k)&&!Q[(X.exec(k)||["",""])[1].toLowerCase()]){k=l.htmlPrefilter(k);try{for(;Z<he;Z++)1===(J=this[Z]||{}).nodeType&&(l.cleanData(re(J,!1)),J.innerHTML=k);J=0}catch(fe){}}J&&this.empty().append(k)},null,g,arguments.length)},replaceWith:function(){var g=[];return ei(this,arguments,function(k){var J=this.parentNode;l.inArray(this,g)<0&&(l.cleanData(re(this)),J&&J.replaceChild(k,this))},g)}}),l.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(g,k){l.fn[g]=function(J){for(var Z,he=[],fe=l(J),ve=fe.length-1,_e=0;_e<=ve;_e++)Z=_e===ve?this:this.clone(!0),l(fe[_e])[k](Z),i.apply(he,Z.get());return this.pushStack(he)}});var Ai=new RegExp("^("+z+")(?!px)[a-z%]+$","i"),yi=function(g){var k=g.ownerDocument.defaultView;return k&&k.opener||(k=tt),k.getComputedStyle(g)},gi=function(g,k,J){var Z,he,fe={};for(he in k)fe[he]=g.style[he],g.style[he]=k[he];for(he in Z=J.call(g),k)g.style[he]=fe[he];return Z},ki=new RegExp(t.join("|"),"i");function Gi(g,k,J){var Z,he,fe,ve,_e=g.style;return(J=J||yi(g))&&(""!==(ve=J.getPropertyValue(k)||J[k])||h(g)||(ve=l.style(g,k)),!S.pixelBoxStyles()&&Ai.test(ve)&&ki.test(k)&&(Z=_e.width,he=_e.minWidth,fe=_e.maxWidth,_e.minWidth=_e.maxWidth=_e.width=ve,ve=J.width,_e.width=Z,_e.minWidth=he,_e.maxWidth=fe)),void 0!==ve?ve+"":ve}function _i(g,k){return{get:function(){if(!g())return(this.get=k).apply(this,arguments);delete this.get}}}!function(){function g(){if(Ve){De.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Ve.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",u.appendChild(De).appendChild(Ve);var Ye=tt.getComputedStyle(Ve);J="1%"!==Ye.top,_e=12===k(Ye.marginLeft),Ve.style.right="60%",fe=36===k(Ye.right),Z=36===k(Ye.width),Ve.style.position="absolute",he=12===k(Ve.offsetWidth/3),u.removeChild(De),Ve=null}}function k(Ye){return Math.round(parseFloat(Ye))}var J,Z,he,fe,ve,_e,De=R.createElement("div"),Ve=R.createElement("div");Ve.style&&(Ve.style.backgroundClip="content-box",Ve.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle="content-box"===Ve.style.backgroundClip,l.extend(S,{boxSizingReliable:function(){return g(),Z},pixelBoxStyles:function(){return g(),fe},pixelPosition:function(){return g(),J},reliableMarginLeft:function(){return g(),_e},scrollboxSize:function(){return g(),he},reliableTrDimensions:function(){var Ye,ot,Je,Xe;return null==ve&&(Ye=R.createElement("table"),ot=R.createElement("tr"),Je=R.createElement("div"),Ye.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ot.style.cssText="border:1px solid",ot.style.height="1px",Je.style.height="9px",Je.style.display="block",u.appendChild(Ye).appendChild(ot).appendChild(Je),Xe=tt.getComputedStyle(ot),ve=parseInt(Xe.height,10)+parseInt(Xe.borderTopWidth,10)+parseInt(Xe.borderBottomWidth,10)===ot.offsetHeight,u.removeChild(Ye)),ve}}))}();var Ni=["Webkit","Moz","ms"],Oi=R.createElement("div").style,cn={};function Di(g){return l.cssProps[g]||cn[g]||(g in Oi?g:cn[g]=function(J){for(var Z=J[0].toUpperCase()+J.slice(1),he=Ni.length;he--;)if((J=Ni[he]+Z)in Oi)return J}(g)||g)}var ji=/^(none|table(?!-c[ea]).+)/,Zi=/^--/,bn={position:"absolute",visibility:"hidden",display:"block"},qi={letterSpacing:"0",fontWeight:"400"};function dn(g,k,J){var Z=M.exec(k);return Z?Math.max(0,Z[2]-(J||0))+(Z[3]||"px"):k}function _n(g,k,J,Z,he,fe){var ve="width"===k?1:0,_e=0,De=0;if(J===(Z?"border":"content"))return 0;for(;ve<4;ve+=2)"margin"===J&&(De+=l.css(g,J+t[ve],!0,he)),Z?("content"===J&&(De-=l.css(g,"padding"+t[ve],!0,he)),"margin"!==J&&(De-=l.css(g,"border"+t[ve]+"Width",!0,he))):(De+=l.css(g,"padding"+t[ve],!0,he),"padding"!==J?De+=l.css(g,"border"+t[ve]+"Width",!0,he):_e+=l.css(g,"border"+t[ve]+"Width",!0,he));return!Z&&0<=fe&&(De+=Math.max(0,Math.ceil(g["offset"+k[0].toUpperCase()+k.slice(1)]-fe-De-_e-.5))||0),De}function Qn(g,k,J){var Z=yi(g),he=(!S.boxSizingReliable()||J)&&"border-box"===l.css(g,"boxSizing",!1,Z),fe=he,ve=Gi(g,k,Z),_e="offset"+k[0].toUpperCase()+k.slice(1);if(Ai.test(ve)){if(!J)return ve;ve="auto"}return(!S.boxSizingReliable()&&he||!S.reliableTrDimensions()&&le(g,"tr")||"auto"===ve||!parseFloat(ve)&&"inline"===l.css(g,"display",!1,Z))&&g.getClientRects().length&&(he="border-box"===l.css(g,"boxSizing",!1,Z),(fe=_e in g)&&(ve=g[_e])),(ve=parseFloat(ve)||0)+_n(g,k,J||(he?"border":"content"),fe,Z,ve)+"px"}function Pi(g,k,J,Z,he){return new Pi.prototype.init(g,k,J,Z,he)}l.extend({cssHooks:{opacity:{get:function(g,k){if(k){var J=Gi(g,"opacity");return""===J?"1":J}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(g,k,J,Z){if(g&&3!==g.nodeType&&8!==g.nodeType&&g.style){var he,fe,ve,_e=Ct(k),De=Zi.test(k),Ve=g.style;if(De||(k=Di(_e)),ve=l.cssHooks[k]||l.cssHooks[_e],void 0===J)return ve&&"get"in ve&&void 0!==(he=ve.get(g,!1,Z))?he:Ve[k];"string"==(fe=typeof J)&&(he=M.exec(J))&&he[1]&&(J=m(g,k,he),fe="number"),null!=J&&J==J&&("number"!==fe||De||(J+=he&&he[3]||(l.cssNumber[_e]?"":"px")),S.clearCloneStyle||""!==J||0!==k.indexOf("background")||(Ve[k]="inherit"),ve&&"set"in ve&&void 0===(J=ve.set(g,J,Z))||(De?Ve.setProperty(k,J):Ve[k]=J))}},css:function(g,k,J,Z){var he,fe,ve,_e=Ct(k);return Zi.test(k)||(k=Di(_e)),(ve=l.cssHooks[k]||l.cssHooks[_e])&&"get"in ve&&(he=ve.get(g,!0,J)),void 0===he&&(he=Gi(g,k,Z)),"normal"===he&&k in qi&&(he=qi[k]),""===J||J?(fe=parseFloat(he),!0===J||isFinite(fe)?fe||0:he):he}}),l.each(["height","width"],function(g,k){l.cssHooks[k]={get:function(J,Z,he){if(Z)return!ji.test(l.css(J,"display"))||J.getClientRects().length&&J.getBoundingClientRect().width?Qn(J,k,he):gi(J,bn,function(){return Qn(J,k,he)})},set:function(J,Z,he){var fe,ve=yi(J),_e=!S.scrollboxSize()&&"absolute"===ve.position,De=(_e||he)&&"border-box"===l.css(J,"boxSizing",!1,ve),Ve=he?_n(J,k,he,De,ve):0;return De&&_e&&(Ve-=Math.ceil(J["offset"+k[0].toUpperCase()+k.slice(1)]-parseFloat(ve[k])-_n(J,k,"border",!1,ve)-.5)),Ve&&(fe=M.exec(Z))&&"px"!==(fe[3]||"px")&&(J.style[k]=Z,Z=l.css(J,k)),dn(0,Z,Ve)}}}),l.cssHooks.marginLeft=_i(S.reliableMarginLeft,function(g,k){if(k)return(parseFloat(Gi(g,"marginLeft"))||g.getBoundingClientRect().left-gi(g,{marginLeft:0},function(){return g.getBoundingClientRect().left}))+"px"}),l.each({margin:"",padding:"",border:"Width"},function(g,k){l.cssHooks[g+k]={expand:function(J){for(var Z=0,he={},fe="string"==typeof J?J.split(" "):[J];Z<4;Z++)he[g+t[Z]+k]=fe[Z]||fe[Z-2]||fe[0];return he}},"margin"!==g&&(l.cssHooks[g+k].set=dn)}),l.fn.extend({css:function(g,k){return Ze(this,function(J,Z,he){var fe,ve,_e={},De=0;if(Array.isArray(Z)){for(fe=yi(J),ve=Z.length;De<ve;De++)_e[Z[De]]=l.css(J,Z[De],!1,fe);return _e}return void 0!==he?l.style(J,Z,he):l.css(J,Z)},g,k,1<arguments.length)}}),((l.Tween=Pi).prototype={constructor:Pi,init:function(g,k,J,Z,he,fe){this.elem=g,this.prop=J,this.easing=he||l.easing._default,this.options=k,this.start=this.now=this.cur(),this.end=Z,this.unit=fe||(l.cssNumber[J]?"":"px")},cur:function(){var g=Pi.propHooks[this.prop];return g&&g.get?g.get(this):Pi.propHooks._default.get(this)},run:function(g){var k,J=Pi.propHooks[this.prop];return this.pos=k=this.options.duration?l.easing[this.easing](g,this.options.duration*g,0,1,this.options.duration):g,this.now=(this.end-this.start)*k+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),J&&J.set?J.set(this):Pi.propHooks._default.set(this),this}}).init.prototype=Pi.prototype,(Pi.propHooks={_default:{get:function(g){var k;return 1!==g.elem.nodeType||null!=g.elem[g.prop]&&null==g.elem.style[g.prop]?g.elem[g.prop]:(k=l.css(g.elem,g.prop,""))&&"auto"!==k?k:0},set:function(g){l.fx.step[g.prop]?l.fx.step[g.prop](g):1!==g.elem.nodeType||!l.cssHooks[g.prop]&&null==g.elem.style[Di(g.prop)]?g.elem[g.prop]=g.now:l.style(g.elem,g.prop,g.now+g.unit)}}}).scrollTop=Pi.propHooks.scrollLeft={set:function(g){g.elem.nodeType&&g.elem.parentNode&&(g.elem[g.prop]=g.now)}},l.easing={linear:function(g){return g},swing:function(g){return.5-Math.cos(g*Math.PI)/2},_default:"swing"},l.fx=Pi.prototype.init,l.fx.step={};var un,Un,yn,$n,Ln=/^(?:toggle|show|hide)$/,Hi=/queueHooks$/;function Hn(){Un&&(!1===R.hidden&&tt.requestAnimationFrame?tt.requestAnimationFrame(Hn):tt.setTimeout(Hn,l.fx.interval),l.fx.tick())}function Tn(){return tt.setTimeout(function(){un=void 0}),un=Date.now()}function Ui(g,k){var J,Z=0,he={height:g};for(k=k?1:0;Z<4;Z+=2-k)he["margin"+(J=t[Z])]=he["padding"+J]=g;return k&&(he.opacity=he.width=g),he}function Zn(g,k,J){for(var Z,he=(en.tweeners[k]||[]).concat(en.tweeners["*"]),fe=0,ve=he.length;fe<ve;fe++)if(Z=he[fe].call(J,k,g))return Z}function en(g,k,J){var Z,he,fe=0,ve=en.prefilters.length,_e=l.Deferred().always(function(){delete De.elem}),De=function(){if(he)return!1;for(var ot=un||Tn(),Je=Math.max(0,Ve.startTime+Ve.duration-ot),Xe=1-(Je/Ve.duration||0),Te=0,j=Ve.tweens.length;Te<j;Te++)Ve.tweens[Te].run(Xe);return _e.notifyWith(g,[Ve,Xe,Je]),Xe<1&&j?Je:(j||_e.notifyWith(g,[Ve,1,0]),_e.resolveWith(g,[Ve]),!1)},Ve=_e.promise({elem:g,props:l.extend({},k),opts:l.extend(!0,{specialEasing:{},easing:l.easing._default},J),originalProperties:k,originalOptions:J,startTime:un||Tn(),duration:J.duration,tweens:[],createTween:function(ot,Je){var Xe=l.Tween(g,Ve.opts,ot,Je,Ve.opts.specialEasing[ot]||Ve.opts.easing);return Ve.tweens.push(Xe),Xe},stop:function(ot){var Je=0,Xe=ot?Ve.tweens.length:0;if(he)return this;for(he=!0;Je<Xe;Je++)Ve.tweens[Je].run(1);return ot?(_e.notifyWith(g,[Ve,1,0]),_e.resolveWith(g,[Ve,ot])):_e.rejectWith(g,[Ve,ot]),this}}),Ye=Ve.props;for(function(ot,Je){var Xe,Te,j,se,Me;for(Xe in ot)if(j=Je[Te=Ct(Xe)],se=ot[Xe],Array.isArray(se)&&(j=se[1],se=ot[Xe]=se[0]),Xe!==Te&&(ot[Te]=se,delete ot[Xe]),(Me=l.cssHooks[Te])&&"expand"in Me)for(Xe in se=Me.expand(se),delete ot[Te],se)Xe in ot||(ot[Xe]=se[Xe],Je[Xe]=j);else Je[Te]=j}(Ye,Ve.opts.specialEasing);fe<ve;fe++)if(Z=en.prefilters[fe].call(Ve,g,Ye,Ve.opts))return n(Z.stop)&&(l._queueHooks(Ve.elem,Ve.opts.queue).stop=Z.stop.bind(Z)),Z;return l.map(Ye,Zn,Ve),n(Ve.opts.start)&&Ve.opts.start.call(g,Ve),Ve.progress(Ve.opts.progress).done(Ve.opts.done,Ve.opts.complete).fail(Ve.opts.fail).always(Ve.opts.always),l.fx.timer(l.extend(De,{elem:g,anim:Ve,queue:Ve.opts.queue})),Ve}l.Animation=l.extend(en,{tweeners:{"*":[function(g,k){var J=this.createTween(g,k);return m(J.elem,g,M.exec(k),J),J}]},tweener:function(g,k){n(g)?(k=g,g=["*"]):g=g.match(He);for(var J,Z=0,he=g.length;Z<he;Z++)(en.tweeners[J=g[Z]]=en.tweeners[J]||[]).unshift(k)},prefilters:[function(g,k,J){var Z,he,fe,ve,_e,De,Ve,Ye,ot="width"in k||"height"in k,Je=this,Xe={},Te=g.style,j=g.nodeType&&a(g),se=Be.get(g,"fxshow");for(Z in J.queue||(null==(ve=l._queueHooks(g,"fx")).unqueued&&(ve.unqueued=0,_e=ve.empty.fire,ve.empty.fire=function(){ve.unqueued||_e()}),ve.unqueued++,Je.always(function(){Je.always(function(){ve.unqueued--,l.queue(g,"fx").length||ve.empty.fire()})})),k)if(Ln.test(he=k[Z])){if(delete k[Z],fe=fe||"toggle"===he,he===(j?"hide":"show")){if("show"!==he||!se||void 0===se[Z])continue;j=!0}Xe[Z]=se&&se[Z]||l.style(g,Z)}if((De=!l.isEmptyObject(k))||!l.isEmptyObject(Xe))for(Z in ot&&1===g.nodeType&&(J.overflow=[Te.overflow,Te.overflowX,Te.overflowY],null==(Ve=se&&se.display)&&(Ve=Be.get(g,"display")),"none"===(Ye=l.css(g,"display"))&&(Ve?Ye=Ve:(P([g],!0),Ve=g.style.display||Ve,Ye=l.css(g,"display"),P([g]))),("inline"===Ye||"inline-block"===Ye&&null!=Ve)&&"none"===l.css(g,"float")&&(De||(Je.done(function(){Te.display=Ve}),null==Ve&&(Ve="none"===(Ye=Te.display)?"":Ye)),Te.display="inline-block")),J.overflow&&(Te.overflow="hidden",Je.always(function(){Te.overflow=J.overflow[0],Te.overflowX=J.overflow[1],Te.overflowY=J.overflow[2]})),De=!1,Xe)De||(se?"hidden"in se&&(j=se.hidden):se=Be.access(g,"fxshow",{display:Ve}),fe&&(se.hidden=!j),j&&P([g],!0),Je.done(function(){for(Z in j||P([g]),Be.remove(g,"fxshow"),Xe)l.style(g,Z,Xe[Z])})),De=Zn(j?se[Z]:0,Z,Je),Z in se||(se[Z]=De.start,j&&(De.end=De.start,De.start=0))}],prefilter:function(g,k){k?en.prefilters.unshift(g):en.prefilters.push(g)}}),l.speed=function(g,k,J){var Z=g&&"object"==typeof g?l.extend({},g):{complete:J||!J&&k||n(g)&&g,duration:g,easing:J&&k||k&&!n(k)&&k};return l.fx.off?Z.duration=0:"number"!=typeof Z.duration&&(Z.duration=Z.duration in l.fx.speeds?l.fx.speeds[Z.duration]:l.fx.speeds._default),null!=Z.queue&&!0!==Z.queue||(Z.queue="fx"),Z.old=Z.complete,Z.complete=function(){n(Z.old)&&Z.old.call(this),Z.queue&&l.dequeue(this,Z.queue)},Z},l.fn.extend({fadeTo:function(g,k,J,Z){return this.filter(a).css("opacity",0).show().end().animate({opacity:k},g,J,Z)},animate:function(g,k,J,Z){var he=l.isEmptyObject(g),fe=l.speed(k,J,Z),ve=function(){var _e=en(this,l.extend({},g),fe);(he||Be.get(this,"finish"))&&_e.stop(!0)};return ve.finish=ve,he||!1===fe.queue?this.each(ve):this.queue(fe.queue,ve)},stop:function(g,k,J){var Z=function(he){var fe=he.stop;delete he.stop,fe(J)};return"string"!=typeof g&&(J=k,k=g,g=void 0),k&&this.queue(g||"fx",[]),this.each(function(){var he=!0,fe=null!=g&&g+"queueHooks",ve=l.timers,_e=Be.get(this);if(fe)_e[fe]&&_e[fe].stop&&Z(_e[fe]);else for(fe in _e)_e[fe]&&_e[fe].stop&&Hi.test(fe)&&Z(_e[fe]);for(fe=ve.length;fe--;)ve[fe].elem!==this||null!=g&&ve[fe].queue!==g||(ve[fe].anim.stop(J),he=!1,ve.splice(fe,1));!he&&J||l.dequeue(this,g)})},finish:function(g){return!1!==g&&(g=g||"fx"),this.each(function(){var k,J=Be.get(this),Z=J[g+"queue"],he=J[g+"queueHooks"],fe=l.timers,ve=Z?Z.length:0;for(J.finish=!0,l.queue(this,g,[]),he&&he.stop&&he.stop.call(this,!0),k=fe.length;k--;)fe[k].elem===this&&fe[k].queue===g&&(fe[k].anim.stop(!0),fe.splice(k,1));for(k=0;k<ve;k++)Z[k]&&Z[k].finish&&Z[k].finish.call(this);delete J.finish})}}),l.each(["toggle","show","hide"],function(g,k){var J=l.fn[k];l.fn[k]=function(Z,he,fe){return null==Z||"boolean"==typeof Z?J.apply(this,arguments):this.animate(Ui(k,!0),Z,he,fe)}}),l.each({slideDown:Ui("show"),slideUp:Ui("hide"),slideToggle:Ui("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(g,k){l.fn[g]=function(J,Z,he){return this.animate(k,J,Z,he)}}),l.timers=[],l.fx.tick=function(){var g,k=0,J=l.timers;for(un=Date.now();k<J.length;k++)(g=J[k])()||J[k]!==g||J.splice(k--,1);J.length||l.fx.stop(),un=void 0},l.fx.timer=function(g){l.timers.push(g),l.fx.start()},l.fx.interval=13,l.fx.start=function(){Un||(Un=!0,Hn())},l.fx.stop=function(){Un=null},l.fx.speeds={slow:600,fast:200,_default:400},l.fn.delay=function(g,k){return g=l.fx&&l.fx.speeds[g]||g,this.queue(k=k||"fx",function(J,Z){var he=tt.setTimeout(J,g);Z.stop=function(){tt.clearTimeout(he)}})},yn=R.createElement("input"),$n=R.createElement("select").appendChild(R.createElement("option")),yn.type="checkbox",S.checkOn=""!==yn.value,S.optSelected=$n.selected,(yn=R.createElement("input")).value="t",yn.type="radio",S.radioValue="t"===yn.value;var Re,lt=l.expr.attrHandle;l.fn.extend({attr:function(g,k){return Ze(this,l.attr,g,k,1<arguments.length)},removeAttr:function(g){return this.each(function(){l.removeAttr(this,g)})}}),l.extend({attr:function(g,k,J){var Z,he,fe=g.nodeType;if(3!==fe&&8!==fe&&2!==fe)return void 0===g.getAttribute?l.prop(g,k,J):(1===fe&&l.isXMLDoc(g)||(he=l.attrHooks[k.toLowerCase()]||(l.expr.match.bool.test(k)?Re:void 0)),void 0!==J?null===J?void l.removeAttr(g,k):he&&"set"in he&&void 0!==(Z=he.set(g,J,k))?Z:(g.setAttribute(k,J+""),J):he&&"get"in he&&null!==(Z=he.get(g,k))?Z:null==(Z=l.find.attr(g,k))?void 0:Z)},attrHooks:{type:{set:function(g,k){if(!S.radioValue&&"radio"===k&&le(g,"input")){var J=g.value;return g.setAttribute("type",k),J&&(g.value=J),k}}}},removeAttr:function(g,k){var J,Z=0,he=k&&k.match(He);if(he&&1===g.nodeType)for(;J=he[Z++];)g.removeAttribute(J)}}),Re={set:function(g,k,J){return!1===k?l.removeAttr(g,J):g.setAttribute(J,J),J}},l.each(l.expr.match.bool.source.match(/\w+/g),function(g,k){var J=lt[k]||l.find.attr;lt[k]=function(Z,he,fe){var ve,_e,De=he.toLowerCase();return fe||(_e=lt[De],lt[De]=ve,ve=null!=J(Z,he,fe)?De:null,lt[De]=_e),ve}});var It=/^(?:input|select|textarea|button)$/i,it=/^(?:a|area)$/i;function Bt(g){return(g.match(He)||[]).join(" ")}function nt(g){return g.getAttribute&&g.getAttribute("class")||""}function vi(g){return Array.isArray(g)?g:"string"==typeof g&&g.match(He)||[]}l.fn.extend({prop:function(g,k){return Ze(this,l.prop,g,k,1<arguments.length)},removeProp:function(g){return this.each(function(){delete this[l.propFix[g]||g]})}}),l.extend({prop:function(g,k,J){var Z,he,fe=g.nodeType;if(3!==fe&&8!==fe&&2!==fe)return 1===fe&&l.isXMLDoc(g)||(he=l.propHooks[k=l.propFix[k]||k]),void 0!==J?he&&"set"in he&&void 0!==(Z=he.set(g,J,k))?Z:g[k]=J:he&&"get"in he&&null!==(Z=he.get(g,k))?Z:g[k]},propHooks:{tabIndex:{get:function(g){var k=l.find.attr(g,"tabindex");return k?parseInt(k,10):It.test(g.nodeName)||it.test(g.nodeName)&&g.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(l.propHooks.selected={get:function(g){return null},set:function(g){}}),l.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){l.propFix[this.toLowerCase()]=this}),l.fn.extend({addClass:function(g){var k,J,Z,he,fe,ve,_e,De=0;if(n(g))return this.each(function(Ve){l(this).addClass(g.call(this,Ve,nt(this)))});if((k=vi(g)).length)for(;J=this[De++];)if(he=nt(J),Z=1===J.nodeType&&" "+Bt(he)+" "){for(ve=0;fe=k[ve++];)Z.indexOf(" "+fe+" ")<0&&(Z+=fe+" ");he!==(_e=Bt(Z))&&J.setAttribute("class",_e)}return this},removeClass:function(g){var k,J,Z,he,fe,ve,_e,De=0;if(n(g))return this.each(function(Ve){l(this).removeClass(g.call(this,Ve,nt(this)))});if(!arguments.length)return this.attr("class","");if((k=vi(g)).length)for(;J=this[De++];)if(he=nt(J),Z=1===J.nodeType&&" "+Bt(he)+" "){for(ve=0;fe=k[ve++];)for(;-1<Z.indexOf(" "+fe+" ");)Z=Z.replace(" "+fe+" "," ");he!==(_e=Bt(Z))&&J.setAttribute("class",_e)}return this},toggleClass:function(g,k){var J=typeof g,Z="string"===J||Array.isArray(g);return"boolean"==typeof k&&Z?k?this.addClass(g):this.removeClass(g):n(g)?this.each(function(he){l(this).toggleClass(g.call(this,he,nt(this),k),k)}):this.each(function(){var he,fe,ve,_e;if(Z)for(fe=0,ve=l(this),_e=vi(g);he=_e[fe++];)ve.hasClass(he)?ve.removeClass(he):ve.addClass(he);else void 0!==g&&"boolean"!==J||((he=nt(this))&&Be.set(this,"__className__",he),this.setAttribute&&this.setAttribute("class",he||!1===g?"":Be.get(this,"__className__")||""))})},hasClass:function(g){var k,J,Z=0;for(k=" "+g+" ";J=this[Z++];)if(1===J.nodeType&&-1<(" "+Bt(nt(J))+" ").indexOf(k))return!0;return!1}});var di=/\r/g;l.fn.extend({val:function(g){var k,J,Z,he=this[0];return arguments.length?(Z=n(g),this.each(function(fe){var ve;1===this.nodeType&&(null==(ve=Z?g.call(this,fe,l(this).val()):g)?ve="":"number"==typeof ve?ve+="":Array.isArray(ve)&&(ve=l.map(ve,function(_e){return null==_e?"":_e+""})),(k=l.valHooks[this.type]||l.valHooks[this.nodeName.toLowerCase()])&&"set"in k&&void 0!==k.set(this,ve,"value")||(this.value=ve))})):he?(k=l.valHooks[he.type]||l.valHooks[he.nodeName.toLowerCase()])&&"get"in k&&void 0!==(J=k.get(he,"value"))?J:"string"==typeof(J=he.value)?J.replace(di,""):null==J?"":J:void 0}}),l.extend({valHooks:{option:{get:function(g){var k=l.find.attr(g,"value");return null!=k?k:Bt(l.text(g))}},select:{get:function(g){var k,J,Z,he=g.options,fe=g.selectedIndex,ve="select-one"===g.type,_e=ve?null:[],De=ve?fe+1:he.length;for(Z=fe<0?De:ve?fe:0;Z<De;Z++)if(((J=he[Z]).selected||Z===fe)&&!J.disabled&&(!J.parentNode.disabled||!le(J.parentNode,"optgroup"))){if(k=l(J).val(),ve)return k;_e.push(k)}return _e},set:function(g,k){for(var J,Z,he=g.options,fe=l.makeArray(k),ve=he.length;ve--;)((Z=he[ve]).selected=-1<l.inArray(l.valHooks.option.get(Z),fe))&&(J=!0);return J||(g.selectedIndex=-1),fe}}}}),l.each(["radio","checkbox"],function(){l.valHooks[this]={set:function(g,k){if(Array.isArray(k))return g.checked=-1<l.inArray(l(g).val(),k)}},S.checkOn||(l.valHooks[this].get=function(g){return null===g.getAttribute("value")?"on":g.value})}),S.focusin="onfocusin"in tt;var ai=/^(?:focusinfocus|focusoutblur)$/,Mt=function(g){g.stopPropagation()};l.extend(l.event,{trigger:function(g,k,J,Z){var he,fe,ve,_e,De,Ve,Ye,ot,Je=[J||R],Xe=w.call(g,"type")?g.type:g,Te=w.call(g,"namespace")?g.namespace.split("."):[];if(fe=ot=ve=J=J||R,3!==J.nodeType&&8!==J.nodeType&&!ai.test(Xe+l.event.triggered)&&(-1<Xe.indexOf(".")&&(Xe=(Te=Xe.split(".")).shift(),Te.sort()),De=Xe.indexOf(":")<0&&"on"+Xe,(g=g[l.expando]?g:new l.Event(Xe,"object"==typeof g&&g)).isTrigger=Z?2:3,g.namespace=Te.join("."),g.rnamespace=g.namespace?new RegExp("(^|\\.)"+Te.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,g.result=void 0,g.target||(g.target=J),k=null==k?[g]:l.makeArray(k,[g]),Ye=l.event.special[Xe]||{},Z||!Ye.trigger||!1!==Ye.trigger.apply(J,k))){if(!Z&&!Ye.noBubble&&!v(J)){for(ai.test((_e=Ye.delegateType||Xe)+Xe)||(fe=fe.parentNode);fe;fe=fe.parentNode)Je.push(fe),ve=fe;ve===(J.ownerDocument||R)&&Je.push(ve.defaultView||ve.parentWindow||tt)}for(he=0;(fe=Je[he++])&&!g.isPropagationStopped();)ot=fe,g.type=1<he?_e:Ye.bindType||Xe,(Ve=(Be.get(fe,"events")||Object.create(null))[g.type]&&Be.get(fe,"handle"))&&Ve.apply(fe,k),(Ve=De&&fe[De])&&Ve.apply&&et(fe)&&(g.result=Ve.apply(fe,k),!1===g.result&&g.preventDefault());return g.type=Xe,Z||g.isDefaultPrevented()||Ye._default&&!1!==Ye._default.apply(Je.pop(),k)||!et(J)||De&&n(J[Xe])&&!v(J)&&((ve=J[De])&&(J[De]=null),l.event.triggered=Xe,g.isPropagationStopped()&&ot.addEventListener(Xe,Mt),J[Xe](),g.isPropagationStopped()&&ot.removeEventListener(Xe,Mt),l.event.triggered=void 0,ve&&(J[De]=ve)),g.result}},simulate:function(g,k,J){var Z=l.extend(new l.Event,J,{type:g,isSimulated:!0});l.event.trigger(Z,null,k)}}),l.fn.extend({trigger:function(g,k){return this.each(function(){l.event.trigger(g,k,this)})},triggerHandler:function(g,k){var J=this[0];if(J)return l.event.trigger(g,k,J,!0)}}),S.focusin||l.each({focus:"focusin",blur:"focusout"},function(g,k){var J=function(Z){l.event.simulate(k,Z.target,l.event.fix(Z))};l.event.special[k]={setup:function(){var Z=this.ownerDocument||this.document||this,he=Be.access(Z,k);he||Z.addEventListener(g,J,!0),Be.access(Z,k,(he||0)+1)},teardown:function(){var Z=this.ownerDocument||this.document||this,he=Be.access(Z,k)-1;he?Be.access(Z,k,he):(Z.removeEventListener(g,J,!0),Be.remove(Z,k))}}});var Vt=tt.location,Ft={guid:Date.now()},ui=/\?/;l.parseXML=function(g){var k,J;if(!g||"string"!=typeof g)return null;try{k=(new tt.DOMParser).parseFromString(g,"text/xml")}catch(Z){}return J=k&&k.getElementsByTagName("parsererror")[0],k&&!J||l.error("Invalid XML: "+(J?l.map(J.childNodes,function(Z){return Z.textContent}).join("\n"):g)),k};var xn=/\[\]$/,ea=/\r?\n/g,ta=/^(?:submit|button|image|reset|file)$/i,oa=/^(?:input|select|textarea|keygen)/i;function Mn(g,k,J,Z){var he;if(Array.isArray(k))l.each(k,function(fe,ve){J||xn.test(g)?Z(g,ve):Mn(g+"["+("object"==typeof ve&&null!=ve?fe:"")+"]",ve,J,Z)});else if(J||"object"!==f(k))Z(g,k);else for(he in k)Mn(g+"["+he+"]",k[he],J,Z)}l.param=function(g,k){var J,Z=[],he=function(fe,ve){var _e=n(ve)?ve():ve;Z[Z.length]=encodeURIComponent(fe)+"="+encodeURIComponent(null==_e?"":_e)};if(null==g)return"";if(Array.isArray(g)||g.jquery&&!l.isPlainObject(g))l.each(g,function(){he(this.name,this.value)});else for(J in g)Mn(J,g[J],k,he);return Z.join("&")},l.fn.extend({serialize:function(){return l.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var g=l.prop(this,"elements");return g?l.makeArray(g):this}).filter(function(){var g=this.type;return this.name&&!l(this).is(":disabled")&&oa.test(this.nodeName)&&!ta.test(g)&&(this.checked||!K.test(g))}).map(function(g,k){var J=l(this).val();return null==J?null:Array.isArray(J)?l.map(J,function(Z){return{name:k.name,value:Z.replace(ea,"\r\n")}}):{name:k.name,value:J.replace(ea,"\r\n")}}).get()}});var Wn=/%20/g,Jn=/#.*$/,zn=/([?&])_=[^&]*/,ia=/^(.*?):[ \t]*([^\r\n]*)$/gm,sa=/^(?:GET|HEAD)$/,Ea=/^\/\//,ha={},Yn={},na="*/".concat("*"),pa=R.createElement("a");function hn(g){return function(k,J){"string"!=typeof k&&(J=k,k="*");var Z,he=0,fe=k.toLowerCase().match(He)||[];if(n(J))for(;Z=fe[he++];)"+"===Z[0]?(Z=Z.slice(1)||"*",(g[Z]=g[Z]||[]).unshift(J)):(g[Z]=g[Z]||[]).push(J)}}function fa(g,k,J,Z){var he={},fe=g===Yn;function ve(_e){var De;return he[_e]=!0,l.each(g[_e]||[],function(Ve,Ye){var ot=Ye(k,J,Z);return"string"!=typeof ot||fe||he[ot]?fe?!(De=ot):void 0:(k.dataTypes.unshift(ot),ve(ot),!1)}),De}return ve(k.dataTypes[0])||!he["*"]&&ve("*")}function Ca(g,k){var J,Z,he=l.ajaxSettings.flatOptions||{};for(J in k)void 0!==k[J]&&((he[J]?g:Z||(Z={}))[J]=k[J]);return Z&&l.extend(!0,g,Z),g}pa.href=Vt.href,l.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Vt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Vt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":na,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":l.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(g,k){return k?Ca(Ca(g,l.ajaxSettings),k):Ca(l.ajaxSettings,g)},ajaxPrefilter:hn(ha),ajaxTransport:hn(Yn),ajax:function(g,k){"object"==typeof g&&(k=g,g=void 0);var J,Z,he,fe,ve,_e,De,Ve,Ye,ot,Je=l.ajaxSetup({},k=k||{}),Xe=Je.context||Je,Te=Je.context&&(Xe.nodeType||Xe.jquery)?l(Xe):l.event,j=l.Deferred(),se=l.Callbacks("once memory"),Me=Je.statusCode||{},Le={},$e={},mt="canceled",St={readyState:0,getResponseHeader:function(Ht){var Qt;if(De){if(!fe)for(fe={};Qt=ia.exec(he);)fe[Qt[1].toLowerCase()+" "]=(fe[Qt[1].toLowerCase()+" "]||[]).concat(Qt[2]);Qt=fe[Ht.toLowerCase()+" "]}return null==Qt?null:Qt.join(", ")},getAllResponseHeaders:function(){return De?he:null},setRequestHeader:function(Ht,Qt){return null==De&&(Ht=$e[Ht.toLowerCase()]=$e[Ht.toLowerCase()]||Ht,Le[Ht]=Qt),this},overrideMimeType:function(Ht){return null==De&&(Je.mimeType=Ht),this},statusCode:function(Ht){var Qt;if(Ht)if(De)St.always(Ht[St.status]);else for(Qt in Ht)Me[Qt]=[Me[Qt],Ht[Qt]];return this},abort:function(Ht){var Qt=Ht||mt;return J&&J.abort(Qt),Xt(0,Qt),this}};if(j.promise(St),Je.url=((g||Je.url||Vt.href)+"").replace(Ea,Vt.protocol+"//"),Je.type=k.method||k.type||Je.method||Je.type,Je.dataTypes=(Je.dataType||"*").toLowerCase().match(He)||[""],null==Je.crossDomain){_e=R.createElement("a");try{_e.href=Je.url,_e.href=_e.href,Je.crossDomain=pa.protocol+"//"+pa.host!=_e.protocol+"//"+_e.host}catch(Ht){Je.crossDomain=!0}}if(Je.data&&Je.processData&&"string"!=typeof Je.data&&(Je.data=l.param(Je.data,Je.traditional)),fa(ha,Je,k,St),De)return St;for(Ye in(Ve=l.event&&Je.global)&&0==l.active++&&l.event.trigger("ajaxStart"),Je.type=Je.type.toUpperCase(),Je.hasContent=!sa.test(Je.type),Z=Je.url.replace(Jn,""),Je.hasContent?Je.data&&Je.processData&&0===(Je.contentType||"").indexOf("application/x-www-form-urlencoded")&&(Je.data=Je.data.replace(Wn,"+")):(ot=Je.url.slice(Z.length),Je.data&&(Je.processData||"string"==typeof Je.data)&&(Z+=(ui.test(Z)?"&":"?")+Je.data,delete Je.data),!1===Je.cache&&(Z=Z.replace(zn,"$1"),ot=(ui.test(Z)?"&":"?")+"_="+Ft.guid+++ot),Je.url=Z+ot),Je.ifModified&&(l.lastModified[Z]&&St.setRequestHeader("If-Modified-Since",l.lastModified[Z]),l.etag[Z]&&St.setRequestHeader("If-None-Match",l.etag[Z])),(Je.data&&Je.hasContent&&!1!==Je.contentType||k.contentType)&&St.setRequestHeader("Content-Type",Je.contentType),St.setRequestHeader("Accept",Je.dataTypes[0]&&Je.accepts[Je.dataTypes[0]]?Je.accepts[Je.dataTypes[0]]+("*"!==Je.dataTypes[0]?", "+na+"; q=0.01":""):Je.accepts["*"]),Je.headers)St.setRequestHeader(Ye,Je.headers[Ye]);if(Je.beforeSend&&(!1===Je.beforeSend.call(Xe,St,Je)||De))return St.abort();if(mt="abort",se.add(Je.complete),St.done(Je.success),St.fail(Je.error),J=fa(Yn,Je,k,St)){if(St.readyState=1,Ve&&Te.trigger("ajaxSend",[St,Je]),De)return St;Je.async&&0<Je.timeout&&(ve=tt.setTimeout(function(){St.abort("timeout")},Je.timeout));try{De=!1,J.send(Le,Xt)}catch(Ht){if(De)throw Ht;Xt(-1,Ht)}}else Xt(-1,"No Transport");function Xt(Ht,Qt,li,Li){var bi,Vi,$t,wi,Dt,ii=Qt;De||(De=!0,ve&&tt.clearTimeout(ve),J=void 0,he=Li||"",St.readyState=0<Ht?4:0,bi=200<=Ht&&Ht<300||304===Ht,li&&(wi=function(hi,tn,In){for(var An,Zt,Si,Ei,pn=hi.contents,Fi=hi.dataTypes;"*"===Fi[0];)Fi.shift(),void 0===An&&(An=hi.mimeType||tn.getResponseHeader("Content-Type"));if(An)for(Zt in pn)if(pn[Zt]&&pn[Zt].test(An)){Fi.unshift(Zt);break}if(Fi[0]in In)Si=Fi[0];else{for(Zt in In){if(!Fi[0]||hi.converters[Zt+" "+Fi[0]]){Si=Zt;break}Ei||(Ei=Zt)}Si=Si||Ei}if(Si)return Si!==Fi[0]&&Fi.unshift(Si),In[Si]}(Je,St,li)),!bi&&-1<l.inArray("script",Je.dataTypes)&&l.inArray("json",Je.dataTypes)<0&&(Je.converters["text script"]=function(){}),wi=function(hi,tn,In,An){var Zt,Si,Ei,pn,Fi,fn={},ga=hi.dataTypes.slice();if(ga[1])for(Ei in hi.converters)fn[Ei.toLowerCase()]=hi.converters[Ei];for(Si=ga.shift();Si;)if(hi.responseFields[Si]&&(In[hi.responseFields[Si]]=tn),!Fi&&An&&hi.dataFilter&&(tn=hi.dataFilter(tn,hi.dataType)),Fi=Si,Si=ga.shift())if("*"===Si)Si=Fi;else if("*"!==Fi&&Fi!==Si){if(!(Ei=fn[Fi+" "+Si]||fn["* "+Si]))for(Zt in fn)if((pn=Zt.split(" "))[1]===Si&&(Ei=fn[Fi+" "+pn[0]]||fn["* "+pn[0]])){!0===Ei?Ei=fn[Zt]:!0!==fn[Zt]&&(Si=pn[0],ga.unshift(pn[1]));break}if(!0!==Ei)if(Ei&&hi.throws)tn=Ei(tn);else try{tn=Ei(tn)}catch(ca){return{state:"parsererror",error:Ei?ca:"No conversion from "+Fi+" to "+Si}}}return{state:"success",data:tn}}(Je,wi,St,bi),bi?(Je.ifModified&&((Dt=St.getResponseHeader("Last-Modified"))&&(l.lastModified[Z]=Dt),(Dt=St.getResponseHeader("etag"))&&(l.etag[Z]=Dt)),204===Ht||"HEAD"===Je.type?ii="nocontent":304===Ht?ii="notmodified":(ii=wi.state,Vi=wi.data,bi=!($t=wi.error))):($t=ii,!Ht&&ii||(ii="error",Ht<0&&(Ht=0))),St.status=Ht,St.statusText=(Qt||ii)+"",bi?j.resolveWith(Xe,[Vi,ii,St]):j.rejectWith(Xe,[St,ii,$t]),St.statusCode(Me),Me=void 0,Ve&&Te.trigger(bi?"ajaxSuccess":"ajaxError",[St,Je,bi?Vi:$t]),se.fireWith(Xe,[St,ii]),Ve&&(Te.trigger("ajaxComplete",[St,Je]),--l.active||l.event.trigger("ajaxStop")))}return St},getJSON:function(g,k,J){return l.get(g,k,J,"json")},getScript:function(g,k){return l.get(g,void 0,k,"script")}}),l.each(["get","post"],function(g,k){l[k]=function(J,Z,he,fe){return n(Z)&&(fe=fe||he,he=Z,Z=void 0),l.ajax(l.extend({url:J,type:k,dataType:fe,data:Z,success:he},l.isPlainObject(J)&&J))}}),l.ajaxPrefilter(function(g){var k;for(k in g.headers)"content-type"===k.toLowerCase()&&(g.contentType=g.headers[k]||"")}),l._evalUrl=function(g,k,J){return l.ajax({url:g,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(Z){l.globalEval(Z,k,J)}})},l.fn.extend({wrapAll:function(g){var k;return this[0]&&(n(g)&&(g=g.call(this[0])),k=l(g,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&k.insertBefore(this[0]),k.map(function(){for(var J=this;J.firstElementChild;)J=J.firstElementChild;return J}).append(this)),this},wrapInner:function(g){return n(g)?this.each(function(k){l(this).wrapInner(g.call(this,k))}):this.each(function(){var k=l(this),J=k.contents();J.length?J.wrapAll(g):k.append(g)})},wrap:function(g){var k=n(g);return this.each(function(J){l(this).wrapAll(k?g.call(this,J):g)})},unwrap:function(g){return this.parent(g).not("body").each(function(){l(this).replaceWith(this.childNodes)}),this}}),l.expr.pseudos.hidden=function(g){return!l.expr.pseudos.visible(g)},l.expr.pseudos.visible=function(g){return!!(g.offsetWidth||g.offsetHeight||g.getClientRects().length)},l.ajaxSettings.xhr=function(){try{return new tt.XMLHttpRequest}catch(g){}};var ba={0:200,1223:204},jn=l.ajaxSettings.xhr();S.cors=!!jn&&"withCredentials"in jn,S.ajax=jn=!!jn,l.ajaxTransport(function(g){var k,J;if(S.cors||jn&&!g.crossDomain)return{send:function(Z,he){var fe,ve=g.xhr();if(ve.open(g.type,g.url,g.async,g.username,g.password),g.xhrFields)for(fe in g.xhrFields)ve[fe]=g.xhrFields[fe];for(fe in g.mimeType&&ve.overrideMimeType&&ve.overrideMimeType(g.mimeType),g.crossDomain||Z["X-Requested-With"]||(Z["X-Requested-With"]="XMLHttpRequest"),Z)ve.setRequestHeader(fe,Z[fe]);k=function(_e){return function(){k&&(k=J=ve.onload=ve.onerror=ve.onabort=ve.ontimeout=ve.onreadystatechange=null,"abort"===_e?ve.abort():"error"===_e?"number"!=typeof ve.status?he(0,"error"):he(ve.status,ve.statusText):he(ba[ve.status]||ve.status,ve.statusText,"text"!==(ve.responseType||"text")||"string"!=typeof ve.responseText?{binary:ve.response}:{text:ve.responseText},ve.getAllResponseHeaders()))}},ve.onload=k(),J=ve.onerror=ve.ontimeout=k("error"),void 0!==ve.onabort?ve.onabort=J:ve.onreadystatechange=function(){4===ve.readyState&&tt.setTimeout(function(){k&&J()})},k=k("abort");try{ve.send(g.hasContent&&g.data||null)}catch(_e){if(k)throw _e}},abort:function(){k&&k()}}}),l.ajaxPrefilter(function(g){g.crossDomain&&(g.contents.script=!1)}),l.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(g){return l.globalEval(g),g}}}),l.ajaxPrefilter("script",function(g){void 0===g.cache&&(g.cache=!1),g.crossDomain&&(g.type="GET")}),l.ajaxTransport("script",function(g){var k,J;if(g.crossDomain||g.scriptAttrs)return{send:function(Z,he){k=l("<script>").attr(g.scriptAttrs||{}).prop({charset:g.scriptCharset,src:g.url}).on("load error",J=function(fe){k.remove(),J=null,fe&&he("error"===fe.type?404:200,fe.type)}),R.head.appendChild(k[0])},abort:function(){J&&J()}}});var aa,la=[],Vn=/(=)\?(?=&|$)|\?\?/;l.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var g=la.pop()||l.expando+"_"+Ft.guid++;return this[g]=!0,g}}),l.ajaxPrefilter("json jsonp",function(g,k,J){var Z,he,fe,ve=!1!==g.jsonp&&(Vn.test(g.url)?"url":"string"==typeof g.data&&0===(g.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vn.test(g.data)&&"data");if(ve||"jsonp"===g.dataTypes[0])return Z=g.jsonpCallback=n(g.jsonpCallback)?g.jsonpCallback():g.jsonpCallback,ve?g[ve]=g[ve].replace(Vn,"$1"+Z):!1!==g.jsonp&&(g.url+=(ui.test(g.url)?"&":"?")+g.jsonp+"="+Z),g.converters["script json"]=function(){return fe||l.error(Z+" was not called"),fe[0]},g.dataTypes[0]="json",he=tt[Z],tt[Z]=function(){fe=arguments},J.always(function(){void 0===he?l(tt).removeProp(Z):tt[Z]=he,g[Z]&&(g.jsonpCallback=k.jsonpCallback,la.push(Z)),fe&&n(he)&&he(fe[0]),fe=he=void 0}),"script"}),S.createHTMLDocument=((aa=R.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===aa.childNodes.length),l.parseHTML=function(g,k,J){return"string"!=typeof g?[]:("boolean"==typeof k&&(J=k,k=!1),k||(S.createHTMLDocument?((Z=(k=R.implementation.createHTMLDocument("")).createElement("base")).href=R.location.href,k.head.appendChild(Z)):k=R),fe=!J&&[],(he=W.exec(g))?[k.createElement(he[1])]:(he=ge([g],k,fe),fe&&fe.length&&l(fe).remove(),l.merge([],he.childNodes)));var Z,he,fe},l.fn.load=function(g,k,J){var Z,he,fe,ve=this,_e=g.indexOf(" ");return-1<_e&&(Z=Bt(g.slice(_e)),g=g.slice(0,_e)),n(k)?(J=k,k=void 0):k&&"object"==typeof k&&(he="POST"),0<ve.length&&l.ajax({url:g,type:he||"GET",dataType:"html",data:k}).done(function(De){fe=arguments,ve.html(Z?l("<div>").append(l.parseHTML(De)).find(Z):De)}).always(J&&function(De,Ve){ve.each(function(){J.apply(this,fe||[De.responseText,Ve,De])})}),this},l.expr.pseudos.animated=function(g){return l.grep(l.timers,function(k){return g===k.elem}).length},l.offset={setOffset:function(g,k,J){var Z,he,fe,ve,_e,De,Ve=l.css(g,"position"),Ye=l(g),ot={};"static"===Ve&&(g.style.position="relative"),_e=Ye.offset(),fe=l.css(g,"top"),De=l.css(g,"left"),("absolute"===Ve||"fixed"===Ve)&&-1<(fe+De).indexOf("auto")?(ve=(Z=Ye.position()).top,he=Z.left):(ve=parseFloat(fe)||0,he=parseFloat(De)||0),n(k)&&(k=k.call(g,J,l.extend({},_e))),null!=k.top&&(ot.top=k.top-_e.top+ve),null!=k.left&&(ot.left=k.left-_e.left+he),"using"in k?k.using.call(g,ot):Ye.css(ot)}},l.fn.extend({offset:function(g){if(arguments.length)return void 0===g?this:this.each(function(he){l.offset.setOffset(this,g,he)});var k,J,Z=this[0];return Z?Z.getClientRects().length?{top:(k=Z.getBoundingClientRect()).top+(J=Z.ownerDocument.defaultView).pageYOffset,left:k.left+J.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var g,k,J,Z=this[0],he={top:0,left:0};if("fixed"===l.css(Z,"position"))k=Z.getBoundingClientRect();else{for(k=this.offset(),J=Z.ownerDocument,g=Z.offsetParent||J.documentElement;g&&(g===J.body||g===J.documentElement)&&"static"===l.css(g,"position");)g=g.parentNode;g&&g!==Z&&1===g.nodeType&&((he=l(g).offset()).top+=l.css(g,"borderTopWidth",!0),he.left+=l.css(g,"borderLeftWidth",!0))}return{top:k.top-he.top-l.css(Z,"marginTop",!0),left:k.left-he.left-l.css(Z,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var g=this.offsetParent;g&&"static"===l.css(g,"position");)g=g.offsetParent;return g||u})}}),l.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(g,k){var J="pageYOffset"===k;l.fn[g]=function(Z){return Ze(this,function(he,fe,ve){var _e;if(v(he)?_e=he:9===he.nodeType&&(_e=he.defaultView),void 0===ve)return _e?_e[k]:he[fe];_e?_e.scrollTo(J?_e.pageXOffset:ve,J?ve:_e.pageYOffset):he[fe]=ve},g,Z,arguments.length)}}),l.each(["top","left"],function(g,k){l.cssHooks[k]=_i(S.pixelPosition,function(J,Z){if(Z)return Z=Gi(J,k),Ai.test(Z)?l(J).position()[k]+"px":Z})}),l.each({Height:"height",Width:"width"},function(g,k){l.each({padding:"inner"+g,content:k,"":"outer"+g},function(J,Z){l.fn[Z]=function(he,fe){var ve=arguments.length&&(J||"boolean"!=typeof he),_e=J||(!0===he||!0===fe?"margin":"border");return Ze(this,function(De,Ve,Ye){var ot;return v(De)?0===Z.indexOf("outer")?De["inner"+g]:De.document.documentElement["client"+g]:9===De.nodeType?(ot=De.documentElement,Math.max(De.body["scroll"+g],ot["scroll"+g],De.body["offset"+g],ot["offset"+g],ot["client"+g])):void 0===Ye?l.css(De,Ve,_e):l.style(De,Ve,Ye,_e)},k,ve?he:void 0,ve)}})}),l.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(g,k){l.fn[k]=function(J){return this.on(k,J)}}),l.fn.extend({bind:function(g,k,J){return this.on(g,null,k,J)},unbind:function(g,k){return this.off(g,null,k)},delegate:function(g,k,J,Z){return this.on(k,g,J,Z)},undelegate:function(g,k,J){return 1===arguments.length?this.off(g,"**"):this.off(k,g||"**",J)},hover:function(g,k){return this.mouseenter(g).mouseleave(k||g)}}),l.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(g,k){l.fn[k]=function(J,Z){return 0<arguments.length?this.on(k,null,J,Z):this.trigger(k)}});var Fn=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;l.proxy=function(g,k){var J,Z,he;if("string"==typeof k&&(J=g[k],k=g,g=J),n(g))return Z=Y.call(arguments,2),(he=function(){return g.apply(k||this,Z.concat(Y.call(arguments)))}).guid=g.guid=g.guid||l.guid++,he},l.holdReady=function(g){g?l.readyWait++:l.ready(!0)},l.isArray=Array.isArray,l.parseJSON=JSON.parse,l.nodeName=le,l.isFunction=n,l.isWindow=v,l.camelCase=Ct,l.type=f,l.now=Date.now,l.isNumeric=function(g){var k=l.type(g);return("number"===k||"string"===k)&&!isNaN(g-parseFloat(g))},l.trim=function(g){return null==g?"":(g+"").replace(Fn,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return l});var ya=tt.jQuery,ma=tt.$;return l.noConflict=function(g){return tt.$===l&&(tt.$=ma),g&&tt.jQuery===l&&(tt.jQuery=ya),l},void 0===Wt&&(tt.jQuery=tt.$=l),l}),function(tt,Wt){"object"==typeof exports&&"undefined"!=typeof module?module.exports=Wt(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],Wt):(tt="undefined"!=typeof globalThis?globalThis:tt||self).bootstrap=Wt(tt.Popper)}(this,function(tt){"use strict";const Ke=function(Te){if(Te&&Te.__esModule)return Te;const j=Object.create(null);if(Te)for(const se in Te)if("default"!==se){const Me=Object.getOwnPropertyDescriptor(Te,se);Object.defineProperty(j,se,Me.get?Me:{enumerable:!0,get:()=>Te[se]})}return j.default=Te,Object.freeze(j)}(tt),F="transitionend",Y=Te=>{let j=Te.getAttribute("data-bs-target");if(!j||"#"===j){let se=Te.getAttribute("href");if(!se||!se.includes("#")&&!se.startsWith("."))return null;se.includes("#")&&!se.startsWith("#")&&(se=`#${se.split("#")[1]}`),j=se&&"#"!==se?se.trim():null}return j},e=Te=>{const j=Y(Te);return j&&document.querySelector(j)?j:null},i=Te=>{const j=Y(Te);return j?document.querySelector(j):null},c=Te=>{Te.dispatchEvent(new Event(F))},d=Te=>!(!Te||"object"!=typeof Te)&&(void 0!==Te.jquery&&(Te=Te[0]),void 0!==Te.nodeType),L=Te=>d(Te)?Te.jquery?Te[0]:Te:"string"==typeof Te&&Te.length>0?document.querySelector(Te):null,w=(Te,j,se)=>{Object.keys(se).forEach(Me=>{const Le=se[Me],$e=j[Me],mt=$e&&d($e)?"element":null==(St=$e)?`${St}`:{}.toString.call(St).match(/\s([a-z]+)/i)[1].toLowerCase();var St;if(!new RegExp(Le).test(mt))throw new TypeError(`${Te.toUpperCase()}: Option "${Me}" provided type "${mt}" but expected type "${Le}".`)})},A=Te=>!(!d(Te)||0===Te.getClientRects().length)&&"visible"===getComputedStyle(Te).getPropertyValue("visibility"),C=Te=>!Te||Te.nodeType!==Node.ELEMENT_NODE||!!Te.classList.contains("disabled")||(void 0!==Te.disabled?Te.disabled:Te.hasAttribute("disabled")&&"false"!==Te.getAttribute("disabled")),S=Te=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof Te.getRootNode){const j=Te.getRootNode();return j instanceof ShadowRoot?j:null}return Te instanceof ShadowRoot?Te:Te.parentNode?S(Te.parentNode):null},n=()=>{},R=()=>{const{jQuery:Te}=window;return Te&&!document.body.hasAttribute("data-bs-no-jquery")?Te:null},p=[],o=()=>"rtl"===document.documentElement.dir,f=Te=>{var j;j=()=>{const se=R();if(se){const Me=Te.NAME,Le=se.fn[Me];se.fn[Me]=Te.jQueryInterface,se.fn[Me].Constructor=Te,se.fn[Me].noConflict=()=>(se.fn[Me]=Le,Te.jQueryInterface)}},"loading"===document.readyState?(p.length||document.addEventListener("DOMContentLoaded",()=>{p.forEach(se=>se())}),p.push(j)):j()},I=Te=>{"function"==typeof Te&&Te()},l=(Te,j,se=!0)=>{if(!se)return void I(Te);const Me=(mt=>{if(!mt)return 0;let{transitionDuration:St,transitionDelay:Xt}=window.getComputedStyle(mt);const Ht=Number.parseFloat(St),Qt=Number.parseFloat(Xt);return Ht||Qt?(St=St.split(",")[0],Xt=Xt.split(",")[0],1e3*(Number.parseFloat(St)+Number.parseFloat(Xt))):0})(j)+5;let Le=!1;const $e=({target:mt})=>{mt===j&&(Le=!0,j.removeEventListener(F,$e),I(Te))};j.addEventListener(F,$e),setTimeout(()=>{Le||c(j)},Me)},V=(Te,j,se,Me)=>{let Le=Te.indexOf(j);if(-1===Le)return Te[!se&&Me?Te.length-1:0];const $e=Te.length;return Le+=se?1:-1,Me&&(Le=(Le+$e)%$e),Te[Math.max(0,Math.min(Le,$e-1))]},T=/[^.]*(?=\..*)\.|.*/,b=/\..*/,H=/::\d+$/,ne={};let le=1;const W={mouseenter:"mouseover",mouseleave:"mouseout"},be=/^(mouseenter|mouseleave)/i,de=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function ce(Te,j){return j&&`${j}::${le++}`||Te.uidEvent||le++}function Ee(Te){const j=ce(Te);return Te.uidEvent=j,ne[j]=ne[j]||{},ne[j]}function Ne(Te,j,se=null){const Me=Object.keys(Te);for(let Le=0,$e=Me.length;Le<$e;Le++){const mt=Te[Me[Le]];if(mt.originalHandler===j&&mt.delegationSelector===se)return mt}return null}function Oe(Te,j,se){const Me="string"==typeof j,Le=Me?se:j;let $e=ze(Te);return de.has($e)||($e=Te),[Me,Le,$e]}function He(Te,j,se,Me,Le){if("string"!=typeof j||!Te)return;if(se||(se=Me,Me=null),be.test(j)){const bi=Vi=>function($t){if(!$t.relatedTarget||$t.relatedTarget!==$t.delegateTarget&&!$t.delegateTarget.contains($t.relatedTarget))return Vi.call(this,$t)};Me?Me=bi(Me):se=bi(se)}const[$e,mt,St]=Oe(j,se,Me),Xt=Ee(Te),Ht=Xt[St]||(Xt[St]={}),Qt=Ne(Ht,mt,$e?se:null);if(Qt)return void(Qt.oneOff=Qt.oneOff&&Le);const li=ce(mt,j.replace(T,"")),Li=$e?(bi=Te,Vi=se,$t=Me,function wi(Dt){const ii=bi.querySelectorAll(Vi);for(let{target:hi}=Dt;hi&&hi!==this;hi=hi.parentNode)for(let tn=ii.length;tn--;)if(ii[tn]===hi)return Dt.delegateTarget=hi,wi.oneOff&&we.off(bi,Dt.type,Vi,$t),$t.apply(hi,[Dt]);return null}):function(bi,Vi){return function $t(wi){return wi.delegateTarget=bi,$t.oneOff&&we.off(bi,wi.type,Vi),Vi.apply(bi,[wi])}}(Te,se);var bi,Vi,$t;Li.delegationSelector=$e?se:null,Li.originalHandler=mt,Li.oneOff=Le,Li.uidEvent=li,Ht[li]=Li,Te.addEventListener(St,Li,$e)}function ke(Te,j,se,Me,Le){const $e=Ne(j[se],Me,Le);$e&&(Te.removeEventListener(se,$e,Boolean(Le)),delete j[se][$e.uidEvent])}function ze(Te){return Te=Te.replace(b,""),W[Te]||Te}const we={on(Te,j,se,Me){He(Te,j,se,Me,!1)},one(Te,j,se,Me){He(Te,j,se,Me,!0)},off(Te,j,se,Me){if("string"!=typeof j||!Te)return;const[Le,$e,mt]=Oe(j,se,Me),St=mt!==j,Xt=Ee(Te),Ht=j.startsWith(".");if(void 0!==$e)return Xt&&Xt[mt]?void ke(Te,Xt,mt,$e,Le?se:null):void 0;Ht&&Object.keys(Xt).forEach(li=>{!function(Li,bi,Vi,$t){const wi=bi[Vi]||{};Object.keys(wi).forEach(Dt=>{if(Dt.includes($t)){const ii=wi[Dt];ke(Li,bi,Vi,ii.originalHandler,ii.delegationSelector)}})}(Te,Xt,li,j.slice(1))});const Qt=Xt[mt]||{};Object.keys(Qt).forEach(li=>{const Li=li.replace(H,"");if(!St||j.includes(Li)){const bi=Qt[li];ke(Te,Xt,mt,bi.originalHandler,bi.delegationSelector)}})},trigger(Te,j,se){if("string"!=typeof j||!Te)return null;const Me=R(),Le=ze(j),$e=j!==Le,mt=de.has(Le);let St,Xt=!0,Ht=!0,Qt=!1,li=null;return $e&&Me&&(St=Me.Event(j,se),Me(Te).trigger(St),Xt=!St.isPropagationStopped(),Ht=!St.isImmediatePropagationStopped(),Qt=St.isDefaultPrevented()),mt?(li=document.createEvent("HTMLEvents"),li.initEvent(Le,Xt,!0)):li=new CustomEvent(j,{bubbles:Xt,cancelable:!0}),void 0!==se&&Object.keys(se).forEach(Li=>{Object.defineProperty(li,Li,{get:()=>se[Li]})}),Qt&&li.preventDefault(),Ht&&Te.dispatchEvent(li),li.defaultPrevented&&void 0!==St&&St.preventDefault(),li}},gt=new Map,ft={set(Te,j,se){gt.has(Te)||gt.set(Te,new Map);const Me=gt.get(Te);Me.has(j)||0===Me.size?Me.set(j,se):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Me.keys())[0]}.`)},get:(Te,j)=>gt.has(Te)&&gt.get(Te).get(j)||null,remove(Te,j){if(!gt.has(Te))return;const se=gt.get(Te);se.delete(j),0===se.size&&gt.delete(Te)}};class at{constructor(j){(j=L(j))&&(this._element=j,ft.set(this._element,this.constructor.DATA_KEY,this))}dispose(){ft.remove(this._element,this.constructor.DATA_KEY),we.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this).forEach(j=>{this[j]=null})}_queueCallback(j,se,Me=!0){l(j,se,Me)}static getInstance(j){return ft.get(L(j),this.DATA_KEY)}static getOrCreateInstance(j,se={}){return this.getInstance(j)||new this(j,"object"==typeof se?se:null)}static get VERSION(){return"5.1.3"}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}}const Ze=(Te,j="hide")=>{const Me=Te.NAME;we.on(document,`click.dismiss${Te.EVENT_KEY}`,`[data-bs-dismiss="${Me}"]`,function(Le){if(["A","AREA"].includes(this.tagName)&&Le.preventDefault(),C(this))return;const $e=i(this)||this.closest(`.${Me}`);Te.getOrCreateInstance($e)[j]()})};class ie extends at{static get NAME(){return"alert"}close(){if(we.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const j=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,j)}_destroyElement(){this._element.remove(),we.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(j){return this.each(function(){const se=ie.getOrCreateInstance(this);if("string"==typeof j){if(void 0===se[j]||j.startsWith("_")||"constructor"===j)throw new TypeError(`No method named "${j}"`);se[j](this)}})}}Ze(ie,"close"),f(ie);const bt='[data-bs-toggle="button"]';class Rt extends at{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(j){return this.each(function(){const se=Rt.getOrCreateInstance(this);"toggle"===j&&se[j]()})}}function Ct(Te){return"true"===Te||"false"!==Te&&(Te===Number(Te).toString()?Number(Te):""===Te||"null"===Te?null:Te)}function et(Te){return Te.replace(/[A-Z]/g,j=>`-${j.toLowerCase()}`)}we.on(document,"click.bs.button.data-api",bt,Te=>{Te.preventDefault();const j=Te.target.closest(bt);Rt.getOrCreateInstance(j).toggle()}),f(Rt);const wt={setDataAttribute(Te,j,se){Te.setAttribute(`data-bs-${et(j)}`,se)},removeDataAttribute(Te,j){Te.removeAttribute(`data-bs-${et(j)}`)},getDataAttributes(Te){if(!Te)return{};const j={};return Object.keys(Te.dataset).filter(se=>se.startsWith("bs")).forEach(se=>{let Me=se.replace(/^bs/,"");Me=Me.charAt(0).toLowerCase()+Me.slice(1,Me.length),j[Me]=Ct(Te.dataset[se])}),j},getDataAttribute:(Te,j)=>Ct(Te.getAttribute(`data-bs-${et(j)}`)),offset(Te){const j=Te.getBoundingClientRect();return{top:j.top+window.pageYOffset,left:j.left+window.pageXOffset}},position:Te=>({top:Te.offsetTop,left:Te.offsetLeft})},Be={find:(Te,j=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(j,Te)),findOne:(Te,j=document.documentElement)=>Element.prototype.querySelector.call(j,Te),children:(Te,j)=>[].concat(...Te.children).filter(se=>se.matches(j)),parents(Te,j){const se=[];let Me=Te.parentNode;for(;Me&&Me.nodeType===Node.ELEMENT_NODE&&3!==Me.nodeType;)Me.matches(j)&&se.push(Me),Me=Me.parentNode;return se},prev(Te,j){let se=Te.previousElementSibling;for(;se;){if(se.matches(j))return[se];se=se.previousElementSibling}return[]},next(Te,j){let se=Te.nextElementSibling;for(;se;){if(se.matches(j))return[se];se=se.nextElementSibling}return[]},focusableChildren(Te){const j=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(se=>`${se}:not([tabindex^="-"])`).join(", ");return this.find(j,Te).filter(se=>!C(se)&&A(se))}},Lt="carousel",jt={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},Ge={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},Pt="next",z="prev",M="left",t="right",u={ArrowLeft:t,ArrowRight:M},h="slid.bs.carousel",y="active",a=".active.carousel-item";class m extends at{constructor(j,se){super(j),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(se),this._indicatorsElement=Be.findOne(".carousel-indicators",this._element),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent),this._addEventListeners()}static get Default(){return jt}static get NAME(){return Lt}next(){this._slide(Pt)}nextWhenVisible(){!document.hidden&&A(this._element)&&this.next()}prev(){this._slide(z)}pause(j){j||(this._isPaused=!0),Be.findOne(".carousel-item-next, .carousel-item-prev",this._element)&&(c(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}cycle(j){j||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config&&this._config.interval&&!this._isPaused&&(this._updateInterval(),this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}to(j){this._activeElement=Be.findOne(a,this._element);const se=this._getItemIndex(this._activeElement);if(!(j>this._items.length-1||j<0)){if(!this._isSliding)return se===j?(this.pause(),void this.cycle()):void this._slide(j>se?Pt:z,this._items[j]);we.one(this._element,h,()=>this.to(j))}}_getConfig(j){return j=si(si(si({},jt),wt.getDataAttributes(this._element)),"object"==typeof j?j:{}),w(Lt,j,Ge),j}_handleSwipe(){const j=Math.abs(this.touchDeltaX);if(j<=40)return;const se=j/this.touchDeltaX;this.touchDeltaX=0,se&&this._slide(se>0?t:M)}_addEventListeners(){this._config.keyboard&&we.on(this._element,"keydown.bs.carousel",j=>this._keydown(j)),"hover"===this._config.pause&&(we.on(this._element,"mouseenter.bs.carousel",j=>this.pause(j)),we.on(this._element,"mouseleave.bs.carousel",j=>this.cycle(j))),this._config.touch&&this._touchSupported&&this._addTouchEventListeners()}_addTouchEventListeners(){const j=$e=>this._pointerEvent&&("pen"===$e.pointerType||"touch"===$e.pointerType),se=$e=>{j($e)?this.touchStartX=$e.clientX:this._pointerEvent||(this.touchStartX=$e.touches[0].clientX)},Me=$e=>{this.touchDeltaX=$e.touches&&$e.touches.length>1?0:$e.touches[0].clientX-this.touchStartX},Le=$e=>{j($e)&&(this.touchDeltaX=$e.clientX-this.touchStartX),this._handleSwipe(),"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(mt=>this.cycle(mt),500+this._config.interval))};Be.find(".carousel-item img",this._element).forEach($e=>{we.on($e,"dragstart.bs.carousel",mt=>mt.preventDefault())}),this._pointerEvent?(we.on(this._element,"pointerdown.bs.carousel",$e=>se($e)),we.on(this._element,"pointerup.bs.carousel",$e=>Le($e)),this._element.classList.add("pointer-event")):(we.on(this._element,"touchstart.bs.carousel",$e=>se($e)),we.on(this._element,"touchmove.bs.carousel",$e=>Me($e)),we.on(this._element,"touchend.bs.carousel",$e=>Le($e)))}_keydown(j){if(/input|textarea/i.test(j.target.tagName))return;const se=u[j.key];se&&(j.preventDefault(),this._slide(se))}_getItemIndex(j){return this._items=j&&j.parentNode?Be.find(".carousel-item",j.parentNode):[],this._items.indexOf(j)}_getItemByOrder(j,se){return V(this._items,se,j===Pt,this._config.wrap)}_triggerSlideEvent(j,se){const Me=this._getItemIndex(j),Le=this._getItemIndex(Be.findOne(a,this._element));return we.trigger(this._element,"slide.bs.carousel",{relatedTarget:j,direction:se,from:Le,to:Me})}_setActiveIndicatorElement(j){if(this._indicatorsElement){const se=Be.findOne(".active",this._indicatorsElement);se.classList.remove(y),se.removeAttribute("aria-current");const Me=Be.find("[data-bs-target]",this._indicatorsElement);for(let Le=0;Le<Me.length;Le++)if(Number.parseInt(Me[Le].getAttribute("data-bs-slide-to"),10)===this._getItemIndex(j)){Me[Le].classList.add(y),Me[Le].setAttribute("aria-current","true");break}}}_updateInterval(){const j=this._activeElement||Be.findOne(a,this._element);if(!j)return;const se=Number.parseInt(j.getAttribute("data-bs-interval"),10);se?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=se):this._config.interval=this._config.defaultInterval||this._config.interval}_slide(j,se){const Me=this._directionToOrder(j),Le=Be.findOne(a,this._element),$e=this._getItemIndex(Le),mt=se||this._getItemByOrder(Me,Le),St=this._getItemIndex(mt),Xt=Boolean(this._interval),Ht=Me===Pt,Qt=Ht?"carousel-item-start":"carousel-item-end",li=Ht?"carousel-item-next":"carousel-item-prev",Li=this._orderToDirection(Me);if(mt&&mt.classList.contains(y))return void(this._isSliding=!1);if(this._isSliding||this._triggerSlideEvent(mt,Li).defaultPrevented||!Le||!mt)return;this._isSliding=!0,Xt&&this.pause(),this._setActiveIndicatorElement(mt),this._activeElement=mt;const bi=()=>{we.trigger(this._element,h,{relatedTarget:mt,direction:Li,from:$e,to:St})};this._element.classList.contains("slide")?(mt.classList.add(li),Le.classList.add(Qt),mt.classList.add(Qt),this._queueCallback(()=>{mt.classList.remove(Qt,li),mt.classList.add(y),Le.classList.remove(y,li,Qt),this._isSliding=!1,setTimeout(bi,0)},Le,!0)):(Le.classList.remove(y),mt.classList.add(y),this._isSliding=!1,bi()),Xt&&this.cycle()}_directionToOrder(j){return[t,M].includes(j)?o()?j===M?z:Pt:j===M?Pt:z:j}_orderToDirection(j){return[Pt,z].includes(j)?o()?j===z?M:t:j===z?t:M:j}static carouselInterface(j,se){const Me=m.getOrCreateInstance(j,se);let{_config:Le}=Me;"object"==typeof se&&(Le=si(si({},Le),se));const $e="string"==typeof se?se:Le.slide;if("number"==typeof se)Me.to(se);else if("string"==typeof $e){if(void 0===Me[$e])throw new TypeError(`No method named "${$e}"`);Me[$e]()}else Le.interval&&Le.ride&&(Me.pause(),Me.cycle())}static jQueryInterface(j){return this.each(function(){m.carouselInterface(this,j)})}static dataApiClickHandler(j){const se=i(this);if(!se||!se.classList.contains("carousel"))return;const Me=si(si({},wt.getDataAttributes(se)),wt.getDataAttributes(this)),Le=this.getAttribute("data-bs-slide-to");Le&&(Me.interval=!1),m.carouselInterface(se,Me),Le&&m.getInstance(se).to(Le),j.preventDefault()}}we.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",m.dataApiClickHandler),we.on(window,"load.bs.carousel.data-api",()=>{const Te=Be.find('[data-bs-ride="carousel"]');for(let j=0,se=Te.length;j<se;j++)m.carouselInterface(Te[j],m.getInstance(Te[j]))}),f(m);const _="collapse",P={toggle:!0,parent:null},x={toggle:"boolean",parent:"(null|element)"},oe="show",K="collapse",X="collapsing",me="collapsed",Q=":scope .collapse .collapse",re='[data-bs-toggle="collapse"]';class ye extends at{constructor(j,se){super(j),this._isTransitioning=!1,this._config=this._getConfig(se),this._triggerArray=[];const Me=Be.find(re);for(let Le=0,$e=Me.length;Le<$e;Le++){const mt=Me[Le],St=e(mt),Xt=Be.find(St).filter(Ht=>Ht===this._element);null!==St&&Xt.length&&(this._selector=St,this._triggerArray.push(mt))}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return P}static get NAME(){return _}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let j,se=[];if(this._config.parent){const mt=Be.find(Q,this._config.parent);se=Be.find(".collapse.show, .collapse.collapsing",this._config.parent).filter(St=>!mt.includes(St))}const Me=Be.findOne(this._selector);if(se.length){const mt=se.find(St=>Me!==St);if(j=mt?ye.getInstance(mt):null,j&&j._isTransitioning)return}if(we.trigger(this._element,"show.bs.collapse").defaultPrevented)return;se.forEach(mt=>{Me!==mt&&ye.getOrCreateInstance(mt,{toggle:!1}).hide(),j||ft.set(mt,"bs.collapse",null)});const Le=this._getDimension();this._element.classList.remove(K),this._element.classList.add(X),this._element.style[Le]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const $e=`scroll${Le[0].toUpperCase()+Le.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(X),this._element.classList.add(K,oe),this._element.style[Le]="",we.trigger(this._element,"shown.bs.collapse")},this._element,!0),this._element.style[Le]=`${this._element[$e]}px`}hide(){if(this._isTransitioning||!this._isShown()||we.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const j=this._getDimension();this._element.style[j]=`${this._element.getBoundingClientRect()[j]}px`,this._element.classList.add(X),this._element.classList.remove(K,oe);const se=this._triggerArray.length;for(let Me=0;Me<se;Me++){const Le=this._triggerArray[Me],$e=i(Le);$e&&!this._isShown($e)&&this._addAriaAndCollapsedClass([Le],!1)}this._isTransitioning=!0,this._element.style[j]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(X),this._element.classList.add(K),we.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}_isShown(j=this._element){return j.classList.contains(oe)}_getConfig(j){return(j=si(si(si({},P),wt.getDataAttributes(this._element)),j)).toggle=Boolean(j.toggle),j.parent=L(j.parent),w(_,j,x),j}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const j=Be.find(Q,this._config.parent);Be.find(re,this._config.parent).filter(se=>!j.includes(se)).forEach(se=>{const Me=i(se);Me&&this._addAriaAndCollapsedClass([se],this._isShown(Me))})}_addAriaAndCollapsedClass(j,se){j.length&&j.forEach(Me=>{se?Me.classList.remove(me):Me.classList.add(me),Me.setAttribute("aria-expanded",se)})}static jQueryInterface(j){return this.each(function(){const se={};"string"==typeof j&&/show|hide/.test(j)&&(se.toggle=!1);const Me=ye.getOrCreateInstance(this,se);if("string"==typeof j){if(void 0===Me[j])throw new TypeError(`No method named "${j}"`);Me[j]()}})}}we.on(document,"click.bs.collapse.data-api",re,function(Te){("A"===Te.target.tagName||Te.delegateTarget&&"A"===Te.delegateTarget.tagName)&&Te.preventDefault();const j=e(this);Be.find(j).forEach(se=>{ye.getOrCreateInstance(se,{toggle:!1}).toggle()})}),f(ye);const Se="dropdown",ge="Escape",xe="ArrowUp",We="ArrowDown",rt=new RegExp("ArrowUp|ArrowDown|Escape"),Et="click.bs.dropdown.data-api",Qe="keydown.bs.dropdown.data-api",yt="show",ct='[data-bs-toggle="dropdown"]',ht=".dropdown-menu",mi=o()?"top-end":"top-start",Bi=o()?"top-start":"top-end",Yt=o()?"bottom-end":"bottom-start",oi=o()?"bottom-start":"bottom-end",ei=o()?"left-start":"right-start",Ci=o()?"right-start":"left-start",Ai={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},yi={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class gi extends at{constructor(j,se){super(j),this._popper=null,this._config=this._getConfig(se),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar()}static get Default(){return Ai}static get DefaultType(){return yi}static get NAME(){return Se}toggle(){return this._isShown()?this.hide():this.show()}show(){if(C(this._element)||this._isShown(this._menu))return;const j={relatedTarget:this._element};if(we.trigger(this._element,"show.bs.dropdown",j).defaultPrevented)return;const se=gi.getParentFromElement(this._element);this._inNavbar?wt.setDataAttribute(this._menu,"popper","none"):this._createPopper(se),"ontouchstart"in document.documentElement&&!se.closest(".navbar-nav")&&[].concat(...document.body.children).forEach(Me=>we.on(Me,"mouseover",n)),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(yt),this._element.classList.add(yt),we.trigger(this._element,"shown.bs.dropdown",j)}hide(){!C(this._element)&&this._isShown(this._menu)&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(j){we.trigger(this._element,"hide.bs.dropdown",j).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(se=>we.off(se,"mouseover",n)),this._popper&&this._popper.destroy(),this._menu.classList.remove(yt),this._element.classList.remove(yt),this._element.setAttribute("aria-expanded","false"),wt.removeDataAttribute(this._menu,"popper"),we.trigger(this._element,"hidden.bs.dropdown",j))}_getConfig(j){if(j=si(si(si({},this.constructor.Default),wt.getDataAttributes(this._element)),j),w(Se,j,this.constructor.DefaultType),"object"==typeof j.reference&&!d(j.reference)&&"function"!=typeof j.reference.getBoundingClientRect)throw new TypeError(`${Se.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return j}_createPopper(j){if(void 0===Ke)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let se=this._element;"parent"===this._config.reference?se=j:d(this._config.reference)?se=L(this._config.reference):"object"==typeof this._config.reference&&(se=this._config.reference);const Me=this._getPopperConfig(),Le=Me.modifiers.find($e=>"applyStyles"===$e.name&&!1===$e.enabled);this._popper=Ke.createPopper(se,this._menu,Me),Le&&wt.setDataAttribute(this._menu,"popper","static")}_isShown(j=this._element){return j.classList.contains(yt)}_getMenuElement(){return Be.next(this._element,ht)[0]}_getPlacement(){const j=this._element.parentNode;if(j.classList.contains("dropend"))return ei;if(j.classList.contains("dropstart"))return Ci;const se="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return j.classList.contains("dropup")?se?Bi:mi:se?oi:Yt}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:j}=this._config;return"string"==typeof j?j.split(",").map(se=>Number.parseInt(se,10)):"function"==typeof j?se=>j(se,this._element):j}_getPopperConfig(){const j={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return"static"===this._config.display&&(j.modifiers=[{name:"applyStyles",enabled:!1}]),si(si({},j),"function"==typeof this._config.popperConfig?this._config.popperConfig(j):this._config.popperConfig)}_selectMenuItem({key:j,target:se}){const Me=Be.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(A);Me.length&&V(Me,se,j===We,!Me.includes(se)).focus()}static jQueryInterface(j){return this.each(function(){const se=gi.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j]()}})}static clearMenus(j){if(j&&(2===j.button||"keyup"===j.type&&"Tab"!==j.key))return;const se=Be.find(ct);for(let Me=0,Le=se.length;Me<Le;Me++){const $e=gi.getInstance(se[Me]);if(!$e||!1===$e._config.autoClose||!$e._isShown())continue;const mt={relatedTarget:$e._element};if(j){const St=j.composedPath(),Xt=St.includes($e._menu);if(St.includes($e._element)||"inside"===$e._config.autoClose&&!Xt||"outside"===$e._config.autoClose&&Xt||$e._menu.contains(j.target)&&("keyup"===j.type&&"Tab"===j.key||/input|select|option|textarea|form/i.test(j.target.tagName)))continue;"click"===j.type&&(mt.clickEvent=j)}$e._completeHide(mt)}}static getParentFromElement(j){return i(j)||j.parentNode}static dataApiKeydownHandler(j){if(/input|textarea/i.test(j.target.tagName)?"Space"===j.key||j.key!==ge&&(j.key!==We&&j.key!==xe||j.target.closest(ht)):!rt.test(j.key))return;const se=this.classList.contains(yt);if(!se&&j.key===ge||(j.preventDefault(),j.stopPropagation(),C(this)))return;const Me=this.matches(ct)?this:Be.prev(this,ct)[0],Le=gi.getOrCreateInstance(Me);if(j.key!==ge)return j.key===xe||j.key===We?(se||Le.show(),void Le._selectMenuItem(j)):void(se&&"Space"!==j.key||gi.clearMenus());Le.hide()}}we.on(document,Qe,ct,gi.dataApiKeydownHandler),we.on(document,Qe,ht,gi.dataApiKeydownHandler),we.on(document,Et,gi.clearMenus),we.on(document,"keyup.bs.dropdown.data-api",gi.clearMenus),we.on(document,Et,ct,function(Te){Te.preventDefault(),gi.getOrCreateInstance(this).toggle()}),f(gi);const ki=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Gi=".sticky-top";class _i{constructor(){this._element=document.body}getWidth(){const j=document.documentElement.clientWidth;return Math.abs(window.innerWidth-j)}hide(){const j=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,"paddingRight",se=>se+j),this._setElementAttributes(ki,"paddingRight",se=>se+j),this._setElementAttributes(Gi,"marginRight",se=>se-j)}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(j,se,Me){const Le=this.getWidth();this._applyManipulationCallback(j,$e=>{if($e!==this._element&&window.innerWidth>$e.clientWidth+Le)return;this._saveInitialAttribute($e,se);const mt=window.getComputedStyle($e)[se];$e.style[se]=`${Me(Number.parseFloat(mt))}px`})}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,"paddingRight"),this._resetElementAttributes(ki,"paddingRight"),this._resetElementAttributes(Gi,"marginRight")}_saveInitialAttribute(j,se){const Me=j.style[se];Me&&wt.setDataAttribute(j,se,Me)}_resetElementAttributes(j,se){this._applyManipulationCallback(j,Me=>{const Le=wt.getDataAttribute(Me,se);void 0===Le?Me.style.removeProperty(se):(wt.removeDataAttribute(Me,se),Me.style[se]=Le)})}_applyManipulationCallback(j,se){d(j)?se(j):Be.find(j,this._element).forEach(se)}isOverflowing(){return this.getWidth()>0}}const Ni={className:"modal-backdrop",isVisible:!0,isAnimated:!1,rootElement:"body",clickCallback:null},Oi={className:"string",isVisible:"boolean",isAnimated:"boolean",rootElement:"(element|string)",clickCallback:"(function|null)"},Di="mousedown.bs.backdrop";class ji{constructor(j){this._config=this._getConfig(j),this._isAppended=!1,this._element=null}show(j){this._config.isVisible?(this._append(),this._config.isAnimated&&this._getElement(),this._getElement().classList.add("show"),this._emulateAnimation(()=>{I(j)})):I(j)}hide(j){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation(()=>{this.dispose(),I(j)})):I(j)}_getElement(){if(!this._element){const j=document.createElement("div");j.className=this._config.className,this._config.isAnimated&&j.classList.add("fade"),this._element=j}return this._element}_getConfig(j){return(j=si(si({},Ni),"object"==typeof j?j:{})).rootElement=L(j.rootElement),w("backdrop",j,Oi),j}_append(){this._isAppended||(this._config.rootElement.append(this._getElement()),we.on(this._getElement(),Di,()=>{I(this._config.clickCallback)}),this._isAppended=!0)}dispose(){this._isAppended&&(we.off(this._element,Di),this._element.remove(),this._isAppended=!1)}_emulateAnimation(j){l(j,this._getElement(),this._config.isAnimated)}}const Zi={trapElement:null,autofocus:!0},bn={trapElement:"element",autofocus:"boolean"},qi=".bs.focustrap",dn="backward";class _n{constructor(j){this._config=this._getConfig(j),this._isActive=!1,this._lastTabNavDirection=null}activate(){const{trapElement:j,autofocus:se}=this._config;this._isActive||(se&&j.focus(),we.off(document,qi),we.on(document,"focusin.bs.focustrap",Me=>this._handleFocusin(Me)),we.on(document,"keydown.tab.bs.focustrap",Me=>this._handleKeydown(Me)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,we.off(document,qi))}_handleFocusin(j){const{target:se}=j,{trapElement:Me}=this._config;if(se===document||se===Me||Me.contains(se))return;const Le=Be.focusableChildren(Me);0===Le.length?Me.focus():this._lastTabNavDirection===dn?Le[Le.length-1].focus():Le[0].focus()}_handleKeydown(j){"Tab"===j.key&&(this._lastTabNavDirection=j.shiftKey?dn:"forward")}_getConfig(j){return j=si(si({},Zi),"object"==typeof j?j:{}),w("focustrap",j,bn),j}}const un={backdrop:!0,keyboard:!0,focus:!0},Un={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},yn="hidden.bs.modal",$n="show.bs.modal",Ln="resize.bs.modal",Hi="click.dismiss.bs.modal",Hn="keydown.dismiss.bs.modal",Tn="mousedown.dismiss.bs.modal",Ui="modal-open",en="modal-static";class Re extends at{constructor(j,se){super(j),this._config=this._getConfig(se),this._dialog=Be.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollBar=new _i}static get Default(){return un}static get NAME(){return"modal"}toggle(j){return this._isShown?this.hide():this.show(j)}show(j){this._isShown||this._isTransitioning||we.trigger(this._element,$n,{relatedTarget:j}).defaultPrevented||(this._isShown=!0,this._isAnimated()&&(this._isTransitioning=!0),this._scrollBar.hide(),document.body.classList.add(Ui),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),we.on(this._dialog,Tn,()=>{we.one(this._element,"mouseup.dismiss.bs.modal",se=>{se.target===this._element&&(this._ignoreBackdropClick=!0)})}),this._showBackdrop(()=>this._showElement(j)))}hide(){if(!this._isShown||this._isTransitioning||we.trigger(this._element,"hide.bs.modal").defaultPrevented)return;this._isShown=!1;const j=this._isAnimated();j&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),this._focustrap.deactivate(),this._element.classList.remove("show"),we.off(this._element,Hi),we.off(this._dialog,Tn),this._queueCallback(()=>this._hideModal(),this._element,j)}dispose(){[window,this._dialog].forEach(j=>we.off(j,".bs.modal")),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new ji({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new _n({trapElement:this._element})}_getConfig(j){return j=si(si(si({},un),wt.getDataAttributes(this._element)),"object"==typeof j?j:{}),w("modal",j,Un),j}_showElement(j){const se=this._isAnimated(),Me=Be.findOne(".modal-body",this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,Me&&(Me.scrollTop=0),this._element.classList.add("show"),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,we.trigger(this._element,"shown.bs.modal",{relatedTarget:j})},this._dialog,se)}_setEscapeEvent(){this._isShown?we.on(this._element,Hn,j=>{this._config.keyboard&&"Escape"===j.key?(j.preventDefault(),this.hide()):this._config.keyboard||"Escape"!==j.key||this._triggerBackdropTransition()}):we.off(this._element,Hn)}_setResizeEvent(){this._isShown?we.on(window,Ln,()=>this._adjustDialog()):we.off(window,Ln)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Ui),this._resetAdjustments(),this._scrollBar.reset(),we.trigger(this._element,yn)})}_showBackdrop(j){we.on(this._element,Hi,se=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:se.target===se.currentTarget&&(!0===this._config.backdrop?this.hide():"static"===this._config.backdrop&&this._triggerBackdropTransition())}),this._backdrop.show(j)}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(we.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const{classList:j,scrollHeight:se,style:Me}=this._element,Le=se>document.documentElement.clientHeight;!Le&&"hidden"===Me.overflowY||j.contains(en)||(Le||(Me.overflowY="hidden"),j.add(en),this._queueCallback(()=>{j.remove(en),Le||this._queueCallback(()=>{Me.overflowY=""},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const j=this._element.scrollHeight>document.documentElement.clientHeight,se=this._scrollBar.getWidth(),Me=se>0;(!Me&&j&&!o()||Me&&!j&&o())&&(this._element.style.paddingLeft=`${se}px`),(Me&&!j&&!o()||!Me&&j&&o())&&(this._element.style.paddingRight=`${se}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(j,se){return this.each(function(){const Me=Re.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===Me[j])throw new TypeError(`No method named "${j}"`);Me[j](se)}})}}we.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(Te){const j=i(this);["A","AREA"].includes(this.tagName)&&Te.preventDefault(),we.one(j,$n,Me=>{Me.defaultPrevented||we.one(j,yn,()=>{A(this)&&this.focus()})});const se=Be.findOne(".modal.show");se&&Re.getInstance(se).hide(),Re.getOrCreateInstance(j).toggle(this)}),Ze(Re),f(Re);const lt="offcanvas",It={backdrop:!0,keyboard:!0,scroll:!1},it={backdrop:"boolean",keyboard:"boolean",scroll:"boolean"},nt=".offcanvas.show",vi="hidden.bs.offcanvas";class di extends at{constructor(j,se){super(j),this._config=this._getConfig(se),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get NAME(){return lt}static get Default(){return It}toggle(j){return this._isShown?this.hide():this.show(j)}show(j){this._isShown||we.trigger(this._element,"show.bs.offcanvas",{relatedTarget:j}).defaultPrevented||(this._isShown=!0,this._element.style.visibility="visible",this._backdrop.show(),this._config.scroll||(new _i).hide(),this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add("show"),this._queueCallback(()=>{this._config.scroll||this._focustrap.activate(),we.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:j})},this._element,!0))}hide(){this._isShown&&(we.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.remove("show"),this._backdrop.hide(),this._queueCallback(()=>{this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._element.style.visibility="hidden",this._config.scroll||(new _i).reset(),we.trigger(this._element,vi)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_getConfig(j){return j=si(si(si({},It),wt.getDataAttributes(this._element)),"object"==typeof j?j:{}),w(lt,j,it),j}_initializeBackDrop(){return new ji({className:"offcanvas-backdrop",isVisible:this._config.backdrop,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:()=>this.hide()})}_initializeFocusTrap(){return new _n({trapElement:this._element})}_addEventListeners(){we.on(this._element,"keydown.dismiss.bs.offcanvas",j=>{this._config.keyboard&&"Escape"===j.key&&this.hide()})}static jQueryInterface(j){return this.each(function(){const se=di.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j]||j.startsWith("_")||"constructor"===j)throw new TypeError(`No method named "${j}"`);se[j](this)}})}}we.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(Te){const j=i(this);if(["A","AREA"].includes(this.tagName)&&Te.preventDefault(),C(this))return;we.one(j,vi,()=>{A(this)&&this.focus()});const se=Be.findOne(nt);se&&se!==j&&di.getInstance(se).hide(),di.getOrCreateInstance(j).toggle(this)}),we.on(window,"load.bs.offcanvas.data-api",()=>Be.find(nt).forEach(Te=>di.getOrCreateInstance(Te).show())),Ze(di),f(di);const ai=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Mt=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,Vt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,Ft=(Te,j)=>{const se=Te.nodeName.toLowerCase();if(j.includes(se))return!ai.has(se)||Boolean(Mt.test(Te.nodeValue)||Vt.test(Te.nodeValue));const Me=j.filter(Le=>Le instanceof RegExp);for(let Le=0,$e=Me.length;Le<$e;Le++)if(Me[Le].test(se))return!0;return!1};function ui(Te,j,se){if(!Te.length)return Te;if(se&&"function"==typeof se)return se(Te);const Me=(new window.DOMParser).parseFromString(Te,"text/html"),Le=[].concat(...Me.body.querySelectorAll("*"));for(let $e=0,mt=Le.length;$e<mt;$e++){const St=Le[$e],Xt=St.nodeName.toLowerCase();if(!Object.keys(j).includes(Xt)){St.remove();continue}const Ht=[].concat(...St.attributes),Qt=[].concat(j["*"]||[],j[Xt]||[]);Ht.forEach(li=>{Ft(li,Qt)||St.removeAttribute(li.nodeName)})}return Me.body.innerHTML}const xn="tooltip",ea=new Set(["sanitize","allowList","sanitizeFn"]),ta={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(array|string|function)",container:"(string|element|boolean)",fallbackPlacements:"array",boundary:"(string|element)",customClass:"(string|function)",sanitize:"boolean",sanitizeFn:"(null|function)",allowList:"object",popperConfig:"(null|object|function)"},oa={AUTO:"auto",TOP:"top",RIGHT:o()?"left":"right",BOTTOM:"bottom",LEFT:o()?"right":"left"},Mn={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:[0,0],container:!1,fallbackPlacements:["top","right","bottom","left"],boundary:"clippingParents",customClass:"",sanitize:!0,sanitizeFn:null,allowList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},popperConfig:null},Wn={HIDE:"hide.bs.tooltip",HIDDEN:"hidden.bs.tooltip",SHOW:"show.bs.tooltip",SHOWN:"shown.bs.tooltip",INSERTED:"inserted.bs.tooltip",CLICK:"click.bs.tooltip",FOCUSIN:"focusin.bs.tooltip",FOCUSOUT:"focusout.bs.tooltip",MOUSEENTER:"mouseenter.bs.tooltip",MOUSELEAVE:"mouseleave.bs.tooltip"},Jn="fade",zn="show",ia="show",Ea=".tooltip-inner",Yn="hide.bs.modal",na="hover";class hn extends at{constructor(j,se){if(void 0===Ke)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(j),this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this._config=this._getConfig(se),this.tip=null,this._setListeners()}static get Default(){return Mn}static get NAME(){return xn}static get Event(){return Wn}static get DefaultType(){return ta}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(j){if(this._isEnabled)if(j){const se=this._initializeOnDelegatedTarget(j);se._activeTrigger.click=!se._activeTrigger.click,se._isWithActiveTrigger()?se._enter(null,se):se._leave(null,se)}else{if(this.getTipElement().classList.contains(zn))return void this._leave(null,this);this._enter(null,this)}}dispose(){clearTimeout(this._timeout),we.off(this._element.closest(".modal"),Yn,this._hideModalHandler),this.tip&&this.tip.remove(),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this.isWithContent()||!this._isEnabled)return;const j=we.trigger(this._element,this.constructor.Event.SHOW),se=S(this._element),Me=null===se?this._element.ownerDocument.documentElement.contains(this._element):se.contains(this._element);if(j.defaultPrevented||!Me)return;"tooltip"===this.constructor.NAME&&this.tip&&this.getTitle()!==this.tip.querySelector(Ea).innerHTML&&(this._disposePopper(),this.tip.remove(),this.tip=null);const Le=this.getTipElement(),$e=(li=>{do{li+=Math.floor(1e6*Math.random())}while(document.getElementById(li));return li})(this.constructor.NAME);Le.setAttribute("id",$e),this._element.setAttribute("aria-describedby",$e),this._config.animation&&Le.classList.add(Jn);const mt="function"==typeof this._config.placement?this._config.placement.call(this,Le,this._element):this._config.placement,St=this._getAttachment(mt);this._addAttachmentClass(St);const{container:Xt}=this._config;ft.set(Le,this.constructor.DATA_KEY,this),this._element.ownerDocument.documentElement.contains(this.tip)||(Xt.append(Le),we.trigger(this._element,this.constructor.Event.INSERTED)),this._popper?this._popper.update():this._popper=Ke.createPopper(this._element,Le,this._getPopperConfig(St)),Le.classList.add(zn);const Ht=this._resolvePossibleFunction(this._config.customClass);Ht&&Le.classList.add(...Ht.split(" ")),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(li=>{we.on(li,"mouseover",n)});const Qt=this.tip.classList.contains(Jn);this._queueCallback(()=>{const li=this._hoverState;this._hoverState=null,we.trigger(this._element,this.constructor.Event.SHOWN),"out"===li&&this._leave(null,this)},this.tip,Qt)}hide(){if(!this._popper)return;const j=this.getTipElement();if(we.trigger(this._element,this.constructor.Event.HIDE).defaultPrevented)return;j.classList.remove(zn),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(Me=>we.off(Me,"mouseover",n)),this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1;const se=this.tip.classList.contains(Jn);this._queueCallback(()=>{this._isWithActiveTrigger()||(this._hoverState!==ia&&j.remove(),this._cleanTipClass(),this._element.removeAttribute("aria-describedby"),we.trigger(this._element,this.constructor.Event.HIDDEN),this._disposePopper())},this.tip,se),this._hoverState=""}update(){null!==this._popper&&this._popper.update()}isWithContent(){return Boolean(this.getTitle())}getTipElement(){if(this.tip)return this.tip;const j=document.createElement("div");j.innerHTML=this._config.template;const se=j.children[0];return this.setContent(se),se.classList.remove(Jn,zn),this.tip=se,this.tip}setContent(j){this._sanitizeAndSetContent(j,this.getTitle(),Ea)}_sanitizeAndSetContent(j,se,Me){const Le=Be.findOne(Me,j);se||!Le?this.setElementContent(Le,se):Le.remove()}setElementContent(j,se){if(null!==j)return d(se)?(se=L(se),void(this._config.html?se.parentNode!==j&&(j.innerHTML="",j.append(se)):j.textContent=se.textContent)):void(this._config.html?(this._config.sanitize&&(se=ui(se,this._config.allowList,this._config.sanitizeFn)),j.innerHTML=se):j.textContent=se)}getTitle(){const j=this._element.getAttribute("data-bs-original-title")||this._config.title;return this._resolvePossibleFunction(j)}updateAttachment(j){return"right"===j?"end":"left"===j?"start":j}_initializeOnDelegatedTarget(j,se){return se||this.constructor.getOrCreateInstance(j.delegateTarget,this._getDelegateConfig())}_getOffset(){const{offset:j}=this._config;return"string"==typeof j?j.split(",").map(se=>Number.parseInt(se,10)):"function"==typeof j?se=>j(se,this._element):j}_resolvePossibleFunction(j){return"function"==typeof j?j.call(this._element):j}_getPopperConfig(j){const se={placement:j,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"onChange",enabled:!0,phase:"afterWrite",fn:Me=>this._handlePopperPlacementChange(Me)}],onFirstUpdate:Me=>{Me.options.placement!==Me.placement&&this._handlePopperPlacementChange(Me)}};return si(si({},se),"function"==typeof this._config.popperConfig?this._config.popperConfig(se):this._config.popperConfig)}_addAttachmentClass(j){this.getTipElement().classList.add(`${this._getBasicClassPrefix()}-${this.updateAttachment(j)}`)}_getAttachment(j){return oa[j.toUpperCase()]}_setListeners(){this._config.trigger.split(" ").forEach(j=>{if("click"===j)we.on(this._element,this.constructor.Event.CLICK,this._config.selector,se=>this.toggle(se));else if("manual"!==j){const Me=j===na?this.constructor.Event.MOUSELEAVE:this.constructor.Event.FOCUSOUT;we.on(this._element,j===na?this.constructor.Event.MOUSEENTER:this.constructor.Event.FOCUSIN,this._config.selector,Le=>this._enter(Le)),we.on(this._element,Me,this._config.selector,Le=>this._leave(Le))}}),this._hideModalHandler=()=>{this._element&&this.hide()},we.on(this._element.closest(".modal"),Yn,this._hideModalHandler),this._config.selector?this._config=gr(si({},this._config),{trigger:"manual",selector:""}):this._fixTitle()}_fixTitle(){const j=this._element.getAttribute("title"),se=typeof this._element.getAttribute("data-bs-original-title");(j||"string"!==se)&&(this._element.setAttribute("data-bs-original-title",j||""),!j||this._element.getAttribute("aria-label")||this._element.textContent||this._element.setAttribute("aria-label",j),this._element.setAttribute("title",""))}_enter(j,se){se=this._initializeOnDelegatedTarget(j,se),j&&(se._activeTrigger["focusin"===j.type?"focus":na]=!0),se.getTipElement().classList.contains(zn)||se._hoverState===ia?se._hoverState=ia:(clearTimeout(se._timeout),se._hoverState=ia,se._config.delay&&se._config.delay.show?se._timeout=setTimeout(()=>{se._hoverState===ia&&se.show()},se._config.delay.show):se.show())}_leave(j,se){se=this._initializeOnDelegatedTarget(j,se),j&&(se._activeTrigger["focusout"===j.type?"focus":na]=se._element.contains(j.relatedTarget)),se._isWithActiveTrigger()||(clearTimeout(se._timeout),se._hoverState="out",se._config.delay&&se._config.delay.hide?se._timeout=setTimeout(()=>{"out"===se._hoverState&&se.hide()},se._config.delay.hide):se.hide())}_isWithActiveTrigger(){for(const j in this._activeTrigger)if(this._activeTrigger[j])return!0;return!1}_getConfig(j){const se=wt.getDataAttributes(this._element);return Object.keys(se).forEach(Me=>{ea.has(Me)&&delete se[Me]}),(j=si(si(si({},this.constructor.Default),se),"object"==typeof j&&j?j:{})).container=!1===j.container?document.body:L(j.container),"number"==typeof j.delay&&(j.delay={show:j.delay,hide:j.delay}),"number"==typeof j.title&&(j.title=j.title.toString()),"number"==typeof j.content&&(j.content=j.content.toString()),w(xn,j,this.constructor.DefaultType),j.sanitize&&(j.template=ui(j.template,j.allowList,j.sanitizeFn)),j}_getDelegateConfig(){const j={};for(const se in this._config)this.constructor.Default[se]!==this._config[se]&&(j[se]=this._config[se]);return j}_cleanTipClass(){const j=this.getTipElement(),se=new RegExp(`(^|\\s)${this._getBasicClassPrefix()}\\S+`,"g"),Me=j.getAttribute("class").match(se);null!==Me&&Me.length>0&&Me.map(Le=>Le.trim()).forEach(Le=>j.classList.remove(Le))}_getBasicClassPrefix(){return"bs-tooltip"}_handlePopperPlacementChange(j){const{state:se}=j;se&&(this.tip=se.elements.popper,this._cleanTipClass(),this._addAttachmentClass(this._getAttachment(se.placement)))}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(j){return this.each(function(){const se=hn.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j]()}})}}f(hn);const fa=gr(si({},hn.Default),{placement:"right",offset:[0,8],trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),Ca=gr(si({},hn.DefaultType),{content:"(string|element|function)"}),ba={HIDE:"hide.bs.popover",HIDDEN:"hidden.bs.popover",SHOW:"show.bs.popover",SHOWN:"shown.bs.popover",INSERTED:"inserted.bs.popover",CLICK:"click.bs.popover",FOCUSIN:"focusin.bs.popover",FOCUSOUT:"focusout.bs.popover",MOUSEENTER:"mouseenter.bs.popover",MOUSELEAVE:"mouseleave.bs.popover"};class jn extends hn{static get Default(){return fa}static get NAME(){return"popover"}static get Event(){return ba}static get DefaultType(){return Ca}isWithContent(){return this.getTitle()||this._getContent()}setContent(j){this._sanitizeAndSetContent(j,this.getTitle(),".popover-header"),this._sanitizeAndSetContent(j,this._getContent(),".popover-body")}_getContent(){return this._resolvePossibleFunction(this._config.content)}_getBasicClassPrefix(){return"bs-popover"}static jQueryInterface(j){return this.each(function(){const se=jn.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j]()}})}}f(jn);const aa="scrollspy",la={offset:10,method:"auto",target:""},Vn={offset:"number",method:"string",target:"(string|element)"},Fn="active",ya=".nav-link, .list-group-item, .dropdown-item",ma="position";class g extends at{constructor(j,se){super(j),this._scrollElement="BODY"===this._element.tagName?window:this._element,this._config=this._getConfig(se),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,we.on(this._scrollElement,"scroll.bs.scrollspy",()=>this._process()),this.refresh(),this._process()}static get Default(){return la}static get NAME(){return aa}refresh(){const se="auto"===this._config.method?this._scrollElement===this._scrollElement.window?"offset":ma:this._config.method,Me=se===ma?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),Be.find(ya,this._config.target).map(Le=>{const $e=e(Le),mt=$e?Be.findOne($e):null;if(mt){const St=mt.getBoundingClientRect();if(St.width||St.height)return[wt[se](mt).top+Me,$e]}return null}).filter(Le=>Le).sort((Le,$e)=>Le[0]-$e[0]).forEach(Le=>{this._offsets.push(Le[0]),this._targets.push(Le[1])})}dispose(){we.off(this._scrollElement,".bs.scrollspy"),super.dispose()}_getConfig(j){return(j=si(si(si({},la),wt.getDataAttributes(this._element)),"object"==typeof j&&j?j:{})).target=L(j.target)||document.documentElement,w(aa,j,Vn),j}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){const j=this._getScrollTop()+this._config.offset,se=this._getScrollHeight(),Me=this._config.offset+se-this._getOffsetHeight();if(this._scrollHeight!==se&&this.refresh(),j>=Me){const Le=this._targets[this._targets.length-1];this._activeTarget!==Le&&this._activate(Le)}else{if(this._activeTarget&&j<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(let Le=this._offsets.length;Le--;)this._activeTarget!==this._targets[Le]&&j>=this._offsets[Le]&&(void 0===this._offsets[Le+1]||j<this._offsets[Le+1])&&this._activate(this._targets[Le])}}_activate(j){this._activeTarget=j,this._clear();const se=ya.split(",").map(Le=>`${Le}[data-bs-target="${j}"],${Le}[href="${j}"]`),Me=Be.findOne(se.join(","),this._config.target);Me.classList.add(Fn),Me.classList.contains("dropdown-item")?Be.findOne(".dropdown-toggle",Me.closest(".dropdown")).classList.add(Fn):Be.parents(Me,".nav, .list-group").forEach(Le=>{Be.prev(Le,".nav-link, .list-group-item").forEach($e=>$e.classList.add(Fn)),Be.prev(Le,".nav-item").forEach($e=>{Be.children($e,".nav-link").forEach(mt=>mt.classList.add(Fn))})}),we.trigger(this._scrollElement,"activate.bs.scrollspy",{relatedTarget:j})}_clear(){Be.find(ya,this._config.target).filter(j=>j.classList.contains(Fn)).forEach(j=>j.classList.remove(Fn))}static jQueryInterface(j){return this.each(function(){const se=g.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j]()}})}}we.on(window,"load.bs.scrollspy.data-api",()=>{Be.find('[data-bs-spy="scroll"]').forEach(Te=>new g(Te))}),f(g);const k="active",J="fade",Z="show",he=".active",fe=":scope > li > .active";class ve extends at{static get NAME(){return"tab"}show(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&this._element.classList.contains(k))return;let j;const se=i(this._element),Me=this._element.closest(".nav, .list-group");Me&&(j=Be.find("UL"===Me.nodeName||"OL"===Me.nodeName?fe:he,Me),j=j[j.length-1]);const Le=j?we.trigger(j,"hide.bs.tab",{relatedTarget:this._element}):null;if(we.trigger(this._element,"show.bs.tab",{relatedTarget:j}).defaultPrevented||null!==Le&&Le.defaultPrevented)return;this._activate(this._element,Me);const $e=()=>{we.trigger(j,"hidden.bs.tab",{relatedTarget:this._element}),we.trigger(this._element,"shown.bs.tab",{relatedTarget:j})};se?this._activate(se,se.parentNode,$e):$e()}_activate(j,se,Me){const Le=(!se||"UL"!==se.nodeName&&"OL"!==se.nodeName?Be.children(se,he):Be.find(fe,se))[0],$e=Me&&Le&&Le.classList.contains(J),mt=()=>this._transitionComplete(j,Le,Me);Le&&$e?(Le.classList.remove(Z),this._queueCallback(mt,j,!0)):mt()}_transitionComplete(j,se,Me){if(se){se.classList.remove(k);const $e=Be.findOne(":scope > .dropdown-menu .active",se.parentNode);$e&&$e.classList.remove(k),"tab"===se.getAttribute("role")&&se.setAttribute("aria-selected",!1)}j.classList.add(k),"tab"===j.getAttribute("role")&&j.setAttribute("aria-selected",!0),j.classList.contains(J)&&j.classList.add(Z);let Le=j.parentNode;if(Le&&"LI"===Le.nodeName&&(Le=Le.parentNode),Le&&Le.classList.contains("dropdown-menu")){const $e=j.closest(".dropdown");$e&&Be.find(".dropdown-toggle",$e).forEach(mt=>mt.classList.add(k)),j.setAttribute("aria-expanded",!0)}Me&&Me()}static jQueryInterface(j){return this.each(function(){const se=ve.getOrCreateInstance(this);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j]()}})}}we.on(document,"click.bs.tab.data-api",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',function(Te){["A","AREA"].includes(this.tagName)&&Te.preventDefault(),C(this)||ve.getOrCreateInstance(this).show()}),f(ve);const Ve="show",Ye="showing",ot={animation:"boolean",autohide:"boolean",delay:"number"},Je={animation:!0,autohide:!0,delay:5e3};class Xe extends at{constructor(j,se){super(j),this._config=this._getConfig(se),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get DefaultType(){return ot}static get Default(){return Je}static get NAME(){return"toast"}show(){we.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.classList.add(Ve),this._element.classList.add(Ye),this._queueCallback(()=>{this._element.classList.remove(Ye),we.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this._element.classList.contains(Ve)&&(we.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(Ye),this._queueCallback(()=>{this._element.classList.add("hide"),this._element.classList.remove(Ye),this._element.classList.remove(Ve),we.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this._element.classList.contains(Ve)&&this._element.classList.remove(Ve),super.dispose()}_getConfig(j){return j=si(si(si({},Je),wt.getDataAttributes(this._element)),"object"==typeof j&&j?j:{}),w("toast",j,this.constructor.DefaultType),j}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(j,se){switch(j.type){case"mouseover":case"mouseout":this._hasMouseInteraction=se;break;case"focusin":case"focusout":this._hasKeyboardInteraction=se}if(se)return void this._clearTimeout();const Me=j.relatedTarget;this._element===Me||this._element.contains(Me)||this._maybeScheduleHide()}_setListeners(){we.on(this._element,"mouseover.bs.toast",j=>this._onInteraction(j,!0)),we.on(this._element,"mouseout.bs.toast",j=>this._onInteraction(j,!1)),we.on(this._element,"focusin.bs.toast",j=>this._onInteraction(j,!0)),we.on(this._element,"focusout.bs.toast",j=>this._onInteraction(j,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(j){return this.each(function(){const se=Xe.getOrCreateInstance(this,j);if("string"==typeof j){if(void 0===se[j])throw new TypeError(`No method named "${j}"`);se[j](this)}})}}return Ze(Xe),f(Xe),{Alert:ie,Button:Rt,Carousel:m,Collapse:ye,Dropdown:gi,Modal:Re,Offcanvas:di,Popover:jn,ScrollSpy:g,Tab:ve,Toast:Xe,Tooltip:hn}}),function(tt){"object"==typeof exports&&"undefined"!=typeof module?module.exports=tt():"function"==typeof define&&define.amd?define([],tt):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=tt()}(function(){return function tt(Wt,Ke,F){function Y(c,d){if(!Ke[c]){if(!Wt[c]){var L="function"==typeof require&&require;if(!d&&L)return L(c,!0);if(e)return e(c,!0);var w=new Error("Cannot find module '"+c+"'");throw w.code="MODULE_NOT_FOUND",w}var A=Ke[c]={exports:{}};Wt[c][0].call(A.exports,function(C){return Y(Wt[c][1][C]||C)},A,A.exports,tt,Wt,Ke,F)}return Ke[c].exports}for(var e="function"==typeof require&&require,i=0;i<F.length;i++)Y(F[i]);return Y}({1:[function(tt,Wt,Ke){"use strict";var F=(0,tt("./adapter_factory.js").adapterFactory)({window});Wt.exports=F},{"./adapter_factory.js":2}],2:[function(tt,Wt,Ke){"use strict";function F(w){if(w&&w.__esModule)return w;var A={};if(null!=w)for(var C in w)Object.prototype.hasOwnProperty.call(w,C)&&(A[C]=w[C]);return A.default=w,A}Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.adapterFactory=function(){var w=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},C=Y.log,S=Y.detectBrowser(w),n={browserDetails:S,commonShim:L,extractVersion:Y.extractVersion,disableLog:Y.disableLog,disableWarnings:Y.disableWarnings};switch(S.browser){case"chrome":if(!e||!e.shimPeerConnection||!A.shimChrome)return C("Chrome shim is not included in this adapter release."),n;C("adapter.js shimming chrome."),n.browserShim=e,e.shimGetUserMedia(w),e.shimMediaStream(w),e.shimPeerConnection(w),e.shimOnTrack(w),e.shimAddTrackRemoveTrack(w),e.shimGetSendersWithDtmf(w),e.shimGetStats(w),e.shimSenderReceiverGetStats(w),e.fixNegotiationNeeded(w),L.shimRTCIceCandidate(w),L.shimConnectionState(w),L.shimMaxMessageSize(w),L.shimSendThrowTypeError(w),L.removeAllowExtmapMixed(w);break;case"firefox":if(!c||!c.shimPeerConnection||!A.shimFirefox)return C("Firefox shim is not included in this adapter release."),n;C("adapter.js shimming firefox."),n.browserShim=c,c.shimGetUserMedia(w),c.shimPeerConnection(w),c.shimOnTrack(w),c.shimRemoveStream(w),c.shimSenderGetStats(w),c.shimReceiverGetStats(w),c.shimRTCDataChannel(w),L.shimRTCIceCandidate(w),L.shimConnectionState(w),L.shimMaxMessageSize(w),L.shimSendThrowTypeError(w);break;case"edge":if(!i||!i.shimPeerConnection||!A.shimEdge)return C("MS edge shim is not included in this adapter release."),n;C("adapter.js shimming edge."),n.browserShim=i,i.shimGetUserMedia(w),i.shimGetDisplayMedia(w),i.shimPeerConnection(w),i.shimReplaceTrack(w),L.shimMaxMessageSize(w),L.shimSendThrowTypeError(w);break;case"safari":if(!d||!A.shimSafari)return C("Safari shim is not included in this adapter release."),n;C("adapter.js shimming safari."),n.browserShim=d,d.shimRTCIceServerUrls(w),d.shimCreateOfferLegacy(w),d.shimCallbacksAPI(w),d.shimLocalStreamsAPI(w),d.shimRemoteStreamsAPI(w),d.shimTrackEventTransceiver(w),d.shimGetUserMedia(w),L.shimRTCIceCandidate(w),L.shimMaxMessageSize(w),L.shimSendThrowTypeError(w),L.removeAllowExtmapMixed(w);break;default:C("Unsupported browser!")}return n};var Y=F(tt("./utils")),e=F(tt("./chrome/chrome_shim")),i=F(tt("./edge/edge_shim")),c=F(tt("./firefox/firefox_shim")),d=F(tt("./safari/safari_shim")),L=F(tt("./common_shim"))},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(tt,Wt,Ke){"use strict";function F(d){d.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(n){return S._shimmedLocalStreams[n][0]})};var L=d.RTCPeerConnection.prototype.addTrack;d.RTCPeerConnection.prototype.addTrack=function(S,n){if(!n)return L.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var v=L.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(v)&&this._shimmedLocalStreams[n.id].push(v):this._shimmedLocalStreams[n.id]=[n,v],v};var w=d.RTCPeerConnection.prototype.addStream;d.RTCPeerConnection.prototype.addStream=function(S){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(function(p){if(n.getSenders().find(function(o){return o.track===p}))throw new DOMException("Track already exists.","InvalidAccessError")});var v=this.getSenders();w.apply(this,arguments);var R=this.getSenders().filter(function(p){return-1===v.indexOf(p)});this._shimmedLocalStreams[S.id]=[S].concat(R)};var A=d.RTCPeerConnection.prototype.removeStream;d.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],A.apply(this,arguments)};var C=d.RTCPeerConnection.prototype.removeTrack;d.RTCPeerConnection.prototype.removeTrack=function(S){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(function(v){var R=n._shimmedLocalStreams[v].indexOf(S);-1!==R&&n._shimmedLocalStreams[v].splice(R,1),1===n._shimmedLocalStreams[v].length&&delete n._shimmedLocalStreams[v]}),C.apply(this,arguments)}}Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=Ke.shimGetUserMedia=void 0;var Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&"function"==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},e=tt("./getusermedia");Object.defineProperty(Ke,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}});var i=tt("./getdisplaymedia");Object.defineProperty(Ke,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),Ke.shimMediaStream=function(d){d.MediaStream=d.MediaStream||d.webkitMediaStream},Ke.shimOnTrack=function(d){if("object"!==(void 0===d?"undefined":Y(d))||!d.RTCPeerConnection||"ontrack"in d.RTCPeerConnection.prototype)c.wrapPeerConnectionEvent(d,"track",function(w){return w.transceiver||Object.defineProperty(w,"transceiver",{value:{receiver:w.receiver}}),w});else{Object.defineProperty(d.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(w){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=w)},enumerable:!0,configurable:!0});var L=d.RTCPeerConnection.prototype.setRemoteDescription;d.RTCPeerConnection.prototype.setRemoteDescription=function(){var w=this;return this._ontrackpoly||(this._ontrackpoly=function(A){A.stream.addEventListener("addtrack",function(C){var S;S=d.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(v){return v.track&&v.track.id===C.track.id}):{track:C.track};var n=new Event("track");n.track=C.track,n.receiver=S,n.transceiver={receiver:S},n.streams=[A.stream],w.dispatchEvent(n)}),A.stream.getTracks().forEach(function(C){var S;S=d.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(v){return v.track&&v.track.id===C.id}):{track:C};var n=new Event("track");n.track=C,n.receiver=S,n.transceiver={receiver:S},n.streams=[A.stream],w.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),L.apply(this,arguments)}}},Ke.shimGetSendersWithDtmf=function(d){if("object"===(void 0===d?"undefined":Y(d))&&d.RTCPeerConnection&&!("getSenders"in d.RTCPeerConnection.prototype)&&"createDTMFSender"in d.RTCPeerConnection.prototype){var L=function(v,R){return{track:R,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===R.kind?v.createDTMFSender(R):null),this._dtmf},_pc:v}};if(!d.RTCPeerConnection.prototype.getSenders){d.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var w=d.RTCPeerConnection.prototype.addTrack;d.RTCPeerConnection.prototype.addTrack=function(v,R){var p=w.apply(this,arguments);return p||(p=L(this,v),this._senders.push(p)),p};var A=d.RTCPeerConnection.prototype.removeTrack;d.RTCPeerConnection.prototype.removeTrack=function(v){A.apply(this,arguments);var R=this._senders.indexOf(v);-1!==R&&this._senders.splice(R,1)}}var C=d.RTCPeerConnection.prototype.addStream;d.RTCPeerConnection.prototype.addStream=function(v){var R=this;this._senders=this._senders||[],C.apply(this,[v]),v.getTracks().forEach(function(p){R._senders.push(L(R,p))})};var S=d.RTCPeerConnection.prototype.removeStream;d.RTCPeerConnection.prototype.removeStream=function(v){var R=this;this._senders=this._senders||[],S.apply(this,[v]),v.getTracks().forEach(function(p){var o=R._senders.find(function(f){return f.track===p});o&&R._senders.splice(R._senders.indexOf(o),1)})}}else if("object"===(void 0===d?"undefined":Y(d))&&d.RTCPeerConnection&&"getSenders"in d.RTCPeerConnection.prototype&&"createDTMFSender"in d.RTCPeerConnection.prototype&&d.RTCRtpSender&&!("dtmf"in d.RTCRtpSender.prototype)){var n=d.RTCPeerConnection.prototype.getSenders;d.RTCPeerConnection.prototype.getSenders=function(){var v=this,R=n.apply(this,[]);return R.forEach(function(p){return p._pc=v}),R},Object.defineProperty(d.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},Ke.shimGetStats=function(d){if(d.RTCPeerConnection){var L=d.RTCPeerConnection.prototype.getStats;d.RTCPeerConnection.prototype.getStats=function(w,A,C){var S=this,n=arguments;if(arguments.length>0&&"function"==typeof w)return L.apply(this,arguments);if(0===L.length&&(0===arguments.length||"function"!=typeof arguments[0]))return L.apply(this,[]);var v=function(o){var f={};return o.result().forEach(function(I){var l={id:I.id,timestamp:I.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[I.type]||I.type};I.names().forEach(function(V){l[V]=I.stat(V)}),f[l.id]=l}),f},R=function(o){return new Map(Object.keys(o).map(function(f){return[f,o[f]]}))};if(arguments.length>=2){var p=function(o){n[1](R(v(o)))};return L.apply(this,[p,arguments[0]])}return new Promise(function(o,f){L.apply(S,[function(I){o(R(v(I)))},f])}).then(A,C)}}},Ke.shimSenderReceiverGetStats=function(d){if("object"===(void 0===d?"undefined":Y(d))&&d.RTCPeerConnection&&d.RTCRtpSender&&d.RTCRtpReceiver){if(!("getStats"in d.RTCRtpSender.prototype)){var L=d.RTCPeerConnection.prototype.getSenders;L&&(d.RTCPeerConnection.prototype.getSenders=function(){var S=this,n=L.apply(this,[]);return n.forEach(function(v){return v._pc=S}),n});var w=d.RTCPeerConnection.prototype.addTrack;w&&(d.RTCPeerConnection.prototype.addTrack=function(){var S=w.apply(this,arguments);return S._pc=this,S}),d.RTCRtpSender.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(n){return c.filterStats(n,S.track,!0)})}}if(!("getStats"in d.RTCRtpReceiver.prototype)){var A=d.RTCPeerConnection.prototype.getReceivers;A&&(d.RTCPeerConnection.prototype.getReceivers=function(){var S=this,n=A.apply(this,[]);return n.forEach(function(v){return v._pc=S}),n}),c.wrapPeerConnectionEvent(d,"track",function(S){return S.receiver._pc=S.srcElement,S}),d.RTCRtpReceiver.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(n){return c.filterStats(n,S.track,!1)})}}if("getStats"in d.RTCRtpSender.prototype&&"getStats"in d.RTCRtpReceiver.prototype){var C=d.RTCPeerConnection.prototype.getStats;d.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof d.MediaStreamTrack){var S=arguments[0],n=void 0,v=void 0,R=void 0;return this.getSenders().forEach(function(p){p.track===S&&(n?R=!0:n=p)}),this.getReceivers().forEach(function(p){return p.track===S&&(v?R=!0:v=p),p.track===S}),R||n&&v?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():v?v.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return C.apply(this,arguments)}}}},Ke.shimAddTrackRemoveTrackWithNative=F,Ke.shimAddTrackRemoveTrack=function(d){function L(p,o){var f=o.sdp;return Object.keys(p._reverseStreams||[]).forEach(function(I){var l=p._reverseStreams[I];f=f.replace(new RegExp(p._streams[l.id].id,"g"),l.id)}),new RTCSessionDescription({type:o.type,sdp:f})}function w(p,o){var f=o.sdp;return Object.keys(p._reverseStreams||[]).forEach(function(I){var l=p._reverseStreams[I],V=p._streams[l.id];f=f.replace(new RegExp(l.id,"g"),V.id)}),new RTCSessionDescription({type:o.type,sdp:f})}if(d.RTCPeerConnection){var A=c.detectBrowser(d);if(d.RTCPeerConnection.prototype.addTrack&&A.version>=65)return F(d);var C=d.RTCPeerConnection.prototype.getLocalStreams;d.RTCPeerConnection.prototype.getLocalStreams=function(){var p=this,o=C.apply(this);return this._reverseStreams=this._reverseStreams||{},o.map(function(f){return p._reverseStreams[f.id]})};var S=d.RTCPeerConnection.prototype.addStream;d.RTCPeerConnection.prototype.addStream=function(p){var o=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(function(I){if(o.getSenders().find(function(l){return l.track===I}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){var f=new d.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}S.apply(this,[p])};var n=d.RTCPeerConnection.prototype.removeStream;d.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},d.RTCPeerConnection.prototype.addTrack=function(p,o){var f=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var I=[].slice.call(arguments,1);if(1!==I.length||!I[0].getTracks().find(function(T){return T===p}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(T){return T.track===p}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var l=this._streams[o.id];if(l)l.addTrack(p),Promise.resolve().then(function(){f.dispatchEvent(new Event("negotiationneeded"))});else{var V=new d.MediaStream([p]);this._streams[o.id]=V,this._reverseStreams[V.id]=o,this.addStream(V)}return this.getSenders().find(function(T){return T.track===p})},["createOffer","createAnswer"].forEach(function(p){var o=d.RTCPeerConnection.prototype[p];d.RTCPeerConnection.prototype[p]=function(){var f=this,I=arguments;return arguments.length&&"function"==typeof arguments[0]?o.apply(this,[function(l){var V=L(f,l);I[0].apply(null,[V])},function(l){I[1]&&I[1].apply(null,l)},arguments[2]]):o.apply(this,arguments).then(function(l){return L(f,l)})}});var v=d.RTCPeerConnection.prototype.setLocalDescription;d.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=w(this,arguments[0]),v.apply(this,arguments)):v.apply(this,arguments)};var R=Object.getOwnPropertyDescriptor(d.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(d.RTCPeerConnection.prototype,"localDescription",{get:function(){var p=R.get.apply(this);return""===p.type?p:L(this,p)}}),d.RTCPeerConnection.prototype.removeTrack=function(p){var o=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var f=void 0;Object.keys(this._streams).forEach(function(I){o._streams[I].getTracks().find(function(l){return p.track===l})&&(f=o._streams[I])}),f&&(1===f.getTracks().length?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}},Ke.shimPeerConnection=function(d){if(!d.RTCPeerConnection&&d.webkitRTCPeerConnection&&(d.RTCPeerConnection=d.webkitRTCPeerConnection),d.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(w){var A=d.RTCPeerConnection.prototype[w];d.RTCPeerConnection.prototype[w]=function(){return arguments[0]=new("addIceCandidate"===w?d.RTCIceCandidate:d.RTCSessionDescription)(arguments[0]),A.apply(this,arguments)}});var L=d.RTCPeerConnection.prototype.addIceCandidate;d.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?L.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},Ke.fixNegotiationNeeded=function(d){c.wrapPeerConnectionEvent(d,"negotiationneeded",function(L){if("stable"===L.target.signalingState)return L})};var c=function(d){if(d&&d.__esModule)return d;var L={};if(null!=d)for(var w in d)Object.prototype.hasOwnProperty.call(d,w)&&(L[w]=d[w]);return L.default=d,L}(tt("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=function(F,Y){F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||F.navigator.mediaDevices&&("function"==typeof Y?F.navigator.mediaDevices.getDisplayMedia=function(e){return Y(e).then(function(i){var c=e.video&&e.video.width,d=e.video&&e.video.height;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:e.video&&e.video.frameRate||3}},c&&(e.video.mandatory.maxWidth=c),d&&(e.video.mandatory.maxHeight=d),F.navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});var F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ke.shimGetUserMedia=function(i){var c=i&&i.navigator;if(c.mediaDevices){var d=Y.detectBrowser(i),L=function(S){if("object"!==(void 0===S?"undefined":F(S))||S.mandatory||S.optional)return S;var n={};return Object.keys(S).forEach(function(v){if("require"!==v&&"advanced"!==v&&"mediaSource"!==v){var R="object"===F(S[v])?S[v]:{ideal:S[v]};void 0!==R.exact&&"number"==typeof R.exact&&(R.min=R.max=R.exact);var p=function(f,I){return f?f+I.charAt(0).toUpperCase()+I.slice(1):"deviceId"===I?"sourceId":I};if(void 0!==R.ideal){n.optional=n.optional||[];var o={};"number"==typeof R.ideal?(o[p("min",v)]=R.ideal,n.optional.push(o),(o={})[p("max",v)]=R.ideal,n.optional.push(o)):(o[p("",v)]=R.ideal,n.optional.push(o))}void 0!==R.exact&&"number"!=typeof R.exact?(n.mandatory=n.mandatory||{},n.mandatory[p("",v)]=R.exact):["min","max"].forEach(function(f){void 0!==R[f]&&(n.mandatory=n.mandatory||{},n.mandatory[p(f,v)]=R[f])})}}),S.advanced&&(n.optional=(n.optional||[]).concat(S.advanced)),n},w=function(S,n){if(d.version>=61)return n(S);if((S=JSON.parse(JSON.stringify(S)))&&"object"===F(S.audio)){var v=function(f,I,l){I in f&&!(l in f)&&(f[l]=f[I],delete f[I])};v((S=JSON.parse(JSON.stringify(S))).audio,"autoGainControl","googAutoGainControl"),v(S.audio,"noiseSuppression","googNoiseSuppression"),S.audio=L(S.audio)}if(S&&"object"===F(S.video)){var R=S.video.facingMode;R=R&&("object"===(void 0===R?"undefined":F(R))?R:{ideal:R});var p=d.version<66;if(R&&("user"===R.exact||"environment"===R.exact||"user"===R.ideal||"environment"===R.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||p)){delete S.video.facingMode;var o=void 0;if("environment"===R.exact||"environment"===R.ideal?o=["back","rear"]:"user"!==R.exact&&"user"!==R.ideal||(o=["front"]),o)return c.mediaDevices.enumerateDevices().then(function(f){var I=(f=f.filter(function(l){return"videoinput"===l.kind})).find(function(l){return o.some(function(V){return l.label.toLowerCase().includes(V)})});return!I&&f.length&&o.includes("back")&&(I=f[f.length-1]),I&&(S.video.deviceId=R.exact?{exact:I.deviceId}:{ideal:I.deviceId}),S.video=L(S.video),e("chrome: "+JSON.stringify(S)),n(S)})}S.video=L(S.video)}return e("chrome: "+JSON.stringify(S)),n(S)},A=function(S){return d.version>=64?S:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[S.name]||S.name,message:S.message,constraint:S.constraint||S.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(c.getUserMedia=function(S,n,v){w(S,function(R){c.webkitGetUserMedia(R,n,function(p){v&&v(A(p))})})}.bind(c),c.mediaDevices.getUserMedia){var C=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(S){return w(S,function(n){return C(n).then(function(v){if(n.audio&&!v.getAudioTracks().length||n.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(function(R){R.stop()}),new DOMException("","NotFoundError");return v},function(v){return Promise.reject(A(v))})})}}}};var Y=function(i){if(i&&i.__esModule)return i;var c={};if(null!=i)for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(c[d]=i[d]);return c.default=i,c}(tt("../utils.js")),e=Y.log},{"../utils.js":15}],6:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});var F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ke.shimRTCIceCandidate=function(i){if(i.RTCIceCandidate&&(!i.RTCIceCandidate||!("foundation"in i.RTCIceCandidate.prototype))){var c=i.RTCIceCandidate;i.RTCIceCandidate=function(d){if("object"===(void 0===d?"undefined":F(d))&&d.candidate&&0===d.candidate.indexOf("a=")&&((d=JSON.parse(JSON.stringify(d))).candidate=d.candidate.substr(2)),d.candidate&&d.candidate.length){var L=new c(d),w=Y.default.parseCandidate(d.candidate),A=Object.assign(L,w);return A.toJSON=function(){return{candidate:A.candidate,sdpMid:A.sdpMid,sdpMLineIndex:A.sdpMLineIndex,usernameFragment:A.usernameFragment}},A}return new c(d)},i.RTCIceCandidate.prototype=c.prototype,e.wrapPeerConnectionEvent(i,"icecandidate",function(d){return d.candidate&&Object.defineProperty(d,"candidate",{value:new i.RTCIceCandidate(d.candidate),writable:"false"}),d})}},Ke.shimMaxMessageSize=function(i){if(!i.RTCSctpTransport&&i.RTCPeerConnection){var c=e.detectBrowser(i);"sctp"in i.RTCPeerConnection.prototype||Object.defineProperty(i.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var d=function(S){if(!S||!S.sdp)return!1;var n=Y.default.splitSections(S.sdp);return n.shift(),n.some(function(v){var R=Y.default.parseMLine(v);return R&&"application"===R.kind&&-1!==R.protocol.indexOf("SCTP")})},L=function(S){var n=S.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===n||n.length<2)return-1;var v=parseInt(n[1],10);return v!=v?-1:v},w=function(S){var n=65536;return"firefox"===c.browser&&(n=c.version<57?-1===S?16384:2147483637:c.version<60?57===c.version?65535:65536:2147483637),n},A=function(S,n){var v=65536;"firefox"===c.browser&&57===c.version&&(v=65535);var R=Y.default.matchPrefix(S.sdp,"a=max-message-size:");return R.length>0?v=parseInt(R[0].substr(19),10):"firefox"===c.browser&&-1!==n&&(v=2147483637),v},C=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,d(arguments[0])){var S=L(arguments[0]),n=w(S),v=A(arguments[0],S),R=void 0;R=0===n&&0===v?Number.POSITIVE_INFINITY:0===n||0===v?Math.max(n,v):Math.min(n,v);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return R}}),this._sctp=p}return C.apply(this,arguments)}}},Ke.shimSendThrowTypeError=function(i){function c(L,w){var A=L.send;L.send=function(){var C=arguments[0],S=C.length||C.size||C.byteLength;if("open"===L.readyState&&w.sctp&&S>w.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+w.sctp.maxMessageSize+" bytes)");return A.apply(L,arguments)}}if(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype){var d=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){var L=d.apply(this,arguments);return c(L,this),L},e.wrapPeerConnectionEvent(i,"datachannel",function(L){return c(L.channel,L.target),L})}},Ke.shimConnectionState=function(i){if(i.RTCPeerConnection&&!("connectionState"in i.RTCPeerConnection.prototype)){var c=i.RTCPeerConnection.prototype;Object.defineProperty(c,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(c,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(d){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),d&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=d)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(d){var L=c[d];c[d]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(w){var A=w.target;if(A._lastConnectionState!==A.connectionState){A._lastConnectionState=A.connectionState;var C=new Event("connectionstatechange",w);A.dispatchEvent(C)}return w},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),L.apply(this,arguments)}})}},Ke.removeAllowExtmapMixed=function(i){if(i.RTCPeerConnection){var c=e.detectBrowser(i);if(!("chrome"===c.browser&&c.version>=71||"safari"===c.browser&&c.version>=605)){var d=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(L){return L&&L.sdp&&-1!==L.sdp.indexOf("\na=extmap-allow-mixed")&&(L.sdp=L.sdp.split("\n").filter(function(w){return"a=extmap-allow-mixed"!==w.trim()}).join("\n")),d.apply(this,arguments)}}}};var i,Y=(i=tt("sdp"))&&i.__esModule?i:{default:i},e=function(i){if(i&&i.__esModule)return i;var c={};if(null!=i)for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(c[d]=i[d]);return c.default=i,c}(tt("./utils"))},{"./utils":15,sdp:17}],7:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=Ke.shimGetUserMedia=void 0;var F=tt("./getusermedia");Object.defineProperty(Ke,"shimGetUserMedia",{enumerable:!0,get:function(){return F.shimGetUserMedia}});var Y=tt("./getdisplaymedia");Object.defineProperty(Ke,"shimGetDisplayMedia",{enumerable:!0,get:function(){return Y.shimGetDisplayMedia}}),Ke.shimPeerConnection=function(d){var L=e.detectBrowser(d);if(d.RTCIceGatherer&&(d.RTCIceCandidate||(d.RTCIceCandidate=function(C){return C}),d.RTCSessionDescription||(d.RTCSessionDescription=function(C){return C}),L.version<15025)){var w=Object.getOwnPropertyDescriptor(d.MediaStreamTrack.prototype,"enabled");Object.defineProperty(d.MediaStreamTrack.prototype,"enabled",{set:function(C){w.set.call(this,C);var S=new Event("enabled");S.enabled=C,this.dispatchEvent(S)}})}!d.RTCRtpSender||"dtmf"in d.RTCRtpSender.prototype||Object.defineProperty(d.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new d.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),d.RTCDtmfSender&&!d.RTCDTMFSender&&(d.RTCDTMFSender=d.RTCDtmfSender);var A=(0,c.default)(d,L.version);d.RTCPeerConnection=function(C){return C&&C.iceServers&&(C.iceServers=(0,i.filterIceServers)(C.iceServers,L.version),e.log("ICE servers after filtering:",C.iceServers)),new A(C)},d.RTCPeerConnection.prototype=A.prototype},Ke.shimReplaceTrack=function(d){!d.RTCRtpSender||"replaceTrack"in d.RTCRtpSender.prototype||(d.RTCRtpSender.prototype.replaceTrack=d.RTCRtpSender.prototype.setTrack)};var d,e=function(d){if(d&&d.__esModule)return d;var L={};if(null!=d)for(var w in d)Object.prototype.hasOwnProperty.call(d,w)&&(L[w]=d[w]);return L.default=d,L}(tt("../utils")),i=tt("./filtericeservers"),c=(d=tt("rtcpeerconnection-shim"))&&d.__esModule?d:{default:d}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.filterIceServers=function(Y,e){var i=!1;return(Y=JSON.parse(JSON.stringify(Y))).filter(function(c){if(c&&(c.urls||c.url)){var d=c.urls||c.url;c.url&&!c.urls&&F.deprecated("RTCIceServer.url","RTCIceServer.urls");var L="string"==typeof d;return L&&(d=[d]),d=d.filter(function(w){if(0===w.indexOf("stun:"))return!1;var A=w.startsWith("turn")&&!w.startsWith("turn:[")&&w.includes("transport=udp");return A&&!i?(i=!0,!0):A&&!i}),delete c.url,c.urls=L?d[0]:d,!!d.length}})};var F=function(Y){if(Y&&Y.__esModule)return Y;var e={};if(null!=Y)for(var i in Y)Object.prototype.hasOwnProperty.call(Y,i)&&(e[i]=Y[i]);return e.default=Y,e}(tt("../utils"))},{"../utils":15}],9:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=function(F){"getDisplayMedia"in F.navigator&&F.navigator.mediaDevices&&(F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||(F.navigator.mediaDevices.getDisplayMedia=F.navigator.getDisplayMedia.bind(F.navigator)))}},{}],10:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetUserMedia=function(F){var Y=F&&F.navigator,i=Y.mediaDevices.getUserMedia.bind(Y.mediaDevices);Y.mediaDevices.getUserMedia=function(c){return i(c).catch(function(d){return Promise.reject(function(c){return{name:{PermissionDeniedError:"NotAllowedError"}[c.name]||c.name,message:c.message,constraint:c.constraint,toString:function(){return this.name}}}(d))})}}},{}],11:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=Ke.shimGetUserMedia=void 0;var F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},Y=tt("./getusermedia");Object.defineProperty(Ke,"shimGetUserMedia",{enumerable:!0,get:function(){return Y.shimGetUserMedia}});var e=tt("./getdisplaymedia");Object.defineProperty(Ke,"shimGetDisplayMedia",{enumerable:!0,get:function(){return e.shimGetDisplayMedia}}),Ke.shimOnTrack=function(c){"object"===(void 0===c?"undefined":F(c))&&c.RTCTrackEvent&&"receiver"in c.RTCTrackEvent.prototype&&!("transceiver"in c.RTCTrackEvent.prototype)&&Object.defineProperty(c.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},Ke.shimPeerConnection=function(c){var d=i.detectBrowser(c);if("object"===(void 0===c?"undefined":F(c))&&(c.RTCPeerConnection||c.mozRTCPeerConnection)){!c.RTCPeerConnection&&c.mozRTCPeerConnection&&(c.RTCPeerConnection=c.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(C){var S=c.RTCPeerConnection.prototype[C];c.RTCPeerConnection.prototype[C]=function(){return arguments[0]=new("addIceCandidate"===C?c.RTCIceCandidate:c.RTCSessionDescription)(arguments[0]),S.apply(this,arguments)}});var L=c.RTCPeerConnection.prototype.addIceCandidate;c.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?L.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var w={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},A=c.RTCPeerConnection.prototype.getStats;c.RTCPeerConnection.prototype.getStats=function(C,S,n){return A.apply(this,[C||null]).then(function(v){if(d.version<53&&!S)try{v.forEach(function(R){R.type=w[R.type]||R.type})}catch(R){if("TypeError"!==R.name)throw R;v.forEach(function(p,o){v.set(o,Object.assign({},p,{type:w[p.type]||p.type}))})}return v}).then(S,n)}}},Ke.shimSenderGetStats=function(c){if("object"===(void 0===c?"undefined":F(c))&&c.RTCPeerConnection&&c.RTCRtpSender&&(!c.RTCRtpSender||!("getStats"in c.RTCRtpSender.prototype))){var d=c.RTCPeerConnection.prototype.getSenders;d&&(c.RTCPeerConnection.prototype.getSenders=function(){var w=this,A=d.apply(this,[]);return A.forEach(function(C){return C._pc=w}),A});var L=c.RTCPeerConnection.prototype.addTrack;L&&(c.RTCPeerConnection.prototype.addTrack=function(){var w=L.apply(this,arguments);return w._pc=this,w}),c.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},Ke.shimReceiverGetStats=function(c){if("object"===(void 0===c?"undefined":F(c))&&c.RTCPeerConnection&&c.RTCRtpSender&&(!c.RTCRtpSender||!("getStats"in c.RTCRtpReceiver.prototype))){var d=c.RTCPeerConnection.prototype.getReceivers;d&&(c.RTCPeerConnection.prototype.getReceivers=function(){var L=this,w=d.apply(this,[]);return w.forEach(function(A){return A._pc=L}),w}),i.wrapPeerConnectionEvent(c,"track",function(L){return L.receiver._pc=L.srcElement,L}),c.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},Ke.shimRemoveStream=function(c){!c.RTCPeerConnection||"removeStream"in c.RTCPeerConnection.prototype||(c.RTCPeerConnection.prototype.removeStream=function(d){var L=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(w){w.track&&d.getTracks().includes(w.track)&&L.removeTrack(w)})})},Ke.shimRTCDataChannel=function(c){c.DataChannel&&!c.RTCDataChannel&&(c.RTCDataChannel=c.DataChannel)};var i=function(c){if(c&&c.__esModule)return c;var d={};if(null!=c)for(var L in c)Object.prototype.hasOwnProperty.call(c,L)&&(d[L]=c[L]);return d.default=c,d}(tt("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.shimGetDisplayMedia=function(F,Y){F.navigator.mediaDevices&&"getDisplayMedia"in F.navigator.mediaDevices||F.navigator.mediaDevices&&(F.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===e.video?e.video={mediaSource:Y}:e.video.mediaSource=Y,F.navigator.mediaDevices.getUserMedia(e)})}},{}],13:[function(tt,Wt,Ke){"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});var F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Ke.shimGetUserMedia=function(e){var i=Y.detectBrowser(e),c=e&&e.navigator,d=e&&e.MediaStreamTrack;if(c.getUserMedia=function(S,n,v){Y.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(S).then(n,v)},!(i.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var L=function(S,n,v){n in S&&!(v in S)&&(S[v]=S[n],delete S[n])},w=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(S){return"object"===(void 0===S?"undefined":F(S))&&"object"===F(S.audio)&&(S=JSON.parse(JSON.stringify(S)),L(S.audio,"autoGainControl","mozAutoGainControl"),L(S.audio,"noiseSuppression","mozNoiseSuppression")),w(S)},d&&d.prototype.getSettings){var A=d.prototype.getSettings;d.prototype.getSettings=function(){var S=A.apply(this,arguments);return L(S,"mozAutoGainControl","autoGainControl"),L(S,"mozNoiseSuppression","noiseSuppression"),S}}if(d&&d.prototype.applyConstraints){var C=d.prototype.applyConstraints;d.prototype.applyConstraints=function(S){return"audio"===this.kind&&"object"===(void 0===S?"undefined":F(S))&&(S=JSON.parse(JSON.stringify(S)),L(S,"autoGainControl","mozAutoGainControl"),L(S,"noiseSuppression","mozNoiseSuppression")),C.apply(this,[S])}}}};var Y=function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(i[c]=e[c]);return i.default=e,i}(tt("../utils"))},{"../utils":15}],14:[function(tt,Wt,Ke){"use strict";function F(i){return i&&void 0!==i.video?Object.assign({},i,{video:e.compactObject(i.video)}):i}Object.defineProperty(Ke,"__esModule",{value:!0});var Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ke.shimLocalStreamsAPI=function(i){if("object"===(void 0===i?"undefined":Y(i))&&i.RTCPeerConnection){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){var c=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(d){var L=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(d)||this._localStreams.push(d),d.getTracks().forEach(function(w){return c.call(L,w,d)})},i.RTCPeerConnection.prototype.addTrack=function(d,L){return L&&(this._localStreams?this._localStreams.includes(L)||this._localStreams.push(L):this._localStreams=[L]),c.call(this,d,L)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(d){var L=this;this._localStreams||(this._localStreams=[]);var w=this._localStreams.indexOf(d);if(-1!==w){this._localStreams.splice(w,1);var A=d.getTracks();this.getSenders().forEach(function(C){A.includes(C.track)&&L.removeTrack(C)})}})}},Ke.shimRemoteStreamsAPI=function(i){if("object"===(void 0===i?"undefined":Y(i))&&i.RTCPeerConnection&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){Object.defineProperty(i.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(d){var L=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=d),this.addEventListener("track",this._onaddstreampoly=function(w){w.streams.forEach(function(A){if(L._remoteStreams||(L._remoteStreams=[]),!L._remoteStreams.includes(A)){L._remoteStreams.push(A);var C=new Event("addstream");C.stream=A,L.dispatchEvent(C)}})})}});var c=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){var d=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(L){L.streams.forEach(function(w){if(d._remoteStreams||(d._remoteStreams=[]),!(d._remoteStreams.indexOf(w)>=0)){d._remoteStreams.push(w);var A=new Event("addstream");A.stream=w,d.dispatchEvent(A)}})}),c.apply(d,arguments)}}},Ke.shimCallbacksAPI=function(i){if("object"===(void 0===i?"undefined":Y(i))&&i.RTCPeerConnection){var c=i.RTCPeerConnection.prototype,d=c.createOffer,L=c.createAnswer,w=c.setLocalDescription,A=c.setRemoteDescription,C=c.addIceCandidate;c.createOffer=function(n,v){var R=arguments.length>=2?arguments[2]:arguments[0],p=d.apply(this,[R]);return v?(p.then(n,v),Promise.resolve()):p},c.createAnswer=function(n,v){var R=arguments.length>=2?arguments[2]:arguments[0],p=L.apply(this,[R]);return v?(p.then(n,v),Promise.resolve()):p};var S=function(n,v,R){var p=w.apply(this,[n]);return R?(p.then(v,R),Promise.resolve()):p};c.setLocalDescription=S,c.setRemoteDescription=S=function(n,v,R){var p=A.apply(this,[n]);return R?(p.then(v,R),Promise.resolve()):p},c.addIceCandidate=S=function(n,v,R){var p=C.apply(this,[n]);return R?(p.then(v,R),Promise.resolve()):p}}},Ke.shimGetUserMedia=function(i){var c=i&&i.navigator;if(c.mediaDevices&&c.mediaDevices.getUserMedia){var d=c.mediaDevices,L=d.getUserMedia.bind(d);c.mediaDevices.getUserMedia=function(w){return L(F(w))}}!c.getUserMedia&&c.mediaDevices&&c.mediaDevices.getUserMedia&&(c.getUserMedia=function(w,A,C){c.mediaDevices.getUserMedia(w).then(A,C)}.bind(c))},Ke.shimConstraints=F,Ke.shimRTCIceServerUrls=function(i){var c=i.RTCPeerConnection;i.RTCPeerConnection=function(d,L){if(d&&d.iceServers){for(var w=[],A=0;A<d.iceServers.length;A++){var C=d.iceServers[A];!C.hasOwnProperty("urls")&&C.hasOwnProperty("url")?(e.deprecated("RTCIceServer.url","RTCIceServer.urls"),(C=JSON.parse(JSON.stringify(C))).urls=C.url,delete C.url,w.push(C)):w.push(d.iceServers[A])}d.iceServers=w}return new c(d,L)},i.RTCPeerConnection.prototype=c.prototype,"generateCertificate"in i.RTCPeerConnection&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})},Ke.shimTrackEventTransceiver=function(i){"object"===(void 0===i?"undefined":Y(i))&&i.RTCPeerConnection&&"receiver"in i.RTCTrackEvent.prototype&&!i.RTCTransceiver&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},Ke.shimCreateOfferLegacy=function(i){var c=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(d){if(d){void 0!==d.offerToReceiveAudio&&(d.offerToReceiveAudio=!!d.offerToReceiveAudio);var L=this.getTransceivers().find(function(A){return"audio"===A.receiver.track.kind});!1===d.offerToReceiveAudio&&L?"sendrecv"===L.direction?L.setDirection?L.setDirection("sendonly"):L.direction="sendonly":"recvonly"===L.direction&&(L.setDirection?L.setDirection("inactive"):L.direction="inactive"):!0!==d.offerToReceiveAudio||L||this.addTransceiver("audio"),void 0!==d.offerToReceiveVideo&&(d.offerToReceiveVideo=!!d.offerToReceiveVideo);var w=this.getTransceivers().find(function(A){return"video"===A.receiver.track.kind});!1===d.offerToReceiveVideo&&w?"sendrecv"===w.direction?w.setDirection?w.setDirection("sendonly"):w.direction="sendonly":"recvonly"===w.direction&&(w.setDirection?w.setDirection("inactive"):w.direction="inactive"):!0!==d.offerToReceiveVideo||w||this.addTransceiver("video")}return c.apply(this,arguments)}};var e=function(i){if(i&&i.__esModule)return i;var c={};if(null!=i)for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(c[d]=i[d]);return c.default=i,c}(tt("../utils"))},{"../utils":15}],15:[function(tt,Wt,Ke){"use strict";function Y(w,A,C){var S=w.match(A);return S&&S.length>=C&&parseInt(S[C],10)}function i(w,A,C){A&&!C.has(A.id)&&(C.set(A.id,A),Object.keys(A).forEach(function(S){S.endsWith("Id")?i(w,w.get(A[S]),C):S.endsWith("Ids")&&A[S].forEach(function(n){i(w,w.get(n),C)})}))}Object.defineProperty(Ke,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(w){return typeof w}:function(w){return w&&"function"==typeof Symbol&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w};Ke.extractVersion=Y,Ke.wrapPeerConnectionEvent=function(w,A,C){if(w.RTCPeerConnection){var S=w.RTCPeerConnection.prototype,n=S.addEventListener;S.addEventListener=function(R,p){if(R!==A)return n.apply(this,arguments);var o=function(f){var I=C(f);I&&p(I)};return this._eventMap=this._eventMap||{},this._eventMap[p]=o,n.apply(this,[R,o])};var v=S.removeEventListener;S.removeEventListener=function(R,p){if(R!==A||!this._eventMap||!this._eventMap[p])return v.apply(this,arguments);var o=this._eventMap[p];return delete this._eventMap[p],v.apply(this,[R,o])},Object.defineProperty(S,"on"+A,{get:function(){return this["_on"+A]},set:function(R){this["_on"+A]&&(this.removeEventListener(A,this["_on"+A]),delete this["_on"+A]),R&&this.addEventListener(A,this["_on"+A]=R)},enumerable:!0,configurable:!0})}},Ke.disableLog=function(w){return"boolean"!=typeof w?new Error("Argument type: "+(void 0===w?"undefined":c(w))+". Please use a boolean."):(d=w,w?"adapter.js logging disabled":"adapter.js logging enabled")},Ke.disableWarnings=function(w){return"boolean"!=typeof w?new Error("Argument type: "+(void 0===w?"undefined":c(w))+". Please use a boolean."):(L=!w,"adapter.js deprecation warnings "+(w?"disabled":"enabled"))},Ke.log=function(){if("object"===("undefined"==typeof window?"undefined":c(window))){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},Ke.deprecated=function(w,A){L&&console.warn(w+" is deprecated, please use "+A+" instead.")},Ke.detectBrowser=function(w){var A=w.navigator,C={browser:null,version:null};if(void 0===w||!w.navigator)return C.browser="Not a browser.",C;if(A.mozGetUserMedia)C.browser="firefox",C.version=Y(A.userAgent,/Firefox\/(\d+)\./,1);else if(A.webkitGetUserMedia||!1===w.isSecureContext&&w.webkitRTCPeerConnection&&!w.RTCIceGatherer)C.browser="chrome",C.version=Y(A.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(A.mediaDevices&&A.userAgent.match(/Edge\/(\d+).(\d+)$/))C.browser="edge",C.version=Y(A.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!w.RTCPeerConnection||!A.userAgent.match(/AppleWebKit\/(\d+)\./))return C.browser="Not a supported browser.",C;C.browser="safari",C.version=Y(A.userAgent,/AppleWebKit\/(\d+)\./,1)}return C},Ke.compactObject=function e(w){return"object"!==(void 0===w?"undefined":c(w))?w:Object.keys(w).reduce(function(A,C){var S="object"===c(w[C]),n=S?e(w[C]):w[C],v=S&&!Object.keys(n).length;return void 0===n||v?A:Object.assign(A,function(w,A,C){return A in w?Object.defineProperty(w,A,{value:C,enumerable:!0,configurable:!0,writable:!0}):w[A]=C,w}({},C,n))},{})},Ke.walkStats=i,Ke.filterStats=function(w,A,C){var S=C?"outbound-rtp":"inbound-rtp",n=new Map;if(null===A)return n;var v=[];return w.forEach(function(R){"track"===R.type&&R.trackIdentifier===A.id&&v.push(R)}),v.forEach(function(R){w.forEach(function(p){p.type===S&&p.trackId===R.id&&i(w,p,n)})}),n};var d=!0,L=!0},{}],16:[function(tt,Wt,Ke){"use strict";function Y(A,C,S,n,v){var R=w.writeRtpDescription(A.kind,C);if(R+=w.writeIceParameters(A.iceGatherer.getLocalParameters()),R+=w.writeDtlsParameters(A.dtlsTransport.getLocalParameters(),"offer"===S?"actpass":v||"active"),R+="a=mid:"+A.mid+"\r\n",R+=A.rtpSender&&A.rtpReceiver?"a=sendrecv\r\n":A.rtpSender?"a=sendonly\r\n":A.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",A.rtpSender){var p=A.rtpSender._initialTrackId||A.rtpSender.track.id;A.rtpSender._initialTrackId=p;var o="msid:"+(n?n.id:"-")+" "+p+"\r\n";R+="a="+o,R+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" "+o,A.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" "+o,R+="a=ssrc-group:FID "+A.sendEncodingParameters[0].ssrc+" "+A.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return R+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" cname:"+w.localCName+"\r\n",A.rtpSender&&A.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" cname:"+w.localCName+"\r\n"),R}function i(A,C){var S={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(R,p){R=parseInt(R,10);for(var o=0;o<p.length;o++)if(p[o].payloadType===R||p[o].preferredPayloadType===R)return p[o]},v=function(R,p,o,f){var I=n(R.parameters.apt,o),l=n(p.parameters.apt,f);return I&&l&&I.name.toLowerCase()===l.name.toLowerCase()};return A.codecs.forEach(function(R){for(var p=0;p<C.codecs.length;p++){var o=C.codecs[p];if(R.name.toLowerCase()===o.name.toLowerCase()&&R.clockRate===o.clockRate){if("rtx"===R.name.toLowerCase()&&R.parameters&&o.parameters.apt&&!v(R,o,A.codecs,C.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(R.numChannels,o.numChannels),S.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(f){for(var I=0;I<R.rtcpFeedback.length;I++)if(R.rtcpFeedback[I].type===f.type&&R.rtcpFeedback[I].parameter===f.parameter)return!0;return!1});break}}}),A.headerExtensions.forEach(function(R){for(var p=0;p<C.headerExtensions.length;p++){var o=C.headerExtensions[p];if(R.uri===o.uri){S.headerExtensions.push(o);break}}}),S}function c(A,C,S){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[C][A].indexOf(S)}function d(A,C){var S=A.getRemoteCandidates().find(function(n){return C.foundation===n.foundation&&C.ip===n.ip&&C.port===n.port&&C.priority===n.priority&&C.protocol===n.protocol&&C.type===n.type});return S||A.addRemoteCandidate(C),!S}function L(A,C){var S=new Error(C);return S.name=A,S.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[A],S}var w=tt("sdp");Wt.exports=function(A,C){function S(o,f){f.addTrack(o),f.dispatchEvent(new A.MediaStreamTrackEvent("addtrack",{track:o}))}function v(o,f,I,l){var V=new Event("track");V.track=f,V.receiver=I,V.transceiver={receiver:I},V.streams=l,A.setTimeout(function(){o._dispatchEvent("track",V)})}var R=function(o){var f=this,I=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(V){f[V]=I[V].bind(I)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",o=JSON.parse(JSON.stringify(o||{})),this.usingBundle="max-bundle"===o.bundlePolicy,"negotiate"===o.rtcpMuxPolicy)throw L("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(o.rtcpMuxPolicy||(o.rtcpMuxPolicy="require"),o.iceTransportPolicy){case"all":case"relay":break;default:o.iceTransportPolicy="all"}switch(o.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:o.bundlePolicy="balanced"}if(o.iceServers=function(A,C){var S=!1;return(A=JSON.parse(JSON.stringify(A))).filter(function(n){if(n&&(n.urls||n.url)){var v=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var R="string"==typeof v;return R&&(v=[v]),v=v.filter(function(p){return 0!==p.indexOf("turn:")||-1===p.indexOf("transport=udp")||-1!==p.indexOf("turn:[")||S?0===p.indexOf("stun:")&&C>=14393&&-1===p.indexOf("?transport=udp"):(S=!0,!0)}),delete n.url,n.urls=R?v[0]:v,!!v.length}})}(o.iceServers||[],C),this._iceGatherers=[],o.iceCandidatePoolSize)for(var l=o.iceCandidatePoolSize;l>0;l--)this._iceGatherers.push(new A.RTCIceGatherer({iceServers:o.iceServers,gatherPolicy:o.iceTransportPolicy}));else o.iceCandidatePoolSize=0;this._config=o,this.transceivers=[],this._sdpSessionId=w.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(R.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(R.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),R.prototype.onicecandidate=null,R.prototype.onaddstream=null,R.prototype.ontrack=null,R.prototype.onremovestream=null,R.prototype.onsignalingstatechange=null,R.prototype.oniceconnectionstatechange=null,R.prototype.onconnectionstatechange=null,R.prototype.onicegatheringstatechange=null,R.prototype.onnegotiationneeded=null,R.prototype.ondatachannel=null,R.prototype._dispatchEvent=function(o,f){this._isClosed||(this.dispatchEvent(f),"function"==typeof this["on"+o]&&this["on"+o](f))},R.prototype._emitGatheringStateChange=function(){var o=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",o)},R.prototype.getConfiguration=function(){return this._config},R.prototype.getLocalStreams=function(){return this.localStreams},R.prototype.getRemoteStreams=function(){return this.remoteStreams},R.prototype._createTransceiver=function(o,f){var l={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:o,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)l.iceTransport=this.transceivers[0].iceTransport,l.dtlsTransport=this.transceivers[0].dtlsTransport;else{var V=this._createIceAndDtlsTransports();l.iceTransport=V.iceTransport,l.dtlsTransport=V.dtlsTransport}return f||this.transceivers.push(l),l},R.prototype.addTrack=function(o,f){if(this._isClosed)throw L("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(V){return V.track===o}))throw L("InvalidAccessError","Track already exists.");for(var I,l=0;l<this.transceivers.length;l++)this.transceivers[l].track||this.transceivers[l].kind!==o.kind||(I=this.transceivers[l]);return I||(I=this._createTransceiver(o.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(f)&&this.localStreams.push(f),I.track=o,I.stream=f,I.rtpSender=new A.RTCRtpSender(o,I.dtlsTransport),I.rtpSender},R.prototype.addStream=function(o){var f=this;if(C>=15025)o.getTracks().forEach(function(l){f.addTrack(l,o)});else{var I=o.clone();o.getTracks().forEach(function(l,V){var T=I.getTracks()[V];l.addEventListener("enabled",function(b){T.enabled=b.enabled})}),I.getTracks().forEach(function(l){f.addTrack(l,I)})}},R.prototype.removeTrack=function(o){if(this._isClosed)throw L("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(o instanceof A.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(l){return l.rtpSender===o});if(!f)throw L("InvalidAccessError","Sender was not created by this connection.");var I=f.stream;f.rtpSender.stop(),f.rtpSender=null,f.track=null,f.stream=null,-1===this.transceivers.map(function(l){return l.stream}).indexOf(I)&&this.localStreams.indexOf(I)>-1&&this.localStreams.splice(this.localStreams.indexOf(I),1),this._maybeFireNegotiationNeeded()},R.prototype.removeStream=function(o){var f=this;o.getTracks().forEach(function(I){var l=f.getSenders().find(function(V){return V.track===I});l&&f.removeTrack(l)})},R.prototype.getSenders=function(){return this.transceivers.filter(function(o){return!!o.rtpSender}).map(function(o){return o.rtpSender})},R.prototype.getReceivers=function(){return this.transceivers.filter(function(o){return!!o.rtpReceiver}).map(function(o){return o.rtpReceiver})},R.prototype._createIceGatherer=function(o,f){var I=this;if(f&&o>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var l=new A.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(l,"state",{value:"new",writable:!0}),this.transceivers[o].bufferedCandidateEvents=[],this.transceivers[o].bufferCandidates=function(V){var T=!V.candidate||0===Object.keys(V.candidate).length;l.state=T?"completed":"gathering",null!==I.transceivers[o].bufferedCandidateEvents&&I.transceivers[o].bufferedCandidateEvents.push(V)},l.addEventListener("localcandidate",this.transceivers[o].bufferCandidates),l},R.prototype._gather=function(o,f){var I=this,l=this.transceivers[f].iceGatherer;if(!l.onlocalcandidate){var V=this.transceivers[f].bufferedCandidateEvents;this.transceivers[f].bufferedCandidateEvents=null,l.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates),l.onlocalcandidate=function(T){if(!(I.usingBundle&&f>0)){var b=new Event("icecandidate");b.candidate={sdpMid:o,sdpMLineIndex:f};var H=T.candidate,ne=!H||0===Object.keys(H).length;if(ne)"new"!==l.state&&"gathering"!==l.state||(l.state="completed");else{"new"===l.state&&(l.state="gathering"),H.component=1,H.ufrag=l.getLocalParameters().usernameFragment;var le=w.writeCandidate(H);b.candidate=Object.assign(b.candidate,w.parseCandidate(le)),b.candidate.candidate=le,b.candidate.toJSON=function(){return{candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex,usernameFragment:b.candidate.usernameFragment}}}var W=w.getMediaSections(I._localDescription.sdp);W[b.candidate.sdpMLineIndex]+=ne?"a=end-of-candidates\r\n":"a="+b.candidate.candidate+"\r\n",I._localDescription.sdp=w.getDescription(I._localDescription.sdp)+W.join("");var be=I.transceivers.every(function(de){return de.iceGatherer&&"completed"===de.iceGatherer.state});"gathering"!==I.iceGatheringState&&(I.iceGatheringState="gathering",I._emitGatheringStateChange()),ne||I._dispatchEvent("icecandidate",b),be&&(I._dispatchEvent("icecandidate",new Event("icecandidate")),I.iceGatheringState="complete",I._emitGatheringStateChange())}},A.setTimeout(function(){V.forEach(function(T){l.onlocalcandidate(T)})},0)}},R.prototype._createIceAndDtlsTransports=function(){var o=this,f=new A.RTCIceTransport(null);f.onicestatechange=function(){o._updateIceConnectionState(),o._updateConnectionState()};var I=new A.RTCDtlsTransport(f);return I.ondtlsstatechange=function(){o._updateConnectionState()},I.onerror=function(){Object.defineProperty(I,"state",{value:"failed",writable:!0}),o._updateConnectionState()},{iceTransport:f,dtlsTransport:I}},R.prototype._disposeIceAndDtlsTransports=function(o){var f=this.transceivers[o].iceGatherer;f&&(delete f.onlocalcandidate,delete this.transceivers[o].iceGatherer);var I=this.transceivers[o].iceTransport;I&&(delete I.onicestatechange,delete this.transceivers[o].iceTransport);var l=this.transceivers[o].dtlsTransport;l&&(delete l.ondtlsstatechange,delete l.onerror,delete this.transceivers[o].dtlsTransport)},R.prototype._transceive=function(o,f,I){var l=i(o.localCapabilities,o.remoteCapabilities);f&&o.rtpSender&&(l.encodings=o.sendEncodingParameters,l.rtcp={cname:w.localCName,compound:o.rtcpParameters.compound},o.recvEncodingParameters.length&&(l.rtcp.ssrc=o.recvEncodingParameters[0].ssrc),o.rtpSender.send(l)),I&&o.rtpReceiver&&l.codecs.length>0&&("video"===o.kind&&o.recvEncodingParameters&&C<15019&&o.recvEncodingParameters.forEach(function(V){delete V.rtx}),l.encodings=o.recvEncodingParameters.length?o.recvEncodingParameters:[{}],l.rtcp={compound:o.rtcpParameters.compound},o.rtcpParameters.cname&&(l.rtcp.cname=o.rtcpParameters.cname),o.sendEncodingParameters.length&&(l.rtcp.ssrc=o.sendEncodingParameters[0].ssrc),o.rtpReceiver.receive(l))},R.prototype.setLocalDescription=function(o){var I,l,f=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(L("TypeError",'Unsupported type "'+o.type+'"'));if(!c("setLocalDescription",o.type,f.signalingState)||f._isClosed)return Promise.reject(L("InvalidStateError","Can not set local "+o.type+" in state "+f.signalingState));if("offer"===o.type)I=w.splitSections(o.sdp),l=I.shift(),I.forEach(function(T,b){var H=w.parseRtpParameters(T);f.transceivers[b].localCapabilities=H}),f.transceivers.forEach(function(T,b){f._gather(T.mid,b)});else if("answer"===o.type){I=w.splitSections(f._remoteDescription.sdp),l=I.shift();var V=w.matchPrefix(l,"a=ice-lite").length>0;I.forEach(function(T,b){var H=f.transceivers[b],ne=H.iceGatherer,le=H.iceTransport,W=H.dtlsTransport,be=H.localCapabilities,de=H.remoteCapabilities;if(!(w.isRejected(T)&&0===w.matchPrefix(T,"a=bundle-only").length||H.rejected)){var ce=w.getIceParameters(T,l),Ee=w.getDtlsParameters(T,l);V&&(Ee.role="server"),f.usingBundle&&0!==b||(f._gather(H.mid,b),"new"===le.state&&le.start(ne,ce,V?"controlling":"controlled"),"new"===W.state&&W.start(Ee));var Ne=i(be,de);f._transceive(H,Ne.codecs.length>0,!1)}})}return f._localDescription={type:o.type,sdp:o.sdp},f._updateSignalingState("offer"===o.type?"have-local-offer":"stable"),Promise.resolve()},R.prototype.setRemoteDescription=function(o){var f=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(L("TypeError",'Unsupported type "'+o.type+'"'));if(!c("setRemoteDescription",o.type,f.signalingState)||f._isClosed)return Promise.reject(L("InvalidStateError","Can not set remote "+o.type+" in state "+f.signalingState));var I={};f.remoteStreams.forEach(function(le){I[le.id]=le});var l=[],V=w.splitSections(o.sdp),T=V.shift(),b=w.matchPrefix(T,"a=ice-lite").length>0,H=w.matchPrefix(T,"a=group:BUNDLE ").length>0;f.usingBundle=H;var ne=w.matchPrefix(T,"a=ice-options:")[0];return f.canTrickleIceCandidates=!!ne&&ne.substr(14).split(" ").indexOf("trickle")>=0,V.forEach(function(le,W){var be=w.splitLines(le),de=w.getKind(le),ce=w.isRejected(le)&&0===w.matchPrefix(le,"a=bundle-only").length,Ee=be[0].substr(2).split(" ")[2],Ne=w.getDirection(le,T),Oe=w.parseMsid(le),He=w.getMid(le)||w.generateIdentifier();if(ce||"application"===de&&("DTLS/SCTP"===Ee||"UDP/DTLS/SCTP"===Ee))f.transceivers[W]={mid:He,kind:de,protocol:Ee,rejected:!0};else{!ce&&f.transceivers[W]&&f.transceivers[W].rejected&&(f.transceivers[W]=f._createTransceiver(de,!0));var ke,ze,we,gt,ft,at,Ze,ie,bt,Rt,Ct,et=w.parseRtpParameters(le);ce||(Rt=w.getIceParameters(le,T),(Ct=w.getDtlsParameters(le,T)).role="client"),Ze=w.parseRtpEncodingParameters(le);var wt=w.parseRtcpParameters(le),Be=w.matchPrefix(le,"a=end-of-candidates",T).length>0,Lt=w.matchPrefix(le,"a=candidate:").map(function(Pt){return w.parseCandidate(Pt)}).filter(function(Pt){return 1===Pt.component});if(("offer"===o.type||"answer"===o.type)&&!ce&&H&&W>0&&f.transceivers[W]&&(f._disposeIceAndDtlsTransports(W),f.transceivers[W].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[W].iceTransport=f.transceivers[0].iceTransport,f.transceivers[W].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[W].rtpSender&&f.transceivers[W].rtpSender.setTransport(f.transceivers[0].dtlsTransport),f.transceivers[W].rtpReceiver&&f.transceivers[W].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport)),"offer"!==o.type||ce)"answer"!==o.type||ce||(ze=(ke=f.transceivers[W]).iceGatherer,we=ke.iceTransport,gt=ke.dtlsTransport,ft=ke.rtpReceiver,at=ke.sendEncodingParameters,ie=ke.localCapabilities,f.transceivers[W].recvEncodingParameters=Ze,f.transceivers[W].remoteCapabilities=et,f.transceivers[W].rtcpParameters=wt,Lt.length&&"new"===we.state&&(!b&&!Be||H&&0!==W?Lt.forEach(function(Pt){d(ke.iceTransport,Pt)}):we.setRemoteCandidates(Lt)),H&&0!==W||("new"===we.state&&we.start(ze,Rt,"controlling"),"new"===gt.state&&gt.start(Ct)),!i(ke.localCapabilities,ke.remoteCapabilities).codecs.filter(function(Pt){return"rtx"===Pt.name.toLowerCase()}).length&&ke.sendEncodingParameters[0].rtx&&delete ke.sendEncodingParameters[0].rtx,f._transceive(ke,"sendrecv"===Ne||"recvonly"===Ne,"sendrecv"===Ne||"sendonly"===Ne),!ft||"sendrecv"!==Ne&&"sendonly"!==Ne?delete ke.rtpReceiver:(bt=ft.track,Oe?(I[Oe.stream]||(I[Oe.stream]=new A.MediaStream),S(bt,I[Oe.stream]),l.push([bt,ft,I[Oe.stream]])):(I.default||(I.default=new A.MediaStream),S(bt,I.default),l.push([bt,ft,I.default]))));else{(ke=f.transceivers[W]||f._createTransceiver(de)).mid=He,ke.iceGatherer||(ke.iceGatherer=f._createIceGatherer(W,H)),Lt.length&&"new"===ke.iceTransport.state&&(!Be||H&&0!==W?Lt.forEach(function(Pt){d(ke.iceTransport,Pt)}):ke.iceTransport.setRemoteCandidates(Lt)),ie=A.RTCRtpReceiver.getCapabilities(de),C<15019&&(ie.codecs=ie.codecs.filter(function(Pt){return"rtx"!==Pt.name})),at=ke.sendEncodingParameters||[{ssrc:1001*(2*W+2)}];var Ge,jt=!1;"sendrecv"===Ne||"sendonly"===Ne?(jt=!ke.rtpReceiver,ft=ke.rtpReceiver||new A.RTCRtpReceiver(ke.dtlsTransport,de),jt&&(bt=ft.track,Oe&&"-"===Oe.stream||(Oe?(I[Oe.stream]||(I[Oe.stream]=new A.MediaStream,Object.defineProperty(I[Oe.stream],"id",{get:function(){return Oe.stream}})),Object.defineProperty(bt,"id",{get:function(){return Oe.track}}),Ge=I[Oe.stream]):(I.default||(I.default=new A.MediaStream),Ge=I.default)),Ge&&(S(bt,Ge),ke.associatedRemoteMediaStreams.push(Ge)),l.push([bt,ft,Ge]))):ke.rtpReceiver&&ke.rtpReceiver.track&&(ke.associatedRemoteMediaStreams.forEach(function(Pt){var z=Pt.getTracks().find(function(M){return M.id===ke.rtpReceiver.track.id});z&&function(o,f){f.removeTrack(o),f.dispatchEvent(new A.MediaStreamTrackEvent("removetrack",{track:o}))}(z,Pt)}),ke.associatedRemoteMediaStreams=[]),ke.localCapabilities=ie,ke.remoteCapabilities=et,ke.rtpReceiver=ft,ke.rtcpParameters=wt,ke.sendEncodingParameters=at,ke.recvEncodingParameters=Ze,f._transceive(f.transceivers[W],!1,jt)}}}),void 0===f._dtlsRole&&(f._dtlsRole="offer"===o.type?"active":"passive"),f._remoteDescription={type:o.type,sdp:o.sdp},f._updateSignalingState("offer"===o.type?"have-remote-offer":"stable"),Object.keys(I).forEach(function(le){var W=I[le];if(W.getTracks().length){if(-1===f.remoteStreams.indexOf(W)){f.remoteStreams.push(W);var be=new Event("addstream");be.stream=W,A.setTimeout(function(){f._dispatchEvent("addstream",be)})}l.forEach(function(de){W.id===de[2].id&&v(f,de[0],de[1],[W])})}}),l.forEach(function(le){le[2]||v(f,le[0],le[1],[])}),A.setTimeout(function(){f&&f.transceivers&&f.transceivers.forEach(function(le){le.iceTransport&&"new"===le.iceTransport.state&&le.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),le.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},R.prototype.close=function(){this.transceivers.forEach(function(o){o.iceTransport&&o.iceTransport.stop(),o.dtlsTransport&&o.dtlsTransport.stop(),o.rtpSender&&o.rtpSender.stop(),o.rtpReceiver&&o.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},R.prototype._updateSignalingState=function(o){this.signalingState=o;var f=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",f)},R.prototype._maybeFireNegotiationNeeded=function(){var o=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,A.setTimeout(function(){if(o.needNegotiation){o.needNegotiation=!1;var f=new Event("negotiationneeded");o._dispatchEvent("negotiationneeded",f)}},0))},R.prototype._updateIceConnectionState=function(){var o,f={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(l){l.iceTransport&&!l.rejected&&f[l.iceTransport.state]++}),o="new",f.failed>0?o="failed":f.checking>0?o="checking":f.disconnected>0?o="disconnected":f.new>0?o="new":f.connected>0?o="connected":f.completed>0&&(o="completed"),o!==this.iceConnectionState){this.iceConnectionState=o;var I=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",I)}},R.prototype._updateConnectionState=function(){var o,f={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(l){l.iceTransport&&l.dtlsTransport&&!l.rejected&&(f[l.iceTransport.state]++,f[l.dtlsTransport.state]++)}),f.connected+=f.completed,o="new",f.failed>0?o="failed":f.connecting>0?o="connecting":f.disconnected>0?o="disconnected":f.new>0?o="new":f.connected>0&&(o="connected"),o!==this.connectionState){this.connectionState=o;var I=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",I)}},R.prototype.createOffer=function(){var o=this;if(o._isClosed)return Promise.reject(L("InvalidStateError","Can not call createOffer after close"));var f=o.transceivers.filter(function(b){return"audio"===b.kind}).length,I=o.transceivers.filter(function(b){return"video"===b.kind}).length,l=arguments[0];if(l){if(l.mandatory||l.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==l.offerToReceiveAudio&&(f=!0===l.offerToReceiveAudio?1:!1===l.offerToReceiveAudio?0:l.offerToReceiveAudio),void 0!==l.offerToReceiveVideo&&(I=!0===l.offerToReceiveVideo?1:!1===l.offerToReceiveVideo?0:l.offerToReceiveVideo)}for(o.transceivers.forEach(function(b){"audio"===b.kind?--f<0&&(b.wantReceive=!1):"video"===b.kind&&--I<0&&(b.wantReceive=!1)});f>0||I>0;)f>0&&(o._createTransceiver("audio"),f--),I>0&&(o._createTransceiver("video"),I--);var V=w.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.transceivers.forEach(function(b,H){var ne=b.track,le=b.kind,W=b.mid||w.generateIdentifier();b.mid=W,b.iceGatherer||(b.iceGatherer=o._createIceGatherer(H,o.usingBundle));var be=A.RTCRtpSender.getCapabilities(le);C<15019&&(be.codecs=be.codecs.filter(function(ce){return"rtx"!==ce.name})),be.codecs.forEach(function(ce){"H264"===ce.name&&void 0===ce.parameters["level-asymmetry-allowed"]&&(ce.parameters["level-asymmetry-allowed"]="1"),b.remoteCapabilities&&b.remoteCapabilities.codecs&&b.remoteCapabilities.codecs.forEach(function(Ee){ce.name.toLowerCase()===Ee.name.toLowerCase()&&ce.clockRate===Ee.clockRate&&(ce.preferredPayloadType=Ee.payloadType)})}),be.headerExtensions.forEach(function(ce){(b.remoteCapabilities&&b.remoteCapabilities.headerExtensions||[]).forEach(function(Ee){ce.uri===Ee.uri&&(ce.id=Ee.id)})});var de=b.sendEncodingParameters||[{ssrc:1001*(2*H+1)}];ne&&C>=15019&&"video"===le&&!de[0].rtx&&(de[0].rtx={ssrc:de[0].ssrc+1}),b.wantReceive&&(b.rtpReceiver=new A.RTCRtpReceiver(b.dtlsTransport,le)),b.localCapabilities=be,b.sendEncodingParameters=de}),"max-compat"!==o._config.bundlePolicy&&(V+="a=group:BUNDLE "+o.transceivers.map(function(b){return b.mid}).join(" ")+"\r\n"),V+="a=ice-options:trickle\r\n",o.transceivers.forEach(function(b,H){V+=Y(b,b.localCapabilities,"offer",b.stream,o._dtlsRole),V+="a=rtcp-rsize\r\n",!b.iceGatherer||"new"===o.iceGatheringState||0!==H&&o.usingBundle||(b.iceGatherer.getLocalCandidates().forEach(function(ne){ne.component=1,V+="a="+w.writeCandidate(ne)+"\r\n"}),"completed"===b.iceGatherer.state&&(V+="a=end-of-candidates\r\n"))});var T=new A.RTCSessionDescription({type:"offer",sdp:V});return Promise.resolve(T)},R.prototype.createAnswer=function(){var o=this;if(o._isClosed)return Promise.reject(L("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==o.signalingState&&"have-local-pranswer"!==o.signalingState)return Promise.reject(L("InvalidStateError","Can not call createAnswer in signalingState "+o.signalingState));var f=w.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.usingBundle&&(f+="a=group:BUNDLE "+o.transceivers.map(function(V){return V.mid}).join(" ")+"\r\n"),f+="a=ice-options:trickle\r\n";var I=w.getMediaSections(o._remoteDescription.sdp).length;o.transceivers.forEach(function(V,T){if(!(T+1>I)){if(V.rejected)return"application"===V.kind?f+="DTLS/SCTP"===V.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+V.protocol+" webrtc-datachannel\r\n":"audio"===V.kind?f+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===V.kind&&(f+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(f+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+V.mid+"\r\n");var b;V.stream&&("audio"===V.kind?b=V.stream.getAudioTracks()[0]:"video"===V.kind&&(b=V.stream.getVideoTracks()[0]),b&&C>=15019&&"video"===V.kind&&!V.sendEncodingParameters[0].rtx&&(V.sendEncodingParameters[0].rtx={ssrc:V.sendEncodingParameters[0].ssrc+1}));var H=i(V.localCapabilities,V.remoteCapabilities);!H.codecs.filter(function(ne){return"rtx"===ne.name.toLowerCase()}).length&&V.sendEncodingParameters[0].rtx&&delete V.sendEncodingParameters[0].rtx,f+=Y(V,H,"answer",V.stream,o._dtlsRole),V.rtcpParameters&&V.rtcpParameters.reducedSize&&(f+="a=rtcp-rsize\r\n")}});var l=new A.RTCSessionDescription({type:"answer",sdp:f});return Promise.resolve(l)},R.prototype.addIceCandidate=function(o){var f,I=this;return o&&void 0===o.sdpMLineIndex&&!o.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(l,V){if(!I._remoteDescription)return V(L("InvalidStateError","Can not add ICE candidate without a remote description"));if(o&&""!==o.candidate){var T=o.sdpMLineIndex;if(o.sdpMid)for(var b=0;b<I.transceivers.length;b++)if(I.transceivers[b].mid===o.sdpMid){T=b;break}var H=I.transceivers[T];if(!H)return V(L("OperationError","Can not add ICE candidate"));if(H.rejected)return l();var ne=Object.keys(o.candidate).length>0?w.parseCandidate(o.candidate):{};if("tcp"===ne.protocol&&(0===ne.port||9===ne.port)||ne.component&&1!==ne.component)return l();if((0===T||T>0&&H.iceTransport!==I.transceivers[0].iceTransport)&&!d(H.iceTransport,ne))return V(L("OperationError","Can not add ICE candidate"));var le=o.candidate.trim();0===le.indexOf("a=")&&(le=le.substr(2)),(f=w.getMediaSections(I._remoteDescription.sdp))[T]+="a="+(ne.type?le:"end-of-candidates")+"\r\n",I._remoteDescription.sdp=w.getDescription(I._remoteDescription.sdp)+f.join("")}else for(var W=0;W<I.transceivers.length&&(I.transceivers[W].rejected||(I.transceivers[W].iceTransport.addRemoteCandidate({}),(f=w.getMediaSections(I._remoteDescription.sdp))[W]+="a=end-of-candidates\r\n",I._remoteDescription.sdp=w.getDescription(I._remoteDescription.sdp)+f.join(""),!I.usingBundle));W++);l()})},R.prototype.getStats=function(o){if(o&&o instanceof A.MediaStreamTrack){var f=null;if(this.transceivers.forEach(function(l){l.rtpSender&&l.rtpSender.track===o?f=l.rtpSender:l.rtpReceiver&&l.rtpReceiver.track===o&&(f=l.rtpReceiver)}),!f)throw L("InvalidAccessError","Invalid selector.");return f.getStats()}var I=[];return this.transceivers.forEach(function(l){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(V){l[V]&&I.push(l[V].getStats())})}),Promise.all(I).then(function(l){var V=new Map;return l.forEach(function(T){T.forEach(function(b){V.set(b.id,b)})}),V})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(o){var f=A[o];if(f&&f.prototype&&f.prototype.getStats){var I=f.prototype.getStats;f.prototype.getStats=function(){return I.apply(this).then(function(l){var V=new Map;return Object.keys(l).forEach(function(T){l[T].type=function(A){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[A.type]||A.type}(l[T]),V.set(T,l[T])}),V})}}});var p=["createOffer","createAnswer"];return p.forEach(function(o){var f=R.prototype[o];R.prototype[o]=function(){var I=arguments;return"function"==typeof I[0]||"function"==typeof I[1]?f.apply(this,[arguments[2]]).then(function(l){"function"==typeof I[0]&&I[0].apply(null,[l])},function(l){"function"==typeof I[1]&&I[1].apply(null,[l])}):f.apply(this,arguments)}}),(p=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(o){var f=R.prototype[o];R.prototype[o]=function(){var I=arguments;return"function"==typeof I[1]||"function"==typeof I[2]?f.apply(this,arguments).then(function(){"function"==typeof I[1]&&I[1].apply(null)},function(l){"function"==typeof I[2]&&I[2].apply(null,[l])}):f.apply(this,arguments)}}),["getStats"].forEach(function(o){var f=R.prototype[o];R.prototype[o]=function(){var I=arguments;return"function"==typeof I[1]?f.apply(this,arguments).then(function(){"function"==typeof I[1]&&I[1].apply(null)}):f.apply(this,arguments)}}),R}},{sdp:17}],17:[function(tt,Wt,Ke){"use strict";var F={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};F.localCName=F.generateIdentifier(),F.splitLines=function(Y){return Y.trim().split("\n").map(function(e){return e.trim()})},F.splitSections=function(Y){return Y.split("\nm=").map(function(e,i){return(i>0?"m="+e:e).trim()+"\r\n"})},F.getDescription=function(Y){var e=F.splitSections(Y);return e&&e[0]},F.getMediaSections=function(Y){var e=F.splitSections(Y);return e.shift(),e},F.matchPrefix=function(Y,e){return F.splitLines(Y).filter(function(i){return 0===i.indexOf(e)})},F.parseCandidate=function(Y){for(var e,i={foundation:(e=0===Y.indexOf("a=candidate:")?Y.substring(12).split(" "):Y.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},c=8;c<e.length;c+=2)switch(e[c]){case"raddr":i.relatedAddress=e[c+1];break;case"rport":i.relatedPort=parseInt(e[c+1],10);break;case"tcptype":i.tcpType=e[c+1];break;case"ufrag":i.ufrag=e[c+1],i.usernameFragment=e[c+1];break;default:i[e[c]]=e[c+1]}return i},F.writeCandidate=function(Y){var e=[];e.push(Y.foundation),e.push(Y.component),e.push(Y.protocol.toUpperCase()),e.push(Y.priority),e.push(Y.address||Y.ip),e.push(Y.port);var i=Y.type;return e.push("typ"),e.push(i),"host"!==i&&Y.relatedAddress&&Y.relatedPort&&(e.push("raddr"),e.push(Y.relatedAddress),e.push("rport"),e.push(Y.relatedPort)),Y.tcpType&&"tcp"===Y.protocol.toLowerCase()&&(e.push("tcptype"),e.push(Y.tcpType)),(Y.usernameFragment||Y.ufrag)&&(e.push("ufrag"),e.push(Y.usernameFragment||Y.ufrag)),"candidate:"+e.join(" ")},F.parseIceOptions=function(Y){return Y.substr(14).split(" ")},F.parseRtpMap=function(Y){var e=Y.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.channels=3===e.length?parseInt(e[2],10):1,i.numChannels=i.channels,i},F.writeRtpMap=function(Y){var e=Y.payloadType;void 0!==Y.preferredPayloadType&&(e=Y.preferredPayloadType);var i=Y.channels||Y.numChannels||1;return"a=rtpmap:"+e+" "+Y.name+"/"+Y.clockRate+(1!==i?"/"+i:"")+"\r\n"},F.parseExtmap=function(Y){var e=Y.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},F.writeExtmap=function(Y){return"a=extmap:"+(Y.id||Y.preferredId)+(Y.direction&&"sendrecv"!==Y.direction?"/"+Y.direction:"")+" "+Y.uri+"\r\n"},F.parseFmtp=function(Y){for(var e,i={},c=Y.substr(Y.indexOf(" ")+1).split(";"),d=0;d<c.length;d++)i[(e=c[d].trim().split("="))[0].trim()]=e[1];return i},F.writeFmtp=function(Y){var e="",i=Y.payloadType;if(void 0!==Y.preferredPayloadType&&(i=Y.preferredPayloadType),Y.parameters&&Object.keys(Y.parameters).length){var c=[];Object.keys(Y.parameters).forEach(function(d){c.push(Y.parameters[d]?d+"="+Y.parameters[d]:d)}),e+="a=fmtp:"+i+" "+c.join(";")+"\r\n"}return e},F.parseRtcpFb=function(Y){var e=Y.substr(Y.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},F.writeRtcpFb=function(Y){var e="",i=Y.payloadType;return void 0!==Y.preferredPayloadType&&(i=Y.preferredPayloadType),Y.rtcpFeedback&&Y.rtcpFeedback.length&&Y.rtcpFeedback.forEach(function(c){e+="a=rtcp-fb:"+i+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+"\r\n"}),e},F.parseSsrcMedia=function(Y){var e=Y.indexOf(" "),i={ssrc:parseInt(Y.substr(7,e-7),10)},c=Y.indexOf(":",e);return c>-1?(i.attribute=Y.substr(e+1,c-e-1),i.value=Y.substr(c+1)):i.attribute=Y.substr(e+1),i},F.parseSsrcGroup=function(Y){var e=Y.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(i){return parseInt(i,10)})}},F.getMid=function(Y){var e=F.matchPrefix(Y,"a=mid:")[0];if(e)return e.substr(6)},F.parseFingerprint=function(Y){var e=Y.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},F.getDtlsParameters=function(Y,e){return{role:"auto",fingerprints:F.matchPrefix(Y+e,"a=fingerprint:").map(F.parseFingerprint)}},F.writeDtlsParameters=function(Y,e){var i="a=setup:"+e+"\r\n";return Y.fingerprints.forEach(function(c){i+="a=fingerprint:"+c.algorithm+" "+c.value+"\r\n"}),i},F.getIceParameters=function(Y,e){var i=F.splitLines(Y);return{usernameFragment:(i=i.concat(F.splitLines(e))).filter(function(c){return 0===c.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(c){return 0===c.indexOf("a=ice-pwd:")})[0].substr(10)}},F.writeIceParameters=function(Y){return"a=ice-ufrag:"+Y.usernameFragment+"\r\na=ice-pwd:"+Y.password+"\r\n"},F.parseRtpParameters=function(Y){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=F.splitLines(Y)[0].split(" "),c=3;c<i.length;c++){var d=i[c],L=F.matchPrefix(Y,"a=rtpmap:"+d+" ")[0];if(L){var w=F.parseRtpMap(L),A=F.matchPrefix(Y,"a=fmtp:"+d+" ");switch(w.parameters=A.length?F.parseFmtp(A[0]):{},w.rtcpFeedback=F.matchPrefix(Y,"a=rtcp-fb:"+d+" ").map(F.parseRtcpFb),e.codecs.push(w),w.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(w.name.toUpperCase())}}}return F.matchPrefix(Y,"a=extmap:").forEach(function(C){e.headerExtensions.push(F.parseExtmap(C))}),e},F.writeRtpDescription=function(Y,e){var i="";i+="m="+Y+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(d){return void 0!==d.preferredPayloadType?d.preferredPayloadType:d.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(d){i+=F.writeRtpMap(d),i+=F.writeFmtp(d),i+=F.writeRtcpFb(d)});var c=0;return e.codecs.forEach(function(d){d.maxptime>c&&(c=d.maxptime)}),c>0&&(i+="a=maxptime:"+c+"\r\n"),i+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(d){i+=F.writeExtmap(d)}),i},F.parseRtpEncodingParameters=function(Y){var e,i=[],c=F.parseRtpParameters(Y),d=-1!==c.fecMechanisms.indexOf("RED"),L=-1!==c.fecMechanisms.indexOf("ULPFEC"),w=F.matchPrefix(Y,"a=ssrc:").map(function(n){return F.parseSsrcMedia(n)}).filter(function(n){return"cname"===n.attribute}),A=w.length>0&&w[0].ssrc,C=F.matchPrefix(Y,"a=ssrc-group:FID").map(function(n){return n.substr(17).split(" ").map(function(v){return parseInt(v,10)})});C.length>0&&C[0].length>1&&C[0][0]===A&&(e=C[0][1]),c.codecs.forEach(function(n){if("RTX"===n.name.toUpperCase()&&n.parameters.apt){var v={ssrc:A,codecPayloadType:parseInt(n.parameters.apt,10)};A&&e&&(v.rtx={ssrc:e}),i.push(v),d&&((v=JSON.parse(JSON.stringify(v))).fec={ssrc:A,mechanism:L?"red+ulpfec":"red"},i.push(v))}}),0===i.length&&A&&i.push({ssrc:A});var S=F.matchPrefix(Y,"b=");return S.length&&(S=0===S[0].indexOf("b=TIAS:")?parseInt(S[0].substr(7),10):0===S[0].indexOf("b=AS:")?1e3*parseInt(S[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(n){n.maxBitrate=S})),i},F.parseRtcpParameters=function(Y){var e={},i=F.matchPrefix(Y,"a=ssrc:").map(function(L){return F.parseSsrcMedia(L)}).filter(function(L){return"cname"===L.attribute})[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);var c=F.matchPrefix(Y,"a=rtcp-rsize");e.reducedSize=c.length>0,e.compound=0===c.length;var d=F.matchPrefix(Y,"a=rtcp-mux");return e.mux=d.length>0,e},F.parseMsid=function(Y){var e,i=F.matchPrefix(Y,"a=msid:");if(1===i.length)return{stream:(e=i[0].substr(7).split(" "))[0],track:e[1]};var c=F.matchPrefix(Y,"a=ssrc:").map(function(d){return F.parseSsrcMedia(d)}).filter(function(d){return"msid"===d.attribute});return c.length>0?{stream:(e=c[0].value.split(" "))[0],track:e[1]}:void 0},F.generateSessionId=function(){return Math.random().toString().substr(2,21)},F.writeSessionBoilerplate=function(Y,e,i){var d=void 0!==e?e:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(Y||F.generateSessionId())+" "+d+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},F.writeMediaSection=function(Y,e,i,c){var d=F.writeRtpDescription(Y.kind,e);if(d+=F.writeIceParameters(Y.iceGatherer.getLocalParameters()),d+=F.writeDtlsParameters(Y.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),d+="a=mid:"+Y.mid+"\r\n",d+=Y.direction?"a="+Y.direction+"\r\n":Y.rtpSender&&Y.rtpReceiver?"a=sendrecv\r\n":Y.rtpSender?"a=sendonly\r\n":Y.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",Y.rtpSender){var L="msid:"+c.id+" "+Y.rtpSender.track.id+"\r\n";d+="a="+L,d+="a=ssrc:"+Y.sendEncodingParameters[0].ssrc+" "+L,Y.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+Y.sendEncodingParameters[0].rtx.ssrc+" "+L,d+="a=ssrc-group:FID "+Y.sendEncodingParameters[0].ssrc+" "+Y.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return d+="a=ssrc:"+Y.sendEncodingParameters[0].ssrc+" cname:"+F.localCName+"\r\n",Y.rtpSender&&Y.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+Y.sendEncodingParameters[0].rtx.ssrc+" cname:"+F.localCName+"\r\n"),d},F.getDirection=function(Y,e){for(var i=F.splitLines(Y),c=0;c<i.length;c++)switch(i[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[c].substr(2)}return e?F.getDirection(e):"sendrecv"},F.getKind=function(Y){return F.splitLines(Y)[0].split(" ")[0].substr(2)},F.isRejected=function(Y){return"0"===Y.split(" ",2)[1]},F.parseMLine=function(Y){var e=F.splitLines(Y)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},F.parseOLine=function(Y){var e=F.matchPrefix(Y,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},F.isValidSDP=function(Y){if("string"!=typeof Y||0===Y.length)return!1;for(var e=F.splitLines(Y),i=0;i<e.length;i++)if(e[i].length<2||"="!==e[i].charAt(1))return!1;return!0},"object"==typeof Wt&&(Wt.exports=F)},{}]},{},[1])(1)}),function(tt){"use strict";function Wt(T){if("string"!=typeof T&&(T=String(T)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(T))throw new TypeError("Invalid character in header field name");return T.toLowerCase()}function Ke(T){return"string"!=typeof T&&(T=String(T)),T}function F(T){var b={next:function(){var H=T.shift();return{done:void 0===H,value:H}}};return p.iterable&&(b[Symbol.iterator]=function(){return b}),b}function Y(T){this.map={},T instanceof Y?T.forEach(function(b,H){this.append(H,b)},this):Array.isArray(T)?T.forEach(function(b){this.append(b[0],b[1])},this):T&&Object.getOwnPropertyNames(T).forEach(function(b){this.append(b,T[b])},this)}function e(T){if(T.bodyUsed)return Promise.reject(new TypeError("Already read"));T.bodyUsed=!0}function i(T){return new Promise(function(b,H){T.onload=function(){b(T.result)},T.onerror=function(){H(T.error)}})}function c(T){var b=new FileReader,H=i(b);return b.readAsArrayBuffer(T),H}function w(T){if(T.slice)return T.slice(0);var b=new Uint8Array(T.byteLength);return b.set(new Uint8Array(T)),b.buffer}function A(){return this.bodyUsed=!1,this._initBody=function(T){if(this._bodyInit=T,T)if("string"==typeof T)this._bodyText=T;else if(p.blob&&Blob.prototype.isPrototypeOf(T))this._bodyBlob=T;else if(p.formData&&FormData.prototype.isPrototypeOf(T))this._bodyFormData=T;else if(p.searchParams&&URLSearchParams.prototype.isPrototypeOf(T))this._bodyText=T.toString();else if(p.arrayBuffer&&p.blob&&f(T))this._bodyArrayBuffer=w(T.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(T)&&!I(T))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=w(T)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof T?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var T=e(this);if(T)return T;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?e(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(c)}),this.text=function(){var T=e(this);if(T)return T;if(this._bodyBlob)return function(T){var b=new FileReader,H=i(b);return b.readAsText(T),H}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(T){for(var b=new Uint8Array(T),H=new Array(b.length),ne=0;ne<b.length;ne++)H[ne]=String.fromCharCode(b[ne]);return H.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(n)}),this.json=function(){return this.text().then(JSON.parse)},this}function S(T,b){var H=(b=b||{}).body;if(T instanceof S){if(T.bodyUsed)throw new TypeError("Already read");this.url=T.url,this.credentials=T.credentials,b.headers||(this.headers=new Y(T.headers)),this.method=T.method,this.mode=T.mode,H||null==T._bodyInit||(H=T._bodyInit,T.bodyUsed=!0)}else this.url=String(T);if(this.credentials=b.credentials||this.credentials||"omit",!b.headers&&this.headers||(this.headers=new Y(b.headers)),this.method=function(T){var b=T.toUpperCase();return l.indexOf(b)>-1?b:T}(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&H)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(H)}function n(T){var b=new FormData;return T.trim().split("&").forEach(function(H){if(H){var ne=H.split("="),le=ne.shift().replace(/\+/g," "),W=ne.join("=").replace(/\+/g," ");b.append(decodeURIComponent(le),decodeURIComponent(W))}}),b}function v(T){var b=new Y;return T.split(/\r?\n/).forEach(function(H){var ne=H.split(":"),le=ne.shift().trim();if(le){var W=ne.join(":").trim();b.append(le,W)}}),b}function R(T,b){b||(b={}),this.type="default",this.status="status"in b?b.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new Y(b.headers),this.url=b.url||"",this._initBody(T)}if(!tt.fetch){var p={searchParams:"URLSearchParams"in tt,iterable:"Symbol"in tt&&"iterator"in Symbol,blob:"FileReader"in tt&&"Blob"in tt&&function(){try{return new Blob,!0}catch(T){return!1}}(),formData:"FormData"in tt,arrayBuffer:"ArrayBuffer"in tt};if(p.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=function(T){return T&&DataView.prototype.isPrototypeOf(T)},I=ArrayBuffer.isView||function(T){return T&&o.indexOf(Object.prototype.toString.call(T))>-1};Y.prototype.append=function(T,b){T=Wt(T),b=Ke(b);var H=this.map[T];this.map[T]=H?H+","+b:b},Y.prototype.delete=function(T){delete this.map[Wt(T)]},Y.prototype.get=function(T){return T=Wt(T),this.has(T)?this.map[T]:null},Y.prototype.has=function(T){return this.map.hasOwnProperty(Wt(T))},Y.prototype.set=function(T,b){this.map[Wt(T)]=Ke(b)},Y.prototype.forEach=function(T,b){for(var H in this.map)this.map.hasOwnProperty(H)&&T.call(b,this.map[H],H,this)},Y.prototype.keys=function(){var T=[];return this.forEach(function(b,H){T.push(H)}),F(T)},Y.prototype.values=function(){var T=[];return this.forEach(function(b){T.push(b)}),F(T)},Y.prototype.entries=function(){var T=[];return this.forEach(function(b,H){T.push([H,b])}),F(T)},p.iterable&&(Y.prototype[Symbol.iterator]=Y.prototype.entries);var l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},A.call(S.prototype),A.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Y(this.headers),url:this.url})},R.error=function(){var T=new R(null,{status:0,statusText:""});return T.type="error",T};var V=[301,302,303,307,308];R.redirect=function(T,b){if(-1===V.indexOf(b))throw new RangeError("Invalid status code");return new R(null,{status:b,headers:{location:T}})},tt.Headers=Y,tt.Request=S,tt.Response=R,tt.fetch=function(T,b){return new Promise(function(H,ne){var le=new S(T,b),W=new XMLHttpRequest;W.onload=function(){var be={status:W.status,statusText:W.statusText,headers:v(W.getAllResponseHeaders()||"")};be.url="responseURL"in W?W.responseURL:be.headers.get("X-Request-URL"),H(new R("response"in W?W.response:W.responseText,be))},W.onerror=function(){ne(new TypeError("Network request failed"))},W.ontimeout=function(){ne(new TypeError("Network request failed"))},W.open(le.method,le.url,!0),"include"===le.credentials&&(W.withCredentials=!0),"responseType"in W&&p.blob&&(W.responseType="blob"),le.headers.forEach(function(be,de){W.setRequestHeader(de,be)}),W.send(void 0===le._bodyInit?null:le._bodyInit)})},tt.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);var loadjs={};loadjs=function(){function Wt(A,C){if(A){var S=L[A];if(d[A]=C,S)for(;S.length;)S[0](A,C),S.splice(0,1)}}function Ke(A,C){A.call&&(A={success:A}),C.length?(A.error||i)(C):(A.success||i)(A)}function F(A,C,S,n){var v,R,p=document,o=S.async,f=(S.numRetries||0)+1,I=S.before||i,l=A.replace(/^(css|img)!/,""),V=S.reqdelay||0;n=n||0,/(^css!|\.css$)/.test(A)?(v=!0,(R=p.createElement("link")).rel="stylesheet",R.href=l):/(^img!|\.(png|gif|jpg|svg)$)/.test(A)?(R=p.createElement("img")).src=l:((R=p.createElement("script")).src=A,R.async=void 0===o||o),R.onload=R.onerror=R.onbeforeload=function(T){var b=T.type[0];if(v&&"hideFocus"in R)try{R.sheet.cssText.length||(b="e")}catch(H){b="e"}if("e"==b&&(n+=1)<f)return w=V*n,setTimeout(function(){F(A,C,S,n)},w),void(S.retrycb&&S.retrycb(n,w));C(A,b,T.defaultPrevented)},!1!==I(A,R)&&p.head.appendChild(R)}function e(A,C,S){var n,v;C&&C.trim&&(n=C),function(A,C,S){var n,v,R=(A=A.push?A:[A]).length,p=R,o=[];for(n=function(f,I,l){if("e"==I&&o.push(f),"b"==I){if(!l)return;o.push(f)}--R||C(o)},v=0;v<p;v++)F(A[v],n,S)}(A,function(R){Ke(v,R),Wt(n,R)},v=(n?S:C)||{})}var i=function(){},c={},d={},L={},w=0;return e.ready=function(A,C){return function(A,C){var S,n,v,R=[],p=(A=A.push?A:[A]).length,o=p;for(S=function(f,I){I.length&&R.push(f),--o||C(R)};p--;)(v=d[n=A[p]])?S(n,v):(L[n]=L[n]||[]).push(S)}(A,function(S){Ke(C,S)}),e},e.done=function(A){Wt(A,[])},e.reset=function(){c={},d={},L={}},e.isDefined=function(A){return A in c},e}(),function(tt,Wt){"use strict";var Ke={load:function(F,Y,e){if("function"==typeof define&&define.amd&&"undefined"!=typeof requirejs){var i=[],c=F+"://"+Y.ccsServer+"/socket.io/v3/socket.io.js";i.push("sio"),requirejs.config({shim:{sio:{exports:"io"}},wrap:!1,paths:{sio:c}}),requirejs(i,function(w){tt.rtcio=w,e.success()})}else if(void 0!==typeof loadjs&&"undefined"==typeof apiRTC_React){loadjs(void 0!==Y.socketioUrl?[Y.socketioUrl]:[F+"://"+Y.ccsServer+"/socket.io/v3/socket.io.js"],"socketio",{async:!0,numRetries:Y.extJsLoadingRetryNb||100,reqdelay:Y.extJsLoadingRetryDelay||200,success:function(){tt.rtcio=io,e.success()},error:function(w){console.error("socket.io loading error"),e.error()},retrycb:function(w,A){console.warn("socket.io loading retry :"+w+" ,delay before retry :"+A),e.retrycb()}})}else console.log("Else loadjs io"),tt.rtcio=io,e.success()}};tt.apiRTC_sioLoader=Ke}(window),function(tt,Wt){if("object"==typeof exports&&"object"==typeof module)module.exports=Wt();else if("function"==typeof define&&define.amd)define([],Wt);else{var Ke=Wt();for(var F in Ke)("object"==typeof exports?exports:tt)[F]=Ke[F]}}(self,function(){return(()=>{var tt={8364:(F,Y,e)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});var i=e(2043),c=e(7987),d=i.getLogger("CloudAPI");c.reg(i),c.apply(d,{format:function(R,p,o){return o+" - ["+R+"] "+p+" : "}}),d.setDefaultLevel("error"),d.setLevel("error");var L="/api/v2/media/upload",w="/api/v2/conversation/{convId}/media",A="/api/v2/conferences",C={updateWebconfTags:{fetchRetryCount:3,fetchRetryDelay:500}},S=null,n=function(){function R(){if(this.cloudUrl="https://cloud.apizee.com",this.fetchRetries=100,this.fetchRetryDelay=200,null!==S)return d.debug("Cannot construct multiple CloudAPI, this is a singleton."),S;S=this}return R.get=function(){return S=null===S?new R:S},R.prototype.setLogLevel=function(p){d.setLevel(p)},R.prototype.getLogLevel=function(){var p="";switch(d.getLevel()){case 0:p="trace";break;case 1:p="debug";break;case 2:p="info";break;case 3:p="warn";break;case 4:p="error";break;case 5:p="silent"}return p},R.prototype.setCloudURL=function(p){d.debug("setCloudURL :",p),this.cloudUrl=p},R.prototype.setFetchRetries=function(p){d.debug("setFetchRetries :",p),null!=p&&(this.fetchRetries=p)},R.prototype.setFetchRetryDelay=function(p){d.log("setFetchRetryDelay :",p),null!=p&&(this.fetchRetryDelay=p)},R.prototype.request=function(p,o,f,I,l){var V=-1===p.indexOf(this.cloudUrl)?this.cloudUrl+p:p,T=null;return new Promise(function(b,H){var ne,le=new XMLHttpRequest;if(le.onreadystatechange=function(Ne){if(le.readyState===XMLHttpRequest.DONE)if(d.debug("request onreadystatechange status :",le.status),200<=le.status&&le.status<300){if(le.responseText){var Oe=null;try{Oe=JSON.parse(le.responseText)}catch(He){Oe=le.responseText}b(Oe)}}else{if(Oe={status:le.status,text:le.statusText},le.responseText)try{Oe.response=JSON.parse(le.responseText)}catch(He){Oe.responseText=le.responseText}H(Oe)}},le.onprogress=function(Ne){"function"==typeof I&&I(Ne)},le.onerror=function(Ne){H(Ne)},"GET"===f)0<Object.keys(o).length&&(ne=new URLSearchParams(o),d.debug("johann",ne,ne.toString,o),V+="?"+ne.toString());else{T=new FormData;for(var W=0,be=Object.keys(o);W<be.length;W++){var de=be[W];T.append(de,o[de])}}if(le.open(f,V,!0),null!=l)for(var ce=0,Ee=Object.keys(l);ce<Ee.length;ce++)le.setRequestHeader(de=Ee[ce],l[de]);le.send(T)})},R.prototype.get=function(p,o,f){return d.log("Send HTTP request : GET "+p),this.request(p,o,"GET",null,f)},R.prototype.post=function(p,o,f,I){return d.log("Send HTTP request : POST "+p),this.request(p,o,"POST",f,I)},R.prototype.put=function(p,o,f,I){return d.log("Send HTTP request : PUT "+p),(o=null===o||"object"!=typeof o?{}:o)._method="PUT",this.request(p,o,"POST",f,I)},R.prototype.delete=function(p,o,f){return d.log("Send HTTP request : DELETE "+p),(o=null===o||"object"!=typeof o?{}:o)._method="DELETE",this.request(p,o,"POST",null,f)},R.prototype.cloudRequest=function(p,o,f,I){var l=this;return void 0===I&&(I={}),new Promise(function(V,T){d.trace(f+" cloudRequest to "+S.cloudUrl,o);var b={method:f.toUpperCase()},H=S.cloudUrl+p;if("GET"===b.method)0<Object.keys(o).length&&(H+="?"+new URLSearchParams(o).toString());else{for(var ne=new FormData,le=0,W=Object.keys(o);le<W.length;le++){var be=W[le];ne.append(be,o[be])}b.body=ne}I.hasOwnProperty("bearerToken")&&(b.headers={Authorization:"Bearer "+I.bearerToken}),b.retries=I.hasOwnProperty("fetchRetryCount")?I.fetchRetryCount:l.fetchRetries,b.retryDelay=I.hasOwnProperty("fetchRetryDelay")?I.fetchRetryDelay:l.fetchRetryDelay,function(de,ce){d.log("fetchRetry");var Ee=3,Ne=1e3,Oe=[];if(ce&&ce.retries&&(Ee=ce.retries),ce&&ce.retryDelay&&(Ne=ce.retryDelay),ce&&ce.retryOn){if(!(ce.retryOn instanceof Array))throw{name:"ArgumentError",message:"retryOn property expects an array"};Oe=ce.retryOn}return new Promise(function(He,ke){function ze(gt){var ft,at;d.log("wrappedFetch n:",gt),void 0!==window.fetch?fetch(de,ce).then(function(Ze){-1===Oe.indexOf(Ze.status)?He(Ze):0<gt?we(gt):ke(Ze)}).catch(function(Ze){0<gt?we(gt):ke(Ze)}):(d.debug("Cannot use fetch in this browser, using XHR"),ft=n.get(),at={},ce.body&&ce.body.forEach(function(Ze,ie){return at[ie]=Ze}),ft.request(de,at,ce.method,null,ce.headers).then(function(Ze){He({gettype:"cloudApiNoFetch",response:Ze})}).catch(function(Ze){d.error("error :",Ze),ke(Ze)}))}function we(gt){d.error("retry n:",gt);var ft=Ee-gt+1;d.error("retry number is :",ft),setTimeout(function(){ze(--gt)},Ne*ft)}ze(Ee)})}(H,b).then(function(de){var ce=null;if(de.status<200||299<de.status){var Ee="cloudRequest - response status Code: "+de.status;return d.warn(Ee),T(v(13,Ee,d,{httpCode:de.status}))}return"cloudApiNoFetch"===de.gettype?de.response:(ce=de.headers?de.headers.get("content-type"):ce)&&-1!==ce.indexOf("application/json")?de.json():T(v(3,"cloudRequest - response is not JSON",d))}).then(V).catch(function(de){d.error("err :",de),T(v(2,"cloudRequest - Fetch Error",d))})})},R.prototype.authentication=function(p,o){return d.debug("authentication to "+S.cloudUrl),this.cloudRequest("/api/v2/authenticate",{username:p,password:o},"POST")},R.prototype.getConnectedUserInformation=function(p){return d.debug("getConnectedUserInformation to "+S.cloudUrl),this.cloudRequest("/api/v2/users/me",{token:p},"GET")},R.prototype.getUserProfile=function(p,o){return d.debug("getUserProfile to "+S.cloudUrl),"string"!=typeof p||"string"!=typeof o?Promise.reject("wrongArguments"):(p={apiKey:p},this.cloudRequest("/api/v2/users/{userId}/profile".replace("{userId}",o),p,"GET"))},R.prototype.getSiteAgents=function(p,o,f){return void 0===f&&(f={}),d.debug("getSiteAgents to "+S.cloudUrl),"string"!=typeof p||"string"!=typeof o?Promise.reject("wrongArguments"):(p={apiKey:p},f.useAcd&&(p.useAcd=1),f.usePresence&&(p.usePresence=1),f.convId&&(p.convId=f.convId),this.cloudRequest("/api/v2/sites/{siteKey}/agents".replace("{siteKey}",o),p,"GET"))},R.prototype.getEnterpriseInformation=function(p){return void 0===p&&(p={}),d.debug("getEnterpriseInformation to "+S.cloudUrl),this.cloudRequest("/api/v2/enterpriseInformation",p,"GET")},R.prototype.getPreferredCCS=function(p){return d.debug("getPreferredCCS to "+S.cloudUrl),this.cloudRequest("/api/v2/preferredCCS",{apiKey:p},"GET")},R.prototype.checkUserToken=function(p){return d.debug("checkUserToken to "+S.cloudUrl),this.cloudRequest("/api/v2/checkToken",{token:p},"GET")},R.prototype.invalidateUserToken=function(p){return d.debug("invalidateUserToken to "+S.cloudUrl),this.cloudRequest("/api/v2/invalidateToken",{token:p},"POST")},R.prototype.uploadFile=function(p,o,f){d.debug("uploadMedia to "+S.cloudUrl);var I={token:o,file:p};if(null!=f)for(var l=0,V=Object.keys(f);l<V.length;l++){var T=V[l];I[T]=f[T]}return this.cloudRequest(L,I,"POST")},R.prototype.uploadSnapshot=function(p,o,f){void 0===f&&(f={}),d.debug("uploadSnapshot to "+S.cloudUrl);for(var I={token:o,dataUri:1,file:p},l=0,V=Object.keys(f);l<V.length;l++){var T=V[l];I[T]=f[T]}return this.cloudRequest(L,I,"POST")},R.prototype.getUserPhotoUrl=function(p){return S.cloudUrl+"/profile/getImage?userId="+p},R.prototype.getEnterpriseUserList=function(p,o){return d.debug("getEnterpriseUserList to "+S.cloudUrl),this.cloudRequest("/api/v2/enterprises/{enterpriseId}/users".replace("{enterpriseId}",p),{token:o,json:!0},"GET")},R.prototype.getEnterpriseTagList=function(p,o,f){return void 0===f&&(f={}),d.debug("getEnterpriseTagList to "+S.cloudUrl),o={token:o},f.hasOwnProperty("webconfId")&&(o.conferenceId=f.webconfId),this.cloudRequest("/api/v2/enterprises/{enterpriseId}/tags".replace("{enterpriseId}",p),o,"GET")},R.prototype.updateWebconfTags=function(p,o,f,I){return d.debug("updateWebconfTags to "+S.cloudUrl),f={_method:"PUT",tags:f.join(",")},function(l,V){if(null!==l&&"object"==typeof l||(l={}),C.hasOwnProperty(V))for(var T=C[V],b=0,H=["fetchRetryCount","fetchRetryDelay"];b<H.length;b++){var ne=H[b];T.hasOwnProperty(ne)&&(l[ne]=T[ne])}}(I={bearerToken:I},"updateWebconfTags"),this.cloudRequest("/api/enterprises/{enterpriseId}/conferences/{conferenceId}".replace("{enterpriseId}",p).replace("{conferenceId}",o),f,"POST",I)},R.prototype.getConferenceList=function(p){return d.debug("getConferenceList to "+S.cloudUrl),this.cloudRequest(A,{token:p},"GET")},R.prototype.getOrCreateConversation=function(p,o,f){return void 0===f&&(f={}),d.debug("getOrCreateConversation to "+S.cloudUrl),null===p||"object"!=typeof p||"string"!=typeof o?Promise.reject("wrongArguments"):(o={name:p._getTechnicalName(),type:p.getType(),apiKey:o},f.hasOwnProperty("token")&&f.token&&(o.token=f.token),f.hasOwnProperty("active")&&"boolean"==typeof f.active&&(o.active=1),this.cloudRequest("/api/v2/conversation",o,"POST"))},R.prototype.createConference=function(p,o,f){return void 0===f&&(f={}),d.debug("createConference to "+S.cloudUrl),o={token:p,name:o},f.hasOwnProperty("password")&&(o.password=f.password),this.cloudRequest(A,o,"POST")},R.prototype.checkConferenceAccess=function(p,o,f){return void 0===f&&(f={}),d.debug("checkConferenceAccess for "+p+" to "+S.cloudUrl),"string"!=typeof o?Promise.reject("wrongArguments"):(o={apiKey:o},f.convId&&(o.conv_id=f.convId),f.hasOwnProperty("password")&&(o.password=f.password),f.hasOwnProperty("session")&&"function"==typeof f.session.getToken&&null!==f.session.getToken()&&(o.token=f.session.getToken()),this.cloudRequest("/api/v2/conferences/{roomname}/checkAccess".replace("{roomname}",p),o,"POST"))},R.prototype.getWebconf=function(p,o){void 0===o&&(o={}),d.debug("getWebconf for "+p+" to "+S.cloudUrl);var f={};return o.hasOwnProperty("token")&&o.token&&(f.bearerToken=o.token),this.cloudRequest("/api/v2/conferences/{roomname}".replace("{roomname}",p),{},"GET",f)},R.prototype.getWebconfConversation=function(p,o,f){if(void 0===f&&(f={}),d.debug("getWebconfConversation for "+p+" to "+S.cloudUrl),"string"!=typeof o)return Promise.reject("wrongArguments");var I={};return I.apiKey=o,f.hasOwnProperty("token")&&f.token&&(I.token=f.token),this.cloudRequest("/api/v2/conferences/{roomname}/conversation".replace("{roomname}",p),I,"GET")},R.prototype.updateConferencePresence=function(p,o,f){return d.trace("updateConferencePresence for "+p.getName()+" to "+S.cloudUrl),f={ccid:o.getId(),name:o.getUserAgent().getUsername(),instanceId:p.getInstanceId(),apiKey:f},null!==o.getToken()&&(f.token=o.getToken()),this.cloudRequest("/api/v2/conferences/{roomname}/updatePresence".replace("{roomname}",p._getTechnicalName()),f,"POST")},R.prototype.closeConferenceInstance=function(p,o){return d.debug("closeConferenceInstance for "+p.getName()+" to "+S.cloudUrl),o={token:o.getToken(),instanceId:p.getInstanceId()},this.cloudRequest("/api/v2/conferences/{roomname}/closeInstance".replace("{roomname}",p._getTechnicalName()),o,"POST")},R.prototype.getConversationMediaList=function(p,o,f){return void 0===f&&(f={}),d.debug("getConversationMediaList for "+p+" to "+S.cloudUrl),p&&"string"==typeof o?(o={apiKey:o},f.hasOwnProperty("token")&&f.token&&(o.token=f.token),f.hasOwnProperty("offset")&&(o.offset=f.offset),f.hasOwnProperty("limit")&&(o.limit=f.limit),this.cloudRequest(w.replace("{convId}",p.toString()),o,"GET")):Promise.reject("wrongArguments")},R.prototype.pushConversationMedia=function(p,o,f,I){return void 0===I&&(I={}),d.debug("pushConversationMedia for "+p+" to "+S.cloudUrl),p&&o&&"string"==typeof f?(f={media:o,apiKey:f},I.hasOwnProperty("token")&&I.token&&(f.token=I.token),I.hasOwnProperty("metadata")&&I.metadata&&(f.metadata=I.metadata),I.hasOwnProperty("asFile")&&I.asFile&&(f.asFile=I.asFile),I.hasOwnProperty("filename")&&I.filename&&(f.filename=I.filename),!0===I.overwrite&&(f.overwrite=1),"number"==typeof I.ttl&&0<I.ttl&&(f.ttl=I.ttl),this.cloudRequest(w.replace("{convId}",p.toString()),f,"POST")):Promise.reject("wrongArguments")},R.prototype.setConversationData=function(p,o,f,I){return void 0===I&&(I={}),d.debug("setConversationData for "+p+" to "+S.cloudUrl),p&&"string"==typeof o&&"string"==typeof f?(f={data:o,apiKey:f},I.hasOwnProperty("token")&&I.token&&(f.token=I.token),this.cloudRequest("/api/v2/conversation/{convId}/data".replace("{convId}",p.toString()),f,"POST")):Promise.reject("wrongArguments")},R.prototype.getSessionHistory=function(p,o,f){void 0===f&&(f={}),d.debug("getSessionHistory to "+S.cloudUrl);var I={token:o,sessionId:p};if(null!=f)for(var l=0,V=Object.keys(f);l<V.length;l++){var T=V[l];I[T]=f[T]}return this.cloudRequest("/api/v2/messages",I,"GET")},R.prototype.getWebSession=function(p,o,f){return d.debug("getSessionHistory to "+S.cloudUrl),"string"!=typeof f?Promise.reject("wrongArguments"):(f={destId:o.getId(),apiKey:f},null!==p.getToken()?f.token=p.getToken():f.userId=p.getId(),this.cloudRequest("/api/v2/webSession",f,"GET"))},R.prototype.saveNewMessage=function(p,o,f,I,l,V){return d.debug("saveNewMessage to "+S.cloudUrl),p={uuid:l,destId:f,message:I,sessionId:p},null!==o.getToken()?p.token=o.getToken():(p.userId=o.getId(),p.apiKey=V),this.cloudRequest("/api/v2/messages",p,"POST")},R.prototype.saveGroupChatMessage=function(p,o,f,I,l,V){return void 0===V&&(V={}),d.debug("saveGroupChatMessage to "+S.cloudUrl),V={apiKey:f,message:I,ccid:o.getId(),name:o.getUserAgent().getUsername(),parent_conv_id:p.getCloudConversationId(),uuid:l,htmlEnable:V.metadata&&V.metadata.htmlEnable||!1},null!==o.getToken()?V.token=o.getToken():V.userId=o.getId(),this.cloudRequest("/api/v2/groupChatMessages",V,"POST")},R.prototype.loadGroupChatMessages=function(p,o){return d.debug("loadGroupChatMessages to "+S.cloudUrl),o={parent_conv_id:p.getCloudConversationId(),token:o.getToken()},this.cloudRequest("/api/v2/groupChatMessages",o,"GET")},R}();function v(R,p,o,f){return void 0===f&&(f={}),o&&o.error(p),p={code:R,error:p instanceof String?new Error(p):p instanceof Error?p:new Error(String(p))},f.hasOwnProperty("httpCode")&&(p.httpCode=f.httpCode),p}Y.default=n},9852:(F,Y,e)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});var i=e(8364);F.exports=i.default},1254:(F,Y,e)=>{"use strict";e.d(Y,{W:()=>c});var i=e(1549).Y.get("ApiCCCoBrowsingClient"),c=function(d){i.debug("apiCC.ApiCCCoBrowsingClient"),this.createRoom=function(){i.debug("createRoom()"),d.roomMgr.createRoom("coBrowsing")},this.inviteInRoom=function(L,w){i.debug("inviteInRoom()"),d.roomMgr.inviteInRoom(L,w,"coBrowsing")},this.answerToRoomInvitation=function(L,w){i.debug("answerToRoomInvitation()"),d.roomMgr.answerToRoomInvitation(L,w,"coBrowsing")},this.leaveRoom=function(L){i.debug("leaveRoom()"),d.roomMgr.leaveRoom(L,"coBrowsing")}}},128:(F,Y,e)=>{"use strict";e.d(Y,{_:()=>d}),e(2564);var i=e(1549).Y.get("ApiCCDataClient"),c=apiCC.myWebRTC_Event,d=function(L){this.sendData=function(w,A,C){i.info("Call sending data function .... to :"+w+" message :"+A);var n,v=L.channel.getNewCSeq(),R=null;return n=JSON.stringify({type:"dataMessage",senderId:L.apiCCId,dstRoomId:w,data:A,cSeq:v}),i.log("C->S: "+n),void 0!==C?(i.log("Ack management activated"),R=setTimeout(function(){C({reason:"timeoutReached",cSeq:v}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[v]},L.messageTimeOutTimer),i.log("timeOutId: "+R),L.messageTimeOutTable[v]=R,L.channel.socket.emit("dataMessage",n,function(p){i.log("callback on dataMessage"),i.log("callback reason :"+p.reason),i.log("cSeq :"+p.cSeq),C(p),void 0!==apiCC.session.messageTimeOutTable[v]?(i.log("clearing timeOutId: "+apiCC.session.messageTimeOutTable[v]),clearTimeout(apiCC.session.messageTimeOutTable[v]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[v]):i.warn("messageTimeOutTable was already deleted : timeout may have been reached before Ack")})):(i.log("Ack management not activated"),L.channel.socket.emit("dataMessage",n)),v},this.sendDataToGroup=function(w,A){i.info("[ApiCCDataClient] sendDataToGroup - "+w);var C,S=L.getConnectedUsersList(w);for(C=0;C<S.length;C++)L.apiCCId!=S[C].userId&&this.sendData(S[C].userId,A)},this.receiveData=function(w){i.info("receiveData :"+w.data),c.createReceiveDataEvent(w.senderId,w.dstRoomId,w.data)}}},6844:(F,Y,e)=>{"use strict";e.d(Y,{U:()=>A}),e(9554),e(4747),e(2564),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(1549),c=e(4708),d=e(940);function L(C){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(S){return typeof S}:function(S){return S&&"function"==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(C)}var w=i.Y.get("ApiCCIMClient"),A=function(C,S){this.convTable=[],this.myWebRTC_Event=apiCC.myWebRTC_Event,this.nickname=C.nickname,this.photoURL=null,this.userDataSetted=!1,this.myWebRTC_Stack=new d.S(C.channel.socket),this.findIMIdWithDestID=function(n){var v,R=this.convTable.length;for(w.log("findIMIdWithDestID = "+n),v=0;v<R;v+=1)if(w.log("this.convTable[i].dest_roomId = "+this.convTable[v].dest_roomId),this.convTable[v].dest_roomId==n)return this.convTable[v].IMId;return w.log("Conversation IMId not found"),0},this.addInConvTable=function(n){w.debug("addInConvTable");var v,R=this.convTable.length;for(v=0;v<R;v+=1)if(w.log("this.convTable[i].dest_roomId = "+this.convTable[v].dest_roomId),this.convTable[v].dest_roomId==n.dest_roomId)return void(this.convTable[v].IMId=n.IMId);w.log("Conversation not found in the table, adding .."),this.convTable.push(n)},this.sendMessage=function(n,v,R,p){w.info("Call sending message function .... from :"+this.nickname+" message :"+v);var o,f=this.findIMIdWithDestID(n),I=null,l=null,V=null,T=C.channel.getNewCSeq();return w.log(0===f?"Creation of a new IM conversation":"Message is for existing conversation with ID : "+f),w.log("IMConvId :"+f),I={type:"IMMessage",IMId:f,senderId:C.apiCCId,nickname:this.nickname,photoURL:this.photoURL,dstRoomId:n,data:v,cSeq:T,convData:p},C.getConnectedUserIdsList().forEach(function(b){b.userId==n&&b.hasOwnProperty("userData")&&null!==b.userData&&L(b.userData.hasOwnProperty("isChatbot"))&&b.userData.isChatbot&&(I.pubSub="BotConnector")}),o=JSON.stringify(I),l=document.createElement("message"),w.log("C->S: "+o),void 0!==R?(w.log("Ack management activated"),V=setTimeout(function(){R({reason:"timeoutReached",cSeq:T}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[T]},C.messageTimeOutTimer),w.log("timeOutId: "+V),C.messageTimeOutTable[T]=V,C.channel.socket.emit("IMMessage",o,function(b){w.log("callback on IMMessage"),w.log("data :",b),w.log("callback reason :"+b.reason),w.log("callback convId :"+b.convId),w.log("cSeq :"+b.cSeq),R(b),void 0!==apiCC.session.messageTimeOutTable[T]?(w.log("clearing timeOutId: "+apiCC.session.messageTimeOutTable[T]),clearTimeout(apiCC.session.messageTimeOutTable[T]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[T]):w.warn("messageTimeOutTable was already deleted : timeout may have been reached before Ack")})):(w.log("Ack management not activated"),C.channel.socket.emit("IMMessage",o)),null!==this.conversation&&(l.innerHTML="<b>me :</b> "+p+"<br>",this.conversation.appendChild(l),this.conversation.scrollTop=this.conversation.scrollHeight),T},this.newConversationCreated=function(n){w.debug("newConversationCreated :"+n),w.log("msg.dstRoomId :"+n.dstRoomId),w.log("msg.IMId :"+n.IMId),this.addInConvTable({dest_roomId:n.dstRoomId,IMId:n.IMId})},this.receiveMessage=function(n){w.info("Call receiveMessage message :"+n);var R=null;this.addInConvTable({dest_roomId:n.senderId,IMId:n.IMId}),null!==this.conversation&&((R=document.createElement("message")).innerHTML="<b>"+n.nickname+":</b> "+n.data+"<br>",this.conversation.appendChild(R),this.conversation.scrollTop=this.conversation.scrollHeight),this.myWebRTC_Event.createReceiveIMMessageEvent(n.senderId,n.nickname,n.photoURL,n.data,n.UUCSeq,n.IMId)},this.createGroupChat=function(n,v){var p;w.info("createGroupChat with contacts : "+n+","+v),p=JSON.stringify({type:"createGroupChat",nickname:this.nickname,photoURL:this.photoURL,contactId1:n,contactId2:v}),w.log("C->S: "+p),C.channel.socket.emit("createGroupChat",p)},this.groupChatCreation=function(n){w.debug("groupChatCreation"),this.myWebRTC_Event.createGroupChatCreationEvent(n.status,n.groupChatId,n.contactId1,n.invitationSendedToInitialDestId,n.contactId2,n.invitationSendedToNewContactId)},this.joinGroupChat=function(n){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w.debug("joinGroupChat : "+n);var R=null,p=null;R={type:"joinGroupChat",groupChatId:n},v.convId&&(R.data={},R.data.cloudConvId=v.convId),p=JSON.stringify(R),w.log("C->S: "+p),C.channel.socket.emit("joinGroupChat",p)},this.groupChatInvitation=function(n){w.debug("groupChatInvitation"),this.myWebRTC_Event.createGroupChatInvitationEvent(n.groupChatId,n.senderId,n.senderNickname,n.senderPhotoURL,n.contactList)},this.answerToGroupChatInvitation=function(n,v){var p;w.debug("answerToGroupChatInvitation: "+n+" : "+v),!0===v||!1===v?(p=JSON.stringify({type:"groupChatInvitationAnswer",groupChatId:n,senderId:C.apiCCId,nickname:this.nickname,photoURL:this.photoURL,accept:v}),w.log("C->S: "+p),C.channel.socket.emit("groupChatInvitationAnswer",p)):w.log("accept value is not correct")},this.groupChatMemberUpdate=function(n){w.info("groupChatMemberUpdate"),this.myWebRTC_Event.createGroupChatMemberUpdateEvent(n.groupChatId,n.contactList,n.status)},this.addUserInGroupChat=function(n,v){var p;w.debug("addUser : "+v+"in Group Chat with Id :"+n),p=JSON.stringify({type:"addUserInGroupChat",groupChatId:n,nickname:this.nickname,photoURL:this.photoURL,contactId:v}),w.log("C->S: "+p),C.channel.socket.emit("addUserInGroupChat",p)},this.addUserInGroupChatAnswer=function(n){w.info("addUserInGroupChatAnswer"),this.myWebRTC_Event.createAddUserInGroupChatEvent(n.invitationSended,n.groupChatId,n.contactId)},this.leaveGroupChat=function(n){var R;w.info("Leave Group Chat with Id :"+n),R=JSON.stringify({type:"leaveGroupChat",groupChatId:n,nickname:this.nickname,photoURL:this.photoURL}),w.log("C->S: "+R),C.channel.socket.emit("leaveGroupChat",R)},this.sendMessageToGroupChat=function(n,v,R){var p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};w.info("Call sending message to Group Chat .... from :"+this.nickname+" message :"+v);var o=null,f=null,I=apiCC.session.channel.getNewCSeq();o={type:"groupChatMessage",groupChatId:n,senderId:C.apiCCId,nickname:this.nickname,cSeq:I,data:v},(0,c.Ym)(p,"metadata","object")&&(o.metadata=p.metadata),f=JSON.stringify(o),null!==R&&"function"==typeof R?(apiCC.session.messageTimeOutTable[I]=setTimeout(function(){R({reason:"timeoutReached",cSeq:I}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[I]},apiCC.session.messageTimeOutTimer),w.log("C->S: "+f),C.channel.socket.emit("groupChatMessage",f,function(l){clearTimeout(apiCC.session.messageTimeOutTable[l.cSeq]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[l.cSeq],R(l)})):(w.log("C->S: "+f),C.channel.socket.emit("groupChatMessage",f))},this.receiveGroupChatMessage=function(n){w.info("receiveGroupChatMessage"),this.myWebRTC_Event.createReceiveGroupChatMessageEvent(n.groupChatId,n.senderId,n.nickname,n.data,n.metadata)},this.getConversationHistory=function(n){var R;w.debug("getConversationHistory"),R=JSON.stringify({type:"getConversationHistory",convId:n}),w.log("C->S: "+R),C.channel.socket.emit("getConversationHistory",R)},this.receiveConversationHistory=function(n){w.debug("receiveConversationHistory"),w.log("msg.convId :"+n.convId);var v,R=0,p=[],o=null;if(null!==n.convHistory)for(w.log("msg.convHistory.length :"+n.convHistory.length),R=n.convHistory.length,p=[],v=0;v<R;v+=1)o=JSON.parse(n.convHistory[v]),p.push(o);this.myWebRTC_Event.createReceiveConversationHistoryEvent(n.convId,p,n.status)},this.setUserData=function(n){var R;w.info("setUserData"),this.photoURL=n.photoURL,C.photoURL=n.photoURL,w.log("photoURL :"+this.photoURL),R=JSON.stringify({type:"setUserData",nickname:this.nickname,photoURL:this.photoURL}),w.log("C->S: "+R),C.channel.socket.emit("setUserData",R),this.userDataSetted=!0},this.getUserData=function(n){var R;w.info("getUserData"),R=JSON.stringify({type:"getUserData",contactId:n}),w.log("C->S: "+R),C.channel.socket.emit("getUserData",R)},this.receiveUserDataAnswer=function(n){w.info("receiveUserDataAnswer"),this.myWebRTC_Event.createUserDataAnswerEvent(n.userFound,n.contactId,n.nickname,n.photoURL)},this.initialize=function(n){var R;this.conversation=document.getElementById(n),null===this.conversation&&(w.log("conversationElementId Div Name is not correct : INCORRECT_DIV_NAME_CONVERSATION"),w.log("conversationElementId is null")),R=JSON.stringify({type:"registerIM",username:this.nickname}),w.log("C->S: "+R),C.channel.socket.emit("registerIM",R)},this.initialize(S)}},9213:(F,Y,e)=>{"use strict";e.d(Y,{X:()=>L}),e(2564),e(2526),e(1817),e(1539);var i=e(1549),c=e(4708),d=i.Y.get("ApiCCPointerSharingClient"),L=function w(A){this.roomTable={},this.getRoomIds=function(){var C=[],S=null;for(S in this.roomTable)C.push(S);return C},this.roomExists=function(C){return this.roomTable.hasOwnProperty(C)},this.roomActive=function(C){return this.roomTable.hasOwnProperty(C)&&this.roomTable[C].state===w.STATE_ACTIVE},this.joinRoom=function(C,S){var n=this;d.info("ApiCCPointerSharingClient::joinRoom()"),(0,c.Ym)(S,"object")||(S={}),(0,c.ki)(S,"success","function")||(S.success=function(){}),(0,c.ki)(S,"failure","function")||(S.failure=function(){}),this.roomTable.hasOwnProperty(C)?S.failure("room already joined",C):(this.roomTable[C]={roomId:C,state:w.STATE_JOINING,joinRoomCallbacks:S},this.roomTable[C].joinRoomTimeoutId=setTimeout(function(){delete n.roomTable[C],S.failure("timeout",C)},15e3),apiCC.session.roomMgr.joinRoom(C,"pointerSharing"))},this.leaveRoom=function(C){this.roomTable.hasOwnProperty(C)&&delete this.roomTable[C],apiCC.session.roomMgr.leaveRoom(C,"pointerSharing")},this.inviteInRoom=function(C,S,n){d.info("ApiCCPointerSharingClient::inviteInRoom()"),apiCC.session.roomMgr.inviteInRoom(C,S,"pointerSharing",n)},this.sendPointerLocation=function(C,S,n,v,R){var p;return!(!this.roomTable.hasOwnProperty(C)||this.roomTable[C].state!==w.STATE_ACTIVE||(p={type:"pointerLocation",source:S,x:n,y:v},(0,c.Ym)(R,"object")&&(p.data=R),apiCC.session.roomMgr.sendMessageToRoom(C,"pointerSharing",p),0))},this.processMessageRoomJoin=function(C){this.roomTable.hasOwnProperty(C.roomId)&&this.roomTable[C.roomId].state===w.STATE_JOINING&&(clearTimeout(this.roomTable[C.roomId].joinRoomTimeoutId),delete this.roomTable[C.roomId].joinRoomTimeoutId,this.roomTable[C.roomId].state=w.STATE_ACTIVE,this.roomTable[C.roomId].joinRoomCallbacks.success(C.roomId),delete this.roomTable[C.roomId].joinRoomCallbacks)},this.stop=function(){for(var C=this.getRoomIds(),S=C.length;--S>=0;)this.leaveRoom(C[S])}};L.STATE_IDLE=Symbol("idle"),L.STATE_JOINING=Symbol("joining"),L.STATE_ACTIVE=Symbol("active"),L.STATE_ERROR=Symbol("error")},3720:(F,Y,e)=>{"use strict";e.d(Y,{K:()=>f}),e(1058),e(8309),e(4603),e(4916),e(9714),e(3710),e(1539),e(2564),e(9554),e(4747),e(2772),e(561),e(6699),e(2479),e(2707),e(9601),e(2526),e(1817),e(2165),e(6992),e(8783),e(3948);var i=e(1549),c=i.Y.get("RoomManager"),d=function(I,l){c.debug("RoomManager"),this.myWebRTC_Event=apiCC.myWebRTC_Event,this.createRoom=function(V){var T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.info("RoomManager:createRoom with roomType : "+V);var b={type:"createRoom",roomType:V,nickname:I.nickname,photoURL:I.photoURL};T.convId&&(b.data||(b.data={}),b.data.cloudConvId=T.convId),!0===T.webconf&&(b.data||(b.data={}),b.data.webconf=!0);var H=JSON.stringify(b);c.log("C->S: "+H),I.channel.socket.emit("createRoom",H)},this.roomCreation=function(V){c.info("RoomManager:roomCreation"),this.myWebRTC_Event.createRoomCreationEvent(V.status,V.roomId,V.roomType),l(V)},this.roomJoin=function(V){c.info("RoomManager:roomJoin"),this.myWebRTC_Event.createRoomJoinedEvent(V.status,V.roomId,V.roomType),l(V)},this.inviteInRoom=function(V,T,b,H){var ne=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};c.info("RoomManager:inviteInRoom with roomType:",b);var le={type:"inviteInRoom",roomId:V,contactId:T,roomType:b,nickname:I.nickname,photoURL:I.photoURL,context:H};ne.convId&&(le.data||(le.data={}),le.data.cloudConvId=ne.convId),!0===ne.webconf&&(le.data||(le.data={}),le.data.webconf=!0);var W=JSON.stringify(le);c.log("C->S: "+W),I.channel.socket.emit("inviteInRoom",W)},this.inviteInRoomStatus=function(V){c.info("inviteInRoomStatus"),l(V)},this.roomInvitation=function(V){c.info("roomInvitation",V);var T={};V.data&&(V.data.cloudConvId&&(T.cloudConvId=V.data.cloudConvId),!0===V.data.webconf&&(T.webconf=!0)),this.myWebRTC_Event.createRoomInvitationEvent(V.roomId,V.senderId,V.senderNickname,V.senderPhotoURL,V.contactList,V.roomType,T),l(V)},this.requestContactListInRoom=function(V){c.info("requestContactListInRoom :"+V);var b=JSON.stringify({type:"requestContactListInRoom",roomId:V});I.channel.socket.emit("requestContactListInRoom",b)},this.onContactListInRoom=function(V){c.info("onContactListInRoom :"+V),this.myWebRTC_Event.createContactListInRoomEvent(V.roomId,V.contactList,V.roomType),l(V)},this.answerToRoomInvitation=function(V,T,b){if(c.info("answerToRoomInvitation:",V,T),!0===T||!1===T){var ne=JSON.stringify({type:"roomInvitationAnswer",roomId:V,senderId:I.apiCCId,nickname:I.nickname,photoURL:I.photoURL,accept:T,roomType:b});c.log("C->S: "+ne),I.channel.socket.emit("roomInvitationAnswer",ne)}else c.log("accept value is not correct")},this.roomMemberUpdate=function(V){c.info("roomMemberUpdate"),this.myWebRTC_Event.createRoomMemberUpdateEvent(V.roomId,V.contactList,V.status,V.roomType),l(V)},this.sendMessageToRoom=function(V,T,b){c.info("Call sending message to Room .... from :"+I.apiCCId+" message :"+b);var ne=JSON.stringify({type:"roomMessage",roomId:V,senderId:I.apiCCId,nickname:I.nickname,roomType:T,data:b});c.log("C->S: "+ne),I.channel.socket.emit("roomMessage",ne)},this.receiveRoomMessage=function(V){c.info("receiveRoomMessage"),this.myWebRTC_Event.createReceiveRoomMessageEvent(V.roomId,V.senderId,V.nickname,V.data,V.roomType),l(V)},this.joinRoom=function(V,T){var b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c.info("Join Room with Id:",V);var H={type:"joinRoom",roomId:V,nickname:I.nickname,photoURL:I.photoURL,roomType:T};b.convId&&(H.data||(H.data={}),H.data.cloudConvId=b.convId),!0===b.webconf&&(H.data||(H.data={}),H.data.webconf=!0);var ne=JSON.stringify(H);c.log("C->S: "+ne),I.channel.socket.emit("joinRoom",ne)},this.leaveRoom=function(V,T){c.info("Leave Room with Id:",V);var H=JSON.stringify({type:"leaveRoom",roomId:V,nickname:I.nickname,photoURL:I.photoURL,roomType:T});c.log("C->S: "+H),I.channel.socket.emit("leaveRoom",H)}},L=(e(7042),e(1038),e(9753),e(8765)),w=e(5945);function A(I,l){(null==l||l>I.length)&&(l=I.length);for(var V=0,T=new Array(l);V<l;V++)T[V]=I[V];return T}var C=i.Y.get("ApiCC_Channel"),S=function(I){C.debug("ApiCC_Channel"),this.channelReady=!1,this.socket=null,this.channelId=I.apiCCId,this.callURLDestRoom=0,this.myWebRTC_Event=new L.K,this.channelHasBeenDisconnected=!1,this.cSeq=0,this.updatePresenceGroupIsNeeded=!1,this.oldPresenceGroup=null,this.newPresenceGroup=null,this.updateSubscribeToPresenceGroupIsNeeded=!1,this.oldSubscribeToPresenceGroup=null,this.newSubscribeToPresenceGroup=null,this.initialize=function(){C.info("ApiCC_Channel::initialize()"),this.openChannel()},this.getNewCSeq=function(){return this.cSeq=this.cSeq+1,this.cSeq},this.openChannel=function(){var l,V,T,b="",H=null,ne=null,le=null,W=null;C.debug("openChannel channelId :"+this.channelId),C.debug("session.apiKey :"+I.apiKey),C.log("session.sessionId :"+I.sessionId),I.xhrPolling=!0,C.log("CCSserver used : "+I.ccsServer),V=void 0!==I.appId?"&appId="+I.appId:"",T=void 0!==I.siteId?"&siteId="+I.siteId:"",void 0!==I.userData&&(C.log("Defined userData : ",I.userData),H=JSON.stringify(I.userData),C.log("stringUserData.length :"+H.length),H.length<=1e3?b="&userData="+encodeURIComponent(H):C.warn("userData length is too long :"+H.length+" .Need to be <= 500")),void 0!==I.presenceGroup&&(C.log("Defined presenceGroup : "+I.presenceGroup),ne=JSON.stringify(I.presenceGroup),C.log("stringPresenceGroup.length :"+ne.length),ne.length<=750?b+="&presenceGroup="+encodeURIComponent(ne):C.warn("presenceGroup length is too long :"+ne.length+" .Need to be <= 750")),void 0!==I.subscribeToPresenceGroup&&(C.log("Defined subscribeToPresenceGroup : "+I.subscribeToPresenceGroup),le=JSON.stringify(I.subscribeToPresenceGroup),C.log("stringsubscribeToPresenceGroup.length :"+le.length),le.length<=750?b+="&subscribeToPresenceGroup="+encodeURIComponent(le):C.warn("subscribeToPresenceGroup length is too long :"+le.length+" .Need to be <= 750")),void 0!==I.token&&(C.log("Defined token : "+I.token),b+="&token="+I.token),null!=I.conversationSpace&&(C.log("Defined conversationSpace : "+I.conversationSpace),b+="&conversationSpace="+I.conversationSpace),C.log("requestOptions on connect :"+(b+="&apiLibType=apiRTC_JS")),C.log("session.ccsServer :"+I.ccsServer),l="?channelId="+this.channelId+"&apiKey="+I.apiKey+"&apiVersion="+apiCC.version+"&apiCCSessionId="+I.apiCCSessionId+"&sessionId="+I.sessionId+V+T+b,W="undefined"!=typeof apiRTC_React?"https":"http:"===window.location.protocol?"http":"https","iOS"!==w.ag.name&&"Android"!==w.ag.name||(C.log(w.ag.name+" detected forcing protocol to https"),W="https"),C.info("CCS Connect, socket url is : "+W+"://"+I.ccsServer+"/"+l),this.ccsConnectionRetryNb=I.ccsConnectionRetryNb,this.ccsConnectionRetryDelay=I.ccsConnectionRetryDelay,this.socket=window.rtcio.connect(W+"://"+I.ccsServer+"/"+l,{forceNew:!0,multiplex:!1,withCredentials:!0,reconnectionAttempts:this.ccsConnectionRetryNb,reconnectionDelay:this.ccsConnectionRetryDelay}),this.socket.on("connect",this.callback(this,"onChannelOpened")).on("connect_error",this.callback(this,"onChannelConnectError")).on("message",this.callbackWithParams(this,"onChannelMessage")).on("disconnect",this.callback(this,"onChannelDisconnect")),this.socket.io.on("error",this.callback(this,"onChannelError")).on("reconnect",this.callback(this,"onChannelReconnect")).on("reconnect_attempt",this.callback(this,"onChannelReconnectAttempt")).on("reconnect_error",this.callback(this,"onChannelReconnectError")).on("reconnect_failed",this.callback(this,"onChannelReconnect_failed"))},this.onWhiteBoardDisconnection=function(){C.info("onWhiteBoardDisconnection"),apiCC.session.closeWhiteBoardClient("NETWORK_DISCONNECTION")},this.onChannelDisconnect=function(l){C.info("onChannelDisconnect");var V=Date();C.debug("date :"+V),apiCC.session.connectedUsersList.splice(0,apiCC.session.connectedUsersList.length),this.myWebRTC_Event.createChannelEvent("onChannelDisconnect",l),this.channelHasBeenDisconnected=!0,null!==apiCC.myApiCCWhiteBoardClient&&(C.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId?(C.log("Disconnection with an ongoing whiteboard"),C.error("Whiteboard disconnectionTimer is set to:",apiCC.myApiCCWhiteBoardClient.disconnectionTimer),apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId=setTimeout(this.callback(this,"onWhiteBoardDisconnection"),apiCC.myApiCCWhiteBoardClient.disconnectionTimer)):C.log("Disconnection without an ongoing whiteboard"))},this.onChannelReconnect_failed=function(){C.info("onChannelReconnect_failed"),this.myWebRTC_Event.createChannelEvent("onChannelReconnect_failed")},this.onChannelReconnect=function(l){C.error("onChannelReconnect",l);var V,T=null,b=0,H=[],ne=null,le=null,W=null,be=!1,de=0,ce=null,Ee=null;if(null!=I.conversationSpace?(C.debug("conversationSpace is set :",I.conversationSpace),I.joinConversationSpace(I.conversationSpace)):C.debug("no conversationSpace defined"),null!=I.userData&&(C.debug("sending userData :",I.userData),I.setUserData(I.userData,!0)),null!==I.presenceGroup?(C.debug("presenceGroup is set :",I.presenceGroup),I.sendPresenceGroupManagementCommand("join",I.presenceGroup)):C.debug("no presenceGroup defined"),null!==I.subscribeToPresenceGroup?(C.debug("subscribeToPresenceGroup is set :",I.subscribeToPresenceGroup),I.sendPresenceGroupManagementCommand("subscribe",I.subscribeToPresenceGroup)):C.debug("no subscribeToPresenceGroup defined"),null!==apiCC.session.apiCCIMClient?!0===apiCC.session.apiCCIMClient.userDataSetted?(T={photoURL:apiCC.session.apiCCIMClient.photoURL},apiCC.session.apiCCIMClient.setUserData(T)):C.log("apiCC.session.apiCCIMClient.userDataSetted !== true"):C.log("apiCC.session.apiCCIMClient === null"),null!==apiCC.session.apiCCWebRTCClient){if(apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.length>0)for(be=!0,V=0;V<apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.length;V+=1)ne={destId:(Ee=apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable[V]).remoteId,convId:Ee.userMediaId,callType:Ee.callType,roomId:Ee.roomId,data:Ee.data,meshPublish:!0},H.push(ne);if(0!==(b=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length)){for(C.log("Reconnecting with calls ongoing"),V=0;V<b;V+=1)null!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[V]&&void 0!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[V]?(Ee=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[V],C.debug("call.iceState =",Ee.iceState),null!==Ee.data?"publish"!==Ee.data.type&&"subscribe"!==Ee.data.type?(C.log("Call is P2P, updating media"),Ee.updateMediaWithRetryManagement(!0),H.push(ne={destId:Ee.remoteId,convId:Ee.callId,callType:Ee.callType,roomId:Ee.dest_roomId,data:Ee.data})):(C.log("Call is in an MCU session"),H.push(ne={destId:Ee.remoteId,convId:Ee.callId,callType:Ee.callType,roomId:Ee.dest_roomId,data:Ee.data})):(C.log("Call is P2P, updating media - no data"),Ee.updateMediaWithRetryManagement(!0),H.push(ne={destId:Ee.remoteId,convId:Ee.callId,callType:Ee.callType,roomId:Ee.dest_roomId,data:Ee.data}))):C.log("call no more exist");be=!0}else C.log("Reconnecting without calls ongoing");for(var Ne=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs,Oe=0;Oe<Ne.length;Oe+=1){C.log("Reconnecting with an ongoing sessionMCU");var He=[];He.push(Ne[Oe].roomName),apiCC.session.sendPresenceGroupManagementCommand("join",He),apiCC.session.sendPresenceGroupManagementCommand("subscribe",He)}}if(null!==apiCC.myApiCCWhiteBoardClient&&(0!==apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId&&(C.debug("clearing whiteBoardDisconnectionTimeoutId"),clearTimeout(apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId),apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId=0),C.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId?(C.log("Reconnection with an ongoing whiteboard"),de=apiCC.myApiCCWhiteBoardClient.roomId,be=!0,C.debug("Reconnection , sending request to get most recent whiteboard data"),apiCC.myApiCCWhiteBoardClient.paperSheetId=0,apiCC.myApiCCWhiteBoardClient.drawingId=0,apiCC.myApiCCWhiteBoardClient.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})):C.log("Reconnecting without an ongoing whiteboard")),null!==apiCC.session.apiCCPointerSharingClient&&(ce=apiCC.session.apiCCPointerSharingClient.getRoomIds()).length>0&&(be=!0),!0===be){C.log("Sending reconnectContext to CCS"),le={type:"reconnectContext",callList:H,whiteBoardRoomId:de},null!==ce&&ce.length>0&&(le.pointerSharingRoomIds=ce);var ke=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs;if(ke.length>0){le.updateSession=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.createJoinSessionMessage(null),le.updateSession.type="updateSession",le.updateSessions=[];var ze,we=function(at,Ze){var ie="undefined"!=typeof Symbol&&at[Symbol.iterator]||at["@@iterator"];if(!ie){if(Array.isArray(at)||(ie=function(Be,Lt){if(Be){if("string"==typeof Be)return A(Be,void 0);var jt=Object.prototype.toString.call(Be).slice(8,-1);return"Object"===jt&&Be.constructor&&(jt=Be.constructor.name),"Map"===jt||"Set"===jt?Array.from(Be):"Arguments"===jt||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(jt)?A(Be,void 0):void 0}}(at))){ie&&(at=ie);var bt=0,Rt=function(){};return{s:Rt,n:function(){return bt>=at.length?{done:!0}:{done:!1,value:at[bt++]}},e:function(Be){throw Be},f:Rt}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Ct,et=!0,wt=!1;return{s:function(){ie=ie.call(at)},n:function(){var Be=ie.next();return et=Be.done,Be},e:function(Be){wt=!0,Ct=Be},f:function(){try{et||null==ie.return||ie.return()}finally{if(wt)throw Ct}}}}(ke);try{for(we.s();!(ze=we.n()).done;){var ft=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.createJoinSessionMessage(null,{sessionMCU:ze.value});ft.type="updateSession",le.updateSessions.push(ft)}}catch(at){we.e(at)}finally{we.f()}}W=JSON.stringify(le),C.log("C->S: "+W),apiCC.session.channel.socket.emit("reconnectContext",W)}H.splice(0,H.length),this.myWebRTC_Event.createChannelEvent("onChannelReconnect",l)},this.onChannelReconnecting=function(l){C.info("onChannelReconnecting",l);var V=Date();C.debug("date :"+V),this.myWebRTC_Event.createChannelEvent("onChannelReconnecting",l)},this.onChannelOpened=function(){C.info("Channel opened"),C.log("this.channelId :"+this.channelId),this.channelReady=!0,!1===this.channelHasBeenDisconnected?I.onChannelOpened():(C.log("onChannelOpened after a disconnection, no change on session"),this.channelHasBeenDisconnected=!1,!1!==I.ApiDBActivated&&null!=I.ApiDBActivated&&(C.log("apiDB initialisation"),apiDB.init(I.channel.socket))),!0===this.updatePresenceGroupIsNeeded&&(C.log("Updating presence group"),I.leavePresenceGroup(this.oldPresenceGroup),I.joinPresenceGroup(this.newPresenceGroup)),!0===this.updateSubscribeToPresenceGroupIsNeeded&&(C.log("Updating subscribe to presence group"),I.unsubscribePresenceGroup(this.oldSubscribeToPresenceGroup),I.subscribePresenceGroup(this.newSubscribeToPresenceGroup)),this.myWebRTC_Event.createChannelEvent("onChannelOpened")},this.onChannelMessage=function(l,V){var T,b=null,H=null;try{b=JSON.parse(l)}catch(ne){return}(T="checkCallStatus"===b.type||"apiRTCDataMessage"===b.type&&b.data&&["activeSpeaker","stopSpeaking"].indexOf(b.data.type)>=0)||C.info("onChannelMessage S->C: "+l),"IMMessage"===b.type&&(C.log("IMMessage convId :"+b.IMId),H=b.IMId),void 0!==V&&(C.trace("ack on message reception"),C.trace("convId :"+H),V({reason:"ack",convId:H})),I.processSignalingMessage(b,{quiet:T})},this.onChannelConnectError=function(l){C.log("onChannelConnectError :",l),this.myWebRTC_Event.createChannelEvent("onChannelConnectError",l)},this.onChannelReconnectError=function(l){C.log("onChannelReconnectError :",l),this.myWebRTC_Event.createChannelEvent("onChannelReconnectError",l)},this.onChannelReconnectAttempt=function(l){C.log("onChannelReconnectAttempt :",l),this.myWebRTC_Event.createChannelEvent("onChannelReconnectAttempt",l),this.onChannelReconnecting(l)},this.onChannelError=function(l){C.error("Channel error :",l),"not authorized"===l&&this.socket.disconnect(),this.myWebRTC_Event.createChannelEvent("onChannelError",l)},this.callback=function(l,V){return this.closureHandler=function(T){return l[V](T)},this.closureHandler},this.callbackWithParams=function(l,V){return this.closureHandler=function(T,b,H){return l[V](T,b,H)},this.closureHandler}},n=e(4708),v=e(940);function R(I){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(l){return typeof l}:function(l){return l&&"function"==typeof Symbol&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l})(I)}var p=i.Y.get("ApiCCSession"),o=apiCC.myWebRTC_Event,f=function(I){var l=this;if(this.apiCCId=null,this.apiCCSessionId=apiCC.randomString(22),this.apiKey=null,this.nickname=null,this.photoURL=null,this.apiCCWebRTCClient=null,this.apiCCIMClient=null,this.apiCCDataClient=null,this.apiCCIDCookie=null,this.apiKeyCookie=null,this.apiCCIdPersistenceTimeout=5e3,this.channel=null,this.recordActivated=I.recordActivated,this.sessionId=null,this.apiCCPointerSharingClient=null,this.apiCCWhiteBoardClient=null,this.apiCCCoBrowsingClient=null,this.ccsServer=I.ccsServer,this.userData=I.userData,this.apiDBActivated=!0,I.ApiDBActivated=!0,this.webRTCPluginActivated=I.webRTCPluginActivated,this.token=I.token,this.conversationSpace=I.conversationSpace,this.tryAudioCallAfterUserMediaError=I.tryAudioCallAfterUserMediaError,this.deactivateReloadOnCancel=I.deactivateReloadOnCancel,this.connectedUsersList=[],this.messageTimeOutTable=[],this.ccsConnectionRetryNb=I.ccsConnectionRetryNb,this.ccsConnectionRetryDelay=I.ccsConnectionRetryDelay,this.sequentialMessagesStorage={},this.messageTimeOutTimer=void 0!==I.messageTimeOutTimer?I.messageTimeOutTimer:1e4,p.log("messageTimeOutTimer set to : "+this.messageTimeOutTimer),this.presenceGroup=void 0!==I.presenceGroup?I.presenceGroup:["default"],this.subscribeToPresenceGroup=void 0!==I.subscribeToPresenceGroup?I.subscribeToPresenceGroup:["default"],this.isDeviceWebRTCCompliant=function(){return apiCC.isWebRTCCompliant()},this.isDeviceDTLSCompliant=function(){var b=w.E2.getBrowser(),H=parseInt(b.version,10);return!("Chrome"===b.name&&H<44&&(p.log("isDeviceDTLSCompliant FALSE : Chrome V < 44"),1))},null==this.userData?(this.userData={},this.userData.webRtcCompliant=apiCC.webRTCCompliant,this.userData.dtlsCompliant=this.isDeviceDTLSCompliant()):null==this.userData.webRtcCompliant?(this.userData.webRtcCompliant=apiCC.webRTCCompliant,this.userData.dtlsCompliant=this.isDeviceDTLSCompliant()):p.log("userData webRtcCompliant set to :",this.userData.webRtcCompliant),this.userData.osName=w.BF,this.userData.osVersion=w.MM,this.userData.browser=w.Xh,this.userData.deviceType=w.vO,this.userData.browser_version=w.dc,this.userData.browser_major_version=w.PR,this.userData.apiRTCVersion=apiCC.version,"Android"===w.BF&&"undefined"!=typeof cordova&&(this.userData.platform="Android"),"undefined"!=typeof apiRTC_React&&(this.userData.react=!0),this.roomManagerEventHandler=function(b){if(p.debug("roomManagerEventHandler, roomId :"+b.roomId+", type :"+b.type+", roomType :"+b.roomType),"whiteBoard"===b.roomType){if(null===apiCC.myApiCCWhiteBoardClient||void 0===apiCC.myApiCCWhiteBoardClient)return void p.log("No whiteBoard created, leaving msg processing");"roomCreation"===b.type&&(p.log("whiteBoard : roomCreation"),apiCC.myApiCCWhiteBoardClient.roomId=b.roomId,apiCC.myApiCCWhiteBoardClient.paperSheetId++,apiCC.myApiCCWhiteBoardClient.drawingId=0,apiCC.myApiCCWhiteBoardClient.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})),"roomInvitation"===b.type&&(p.log("whiteBoard : roomInvitation"),apiCC.myApiCCWhiteBoardClient.roomId=b.roomId),"roomMessage"===b.type&&apiCC.myApiCCWhiteBoardClient.messageProcessing(b.data),"roomJoin"===b.type&&(p.log("whiteBoard : roomJoin"),apiCC.myApiCCWhiteBoardClient.roomJoined=!0,apiCC.myApiCCWhiteBoardClient.roomId=b.roomId)}else"pointerSharing"===b.roomType?apiCC.session.apiCCPointerSharingClient&&"roomJoin"===b.type&&apiCC.session.apiCCPointerSharingClient.processMessageRoomJoin(b):"coBrowsing"===b.roomType?"roomMessage"===b.type&&p.log("coBrowsing : roomMessage :"+b):p.log("roomManagerEventHandler for msg.roomType :"+b.roomType)},this.callback=function(b,H){return this.closureHandler=function(ne){return b[H](ne)},this.closureHandler},this.roomMgr=new d(this,this.callback(this,"roomManagerEventHandler")),this.xhrPolling=!0===I.xhrPolling,this.getCookie=function(b){return new RegExp("(?:; )?"+b+"=([^;]*);?").test(document.cookie)?decodeURIComponent(RegExp.$1):null},this.generateApiCCID=function(){p.debug("apiCCId is not defined by user, checking if a cookie for apiCCId exist"),"undefined"==typeof apiRTC_React&&(this.apiCCIDCookie=this.getCookie("apiCCId"),this.apiKeyCookie=this.getCookie("apiKey")),null!==this.apiCCIDCookie?(p.log("apiCCId cookie exist : "+this.apiCCIDCookie),null!==this.apiKeyCookie?(p.log("apiKey cookie exist : "+this.apiKeyCookie),this.apiKeyCookie===this.apiKey?(p.log("apiKey is the same, keeping apiCCId"),this.apiCCId=this.apiCCIDCookie):(p.log("apiKey is not the same, generating an  apiCCId"),this.apiCCId=Math.floor(1000001*Math.random()).toString(),p.log("Creation of new ApiRTC session with Id : "+this.apiCCId))):this.apiCCId=this.apiCCIDCookie):(p.log(" No apiCCId cookie : generating an apiCCId"),this.apiCCId=String(1e5+Math.floor(9e5*Math.random())),p.log("Creation of new ApiRTC session with Id : "+this.apiCCId))},this.getNumericIdFromAlpha=function(b){p.log("getNumericIdFromAlpha new : "+b);var H,ne=0;if(0===b.length)return ne;for(H=0;H<b.length;H++)ne=(ne<<5)-ne+b.charCodeAt(H),ne&=ne;return p.log("getNumericIdFromAlpha returned value: "+(ne>>>0)),ne>>>0},void 0!==I.appId&&(this.appId=I.appId),void 0!==I.siteId&&(this.siteId=I.siteId),void 0===I.apiKey)return p.error('Error : Initialisation parameters: "apikey" for session creation is not defined'),null;if(p.log("Session creation with apiKey : "+I.apiKey),p.log("Session creation with apiCCId : "+I.apiCCId),this.apiKey=I.apiKey,void 0===I.onReady&&"undefined"==typeof apiRTC_React)return p.error('Error : Initialisation parameters: "onReady" for session creation is not defined'),null;if(apiCC.addEventListener("sessionReady",I.onReady),"undefined"==typeof apiRTC_React&&(this.sessionId=this.getCookie("sessionId")),void 0===I.apiCCId||""===I.apiCCId||null===I.apiCCId)this.generateApiCCID();else if(p.log("Session creation with apiCCId defined by user : "+I.apiCCId),p.debug("params.idConversionActivated : "+I.idConversionActivated),void 0===I.idConversionActivated||!0===I.idConversionActivated)if((0,n._C)(I.apiCCId))this.apiCCId=I.apiCCId.toString();else{p.log("Converting this Id in a numeric one");var V=this.getNumericIdFromAlpha(I.apiCCId);p.log("Numeric Id is : "+(V+="")),(0,n._C)(V)?(p.warn("Id has been converted to a numeric one"),this.apiCCId=V.toString()):(p.warn("Error : Defined apiCCId :"+I.apiCCId+" is not numeric. ApiCCID is generated"),this.generateApiCCID())}else p.log("String id convertion is deactivated"),this.apiCCId=I.apiCCId.toString();function T(b){return b instanceof Array?(p.log("data instanceof Array"),!0):(p.log("data not instanceof Array"),!1)}null!==I.apiCCIdPersistenceTimeout&&"number"==typeof I.apiCCIdPersistenceTimeout&&I.apiCCIdPersistenceTimeout>=0&&(this.apiCCIdPersistenceTimeout=I.apiCCIdPersistenceTimeout),null!==this.channel&&(p.log("this.channel is defined"),delete this.channel),this.channel=new S(this),this.channel.initialize(),null!=I.nickname?(p.log("Nickname is defined :"+I.nickname),this.nickname=I.nickname):(p.log("Nickname is not defined, setting to apiCCId value :"+this.apiCCId),this.nickname=this.apiCCId),null!=I.photoURL?(p.log("photoURL is defined :"+I.photoURL),this.photoURL=I.photoURL):(p.log("photoURL is not defined"),this.photoURL=null),this.reOpenChannel=function(b,H){p.info("reOpenChannel"),this.apiCCId=b.toString(),this.apiKey=H,null!=this.channel.socket&&this.channel.socket.disconnect(),this.channel.channelReady=!1,this.channel.socket=null,this.channel.channelId=this.apiCCId,this.channel.initialize(),null!==this.apiCCWebRTCClient&&null!==this.apiCCWebRTCClient.webRTCClient&&(this.apiCCWebRTCClient.webRTCClient.socket=this.channel.socket)},this.onChannelOpened=function(){p.debug("ApiCCSession onChannelOpened"),!1!==I.ApiDBActivated&&null!=I.ApiDBActivated&&(p.log("apiDB initialisation"),apiDB.init(this.channel.socket)),o.createSessionReadyEvent(apiCC.session.apiCCId)},this.createWebRTCClient=function(b){p.debug("createWebRTCClient");var H={};if(null!=b){this.apiCCWebRTCClient=new apiCC.ApiCCWebRTCClient(this,b.localVideo,b.minilocalVideo,b.remoteVideo,b.status,b.command),apiCC.session.apiCCWebRTCClient.webRTCClient.setGumConfigWithDevicePresent(),H.audioDevicePresent=apiCC.mediaDeviceMgr.audioDevicePresent,H.videoDevicePresent=apiCC.mediaDeviceMgr.videoDevicePresent,apiCC.session.setUserData(H),setTimeout(function(){o.createWebRTCClientCreatedEvent()});var ne=apiCC.getUserMediaStreamIds(),le=ne.length;for(p.debug("listing accessToLocalMedia "+le);--le>=0;)if(apiCC.getUserMediaStream(ne[le]).accessToLocalMedia()){p.debug("setting accessToLocalMedia to true"),this.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0;break}return this.apiCCWebRTCClient}return p.log("Error : Initialisation parameters is null or not defined on WebRTCClient creation"),null},this.createPointerSharingClient=function(){return null===this.apiCCPointerSharingClient&&(this.apiCCPointerSharingClient=new apiCC.ApiCCPointerSharingClient(this)),this.apiCCPointerSharingClient},this.closePointerSharingClient=function(){null!==this.apiCCPointerSharingClient&&this.apiCCPointerSharingClient instanceof apiCC.ApiCCPointerSharingClient&&(this.apiCCPointerSharingClient.stop(),this.apiCCPointerSharingClient=null)},this.createWhiteBoard=function(b,H,ne,le){return p.info("createWhiteBoard"),this.apiCCWhiteBoardClient=apiCC.createWhiteBoard(b,H,ne,le),this.apiCCWhiteBoardClient},this.closeWhiteBoardClient=function(b){p.info("closeWhiteBoardClient"),apiCC.closeWhiteBoardClient(b)},this.createCoBrowsing=function(){return p.info("createCoBrowsing"),this.apiCCCoBrowsingClient=new apiCC.ApiCCCoBrowsingClient(this),this.apiCCCoBrowsingClient},this.createIMClient=function(b){return p.debug("createIMClient"),this.apiCCIMClient=new apiCC.ApiCCIMClient(this,b),this.apiCCIMClient},this.createDataClient=function(){return p.info("createDataClient"),this.apiCCDataClient=new apiCC.ApiCCDataClient(this),this.apiCCDataClient},this.updatingQuery=function(b){p.debug("updatingQuery");var H=null,ne=null,le=null;return H=(0,n.dD)(b),void 0!==this.userData?(ne=JSON.stringify(this.userData),le=encodeURIComponent(ne),H.userData=le,(0,n.Wc)(H)):b},this.setUserData=function(b,H){p.debug("setUserData in session :",b);var le,W,be=[],de=this.userData;if(void 0!==this.userData){if(this.userData=(0,n.S6)(this.userData,b),p.debug("this.userData :",this.userData),p.debug("actualUserData :",de),p.debug("forceSendData :",H),!0!==H&&JSON.stringify(this.userData)===JSON.stringify(de))return void p.debug("userData is not changed, leaving userData processing")}else this.userData=b;for(le=JSON.stringify({type:"setUserData",userData:b}),p.log("C->S: "+le),this.channel.socket.emit("setUserData",le),p.log("socket.io 1.X : socket.io.opts.query :"+this.channel.socket.io.opts.query),this.channel.socket.io.opts.query=this.updatingQuery(this.channel.socket.io.opts.query),p.log("socket.io 1.X : after update : socket.io.opts.query :"+this.channel.socket.io.opts.query),W=0;W<this.connectedUsersList.length;W+=1)this.apiCCId===this.connectedUsersList[W].userId&&(this.connectedUsersList[W].userData=this.userData,be[0]=this.apiCCId,o.createConnectedUsersListUpdateEvent(this.connectedUsersList[W].group,be,"userDataUpdate","userDataUpdate"))},this.sendPresenceGroupManagementCommand=function(b,H){p.debug("sendPresenceGroupManagementCommand :"+b+" for group : "+H);var le,W,be=H.length;if("unsubscribe"===b)for(W=0;W<be;W+=1)this.removeGroupDataFromConnectedUsersList(H[W]);1!==be||"deactivated"!==H[0]?(le=JSON.stringify({type:"presenceGroupManagement",command:b,group:H}),p.log("C->S: "+le),this.channel.socket.emit("presenceGroupManagement",le)):p.debug("leaving sendPresenceGroupManagementCommand for group deactivated")},this.sendConversationSpaceCommand=function(b,H){var le;p.debug("sendConversationSpaceCommand :"+b+" for conversationSpace : "+H),le=JSON.stringify({type:"conversationSpaceManagement",command:b,conversationSpace:H}),p.log("C->S: "+le),this.channel.socket.emit("conversationSpaceManagement",le)},this.joinPresenceGroup=function(b){var H=this;p.info("joinPresenceGroup :"+b),!0===T(b)?(this.sendPresenceGroupManagementCommand("join",b),b.forEach(function(ne){-1===H.presenceGroup.indexOf(ne)&&H.presenceGroup.push(ne)})):p.log("group parameter value is not correct, need to be a JSON array"),p.debug("this.presenceGroup :"+this.presenceGroup)},this.leavePresenceGroup=function(b){var H=this;p.info("leavePresenceGroup :"+b),!0===T(b)?(b.forEach(function(ne){var le=H.presenceGroup.indexOf(ne);-1!==le&&H.presenceGroup.splice(le,1)}),this.sendPresenceGroupManagementCommand("leave",b)):p.log("group parameter value is not correct, need to be a JSON array"),p.debug("this.presenceGroup :"+this.presenceGroup)},this.subscribePresenceGroup=function(b){var H=this;p.info("subscribePresenceGroup :"+b),!0===T(b)?(this.sendPresenceGroupManagementCommand("subscribe",b),b.forEach(function(ne){-1===H.subscribeToPresenceGroup.indexOf(ne)&&H.subscribeToPresenceGroup.push(ne)})):p.log("group parameter value is not correct, need to be a JSON array"),p.debug("this.subscribeToPresenceGroup :"+this.subscribeToPresenceGroup)},this.unsubscribePresenceGroup=function(b){var H=this;p.info("unsubscribePresenceGroup :"+b),!0===T(b)?(b.forEach(function(ne){var le=H.subscribeToPresenceGroup.indexOf(ne);-1!==le&&H.subscribeToPresenceGroup.splice(le,1)}),this.sendPresenceGroupManagementCommand("unsubscribe",b)):p.log("group parameter value is not correct, need to be a JSON array"),p.debug("this.subscribeToPresenceGroup :"+this.subscribeToPresenceGroup)},this.joinConversationSpace=function(b){p.info("joinConversationSpace :"+b),this.sendConversationSpaceCommand("join",b),this.conversationSpace=b},this.leaveConversationSpace=function(b){p.info("leaveConversationSpace :"+b),null!=b&&this.conversationSpace===b?(this.sendConversationSpaceCommand("leave",b),this.conversationSpace=null):p.debug("socket is not in the conversationSpace, we request to leave")},this.subscribeToCloudEvent=function(b,H){this.sendCloudEventsCommand("subscribe",b,H)},this.unsubscribeToCloudEvent=function(b,H){this.sendCloudEventsCommand("unsubscribe",b,H)},this.sendCloudEventsCommand=function(b,H,ne){if(["subscribe","unsubscribe"].includes(b))if(H&&"string"==typeof H){if(ne){if("object"!==R(ne))return void p.error("wrong headers format");for(var le=0,W=Object.values(ne);le<W.length;le++){var be=W[le];if(!be||"string"!=typeof be)return void p.error("wrong headers format")}}var de={type:"cloudEvents",command:b,topic:H};ne&&(de.headers=ne);var ce=JSON.stringify(de);p.log("C->S:",ce),this.channel.socket.emit("cloudEvents",ce)}else p.error("wrong topic format");else p.error("wrong command")},this.getConversationList=function(b){var H;p.info("getConversationList request"),H=JSON.stringify(void 0!==b?{type:"getConversationList",lastConversationNb:b}:{type:"getConversationList",lastConversationNb:50}),p.log("C->S: "+H),this.channel.socket.emit("getConversationList",H)},this.receiveConversationListAnswer=function(b){p.info("receiveConversationListAnswer"),p.log("msg.convList.length :"+b.convList.length);var H,ne=b.convList.length,le=[],W=null;for(H=0;H<ne;H+=1)p.log("i ="+H),W=JSON.parse(b.convList[H]),le.push(W);o.createReceiveConversationListAnswerEvent(le)},this.getContactOccurrencesFromConversationList=function(b){var H;p.info("getContactOccurrencesFromConversationList request"),H=JSON.stringify(void 0!==b?{type:"getContactOccurrencesFromConversationList",lastConversationNb:b}:{type:"getContactOccurrencesFromConversationList",lastConversationNb:50}),p.log("C->S: "+H),this.channel.socket.emit("getContactOccurrencesFromConversationList",H)},this.receiveContactOccurrencesFromConversationListAnswer=function(b){p.info("receiveContactOccurrencesFromConversationListAnswer"),p.log("msg.contactOccurrencesTable.length :"+b.contactOccurrencesTable.length),o.createReceiveContactOccurrencesFromConversationListAnswerEvent(b.contactOccurrencesTable)},this.getConversationDetailReport=function(b){var ne;p.info("getConversationDetailReport for convId :"+b),ne=JSON.stringify({type:"getConversationDetailReport",convId:b}),p.log("C->S: "+ne),this.channel.socket.emit("getConversationDetailReport",ne)},this.receiveConversationDetailReportAnswer=function(b){p.info("receiveConversationDetailReportAnswer"),p.log("msg.CDR :"+b.CDR),o.createReceiveConversationDetailReportAnswerEvent(b.CDR)},this.manageConnectedUsersList=function(b,H,ne,le){p.debug("manageConnectedUsersList");var W,be,de,ce=!1,Ee=0,Ne=!1,Oe="unset";for(p.trace("manageConnectedUsersList.length :"+b.length),p.trace("this.connectedUsersList.length :"+this.connectedUsersList.length),p.log("state :"+H),p.log("group :"+ne),de=0;de<b.length;de+=1)b[de].group=ne;if("online"===H)for(p.log("state : online"),W=0;W<b.length;W+=1){if(p.log("msgConnectedUsersListWithStatus  :"+W),ce=!1,0===this.connectedUsersList.length){p.log("this.connectedUsersList is empty"),this.connectedUsersList=b,p.log("this.connectedUsersList[0].group :"+this.connectedUsersList[0].group),o.createConnectedUsersListUpdateEvent(ne,le,H,"newConnectionState");break}for(be=0;be<this.connectedUsersList.length;be+=1)if(Ne=!1,b[W].userId===this.connectedUsersList[be].userId&&b[W].group===this.connectedUsersList[be].group){ce=!0,JSON.stringify(this.connectedUsersList[be].userData)!==JSON.stringify(b[W].userData)&&(p.log("userData is updated"),this.connectedUsersList[be].userData=b[W].userData,Ne=!0,Oe="userDataUpdate"),this.connectedUsersList[be].callState!==b[W].callState&&(p.log("callState is updated"),this.connectedUsersList[be].callState=b[W].callState,Ne=!0,Oe="callState"),!0===Ne&&o.createConnectedUsersListUpdateEvent(ne,le,H,Oe);break}if(!1===ce){p.log("Adding user in connectedUsersList :"+b[W].userId),this.connectedUsersList.push(b[W]);var He=[];He[0]=b[W].userId,o.createConnectedUsersListUpdateEvent(ne,He,H,"newConnectionState")}}else for(p.log("state : offline"),W=0;W<b.length;W+=1)for(p.log("msgConnectedUsersListWithStatus  :"+W),Ee=this.connectedUsersList.length,be=0;be<Ee;be+=1)if(b[W].userId===this.connectedUsersList[be].userId&&b[W].group===this.connectedUsersList[be].group){p.log("Removing user in connectedUsersList :"+b[W].userId),p.log("... in group :"+b[W].group),this.connectedUsersList.splice(be,1),o.createConnectedUsersListUpdateEvent(ne,le,H,"newConnectionState");break}},this.removeGroupDataFromConnectedUsersList=function(b){p.debug("removeGroupDataFromConnectedUsersList for group :",b);var H,ne=this.connectedUsersList.length,le=[],W=0;for(p.debug("this.connectedUsersList.length :",this.connectedUsersList.length),H=0;H<ne;H+=1)p.debug("this.connectedUsersList[j].group :",this.connectedUsersList[H-W].group),p.debug("group :",b),this.connectedUsersList[H-W].group===b&&(p.log("Removing user in connectedUsersList :"+this.connectedUsersList[H-W].userId),le[0]=this.connectedUsersList[H-W].userId,this.connectedUsersList.splice(H-W,1),W+=1,o.createConnectedUsersListUpdateEvent(b,le,"offline","newConnectionState"))},this.getConnectedUsersList=function(b){p.log(void 0!==b?"getConnectedUsersList for group : "+b:"getConnectedUsersList : complete users list");var H,ne=[];if(null==b)return this.connectedUsersList;for(p.log("filtering list for group : "+b),H=0;H<this.connectedUsersList.length;H+=1)this.connectedUsersList[H].group===b&&ne.push(this.connectedUsersList[H]);return ne},this.isClientWebRtcCompliant=function(b){var H,ne,le=null,W=null;if(void 0!==b)for(H=this.getConnectedUsersList(),ne=0;ne<H.length;ne++)H[ne].userId===b&&null!=(W=H[ne].userData)&&void 0!==W.webRtcCompliant&&(le=W.webRtcCompliant);return le},this.isClientDTLSCompliant=function(b){var H,ne,le=!0,W=null;if(void 0!==b)for(H=this.getConnectedUsersList(),ne=0;ne<H.length;ne++)H[ne].userId===b&&(p.log("userData :",W=H[ne].userData),null!=W&&void 0!==W.dtlsCompliant&&(le=W.dtlsCompliant));return le},this.getConnectedUserIdsList=function(b){p.info("getConnectedUserIdsList, group :",b);var H,ne,le=[],W=!1,be={},de=[];if(p.log(void 0!==b?"getConnectedUserIdsList for group : "+b:"getConnectedUserIdsList : complete users list"),null==b)de=JSON.parse(JSON.stringify(this.connectedUsersList));else for(H=0;H<this.connectedUsersList.length;H+=1)this.connectedUsersList[H].group===b&&de.push(this.connectedUsersList[H]);for(H=0;H<de.length;H+=1){for(W=!1,ne=0;ne<le.length;ne++)if(le[ne].userId===de[H].userId){W=!0;break}!1===W&&((be={}).userId=de[H].userId,be.callState=de[H].callState,be.userData=de[H].userData,le.push(be))}return le},this.getGroupsFromConnectedUsersList=function(b){p.info("getGroupsFroConnectedUsersList");var H,ne=[],le=!1;for(H=0;H<this.connectedUsersList.length;H+=1)this.connectedUsersList[H].userId===b&&(p.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[H].group)),le=!0,ne.push(this.connectedUsersList[H].group));return!0===le?JSON.stringify(ne):"User_Not_Found"},this.getConnectedUserInfo=function(b,H){p.info("getConnectedUserInfo"),p.log("getConnectedUserInfo userId :",b),p.log("getConnectedUserInfo infoType :",H);var ne,le=null,W=null;switch(H){case"all":for(p.log("all"),ne=0;ne<this.connectedUsersList.length;ne+=1)if(this.connectedUsersList[ne].userId===b)return p.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[ne])),le=this.getGroupsFromConnectedUsersList(b),(W=JSON.parse(JSON.stringify(this.connectedUsersList[ne]))).groups=le,delete W.group,JSON.stringify(W);break;case"callState":for(p.log("callState"),ne=0;ne<this.connectedUsersList.length;ne+=1)if(this.connectedUsersList[ne].userId===b)return p.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[ne].callState)),this.connectedUsersList[ne].callState;break;case"userData":for(p.log("userData"),ne=0;ne<this.connectedUsersList.length;ne+=1)if(this.connectedUsersList[ne].userId===b)return p.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[ne].userData)),JSON.stringify(this.connectedUsersList[ne].userData);break;case"groups":return p.log("groups"),this.getGroupsFromConnectedUsersList(b);default:p.log("infoType not defined switch case : "+H)}return"User_Not_Found"},this.isConnectedUser=function(b){p.info("isConnectedUser");var H,ne=!1;for(H=0;H<this.connectedUsersList.length;H+=1)if(p.log(JSON.stringify(this.connectedUsersList[H])),this.connectedUsersList[H].userId===b)return p.log("isConnected :"+(ne=!0)),ne;return p.log("isConnected :"+ne),ne},this.displayConnectedUsersList=function(){var b;for(p.debug("displayConnectedUsersList"),b=0;b<this.connectedUsersList.length;b+=1)p.log("User :"+this.connectedUsersList[b].userId+" on group :"+this.connectedUsersList[b].group)},this.updatePresence=function(b){try{p.debug("updatePresence : ",JSON.stringify(b))}catch(H){p.debug(H)}p.log("updatePresence for group :"+b.group),this.manageConnectedUsersList(b.connectedUsersListWithStatus,b.state,b.group,b.connectedUsersList),o.createUpdatePresenceEvent(b.connectedUsersList,b.state,b.connectedUsersListWithStatus)},this.processCloudEventOccurred=function(b){p.debug("processCloudEventOccurred",b),o.createCloudEventOccurredEvent(b.event.type,b.event.target)},this.updateUserStatus=function(b){p.info("updateUserStatus"+b),o.createUpdateUserStatusEvent(b)},this.sendDebugCommand=function(b,H,ne){p.info("sendDebugCommand :"+b),new v.S(this.channel.socket).sendDebugCommand("getClientSocketsInfo",H,ne)},this.processSignalingMessage=function(b){var H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},ne=null,le=null,W=!1,be=null,de=null,ce=!1,Ee=null;if("invite"===b.type)this.apiCCWebRTCClient?(p.log("this.webRTCPluginActivated =",this.webRTCPluginActivated),("IE"===w.Xh||"Safari"===w.Xh&&w.PR<11)&&!0===this.webRTCPluginActivated?(p.log("managing call with WebRTC Plugin"),apiCC.manageWebRTCPlugin(function(){p.log("manageWebRTCPlugin cb on Invite"),apiCC.session.apiCCWebRTCClient.webRTCClient.processInvite(b)},function(){p.log("actionOnInstallationNeeded"),p.log("sending bye to be done"),new v.S(apiCC.session.channel.socket).sendBye(b.callId,b.calleeId,b.roomId,b.callerId,"WebRTC_Plugin_Installation_needed",b.data)})):(p.log("managing call with browser"),this.apiCCWebRTCClient.webRTCClient.processInvite(b))):p.warn("WebRTCClient is not created");else if("200OK"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200OK(b):p.warn("WebRTCClient is not created");else if("candidate"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processCandidate(b):p.warn("WebRTCClient is not created");else if("bye"===b.type)this.apiCCWebRTCClient?(p.log("bye message from:"+b.clientId+" for callId : "+b.callId),this.apiCCWebRTCClient.webRTCClient.onRemoteHangup(b.callId,b.clientId,b.roomId,b.reason,b.confId,b.data)):p.warn("WebRTCClient is not created");else if("update"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processUpdate(b):p.warn("WebRTCClient is not created");else if("200update"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200Update(b):p.warn("WebRTCClient is not created");else if("newConversationCreated"===b.type)this.apiCCIMClient?this.apiCCIMClient.newConversationCreated(b):p.warn("IMClient is not created");else if("IMMessage"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveMessage(b):p.warn("IMClient is not created");else if("groupChatCreation"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatCreation(b):p.warn("IMClient is not created");else if("groupChatInvitation"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatInvitation(b):p.warn("IMClient is not created");else if("groupChatMemberUpdate"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatMemberUpdate(b):p.warn("IMClient is not created");else if("addUserInGroupChatAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.addUserInGroupChatAnswer(b):p.warn("IMClient is not created");else if("groupChatMessage"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveGroupChatMessage(b):p.warn("IMClient is not created");else if("conversationHistoryAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveConversationHistory(b):p.warn("IMClient is not created");else if("getUserDataAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveUserDataAnswer(b):p.warn("IMClient is not created");else if("dataMessage"===b.type)this.apiCCDataClient?this.apiCCDataClient.receiveData(b):p.warn("DataClient is not created");else if("dataAck"===b.type)this.apiCCWebRTCClient.webRTCClient.processDataAck(b);else if("dataEndAck"===b.type)this.apiCCWebRTCClient.webRTCClient.processDataEndAck(b);else if("updateVideoQuality"===b.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processUpdateVideoQuality(b.callId,b.profile);else if("apiRTCDataMessage"===b.type)if(H.quiet||p.debug("apiRTCDataMessage:",b),(0,n.Ym)(b.data,"object"))if("joinSessionAnswer"===b.data.type)if(this.apiCCWebRTCClient){var Ne={roomName:b.data.roomId};(0,n.ki)(b.data,"convId","string")&&(Ne.convId=b.data.convId),(0,n.ki)(b.data,["data","mode"],"string")&&(Ne.data={mode:b.data.data.mode}),(0,n.ki)(b.data,["data","transition"],"string")&&"mesh2janus"===b.data.data.transition?this.apiCCWebRTCClient.webRTCClient.MCUClient.changeSessionMode(Ne,"mesh2janus"):this.apiCCWebRTCClient.webRTCClient.MCUClient.updateSessionAnswer(Ne,{createSession:!0})}else p.warn("WebRTCClient is not created");else if("slowLink"===b.data.type){if(this.apiCCWebRTCClient){var Oe={};b.data.advice&&(Oe.advice=b.data.advice),this.apiCCWebRTCClient.webRTCClient.processSlowLink(b.data.callId,Oe)}}else if("videoQualityChanged"===b.data.type)o.createVideoQualityChangedEvent(b.data.callId,b.data.roomId,b.data.hint,b.data.profile);else if("distantIceError"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processDistantIceError(b.data);else if("streamTrackChanged"===b.data.type)this.apiCCWebRTCClient&&b.data.hasOwnProperty("mline")&&b.data.hasOwnProperty("muted")&&this.apiCCWebRTCClient.webRTCClient.processStreamTrackMuteChanged(b.data.callId,b.data.mline,b.data.muted);else if("configureEncodings"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processConfigureEncodings(b.data);else if("activeSpeaker"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processAudioAmplitude(b.data,!0);else if("stopSpeaking"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processAudioAmplitude(b.data,!1);else if("updateStream"===b.data.type)this.apiCCWebRTCClient&&b.data.callId&&b.data.mline&&b.data.direction&&this.apiCCWebRTCClient.webRTCClient.processUpdateStream(b.data.callId,b.data.mline,b.data.direction);else if("startRecording"===b.data.type){if(this.apiCCWebRTCClient)if("COMPOSITE"===b.data.callId)this.apiCCWebRTCClient.webRTCClient.MCUClient.startCompositeRecording(b.data.mediaType,b.data.customIdInFilename,b.data.convId,b.data.data);else{for(Ee=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--Ee>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[Ee].callId===b.data.callId){ce=!0;break}ce?this.apiCCWebRTCClient.webRTCClient.MCUClient.startRecording(b.data.mediaType,b.data.customIdInFilename,b.data.convId,b.data.callId,b.data.data):p.info("cannot start recording (call not found)")}}else if("startStreaming"===b.data.type){if(this.apiCCWebRTCClient){for(Ee=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--Ee>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[Ee].callId===b.data.callId){ce=!0;break}ce?this.apiCCWebRTCClient.webRTCClient.MCUClient.startStreaming(b.data.service,b.data.server,b.data.streamKey,b.data.callId):p.info("cannot start streaming (call not found)")}}else if("startCallStatsMonitoring"===b.data.type){if(this.apiCCWebRTCClient){for(p.debug("startCallStatsMonitoring",b.data.callId),Ee=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--Ee>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[Ee].callId===b.data.callId){le=this.apiCCWebRTCClient.webRTCClient.callsTable[Ee];break}le?["chrome","firefox"].indexOf(n.wL.type)>=0?le.csmIntervalId?p.debug("call stats monitoring already started"):le.csmIntervalId=setInterval(le.callback(le,"csmHandler"),le.csmIntervalMs):p.debug("call stats are only supported on chrome and firefox"):p.debug("no such call")}}else"callOrder"===b.data.type?(p.log("callOrder received"),this.apiCCWebRTCClient?(this.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector=b.senderId,ne=this.apiCCWebRTCClient.webRTCClient.callWithNumber(b.data.caller,!0,{MCUType:"MCU-Callee",confId:b.data.confId,convId:b.data.convId},be),this.apiCCWebRTCClient.webRTCClient.myWebRTC_Event.createIncomingCallEvent(this.clientId,b.data.caller,b.data.caller,ne,!1,1,!1,"video",!0,"web","media")):p.warn("WebRTCClient is not created")):"subscribeOrder"===b.data.type?(p.log("subscribeOrder received"),this.apiCCWebRTCClient?(this.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector=b.senderId,b.data.data.subscribeOrder=!0,(de=[]).push(b.data.stream),this.apiCCWebRTCClient.webRTCClient.MCUClient.subscribeToStreams(de,"VIDEO",b.data.data,be,{noStreamCheck:!0})):p.warn("WebRTCClient is not created")):"distantCallEstablished"===b.data.type?this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processDistantCallEstablished(b.data):"simulcastFeedChanged"===b.data.type?this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processSimulcastFeedChanged(b.data):p.log("msg.data.type is not managed :"+b.data.type);else p.log("msg.data === undefined");else if("conversationListAnswer"===b.type)this.receiveConversationListAnswer(b);else if("contactOccurrencesFromConversationListAnswer"===b.type)this.receiveContactOccurrencesFromConversationListAnswer(b);else if("conversationDetailReport"===b.type)this.receiveConversationDetailReportAnswer(b);else if("updatePresence"===b.type)p.log("updatePresence"),this.updatePresence(b);else if("updateUserStatus"===b.type)p.log("updateUserStatus"),this.updateUserStatus(b);else if("receiveMCUSessionId"===b.type)p.log("receiveMCUSessionId"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionId(b):p.warn("WebRTCClient is not created");else if("joinSessionAnswer"===b.type)p.log("joinSessionAnswer"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionAnswer(b):p.warn("WebRTCClient is not created");else if("updateSessionAnswer"===b.type)p.log("updateSessionAnswer"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.updateSessionAnswer(b,{updateCalls:!0}):p.warn("WebRTCClient is not created");else if("availableStreams"===b.type)this.apiCCWebRTCClient?(p.log("message availableStreams received"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableStream(b.msg,"regular",function(ke,ze,we){o.createMCUAvailableStreamEvent([ze],ke)}):p.warn("WebRTCClient is not created")):p.warn("WebRTCClient is not created");else if("availableReplay"===b.type)this.apiCCWebRTCClient?(p.log("message availableReplay received"),this.apiCCWebRTCClient?(W=this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableReplay(b.msg),o.createMCUAvailableReplayEvent(b.msg,W)):p.warn("WebRTCClient is not created")):p.warn("WebRTCClient is not created");else if("availableComposite"===b.type)this.apiCCWebRTCClient?(p.log("message availableComposite received"),this.apiCCWebRTCClient?(W=this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableStream(b.msg,"composite"),o.createMCUAvailableCompositeEvent(b.msg,W)):p.warn("WebRTCClient is not created")):p.warn("WebRTCClient is not created");else if("onRemoveStream"===b.type)this.apiCCWebRTCClient?(p.log("message onRemoveStream received:",b),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.removeMCUStream(b.callId,b.msg.id,b.msg.reason):p.warn("WebRTCClient is not created")):p.warn("WebRTCClient is not created");else if("availableStreamsUpdate"===b.type)this.apiCCWebRTCClient?(p.log("message availableStreamsUpdate received"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.updateAvailableStream(b.msg,"regular",function(ke,ze,we,gt){o.createMCUAvailableStreamUpdateEvent([ze],ke)}):p.warn("WebRTCClient is not created")):p.warn("WebRTCClient is not created");else if("checkCallStatus"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processCheckCallStatus(b):p.warn("WebRTCClient is not created");else if("MCUSessionInvitation"===b.type)p.log("MCUSessionInvitation"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(b):p.warn("WebRTCClient is not created");else if("MCUSessionInvitationToGroupChat"===b.type)p.log("MCUSessionInvitationToGroupChat"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(b):p.warn("WebRTCClient is not created");else if("participantEjected"===b.type)p.log("participantEjected"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.participantEjected(b):p.warn("WebRTCClient is not created");else if("recordingStarted"===b.type)p.log("recordingStarted"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStarted(b):p.warn("WebRTCClient is not created");else if("recordingStopped"===b.type)p.log("recordingStopped"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStopped(b):p.warn("WebRTCClient is not created");else if("recordingStreamAvailable"===b.type)p.log("recordingStreamAvailable"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStreamAvailable(b):p.warn("WebRTCClient is not created");else if("streamingStarted"===b.type)p.log("streamingStarted"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.streamingStarted(b):p.warn("WebRTCClient is not created");else if("streamingStopped"===b.type)p.log("streamingStopped"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.streamingStopped(b):p.warn("WebRTCClient is not created");else if("sessionId"===b.type)p.log("sessionId :"+b.sessionId),this.sessionId=b.sessionId;else if("roomCreation"===b.type)p.log("roomCreation"),this.roomMgr.roomCreation(b);else if("roomJoin"===b.type)p.log("roomJoined"),this.roomMgr.roomJoin(b);else if("inviteInRoomStatus"===b.type)p.log("inviteInRoomStatus"),this.roomMgr.inviteInRoomStatus(b);else if("contactListInRoom"===b.type)p.log("contactListInRoom"),this.roomMgr.onContactListInRoom(b);else if("roomInvitation"===b.type)p.log("roomInvitation"),this.roomMgr.roomInvitation(b);else if("roomMessage"===b.type)p.log("roomMessage"),this.roomMgr.receiveRoomMessage(b);else if("roomMemberUpdate"===b.type)p.log("roomMemberUpdate"),this.roomMgr.roomMemberUpdate(b);else if("agentReconnect"===b.type){var He=this.apiCCWebRTCClient.webRTCClient.findCallWithCallId(b.callId);null!=He&&He.getUserMediaOnCall()}else"sequence"===b.type?(p.log("Sequential message"),this.handleSequentialMessage(b)):"Ack"===b.type?p.log("Ack received"):"error"===b.type?(p.log("error received"),o.createErrorEvent(b.errorInfo,b.errorCode,b.callId,b.roomId,null,null,b.convId)):"enterpriseConfig"===b.type?(p.log("enterpriseConfig received"),this.handleEnterpriseConfigMessage(b)):"AIEMessage"===b.type?(p.log("AIEMessage received"),this.handleAIEMessage(b)):"cloudEventOccurred"===b.type?this.processCloudEventOccurred(b):p.log("Error : No type for this message")},this.handleSequentialMessage=function(b){if(void 0!==b.id&&void 0!==b.packetNum&&void 0!==b.totalPacketsNum&&void 0!==b.data){p.debug("Handle sequential message packet "+b.packetNum+"/"+b.totalPacketsNum,b);var H=[];if(void 0!==l.sequentialMessagesStorage[b.id]&&(H=l.sequentialMessagesStorage[b.id]),H.push(b),l.sequentialMessagesStorage[b.id]=H,H.length===b.totalPacketsNum){H.sort(function(W,be){return W.packetNum-be.packetNum});var ne="";H.forEach(function(W){ne+=W.data}),delete l.sequentialMessagesStorage[b.id];var le=null;try{le=JSON.parse(ne)}catch(W){return void p.error("Error : can't parse sequential message JSON :",W)}if(!le)return void p.error("Error : can't restore sequential message, it's null");p.debug("Restored sequential message :",ne),l.processSignalingMessage(le)}}else p.error("Error : sequential message is inconsistent :",b)},this.handleEnterpriseConfigMessage=function(b){var H;if(p.debug("handleEnterpriseConfigMessage :",b),(0,n.ki)(b,"sentry","boolean")&&!0===b.sentry&&(H=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol&&"https:"!==window.location.protocol?"http":"https",apiCC.loadSentry(apiCC.initApiKey,H)),(0,n.ki)(b,"customJson","string")&&""!==b.customJson)try{p.debug("customJson :",b.customJson),b.customJson=JSON.parse(b.customJson)}catch(ne){p.error(ne)}if((0,n.ki)(b,"iceServers","string")&&""!==b.iceServers)try{p.debug("iceServers :",b.iceServers),b.iceServers=JSON.parse(b.iceServers),l.apiCCWebRTCClient.setPcConfig(b.iceServers)}catch(ne){p.error(ne)}(0,n.ki)(b,"logLevel","string")&&""!==b.logLevel&&!isNaN(parseInt(b.logLevel))&&apiRTC.setLogLevel(parseInt(b.logLevel)),(0,n.ki)(b,"ccs","object")&&(l.ccsInfo=Object.assign({},b.ccs))},this.handleAIEMessage=function(b){switch(p.debug("handleAIEMessage :",b),b.detail){case"modelLoaded":if(void 0!==apiCC&&void 0!==b.userMediaStreamId){var H=apiCC.getUserMediaStream(b.userMediaStreamId).mediaFilterManager;for(var ne in H.filters)void 0!==H.filters[ne]&&null!==H.filters[ne].streamAIE&&H.filters[ne].streamAIE.modelLoaded(b)}break;case"unknownModelName":p.error("Unknown model name :",b.modelName);break;case"loadModelError":p.error("Error while loading model :",b.info);break;default:p.debug("Unknown detail :",b.detail)}}}},5981:(F,Y,e)=>{"use strict";e.d(Y,{q:()=>_}),e(4363),e(9653),e(3710),e(1539),e(9714),e(561),e(2564),e(4812),e(6992),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2707),e(7042),e(8309),e(9753),e(9554),e(4747),e(8674),e(2526),e(1817),e(2165),e(8783),e(3948);var i=e(1549),c=e(5945),d=e(4708);e(2479),e(9070),e(8304),e(489),e(2419),e(8011);var w=function(){function P(){!function(K,X){if(!(K instanceof X))throw new TypeError("Cannot call a class as a function")}(this,P)}var oe;return(oe=[{key:"applyFilter",value:function(K,X){}},{key:"release",value:function(){}}])&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(P.prototype,oe),P}(),A=(e(9743),e(7327),e(944));function C(P,x){if(!(P instanceof x))throw new TypeError("Cannot call a class as a function")}var n=function(){function P(){var K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;C(this,P),this.blurMask=K,this.smoothBorder=X,this.blurFactor=me,this.smoothingFactor=Q,this.maskImage=null,this.net=null}var oe;return oe=[{key:"loadModel",value:function(){var K=this;return new Promise(function(X,me){bodyPix.load({architecture:"MobileNetV1",outputStride:16,multiplier:.75,quantBytes:2}).then(function(Q){K.net=Q,X()})})}},{key:"computeMask",value:function(K){var X=this;return new Promise(function(me,Q){X.net.segmentPerson(K).then(function(re){X.width=re.width,X.height=re.height,X.length=X.width*X.height;for(var ye=new Uint8ClampedArray(4*X.length),Se=0;Se<X.length;Se++){var ge=255*re.data[Se];ye[4*Se+0]=ge,ye[4*Se+1]=ge,ye[4*Se+2]=ge,ye[4*Se+3]=255}var Pe=document.createElement("canvas"),xe=Pe.getContext("2d");Pe.width=X.width,Pe.height=X.height;var We=new ImageData(ye,X.width,X.height);if(xe.putImageData(We,0,0),X.blurMask&&(xe.filter="blur("+X.blurFactor+"px)"),xe.drawImage(Pe,0,0,X.width,X.height),X.maskImage=xe.getImageData(0,0,X.width,X.height),X.blurMask)if(X.smoothBorder){if(-1!==X.smoothingFactor){var rt=new A.H(X.maskImage,X.width,X.height);X.maskImage=rt.sigmoidFilter(X.smoothingFactor)}}else{var Et=new A.H(X.maskImage,X.width,X.height);X.maskImage=Et.threshold(40,40,40,255,!1)}me(X.maskImage)})})}},{key:"applyTransparency",value:function(K){var X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===X&&(X=this.maskImage);for(var me=new Uint8ClampedArray(K.width*K.height*4),Q=0;Q<K.width*K.height;Q++)me[4*Q+0]=K.data[4*Q+0],me[4*Q+1]=K.data[4*Q+1],me[4*Q+2]=K.data[4*Q+2],me[4*Q+3]=X.data[4*Q];var re=new ImageData(me,K.width,K.height);return re}},{key:"superposeImages",value:function(K,X,me){var Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null===Q&&(Q=this.maskImage);var re=new A.H(X,K.width,K.height),ye=re.weightedSumMask(me,Q);return ye}},{key:"setBackground",value:function(K,X){var me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.superposeImages(K,K,X,me)}},{key:"blurBackground",value:function(K){var X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=new A.H(K,K.width,K.height),re=Q.blur(X);return this.setBackground(K,re,me)}}],oe&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(P.prototype,oe),P}();function v(P,x){if(!(P instanceof x))throw new TypeError("Cannot call a class as a function")}var p=i.Y.get("StreamSegmentation"),o=apiCC.myWebRTC_Event,f=function(){function P(K){var X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:360,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;v(this,P),this.mediaStream=K,this.backgroundMode="none",this.backgroundBlurFactor=10,this.canvasWidth=X,this.canvasHeight=me,this.length=this.canvasWidth*this.canvasHeight,this.userMediaStreamId=Q;for(var re=new Uint8ClampedArray(4*this.length),ye=0;ye<4*this.length;ye++)re[ye]=255;this.backgroundImage=new ImageData(re,this.canvasWidth,this.canvasHeight);var Se=!0,ge=!0,Pe=5,xe=-1;this.backSub=new n(Se,ge,Pe,xe),this.modelLoaded=!1,this.maskStreamLaunched=!1,this.backgroundSubtractionActivated=!1}var oe;return oe=[{key:"setBackgroundMode",value:function(K){this.backgroundMode=K}},{key:"setBackgroundImage",value:function(K){this.backgroundImage=K}},{key:"setBackgroundBlurFactor",value:function(K){this.backgroundBlurFactor=K}},{key:"loadModel",value:function(){p.debug("Loading model");var K=this;return new Promise(function(X,me){K.backSub.loadModel().then(function(Q){K.modelLoaded=!0,p.debug("Model loaded"),X()})})}},{key:"getMaskStream",value:function(){var K=document.createElement("video");K.srcObject=this.mediaStream;var X=document.createElement("canvas"),me=X.getContext("2d");X.width=this.canvasWidth,X.height=this.canvasHeight;var Q=document.createElement("canvas"),re=Q.getContext("2d");Q.width=this.canvasWidth,Q.height=this.canvasHeight;var ye=this;K.addEventListener("loadeddata",function(){K.play(),requestAnimationFrame(Qe),ye.modelLoaded?We=!0:ye.loadModel().then(function(yt){We=!0})});for(var Se=!0,ge=new Uint8ClampedArray(4*this.length),Pe=0;Pe<4*this.length;Pe++)ge[Pe]=255;var xe=new ImageData(ge,this.canvasWidth,this.canvasHeight);re.putImageData(xe,0,0);var We=!1,rt=0,Et=!0;function Qe(){me.drawImage(K,0,0,X.width,X.height);var yt=me.getImageData(0,0,X.width,X.height);if(ye.modelLoaded&&Se&&We&&(Et||"none"!==ye.backgroundMode)){Et&&(Et=!1);var ct=new Date;Se=!1,ye.backSub.computeMask(yt).then(function(ht){Se=!0,1/((new Date-ct)/1e3)<1&&++rt>=10&&(We=!1,p.error("The segmentation process cannot be handled"),o.createBackgroundSubstractionStopComputeTimeEvent(ye.userMediaStreamId))})}re.putImageData(ye.modelLoaded&&null!==ye.backSub.maskImage&&We?ye.backSub.maskImage:xe,0,0),ye.continueMaskComputation?requestAnimationFrame(Qe):(p.debug("Mask computation stoped"),ye.continueMaskComputation=!0)}return this.continueMaskComputation=!0,this.maskMediaStream=Q.captureStream(),this.maskStreamLaunched=!0,this.maskMediaStream}},{key:"activateBackgroundSubtraction",value:function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==K&&this.setBackgroundMode(K),this.backgroundSubtractionActivated)return this.processedMediaStream;this.maskStreamLaunched||this.getMaskStream();var X=document.createElement("video");X.srcObject=this.mediaStream;var me=document.createElement("video");me.srcObject=this.maskMediaStream;var Q=document.createElement("canvas"),re=Q.getContext("2d");Q.width=this.canvasWidth,Q.height=this.canvasHeight;var ye=document.createElement("canvas"),Se=ye.getContext("2d");ye.width=this.canvasWidth,ye.height=this.canvasHeight,this.continueBackgroundSubtraction=!0;var ge=this;function Pe(){re.drawImage(X,0,0,Q.width,Q.height);var xe=re.getImageData(0,0,Q.width,Q.height);if("none"===ge.backgroundMode)Se.putImageData(xe,0,0);else{re.drawImage(me,0,0,Q.width,Q.height);var We=re.getImageData(0,0,Q.width,Q.height),rt=null;switch(ge.backgroundMode){case"image":rt=ge.backSub.setBackground(xe,ge.backgroundImage,We);break;default:rt=ge.backSub.blurBackground(xe,ge.backgroundBlurFactor,We);break;case"transparent":rt=ge.backSub.applyTransparency(xe,We)}Se.putImageData(rt,0,0)}ge.continueBackgroundSubtraction?requestAnimationFrame(Pe):(p.debug("Mask application stoped"),ge.continueBackgroundSubtraction=!0)}return X.addEventListener("loadeddata",function(){X.play(),me.play(),requestAnimationFrame(Pe)}),this.processedMediaStream=ye.captureStream(30),this.backgroundSubtractionActivated=!0,this.processedMediaStream}},{key:"deactivateBackgroundSubtraction",value:function(){this.setBackgroundMode("none"),this.processedMediaStream=this.mediaStream,this.backgroundSubtractionActivated=!1,this.continueBackgroundSubtraction=!1,this.maskMediaStream=null,this.maskStreamLaunched=!1,this.continueMaskComputation=!1}}],oe&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(P.prototype,oe),P}();function I(P){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(P)}function V(P,x){return(V=Object.setPrototypeOf||function(oe,K){return oe.__proto__=K,oe})(P,x)}function T(P,x){if(x&&("object"===I(x)||"function"==typeof x))return x;if(void 0!==x)throw new TypeError("Derived constructors may only return object or undefined");return function(oe){if(void 0===oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return oe}(P)}function b(P){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)})(P)}var H=i.Y.get("OldMediaFilterBackgroundSubtraction"),ne=function(P){!function(re,ye){if("function"!=typeof ye&&null!==ye)throw new TypeError("Super expression must either be null or a function");re.prototype=Object.create(ye&&ye.prototype,{constructor:{value:re,writable:!0,configurable:!0}}),ye&&V(re,ye)}(Q,P);var oe,K,X,me=(K=Q,X=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(re){return!1}}(),function(){var re,ye=b(K);if(X){var Se=b(this).constructor;re=Reflect.construct(ye,arguments,Se)}else re=ye.apply(this,arguments);return T(this,re)});function Q(){var re;return function(ye,Se){if(!(ye instanceof Se))throw new TypeError("Cannot call a class as a function")}(this,Q),(re=me.call(this)).streamSegmentation=null,re.userMediaStreamId=null,re}return(oe=[{key:"applyFilter",value:function(re,ye){var Se=this;H.debug("Apply filter with descriptor:",ye);var ge=re.getAudioTracks();ge.length>0&&ge.forEach(function(We){re.removeTrack(We)});var Pe=re.getVideoTracks();if(0===Pe.length)return Promise.reject("MediaStream has no video tracks");var xe=Pe[0].getSettings();return void 0!==ye.options&&void 0!==ye.options.userMediaStreamId&&(this.userMediaStreamId=ye.options.userMediaStreamId),this.streamSegmentation=new f(re,xe.width,xe.height,this.userMediaStreamId),this.loadTensorflow().then(function(We){return Se.loadTensorflowModel()}).then(function(We){return new Promise(function(rt,Et){H.debug("Model loading..."),Se.streamSegmentation.loadModel().then(function(Qe){H.debug("Model loaded");var yt=null;void 0!==ye.options&&void 0!==ye.options.backgroundMode&&("image"===ye.options.backgroundMode&&ye.options.image instanceof ImageData&&Se.streamSegmentation.setBackgroundImage(ye.options.image),yt=ye.options.backgroundMode);var ct=Se.streamSegmentation.activateBackgroundSubtraction(yt);ge.forEach(function(ht){ct.addTrack(ht)}),rt(ct)})})}).catch(function(We){return Promise.reject(We)})}},{key:"release",value:function(){this.streamSegmentation.deactivateBackgroundSubtraction(),this.streamSegmentation=null}},{key:"loadTensorflow",value:function(){return H.debug("Tensorflow script loading..."),new Promise(function(re,ye){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"],"tensorflow",{async:!0,numRetries:20,reqdelay:200,success:function(){H.debug("Tensorflow script loaded"),re()},error:function(ge){ye("Resources loading failed, depsNotFound: "+ge)},retrycb:function(ge,Pe){H.warn("Tensorflow loading retry :"+ge+" ,delay before retry :"+Pe)}})})}},{key:"loadTensorflowModel",value:function(){return H.debug("Tensorflow model script loading..."),new Promise(function(re,ye){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"],"tensorflow-model",{async:!0,numRetries:20,reqdelay:200,success:function(){H.debug("Tensorflow model script loaded"),re()},error:function(ge){ye("Resources loading failed, depsNotFound: "+ge)},retrycb:function(ge,Pe){H.warn("Tensorflow model loading retry :"+ge+" ,delay before retry :"+Pe)}})})}}])&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(Q.prototype,oe),Q}(w);function le(P,x){var oe="undefined"!=typeof Symbol&&P[Symbol.iterator]||P["@@iterator"];if(!oe){if(Array.isArray(P)||(oe=function(ye,Se){if(ye){if("string"==typeof ye)return W(ye,void 0);var ge=Object.prototype.toString.call(ye).slice(8,-1);return"Object"===ge&&ye.constructor&&(ge=ye.constructor.name),"Map"===ge||"Set"===ge?Array.from(ye):"Arguments"===ge||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ge)?W(ye,void 0):void 0}}(P))||x&&P&&"number"==typeof P.length){oe&&(P=oe);var K=0,X=function(){};return{s:X,n:function(){return K>=P.length?{done:!0}:{done:!1,value:P[K++]}},e:function(ye){throw ye},f:X}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var me,Q=!0,re=!1;return{s:function(){oe=oe.call(P)},n:function(){var ye=oe.next();return Q=ye.done,ye},e:function(ye){re=!0,me=ye},f:function(){try{Q||null==oe.return||oe.return()}finally{if(re)throw me}}}}function W(P,x){(null==x||x>P.length)&&(x=P.length);for(var oe=0,K=new Array(x);oe<x;oe++)K[oe]=P[oe];return K}function be(P){return(P[2]-P[0])*(P[3]-P[1])}function de(P,x){var K=P[1],X=P[2],me=P[3],re=x[1],ye=x[2],Se=x[3],ge=be([Math.max(P[0],x[0]),Math.max(K,re),Math.min(X,ye),Math.min(me,Se)]);return ge/(be(P)+be(x)-ge)}function ce(P){var x,oe=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=P.yolo,me={yolo:[]},Q=le(X);try{for(Q.s();!(x=Q.n()).done;){var re=x.value,ye=re.objectness;if(ye>oe)if(null!==K){var Se,ge=re.bounding_box,Pe=be(ge),xe=0,We=null,rt=0,Et=le(X);try{for(Et.s();!(Se=Et.n()).done;){var Qe=Se.value,yt=Qe.bounding_box,ct=de(ge,yt);1!==ct&&ct>xe&&(xe=ct,We=Qe,rt=be(Qe.bounding_box))}}catch(ht){Et.e(ht)}finally{Et.f()}(null===We||xe<K||rt<Pe)&&me.yolo.push(re)}else me.yolo.push(re)}}catch(ht){Q.e(ht)}finally{Q.f()}return me}function Ee(P,x){var oe,K=P.yolo,X={yolo:[]},me=le(x.yolo);try{for(me.s();!(oe=me.n()).done;){var Q,re=oe.value,ye=re.class,Se=re.bounding_box,ge=re.objectness,Pe=ge,xe=le(K);try{for(xe.s();!(Q=xe.n()).done;){var We=Q.value;if(We.class===ye){var rt=de(We.bounding_box,Se);rt>0&&(Pe=ge+.75*(1-ge)*rt*We.objectness)}}}catch(Qe){xe.e(Qe)}finally{xe.f()}X.yolo.push({class:ye,objectness:Pe,bounding_box:Se})}}catch(Qe){me.e(Qe)}finally{me.f()}return X}function Ne(P,x){return function(oe){if(Array.isArray(oe))return oe}(P)||function(oe,K){var X=null==oe?null:"undefined"!=typeof Symbol&&oe[Symbol.iterator]||oe["@@iterator"];if(null!=X){var me,Q,re=[],ye=!0,Se=!1;try{for(X=X.call(oe);!(ye=(me=X.next()).done)&&(re.push(me.value),!K||re.length!==K);ye=!0);}catch(ge){Se=!0,Q=ge}finally{try{ye||null==X.return||X.return()}finally{if(Se)throw Q}}return re}}(P,x)||function(oe,K){if(oe){if("string"==typeof oe)return Oe(oe,K);var X=Object.prototype.toString.call(oe).slice(8,-1);return"Object"===X&&oe.constructor&&(X=oe.constructor.name),"Map"===X||"Set"===X?Array.from(oe):"Arguments"===X||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(X)?Oe(oe,K):void 0}}(P,x)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(P,x){(null==x||x>P.length)&&(x=P.length);for(var oe=0,K=new Array(x);oe<x;oe++)K[oe]=P[oe];return K}e(4916),e(3123),e(4723),e(6699),e(2023),e(9720),e(9600),e(1058),e(1038);var ke=i.Y.get("StreamAIE"),ze=apiCC.myWebRTC_Event,we=function(){function P(K,X){(function(Q,re){if(!(Q instanceof re))throw new TypeError("Cannot call a class as a function")})(this,P),this.mediaStream=K,this.descriptorOptions=X,this.modelName=X.modelName,this.maxBoxes=X.maxBoxes||null,this.scoreThresh=X.scoreThresh||null,this.forceReload=X.forceReload||!1,this.classFilter=this.descriptorOptions.classFilter||"all",this.drawingConfig=this.descriptorOptions.drawingConfig||{},this.userMediaStreamId=X.userMediaStreamId,this.clientId=X.clientId;var me=this.mediaStream.getVideoTracks();0===me.length&&(this.mediaSettings=null),this.mediaSettings=me[0].getSettings(),this.canvasWidth=this.mediaSettings.width||480,this.canvasHeight=this.mediaSettings.height||480,this.length=this.canvasWidth*this.canvasHeight,this.snapshot=!1,this.log=!1,this.minSnapshotPeriod=0,this.memoryTime=0,this.lastAnnotations={yolo:[]},this.lastRawAnnotations={yolo:[]},this.objectDetectionActivated=!1,this.drawAnnotationsBool=!1,this.aieUrl=null,this.token=null,this.loadedModel=null,this.promises=[],this.isReleased=!1,this.resinzingSize=416,this.callId=null}var oe;return oe=[{key:"activateLogs",value:function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.memoryTime=K,this.log=!0}},{key:"stopLogs",value:function(){this.log=!1,this.memoryTime=0}},{key:"activateSnapshots",value:function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.snapshot=!0,this.minSnapshotPeriod=K}},{key:"stopSnapshots",value:function(){this.snapshot=!1,this.minSnapshotPeriod=0}},{key:"activateAnnotations",value:function(){this.lastAnnotations={yolo:[]},this.drawAnnotationsBool=!0,this.getAnnotations()}},{key:"stopAnnotations",value:function(){this.drawAnnotationsBool=!1}},{key:"getAnnotations",value:function(){var K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=document.createElement("video");X.srcObject=this.mediaStream;var me=document.createElement("canvas"),Q=me.getContext("2d");me.width=this.canvasWidth,me.height=this.canvasHeight;var re=document.createElement("canvas"),ye=re.getContext("2d");re.width=this.canvasWidth,re.height=this.canvasHeight;var Se=this;function ge(Yt,oi){for(var ei=Yt.split(","),Ci=ei[0].match(/:(.*?);/)[1],Ai=atob(ei[1]),yi=Ai.length,gi=new Uint8Array(yi);yi--;)gi[yi]=Ai.charCodeAt(yi);return new File([gi],oi,{type:Ci})}X.addEventListener("loadeddata",function(){X.play(),requestAnimationFrame(function(){Bi(Se.aieUrl,Se.token,Se.loadedModel)})});var Pe=!0,xe={},We=null,rt=new Date;function Et(Yt,oi,ei){var Ci=ge(me.toDataURL("image/jpeg")),Ai={pipelineCallId:Se.getOrCreatePipeline(),file:Ci,transferType:"plugin",pluginName:"httpPost",pluginData:{url:Yt,headers:{Authorization:"Token "+oi},formData:{file:"$DATA",angled:1,model:ei,size:Se.resinzingSize}}};apiCC.session.apiCCWebRTCClient.webRTCClient.pushData(null,Ai,null,{success:function(yi){var gi=(new Date-We)/1e3;return ke.debug("Computation time:",gi,"s ,FPS:",1/gi),Bi(Yt,oi,ei),void 0!==yi.data.error?ke.error("http post error :",yi.data.error):void 0===yi.data.result?ke.error("An error occured when trying to annotate a snapshot"):void Qe(yi.data)},failure:function(yi,gi,ki){ke.error("## pushData:failure",gi,ki,yi)}})}function Qe(Yt){var oi=Yt.result;Se.isReleased||(Se.lastRawAnnotations=oi,void 0!==oi.yolo&&ct(oi),void 0===oi.ocr&&void 0===oi.codes||yt(oi))}function yt(Yt){Se.lastAnnotations={ocr:Yt.ocr,codes:Yt.codes};var oi="";if(Yt.ocr.length>1){oi+="Words found : ";for(var ei=0;ei<Yt.ocr.length;ei++)oi=oi+Yt.ocr[ei].text+", "}if(Yt.codes.length>1){oi+="Codes found : ";for(var Ci=0;Ci<Yt.codes.length;Ci++)oi=oi+Yt.codes[Ci].code+", "}ht(oi),mi()}function ct(Yt){Yt.yolo.length>0&&(K&&(Yt=Ee(Se.lastRawAnnotations,Yt)),null!==Se.scoreThresh&&(Yt=ce(Yt,Se.scoreThresh)));for(var oi={yolo:[]},ei={},Ci=Se.classFilter.split(", "),Ai=0;Ai<Yt.yolo.length;Ai++){var yi=Yt.yolo[Ai];("all"===Se.classFilter||Ci.includes(yi.class))&&(yi.class in ei||(ei[yi.class]=0),ei[yi.class]+=1,oi.yolo.push(yi))}if(Se.lastAnnotations=Yt=oi,Se.log||Se.snapshot){for(var gi=new Date,ki=[],Gi=0,_i=Object.entries(ei);Gi<_i.length;Gi++){var Ni=Ne(_i[Gi],2),Oi=Ni[0];ki.push(Ni[1]+" "+Oi+"(s) detected."),(!(Oi in xe)||gi-xe[Oi]>1e3*Se.memoryTime)&&(xe[Oi]=gi)}var Di=ki.sort().join(" ");""!==Di&&(ht(Di),mi())}}function ht(Yt){Se.log&&ze.createAIELogEvent(Se.userMediaStreamId,Yt)}function mi(){if(Se.snapshot){var Yt=new Date,oi=Q.getImageData(0,0,me.width,me.height);if(Yt-rt>1e3*Se.minSnapshotPeriod){ye.putImageData(oi,0,0),Se.drawAnnotations(Se.lastAnnotations,ye,Se.drawingConfig);var ei=re.toDataURL("image/png"),Ci=new Image;Ci.src=ei,ze.createAIESnapshotEvent(Se.userMediaStreamId,Ci),rt=Yt}}}function Bi(Yt,oi,ei){Q.drawImage(X,0,0,me.width,me.height),(Pe||Se.drawAnnotationsBool)&&(Pe&&(Pe=!1),We=new Date,Et(Yt,oi,ei))}}},{key:"getOrCreatePipeline",value:function(){if(null!==this.callId)return this.callId;var K=this;return this.callId=apiCC.session.apiCCWebRTCClient.webRTCClient.pushData(null,{transferType:"pipeline"},null,{failure:function(X){"dataChannelClosed"===X?(ke.debug("dataChannelClosed : no activity on dataChannel timeout"),K.callId=null):ke.error("dataChannel failure",X)}}),this.callId}},{key:"drawAnnotations",value:function(K,X){var me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=me.color||"#ED5131",re=me.textColor||"#FFFFFF",ye=me.colorMap||null,Se=me.lineWidth||3,ge=me.font||"15px Arial";if(void 0!==K.yolo&&K.yolo.length>0){null===me&&(me={});for(var Pe=0;Pe<K.yolo.length;Pe++){var xe=K.yolo[Pe],We=xe.bounding_box,rt=We[0],Et=We[1],Qe=We[2],yt=We[3];"mask_augmented_refined"===this.modelName&&(Qe-=rt,yt-=Et);var ct=Q;null!==ye&&xe.class in ye&&(ct=ye[xe.class]),X.lineWidth=Se,X.strokeStyle=ct,X.strokeRect(rt,Et,Qe,yt),X.font=ge;var ht=parseInt(ge,10),mi=xe.class,Bi=X.measureText(mi).width;X.fillStyle=ct,X.fillRect(rt-Se/2,Et-Math.round(4*ht/3),Bi+ht+Se,Math.round(4*ht/3)),X.fillStyle=re,X.fillText(mi,rt+Math.round(ht/2)-Se/2,Et-Math.round(ht/2))}}if(void 0!==K.ocr&&K.ocr.length>0){null===me&&(me={}),ge=me.font||"25px Arial";for(var Yt=0;Yt<K.ocr.length;Yt++){var oi=K.ocr[Yt],ei=oi.bounding_box,Ci=ei[0],Ai=ei[1],yi=ei[2],gi=ei[3];"mask_augmented_refined"===this.modelName&&(yi-=Ci,gi-=Ai),X.lineWidth=Se,X.strokeStyle=Q,X.strokeRect(Ci,Ai,yi,gi),X.font=ge;var ki=parseInt(ge,10),Gi=oi.text,_i=X.measureText(Gi).width;X.fillStyle=Q,X.fillRect(Ci-Se/2,Ai-Math.round(4*ki/3),_i+ki+Se,Math.round(4*ki/3)),X.fillStyle=re,X.fillText(Gi,Ci+Math.round(ki/2)-Se/2,Ai-Math.round(ki/2))}}if(void 0!==K.codes&&K.codes.length>0){null===me&&(me={}),ge=me.font||"25px Arial";for(var Ni=0;Ni<K.codes.length;Ni++){var Oi=K.codes[Ni],cn=Oi.bounding_box,Di=cn[0],ji=cn[1],Zi=cn[2],bn=cn[3];"mask_augmented_refined"===this.modelName&&(Zi-=Di,bn-=ji),X.lineWidth=Se,X.strokeStyle=Q,X.strokeRect(Di,ji,Zi,bn),X.font=ge;var qi=parseInt(ge,10),dn=Oi.code,_n=X.measureText(dn).width;X.fillStyle=Q,X.fillRect(Di-Se/2,ji-Math.round(4*qi/3),_n+qi+Se,Math.round(4*qi/3)),X.fillStyle=re,X.fillText(dn,Di+Math.round(qi/2)-Se/2,ji-Math.round(qi/2))}}}},{key:"activateObjectDetection",value:function(){if(this.objectDetectionActivated)return this.processedMediaStream;var K=document.createElement("video");K.srcObject=this.mediaStream;var X=document.createElement("canvas"),me=X.getContext("2d");X.width=this.canvasWidth,X.height=this.canvasHeight;var Q=document.createElement("canvas"),re=Q.getContext("2d");Q.width=this.canvasWidth,Q.height=this.canvasHeight;var ye=this;function Se(){me.drawImage(K,0,0,X.width,X.height);var ge=me.getImageData(0,0,X.width,X.height);re.putImageData(ge,0,0),ye.drawAnnotationsBool&&ye.drawAnnotations(ye.lastAnnotations,re,ye.drawingConfig),requestAnimationFrame(Se)}return K.addEventListener("loadeddata",function(){K.play(),requestAnimationFrame(Se)}),this.processedMediaStream=Q.captureStream(),this.objectDetectionActivated=!0,this.processedMediaStream}},{key:"loadModel",value:function(){var K=this;return new Promise(function(X,me){ke.debug("loading model"),K.sendMessage({modelName:K.modelName,maxBoxes:K.maxBoxes,scoreThresh:K.scoreThresh,forceReload:K.forceReload},"AIELoadModel",X,me)})}},{key:"sendMessage",value:function(K,X,me,Q){var re=setTimeout(Q,5e3);this.promises.push({timeout:re,resolve:me}),K.timeout=re,this.sendMessageToCCS(K,X)}},{key:"sendMessageToCCS",value:function(K,X){if(K.userMediaStreamId=this.userMediaStreamId,K.clientId=this.clientId,K.data={pubSub:"AieConnector"},K.type=X,void 0!==apiCC){var me=apiCC.session.apiCCWebRTCClient.webRTCClient.socket;try{var Q=JSON.stringify(K);me.emit(X,Q)}catch(re){ke.error("JSON Stringify error : ",re)}}}},{key:"modelLoaded",value:function(K){ke.debug("Loaded model name :",K.modelName),this.aieUrl=K.url,this.loadedModel=K.modelName,this.token=K.token;var X=this.activateObjectDetection();this.promises.forEach(function(me){K.timeout===me.timeout&&(clearTimeout(me.timeout),me.resolve(X))})}},{key:"release",value:function(){this.isReleased=!0,this.stopLogs(),this.stopSnapshots(),this.stopAnnotations(),this.sendMessageToCCS({},"AIELogout")}}],oe&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(P.prototype,oe),P}();function gt(P){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(P)}function at(P,x){return(at=Object.setPrototypeOf||function(oe,K){return oe.__proto__=K,oe})(P,x)}function Ze(P,x){if(x&&("object"===gt(x)||"function"==typeof x))return x;if(void 0!==x)throw new TypeError("Derived constructors may only return object or undefined");return function(oe){if(void 0===oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return oe}(P)}function ie(P){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)})(P)}var bt=i.Y.get("MediaFilterAIE"),Rt=function(P){!function(re,ye){if("function"!=typeof ye&&null!==ye)throw new TypeError("Super expression must either be null or a function");re.prototype=Object.create(ye&&ye.prototype,{constructor:{value:re,writable:!0,configurable:!0}}),ye&&at(re,ye)}(Q,P);var oe,K,X,me=(K=Q,X=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(re){return!1}}(),function(){var re,ye=ie(K);if(X){var Se=ie(this).constructor;re=Reflect.construct(ye,arguments,Se)}else re=ye.apply(this,arguments);return Ze(this,re)});function Q(){var re;return function(ye,Se){if(!(ye instanceof Se))throw new TypeError("Cannot call a class as a function")}(this,Q),(re=me.call(this)).userMediaStreamId=null,re.streamAIE=null,re}return(oe=[{key:"applyFilter",value:function(re,ye){var Se=this;return new Promise(function(ge,Pe){if(bt.debug("Apply filter with descriptor :",ye),void 0===ye.options&&Pe("Filter options object required"),void 0===ye.options.modelName)Pe("modelName options required");else{var xe=re.getAudioTracks();xe.length>0&&xe.forEach(function(We){re.removeTrack(We)}),Se.streamAIE=new we(re,ye.options),Se.streamAIE.loadModel().then(function(We){xe.forEach(function(rt){We.addTrack(rt)}),ge(We)}).catch(function(We){Pe(We)})}})}},{key:"release",value:function(){this.streamAIE.release()}}])&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(Q.prototype,oe),Q}(w);function Ct(P){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(P)}function wt(P,x){return(wt=Object.setPrototypeOf||function(oe,K){return oe.__proto__=K,oe})(P,x)}function Be(P,x){if(x&&("object"===Ct(x)||"function"==typeof x))return x;if(void 0!==x)throw new TypeError("Derived constructors may only return object or undefined");return function(oe){if(void 0===oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return oe}(P)}function Lt(P){return(Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)})(P)}var jt=i.Y.get("MediaFilterBackgroundSubstraction"),Ge=function(P){!function(re,ye){if("function"!=typeof ye&&null!==ye)throw new TypeError("Super expression must either be null or a function");re.prototype=Object.create(ye&&ye.prototype,{constructor:{value:re,writable:!0,configurable:!0}}),ye&&wt(re,ye)}(Q,P);var oe,K,X,me=(K=Q,X=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(re){return!1}}(),function(){var re,ye=Lt(K);if(X){var Se=Lt(this).constructor;re=Reflect.construct(ye,arguments,Se)}else re=ye.apply(this,arguments);return Be(this,re)});function Q(){var re;return function(ye,Se){if(!(ye instanceof Se))throw new TypeError("Cannot call a class as a function")}(this,Q),(re=me.call(this)).mediaStream=null,re.mediaStreamSettings=null,re.processedMediaStream=null,re.net=null,re.lossRatio=null,re.processBackground=!1,re.bgImageData=null,re.videoElement=document.createElement("video"),re.canvas=document.createElement("canvas"),re.canvasContext=re.canvas.getContext("2d"),re}return(oe=[{key:"applyFilter",value:function(re,ye){var Se=this;return new Promise(function(ge,Pe){var xe=re.getAudioTracks();xe.length>0&&xe.forEach(function(We){re.removeTrack(We)}),Se.loadTensorflow().then(function(){Se.loadTensorflowModel().then(function(){Se.videoElement.srcObject=re;var We=Se;Se.videoElement.addEventListener("loadeddata",function(){We.videoElement.play(),We.mediaStream=re,We.descriptors=ye,We.processedMediaStream=We.canvas.captureStream(),We.mediaStreamSettings=We.mediaStream.getVideoTracks()[0].getSettings(),We.videoElement.height=240,We.lossRatio=We.mediaStreamSettings.height/We.videoElement.height,We.videoElement.width=We.videoElement.height*We.mediaStreamSettings.aspectRatio,We.videoElement.onplaying=function(){We.canvas.height=We.videoElement.videoHeight,We.canvas.width=We.videoElement.videoWidth},We.loadBodyPix().then(function(){xe.forEach(function(rt){We.processedMediaStream.addTrack(rt)}),ge(We.processedMediaStream)}).catch(function(rt){jt.error(rt)})})}).catch(function(We){jt.error(We)})}).catch(function(We){jt.error(We)})})}},{key:"loadTensorflow",value:function(){return jt.debug("Tensorflow script loading..."),new Promise(function(re,ye){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"],"tensorflow",{async:!0,numRetries:20,reqdelay:200,success:function(){jt.debug("Tensorflow script loaded"),re()},error:function(ge){ye("Resources loading failed, depsNotFound: "+ge)},retrycb:function(ge,Pe){jt.warn("Tensorflow loading retry :"+ge+" ,delay before retry :"+Pe)}})})}},{key:"loadTensorflowModel",value:function(){return jt.debug("Tensorflow model script loading..."),new Promise(function(re,ye){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"],"tensorflow-model",{async:!0,numRetries:20,reqdelay:200,success:function(){jt.debug("Tensorflow model script loaded"),re()},error:function(ge){ye("Resources loading failed, depsNotFound: "+ge)},retrycb:function(ge,Pe){jt.warn("Tensorflow model loading retry :"+ge+" ,delay before retry :"+Pe)}})})}},{key:"loadBodyPix",value:function(){var re=this;return new Promise(function(ye,Se){bodyPix.load({multiplier:.75,stride:32,quantBytes:4}).then(function(ge){re.net=ge,re.perform(),ye()}).catch(function(ge){return Se(ge)})})}},{key:"perform",value:function(){if(void 0!==this.descriptors.options&&void 0!==this.descriptors.options.backgroundMode)switch(this.processBackground=!0,this.descriptors.options.backgroundMode){case"blur":jt.warn("This method is deprecated, please use Stream#blur method now."),this.videoElement.height=this.mediaStreamSettings.height,this.videoElement.width=this.mediaStreamSettings.width,this.canvas.height=this.videoElement.height,this.canvas.width=this.videoElement.width,this.blurBackground();break;case"transparent":this.noBackground();break;case"image":void 0!==this.descriptors.options.image?(this.resizeImageData(this.descriptors.options.image),this.imageBackground()):jt.error("image option is required when creating the filter");break;default:jt.debug("The backgroundMode : ",this.descriptors.options.backgroundMode," is not implemented. Refer to documentation for accepted values."),this.blurBackground()}else jt.error("backgroundMode option is required")}},{key:"blurBackground",value:function(){var re=this;this.net.segmentPerson(this.videoElement).then(function(ye){re.blurBackground(),bodyPix.drawBokehEffect(re.canvas,re.videoElement,ye,9,2,!1)})}},{key:"noBackground",value:function(){var re=this;this.net.segmentPerson(this.videoElement).then(function(ye){re.canvasContext.drawImage(re.videoElement,0,0,re.videoElement.width,re.videoElement.height);for(var Se=re.canvasContext.getImageData(0,0,re.videoElement.width,re.videoElement.height),ge=Se.data,Pe=0;Pe<ge.length;Pe+=4)0===ye.data[Pe/4]&&(ge[Pe+3]=0);var xe=re.scaleImageData(Se,re.lossRatio);re.canvasContext.imageSmoothingEnabled=!0,re.canvasContext.putImageData(xe,0,0),re.processBackground&&re.noBackground()})}},{key:"imageBackground",value:function(){var re=this;this.net.segmentPerson(this.videoElement).then(function(ye){re.canvasContext.putImageData(re.bgImageData,0,0,0,0,re.videoElement.width,re.videoElement.height);var Se=re.canvasContext.getImageData(0,0,re.videoElement.width,re.videoElement.height);re.canvasContext.drawImage(re.videoElement,0,0,re.videoElement.width,re.videoElement.height);for(var ge=re.canvasContext.getImageData(0,0,re.videoElement.width,re.videoElement.height),Pe=ge.data,xe=0;xe<Pe.length;xe+=4)0===ye.data[xe/4]&&(Pe[xe]=Se.data[xe],Pe[xe+1]=Se.data[xe+1],Pe[xe+2]=Se.data[xe+2],Pe[xe+3]=Se.data[xe+3]);var We=re.scaleImageData(ge,re.lossRatio);re.canvasContext.imageSmoothingEnabled=!0,re.canvasContext.putImageData(We,0,0),re.processBackground&&re.imageBackground()})}},{key:"resizeImageData",value:function(re){var ye=this.videoElement.width/re.width,Se=this.videoElement.height/re.height;this.bgImageData=this.scaleImageData(re,ye>=Se?ye:Se)}},{key:"noBackgroundWithFullResolution",value:function(){var re=this;this.net.segmentPerson(this.videoElement).then(function(ye){re.canvasContext.drawImage(re.videoElement,0,0,re.canvas.width,re.canvas.height);for(var Se=re.canvasContext.getImageData(0,0,re.canvas.width,re.canvas.height),ge=new Uint8ClampedArray(4*ye.width*ye.height),Pe=0;Pe<ge.length;Pe+=4)0!==ye.data[Pe/4]&&(ge[Pe+3]=255);var xe=new ImageData(ge,ye.width,ye.height);xe=re.scaleImageData(xe,re.lossRatio);for(var We=0;We<Se.data.length;We+=4)0===xe.data[We+3]&&(Se.data[We+3]=0);re.canvasContext.imageSmoothingEnabled=!0,re.canvasContext.putImageData(Se,0,0),re.processBackground&&re.noBackgroundWithFullResolution()})}},{key:"scaleImageData",value:function(re,ye){var Se=document.createElement("canvas");Se.width=re.width,Se.height=re.height,Se.getContext("2d").putImageData(re,0,0);var ge=document.createElement("canvas");ge.width=this.canvas.width,ge.height=this.canvas.height;var Pe=ge.getContext("2d");return Pe.scale(ye,ye),Pe.drawImage(Se,0,0),Pe.getImageData(0,0,ge.width,ge.height)}},{key:"release",value:function(){this.processedMediaStream=this.mediaStream,this.processBackground=!1}}])&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(Q.prototype,oe),Q}(w),z=i.Y.get("MediaFilterManager"),M=apiCC.myWebRTC_Event,t={oldBackgroundSubtraction:ne,AIEFilter:Rt,backgroundSubtraction:Ge},u=function(){function P(K,X,me){(function(Q,re){if(!(Q instanceof re))throw new TypeError("Cannot call a class as a function")})(this,P),this.mediaStream=K,this.descriptors=X,this.userMediaStreamId=me,this.filters={}}var oe;return(oe=[{key:"getOrCreateFilter",value:function(K){if(void 0!==this.filters[K.type])return this.filters[K.type];var X=t[K.type];if(void 0===X)return z.error("Unknown filter type: "+K.type),null;var me=new X;return this.filters[me]=me,me}},{key:"applyFilters",value:function(){var K=this;if(z.info("Apply filters",this.descriptors),!Array.isArray(this.descriptors)||0===this.descriptors.length)return z.error("No filter can be applied, filter descriptors have wrong format, it should be an array and contain at least one element",this.descriptors),Promise.reject(this.mediaStream);var X=Promise.resolve(this.mediaStream);return this.descriptors.forEach(function(me){var Q=K.getOrCreateFilter(me);null!==Q?(void 0!==me.options&&(me.options.userMediaStreamId=K.userMediaStreamId,me.options.clientId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId),X=X.then(function(re){return Q.applyFilter(re,me)})):z.error("Filter "+me.type+" will be skipped. No implemented filter has this type")}),z.info("Filters attached"),document.addEventListener("visibilitychange",function(){K.createBackgroundSubstractionStopVisibilityChangeEvent(K.userMediaStreamId)}),X.catch(function(me){return z.error(me)}),X}},{key:"createBackgroundSubstractionStopVisibilityChangeEvent",value:function(K){document.hidden&&M.createBackgroundSubstractionStopVisibilityChangeEvent(K)}},{key:"release",value:function(){Object.values(this.filters).forEach(function(K){K.release()}),document.removeEventListener("visibilitychange",this.createBackgroundSubstractionStopVisibilityChangeEvent),this.filters=null,this.mediaStream=null}}])&&function(P,x){for(var oe=0;oe<x.length;oe++){var K=x[oe];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(P,K.key,K)}}(P.prototype,oe),P}();function h(P){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(P)}var y=i.Y.get("ApiCCUserMediaStream"),a=apiCC.myWebRTC_Event,m="getUserMediaAccessAllowed",_=function(){this.userMediaStreamId=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),this.gum_config="Edge"===c.Xh&&c.PR>=15?{audio:!0,video:!0}:"Chrome"===c.Xh&&c.PR<49||"Firefox"===c.Xh&&c.PR<50?{audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}}:{audio:{},video:{}},this.inputs={},this.callbacks={},this.callType=null,this.audio=!1,this.audioDeviceLabel=null,this.audioMuted=!1,this.video=!1,this.videoDeviceLabel=null,this.videoMuted=!1,this.stream=null,this.streamStolen=!1,this.notifyUserMediaSuccess=!0,this.notifyUserMediaStop=!0,this.tryAudioCallAfterUserMediaError=null!==apiCC.session&&void 0!==apiCC.session&&apiCC.session.tryAudioCallAfterUserMediaError,this.callInfoList=[],this.iOSMediaSelectionWorkAroundApplied=!1,this.getUserMediaTimeoutId=null,this.displayMediaStreamConstraints="chrome"===d.wL.type&&d.wL.version>=72&&d.wL.version<=73?{video:!0,audio:!1}:{video:!0,audio:!0},this.forceExtensionOnChrome=!1,this.filters=null,this.mediaFilterManager=null,this.videoSettings=!1,this.getVideoTrack=function(){if(!this.stream||"function"!=typeof this.stream.getVideoTracks)return null;var P=this.stream.getVideoTracks();return P&&1===P.length?P[0]:null},this.release=function(){var P=0,x=null,oe=null,K=null;if(y.debug("[ApiCCUserMediaStream] release; userMediaStreamId: "+this.userMediaStreamId),null!==this.mediaFilterManager&&(this.mediaFilterManager.release(),this.mediaFilterManager=null),null!==this.stream){if(this.sourceNode&&this.sourceNode.disconnect(),this.javascriptNode&&(this.javascriptNode.analyser&&this.javascriptNode.analyser.disconnect(),this.javascriptNode.disconnect()),!0!==this.streamStolen)if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)void 0!==cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc&&(y.debug("[ApiCCUserMediaStream] release on iosrtc cordova"),this.stream.onended=null);else if("Chrome"===c.Xh&&c.PR<45||"Firefox"===c.Xh&&c.PR<44||"Opera"===c.Xh&&c.PR<34||"Chromium"===c.Xh&&c.PR<44||"Chrome WebView"===c.Xh&&c.PR<45)this.stream.onended=null,this.stream.stop();else for(this.stream.onended=null,P=(x=this.stream.getTracks()).length;--P>=0;)x[P].onended=null,x[P].stop();this.stream=null,this.streamStolen=!1,!0===this.notifyUserMediaStop&&(null!==(K=this.getOwnerCallInfo())&&(oe=K.callId),a.createUserMediaStopEvent(oe,this.callType,this.userMediaStreamId)),this.callbacks.release(this)}},this.getUserMedia=function(){var P=this;if(y.debug("[ApiCCUserMediaStream] getUserMedia; userMediaStreamId: "+this.userMediaStreamId),null===this.stream)try{if("media"===this.callType)this.gum_config=apiCC.setAudioSourceIdInConstraint(this.inputs.audioSourceId,this.gum_config),this.gum_config=apiCC.setVideoSourceIdInConstraint(this.inputs.videoSourceId,this.gum_config),this.gum_config=apiCC.setVideoFacingModeInConstraint(this.inputs.facingMode,this.gum_config);else if("audio"===this.callType)this.gum_config=apiCC.setAudioSourceIdInConstraint(this.inputs.audioSourceId,this.gum_config),this.gum_config.video=!1;else{if("videoOnly"!==this.callType)return function(x){for(var oe=apiCC.userMediaStreamTable.length;--oe>=0;)if(apiCC.userMediaStreamTable[oe].userMediaStreamId===x){apiCC.userMediaStreamTable.splice(oe,1);break}}(this.userMediaStreamId),void setTimeout(this.callbacks.failure.bind(this,this,"wrong type"));this.gum_config.audio=!1,this.gum_config=apiCC.setVideoSourceIdInConstraint(this.inputs.videoSourceId,this.gum_config),this.gum_config=apiCC.setVideoFacingModeInConstraint(this.inputs.facingMode,this.gum_config)}apiCC.checkConstraintDependingOnDevice(this.gum_config),"IE"===c.Xh&&c.dc>8?apiCC.getUserMediaWithCB(this.gum_config,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):("Chrome"===c.Xh&&!0===this.isUserMediaAccessAllowed()&&(this.getUserMediaTimeoutId=setTimeout(function(){P.onUserMediaError("timeout")},1e4)),apiCC.getUserMedia(this.gum_config).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError")))}catch(x){y.error("getUserMedia() failed. Is this a WebRTC capable browser?"),y.log("getUserMedia failed with exception: "+x.message)}},this.onUserMediaSuccess=function(P){var x=this;this.applyFiltersIfNeeded(P).then(function(oe){var K=null,X=null,me=!1,Q=x.getOwnerCallInfo(),re=x.getCall(Q);y.info("[ApiCCUserMediaStream] onUserMediaSuccess; userMediaStreamId: "+x.userMediaStreamId),null!==x.getUserMediaTimeoutId&&(clearTimeout(x.getUserMediaTimeoutId),x.getUserMediaTimeoutId=null),re&&(y.debug("call exist"),X=re.callee?re.callerId:re.calleeId,me=re.restarted),"screenSharing"!==x.callType&&"screenSharingWithAudio"!==x.callType||(oe.onended=x.callback(x,"stopScreenSharing"),oe.getVideoTracks().length>0&&(oe.getVideoTracks()[0].onended=x.callback(x,"stopScreenSharing"))),x.updateMediaProperties(oe),x.stream=oe,"Chrome"===c.Xh&&x.setUserMediaAccessAllowed(!0),!0===x.notifyUserMediaSuccess&&(Q&&(K=Q.callId),a.createUserMediaSuccessEvent(null!==K,x.audio,x.audioDeviceLabel,x.video,x.videoDeviceLabel,x.callType,K,oe,X,me,x.userMediaStreamId)),y.debug("Starting a new getMediaDevices after userMediaSuccess"),apiCC.mediaDeviceMgr.getMediaDevices("updatedAfterGetUserMediaSuccess"),x.callbacks.success(x)})},this.updateMediaProperties=function(P){var x=!1,oe="Unknown",K="Unknown",X=!1,me="Unknown";P.getAudioTracks().length>0&&(x=!0,P.getAudioTracks()[0].label&&(oe=P.getAudioTracks()[0].label,K=P.getAudioTracks()[0].id,this.listenToAudio2(P))),P.getVideoTracks().length>0&&(X=!0,P.getVideoTracks()[0].label&&(me=P.getVideoTracks()[0].label)),this.audio=x,this.audioDeviceLabel=oe,this.audioDeviceId=K,this.video=X,this.videoDeviceLabel=me},this.listenToAudio=function(P){y.debug("listenToAudio()");for(var x=apiCC.getAudioContext(),oe=this,K=!1,X=[],me=0;me<10;me++)X.push(0);null!=x?(this.javascriptNode=x.createScriptProcessor(2048,1,1),this.sourceNode=x.createMediaStreamSource(P),!0===apiCC.activeSpeakerDetect&&(y.debug("activespeakerDetecting"),this.javascriptNode.connect(x.destination),this.javascriptNode.onaudioprocess=function(){var Q,re,ye,Se=new Uint8Array(this.analyser.frequencyBinCount),ge=0;for(this.analyser.getByteFrequencyData(Se),re=0;re<Se.length;re++)ge+=Se[re];var Pe=0;if((ye={amplitude:ge/Se.length,active:P.active}).amplitude>apiCC.activeSpeakerThreshold&&!K){for(Q=X.length-3;Q<X.length;Q++)Pe+=X[Q];Pe>=2&&(K=!0,oe.notifyActiveSpeaker(ye.amplitude))}else if(ye.amplitude<apiCC.activeSpeakerThreshold&&K){for(Q=X.length-3;Q<X.length;Q++)Pe+=X[Q];0===Pe&&(K=!1,oe.notifyNotActiveSpeaker(ye.amplitude))}X.push(0+(ye.amplitude>apiCC.activeSpeakerThreshold))},this.javascriptNode.analyser=x.createAnalyser(),this.javascriptNode.analyser.smoothingTimeConstant=.3,this.javascriptNode.analyser.fftSize=1024,this.sourceNode.connect(this.javascriptNode.analyser),this.javascriptNode.analyser.connect(this.javascriptNode))):y.debug("listenToAudioSources() - Unable to create audio context")},this.listenToAudio2=function(P){y.debug("listenToAudio2()");var x=apiCC.getAudioContext(),oe=this,K=null,X=!1;null!=x?(this.javascriptNode=x.createScriptProcessor(2048,1,1),this.sourceNode=x.createMediaStreamSource(P),!0===apiCC.activeSpeakerDetect&&(y.debug("activeSpeakerDetecting"),this.javascriptNode.connect(x.destination),this.javascriptNode.onaudioprocess=function(){var me,Q,re=new Uint8Array(this.analyser.frequencyBinCount),ye=0;for(this.analyser.getByteFrequencyData(re),re.sort(function(Se,ge){return ge-Se}),re=re.slice(0,50),Q=0;Q<re.length;Q++)ye+=re[Q];(me=ye/re.length)>apiCC.activeSpeakerThreshold&&(X||(X=!0,oe.notifyActiveSpeaker(me)),null!==K&&clearTimeout(K),K=setTimeout(function(){oe.notifyNotActiveSpeaker(me),X=!1},1e3))},this.javascriptNode.analyser=x.createAnalyser(),this.javascriptNode.analyser.smoothingTimeConstant=.5,this.javascriptNode.analyser.fftSize=1024,this.sourceNode.connect(this.javascriptNode.analyser),this.javascriptNode.analyser.connect(this.javascriptNode))):y.debug("listenToAudioSources() - Unable to create audio context")},this.manageFailure=function(P){var x={};"object"===h(P)?(x.message=P.message,x.code=P.code,x.name=P.name):x=P,this.callbacks.failure(this,x)},this.onUserMediaError=function(P){var x=function(me){for(var Q=apiCC.userMediaStreamTable.length;--Q>=0;)if(apiCC.userMediaStreamTable[Q].userMediaStreamId===me){apiCC.userMediaStreamTable.splice(Q,1);break}},oe=null,K=this.getOwnerCallInfo();if(y.info("[ApiCCUserMediaStream] onUserMediaError; userMediaStreamId: "+this.userMediaStreamId+", error: "+P),null!==this.getUserMediaTimeoutId&&("timeout"!==P&&clearTimeout(this.getUserMediaTimeoutId),this.getUserMediaTimeoutId=null),"electron"!==c.$6&&"Chrome"===c.Xh&&c.PR>47&&"https:"!==window.location.protocol&&y.error("HTTPS is now mandatory to use getUserMedia()"),null!==K&&(oe=K.callId),"media"===this.callType&&"iOS"===c.ag.name&&"Mobile Safari"===c.Xh&&!1===this.iOSMediaSelectionWorkAroundApplied||a.createUserMediaErrorEvent(null!==oe,this.callType,P,this.userMediaStreamId,oe,this.tryAudioCallAfterUserMediaError,this.gum_config),"timeout"!==P&&"media"===this.callType)if("iOS"===c.ag.name&&"Mobile Safari"===c.Xh&&!1===this.iOSMediaSelectionWorkAroundApplied){y.warn("try mediaDevice selection workaround on iOS / Mobile Safari - after MediaError"),this.iOSMediaSelectionWorkAroundApplied=!0,this.gum_config.video={};var X=apiCC.getMediaDeviceLabelFromDeviceid(this.inputs.videoSourceId);y.log("getMediaDeviceLabelFromDeviceid :",X),"Cam\xe9ra arri\xe8re"===X||"Back Camera"===X?(y.log("Setting FacingMode to environment :",X),this.gum_config=apiCC.setVideoFacingModeInConstraint("environment",this.gum_config)):(y.log("Setting FacingMode to user :",X),this.gum_config=apiCC.setVideoFacingModeInConstraint("user",this.gum_config)),this.inputs.videoSourceId=null,this.getUserMedia()}else!0===this.tryAudioCallAfterUserMediaError?(y.warn("try AudioCall after UserMediaError is activated"),this.tryAudioCallAfterUserMediaError=!1,!1!==this.gum_config.video?(y.debug("[ApiCCUserMediaStream] Trying to getUserMedia with audioOnly"),this.inputs.videoSourceId=null,this.gum_config.video=!1,this.getUserMedia()):(x(this.userMediaStreamId),this.manageFailure(P))):(x(this.userMediaStreamId),this.manageFailure(P));else x(this.userMediaStreamId),this.manageFailure(P)},this.getDisplayMediaProcess=function(){var P=this;y.debug("using getDisplayMedia with browser :",c.Xh),y.debug("displayMediaStreamConstraints :",this.displayMediaStreamConstraints),"object"===h(this.displayMediaStreamConstraints)&&!0!==Array.isArray(this.displayMediaStreamConstraints)||(y.warn("Defined displayMediaStreamConstraints format is not correct, reinitialization ..."),this.displayMediaStreamConstraints="chrome"===d.wL.type&&d.wL.version>=72&&d.wL.version<=73?{video:!0,audio:!1}:{video:!0,audio:!0},y.debug("displayMediaStreamConstraints :",this.displayMediaStreamConstraints)),navigator.getDisplayMedia?(y.debug("navigator.getDisplayMedia defined"),navigator.getDisplayMedia(this.displayMediaStreamConstraints).then(function(x){y.debug("getDisplayMedia stream available"),P.onUserMediaSuccess(x)}).catch(function(x){y.debug("getDisplayMedia error :",x),P.onUserMediaError(x)})):navigator.mediaDevices.getDisplayMedia?(y.debug("navigator.mediaDevices.getDisplayMedia defined"),navigator.mediaDevices.getDisplayMedia(this.displayMediaStreamConstraints).then(function(x){y.debug("getDisplayMedia stream available"),P.onUserMediaSuccess(x)}).catch(function(x){y.debug("getDisplayMedia error :",x),P.onUserMediaError(x)})):(y.debug("getDisplayMedia not available"),a.createDesktopCaptureEvent("Browser_Not_Compatible"))},this.getScreenMedia=function(){if(y.debug("[ApiCCUserMediaStream] getScreenMedia; userMediaStreamId: "+this.userMediaStreamId),null===this.stream)if("Chrome"===c.Xh||"Firefox"===c.Xh&&c.PR>=52)if("Chrome"===c.Xh)if(y.log("shareScreen on Chrome"),c.PR>=72&&!1===this.forceExtensionOnChrome)this.getDisplayMediaProcess();else{if(y.debug("this.captureSourceType :",this.captureSourceType),!1===apiCC.apiRTCExtensionInstalled)return apiCC.waitingShareScreenUserMediaStreamId=this.userMediaStreamId,function(P){y.debug("[ApiCCUserMediaStream] moveUserMediaEntryInWaitingScreen: "+P);for(var x=apiCC.userMediaStreamTable.length;--x>=0;)if(apiCC.userMediaStreamTable[x].userMediaStreamId===P){apiCC.waitingShareScreenUserMediaStream=apiCC.userMediaStreamTable.splice(x,1);break}}(this.userMediaStreamId),void apiCC.manageNotInstalledExtension("getScreenMedia","getScreenMedia",this.captureSourceType);null!=this.captureSourceType||(this.captureSourceType=["screen","window","tab"]),!1===Array.isArray(this.captureSourceType)&&(y.warn("Defined captureSourceType format is not correct, reinitialization ..."),this.captureSourceType=["screen","window","tab"],y.debug("this.captureSourceType :",this.captureSourceType)),window.postMessage({command:"getDesktopId",callNumber:this.userMediaStreamId,remoteId:"getScreenMedia",captureSourceType:this.captureSourceType,browser_major_version:c.PR},"*")}else y.log("shareScreen on Firefox"),c.PR>=67?this.getDisplayMediaProcess():(null!=this.captureSourceType||(this.captureSourceType="screen"),"string"==typeof this.captureSourceType&&(y.warn("Defined captureSourceType format is not correct, reinitialization ..."),this.captureSourceType="screen",y.debug("this.captureSourceType :",this.captureSourceType)),this.registerScreenMedia(this.captureSourceType));else this.getDisplayMediaProcess()},this.registerScreenMedia=function(P,x){var oe=null,K=this.getOwnerCallInfo(),X=this.getCall(K),me=null;if(y.debug("[ApiCCUserMediaStream] registerScreenMedia; userMediaStreamId: "+this.userMediaStreamId),"mediaError"===x)null!==X?(me=!0===X.callee?X.callerId:X.calleeId,"screenSharing"===X.callType||"screenSharingWithAudio"===X.callType?apiCC.session.apiCCWebRTCClient.webRTCClient.removeCallFromTableWithCallIdandRemoteId(X.callId,me,"Media_Error"):y.log("switch video / screen : call is not removed"),"https:"!==window.location.protocol&&y.log("Please connect to your web page using 'HTTPS'. This is mandatory for desktop capture"),a.createDesktopCaptureEvent("UserMediaError",X.callId,me)):(y.log("Call not found on message EventListener"),a.createDesktopCaptureEvent("UserMediaError")),function(Q){for(var re=apiCC.userMediaStreamTable.length;--re>=0;)if(apiCC.userMediaStreamTable[re].userMediaStreamId===Q){apiCC.userMediaStreamTable.splice(re,1);break}}(this.userMediaStreamId),this.callbacks.failure(this,"UserMediaError");else try{if("Chrome"===c.Xh)y.log("desktopId: "+x),oe={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:x}}};else{if(y.log("captureSourceType: "+P),"screen"!==P&&"window"!==P&&"application"!==P)return void y.error("captureSourceType value is not correct");oe={video:{mediaSource:P}}}"IE"===c.Xh&&c.dc>8?apiCC.getUserMediaWithCB(oe,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):apiCC.getUserMedia(oe).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError"))}catch(Q){y.error("getUserMedia() failed. Is this a WebRTC capable browser?"),y.log("getUserMedia failed with exception: "+Q.message)}},this.stopScreenSharing=function(){y.debug("[ApiCCUserMediaStream] stopScreenSharing; userMediaStreamId: "+this.userMediaStreamId);var P=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var x=this.callInfoList.length;--x>=0;)!0===this.callInfoList[x].owner&&(P=!1),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(this.callInfoList[x].callId);!0===P&&this.release()},this.getCall=function(P){var x=null;return P&&apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient&&("call"===P.flavor?x=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(P.callId):"userMedia"===P.flavor&&(x=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(P.callId))),x},this.getOwnerCallInfo=function(){for(var P=this.callInfoList.length;--P>=0;)if(!0===this.callInfoList[P].owner)return this.callInfoList[P];return null},this.getCallInfo=function(P){for(var x=this.callInfoList.length;--x>=0;)if(this.callInfoList[x].callId===P)return this.callInfoList[x];return null},this.containsCallInfo=function(P){for(var x=!1,oe=this.callInfoList.length;--oe>=0;)if(this.callInfoList[oe].callId===P){x=!0;break}return x},this.addCallInfo=function(P,x,oe){return null!==P&&"string"==typeof P&&("call"!==x&&"userMedia"!==x&&(x="call"),null!==oe&&"boolean"==typeof oe||(oe=!1),!this.containsCallInfo(P))&&(this.callInfoList.push({callId:P,flavor:x,owner:oe}),!0)},this.removeCallInfo=function(P){for(var x=!1,oe=this.callInfoList.length;--oe>=0;)if(this.callInfoList[oe].callId===P){this.callInfoList.splice(oe,1),x=!0;break}return x},this.accessToLocalMedia=function(){return"screenSharing"!==this.callType&&"screenSharingWithAudio"!==this.callType&&"data"!==this.callType&&null!==this.stream},this.muteAudioOnStreams=function(){return y.debug("[ApiCCUserMediaStream] muteAudioOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getAudioTracks().forEach(function(P){P.enabled=!1}),this.audioMuted=!0,this.notifyMLineMuted("audio",!0),{type:"audio",muted:!0}},this.unMuteAudioOnStreams=function(){return y.debug("[ApiCCUserMediaStream] unMuteAudioOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getAudioTracks().forEach(function(P){P.enabled=!0}),this.audioMuted=!1,this.notifyMLineMuted("audio",!1),{type:"audio",muted:!1}},this.muteVideoOnStreams=function(){return y.debug("[ApiCCUserMediaStream] muteVideoOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getVideoTracks().forEach(function(P){P.enabled=!1}),this.videoMuted=!0,this.notifyMLineMuted("video",!0),{type:"video",muted:!0}},this.unMuteVideoOnStreams=function(){return y.debug("[ApiCCUserMediaStream] unMuteVideoOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getVideoTracks().forEach(function(P){P.enabled=!0}),this.videoMuted=!1,this.notifyMLineMuted("video",!1),{type:"video",muted:!1}},this.removeVideoTrackOnStreams=function(){var P;return y.debug("[ApiCCUserMediaStream] removeVideoTrackOnStreams; userMediaStreamId: "+this.userMediaStreamId),(P=this.stream.getVideoTracks()).length>0&&this.stream.removeTrack(P[0]),this.video=!1,{type:"video",present:!1}},this.notifyMLineMuted=function(P,x){var oe,K,X=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var me=this.callInfoList.length;--me>=0;)"call"===this.callInfoList[me].flavor?(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[me].callId),this.notifyMLineMutedCall(P,x,oe,null)):"userMedia"===this.callInfoList[me].flavor&&(K=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[me].callId),this.notifyMLineMutedCall(P,x,null,K)),!0===this.callInfoList[me].owner&&(X=!1);!0===X&&this.notifyMLineMutedCall(P,x,null,null)},this.notifyMLineMutedCall=function(P,x,oe,K){y.debug("notifyMLineMutedCall; mline: "+P+", muted: "+x);var X=[P+"IsMuted"],me={available:this.audio,deviceLabel:this.audioDeviceLabel,active:!0,muted:this.audioMuted},Q={available:this.video,deviceLabel:this.videoDeviceLabel,active:!0,muted:this.videoMuted},re=null;oe?("audio"===P?oe.isLocalAudioMuted=x:"video"===P&&(oe.isLocalVideoMuted=x),oe.belongsToRoom()?(re={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:oe.callId,roomId:oe.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,mline:P,muted:x},oe.data.mesh&&(re.mesh=oe.data.mesh),oe.myWebRTC_Stack.sendInfo("streamTrackChanged",re)):(re={type:"streamTrackChanged",callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:oe.callee?oe.callerId:oe.calleeId,callId:oe.callId,mline:P,muted:x},oe.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,re)),me.active=oe.localCallProfile.audioActive,Q.active=oe.localCallProfile.videoActive,a.createLocalStreamUpdatedEvent(X,me,Q,!0,oe.callType,oe.callId,this.stream,this.userMediaStreamId,"userAction")):K?(re={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:K.userMediaId,roomId:K.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,mline:P,muted:x},K.myWebRTC_Stack.sendInfo("streamTrackChanged",re),"inactive"===K.audioSdpDirection&&(me.active=!1),"inactive"===K.videoSdpDirection&&(Q.active=!1),a.createLocalStreamUpdatedEvent(X,me,Q,!0,K.callType,K.userMediaId,this.stream,this.userMediaStreamId,"userAction")):a.createLocalStreamUpdatedEvent(X,me,Q,!1,null,null,this.stream,this.userMediaStreamId,"userAction")},this.notifyActiveSpeaker=function(P){var x,oe,K=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var X=this.callInfoList.length;--X>=0;)"call"===this.callInfoList[X].flavor?(x=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[X].callId),this.notifyActiveSpeakerCall(P,x,null)):"userMedia"===this.callInfoList[X].flavor&&(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[X].callId),this.notifyActiveSpeakerCall(P,null,oe)),!0===this.callInfoList[X].owner&&(K=!1);!0===K&&this.notifyActiveSpeakerCall(P,null,null)},this.notifyActiveSpeakerCall=function(P,x,oe){var K=null;x?(x.belongsToRoom()?(K={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:x.callId,roomId:x.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},x.data.mesh&&(K.mesh=x.data.mesh),x.myWebRTC_Stack.sendInfo("activeSpeaker",K)):(K={type:"activeSpeaker",callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:x.callee?x.callerId:x.calleeId,callId:x.callId,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},x.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,K)),a.createAudioAmplitudeEvent(P,!0,x.callId,this.userMediaStreamId)):oe?(K={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:oe.userMediaId,roomId:oe.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},oe.myWebRTC_Stack.sendInfo("activeSpeaker",K),a.createAudioAmplitudeEvent(P,!0,oe.userMediaId,this.userMediaStreamId)):a.createAudioAmplitudeEvent(P,!0,null,this.userMediaStreamId)},this.notifyNotActiveSpeaker=function(P){var x,oe,K=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var X=this.callInfoList.length;--X>=0;)"call"===this.callInfoList[X].flavor?(x=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[X].callId),this.notifyNotActiveSpeakerCall(P,x,null)):"userMedia"===this.callInfoList[X].flavor&&(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[X].callId),this.notifyNotActiveSpeakerCall(P,null,oe)),!0===this.callInfoList[X].owner&&(K=!1);!0===K&&this.notifyNotActiveSpeakerCall(P,null,null)},this.notifyNotActiveSpeakerCall=function(P,x,oe){var K=null;x?(x.belongsToRoom()?(K={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:x.callId,roomId:x.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},x.data.mesh&&(K.mesh=x.data.mesh),x.myWebRTC_Stack.sendInfo("stopSpeaking",K)):(K={type:"stopSpeaking",callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:x.callee?x.callerId:x.calleeId,callId:x.callId,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},x.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,K)),a.createAudioAmplitudeEvent(P,!1,x.callId,this.userMediaStreamId)):oe?(K={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:oe.userMediaId,roomId:oe.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:P,streamID:this.userMediaStreamId}},oe.myWebRTC_Stack.sendInfo("stopSpeaking",K),a.createAudioAmplitudeEvent(P,!1,oe.userMediaId,this.userMediaStreamId)):a.createAudioAmplitudeEvent(P,!1,null,this.userMediaStreamId)},this.callback=function(P,x){return this.closureHandler=function(oe,K){return P[x](oe,K)},this.closureHandler},this.isUserMediaAccessAllowed=function(){return null!==localStorage&&"object"===("undefined"==typeof localStorage?"undefined":h(localStorage))&&"function"==typeof localStorage.getItem?"true"===localStorage.getItem(m):null},this.setUserMediaAccessAllowed=function(P){return null!==localStorage&&"object"===("undefined"==typeof localStorage?"undefined":h(localStorage))&&"function"==typeof localStorage.setItem?(localStorage.setItem(m,P?"true":"false"),!!P):null},this.applyFiltersIfNeeded=function(P){return null===this.filters?Promise.resolve(P):(this.mediaFilterManager=new u(P,this.filters,this.userMediaStreamId),this.mediaFilterManager.applyFilters())},this.getVideoSettings=function(){if(!1!==this.videoSettings)return this.videoSettings;var P=this.getVideoTrack();if(!P||"function"!=typeof P.getSettings)return this.videoSettings=null,this.videoSettings;var x=P.getSettings();return x?(this.videoSettings={},Object.prototype.hasOwnProperty.call(x,"width")&&(this.videoSettings.width=x.width),Object.prototype.hasOwnProperty.call(x,"height")&&(this.videoSettings.height=x.height),Object.prototype.hasOwnProperty.call(x,"frameRate")&&(this.videoSettings.frameRate=x.frameRate),this.videoSettings):(this.videoSettings=null,this.videoSettings)},this.isSimulcastCompliant=function(){return!!this.getVideoSettings()},this.getSimulcastProfile=function(){var P=this.getVideoSettings();if(!P)return null;var x={substream:{high:{active:!0,selectable:!0},medium:{active:!0,selectable:!0},low:{active:!0,selectable:!0}},temporal:{high:{active:!0,selectable:!0},medium:{active:!0,selectable:!0},low:{active:!0,selectable:!0}}};return"chrome"===d.wL.type&&((P.width<1280||P.height<720)&&(x.substream.low.selectable=!1),x.temporal.high.active=!1,x.temporal.high.selectable=!1),x}}},5882:(F,Y,e)=>{"use strict";e.d(Y,{D:()=>Pt}),e(3710),e(1539),e(9714),e(2772),e(8674);var i=e(1549),c=(e(4916),e(5306),e(2564),e(4812),e(561),e(5735),e(3753),e(4603),e(6755),e(9554),e(4747),e(6992),e(8783),e(3948),e(4765),e(9601),e(8309),e(8264),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(7042),e(7941),e(2526),e(1817),e(2165),e(5945)),d=e(4708),L=e(940);function w(z){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(z)}function A(){this.sdp={original:null,global:[],mlines:[]},this.mlines=[]}function C(z){var M=new A,t=z.split("\r\n"),u=0,h=null,y=null,a=null,m=null;for(M.sdp.original=z;u<t.length;)if(0!==(h=t[u]).length)if(null!==a)if(h.match(/^m=/))y=null,a=null;else if(h.match(/^a=/)){if(y.push(h),!(m=h.match(/^a=([\w-]+):(\d+) (.+)$/))||"rtpmap"!==m[1]&&"rtcp-fb"!==m[1]&&"fmtp"!==m[1]){if(m=h.match(/^a=mid:(\w+)$/))a.mid=m[1];else if("a=sendrecv"===h)a.direction="sendrecv";else if("a=recvonly"===h)a.direction="recvonly";else if("a=sendonly"===h)a.direction="sendonly";else if("a=inactive"===h)a.direction="inactive";else if(m=h.match(/^a=ssrc-group:SIM (.+)$/)){var _=m[1].split(" ");a.ssrc_groups.sim.push(_.slice())}else if(m=h.match(/^a=ssrc-group:FID (.+)$/)){var P=m[1].split(" ");a.ssrc_groups.fid.push(P.slice())}else if(m=h.match(/^a=ssrc:(\d+) (.+)$/)){var x=a.ssrcs.find(function(ye){return ye.original===m[1]});x||a.ssrcs.push(x={original:m[1],ssrc:m[1],content:{}});var oe=m[2].match(/^(\w+):(.+)$/);if(!oe)throw new Error("cannot parse ssrc parameters (regex failure): "+m[2]);if("cname"===oe[1])x.content.cname=oe[2];else if("msid"===oe[1])x.content.msid=oe[2];else if("mslabel"===oe[1])x.content.mslabel=oe[2];else{if("label"!==oe[1])throw new Error("cannot parse ssrc parameters (wrong attribute): "+oe[1]);x.content.label=oe[2]}}}else if("rtpmap"===m[1])a.codecs[m[2]].codec=m[3].split("/")[0].toLowerCase(),a.codecs[m[2]].rtpmap=m[3];else if("rtcp-fb"===m[1])a.codecs[m[2]]["rtcp-fb"]||(a.codecs[m[2]]["rtcp-fb"]=[]),a.codecs[m[2]]["rtcp-fb"].push(m[3]);else if("fmtp"===m[1]){a.codecs[m[2]].fmtp=[];for(var K=m[3].split(";"),X=0;X<K.length;X+=1){var me=K[X].split("=");2===me.length&&a.codecs[m[2]].fmtp.push(me)}}u+=1}else if(h.match(/^b=/)){if(y.push(h),m=h.match(/^b=AS:(\d+)$/)){a.bandwidth=parseInt(m[1],10),u+=1;continue}u+=1}else y.push(h),u+=1;else{if(m=h.match(/^m=([a-z]+) (\d+) ([A-Z/]+) ([0-9 ]+)$/)){M.sdp.mlines.push(y=[]),y.push(h),a={type:m[1],port:parseInt(m[2],10),proto:m[3],payload_types:[],direction:"sendrecv",mid:m[1],bandwidth:0,codecs:{},ssrc_groups:{sim:[],fid:[]},ssrcs:[]};for(var Q=m[4].split(" "),re=0;re<Q.length;re+=1)a.payload_types.push(Q[re]),a.codecs[Q[re]]={};M.mlines.push(a),u+=1;continue}M.sdp.global.push(h),u+=1}else u+=1;for(M.unifiedPlan=!0,u=M.mlines.length;--u>=0;)"audio"!==M.mlines[u].type||M.audio?"video"!==M.mlines[u].type||M.video||(M.video=M.mlines[u]):M.audio=M.mlines[u],!0===M.unifiedPlan&&M.mlines[u].mid!==String(u)&&(M.unifiedPlan=!1);return M.isAudioActive=S.bind(null,M,"audio"),M.isVideoActive=S.bind(null,M,"video"),M}function S(z,M){return!("audio"!==M&&"video"!==M||null===z||"object"!==w(z)||!Object.prototype.hasOwnProperty.call(z,M)||null===z[M]||"object"!==w(z[M])||"sendrecv"!==z[M].direction&&"sendonly"!==z[M].direction&&"recvonly"!==z[M].direction)}e(3123),e(4723),e(9600),e(1058),e(9826),A.prototype.mungeForSimulcasting=function(){if(!0!==this.simulcasting){this.simulcasting=!0;for(var z=0;z<this.mlines.length;z+=1){var M=this.mlines[z];if("video"===M.type){var t=M.ssrcs[0].content.cname,u=M.ssrcs[0].content.msid,h=M.ssrcs[0].content.mslabel,y=M.ssrcs[0].content.label,a=[];a.push(M.ssrcs[0].ssrc);for(var m=2;--m>=0;){var _=Math.floor(4294967295*Math.random());M.ssrcs.push({original:_,ssrc:_,content:{cname:t,msid:u,mslabel:h,label:y}});var P=Math.floor(4294967295*Math.random());M.ssrcs.push({original:P,ssrc:P,content:{cname:t,msid:u,mslabel:h,label:y}}),M.ssrc_groups.fid.push([_,P]),a.push(_)}M.ssrc_groups.sim.push(a)}}}},A.prototype.generate=function(){for(var z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=[],t=0;t<this.sdp.global.length;t+=1){var u=this.sdp.global[t],h=u.match(/^a=group:BUNDLE([\w ]+)$/);if(h){M.push("a=group:BUNDLE");for(var y=0;y<this.mlines.length;y+=1)"inactive"===this.mlines[y].direction&&!0===z.stripInactiveMLines||(M.push(" "),M.push(this.mlines[y].mid));M.push("\r\n")}else M.push(u),M.push("\r\n")}for(var a=0;a<this.sdp.mlines.length;a+=1){var m=this.mlines[a];if("inactive"!==m.direction||!0!==z.stripInactiveMLines)for(var _=!1,P=this.sdp.mlines[a],x=0;x<P.length;x+=1){var oe=P[x];if(oe.match(/^m=/))M.push("m="),M.push(m.type),M.push(" "),M.push(m.port),M.push(" "),M.push(m.proto),M.push(" "),M.push(m.payload_types.join(" ")),M.push("\r\n");else if(oe.match(/^a=/)){var K=oe.match(/^a=([\w-]+):(\d+) (.+)$/);if(K&&("rtpmap"===K[1]||"rtcp-fb"===K[1]||"fmtp"===K[1])){if("rtpmap"===K[1]){var X=K[2];if(m.codecs[X]){M.push("a=rtpmap:"),M.push(X),M.push(" "),M.push(m.codecs[X].rtpmap),M.push("\r\n");var me=m.codecs[X]["rtcp-fb"];if(me)for(var Q=0;Q<me.length;Q+=1)M.push("a=rtcp-fb:"),M.push(X),M.push(" "),M.push(me[Q]),M.push("\r\n");var re=m.codecs[X].fmtp;if(re){for(var ye=[],Se=0;Se<re.length;Se+=1)ye.push(re[Se].join("="));ye.length>0&&(M.push("a=fmtp:"),M.push(X),M.push(" "),M.push(ye.join(";")),M.push("\r\n"))}continue}continue}if("rtcp-fb"===K[1]||"fmtp"===K[1])continue;throw new Error("internal error")}if(oe.match(/^a=mid:(\w+)$/))M.push("a=mid:"),M.push(m.mid),M.push("\r\n"),m.bandwidth>0&&(M.push("b=AS:"),M.push(m.bandwidth),M.push("\r\n"),M.push("b=TIAS:"),M.push(m.bandwidth),M.push("000"),M.push("\r\n"));else if("a=sendrecv"!==oe&&"a=recvonly"!==oe&&"a=sendonly"!==oe&&"a=inactive"!==oe){if(!oe.match(/^a=ssrc-group:SIM (.+)$/)&&!oe.match(/^a=ssrc-group:FID (.+)$/)){if(oe.match(/^a=ssrc:(\d+) (.+)$/)){if(_)continue;_=!0;for(var ge=0;ge<m.ssrc_groups.sim.length;ge+=1)M.push("a=ssrc-group:SIM "),M.push(m.ssrc_groups.sim[ge].join(" ")),M.push("\r\n");for(var Pe=0;Pe<m.ssrc_groups.fid.length;Pe+=1)M.push("a=ssrc-group:FID "),M.push(m.ssrc_groups.fid[Pe].join(" ")),M.push("\r\n");for(var xe=function(rt){var Et=m.ssrcs[rt];["cname","msid","mslabel","label"].forEach(function(Qe){Object.prototype.hasOwnProperty.call(Et.content,Qe)&&(M.push("a=ssrc:"),M.push(Et.ssrc),M.push(" "),M.push(Qe),M.push(":"),M.push(Et.content[Qe]),M.push("\r\n"))})},We=0;We<m.ssrcs.length;We+=1)xe(We);continue}M.push(oe),M.push("\r\n");continue}}else M.push("a="),M.push(m.direction),M.push("\r\n")}else{if(oe.match(/^b=/))continue;M.push(oe),M.push("\r\n")}}}return M.join("")};var n=i.Y.get("SDPManager"),v=function(){n.debug("SDPManager"),this.getSDPLines=function(z){n.debug("SDPManager::getSDPLines");var M,t=z.split("\r\n");for(M=0;M<t.length;M+=1)n.log("sdpLines[i] : "+t[M]);return t},this.getAudioMediaDescriptionPart=function(z){n.debug("SDPManager::getAudioMediaDescriptionPart");var M=z.split("m=audio"),t=null;return null!=M[1]?(t=M[1].split("m=video"),n.log("SDP audio part : "+t[0]),t[0]):null},this.getVideoMediaDescriptionPart=function(z){n.debug("SDPManager::getVideoMediaDescriptionPart");var M,t=z.split("m=video");for(M=0;M<t.length;M+=1)n.log("sdpMediaPart[i] : "+t[M]);return t[1]},this.searchMediaDescriptionForRecvOnly=function(z){return n.debug("searchMediaDescriptionForRecvOnly"),-1!==z.search("a=recvonly")?(n.log("recvonly found in media description"),!0):(n.log("recvonly not found in media description"),!1)},this.searchSDPForRecvOnly=function(z){return void 0!==z?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForRecvOnly(z)):(n.log("recvonly not found in SDP"),!1)},this.searchMediaDescriptionForSendOnly=function(z){return n.debug("searchMediaDescriptionForSendOnly"),-1!==z.search("a=sendonly")?(n.log("sendonly found in media description"),!0):(n.log("sendonly not found in media description"),!1)},this.searchSDPForSendOnly=function(z){return void 0!==z?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForSendOnly(z)):(n.log("sendonly not found in SDP"),!1)},this.searchMediaDescriptionForInactive=function(z){return n.debug("searchMediaDescriptionForInactive"),-1!==z.search("a=inactive")?(n.log("inactive found in media description"),!0):(n.log("inactive not found in media description"),!1)},this.searchSDPForInactive=function(z){return void 0!==z?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForInactive(z)):(n.log("inactive not found in SDP"),!1)},this.stripAudioMediaDescriptionFromSDP=function(z){n.debug("SDPManager::stripAudioMediaDescriptionFromSDP");var M=this.createGuideline(z);return M.audio?(M.audio.direction="inactive",M.generate({stripInactiveMLines:!0})):z},this.stripVideoMediaDescriptionFromSDP=function(z){n.debug("SDPManager::stripVideoMediaDescriptionFromSDP");var M=this.createGuideline(z);return M.video?(M.video.direction="inactive",M.generate({stripInactiveMLines:!0})):z},this.setAudioBandwidth=function(z,M){return n.info("SDPManager::setAudioBandwidth",M),M?z=z.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+M+"\r\n"):(n.warn("No maxAudioBW !"),z)},this.setVideoBandwidth=function(z,M){if(n.info("SDPManager::setVideoBandwidth",M),!M)return n.warn("No maxVideoBW !"),z;for(var t=[],u=z.split("\r\n"),h=0,y=null,a=null;h<u.length;)if(0!==(y=u[h]).length)if(null!==a)y.match(/^m=/)?a=null:y.match(/^a=mid:(\w+)$/)?(t.push(y),t.push("\r\n"),t.push("b=AS:"),t.push(M),t.push("\r\n"),t.push("b=TIAS:"),t.push(M),t.push("000"),t.push("\r\n"),h+=1):(y.match(/^b=([A-Z]+):(\w+)$/)||(t.push(y),t.push("\r\n")),h+=1);else{var m=y.match(/^m=([a-z]+)(.+)$/);if(m&&"video"===m[1]){a="video",t.push(y),t.push("\r\n"),h+=1;continue}t.push(y),t.push("\r\n"),h+=1}else h+=1;return t.join("")},this.setDataBandwidth=function(z,M){return n.info("SDPManager::setDataBandwidth",M),M?z=z.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+M+"\r\n"):(n.warn("No maxDataBW !"),z)},this.setSendOnlyForAudio=function(z){n.debug("SDPManager::setSendOnlyForAudio");var M=this.createGuideline(z);return(0,d.ki)(M,"audio","object")&&(M.audio.direction="sendonly"),M.generate()},this.setSendOnlyForVideo=function(z){n.debug("SDPManager::setSendOnlyForVideo");var M=this.createGuideline(z);return(0,d.ki)(M,"video","object")&&(M.video.direction="sendonly"),M.generate()},this.setSendOnly=function(z){n.debug("SDPManager::setSendOnly : global");var M=this.createGuideline(z);return(0,d.ki)(M,"audio","object")&&(M.audio.direction="sendonly"),(0,d.ki)(M,"video","object")&&(M.video.direction="sendonly"),M.generate()},this.setRecvOnlyForAudio=function(z){n.debug("SDPManager::setRecvOnlyForAudio");var M=this.createGuideline(z);return M.audio&&"inactive"!==M.audio.direction&&(M.audio.direction="recvonly"),M.generate()},this.setRecvOnlyForVideo=function(z){n.debug("SDPManager::setRecvOnlyForVideo");var M=this.createGuideline(z);return M.video&&"inactive"!==M.video.direction&&(M.video.direction="recvonly"),M.generate()},this.setRecvOnly=function(z){n.debug("SDPManager::setRecvOnly : global");var M=this.createGuideline(z);return M.audio&&"inactive"!==M.audio.direction&&(M.audio.direction="recvonly"),M.video&&"inactive"!==M.video.direction&&(M.video.direction="recvonly"),M.generate()},this.updateSDPcodecs=function(z,M,t,u){var h,y,a,m,_,P,x,oe,K=!1,X=new RegExp("\r\n$"),me=!1,Q=null,re="",ye="",ge="",Pe="",xe="",We="";if(n.log("updateSDPcodecs():\n\tsdpType = "+M+"\n\tmediaType = "+t+"\n\tavailableCodecSet = "+u+"\n"),""==u)return z;for(a=(a=RTCSessionDescription&&z instanceof RTCSessionDescription?z.sdp:window.SessionDescription&&z instanceof SessionDescription?z.toSdp():z).split("\r\nm="),!1===X.test(a[a.length-2])&&(a[a.length-2]=a[a.length-2]+"\r\n",me=!0),h=0;h<a.length;h++)if(0===a[h].indexOf(t)){for(Q=a[h].split("\r\n")[0].split(" "),y=3;y<Q.length;y++)if(m=!0,!1===isNaN(Q[y])){switch(-1!==(_=a[h].indexOf(ye="a=rtpmap:"+Q[y]+" "))&&(P=a[h].indexOf("\r\n",_)),Q[y]){case 0:re="PCMU/8000";break;case 8:re="PCMA/8000";break;case 9:re="G722/8000";break;case 13:re="CN/8000";break;case 18:re="G729/8000";break;default:-1!==_&&(re=a[h].substring(_+ye.length,P))}""!=re&&-1!==u.indexOf(re)?n.log("PT("+Q[y]+"): "+re+" FOUND in availableCodecSet.\n"):(m=!1,n.log("PT("+Q[y]+"): "+re+" NOT FOUND in availableCodecSet.\n")),m||(ge="a=fmtp:"+Q[y]+" .*\r\n",We="a=rtcp-fb:"+Q[y]+" .*\r\n",Pe=" "+Q[y]+" ",xe=" "+Q[y]+"\r",a[h]=a[h].replace(new RegExp(ye+".*\r\n","g"),""),a[h]=a[h].replace(new RegExp(ge,"g"),""),a[h]=a[h].replace(new RegExp(We,"g"),""),(oe=(x=a[h].split("\n"))[0].split("RTP"))[1]=oe[1].replace(Pe," "),oe[1]=oe[1].replace(xe,"\r"),x[0]=oe.join("RTP"),a[h]=x.join("\n"),"video"===t&&(We="a=rtcp-fb:"+Q[y]+" .*\r\n",a[h]=a[h].replace(new RegExp(We,"g"),""),""!=re&&"rtx/"===re.substr(0,4)&&(a[h]=a[h].replace(new RegExp("a=ssrc-group:FID .*\r\n","g"),""),(x=a[h].split("\r\na=")).splice(x.length-8,4),a[h]=x.join("\r\na="))),K=!0)}break}return me&&(a[a.length-2]=a[a.length-2].substr(0,a[a.length-2].length-2)),a=a.join("\r\nm="),!0===K?(n.log("updateSDPcodecs(), SDP has been updated."),RTCSessionDescription&&z instanceof RTCSessionDescription?new RTCSessionDescription({type:M,sdp:a}):window.SessionDescription&&z instanceof SessionDescription?new SessionDescription(a):a):(n.log("updateSDPcodecs(), SDP has not been updated."),z)},this.preferOpus=function(z){var M,t=z.split("\r\n"),u=0,h=null;for(M=0;M<t.length;M+=1)if(-1!==t[M].search("m=audio")){u=M;break}if(0===u)return z;for(M=0;M<t.length;M+=1)if(-1!==t[M].search("opus/48000")){(h=this.extractSdp(t[M],/:(\d+) opus\/48000/i))&&(t[u]=this.setDefaultCodec(t[u],h));break}return(t=this.removeCN(t,u)).join("\r\n")},this.removeCN=function(z,M){var t=0,u=z[M].split(" "),h=null,y=0;for(t=z.length-1;t>=0;t--)(h=this.extractSdp(z[t],/a=rtpmap:(\d+) CN\/\d+/i))&&(-1!==(y=u.indexOf(h))&&u.splice(y,1),z.splice(t,1));return z[M]=u.join(" "),z},this.extractSdp=function(z,M){var t=z.match(M);return t&&2==t.length?t[1]:null},this.setDefaultCodec=function(z,M){var t=0,u=z.split(" "),h=u.slice(0,3);for(h.push(M),t=3;t<u.length;t++)u[t]!==M&&h.push(u[t]);return h.join(" ")},this.findLineInRange=function(z,M,t,u,h){var y,a=-1!==t?t:z.length;for(y=M;y<a;++y)if(0===z[y].indexOf(u)&&(!h||-1!==z[y].toLowerCase().indexOf(h.toLowerCase())))return y;return null},this.findLine=function(z,M,t){return this.findLineInRange(z,0,-1,M,t)},this.getCodecPayloadType=function(z,M){var t=this.findLine(z,"a=rtpmap",M);return t?this.getCodecPayloadTypeFromLine(z[t]):null},this.getCodecPayloadTypeFromLine=function(z){var M=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=z.match(M);return t&&2===t.length?t[1]:null},this.findFmtpLine=function(z,M){var t=this.getCodecPayloadType(z,M);return t?this.findLine(z,"a=fmtp:"+t.toString()):null},this.writeFmtpLine=function(z){if(!z.hasOwnProperty("pt")||!z.hasOwnProperty("params"))return null;var M=z.pt,t=z.params,u=[],h=0,y=null;for(y in t)u[h]=y+"="+t[y],++h;return 0===h?null:"a=fmtp:"+M.toString()+" "+u.join("; ")},this.setCodecParam=function(z,M,t,u){var h=z.split("\r\n"),y=this.findFmtpLine(h,M),a={},m=null,_=null;if(null===y){if(null===(_=this.findLine(h,"a=rtpmap",M)))return z;m=this.getCodecPayloadTypeFromLine(h[_]),a.pt=m.toString(),a.params={},a.params[t]=u,h.splice(_+1,0,this.writeFmtpLine(a))}else(a=function(P){var x,oe={},K=P.indexOf(" "),X=P.substring(K+1).split("; "),me=new RegExp("a=fmtp:(\\d+)"),Q=P.match(me),re={},ye=null;if(!Q||2!==Q.length)return null;for(oe.pt=Q[1],x=0;x<X.length;++x)2===(ye=X[x].split("=")).length&&(re[ye[0]]=ye[1]);return oe.params=re,oe}(h[y])).params[t]=u,h[y]=this.writeFmtpLine(a);return h.join("\r\n")},this.maybePreferCodec=function(z,M,t){var u,h,y=M+" codec",a=null;return t?(n.log("Prefer "+y+": "+t),a=z.split("\r\n"),null===(u=this.findLine(a,"m=",M))?(n.log("mLineIndex === null"),z):((h=this.getCodecPayloadType(a,t))&&(a[u]=this.setDefaultCodec(a[u],h)),z=a.join("\r\n"))):(n.log("No preference on "+y+"."),z)},this.createGuideline=C},R=(e(9753),e(1038),e(1249),e(7327),e(3843),function(z,M,t,u,h,y,a,m){this.rawStats={},this.rawStats.connectedPair=[],this.rawStats.audio_send=[],this.rawStats.audio_recv=[],this.rawStats.video_send=[],this.rawStats.video_recv=[],this.instantRTT=0,this.moyRttCP=[0,0,0,0,0,0,0,0,0,0],this.moyRttAS=[0,0,0,0,0,0,0,0,0,0],this.moyRttVS=[0,0,0,0,0,0,0,0,0,0],this.tauxPacketLossAS=[0],this.oldLostAS=this.oldSentAS=0,this.oldLostVS=this.oldLostVS=0,this.cptTaux=0,this.tauxPacketLossVS=[0],this.oldBandwidthAS=0,this.oldBandwidthVS=0,this.oldBandwidthAR=0,this.oldBandwidthVR=0,this.bandwidthAS=[0,0,0,0,0,0,0,0,0,0],this.bandwidthAR=[0,0,0,0,0,0,0,0,0,0],this.bandwidthVS=[0,0,0,0,0,0,0,0,0,0],this.bandwidthVR=[0,0,0,0,0,0,0,0,0,0],this.qosIn=0,this.qosInAverage=0,this.qosInAverageCount=0,this.qosAudioIn=0,this.qosAudioInAverage=0,this.qosAudioInAverageCount=0,this.qosVideoIn=0,this.qosVideoInAverage=0,this.qosVideoInAverageCount=0,this.qosOut=0,this.qosOutAverage=0,this.qosOutAverageCount=0,this.qosAudioOut=0,this.qosAudioOutAverage=0,this.qosAudioOutAverageCount=0,this.qosVideoOut=0,this.qosVideoOutAverage=0,this.qosVideoOutAverageCount=0,this.onQosChange=M,this.onQosAudioChange=t,this.onQosVideoChange=u,this.cpt=0,this.cptRes=5,this.cptDb=60,this.saveStatsFlag=!0,this.tabQosIn=[],this.tabQosAudioIn=[],this.tabQosVideoIn=[],this.tabQosOut=[],this.tabQosAudioOut=[],this.tabQosVideoOut=[],this.tabTimestamp=[],this.tabDelay=[],this.tabJitterBufferAudio=[],this.tabJitterBufferVideo=[],this.tabAudioRtt=[],this.tabVideoRtt=[],this.tabAudioBW=[],this.tabVideoBW=[],this.clientId=a,this.callId=h,this.apiKey=y,this.socket=m,this.interval=z,this.insertStats=function(_,P,x,oe){var K,X,me,Q=null;for(this.cpt=this.cpt+this.interval,K=0;K<_.length;++K){var re=_[K];switch(re.type){case"googCandidatePair":for(Q=re.names(),me=0;me<Q.length;++me)if("googActiveConnection"==Q[me]&&"true"==re.stat(Q[me]))for(X=0;X<Q.length;++X)"bytesSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.connectedPair.bytesSent=re.stat(Q[X])),"bytesReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.connectedPair.bytesReceived=re.stat(Q[X])),"googRtt"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.connectedPair.googRtt=re.stat(Q[X]));break;case"ssrc":for(Q=re.names(),me=0;me<Q.length;++me){if("audioOutputLevel"==Q[me])for(X=0;X<Q.length;++X)"packetsLost"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.packetsLost=re.stat(Q[X])),"googDecodingPLC"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.googDecodingPLC=re.stat(Q[X])),"googJitterReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.googJitterReceived=re.stat(Q[X])),"googJitterBufferMs"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.googJitterBufferMs=re.stat(Q[X])),"googCurrentDelayMs"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.googCurrentDelayMs=re.stat(Q[X])),"bytesReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_recv.bytesReceived=re.stat(Q[X]));if("audioInputLevel"==Q[me])for(X=0;X<Q.length;++X)"googRtt"==Q[X]&&void 0!==re.stat(Q[X])&&-1!=re.stat(Q[X])&&(this.rawStats.audio_send.googRtt=re.stat(Q[X])),"packetsLost"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_send.packetsLost=re.stat(Q[X])),"packetsSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_send.packetsSent=re.stat(Q[X])),"bytesSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_send.bytesSent=re.stat(Q[X])),"googJitterReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.audio_send.googJitterReceived=re.stat(Q[X]));if("googFrameHeightReceived"==Q[me])for(X=0;X<Q.length;++X)"googFrameHeightReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.FrameHeight=re.stat(Q[X])),"googFrameWidthReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.FrameWidth=re.stat(Q[X])),"googCurrentDelayMs"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.delay=re.stat(Q[X])),"packetsLost"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.packetsLost=re.stat(Q[X])),"googNacksSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.googNacksSent=re.stat(Q[X])),"googJitterBufferMs"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.googJitterBufferMs=re.stat(Q[X])),"bytesReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.bytesReceived=re.stat(Q[X])),"googFrameRateReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_recv.googFrameRateReceived=re.stat(Q[X]));if("googFrameHeightSent"==Q[me])for(X=0;X<Q.length;++X)"googFrameHeightSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.FrameHeight=re.stat(Q[X])),"googFrameWidthSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.FrameWidth=re.stat(Q[X])),"packetsLost"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.packetsLost=re.stat(Q[X])),"googNacksReceived"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.googNacksReceived=re.stat(Q[X])),"googRtt"==Q[X]&&void 0!==re.stat(Q[X])&&-1!=re.stat(Q[X])&&(this.rawStats.video_send.googRtt=re.stat(Q[X])),"packetsSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.packetsSent=re.stat(Q[X])),"bytesSent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.bytesSent=re.stat(Q[X])),"googEncodeUsagePercent"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.googEncodeUsagePercent=re.stat(Q[X])),"googCpuLimitedResolution"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.googCpuLimitedResolution=re.stat(Q[X])),"googBandwidthLimitedResolution"==Q[X]&&void 0!==re.stat(Q[X])&&(this.rawStats.video_send.googBandwidthLimitedResolution=re.stat(Q[X]))}}}this.computeStats(P,x,oe),this.cpt%this.cptRes==0&&this.saveStatsLocal(),this.cpt%this.cptDb==0&&this.saveStatsToDb(!1)},this.saveStatsLocal=function(){if(this.saveStatsFlag){var _=Date.now();this.tabTimestamp.push(_),this.tabQosIn.push(this.qosIn),this.tabQosAudioIn.push(this.qosAudioIn),0!==this.qosVideoIn&&this.tabQosVideoIn.push(this.qosVideoIn),this.tabQosOut.push(this.qosOut),this.tabQosAudioOut.push(this.qosAudioOut),0!==this.qosVideoOut&&this.tabQosVideoOut.push(this.qosVideoOut),this.tabJitterBufferAudio.push(this.rawStats.audio_recv.googJitterBufferMs),void 0!==this.rawStats.video_recv.googJitterBufferMs&&this.tabJitterBufferVideo.push(this.rawStats.video_recv.googJitterBufferMs),void 0!==this.rawStats.video_send.googRtt&&this.tabVideoRtt.push(this.rawStats.video_send.googRtt),this.tabAudioRtt.push(this.rawStats.audio_send.googRtt),void 0!==this.bandwidthAS&&this.tabVideoBW.push(8*this.Average(this.bandwidthAS)/1024),void 0!==this.bandwidthVS&&this.tabVideoBW.push(8*this.Average(this.bandwidthVS)/1024),void 0!==this.bandwidthAR&&this.tabVideoBW.push(8*this.Average(this.bandwidthAR)/1024),void 0!==this.bandwidthVR&&this.tabVideoBW.push(8*this.Average(this.bandwidthVR)/1024)}},this.saveStatsToDb=function(_){},this.saveStatsToDb=function(_){this.saveStatsFlag=_},this.computeStats=function(_,P,x){var oe=0;-1!==this.rawStats.connectedPair.googRtt&&0!==this.rawStats.connectedPair.googRtt&&void 0!==this.rawStats.connectedPair.googRtt&&this.add(this.rawStats.connectedPair.googRtt,this.moyRttCP),-1!==this.rawStats.video_send.googRtt&&0!==this.rawStats.video_send.googRtt&&void 0!==this.rawStats.video_send.googRtt&&(this.add(this.rawStats.video_send.googRtt,this.moyRttVS),this.instantRTT=this.rawStats.video_send.googRtt),-1!==this.rawStats.audio_send.googRtt&&0!==this.rawStats.audio_send.googRtt&&void 0!==this.rawStats.audio_send.googRtt&&this.add(this.rawStats.audio_send.googRtt,this.moyRttAS),-1!==this.rawStats.audio_send.packetsLost&&void 0!==this.rawStats.audio_send.packetsLost&&-1!==this.rawStats.audio_send.packetsSent&&0!==this.rawStats.audio_send.packetsSent&&void 0!==this.rawStats.audio_send.packetsSent&&(oe=100*(this.rawStats.audio_send.packetsLost-this.oldLostAS)/(this.rawStats.audio_send.packetsSent-this.oldSentAS),this.oldLostAS=this.rawStats.audio_send.packetsLost,this.oldSentAS=this.rawStats.audio_send.packetsSent,this.add(oe,this.tauxPacketLossAS)),-1!==this.rawStats.video_send.packetsLost&&void 0!==this.rawStats.video_send.packetsLost&&-1!==this.rawStats.video_send.packetsSent&&0!==this.rawStats.video_send.packetsSent&&void 0!==this.rawStats.video_send.packetsSent&&(oe=100*(this.rawStats.video_send.packetsLost-this.oldLostVS)/(this.rawStats.video_send.packetsSent-this.oldSentVS),this.oldLostVS=this.rawStats.video_send.packetsLost,this.oldSentVS=this.rawStats.video_send.packetsSent,this.add(oe,this.tauxPacketLossVS)),-1!==this.rawStats.audio_recv.bytesReceived&&void 0!==this.rawStats.audio_recv.bytesReceived&&(void 0===this.oldBandwidthAR&&(this.oldBandwidthAR=0),this.add((this.rawStats.audio_recv.bytesReceived-this.oldBandwidthAR)/this.interval,this.bandwidthAR),this.oldBandwidthAR=this.rawStats.audio_recv.bytesReceived),-1!==this.rawStats.video_recv.bytesReceived&&void 0!==this.rawStats.video_recv.bytesReceived&&(void 0===this.oldBandwidthVR&&(this.oldBandwidthVR=0),this.add((this.rawStats.video_recv.bytesReceived-this.oldBandwidthVR)/this.interval,this.bandwidthVR),this.oldBandwidthVR=this.rawStats.video_recv.bytesReceived),-1!==this.rawStats.audio_send.bytesSent&&void 0!==this.rawStats.audio_send.bytesSent&&(void 0===this.oldBandwidthAS&&(this.oldBandwidthAS=0),this.add((this.rawStats.audio_send.bytesSent-this.oldBandwidthAS)/this.interval,this.bandwidthAS),this.oldBandwidthAS=this.rawStats.audio_send.bytesSent),-1!==this.rawStats.video_send.bytesSent&&void 0!==this.rawStats.video_send.bytesSent&&(void 0===this.oldBandwidthVS&&(this.oldBandwidthVS=0),this.add((this.rawStats.video_send.bytesSent-this.oldBandwidthVS)/this.interval,this.bandwidthVS),this.oldBandwidthVS=this.rawStats.video_send.bytesSent);var K=0,X=0,me=0,Q=0,re=0,ye=0,Se=0,ge=0,Pe=0,xe=0,We=this.getCodecs(P),rt=8*this.Average(this.bandwidthAS)/1024;if(rt<5?K=1:rt>=5&&rt<10?K=2:rt>=10&&(K=3),null!==We&&We[1]){var Et=8*this.Average(this.bandwidthVS)/1024;Et<240?Q=1:Et>=240&&Et<330?Q=2:Et>=330&&(Q=3)}this.rawStats.audio_recv.googJitterBufferMs<60?X=3:this.rawStats.audio_recv.googJitterBufferMs>=60&&this.rawStats.audio_recv.googJitterBufferMs<100?X=2:this.rawStats.audio_recv.googJitterBufferMs>=100&&(X=1),this.rawStats.audio_recv.googCurrentDelayMs<100?me=3:this.rawStats.audio_recv.googCurrentDelayMs>=100&&this.rawStats.audio_recv.googCurrentDelayMs<200?me=2:this.rawStats.audio_recv.googCurrentDelayMs>=200&&(me=1),null!==We&&We[1]&&(this.rawStats.video_recv.googJitterBufferMs<100?re=3:this.rawStats.video_recv.googJitterBufferMs>=100&&this.rawStats.video_recv.googJitterBufferMs<200?re=2:this.rawStats.video_recv.googJitterBufferMs>=200&&(re=1));var Qe=!1,yt=!1,ct=!1;null!==We&&We[1]?(Math.ceil((K+2*Q+re+X+me)/6)!=this.qosIn&&(Qe=!0),this.qosIn=Math.ceil((K+2*Q+re+X+me)/6),this.qosInAverage=(this.qosInAverage*this.qosInAverageCount+this.qosIn)/(this.qosInAverageCount+1),this.qosInAverageCount++,Math.ceil((K+X+me)/3)!=this.qosAudioIn&&(yt=!0),this.qosAudioIn=Math.ceil((K+X+me)/3),this.qosAudioInAverage=(this.qosAudioInAverage*this.qosAudioInAverageCount+this.qosAudioIn)/(this.qosAudioInAverageCount+1),this.qosAudioInAverageCount++,Math.ceil((2*Q+re)/3)!=this.qosVideoIn&&(ct=!0),this.qosVideoIn=Math.ceil((2*Q+re)/3),this.qosVideoInAverage=(this.qosVideoInAverage*this.qosVideoInAverageCount+this.qosVideoIn)/(this.qosVideoInAverageCount+1),this.qosVideoInAverageCount++):(Math.ceil((K+X+me)/3)!=this.qosOut&&(Qe=!0),this.qosIn=Math.ceil((K+X+me)/3),this.qosInAverage=(this.qosInAverage*this.qosInAverageCount+this.qosIn)/(this.qosInAverageCount+1),this.qosInAverageCount++,Math.ceil((K+X+me)/3)!=this.qosAudioIn&&(yt=!0),this.qosAudioIn=Math.ceil((K+X+me)/3),this.qosAudioInAverage=(this.qosAudioInAverage*this.qosAudioInAverageCount+this.qosAudioIn)/(this.qosAudioInAverageCount+1),this.qosAudioInAverageCount++),this.RttAverage(this.moyRttAS)<80?Se=3:this.RttAverage(this.moyRttAS)>=80&&this.RttAverage(this.moyRttAS)<150?Se=2:this.RttAverage(this.moyRttAS)>=150&&(Se=1),this.tauxPacketLossAS<=5?ye=3:this.tauxPacketLossAS>5&&this.tauxPacketLossAS<10?ye=2:this.tauxPacketLossAS>=10&&(ye=1),this.rawStats.audio_recv.googJitterReceived<80?ge=3:this.rawStats.audio_recv.googJitterReceived>=80&&this.rawStats.audio_recv.googJitterReceived<150?ge=2:this.rawStats.audio_recv.googJitterReceived>=150&&(ge=1),null!==We&&We[1]&&(this.tauxPacketLossVS<=5?Pe=3:this.tauxPacketLossVS>5&&this.tauxPacketLossVS<10?Pe=2:this.tauxPacketLossVS>=10&&(Pe=1),this.RttAverage(this.moyRttVS)<80?xe=3:this.RttAverage(this.moyRttVS)>=80&&this.RttAverage(this.moyRttVS)<150?xe=2:this.RttAverage(this.moyRttVS)>=150&&(xe=1)),null!==We&&We[1]?(Math.ceil((Se+2*ye+ge+2*Pe+xe)/7)!=this.qosOut&&(Qe=!0),this.qosOut=Math.ceil((Se+2*ye+ge+2*Pe+xe)/7),this.qosOutAverage=(this.qosOutAverage*this.qosOutAverageCount+this.qosOut)/(this.qosOutAverageCount+1),this.qosOutAverageCount++,Math.ceil((Se+2*ye+ge)/4)!=this.qosAudioOut&&(yt=!0),this.qosAudioOut=Math.ceil((Se+2*ye+ge)/4),this.qosAudioOutAverage=(this.qosAudioOutAverage*this.qosAudioOutAverageCount+this.qosAudioOut)/(this.qosAudioOutAverageCount+1),this.qosAudioOutAverageCount++,Math.ceil((2*Pe+xe)/3)!=this.qosVideoOut&&(ct=!0),this.qosVideoOut=Math.ceil((2*Pe+xe)/3),this.qosVideoOutAverage=(this.qosVideoOutAverage*this.qosVideoOutAverageCount+this.qosVideoOut)/(this.qosVideoOutAverageCount+1),this.qosVideoOutAverageCount++):(Math.ceil((Se+2*ye+ge)/4)!=this.qosOut&&(Qe=!0),this.qosOut=Math.ceil((Se+2*ye+ge)/4),this.qosOutAverage=(this.qosOutAverage*this.qosOutAverageCount+this.qosOut)/(this.qosOutAverageCount+1),this.qosOutAverageCount++,Math.ceil((Se+2*ye+ge)/4)!=this.qosAudioOut&&(yt=!0),this.qosAudioOut=Math.ceil((Se+2*ye+ge)/4),this.qosAudioOutAverage=(this.qosAudioOutAverage*this.qosAudioOutAverageCount+this.qosAudioOut)/(this.qosAudioOutAverageCount+1),this.qosAudioOutAverageCount++),Qe&&this.onQosChange(this.qosIn,this.qosOut),yt&&this.onQosAudioChange(this.qosAudioIn,this.qosAudioOut),ct&&this.onQosVideoChange(this.qosVideoIn,this.qosVideoOut)},this.getCodecs=function(_){var P=!1,x=!1,oe=null,K=null;if(null!=_&&void 0!==_.sdp){for(var X=_.sdp.split("\n"),me=0;me<X.length;me++)-1!=X[me].indexOf("a=mid:audio")&&(P=!0),-1!=X[me].indexOf("a=mid:video")&&(x=!0),P&&-1!=X[me].indexOf("a=rtpmap:")&&(oe=X[me],P=!1),x&&-1!=X[me].indexOf("a=rtpmap:")&&(K=X[me],x=!1);return[oe,K]}return null},this.getQosScore=function(){return[this.qosIn,this.qosOut,this.qosAudioIn,this.qosAudioOut,this.qosVideoIn,this.qosVideoOut]},this.getStat=function(_){switch(_){case"AudioOutBandwidth":return 8*this.Average(this.bandwidthAS)/1024;case"VideoOutBandwidth":return 8*this.Average(this.bandwidthVS)/1024;case"AudioInBandwidth":return 8*this.Average(this.bandwidthAR)/1024;case"VideoInBandwidth":return 8*this.Average(this.bandwidthVR)/1024;case"AudioInJitterReceived":return this.rawStats.audio_recv.googJitterReceived;case"AudioInJitterBufferMs":return this.rawStats.audio_recv.googJitterBufferMs;case"AudioInDelay":return this.rawStats.audio_recv.googCurrentDelayMs;case"AudioOutLossRate":return this.tauxPacketLossAS;case"AudioOutRtt":return this.RttAverage(this.moyRttAS);case"AudioOutJitterReceived":return this.rawStats.audio_send.googJitterReceived;case"VideoInJitterBufferMs":return this.rawStats.video_recv.googJitterBufferMs;case"VideoOutLossRate":return this.tauxPacketLossVS;case"VideoOutRtt":return this.RttAverage(this.moyRttVS)}},this.getAllStats=function(){for(var _={AudioRecv:{},AudioSend:{},VideoRecv:{},VideoSend:{}},P={AudioRecv:"audio_recv",VideoRecv:"video_recv",AudioSend:"audio_send",VideoSend:"video_send"},x=Object.keys(P),oe=0;oe<x.length;oe++)for(var K=Object.keys(this.rawStats[P[x[oe]]]),X=0;X<K.length;X++)_[x[oe]][K[X]]=this.rawStats[P[x[oe]]][K[X]];return _.AudioRecv.bandwidth=8*this.Average(this.bandwidthAR)/1024,_.VideoRecv.bandwidth=8*this.Average(this.bandwidthVR)/1024,_.AudioSend.bandwidth=8*this.Average(this.bandwidthAS)/1024,_.VideoSend.bandwidth=8*this.Average(this.bandwidthVS)/1024,_.AudioRecv.jitterReceived=this.rawStats.audio_recv.googJitterReceived,_.AudioRecv.jitterBufferMs=this.rawStats.audio_recv.googJitterBufferMs,_.VideoRecv.jitterBufferMs=this.rawStats.video_recv.googJitterBufferMs,_.AudioRecv.delay=this.rawStats.audio_recv.googCurrentDelayMs,_.AudioSend.rtt=this.RttAverage(this.moyRttAS),_.VideoSend.moyRtt=this.RttAverage(this.moyRttVS),_.VideoSend.rtt=this.instantRTT,_.VideoSend.FrameHeight=this.rawStats.video_send.FrameHeight,_.VideoSend.FrameWidth=this.rawStats.video_send.FrameWidth,_.AudioSend.packetLostRatio=this.tauxPacketLossAS[this.tauxPacketLossAS.length-1],_.VideoSend.packetLostRatio=this.tauxPacketLossVS[this.tauxPacketLossVS.length-1],_.VideoSend.googEncodeUsagePercent=this.rawStats.video_send.googEncodeUsagePercent,_.VideoSend.googCpuLimitedResolution=this.rawStats.video_send.googCpuLimitedResolution,_.VideoSend.googBandwidthLimitedResolution=this.rawStats.video_send.googBandwidthLimitedResolution,delete _.AudioRecv.googCurrentDelayMs,delete _.AudioRecv.googJitterReceived,delete _.AudioRecv.googJitterBufferMs,delete _.VideoRecv.googJitterBufferMs,delete _.AudioSend.googRtt,delete _.VideoSend.googRtt,_},this.displayComputedStats=function(){console.log("Audio IN JitterReceived:"+this.rawStats.audio_recv.googJitterReceived+" jitterbufferMs:"+this.rawStats.audio_recv.googJitterBufferMs+" delay:"+this.rawStats.audio_recv.googCurrentDelayMs+" bandwidth :"+8*this.Average(this.bandwidthAS)/1024+" kBits/s"),console.log("Audio OUT  lossRate:"+this.tauxPacketLossAS+" rtt:"+this.RttAverage(this.moyRttAS)+" googJitterReceived:"+this.rawStats.audio_recv.googJitterReceived),console.log("Video IN jitter buffer ms:"+this.rawStats.video_recv.googJitterBufferMs+" bandwidth:"+8*this.Average(this.bandwidthVS)/1024+" kBits/s"),console.log("Video OUT loss rate:"+this.tauxPacketLossVS+" rtt:"+this.RttAverage(this.moyRttVS))},this.RttAverage=function(_){for(var P=0,x=0,oe=0;oe<_.length;++oe)0!==_[oe]&&-1!==_[oe]&&void 0!==_[oe]&&(P+=parseInt(_[oe],10),x++);return parseInt(P/x,10)},this.Average=function(_){for(var P=0,x=0,oe=0;oe<_.length;++oe)-1!=_[oe]&&void 0!==_[oe]&&(P+=parseInt(_[oe],10),x++);return parseInt(P/x,10)},this.add=function(_,P){P.pop(),P.unshift(_)},this.displayTab=function(_){for(var P in _)console.log(P+" = "+_[P])}}),p=i.Y.get("DataChannelFileSender"),o=apiCC.myWebRTC_Event,f=1<<17,I=function(z){this.call=z,this.sendChunkNb=0,this.send=function(M,t,u){var h=12e3,y={},a=null,m={},_=!1,P={};if(p.info("DataChannelFileSender send"),p.log("data.name :"+M.name),M.file instanceof Blob?(p.log("Blob"),this.blob=M.file,this.contentType=M.file.type,this.size=M.file.size,this.originalDataType="Blob"):M.file instanceof ArrayBuffer?(p.log("ArrayBuffer"),this.blob=M.file,this.contentType="application/octet-stream",this.size=M.file.byteLength,this.originalDataType="ArrayBuffer"):M.file instanceof String||"string"==typeof M.file?(p.log("string"),this.blob=M.file,this.size=M.file.length,this.contentType="application/octet-stream",this.originalDataType="String"):(p.log("unknown type"),this.blob=M.file,this.contentType="application/octet-stream",this.size=M.file.length||M.file.byteLength||M.file.size,this.originalDataType="Unknown"),this.contentType||(this.contentType="application/octet-stream"),0===this.size)return p.log("sending done"),void 0!==u&&(p.log("onProgress"),this.transferDuration=new Date-this.startingDate,u({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,lastPacket:_,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!0})),o.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,lastPacket:_,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!0}),void o.createEvent({eventType:"onFileSended",callId:z.callId,remoteId:z.remoteId,name:M.name,uuid:M.uuid});if(t)if("open"===t.readyState){if(0===this.sendChunkNb&&p.log("first packet"),0===this.sendChunkNb){M.uuid=(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"-"),p.log("first packet",m={name:M.name,type:M.type,size:this.size,contentType:this.contentType,uuid:M.uuid}),this.fileSize=this.size,void 0!==u&&(p.log("onProgress"),this.startingDate=new Date,this.transferDuration=0,u({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,lastPacket:_,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}),o.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,lastPacket:_,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}));try{t.send(JSON.stringify(m))}catch(x){p.warn("error detected when sending on datachannel :",t),p.warn("error is :",x)}o.createEvent({eventType:"onFileSending",callId:z.callId,remoteId:z.remoteId,name:M.name,uuid:M.uuid})}else{h<this.size?(p.log("sending chunk"),y=this.blob.slice(0,h)):(p.log("sending last chunk"),y=this.blob.slice(0),_=!0),p.log("dataToSend.byteLength ="+y.byteLength),P.message="ArrayBuffer"===this.originalDataType?d.cw.encode(y):y,P.messageSize=y.byteLength,P.uuid=M.uuid,P.originalDataType=this.originalDataType,void 0!==u&&(p.log("onProgress"),this.transferDuration=new Date-this.startingDate,u({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,startingDate:this.startingDate,lastPacket:_,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}),o.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:z.callId,uuid:M.uuid,remoteId:z.remoteId,startingDate:this.startingDate,lastPacket:_,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}));try{t.send(JSON.stringify(P))}catch(x){p.warn("error detected when sending on datachannel :",t),p.warn("error is :",x)}}a=0===this.sendChunkNb?this.blob:this.blob.slice(h),!1===_?this.sendChunkNb++:this.sendChunkNb=0,M.file=a,setTimeout(function(){this.send(M,t,u)}.bind(this))}else p.log("Trying to send on a closed channel");else p.log("No data channel to send data")},this.terminateTransfer=function(){var M=this;p.debug("terminateTransfer; terminated: "+this.terminated),null!==this.channel?!0===this.useBufferedAmount&&this.channel.bufferedAmount>0&&!0!==this.canceled?setTimeout(this.terminateTransfer.bind(this)):!0!==this.terminated&&(this.terminated=!0,this.recvDataEndAckTimeoutId&&(clearTimeout(this.recvDataEndAckTimeoutId),delete this.recvDataEndAckTimeoutId),delete this.call.dcfs,p.debug("terminateTransfer; terminating"),this.call.pipelineCallId?(this.call.pipelineCall&&(delete this.call.pipelineCall.clientCall,delete this.call.pipelineCall,this.call.sendDataChannel=null),this.channel=null):setTimeout(function(){M.channel.close(),M.channel=null}),setTimeout(function(){if(!0===M.canceled)o.createEvent({eventType:"onFileSended",callId:M.call.callId,remoteId:M.call.remoteId,name:M.call.data.filename,error:"canceled"}),M.call.callbacks.failure("canceled");else if(M.call.failure)o.createEvent({eventType:"onFileSended",callId:M.call.callId,remoteId:M.call.remoteId,name:M.call.data.filename,error:M.call.failure}),M.call.callbacks.failure(M.call.failure);else{var t={eventType:"onFileSended",callId:M.call.callId,remoteId:M.call.remoteId,name:M.call.data.filename};M.call.success.data&&(t.data=M.call.success.data),o.createEvent(t),M.call.callbacks.success(M.call.success)}apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(M.call.callId)})):p.warn("No data channel to send data, leaving terminateTransfer")},this.recvDataEndAckTimeout=function(){p.error("recvDataEndAckTimeout"),this.call.failure="ackNotReceived",setTimeout(this.terminateTransfer.bind(this))},this.subsequentTransfer=function(){var M,t=!1;if(p.debug("subsequentTransfer; remByteCount: "+this.remByteCount),!0!==this.canceled)if(null!==this.channel)if(!0===this.useBufferedAmount&&this.channel.bufferedAmount>f)setTimeout(this.subsequentTransfer.bind(this));else try{for(;;){if(!(this.remByteCount>=this.chunkLength)){M=this.data.slice(this.offset,this.offset+this.remByteCount),this.channel.send(M),this.packetsSent+=1,p.debug("packetSent "+this.packetsSent+" "+this.remByteCount),this.offset+=this.remByteCount,this.remByteCount-=this.remByteCount,t=!0;break}if(M=this.data.slice(this.offset,this.offset+this.chunkLength),this.channel.send(M),this.packetsSent+=1,p.debug("packetSent "+this.packetsSent+" "+this.chunkLength),this.offset+=this.chunkLength,this.remByteCount-=this.chunkLength,this.remByteCount<=0){t=!0;break}if(!0!==this.useBufferedAmount||this.channel.bufferedAmount>f)break}!0===t?(o.createEvent({eventType:"onFileProgress",name:this.call.data.filename,sendChunkNb:this.packetsSent,fileSize:this.call.data.size,remainingSize:this.remByteCount,callId:this.call.callId,remoteId:this.call.remoteId,percentage:100}),this.call.callbacks.progress({state:"complete",filename:this.call.data.filename,size:this.call.data.size,remBytes:0,progress:100}),this.call.success={state:"complete",filename:this.call.data.filename,size:this.call.data.size,mediaURL:this.call.mediaURL,mediaId:this.call.mediaId},this.recvDataEndAckTimeoutId=setTimeout(this.recvDataEndAckTimeout.bind(this),3e4)):(o.createEvent({eventType:"onFileProgress",name:this.call.data.filename,sendChunkNb:this.packetsSent,fileSize:this.call.data.size,remainingSize:this.remByteCount,callId:this.call.callId,remoteId:this.call.remoteId,percentage:Math.floor(100*this.offset/this.call.data.size)}),this.call.callbacks.progress({state:"incomplete",filename:this.call.data.filename,size:this.call.data.size,remBytes:this.remByteCount,progress:Math.floor(100*this.offset/this.call.data.size)}),setTimeout(this.subsequentTransfer.bind(this)))}catch(u){return p.error("transfer: "+u),this.call.failure="dataChannelFailed",void setTimeout(this.terminateTransfer.bind(this))}else p.warn("No data channel to send data, leaving subsequentTransfer");else setTimeout(this.terminateTransfer.bind(this))},this.transfer=function(M,t,u){var h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},y=h.hasOwnProperty("delay")?h.delay:100;if(p.info("transfer",t,y),this.call.beginTimeoutId&&(clearTimeout(this.call.beginTimeoutId),delete this.call.beginTimeoutId),this.data=M,this.channel=u,null!==this.channel){"number"==typeof this.channel.bufferedAmount&&this.channel.bufferedAmount>=0&&(p.debug("browserDetails",d.wL),"chrome"===d.wL.type?d.wL.version>=37&&(this.useBufferedAmount=!0,p.debug("useBufferedAmount enabled")):(this.useBufferedAmount=!0,p.debug("useBufferedAmount enabled"))),this.chunkLength=8192,t>0?(this.offset=Math.floor(t/this.chunkLength)*this.chunkLength,this.remByteCount=this.data.byteLength-this.offset):(this.offset=0,this.remByteCount=this.data.byteLength),this.packetsSent=0;try{var a={chunkLength:this.chunkLength,offset:this.offset,remBytes:this.remByteCount};this.call.pipelineCallId&&(a.pluginName=z.data.pluginName,a.pluginData=z.data.pluginData,z.data.context&&(a.context=z.data.context)),this.channel.send(JSON.stringify(a))}catch(m){return p.error("transfer:",m),this.call.failure="dataChannelFailed",void setTimeout(this.terminateTransfer.bind(this))}o.createEvent({eventType:"onFileSending",callId:this.call.callId,remoteId:this.call.remoteId,name:this.call.data.filename}),setTimeout(this.subsequentTransfer.bind(this),y)}else p.warn("No data channel to send data, leaving transfer")}},l=(i.Y.get("CallStatsMonitor"),function(z,M,t,u){this.interval=z,this.browserType=M,this.browserVersion=t,this.flavor=u,this.prevData={},this.prevDataThreshold=10/z,this.prevDataThreshold<2&&(this.prevDataThreshold=2),this.STANDARD_STAT_KEYS={audioReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},videoReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteAudioSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteVideoSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},audioSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},videoSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteAudioReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteVideoReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1}},this.refineStats_chrome_proprietary=function(h,y){var a,m;for(a=0;a<y.length;a+=1){var _=y[a],P=null,x=null;if("ssrc"===_.type)if(_.id.indexOf("recv")>=0){if("audio"===_.stat("mediaType"))for(h.audioReceived={timestamp:Math.floor(Date.parse(_.timestamp))/1e3,type:"inbound-rtp",isRemote:!1,mediaType:"audio",packetsReceived:0,bytesReceived:0},P=_.names(),m=0;m<P.length;m+=1)"packetsReceived"===(x=P[m])?h.audioReceived.packetsReceived=parseInt(_.stat("packetsReceived"),10):"bytesReceived"===x&&(h.audioReceived.bytesReceived=parseInt(_.stat("bytesReceived"),10));else if("video"===_.stat("mediaType"))for(h.videoReceived={timestamp:Math.floor(Date.parse(_.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"video",framesDecoded:0,packetsReceived:0,bytesReceived:0},P=_.names(),m=0;m<P.length;m+=1)"framesDecoded"===(x=P[m])?h.videoReceived.framesDecoded=parseInt(_.stat("framesDecoded"),10):"packetsReceived"===x?h.videoReceived.packetsReceived=parseInt(_.stat("packetsReceived"),10):"bytesReceived"===x&&(h.videoReceived.bytesReceived=parseInt(_.stat("bytesReceived"),10))}else if(_.id.indexOf("send")>=0)if("audio"===_.stat("mediaType"))for(h.audioSent={timestamp:Math.floor(Date.parse(_.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"audio",packetsSent:0,bytesSent:0},P=_.names(),m=0;m<P.length;m+=1)"packetsSent"===(x=P[m])?h.audioSent.packetsSent=parseInt(_.stat("packetsSent"),10):"bytesSent"===x&&(h.audioSent.bytesSent=parseInt(_.stat("bytesSent"),10));else if("video"===_.stat("mediaType"))for(h.videoSent={timestamp:Math.floor(Date.parse(_.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"video",framesEncoded:0,packetsSent:0,bytesSent:0},P=_.names(),m=0;m<P.length;m+=1)"framesEncoded"===(x=P[m])?h.videoSent.framesEncoded=parseInt(_.stat("framesEncoded"),10):"packetsSent"===x?h.videoSent.packetsSent=parseInt(_.stat("packetsSent"),10):"bytesSent"===x&&(h.videoSent.bytesSent=parseInt(_.stat("bytesSent"),10))}return!1},this.refineStats_chrome_legacy=function(h,y){var a=!1;return y.forEach(function(m){var _=null,P=null;if("ssrc"===m.type&&m.id.indexOf("recv")>=0){if("audio"===m.mediaType){for(P in h.audioReceived={},_=Math.floor(Date.parse(m.timestamp)/1e3),m)"timestamp"===P?h.audioReceived.timestamp=_:h.audioReceived[P]=m[P];a=!0}else if("video"===m.mediaType){for(P in h.videoReceived={},_=Math.floor(Date.parse(m.timestamp)/1e3),m)"timestamp"===P?h.videoReceived.timestamp=_:h.videoReceived[P]=m[P];a=!0}}else if("ssrc"===m.type&&m.id.indexOf("send")>=0)if("audio"===m.mediaType){for(P in h.audioSent={},_=Math.floor(Date.parse(m.timestamp)/1e3),m)"timestamp"===P?h.audioSent.timestamp=_:h.audioSent[P]=m[P];a=!0}else if("video"===m.mediaType){for(P in h.videoSent={},_=Math.floor(Date.parse(m.timestamp)/1e3),m)"timestamp"===P?h.videoSent.timestamp=_:h.videoSent[P]=m[P];a=!0}}),a},this.refineStats_chrome_58=function(h,y){var a=this,m=!1;return y.forEach(function(_){if("inbound-rtp"!==_.type||_.isRemote){if("outbound-rtp"===_.type&&!_.isRemote)if("audio"===_.mediaType){h.audioSent={};var P=Math.floor(_.timestamp/1e3);for(var x in _)!1!==a.STANDARD_STAT_KEYS.audioSent[x]&&("timestamp"===x?h.audioSent.timestamp=P:h.audioSent[x]=_[x]);m=!0}else if("video"===_.mediaType){h.videoSent={};var oe=Math.floor(_.timestamp/1e3);for(var K in _)!1!==a.STANDARD_STAT_KEYS.videoSent[K]&&("timestamp"===K?h.videoSent.timestamp=oe:h.videoSent[K]=_[K]);m=!0}}else if("audio"===_.mediaType||_.id.indexOf("Audio")>=0){h.audioReceived={};var X=Math.floor(_.timestamp/1e3);for(var me in _)!1!==a.STANDARD_STAT_KEYS.audioReceived[me]&&("timestamp"===me?h.audioReceived.timestamp=X:h.audioReceived[me]=_[me]);m=!0}else if("video"===_.mediaType||_.id.indexOf("Video")>=0){h.videoReceived={};var Q=Math.floor(_.timestamp/1e3);for(var re in _)!1!==a.STANDARD_STAT_KEYS.videoReceived[re]&&("timestamp"===re?h.videoReceived.timestamp=Q:h.videoReceived[re]=_[re]);m=!0}}),m},this.refineStats_firefox_legacy=function(h,y){var a=!1,m=this;return y.forEach(function(_){var P=null,x=null;if("inbound-rtp"===_.type&&!1===_.isRemote){if("audio"===_.mediaType){for(P in h.audioReceived={packetsReceived:0,bytesReceived:0},x=Math.floor(_.timestamp/1e3),_)!1!==m.STANDARD_STAT_KEYS.audioReceived[P]&&("timestamp"===P?h.audioReceived.timestamp=x:h.audioReceived[P]=_[P]);a=!0}else if("video"===_.mediaType){for(P in h.videoReceived={packetsReceived:0,bytesReceived:0,framesDecoded:0},x=Math.floor(_.timestamp/1e3),_)!1!==m.STANDARD_STAT_KEYS.videoReceived[P]&&("timestamp"===P?h.videoReceived.timestamp=x:h.videoReceived[P]=_[P]);a=!0}}else if("outbound-rtp"===_.type&&!1===_.isRemote)if("audio"===_.mediaType){for(P in h.audioSent={packetsSent:0,bytesSent:0},x=Math.floor(_.timestamp/1e3),_)!1!==m.STANDARD_STAT_KEYS.audioSent[P]&&("timestamp"===P?h.audioSent.timestamp=x:h.audioSent[P]=_[P]);a=!0}else if("video"===_.mediaType){for(P in h.videoSent={packetsSent:0,bytesSent:0,framesEncoded:0},x=Math.floor(_.timestamp/1e3),_)!1!==m.STANDARD_STAT_KEYS.videoSent[P]&&("timestamp"===P?h.videoSent.timestamp=x:h.videoSent[P]=_[P]);a=!0}}),a},this.refineStats_firefox_63=function(h,y){var a=!1,m=this;return y.forEach(function(_){if("inbound-rtp"!==_.type||_.isRemote){if("outbound-rtp"===_.type&&!_.isRemote)if("audio"===_.kind){h.audioSent={packetsSent:0,bytesSent:0};var P=Math.floor(_.timestamp/1e3);for(var x in _)!1!==m.STANDARD_STAT_KEYS.audioSent[x]&&("timestamp"===x?h.audioSent.timestamp=P:h.audioSent[x]=_[x]);a=!0}else if("video"===_.kind){h.videoSent={packetsSent:0,bytesSent:0,framesEncoded:0};var oe=Math.floor(_.timestamp/1e3);for(var K in _)!1!==m.STANDARD_STAT_KEYS.videoSent[K]&&("timestamp"===K?h.videoSent.timestamp=oe:h.videoSent[K]=_[K]);a=!0}}else if("audio"===_.kind){h.audioReceived={packetsReceived:0,bytesReceived:0};var X=Math.floor(_.timestamp/1e3);for(var me in _)!1!==m.STANDARD_STAT_KEYS.audioReceived[me]&&("timestamp"===me?h.audioReceived.timestamp=X:h.audioReceived[me]=_[me]);a=!0}else if("video"===_.kind){h.videoReceived={packetsReceived:0,bytesReceived:0,framesDecoded:0};var Q=Math.floor(_.timestamp/1e3);for(var re in _)!1!==m.STANDARD_STAT_KEYS.videoReceived[re]&&("timestamp"===re?h.videoReceived.timestamp=Q:h.videoReceived[re]=_[re]);a=!0}}),a},this.addCallStats=function(h){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={};if(void 0!==this.refineStats){if(this.refineStats(a,h),void 0!==a.audioReceived){if(void 0!==this.prevData.audioReceived){var m=a.audioReceived.timestamp-this.prevData.audioReceived[0].timestamp;m>0?(void 0===a.audioReceived.packetsReceivedPerSecond&&(a.audioReceived.packetsReceivedPerSecond=Math.floor((a.audioReceived.packetsReceived-this.prevData.audioReceived[0].packetsReceived)/m)),void 0===a.audioReceived.bitsReceivedPerSecond&&(a.audioReceived.bitsReceivedPerSecond=Math.floor(8*(a.audioReceived.bytesReceived-this.prevData.audioReceived[0].bytesReceived)/m)),void 0===a.audioReceived.packetsLostPerSecond&&(a.audioReceived.packetsLostPerSecond=Math.floor((a.audioReceived.packetsLost-this.prevData.audioReceived[0].packetsLost)/m)),void 0===a.audioReceived.packetLossRatio&&(a.audioReceived.packetLossRatio=100*(a.audioReceived.packetsLost-this.prevData.audioReceived[0].packetsLost)/(a.audioReceived.packetsReceived-this.prevData.audioReceived[0].packetsReceived)),a.audioReceived.samplingInterval=m):(void 0===a.audioReceived.packetsReceivedPerSecond&&(a.audioReceived.packetsReceivedPerSecond=0),void 0===a.audioReceived.bitsReceivedPerSecond&&(a.audioReceived.bitsReceivedPerSecond=0),void 0===a.audioReceived.packetsLostPerSecond&&(a.audioReceived.packetsLostPerSecond=0),void 0===a.audioReceived.packetLossRatio&&(a.audioReceived.packetLossRatio=0),a.audioReceived.samplingInterval=0)}else void 0===a.audioReceived.packetsReceivedPerSecond&&(a.audioReceived.packetsReceivedPerSecond=0),void 0===a.audioReceived.bitsReceivedPerSecond&&(a.audioReceived.bitsReceivedPerSecond=0),void 0===a.audioReceived.packetsLostPerSecond&&(a.audioReceived.packetsLostPerSecond=0),void 0===a.audioReceived.packetLossRatio&&(a.audioReceived.packetLossRatio=0),a.audioReceived.samplingInterval=0,this.prevData.audioReceived=[];for(this.prevData.audioReceived.push(a.audioReceived);this.prevData.audioReceived.length>this.prevDataThreshold;)this.prevData.audioReceived.shift()}if(void 0!==a.videoReceived){if(void 0!==this.prevData.videoReceived){var _=a.videoReceived.timestamp-this.prevData.videoReceived[0].timestamp;_>0?(void 0===a.videoReceived.packetsReceivedPerSecond&&(a.videoReceived.packetsReceivedPerSecond=Math.floor((a.videoReceived.packetsReceived-this.prevData.videoReceived[0].packetsReceived)/_)),void 0===a.videoReceived.bitsReceivedPerSecond&&(a.videoReceived.bitsReceivedPerSecond=Math.floor(8*(a.videoReceived.bytesReceived-this.prevData.videoReceived[0].bytesReceived)/_)),void 0===a.videoReceived.packetsLostPerSecond&&(a.videoReceived.packetsLostPerSecond=Math.floor((a.videoReceived.packetsLost-this.prevData.videoReceived[0].packetsLost)/_)),void 0===a.videoReceived.framesDecodedPerSecond&&(a.videoReceived.framesDecodedPerSecond=Math.floor((a.videoReceived.framesDecoded-this.prevData.videoReceived[0].framesDecoded)/_)),void 0===a.videoReceived.packetLossRatio&&(a.videoReceived.packetLossRatio=100*(a.videoReceived.packetsLost-this.prevData.videoReceived[0].packetsLost)/(a.videoReceived.packetsReceived-this.prevData.videoReceived[0].packetsReceived)),a.videoReceived.samplingInterval=_):(void 0===a.videoReceived.packetsReceivedPerSecond&&(a.videoReceived.packetsReceivedPerSecond=0),void 0===a.videoReceived.bitsReceivedPerSecond&&(a.videoReceived.bitsReceivedPerSecond=0),void 0===a.videoReceived.packetsLostPerSecond&&(a.videoReceived.packetsLostPerSecond=0),void 0===a.videoReceived.framesDecodedPerSecond&&(a.videoReceived.framesDecodedPerSecond=0),void 0===a.videoReceived.packetLossRatio&&(a.videoReceived.packetLossRatio=0),a.videoReceived.samplingInterval=0)}else void 0===a.videoReceived.packetsReceivedPerSecond&&(a.videoReceived.packetsReceivedPerSecond=0),void 0===a.videoReceived.bitsReceivedPerSecond&&(a.videoReceived.bitsReceivedPerSecond=0),void 0===a.videoReceived.packetsLostPerSecond&&(a.videoReceived.packetsLostPerSecond=0),void 0===a.videoReceived.framesDecodedPerSecond&&(a.videoReceived.framesDecodedPerSecond=0),void 0===a.videoReceived.packetLossRatio&&(a.videoReceived.packetLossRatio=0),a.videoReceived.samplingInterval=0,this.prevData.videoReceived=[];for(this.prevData.videoReceived.push(a.videoReceived);this.prevData.videoReceived.length>this.prevDataThreshold;)this.prevData.videoReceived.shift()}if(void 0!==a.audioSent){if(void 0!==this.prevData.audioSent){var P=a.audioSent.timestamp-this.prevData.audioSent[0].timestamp;P>0?(void 0===a.audioSent.packetsSentPerSecond&&(a.audioSent.packetsSentPerSecond=Math.floor((a.audioSent.packetsSent-this.prevData.audioSent[0].packetsSent)/P)),void 0===a.audioSent.bitsSentPerSecond&&(a.audioSent.bitsSentPerSecond=Math.floor(8*(a.audioSent.bytesSent-this.prevData.audioSent[0].bytesSent)/P)),a.audioSent.samplingInterval=P):(void 0===a.audioSent.packetsSentPerSecond&&(a.audioSent.packetsSentPerSecond=0),void 0===a.audioSent.bitsSentPerSecond&&(a.audioSent.bitsSentPerSecond=0),a.audioSent.samplingInterval=0)}else void 0===a.audioSent.packetsSentPerSecond&&(a.audioSent.packetsSentPerSecond=0),void 0===a.audioSent.bitsSentPerSecond&&(a.audioSent.bitsSentPerSecond=0),a.audioSent.samplingInterval=0,this.prevData.audioSent=[];for(this.prevData.audioSent.push(a.audioSent);this.prevData.audioSent.length>this.prevDataThreshold;)this.prevData.audioSent.shift()}if(void 0!==a.videoSent){if(void 0!==this.prevData.videoSent){var x=a.videoSent.timestamp-this.prevData.videoSent[0].timestamp;x>0?(void 0===a.videoSent.packetsSentPerSecond&&(a.videoSent.packetsSentPerSecond=Math.floor((a.videoSent.packetsSent-this.prevData.videoSent[0].packetsSent)/x)),void 0===a.videoSent.bitsSentPerSecond&&(a.videoSent.bitsSentPerSecond=Math.floor(8*(a.videoSent.bytesSent-this.prevData.videoSent[0].bytesSent)/x)),void 0===a.videoSent.framesEncodedPerSecond&&(a.videoSent.framesEncodedPerSecond=Math.floor((a.videoSent.framesEncoded-this.prevData.videoSent[0].framesEncoded)/x)),a.videoSent.samplingInterval=x):(void 0===a.videoSent.packetsSentPerSecond&&(a.videoSent.packetsSentPerSecond=0),void 0===a.videoSent.bitsSentPerSecond&&(a.videoSent.bitsSentPerSecond=0),void 0===a.videoSent.framesEncodedPerSecond&&(a.videoSent.framesEncodedPerSecond=0),a.videoSent.samplingInterval=0)}else void 0===a.videoSent.packetsSentPerSecond&&(a.videoSent.packetsSentPerSecond=0),void 0===a.videoSent.bitsSentPerSecond&&(a.videoSent.bitsSentPerSecond=0),void 0===a.videoSent.framesEncodedPerSecond&&(a.videoSent.framesEncodedPerSecond=0),a.videoSent.samplingInterval=0,this.prevData.videoSent=[];for(this.prevData.videoSent.push(a.videoSent);this.prevData.videoSent.length>this.prevDataThreshold;)this.prevData.videoSent.shift()}}return Object.keys(a).length>0&&"function"==typeof y.post&&y.post(a),a},"chrome"===this.browserType?this.refineStats="proprietary"===u?this.refineStats_chrome_proprietary:this.browserVersion>=58?this.refineStats_chrome_58:this.refineStats_chrome_legacy:"firefox"===this.browserType?this.refineStats=this.browserVersion>=63?this.refineStats_firefox_63:this.refineStats_firefox_legacy:"safari"===this.browserType&&(this.refineStats=this.refineStats_chrome_58)}),V=(e(658),function(){this.NarrowBandSpeechQuality=function(z,M){var t,u,h=1,m=(94.769-(t=80+2.5*(65-40*Math.log10((1+z/10)/(1+z/150))+6*Math.exp(z*z*-.3)-14)))*(94.769-t)/4+100;return(u=93.193-((94.769-t)/2+Math.sqrt(m)-1)*(1-Math.exp(-z))-(0+M/(M+4.3)*95))<0&&(h=1),u<100&u>0&&(h=1+.035*u+u*(u-60)*(100-u)*7*1e-6),u>100&&(h=4.5),h},this.WideBandspeechQuality=function(z,M){var t,u,h,y=0,a=1;z<100&&(y=.08-z+10),z>=100&&(y=18);var P=(129-(t=80+3*(65+y-40*Math.log10((1+z/10)/(1+z/150))+6*Math.exp(z*z*-.3)-14)))*(129-t)/4+100;return(h=(u=129-((129-t)/2+Math.sqrt(P)-1)*(1-Math.exp(-z))-(0+M/(M+4.3)*95))/1.29)<=0&&(a=1),h<100&h>0&&(a=1+.035*u+u*(u-60)*(100-u)*7*1e-6),h>=100&&(a=4.5),a},this.videoQuality=function(z,M,t,u,h){var y,a,m,_,P,x,oe,K,X;return X=M>720?[0,2.77,.009,3.95,460,1.28,2.12,32e-5,1.28,262,1.98,22.84,7.999]:M>576?[0,6.31,.008,3.68,262,1.28,1.97,33e-5,1.24,343,2.76,6.25,6.013]:M>480?[0,6.96,.007,3.58,214,1.2,1.75,63e-5,1.13,171,4.25,7.98,12.001]:M>288?[0,5.61,.01,3.38,182,1.31,2.23,75e-5,1.51,136,4.05,20.16,22.332]:[0,3.988,.013,3.625,89.25,1.125,.713,0,1.542,245.5,3.011,39.31,16.67],x=1+Math.pow(u/X[4],X[5]),y=X[3]-X[3]/x,a=X[1]+X[2]*u,m=X[6]+X[7]*u,oe=Math.pow(Math.log(h)-Math.log(a),2),K=2*Math.pow(m,2),_=y*Math.exp(-oe/K),P=X[10]+X[11]*Math.exp(-h/X[8])+X[12]*Math.exp(-u/X[9]),1+_*Math.exp(-t/P)},this.audiovisualQuality=function(z,M,t,u){var h,y,a,m,_;return z>0&&M>0?(h=(_=[0,-.6966,-.8127,.4562,3.003,-.1638,.3626,.1291,.5457,-1251e-7,3.763,-.001065,.01465,-.001002,0])[9]*(t+u)+_[10],t>=u&&(y=Math.min(_[11]*(t-u)+_[12],0)),t<u&&(y=Math.min(_[13]*(u-t)+_[14],0)),a=Math.max(h+y,1),_[1]*(m=_[5]*z+_[6]*M+_[7]*z*M+_[8])+_[2]*a+_[3]*m*a+_[4]):"NoAudiovisualStream"}}),T=i.Y.get("WebRTC_Call"),b=apiCC.myWebRTC_Event,H=function(z){this.dest_roomId="",this.pc=null,this.callId=0,this.callee=!1,this.callerId=0,this.calleeId=0,this.started=!1,this.localDescriptionSetted=!1,this.remoteDescriptionSetted=!1,this.sendedSdpOfferMessage=null,this.receivedSdpOfferMessage=null,this.myWebRTC_Stack=new L.S(z.socket),this.remoteMediaStreams=[],this.rtpSenders={audio:[],video:[]},this.addingUserMedia=!1,this.myWebRTC_Event=apiCC.myWebRTC_Event,this.dtmfSender=null,this.incomingcandidatesQueue=[],"Firefox"===c.Xh?c.PR>43?(this.mediaConstraintsAudioOnly={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):(this.mediaConstraintsAudioOnly={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!1}},this.mediaConstraints={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0}}):"Chrome"===c.Xh?c.PR<55?(this.mediaConstraintsAudioOnly={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}):(this.mediaConstraintsAudioOnly={offerToReceiveAudio:1,offerToReceiveVideo:1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):"Edge"===c.Xh?(this.mediaConstraintsAudioOnly={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):(this.mediaConstraintsAudioOnly={offerToReceiveAudio:1,offerToReceiveVideo:1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}),"iOS"===c.ag.name&&(T.log("Defining mediaConstraints for iOS "),this.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0}),this.trickleIce=z.trickleIce,this.callLocalStream=null,this.generatedLocalStream=!1,this.audioOnly=!1,this.inviteSended=!1,this.sendInviteTrickleIceFalseTimeOutId=0,this.sendInviteTrickleIceFalseTimer=5e3,this.message200OKSended=!1,this.send200OKTrickleIceFalseTimeOutId=0,this.send200OKTrickleIceFalseTimer=5e3,this.message200OKReceived=!1,this.callCancelled=!1,this.screenSharing=!1,this.desktopId=0,this.pc_config=z.pc_config,this.pc_constraints=z.pc_constraints,this.audioFileMediaElement=null,this.videoReceivedWidth=640,this.videoReceivedHeight=480,this.videoSendWidth=640,this.videoSendHeight=480,this.videoReceivedDelay=0,this.audioReceivedDelay=0,this.audioSendDelay=0,this.videoSendDelay=0,this.videoSendPacketLossRatio=0,this.audioSendPacketLossRatio=0,this.getStatsInterval=z.qosInterval,this.qm=null,this.statisticId=null,this.csmIntervalMs=z.csmIntervalMs,this.csmIntervalId=null,this.remoteId=0,this.callType="media",this.localCallProfile={audio:!1,audioActive:!1,video:!1,videoActive:!1},this.remoteCallProfile={audio:!1,audioActive:!1,video:!1,videoActive:!1},this.disconnectionTimeoutId=0,this.disconnectionTimer=4e4,this.disconnectionWarningDelay=9e3,this.disconnectionWarningInterval=0,this.disconnectionWarningTimeout=0,this.disconnectionWarningCount=0,this.checkCandidateTypesTimer=1e4,this.checkCandidateTypesTimeoutId=0,this.checkCandidateTypesTimeoutTable=[],this.data={},this.screenStream=null,this.screenIsDisplayed=!1,this.addingDataChannelOnCallOngoing=!1,this.sendDataChannel=null,this.receiveDataChannel=null,this.receiveChunkNb={},this.firstDataPacket={},this.receivedSize={},this.receiveArrayToStoreChunks={},this.destCallType="media",this.mcuRemoteStream=null,this.userMediaAccessRequired=!0,this.settingUpMode="normal",this.remoteType="web",this.mediaTypeForIncomingCall=z.mediaTypeForIncomingCall,this.mediaTypeForOutgoingCall=z.mediaTypeForOutgoingCall,this.mediaRoutingMode=z.mediaRoutingMode,this.stripAudioSDPActivated=!1,this.stripVideoSDPActivated=!1,this.iceState="notdefined",this.restarted=!1,this.audioSdpDirection=null,this.videoSdpDirection=null,this.isLocalAudioMuted=!1,this.isLocalVideoMuted=!1,this.isRemoteAudioMuted=!1,this.isRemoteVideoMuted=!1,this.isAccepted=!1,this.accessToMedia=!1,this.callConfiguration=null,this.captureSourceType=null,this.preferH264Codec=!1,this.preferVP8Codec=!1,this.preferVP9Codec=!1,this.candidateNb=0,this.sessionMCU=null,this.instanceId=0,this.retryUpdateMedia=!1,this.updateMediaOngoing=!1,this.setCallTurnServer=function(M){T.info("setCallTurnServer :",M);var t=JSON.stringify(this.pc_config);t=t.replace(/mp1.apizee.com/g,M),this.pc_config=JSON.parse(t)},this.setCallMediaRoutingMode=function(M){T.info("setCallMediaRoutingMode :",M),"hostOnly"===M?this.mediaRoutingMode=z.mediaRoutingModeEnum.hostOnly:"stun"===M?this.mediaRoutingMode=z.mediaRoutingModeEnum.stun:"stunOnly"===M?this.mediaRoutingMode=z.mediaRoutingModeEnum.stunOnly:"turn"===M?this.mediaRoutingMode=z.mediaRoutingModeEnum.turn:"turnOnly"===M?this.mediaRoutingMode=z.mediaRoutingModeEnum.turnOnly:(T.log("parameter error when calling function : setCallMediaRoutingMode()"),this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setCallMediaRoutingMode()","PARAMETER_ERROR_SETCALLMEDIAROUTINGMODE"))},this.checkDTLSCompliancy=function(){if(T.debug("checkDTLSCompliancy"),!1===apiCC.session.isDeviceDTLSCompliant())T.log("Device not DTLS compliant, setting DtlsSrtpKeyAgreement: false"),this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!1}]};else{var M=apiCC.session.isClientDTLSCompliant(this.remoteId);!1!==M&&"false"!==M||(T.log("Remote Device not DTLS compliant, setting DtlsSrtpKeyAgreement: false"),this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!1}]})}},this.sendData=function(M,t){T.info("datachannel - sendData");var u=null,h=null;if(M.file instanceof File)return T.log("File"),this.contentType=M.file.type,this.originalDataType="File",u=new FileReader,h=this,u.onload=function(y){h.sendData({file:y.target.result||u.result,name:M.name,type:M.type},t)},void u.readAsArrayBuffer(M.file);new I(this).send(M,this.sendDataChannel,t)},T.log("New Call for client with Id :"+z.clientId),this.generateCallId=function(){this.callId=apiCC.generateCallId(),T.info("new call with callId :"+this.callId)},this.sendInviteTrickleIceFalse=function(){T.log("sendInviteTrickleIceFalse"),T.log("sendInvite on candidate timer reached"),this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,z.nickname,this.dest_roomId,this.dest_roomId,this.pc.localDescription,this.callType,this.data,this.mcuRemoteStream),this.inviteSended=!0},this.send200OkTrickleIceFalse=function(){T.log("send200OkTrickleIceFalse"),this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,z.nickname,this.dest_roomId,this.pc.localDescription,this.data),this.message200OKSended=!0},this.onSetLocalDescriptionSuccess=function(){T.info("onSetLocalDescriptionSuccess"),this.localDescriptionSetted=!0,this.asyncCallbacks&&"subscribe"===this.asyncCallbacks.type&&delete this.asyncCallbacks,!1===this.trickleIce&&(!0===this.callee?(T.info("starting send200OKTrickleIceFalseTimeOutId"),this.send200OKTrickleIceFalseTimeOutId=setTimeout(this.callback(this,"send200OkTrickleIceFalse"),this.send200OKTrickleIceFalseTimer)):(T.info("starting sendInviteTrickleIceFalseTimeOutId"),this.sendInviteTrickleIceFalseTimeOutId=setTimeout(this.callback(this,"sendInviteTrickleIceFalse"),this.sendInviteTrickleIceFalseTimer))),z.rtpSenderSetParamatersCapable&&z.evaluateVideoCap(this)},this.onSetLocalDescriptionFailure=function(M){T.warn("onSetLocalDescriptionFailure",M);var t=null,u=null;this.callControl&&(t=this.callControl.roomName,u=this.callControl.type),b.createErrorEvent("Set local Description Failure","SET_LOCAL_DESCRIPTION_FAILURE",this.callId,t,u),z.onHangup(this.callId,"Local_Description_Failure")},this.onSetRemoteDescriptionSuccess=function(){T.info("onSetRemoteDescriptionSuccess");var M=null;for(this.remoteDescriptionSetted=!0,!0===this.restarting&&delete this.restarting,this.data&&(this.data.mesh||this.data.subscribeOrder)||b.createCallEstablishedEvent(this.calleeId,this.callType,this.callId,this.destCallType);this.incomingcandidatesQueue.length;)M=this.incomingcandidatesQueue.shift(),this.processCandidateMsg(M);if(void 0!==z.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId]){for(T.debug("Restoring candidate from client, this.callId :"+this.callId+" , instanceId :"+this.instanceId);z.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId].length;)M=z.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId].shift(),this.processCandidateMsg(M);delete z.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId]}if(this.asyncCallbacks&&("addingUserMedia"===this.asyncCallbacks.type?(this.asyncCallbacks.resolve(this.callConfiguration.userMediaStreamId),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks):"updateCallConfiguration"===this.asyncCallbacks.type&&(this.asyncCallbacks.resolve(),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks)),this.updateMediaOngoing=!1,!0===this.retryUpdateMedia){T.debug("an updateMedia was waiting for sig stable state or an other updateMedia end, updating Media now ..."),this.retryUpdateMedia=!1;var t=this.updateMedia(!1);T.debug("Retried updateMediaResult :",t)}},this.processCandidateMsg=function(M){T.info("processCandidateMsg :",M);var t=null;null!==this.pc?(void 0!==M.completeCandidate?(T.trace("new behavior of 2.13.8"),t=new apiCC.myWebRTC_Adapter.RTCIceCandidate(M.completeCandidate)):(T.log("old behavior < 2.13.8"),t=new apiCC.myWebRTC_Adapter.RTCIceCandidate({sdpMLineIndex:M.label,candidate:M.candidate})),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("addIceCandidate"),this.pc.addIceCandidate(t,function(){T.trace("addIceCandidate success")},function(u){T.warn("addIceCandidate failure: "+u),u=null})):(T.log("addIceCandidate - Promise version"),this.pc.addIceCandidate(t).then(function(){T.trace("addIceCandidate success")}).catch(function(u){T.warn("addIceCandidate failure: "+u),u=null}))):T.error("Error, call is not null but pc is null")},this.onSetRemoteDescriptionFailure=function(M){T.warn("onSetRemoteDescriptionFailure :",M);var t=null,u=null;this.callControl&&(t=this.callControl.roomName,u=this.callControl.type),b.createErrorEvent("Set remote Description Failure","SET_REMOTE_DESCRIPTION_FAILURE",this.callId,t,u),z.onHangup(this.callId,"Remote_Description_Failure")},this.getUserMediaOnCall=function(){var M=this,t=!1;if(T.info("getUserMediaOnCall, audio Only :"+this.audioOnly),T.info("getUserMediaOnCall, screenSharing activated :"+this.screenSharing),T.log("webRTCClient.gum_config :",z.gum_config),this.callerId===z.clientId){if(T.log("outgoing call"),"VIDEO"===this.mediaTypeForOutgoingCall||"VIDEOONLY"===this.mediaTypeForOutgoingCall)if(T.log("mediaTypeForOutgoingCall :"+this.mediaTypeForOutgoingCall),"VIDEOONLY"===this.mediaTypeForOutgoingCall&&(t=!0),!0!==this.screenSharing){if(!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return T.log("getUserMediaOnCall without any device, calling without device"),void this.onUserMediaSuccessOnCall();T.log("video is not present :"+this.callType),"media"===this.callType&&(T.log("callType is media, but no webcam present, forcing callType to audio"),this.callType="audio",this.audioOnly=!0)}}else T.log("screenSharing, no device checking");else if("AUDIO"===this.mediaTypeForOutgoingCall)T.log("mediaTypeForOutgoingCall is AUDIO, setting call to audioOnly"),this.callType="audio",this.audioOnly=!0;else if("NONE"===this.mediaTypeForOutgoingCall||"DATA"===this.mediaTypeForOutgoingCall)return T.log("mediaTypeForOutgoingCall is NONE, call will be recvOnly"),void this.onUserMediaSuccessOnCall()}else if(T.log("incoming call"),"VIDEO"===this.mediaTypeForIncomingCall||"VIDEOONLY"===this.mediaTypeForIncomingCall){if(T.log("mediaTypeForIncomingCall :"+this.mediaTypeForIncomingCall),"VIDEOONLY"===this.mediaTypeForIncomingCall&&(t=!0),!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return T.log("getUserMediaOnCall without any device, calling without device"),void this.onUserMediaSuccessOnCall();T.log("video is not present :"+this.callType),"media"===this.callType&&(T.log("callType is media, but no webcam present, forcing callType to audio"),this.callType="audio",this.audioOnly=!0)}}else if("AUDIO"===this.mediaTypeForIncomingCall)T.log("mediaTypeForIncomingCall is AUDIO, setting call to audioOnly"),this.callType="audio",this.audioOnly=!0;else if("NONE"===this.mediaTypeForIncomingCall||"DATA"===this.mediaTypeForIncomingCall)return T.log("mediaTypeForIncomingCall is NONE, call will be recvOnly"),void this.onUserMediaSuccessOnCall();z.getUserMediaOnGoing=!0;var u=null,h=null;if(T.log("this.screenSharing :"+this.screenSharing),T.log("this.audioOnly :"+this.audioOnly),!0===this.screenSharing)if(T.log("getScreenMedia"),"Chrome"===c.Xh)T.log("this.desktopId :"+this.desktopId),u={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.desktopId}}};else{if(T.log("this.captureSourceType :"+this.captureSourceType),"screen"!==this.captureSourceType&&"window"!==this.captureSourceType&&"application"!==this.captureSourceType)return void T.error("captureSourceType value is not correct");u={video:{mediaSource:this.captureSourceType}}}else!0===this.audioOnly?(T.log("this.audioOnly = true"),z.gum_config=apiCC.setAudioSourceIdInConstraint(z.audioSourceId,z.gum_config),h=JSON.parse(JSON.stringify(z.gum_config)),!1===z.allowAsymetricMediaCalls?h.video=!1:T.log("allow AsymetricMediaCalls is activated"),u=h):(T.log("audio and video call"),u=(0,d.ws)({},z.gum_config),t?u.audio=!1:u=apiCC.setAudioSourceIdInConstraint(z.audioSourceId,u),u=apiCC.setVideoSourceIdInConstraint(z.videoSourceId,u),u=apiCC.setVideoFacingModeInConstraint(z.facingMode,u),"undefined"!=typeof apiRTC_React&&(u={audio:!0,video:{mandatory:{minWidth:500,minHeight:300,minFrameRate:30},facingMode:"user"}}));apiCC.createUserMediaStream({callId:this.callId,type:this.callType,gum_config:u,success:function(y){T.debug("[getUserMediaOnCall] success; userMediaStreamId: "+y.userMediaStreamId),null!=M.callConfiguration||(M.callConfiguration={}),M.callConfiguration.userMediaStreamId=y.userMediaStreamId,M.onUserMediaSuccessOnCall(y.stream)},failure:function(y,a){T.debug("[getUserMediaOnCall] failure; userMediaStreamId: "+y.userMediaStreamId),M.onUserMediaErrorOnCall(a)}})},this.handleToneChangeEvent=function(M){T.debug("handleToneChangeEvent :",M.tone),T.debug(""!==M.tone?"Tone played: "+M.tone:"All tones have played.")},this.sendTones=function(M,t,u){T.debug("sendTones :"),this.dtmfSender&&(T.debug("sendTones : Tones, duration, gap: ",M,t,u),this.dtmfSender.insertDTMF(M,t,u))},this.addStream=function(M){var t,u=null,h=null,y=0,a=!1,m=null,_=[];if("undefined"!=typeof apiRTC_React||"Firefox"===c.Xh&&c.PR<51||"Chrome"===c.Xh&&c.PR<65||"Safari"===c.Xh&&c.dc<12.1||"Mobile Safari"===c.Xh&&c.dc<12.1||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)T.info("using addStream method"),this.pc.addStream(M),T.debug("end addStream method");else{if(!("Firefox"===c.Xh&&c.PR<59||"Edge"===c.Xh)){for(T.info("using addTrack/replaceTrack method"),u=M.getTracks(),t=0;t<u.length;t+=1){for(a=!1,h=this.rtpSenders[u[t].kind],y=0;y<h.length;y+=1)if(null===h[y].track){a=!0;break}if(!0===a)_.push(h[y].replaceTrack(u[t])),T.debug("addStream -> replaceTrack",h[y]);else{if("RID"===this.simulcast&&"video"===u[t].kind&&"chrome"===d.wL.type){var P=[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}];this.callControl.callConfiguration.simulcast&&this.callControl.callConfiguration.simulcast.sendEncodings&&(P=this.callControl.callConfiguration.simulcast.sendEncodings.slice()),m=this.pc.addTransceiver(u[t],{direction:"sendonly",streams:[M],sendEncodings:P}).sender}else if(m=this.pc.addTrack(u[t],M),"RID"===this.simulcast&&"video"===u[t].kind&&"firefox"===d.wL.type){var x=m.getParameters();x||(x={}),x.encodings=this.callControl.callConfiguration.simulcast&&this.callControl.callConfiguration.simulcast.sendEncodings?this.callControl.callConfiguration.simulcast.sendEncodings.slice():[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}],_.push(m.setParameters(x))}T.debug("addStream -> addTrack",m),this.rtpSenders[u[t].kind].push(m)}}return T.debug("end addTrack/replaceTrack method"),this.rtpSenders.audio.length>0&&(this.dtmfSender=this.rtpSenders.audio[0].dtmf,this.dtmfSender&&(this.dtmfSender.ontonechange=this.handleToneChangeEvent)),new Promise(function(oe,K){Promise.all(_).then(function(X){oe()}).catch(K)})}for(T.info("using addTrack method"),u=M.getTracks(),t=0;t<u.length;t+=1)this.pc.addTrack(u[t],M);T.debug("end addTrack method")}return Promise.resolve()},this.removeStream=function(M){var t,u=null,h=[];if(T.info("removeStream in call",M.id),"Firefox"===c.Xh&&c.PR<51||"Chrome"===c.Xh&&c.PR<65||"Safari"===c.Xh&&c.dc<12.1||"Mobile Safari"===c.Xh&&c.dc<12.1||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)T.info("using removeStream method"),this.pc.removeStream(M),T.debug("end removeStream method");else{if(!("Firefox"===c.Xh&&c.PR<59||"Edge"===c.Xh)){for(T.info("using replaceTrack method"),t=0;t<this.rtpSenders.audio.length;t+=1)h.push(this.rtpSenders.audio[t].replaceTrack(null));for(t=0;t<this.rtpSenders.video.length;t+=1)h.push(this.rtpSenders.video[t].replaceTrack(null));return T.debug("end replaceTrack method"),new Promise(function(y,a){Promise.all(h).then(function(m){y()}).catch(a)})}for(T.info("using removeTrack method"),u=this.pc.getSenders(),T.debug("senders :",u),t=0;t<u.length;t+=1)this.pc.removeTrack(u[t]);T.debug("end removeTrack method")}return Promise.resolve()},this.stopStream=function(M){T.info("stopStream in call");var t,u=null;if("Chrome"===c.Xh&&c.PR<45||"Firefox"===c.Xh&&c.PR<44||"Opera"===c.Xh&&c.PR<34||"Chromium"===c.Xh&&c.PR<44||"Chrome WebView"===c.Xh&&c.PR<45)T.log("... using MediaStream.stop"),M.stop();else{for(T.log("... using MediaStreamTrack.stop"),u=M.getTracks(),t=0;t<u.length;t+=1)u[t].stop();T.log("... tracks stopped")}M=null},this.getScreenUserMediaOnCall=function(){T.info("getScreenUserMediaOnCall");try{T.log("getScreenMedia"),navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.desktopId,maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},this.callback(this,"onScreenUserMediaSuccessOnCall"),this.callback(this,"onScreenUserMediaErrorOnCall")),T.log("Requested access to local media with new syntax.")}catch(M){T.error("getUserMedia() failed. Is this a WebRTC capable browser?"),T.log("getUserMedia failed with exception: "+M.message)}},this.onScreenUserMediaSuccessOnCall=function(M){T.info("onScreenUserMediaSuccessOnCall");var t,u="Unknown",h="Unknown";M.getAudioTracks().length>0&&(M.getAudioTracks()[0].label&&(u=M.getAudioTracks()[0].label),T.log("Using audio device: "+u)),M.getVideoTracks().length>0&&(M.getVideoTracks()[0].label&&(h=M.getVideoTracks()[0].label),T.log("Using video device: "+h)),T.log("Changing video stream with screen"),this.screenStream=M,this.screenStream.getVideoTracks()[0].onended=this.callback(this,"stopScreenSharingOnSwitchStream"),T.log("Adding callLocalstream to screen MediaStream"),t=this.callLocalStream.getAudioTracks()[0].clone(),this.screenStream.addTrack(t),this.switchVideoToScreen()},this.toggleVideoScreen=function(){!0===this.screenIsDisplayed?this.switchScreenToVideo():this.switchVideoToScreen()},this.switchVideoToScreen=function(){var M=this;T.info("switchVideoToScreen in call"),this.removeStream(this.callLocalStream).then(function(){M.addStream(M.screenStream),M.updateMediaWithRetryManagement(!1),z.myWebRTC_Event.createSwitchStreamEvent(M.callId,M.screenStream),M.screenIsDisplayed=!0}).catch(function(t){T.error("Failed to switchVideoToScreen",t);var u=null,h=null;M.callControl&&(u=M.callControl.roomName,h=M.callControl.type),z.myWebRTC_Event.createErrorEvent("Failed to switchVideoToScreen","MEDIA_UPDATE_ERROR",M.callId,u,h)})},this.switchScreenToVideo=function(){var M=this;T.info("switchScreenToVideo in call"),this.removeStream(this.screenStream).then(function(){M.addStream(M.callLocalStream),M.updateMediaWithRetryManagement(!1),z.myWebRTC_Event.createSwitchStreamEvent(M.callId,M.callLocalStream),M.screenIsDisplayed=!1}).catch(function(t){T.error("Failed to switchScreenToVideo",t);var u=null,h=null;M.callControl&&(u=M.callControl.roomName,h=M.callControl.type),z.myWebRTC_Event.createErrorEvent("Failed to switchScreenToVideo","MEDIA_UPDATE_ERROR",M.callId,u,h)})},this.onScreenUserMediaErrorOnCall=function(M){T.error("Failed to get access to local media. Error code was "+M.code),T.error(M),M=null},this.addVideoMedia=function(){var M=this;T.info("addVideoMedia"),apiCC.createUserMediaStream({callId:this.callId,type:"media",gum_config:z.gum_config,success:function(u){T.debug("[addVideoMedia] success; userMediaStreamId: "+u.userMediaStreamId);var h=apiCC.getUserMediaStream(M.callConfiguration.userMediaStreamId),y=Promise.resolve();h&&(y=M.removeStream(h.stream).then(function(){z.myWebRTC_Event.createLocalStreamRemovedEvent(M.callType,M.callId,h.stream,M.remoteId,M.destCallType),apiCC.releaseUserMediaStream(h.userMediaStreamId,M.callId)})),y.then(function(){M.callConfiguration.userMediaStreamId=u.userMediaStreamId,M.callLocalStream=u.stream,M.addStream(u.stream),M.updateMediaWithRetryManagement(!1)}).catch(function(a){T.error("Failed to addVideoMedia",a);var m=null,_=null;M.callControl&&(m=M.callControl.roomName,_=M.callControl.type),z.myWebRTC_Event.createErrorEvent("Failed to addVideoMedia","MEDIA_UPDATE_ERROR",M.callId,m,_)})},failure:function(u,h){T.debug("[addVideoMedia] failure; userMediaStreamId: "+u.userMediaStreamId),M.onUserMediaErrorOnCall(h)}})},this.stopScreenSharingOnSwitchStream=function(){T.info("stopScreenSharingOnSwitchStream detected"),this.switchScreenToVideo(this.callId),null!==this.screenStream&&(T.log("stopping screenStream"),this.stopStream(this.screenStream),b.createUserMediaStopEvent(this.callId,"screen"))},this.stopScreenSharing=function(){T.info("stopScreenSharing detected"),z.removeCallFromTableWithCallIdAndSendBye(this.callId,"stop_ScreenSharing")},this.checkingMutingState=function(){var M=this,t=null;T.debug("checkingMutingState");var u=function(){(0,d.ki)(M,"mcuRemoteStream","object")||(M.mcuRemoteStream={}),M.mcuRemoteStream.videoMuted=!0},h=function(){(0,d.ki)(M,"mcuRemoteStream","object")||(M.mcuRemoteStream={}),M.mcuRemoteStream.audioMuted=!0};(0,d.ki)(this.callConfiguration,"userMediaStreamId","string")&&(t=apiCC.getUserMediaStream(this.callConfiguration.userMediaStreamId))&&(t.videoMuted?(u(),this.isLocalVideoMuted=!0):this.isLocalVideoMuted=!1,t.audioMuted?(h(),this.isLocalAudioMuted=!0):this.isLocalAudioMuted=!1);var y=function(){M.isLocalVideoMuted||(t?t.video&&!t.videoMuted&&t.muteVideoOnStreams():M.callLocalStream&&(z.muteTracks(M.callLocalStream.getVideoTracks()),M.isLocalVideoMuted=!0),u())},a=function(){M.isLocalAudioMuted||(t?t.audio&&!t.audioMuted&&t.muteAudioOnStreams():M.callLocalStream&&(z.muteTracks(M.callLocalStream.getAudioTracks()),M.isLocalAudioMuted=!0),h())};!0===z.isVideoMuted&&(T.log("Client is video muted, applying to call"),y()),!0===z.isAudioMuted&&(T.log("Client is audio muted, applying to call"),a()),(0,d.ki)(this.callConfiguration,"muted","string")&&(T.log("callConfiguration muted is set :",this.callConfiguration.muted),"VIDEO"===this.callConfiguration.muted&&(y(),a()),"AUDIOONLY"===this.callConfiguration.muted&&a(),"VIDEOONLY"===this.callConfiguration.muted&&y(),delete this.callConfiguration.muted)},this.onUserMediaSuccessOnCall=function(M){T.info("onUserMediaSuccessOnCall");var t=(0,d.Pj)(),u={};!0===z.userMediaErrorDetected&&(z.userMediaErrorDetected=!1,u.userMediaErrorDetected=z.userMediaErrorDetected,apiCC.session.setUserData(u)),T.log("isHTTPS()"+t),z.getUserMediaOnGoing=!1,T.log("User has granted access to local media."),z.accessToLocalMedia=!0,z.displayHangUpButtonInCommand(),this.accessToMedia=!0,"LOCAL"!==this.calleeId&&z.setStatus(!0===this.callee?"You are connected to :"+this.callerId:"You are connected to :"+this.calleeId),!0===this.screenSharing?(this.callType="screenSharing",null!=M&&(M.onended=this.callback(this,"stopScreenSharing"),M.getVideoTracks().length>0&&(M.getVideoTracks()[0].onended=this.callback(this,"stopScreenSharing")))):!0===this.audioOnly&&(this.callType="audio"),!1===this.addingUserMedia?(z.miniVideo&&(T.log("webRTCClient.miniVideo.src :"+z.miniVideo.src),T.log("document.URL :"+document.URL),void 0!==M&&apiCC.attachMediaStream(z.miniVideo,M)),z.localVideo&&(T.log("webRTCClient.localVideo.src :"+z.localVideo.src),T.log("document.URL :"+document.URL),void 0!==M&&apiCC.attachMediaStream(z.localVideo,M),z.localVideo.style.opacity=1)):z.miniVideo&&void 0!==M&&apiCC.attachMediaStream(z.miniVideo,M),void 0!==M&&(this.callLocalStream=M),(0,d.yJ)()?(T.log("isHTTP true"),this.establishCall()):(T.log("webRTCClient.userAcceptOnIncomingCall :"+z.userAcceptOnIncomingCall),T.log("this.callee :"+this.callee),void 0!==this.data&&T.log("this.data.MCUType :"+this.data.MCUType),!0!==z.userAcceptOnIncomingCall||!0!==this.callee&&"MCU-Callee"!==this.data.MCUType||!1!==this.isAccepted?"LOCAL"!==this.calleeId?this.establishCall():T.log("call is not established as this is a LOCAL stream request"):T.log("Stand-by :: wait for establishCall"))},this.establishCall=function(){var M=this;T.debug("establishCall()"),!0!==this.started||!0!==this.addingUserMedia||!this.belongsToRoom()||"publish"!==this.settingUpType||this.data&&this.data.hasOwnProperty("MCUType")||!this.sessionMCU||this.sessionMCU.hasOwnProperty("roomMode")||(this.restarting=!0,this.pc.close(),this.pc=null,this.started=!1,this.localDescriptionSetted=!1,this.remoteDescriptionSetted=!1,this.sendedSdpOfferMessage=null,this.receivedSdpOfferMessage=null,this.rtpSenders={audio:[],video:[]},this.addingUserMedia=!1,this.updateUserMedia=!1,this.updateCause=null,this.incomingcandidatesQueue=[],this.message200OKReceived=!1,this.statisticId&&(clearInterval(this.statisticId),this.statisticId=null),this.csmIntervalId&&(clearInterval(this.csmIntervalId),this.csmIntervalId=null),this.instanceId=apiCC.generateInstanceId(),this.data.instanceId=this.instanceId),!0!==this.dataCall&&this.checkingMutingState(),this.maybeStart();var t=null;this.callee&&!0!==this.addingUserMedia&&!0!==this.updateUserMedia?(t=new apiCC.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),T.log("Avant setRemote pour le callee :",t),null!==this.pc?(z.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),t.sdp=z.mySDPManager.maybePreferCodec(t.sdp,"video","H264")),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("establishCall : before setRemoteDescription for callee"),this.pc.setRemoteDescription(t,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("establishCall : before setRemoteDescription for callee - Promise version"),this.pc.setRemoteDescription(t).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure")))):T.log("Error : PC is null"),this.doAnswer()):!0===this.addingUserMedia?(T.log("Adding local stream 1."),null!==this.pc?(null===this.callLocalStream&&null!==z.localStream&&(this.callLocalStream=z.localStream),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream).then(function(){M.updateMediaWithRetryManagement(!1)}).catch(function(u){T.error("failed to add stream",u)})):(T.log("No Stream to addStream"),this.updateMediaWithRetryManagement(!1))):T.error("Error : PC is null")):!0===this.updateUserMedia&&this.updateMediaWithRetryManagement(!1),T.log("End of establishCall()")},this.onUserMediaSuccessTestUni=function(){z.getUserMediaOnGoing=!1,T.info("onUserMediaSuccessTestUni : User has not granted access to local media.");var M=null,t={};!0===z.userMediaErrorDetected&&(z.userMediaErrorDetected=!1,t.userMediaErrorDetected=z.userMediaErrorDetected,apiCC.session.setUserData(t)),z.accessToLocalMedia=!0,this.maybeStart(),this.callee&&(M=new apiCC.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),z.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),M.sdp=z.mySDPManager.maybePreferCodec(M.sdp,"video","H264")),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("onUserMediaSuccessTestUni : before setRemoteDescription for callee"),this.pc.setRemoteDescription(M,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("onUserMediaSuccessTestUni : before setRemoteDescription for callee - Promise version"),this.pc.setRemoteDescription(M).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure"))),this.doAnswer())},this.onUserMediaErrorOnCall=function(M){var t=this;T.log("onUserMediaErrorOnCall");var u={};z.getUserMediaOnGoing=!1,setTimeout(function(){b.createErrorEvent(M,"USER_MEDIA_ERROR",t.callId)}),T.error("Failed to get access to local media. Error code was "+M.code),T.error(M),M=null,"electron"!==c.$6&&"Chrome"===c.Xh&&c.PR>47&&(T.log("browser_version > 47"),"https:"!==window.location.protocol&&T.error("HTTPS is now mandatory to use getUserMedia()")),z.setStatus("<div>Your phone is registered, you can be reached at this number : "+z.clientId+"</div>"),!0===this.screenSharing&&(this.callType="screenSharing","https:"!==window.location.protocol?(T.log("You need to be connected using HTTPS for screenSharing"),b.createDesktopCaptureEvent("UserMediaError_HTTPS_needed",this.callId,this.remoteId)):(T.log("screenSharing UserMediaError"),b.createDesktopCaptureEvent("UserMediaError",this.callId,this.remoteId))),!0===this.callee?(this.myWebRTC_Stack.sendBye(this.callId,this.calleeId,this.dest_roomId,this.callerId,"User_Media_Error",this.data),z.removeCallFromTableWithCallIdandRemoteId(this.callId,this.callerId,"User_Media_Error")):(null!=this.data&&"MCU-Callee"===this.data.MCUType&&this.myWebRTC_Stack.sendBye(this.callId,this.callerId,this.dest_roomId,this.calleeId,"User_Media_Error",this.data),z.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"User_Media_Error")),!1===this.screenSharing&&(z.userMediaErrorDetected=!0,u.userMediaErrorDetected=z.userMediaErrorDetected,apiCC.session.setUserData(u))},this.maybeStart=function(){T.debug("maybeStart"),!this.started&&z.channelReady&&(z.accessToLocalMedia||this.dataCall)&&(T.log("Creating PeerConnection."),this.createPeerConnection(),z.unidirectionelCallOnly||!0===this.screenSharing?!1===this.callee&&(T.log("Adding local stream 2."),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream)):null!==z.localStream?(T.log("Add Stream of client.localStream"),this.addStream(z.localStream),this.callLocalStream=z.localStream):T.log("No Stream to add")):this.dataCall||(T.log("Adding local stream 3."),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream)):null!==z.localStream?(T.log("Add Stream of client.localStream"),this.addStream(z.localStream),this.callLocalStream=z.localStream):(T.log("No Stream to add"),this.belongsToRoom()||"safari"!==d.wL.type||"function"!=typeof this.pc.addTransceiver||(T.debug("add transceivers"),this.pc.addTransceiver("audio",{direction:"recvonly"}),this.pc.addTransceiver("video",{direction:"recvonly"})))),this.started=!0,!1===this.callee&&(T.log("Before doCall()"),this.doCall())),T.log("End of maybeStart")},this.createDataChannel=function(){if(T.info("createDataChannel"),"Edge"===c.Xh&&c.PR<79)T.warn("Cannot create DataChannel as it is not supported on Edge");else if(null===this.sendDataChannel)try{this.sendDataChannel=this.pc.createDataChannel("apiRTCDataChannel",{}),this.sendDataChannel.binaryType="arraybuffer",T.log("Created data channel"),T.log("Subscribing to dc events"),this.sendDataChannel.onopen=this.callback(this,"onSendDataChannelOpen"),this.sendDataChannel.onclose=this.callback(this,"onSendDataChannelClose"),this.sendDataChannel.onmessage=this.callback(this,"onSendDataChannelMessage"),this.sendDataChannel.onerror=this.callback(this,"onSendDataChannelError")}catch(M){T.log("createDataChannel() failed with exception: "+M.message)}else T.log("Datachannel already exist")},this.createPeerConnection=function(){T.info("createPeerConnection");try{T.log("createPeerConnection with pc_config:",JSON.stringify(this.pc_config)),T.log("and pc_constraints:",JSON.stringify(this.pc_constraints)),"chrome"===d.wL.type&&d.wL.version>=72&&d.wL.version<78?(T.debug("Chrome 72=+ and 78-, force sdpSemantics plan-b"),this.pc_config.sdpSemantics="plan-b"):"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc?(T.debug("Cordova, force sdpSemantics plan-b"),this.pc_config.sdpSemantics="plan-b"):T.debug("sdpSemantics unified-plan is being used"),this.pc=new apiCC.myWebRTC_Adapter.RTCPeerConnection(this.pc_config,this.pc_constraints),this.dataCall&&this.createDataChannel(),this.pc.onicecandidate=this.callback(this,"onIceCandidate")}catch(M){return T.log("Failed to create PeerConnection, exception: "+M.message),void T.error("Cannot create RTCPeerConnection object; WebRTC is not supported by this browser.")}"Firefox"===c.Xh&&c.PR>=53||"Edge"===c.Xh||"chrome"===d.wL.type&&d.wL.version>=64?(this.pc.ontrack=this.callback(this,"onRemoteTrackAdded"),this.pc.onaddstream=this.callback(this,"onRemoteStreamAdded")):"Safari"===c.Xh&&c.PR>=12||"Mobile Safari"===c.Xh&&c.PR>=12?this.pc.ontrack=this.callback(this,"onRemoteTrackAdded"):this.pc.onaddstream=this.callback(this,"onRemoteStreamAdded"),this.pc.onremovestream=this.callback(this,"onRemoteStreamRemoved"),this.pc.onnegotiationneeded=this.callback(this,"onNegotiationNeeded"),this.pc.onsignalingstatechange=this.callback(this,"onSignalingStateChange"),this.pc.oniceconnectionstatechange=this.callback(this,"onIceConnectionStateChange"),this.pc.ondatachannel=this.callback(this,"onDataChannel"),this.pc.onicegatheringstatechange=this.callback(this,"onIceGatheringStateChange"),this.pc.onconnectionstatechange=this.callback(this,"onConnectionStateChange"),z.qosEnable&&(this.statisticId=setInterval(this.callback(this,"getStatistics"),this.getStatsInterval)),z.csmEnable&&(this.csmLastResults={},this.csmIntervalId=setInterval(this.callback(this,"csmHandler"),this.csmIntervalMs))},this.onIceGatheringStateChange=function(M){T.log("onIceGatheringStateChange"),null!==this.pc&&(T.info("onIceGatheringStateChange, Ice Gathering State is now : "+this.pc.iceGatheringState),"complete"===this.pc.iceGatheringState&&0===this.candidateNb&&T.warn("Warning, no candidate where retrieved for this call on client"))},this.onConnectionStateChange=function(M){T.log("onConnectionStateChange event :",M)},this.onDataChannel=function(M){T.info("onDataChannel event"),this.receiveDataChannel=M.channel,this.receiveDataChannel.binaryType="arraybuffer",null===this.sendDataChannel&&(T.log("Setting this.sendDataChannel with receivedDataChannel"),this.sendDataChannel=M.channel,this.sendDataChannel.onopen=this.callback(this,"onSendDataChannelOpen"),this.sendDataChannel.onclose=this.callback(this,"onSendDataChannelClose"),this.sendDataChannel.onmessage=this.callback(this,"onSendDataChannelMessage"),this.sendDataChannel.onerror=this.callback(this,"onSendDataChannelError")),T.log("got dataChannel",M.channel.label),T.log("Subscribing to dc events"),this.receiveDataChannel.onopen=this.callback(this,"onReceiveDataChannelOpen"),this.receiveDataChannel.onclose=this.callback(this,"onReceiveDataChannelClose"),this.receiveDataChannel.onmessage=this.callback(this,"onReceiveDataChannelMessage"),this.receiveDataChannel.onerror=this.callback(this,"onReceiveDataChannelError")},this.onSendDataChannelOpen=function(M){T.info("onSendDataChannelOpen"),"data"===this.callType&&"dataChannelConnector"===this.calleeId&&(this.pushDataStatus&&"pipeline"===this.pushDataStatus.type?(this.pushDataStatus.state="ready",setTimeout(function(){z.startNextPushData()})):!0!==this.transferStarted&&this.startTransfer()),b.createEvent({eventType:"sendDataChannelOpen",callId:this.callId,remoteId:this.remoteId,details:M})},this.onSendDataChannelClose=function(M){T.info("onSendDataChannelClose"),this.sendDataChannel=null,null!==b&&b.createEvent({eventType:"sendDataChannelClose",callId:this.callId,remoteId:this.remoteId,details:M})},this.processOnDataChannelMessage=function(M){var t,u,h=null,y=null,a="",m=0;if(T.info("processOnDataChannelMessage"),h=JSON.parse(M.data),T.log("data.uuid :"+h.uuid),T.log("data.messageSize :"+h.messageSize),T.log("data.originalDataType :"+h.originalDataType),t=h.uuid,"ArrayBuffer"===h.originalDataType&&(T.log("ArrayBuffer conversion"),h.message=d.cw.decode(h.message)),T.log("data :"+h),T.log("data.uuid :"+t),T.log("receiveChunkNb[uuid] :"+this.receiveChunkNb[t]),void 0===this.receiveChunkNb[t])T.log("receiving first packet for uuid :"+t),T.log("evt.data.message :"+M.data),this.firstDataPacket[t]=h,this.receiveChunkNb[t]=1,this.receivedSize[t]=0,this.startingDate=new Date,this.transferDuration=0,b.createEvent({eventType:"onFileReceiving",remoteId:this.remoteId,callId:this.callId,name:h.name,uuid:t}),b.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:this.firstDataPacket[t].size,callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:0,transferEnded:!1});else if(T.log("new packet for uuid :"+t),this.receiveChunkNb[t]+=1,T.log("data.messageSize :"+h.messageSize),T.log("data.message.length :"+h.message.length),T.log("receivedSize :"+(m=h.messageSize||h.message.length)),this.receiveArrayToStoreChunks[t]||(this.receiveArrayToStoreChunks[t]=[]),this.receiveArrayToStoreChunks[t].push(h.message),this.receivedSize[t]+=m,this.transferDuration=new Date-this.startingDate,this.receivedSize[t]===this.firstDataPacket[t].size){if(T.log("End of data transfert"),T.log("this.firstDataPacket.type :"+this.firstDataPacket[t].type),"image/png-dataUrl"===this.firstDataPacket[t].type){for(T.log("Photo received from a takeSnapshot"),u=0;u<this.receiveArrayToStoreChunks[t].length;u+=1)a+=this.receiveArrayToStoreChunks[t][u];y=a}else y=new window.Blob(this.receiveArrayToStoreChunks[t]);b.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:0,callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:100,transferEnded:!0}),b.createEvent({eventType:"onFileReceived",callId:this.callId,uuid:t,remoteId:this.remoteId,callerId:this.callerId,calleeId:this.calleeId,data:{file:y,name:this.firstDataPacket[t].name,type:this.firstDataPacket[t].type,uuid:t},details:M}),delete this.receiveArrayToStoreChunks[t],delete this.receivedSize[t],delete this.receiveChunkNb[t],delete this.firstDataPacket[t]}else b.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:this.firstDataPacket[t].size-this.receivedSize[t],callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*this.receivedSize[t]/this.firstDataPacket[t].size,10),transferEnded:!1})},this.onSendDataChannelMessage=function(M){T.info("onSendDataChannelMessage :",M),this.processOnDataChannelMessage(M)},this.onSendDataChannelError=function(M){T.info("onSendDataChannelError"),this.sendDataChannel=null,b.createEvent({eventType:"sendDataChannelError",callId:this.callId,remoteId:this.remoteId,details:M})},this.onReceiveDataChannelOpen=function(M){T.info("onReceiveChannelOpen"),b.createEvent({eventType:"receiveDataChannelOpen",callId:this.callId,remoteId:this.remoteId,details:M})},this.onReceiveDataChannelClose=function(M){T.info("onReceiveDataChannelClose"),this.receiveDataChannel=null,null!==b&&b.createEvent({eventType:"receiveDataChannelClose",callId:this.callId,remoteId:this.remoteId,details:M})},this.onReceiveDataChannelMessage=function(M){T.info("onReceiveChannelMessage"),this.processOnDataChannelMessage(M)},this.onReceiveDataChannelError=function(M){T.info("onReceiveChannelError"),b.createEvent({eventType:"receiveDataChannelError",callId:this.callId,remoteId:this.remoteId,details:M})},this.startTransfer=function(){var M=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=t.hasOwnProperty("delay")?t.delay:100;!0!==this.transferStarted&&(T.info("startTransfer",u),this.transferStarted=!0,setTimeout(function(){M.dcfs||(M.dcfs=new I(M),M.dcfs.transfer(M.fileContent.buffer,M.data.offset>0?M.data.offset:0,M.sendDataChannel,{delay:u}))},u))},this.statisticsAnswer=function(M){var t=M.result(),u=null;this.qm||(this.qm=new R(this.getStatsInterval/1e3,this.callback(this,"onQosChange"),this.callback(this,"onQosAudioChange"),this.callback(this,"onQosVideoChange"),this.callId,z.apiKey,z.clientId,z.socket)),t&&(this.qm.insertStats(t,this.sendedSdpOfferMessage,this.receivedSdpOfferMessage,z.remoteVideo),u=this.qm.getAllStats(),z.qosEnable&&b.createEvent({eventType:"onQosStatsUpdate",callId:this.callId,remoteId:this.remoteId,stats:u}),this.videoReceivedWidth=u.VideoRecv.FrameWidth,this.videoReceivedHeight=u.VideoRecv.FrameHeight,this.videoSendWidth=u.VideoSend.FrameWidth,this.videoSendHeight=u.VideoSend.FrameHeight,this.videoReceivedDelay=u.VideoRecv.delay,this.audioReceivedDelay=u.AudioRecv.delay,this.audioSendDelay=u.AudioSend.rtt,this.videoSendDelay=u.VideoSend.rtt,this.videoSendMoyDelay=u.VideoSend.moyRtt,this.videoSendPacketLossRatio=u.VideoSend.packetLostRatio,this.audioSendPacketLossRatio=u.AudioSend.packetLostRatio,this.videoSendEncodeUsagePercent=u.VideoSend.googEncodeUsagePercent,this.videoSendCpuLimitedResolution=u.VideoSend.googCpuLimitedResolution,this.videoSendBandwidthLimitedResolution=u.VideoSend.googBandwidthLimitedResolution,void 0!==this.videoSendCpuLimitedResolution&&!0===JSON.parse(this.videoSendCpuLimitedResolution)&&b.createEvent({eventType:"cpuLimited",callId:this.callId,encodeUsagePercent:this.videoSendEncodeUsagePercent}),void 0!==this.videoSendBandwidthLimitedResolution&&!0===JSON.parse(this.videoSendBandwidthLimitedResolution)&&b.createEvent({eventType:"bandwidthLimited",callId:this.callId}))},this.csmGetStatsHandler=function(M){var t,u=this,h=null,y=null,a={};if(this.csm||(this.csm=new l(this.csmIntervalMs/1e3,d.wL.type,d.wL.version,"standard"),this.csm.browserInfo={browserAbout:c.Xh+" "+c.dc,browserType:d.wL.type,browserVersion:d.wL.version},(0,d.Ym)(this.mcuRemoteStream,"attributes","object")&&(!0===this.mcuRemoteStream.replay?(0,d.Ym)(this.mcuRemoteStream.attributes.callerId,"string")&&(0,d.Ym)(this.mcuRemoteStream.attributes.callId,"string")&&(0,d.Ym)(this.mcuRemoteStream.attributes.recId,"string")&&(this.csm.callFeed={clientId:this.mcuRemoteStream.attributes.callerId,callId:this.mcuRemoteStream.attributes.callId,modifier:"replay",recId:this.mcuRemoteStream.attributes.recId}):(0,d.Ym)(this.mcuRemoteStream.attributes.callerId,"string")&&(0,d.Ym)(this.mcuRemoteStream.attributes.callId,"string")&&(this.csm.callFeed={clientId:this.mcuRemoteStream.attributes.callerId,callId:this.mcuRemoteStream.attributes.callId}))),a.post=function(_){u.mos||(u.mos=new V),_.quality={},_.audioReceived?u.isRemoteAudioMuted?_.quality.mosS="Muted":0!==_.audioReceived.bitsReceivedPerSecond?(_.audioReceived.delay=parseInt(u.audioReceivedDelay,10),_.quality.mosS=u.mos.NarrowBandSpeechQuality(_.audioReceived.delay,_.audioReceived.packetLossRatio)):_.quality.mosS="NoStream":_.quality.mosS="NoStream",_.videoReceived?u.isRemoteVideoMuted?_.quality.mosV="Muted":0!==_.videoReceived.bitsReceivedPerSecond?(_.videoReceived.width=u.videoReceivedWidth,_.videoReceived.height=u.videoReceivedHeight,_.videoReceived.delay=parseInt(u.videoReceivedDelay,10),_.quality.mosV=u.mos.videoQuality(_.videoReceived.width,_.videoReceived.height,_.videoReceived.packetLossRatio,Math.floor(_.videoReceived.bitsReceivedPerSecond/1e3),_.videoReceived.framesDecodedPerSecond)):_.quality.mosV="NoStream":_.quality.mosV="NoStream",_.audioReceived&&_.videoReceived&&(_.quality.mosAV=u.mos.audiovisualQuality(_.quality.mosS,_.quality.mosV,_.audioReceived.delay,_.videoReceived.delay)),_.audioSent?u.isLocalAudioMuted?_.quality.mosSS="Muted":0!==_.audioSent.bitsSentPerSecond?(_.audioSent.delay=parseInt(u.audioSendDelay,10),_.audioSent.packetLossRatio=u.audioSendPacketLossRatio,_.quality.mosSS=u.mos.NarrowBandSpeechQuality(_.audioSent.delay,_.audioSent.packetLossRatio)):_.quality.mosSS="NoStream":_.quality.mosSS="NoStream",_.videoSent?u.isLocalVideoMuted?_.quality.mosSV="Muted":0!==_.videoSent.bitsSentPerSecond?(_.videoSent.width=u.videoSendWidth,_.videoSent.height=u.videoSendHeight,_.videoSent.delay=parseInt(u.videoSendDelay,10),_.videoSent.moyDelay=parseInt(u.videoSendMoyDelay,10),_.videoSent.packetLossRatio=u.videoSendPacketLossRatio,_.videoSent.encodeUsagePercent=u.videoSendEncodeUsagePercent,_.videoSent.cpuLimitedResolution=u.videoSendCpuLimitedResolution,_.videoSent.bandwidthLimitedResolution=u.videoSendBandwidthLimitedResolution,_.quality.mosSV=u.mos.videoQuality(_.videoSent.width,_.videoSent.height,_.videoSent.packetLossRatio,Math.floor(_.videoSent.bitsSentPerSecond/1e3),_.videoSent.framesEncodedPerSecond)):_.quality.mosSV="NoStream":_.quality.mosSV="NoStream",_.audioSent&&_.videoSent&&(_.quality.mosSAV=u.mos.audiovisualQuality(_.quality.mosSS,_.quality.mosSV,_.audioSent.delay,_.videoSent.delay))},t=this.csm.addCallStats(M,a),0!==Object.keys(t).length){!t.quality||"Muted"===t.quality.mosS&&"Muted"===t.quality.mosV&&"Muted"===t.quality.mosSS&&"Muted"===t.quality.mosSV||z.qualityScoreEnable&&b.createEvent({eventType:"onCallScoreUpdate",callId:this.callId,score:t.quality}),this.csmLastResults=t,this.callLocalStream&&"function"==typeof this.callLocalStream.getVideoTracks&&(h=this.callLocalStream.getVideoTracks())&&h[0]&&"function"==typeof h[0].getSettings&&(y=h[0].getSettings());var m={save:!0,clientId:z.clientId,callId:this.callId,instanceId:this.instanceId,browserInfo:this.csm.browserInfo,stats:t};this.sessionMCU&&(m.roomId=this.sessionMCU.roomName,m.pubSub=z.MCUClient.pubConnector),this.csm.callFeed&&(m.callFeed=this.csm.callFeed),y&&(m.videoSettings=y),this.data.mesh&&(m.mesh=this.data.mesh),this.myWebRTC_Stack.sendInfo("callStats",m),z.csmEnable&&b.createEvent(this.data&&this.data.mesh&&(this.data.mesh.calleeCompositeUserId?this.data.mesh.calleeCompositeUserId===z.compositeClientId:this.data.mesh.calleeId===z.clientId)?{eventType:"onCallStatsUpdate",callId:this.data.mesh.calleeCallId,userId:this.data.mesh.callerId,stats:t}:{eventType:"onCallStatsUpdate",callId:this.callId,stats:t})}},this.onQosChange=function(M,t){b.createEvent({eventType:"onQosChange",callId:this.callId,remoteId:this.remoteId,qosIn:M,qosOut:t})},this.onQosAudioChange=function(M,t){b.createEvent({eventType:"onQosAudioChange",callId:this.callId,remoteId:this.remoteId,qosAudioIn:M,qosAudioOut:t})},this.onQosVideoChange=function(M,t){b.createEvent({eventType:"onQosVideoChange",callId:this.callId,remoteId:this.remoteId,qosVideoIn:M,qosVideoOut:t})},this.getStatistics=function(){this.pc&&this.pc.getStats&&"Firefox"!==c.Xh&&this.pc.getStats(this.callback(this,"statisticsAnswer"))},this.csmHandler=function(){this.statisticId||this.getStatistics(),this.pc&&"function"==typeof this.pc.getStats&&this.pc.getStats(null).then(this.callback(this,"csmGetStatsHandler")).catch(function(M){T.warn("failed to get stats",M)})},this.doCall=function(){var M=null;T.log("Sending offer to peer"),this.audioOnly?(T.log("audioOnly call :",this.mediaConstraintsAudioOnly),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):(T.log("createOffer - Promise version"),this.pc.createOffer(this.mediaConstraintsAudioOnly).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):!0===this.screenSharing?(T.log("screenSharing call : one way media :",M),M={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),M)):(T.log("createOffer - Promise version"),this.pc.createOffer(M).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):!0===this.dataCall?(T.log("call is data only :",M),M="Firefox"===c.Xh&&c.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),M)):(T.log("createOffer - Promise version"),this.pc.createOffer(M).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):(T.log("call is audio & video :",this.mediaConstraints),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)):(T.log("createOffer - Promise version"),this.pc.createOffer(this.mediaConstraints).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure"))))},this.doAnswer=function(){T.info("doAnswer");var M=null;this.audioOnly?(T.log("audioOnly call"),M=this.mediaConstraintsAudioOnly):M=this.mediaConstraints,"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createAnswer"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessage"),this.callback(this,"onCreateAnswerFailure"),M)):(T.log("createAnswer - Promise version"),this.pc.createAnswer(M).then(this.callback(this,"setLocalAndSendMessage")).catch(this.callback(this,"onCreateAnswerFailure")))},this.doUpdateAnswer=function(){T.info("doUpdateAnswer");var M=null;this.audioOnly?(T.log("audioOnly call"),M=this.mediaConstraintsAudioOnly):M=this.mediaConstraints,"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createAnswer"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessageUpdate"),this.callback(this,"onCreateAnswerFailure"),M)):(T.log("createAnswer - Promise version"),this.pc.createAnswer(M).then(this.callback(this,"setLocalAndSendMessageUpdate")).catch(this.callback(this,"onCreateAnswerFailure")))},this.updateMediaWithRetryManagement=function(M){T.debug("updateMediaWithRetryManagement");var t=this.updateMedia(M);T.debug("updateMediaResult :",t),"Sig_state_not_stable"!==t.reason&&"Update_already_ongoing"!==t.reason||(T.debug("updateMedia will be retried later for reason :",t.reason),this.retryUpdateMedia=!0)},this.updateMedia=function(M){return T.debug("updateMedia, callId :",this.callId),T.log("iceRestartActivated :",M),null===this.pc?(T.log("updateMedia, pc no more exist"),{status:"Not_Done",reason:"PC_Not_Exit"}):!0===this.updateMediaOngoing?(T.log("updateMedia, already ongoing"),{status:"Not_Done",reason:"Update_already_ongoing"}):(this.updateMediaOngoing=!0,"stable"!==this.pc.signalingState?{status:"Not_Done",reason:"Sig_state_not_stable"}:(T.log("Sending Update offer to peer."),this.audioOnly?(T.log("audioOnly call :",this.mediaConstraintsAudioOnly),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),void 0!==this.mediaConstraintsAudioOnly.mandatory?this.mediaConstraintsAudioOnly.mandatory.IceRestart=!0:this.mediaConstraintsAudioOnly.iceRestart=!0,T.log("this.mediaConstraints :",this.mediaConstraintsAudioOnly),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):(T.log("createOffer - Promise version"),!0===M&&(this.mediaConstraintsAudioOnly.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraintsAudioOnly),this.pc.createOffer(this.mediaConstraintsAudioOnly).then(this.callback(this,"setLocalAndSendMessageonOfferUpdate")).catch(this.callback(this,"onCreateOfferFailure")))):"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("createOffer"),!0===M&&(void 0!==this.mediaConstraints.mandatory?this.mediaConstraints.mandatory.IceRestart=!0:this.mediaConstraints.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraints),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)):(T.log("createOffer - Promise version"),!0===M&&(this.mediaConstraints.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraints),this.pc.createOffer(this.mediaConstraints).then(this.callback(this,"setLocalAndSendMessageonOfferUpdate")).catch(this.callback(this,"onCreateOfferFailure"))),{status:"OnGoing",reason:"OK"}))},this.manipulateSDP=function(M,t){var u=null,h=!1;return T.log("manipulateSDP with type :",t),!0===z.receiveMediaDeactivated&&(T.log("setting receiveMediaDeactivated in SDP :"+z.receiveMediaDeactivated),M.sdp=z.mySDPManager.setSendOnly(M.sdp)),!0===z.RTPMedia&&(M.sdp=M.sdp.replace(/RTP\/SAVPF/g,"RTP/SF")),null!==z.audioBandwidth&&(T.log("setting audioBandwidth in SDP :"+z.audioBandwidth),M.sdp=z.mySDPManager.setAudioBandwidth(M.sdp,z.audioBandwidth)),null!==z.videoBandwidth&&(T.log("setting videoBandwidth in SDP :"+z.videoBandwidth),M.sdp=z.mySDPManager.setVideoBandwidth(M.sdp,z.videoBandwidth)),null!==z.dataBandwidth&&(T.log("setting dataBandwidth in SDP :"+z.dataBandwidth),M.sdp=z.mySDPManager.setDataBandwidth(M.sdp,z.dataBandwidth)),!0===z.preferOpusCodec&&(T.log("setting preferOpusCodec"),M.sdp=z.mySDPManager.preferOpus(M.sdp)),!0!==z.preferVP9Codec&&!0!==this.preferVP9Codec||(T.log("Call prefer VP9 Codec"),M.sdp=z.mySDPManager.maybePreferCodec(M.sdp,"video","VP9")),!0!==z.preferH264Codec&&!0!==this.preferH264Codec||(T.log("Call prefer H264 Codec"),M.sdp=z.mySDPManager.maybePreferCodec(M.sdp,"video","H264")),!0===this.preferVP8Codec&&(T.log("Call prefer VP8 Codec"),M.sdp=z.mySDPManager.maybePreferCodec(M.sdp,"video","VP8")),!0===z.setStereo&&(T.log("Set Stereo"),M.sdp=z.mySDPManager.setCodecParam(M.sdp,"opus/48000","stereo","1")),M=z.mySDPManager.updateSDPcodecs(M,M.type,"audio",z.allowedAudioCodecs),M=z.mySDPManager.updateSDPcodecs(M,M.type,"video",z.allowedVideoCodecs),"OFFER"===t?"publish"===this.settingUpType&&"NONE"===this.mediaTypeForIncomingCall?(u=z.mySDPManager.createGuideline(M.sdp),"VIDEO"===this.mediaTypeForOutgoingCall?((0,d.ki)(u,"audio","object")&&"sendonly"!==u.audio.direction&&(u.audio.direction="sendonly",h=!0),(0,d.ki)(u,"video","object")&&"sendonly"!==u.video.direction&&(u.video.direction="sendonly",h=!0)):"AUDIO"===this.mediaTypeForOutgoingCall?((0,d.ki)(u,"audio","object")&&"sendonly"!==u.audio.direction&&(u.audio.direction="sendonly",h=!0),(0,d.ki)(u,"video","object")&&"inactive"!==u.video.direction&&(u.video.direction="inactive",h=!0)):"VIDEOONLY"===this.mediaTypeForOutgoingCall&&((0,d.ki)(u,"audio","object")&&"inactive"!==u.audio.direction&&(u.audio.direction="inactive",h=!0),(0,d.ki)(u,"video","object")&&"sendonly"!==u.video.direction&&(u.video.direction="sendonly",h=!0)),!0===h&&(M.sdp=u.generate())):"VIDEO"===this.mediaTypeForOutgoingCall?T.log("mediaTypeForOutgoingCall is VIDEO"):"AUDIO"===this.mediaTypeForOutgoingCall||!0===this.audioOnly?(T.log("mediaTypeForOutgoingCall is AUDIO"),M.sdp=z.mySDPManager.setRecvOnlyForVideo(M.sdp)):"VIDEOONLY"===this.mediaTypeForOutgoingCall?(T.log("mediaTypeForOutgoingCall is VIDEOONLY"),M.sdp=z.mySDPManager.setRecvOnlyForAudio(M.sdp)):"NONE"===this.mediaTypeForOutgoingCall&&(T.log("mediaTypeForOutgoingCall is NONE"),M.sdp=z.mySDPManager.setRecvOnly(M.sdp)):"ANSWER"===t&&("VIDEO"===this.mediaTypeForIncomingCall?T.log("mediaTypeForIncomingCall is VIDEO"):"AUDIO"===this.mediaTypeForIncomingCall||!0===this.audioOnly?(T.log("mediaTypeForIncomingCall is AUDIO"),M.sdp=z.mySDPManager.setRecvOnlyForVideo(M.sdp)):"VIDEOONLY"===this.mediaTypeForIncomingCall?(T.log("mediaTypeForIncomingCall is VIDEOONLY"),M.sdp=z.mySDPManager.setRecvOnlyForAudio(M.sdp)):"NONE"===this.mediaTypeForIncomingCall&&(T.log("mediaTypeForIncomingCall is NONE"),M.sdp=z.mySDPManager.setRecvOnly(M.sdp))),"SDP"===this.simulcast&&"OFFER"===t&&"publish"===this.settingUpType&&((u=z.mySDPManager.createGuideline(M.sdp)).mungeForSimulcasting(),M.sdp=u.generate()),M},this.setLocalAndSendMessageonOffer=function(M){T.info("setLocalAndSendMessageonOffer"),T.log("sessionDescription = ",M),T.log("sessionDescription.sdp = ",M.sdp);var t=null;M.sdp=this.manipulateSDP(M,"OFFER").sdp,T.log("manipulated sessionDescription.sdp = ",M.sdp),!0===this.stripAudioSDPActivated&&(M.sdp=z.mySDPManager.stripAudioMediaDescriptionFromSDP(M.sdp)),!0===this.stripVideoSDPActivated&&(M.sdp=z.mySDPManager.stripVideoMediaDescriptionFromSDP(M.sdp)),this.setLocalCallProfile(z.evalCallProfileWithSdp(M.sdp,"local","send")),this.sendedSdpOfferMessage=M,!0===this.dataCall&&(T.log("setLocalAndSendMessageonOffer : data Call"),this.callType="data"),!1===this.callCancelled?!1===z.NtoNConf?(T.log("Conf N to 1"),!0===this.screenSharing&&(t=z.mySDPManager.getAudioMediaDescriptionPart(this.sendedSdpOfferMessage.sdp),this.callType=null!=t?"screenSharingWithAudio":"screenSharing"),!0===this.trickleIce&&(this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,z.nickname,this.dest_roomId,this.dest_roomId,M,this.callType,this.data,this.mcuRemoteStream),this.inviteSended=!0),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessageonOffer : before setLocalDescription"),this.pc.setLocalDescription(this.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOffer : before setLocalDescription - Promise version"),this.pc.setLocalDescription(this.sendedSdpOfferMessage).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure")))):(T.log("Conf N to N"),this.myWebRTC_Stack.sendInviteBroadcast(this.callId,this.callerId,z.nickname,this.dest_roomId,this.dest_roomId,M),this.inviteSended=!0):(T.warn("Invite is not sent has call has been canceled"),z.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"Call_Cancelled"),0===z.callsTable.length&&(T.log("No more established calls for client"),z.initMediaElementState(),z.displayCallButtonInCommand()))},this.setLocalAndSendMessageonOfferUpdate=function(M){var u=null;T.info("setLocalAndSendMessageonOfferUpdate, sessionDescription :"+M),this.sendedSdpOfferMessage=M,T.log("sessionDescription.sdp = ",M.sdp),((0,d.Ym)(this.audioSdpDirection,"string")||(0,d.Ym)(this.videoSdpDirection,"string"))&&(u=z.mySDPManager.createGuideline(M.sdp),(0,d.ki)(u,"audio","object")&&(0,d.Ym)(this.audioSdpDirection,"string")&&(u.audio.direction=this.audioSdpDirection),(0,d.ki)(u,"video","object")&&(0,d.Ym)(this.videoSdpDirection,"string")&&(u.video.direction=this.videoSdpDirection),M.sdp=u.generate()),this.setLocalCallProfile(z.evalCallProfileWithSdp(M.sdp,"local","send"),!0),!0===this.trickleIce?(this.myWebRTC_Stack.sendUpdate(this.callId,this.callerId,this.calleeId,this.dest_roomId,this.callee?this.callerId:this.calleeId,M,this.callType,this.data),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription"),this.pc.setLocalDescription(M,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(M).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure")))):(T.log("Updating PC offer and answer after switch Stream"),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription"),this.pc.setLocalDescription(M,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(M).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),z.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),this.pc.remoteDescription.sdp=z.mySDPManager.maybePreferCodec(this.pc.remoteDescription.sdp,"video","H264")),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setRemoteDescription"),this.pc.setRemoteDescription(this.pc.remoteDescription,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setRemoteDescription - Promise version"),this.pc.setRemoteDescription(this.pc.remoteDescription).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure"))))},this.onCreateOfferFailure=function(M){T.info("onCreateOfferFailure"+M),M=null},this.onCreateAnswerFailure=function(M){T.info("onCreateAnswerFailure"+M),M=null},this.setLocalAndSendMessage=function(M){var t;T.info("setLocalAndSendMessage"),T.log("sessionDescription.sdp = ",M.sdp),null!==this.pc?(M=this.manipulateSDP(M,"ANSWER"),t=z.mySDPManager.createGuideline(M.sdp),this.setLocalCallProfile(z.evalCallProfileWithSdpGuideline(t,M.sdp,"local","send")),this.setRemoteCallProfile(z.evalCallProfileWithSdpGuideline(t,M.sdp,"local","receive")),T.log("manipulated sessionDescription.sdp = ",M.sdp),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessage : before setLocalDescription"),this.pc.setLocalDescription(M,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessage : before setLocalDescription - Promise version"),this.pc.setLocalDescription(M).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),this.sendedSdpOfferMessage=M,!0===this.trickleIce&&this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,z.nickname,this.dest_roomId,M,this.data)):T.log("setLocalAndSendMessage, pc no more exist")},this.setLocalAndSendMessageUpdate=function(M){var t;null!==this.pc?("safari"===d.wL.type&&(M.sdp=this.manipulateSDP(M,"OFFER").sdp),t=z.mySDPManager.createGuideline(M.sdp),"AUDIOONLY"===this.mediaType?t.hasOwnProperty("video")&&"inactive"!==t.video.direction&&(T.debug("Only audio was requested at call setup: deactivating video"),t.video.direction="inactive",M.sdp=t.generate()):"VIDEOONLY"===this.mediaType&&t.hasOwnProperty("audio")&&"inactive"!==t.audio.direction&&(T.debug("Only video was requested at call setup: deactivating audio"),t.audio.direction="inactive",M.sdp=t.generate()),this.setLocalCallProfile(z.evalCallProfileWithSdpGuideline(t,M.sdp,"local","send"),!0),this.setRemoteCallProfile(z.evalCallProfileWithSdpGuideline(t,M.sdp,"local","receive"),!0),this.updateOngoingTimeoutId&&(clearTimeout(this.updateOngoingTimeoutId),delete this.updateOngoingTimeoutId),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh?(T.log("setLocalAndSendMessageUpdate : before setLocalDescription"),this.pc.setLocalDescription(M,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(M).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),this.myWebRTC_Stack.send200Update(this.callId,this.callerId,this.calleeId,this.dest_roomId,this.callee?this.callerId:this.calleeId,M,this.data),this.asyncCallbacks&&"updateMediaType"===this.asyncCallbacks.type&&(T.debug("asyncCallbacks resolve"),this.asyncCallbacks.resolve(),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks)):T.log("setLocalAndSendMessageUpdate, pc no more exist")},this.onIceCandidate=function(M){try{T.debug("onIceCandidate :",JSON.stringify(M.candidate))}catch(y){T.error(y)}var t,u=0,h=0;t=this.callee?this.callerId:this.calleeId,null!==this.pc&&(T.debug("Ice Connection State is now : "+this.pc.iceConnectionState),T.debug("Ice Gathering State is now : "+this.pc.iceGatheringState)),M.candidate?(this.candidateNb+=1,!0===this.trickleIce?this.mediaRoutingMode===z.mediaRoutingModeEnum.hostOnly?-1!==(u=M.candidate.candidate.search("host"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,M.candidate.sdpMLineIndex,M.candidate.sdpMid,M.candidate.candidate,this.data,M.candidate):T.log("Media routing mode is hostOnly and not a HOST Candidate : ignoring message"):this.mediaRoutingMode===z.mediaRoutingModeEnum.stun?(u=M.candidate.candidate.search("host"),h=M.candidate.candidate.search("srflx"),-1!==u||-1!==h?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,M.candidate.sdpMLineIndex,M.candidate.sdpMid,M.candidate.candidate,this.data,M.candidate):T.log("Media routing mode is stun and not a HOST or SRFLX Candidate : ignoring message")):this.mediaRoutingMode===z.mediaRoutingModeEnum.stunOnly?-1!==(u=M.candidate.candidate.search("srflx"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,M.candidate.sdpMLineIndex,M.candidate.sdpMid,M.candidate.candidate,this.data,M.candidate):T.log("Media routing mode is stunOnly and not a SRFLX Candidate : ignoring message"):this.mediaRoutingMode===z.mediaRoutingModeEnum.turn?(T.log("Media routing mode is turn : all candidates are considered"),this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,M.candidate.sdpMLineIndex,M.candidate.sdpMid,M.candidate.candidate,this.data,M.candidate)):this.mediaRoutingMode===z.mediaRoutingModeEnum.turnOnly&&(-1!==(u=M.candidate.candidate.search("relay"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,M.candidate.sdpMLineIndex,M.candidate.sdpMid,M.candidate.candidate,this.data,M.candidate):T.log("Media routing mode is TurnOnly and not a RELAY Candidate : ignoring message")):T.log("trickleIce is deactivated : candidates are not sended")):(T.info("End of candidates."),!1===this.trickleIce&&(T.log("trickleIce === false"),!0===this.callee?(0!==this.send200OKTrickleIceFalseTimeOutId&&(clearTimeout(this.send200OKTrickleIceFalseTimeOutId),this.send200OKTrickleIceFalseTimeOutId=0),!1===this.message200OKSended?this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,z.nickname,this.dest_roomId,this.pc.localDescription,this.data):T.log("200OK already sended")):null!==this.pc&&(0!==this.sendInviteTrickleIceFalseTimeOutId&&(clearTimeout(this.sendInviteTrickleIceFalseTimeOutId),this.sendInviteTrickleIceFalseTimeOutId=0),!1===this.inviteSended?(T.log("sendInvite on end of candidate"),this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,z.nickname,this.dest_roomId,this.dest_roomId,this.pc.localDescription,this.callType,this.data,this.mcuRemoteStream),this.inviteSended=!0):T.log("Invite already sended"))))},this.combineRemoteStreams=function(M,t,u,h){var y=M.getTracks(),a=u.getTracks();if(1===y.length&&1===a.length&&("audio"===y[0].kind&&"video"===a[0].kind||"video"===y[0].kind&&"audio"===a[0].kind)){T.debug("combineRemoteStreams");var m=new MediaStream;return m.addTrack(y[0]),m.addTrack(a[0]),"internal"===h&&(u.removeTrack(a[0]),this.onRemoteStreamRemoved({stream:u})),"internal"===t&&(M.removeTrack(y[0]),this.onRemoteStreamRemoved({stream:M})),this.onRemoteStreamAdded({stream:m}),!0}return!1},this.checkRemoteStreamExists=function(M,t){var u=!1,h=null,y=null,a=null,m=null,_=null;for(t&&Array.isArray(t)&&(m=t.slice(0)),h=this.remoteMediaStreams.length;--h>=0;){if(this.remoteMediaStreams[h].id===M){u=!0;break}if(m)for(a=(y=this.remoteMediaStreams[h].getTracks()).length;--a>=0;)(_=t.indexOf(y[a].id))>=0&&(m[_]=!0)}if(!u&&m){for(_=0,a=m.length;--a>=0;)!0===m[a]&&(_+=1);_===m.length&&(u=!0)}return u},this.onRemoteStreamAdded=function(M){var t,u=null,h=0;T.info("onRemoteStreamAdded",M),this.checkRemoteStreamExists(M.stream.id,M.stream.getTracks().map(function(y){return y.id}))?T.debug("onRemoteStreamAdded: ignoring event; stream/track already known"):1===this.remoteMediaStreams.length&&this.combineRemoteStreams(this.remoteMediaStreams[0],"internal",M.stream,"event")||(T.debug("onRemoteStreamAdded adding",M.stream.id),this.remoteMediaStreams.push(M.stream),T.log("CallId is :"+this.callId),T.log("ClientId is :"+z.clientId),h=this.callee?this.callerId:this.calleeId,"undefined"==typeof apiRTC_React&&(!0===z.hideLocalVideoOnCall&&z.localVideo&&("Firefox"===c.Xh?""!==z.localVideo.mozSrcObject&&(z.localVideo.style.opacity=0):""!==z.localVideo.src&&(z.localVideo.style.opacity=0)),z.transitionToActive(),z.remoteVideo&&(z.remoteVideo.style.opacity=1),u=document.createElement("video"),z.remoteVideo&&(z.remoteVideo.appendChild(u),apiCC.attachMediaStream(u,M.stream),u.autoplay=!0,u.id="callId_"+this.callId+"-"+this.calleeId),u.oncanplay=z.myWebRTC_Event.createCanPlayRemoteVideoEvent(u.id,this.callType,h),z.remoteVideoDisplayManager()),this.sessionMCU&&"new"===this.sessionMCU.modeChangeKind&&z.processRemoteStreamAdded(this,M.stream),!0===this.screenSharing?this.callType="screenSharing":!0===this.audioOnly&&(this.callType="audio"),t={available:this.remoteCallProfile.audio,active:this.remoteCallProfile.audioActive,muted:this.isRemoteAudioMuted},u={available:this.remoteCallProfile.video,active:this.remoteCallProfile.videoActive,muted:this.isRemoteVideoMuted},null!==this.data?void 0!==this.data.mesh?z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.stream,this.remoteId,this.destCallType,t,u):"publish"===this.data.type&&"passive"!==this.data.mode?T.warn("Filtering Remote stream added event (behavior on Chrome 44), no remote stream on publish calls"):!0===this.data.subscribeOrder&&void 0!==this.data.pubCallId?(T.debug("substitute callId: "+this.callId+" -> "+this.data.pubCallId),z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.data.pubCallId,M.stream,this.remoteId,this.destCallType,t,u)):z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.stream,this.remoteId,this.destCallType,t,u):z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.stream,this.remoteId,this.destCallType,t,u))},this.onRemoteTrackAdded=function(M){T.info("onRemoteTrackAdded",M);var t,u=null,h=0;if(void 0!==M.streams[0]&&void 0!==M.track){if(this.checkRemoteStreamExists(M.streams[0].id,[M.track.id]))T.debug("onRemoteTrackAdded: ignoring event; stream/track already known");else if(1!==this.remoteMediaStreams.length||!this.combineRemoteStreams(this.remoteMediaStreams[0],"internal",M.streams[0],"event")){if(this.belongsToRoom()){if("audio"===this.callType&&"audio"!==M.track.kind||"videoOnly"===this.callType&&"video"!==M.track.kind||"media"===this.callType&&"video"!==M.track.kind||"screenSharing"===this.callType&&"video"!==M.track.kind||"screenSharingWithAudio"===this.callType&&"video"!==M.track.kind)return void T.debug("onRemoteTrackAdded: ignoring event; callType: "+this.callType+", event.track.kind: "+M.track.kind)}else if("audio"===this.destCallType&&"audio"!==M.track.kind||"videoOnly"===this.destCallType&&"video"!==M.track.kind||"media"===this.destCallType&&"video"!==M.track.kind||"screenSharing"===this.destCallType&&"video"!==M.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"!==M.track.kind)return T.debug("onRemoteTrackAdded: ignoring event; destCallType: "+this.destCallType+", event.track.kind: "+M.track.kind),void(2===this.remoteMediaStreams.length&&this.combineRemoveStreams(this.remoteMediaStreams[0],"internal",this.remoteMediaStreams[1],"internal"));T.debug("onRemoteTrackAdded adding; stream.id: "+M.streams[0].id),this.remoteMediaStreams.push(M.streams[0]),T.log("CallId is :"+this.callId),T.log("ClientId is :"+z.clientId),T.log("this.callType :"+this.callType),h=this.callee?this.callerId:this.calleeId,!0===z.hideLocalVideoOnCall&&z.localVideo&&("Firefox"===c.Xh?""!==z.localVideo.mozSrcObject&&(z.localVideo.style.opacity=0):""!==z.localVideo.src&&(z.localVideo.style.opacity=0)),z.transitionToActive(),z.remoteVideo&&(z.remoteVideo.style.opacity=1),u=document.createElement("video"),z.remoteVideo&&(z.remoteVideo.appendChild(u),apiCC.attachMediaStream(u,M.streams[0]),u.autoplay=!0,u.id="callId_"+this.callId+"-"+this.calleeId),!0===this.screenSharing?this.callType="screenSharing":!0===this.audioOnly&&(this.callType="audio"),u.oncanplay=z.myWebRTC_Event.createCanPlayRemoteVideoEvent(u.id,this.callType,h),z.remoteVideoDisplayManager(),this.sessionMCU&&"new"===this.sessionMCU.modeChangeKind&&z.processRemoteStreamAdded(this,M.streams[0]),M.streams[0].onaddtrack=function(y){T.debug("onRemoteTrackAdded ontrack.onaddtrack",y)},M.streams[0].onremovetrack=function(y){var a=null;if(T.debug("onRemoteTrackAdded ontrack.onremovetrack",y),this.updateOngoingTimeoutId)return T.debug("onRemoteTrackAdded onremovetrack: update ongoing"),void T.debug("onRemoteTrackAdded onremovetrack: ignoring event",y.track.kind);if("audio"===this.callType&&"audio"!==y.track.kind||"videoOnly"===this.callType&&"video"!==y.track.kind||"media"===this.callType&&"video"!==y.track.kind||"screenSharing"===this.callType&&"video"!==y.track.kind||"screenSharingWithAudio"===this.callType&&"video"!==y.track.kind)T.debug("onRemoteTrackAdded onremovetrack: ignoring event",y.track.kind);else if(y.target instanceof MediaStream){for(a=this.remoteMediaStreams.length;--a>=0;)if(this.remoteMediaStreams[a].id===y.target.id){T.debug("onRemoteTrackAdded onremovetrack removing",y.target.id),this.remoteMediaStreams.splice(a,1);break}z.myWebRTC_Event.createRemoteStreamRemovedEvent(this.callType,this.callId,y.target,this.remoteId,this.destCallType)}else T.debug("onRemoteTrackAdded onremovetrack: ignoring event target not MediaStream")}.bind(this),t={available:this.remoteCallProfile.audio,active:this.remoteCallProfile.audioActive,muted:this.isRemoteAudioMuted},u={available:this.remoteCallProfile.video,active:this.remoteCallProfile.videoActive,muted:this.isRemoteVideoMuted},null!==this.data?void 0!==this.data.mesh?("audio"===this.callType&&"audio"===M.track.kind||"videoOnly"===this.callType&&"video"===M.track.kind||"media"===this.callType&&"video"===M.track.kind||"screenSharing"===this.callType&&"video"===M.track.kind||"screenSharingWithAudio"===this.callType&&"video"===M.track.kind)&&z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.streams[0],this.remoteId,this.destCallType,t,u):"publish"===this.data.type&&"passive"!==this.data.mode?T.warn("Filtering Remote stream added event (behavior on Chrome 44), no remote stream on publish calls"):this.belongsToRoom()?("audio"===this.callType&&"audio"===M.track.kind||"videoOnly"===this.callType&&"video"===M.track.kind||"media"===this.callType&&"video"===M.track.kind||"screenSharing"===this.callType&&"video"===M.track.kind||"screenSharingWithAudio"===this.callType&&"video"===M.track.kind)&&(!0===this.data.subscribeOrder&&void 0!==this.data.pubCallId?(T.debug("substitute callId: "+this.callId+" -> "+this.data.pubCallId),z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.data.pubCallId,M.streams[0],this.remoteId,this.destCallType,t,u)):z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.streams[0],this.remoteId,this.destCallType,t,u)):("audio"===this.destCallType&&"audio"===M.track.kind||"videoOnly"===this.destCallType&&"video"===M.track.kind||"media"===this.destCallType&&"video"===M.track.kind||"screenSharing"===this.destCallType&&"video"===M.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"===M.track.kind)&&z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.streams[0],this.remoteId,this.destCallType,t,u):this.belongsToRoom()?("audio"===this.callType&&"audio"===M.track.kind||"videoOnly"===this.callType&&"video"===M.track.kind||"media"===this.callType&&"video"===M.track.kind||"screenSharing"===this.callType&&"video"===M.track.kind||"screenSharingWithAudio"===this.callType&&"video"===M.track.kind)&&z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.streams[0],this.remoteId,this.destCallType,t,u):("audio"===this.destCallType&&"audio"===M.track.kind||"videoOnly"===this.destCallType&&"video"===M.track.kind||"media"===this.destCallType&&"video"===M.track.kind||"screenSharing"===this.destCallType&&"video"===M.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"===M.track.kind)&&z.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,M.streams[0],this.remoteId,this.destCallType,t,u)}}else T.debug("onRemoteTrackAdded: ignoring event; event data are not correct")},this.onRemoteStreamRemoved=function(M){var t=null;for(T.info("onRemoteStreamRemoved",M),t=this.remoteMediaStreams.length;--t>=0;)if(this.remoteMediaStreams[t].id===M.stream.id){T.debug("onRemoteStreamRemoved removing",M.stream.id),this.remoteMediaStreams.splice(t,1);break}z.myWebRTC_Event.createRemoteStreamRemovedEvent(this.callType,this.callId,M.stream,this.remoteId,this.destCallType),M=null},this.onNegotiationNeeded=function(M){T.debug("onNegotiationNeeded",M),M=null,this.addingDataChannelOnCallOngoing&&(this.updateMediaWithRetryManagement(!1),this.addingDataChannelOnCallOngoing=!1)},this.onSignalingStateChange=function(M){T.debug("onSignalingStateChange",M),M=null},this.onCallDisconnection=function(){T.info("onCallDisconnection; callId: "+this.callId);var M=new Date;T.debug("date:",M),0!==this.disconnectionWarningInterval&&(T.debug("date:",M),T.debug("clearing disconnectionWarningInterval"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0),0!==this.disconnectionWarningTimeout&&(T.debug("date:",M),T.debug("clearing disconnectionWarningTimeout"),clearTimeout(this.disconnectionWarningTimeout),this.disconnectionWarningTimeout=0),this.belongsToRoom()?z.onHangup(this.callId,"disconnected"):z.onHangup(this.callId,"Ice_disconnected")},this.sendDisconnectionWarning=function(){T.log("sendDisconnectionWarning()");var M=null,t=null;if(this.callControl&&(M=this.callControl.roomName,t=this.callControl.type),this.disconnectionWarningCount++,b.createEvent({eventType:"disconnectionWarning",callId:this.callId,remoteId:this.remoteId,tries:this.disconnectionWarningCount,roomName:M,settingUpType:t}),(this.disconnectionWarningCount-1)*this.disconnectionWarningDelay>=this.disconnectionTimer&&0!==this.disconnectionWarningInterval){var u=Date();T.debug("date :"+u),T.debug("clearing disconnectionWarningInterval : no more warnings"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0}},this.createIceErrorDescriptor=function(M,t){var u={};return"disconnected"===M?u.iceState="disconnected":"failed"===M?(u.iceState="failed",!0===t&&(u.previousIceState="disconnected")):u.iceState="unknown",u.callType=this.callType,this.belongsToRoom()?(u.context="conf",this.data.mesh?(u.mode="mesh",(this.data.mesh.callerCompositeUserId?this.data.mesh.callerCompositeUserId===z.compositeClientId:this.data.mesh.callerId===z.clientId)?(u.type="subscribe",u.clientId=this.data.mesh.callerId,u.remoteId=this.data.mesh.calleeId):(this.data.mesh.calleeCompositeUserId?this.data.mesh.calleeCompositeUserId===z.compositeClientId:this.data.mesh.calleeId===z.clientId)?(u.type="publish",u.clientId=this.data.mesh.calleeId,u.remoteId=this.data.mesh.callerId):u.type="unknown",u.mesh=this.data.mesh):(u.mode="sfu",u.type="publish"===this.settingUpType||"shareScreen"===this.settingUpType?"publish":"subscribe"===this.settingUpType?"subscribe":"unknown",this.callee?(u.clientId=this.calleeId,u.remoteId=this.callerId):(u.clientId=this.callerId,u.remoteId=this.calleeId)),this.mcuRemoteStream&&(u.stream=this.mcuRemoteStream)):(u.context="call",u.mode="p2p",this.callerId===z.clientId?(u.clientId=this.callerId,u.remoteId=this.calleeId):this.calleeId===z.clientId&&(u.clientId=this.calleeId,u.remoteId=this.callerId)),u},this.onIceConnectionStateChange=function(M){T.debug("onIceConnectionStateChange: ",M),M=null;var t=0,u=null,h=null,y=null;null!==this.pc?(T.info("Ice Connection State is now : "+this.pc.iceConnectionState),this.iceState=this.pc.iceConnectionState,"connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState||"checking"===this.pc.iceConnectionState?(T.debug("iceConnectionState === connected or completed or checking"),T.debug("this.disconnectionTimeoutId :"+this.disconnectionTimeoutId),0!==this.disconnectionTimeoutId&&(t=Date(),T.debug("date:",t),T.debug("clearing disconnectionTimeout"),clearTimeout(this.disconnectionTimeoutId),this.disconnectionTimeoutId=0),0!==this.disconnectionWarningInterval&&(t=Date(),T.debug("date:",t),T.debug("clearing disconnectionWarningInterval"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0),"checking"!==this.pc.iceConnectionState&&(this.checkCandidateTypesTimeoutId=setTimeout(this.callback(this,"checkCandidateTypes"),this.checkCandidateTypesTimer),this.checkCandidateTypesTimeoutTable.push(this.checkCandidateTypesTimeoutId))):"disconnected"===this.pc.iceConnectionState?(this.callControl&&(u=this.callControl.roomName,h=this.callControl.type),"conf"===(y=this.createIceErrorDescriptor("disconnected")).context&&this.myWebRTC_Stack.sendInfo("iceError",{clientId:z.clientId,callId:this.callId,roomId:this.sessionMCU.roomName,pubSub:z.MCUClient.pubConnector,descriptor:y}),T.warn("disconnection detected"),b.createErrorEvent("iceDisconnection detected","ICE_CONNECTION_STATE_DISCONNECTED",this.callId,u,h,y),t=new Date,T.debug("date:",t),this.disconnectionTimeoutId=setTimeout(this.callback(this,"onCallDisconnection"),this.disconnectionTimer),this.disconnectionWarningCount=0,this.disconnectionWarningTimeout=setTimeout(this.callback(this,"sendDisconnectionWarning"),2e3),this.disconnectionWarningInterval=setInterval(this.callback(this,"sendDisconnectionWarning"),this.disconnectionWarningDelay)):"failed"===this.pc.iceConnectionState&&(this.callControl&&(u=this.callControl.roomName,h=this.callControl.type),"conf"===(y=this.createIceErrorDescriptor("failed",0!==this.disconnectionTimeoutId)).context&&this.myWebRTC_Stack.sendInfo("iceError",{clientId:z.clientId,callId:this.callId,roomId:this.sessionMCU.roomName,pubSub:z.MCUClient.pubConnector,descriptor:y}),T.warn("iceConnection failed detected"),b.createErrorEvent("iceConnection failed detected","ICE_CONNECTION_STATE_FAILED",this.callId,u,h,y),0!==this.disconnectionTimeoutId?this.belongsToRoom()&&(clearTimeout(this.disconnectionTimeoutId),this.disconnectionTimeoutId=0,z.onHangup(this.callId,"disconnected")):this.belongsToRoom()&&(0,d.ki)(this.callControl,["autoRestart","counter"],"number")&&this.callControl.autoRestart.counter>0?z.onHangup(this.callId,"disconnected"):(T.warn("Removing call with callId: "+this.callId),z.removeCallFromTableWithCallIdAndSendBye(this.callId,"Ice_failed")))):T.log("Ice Connection State change with pc is null")},this.callback=function(M,t){return this.closureHandler=function(u,h){return M[t](u,h)},this.closureHandler},this.onSelectedCandidate=function(M){if(null==this.selectedCandidate||this.selectedCandidate.LocalCandidateType!==M.LocalCandidateType||this.selectedCandidate.RemoteCandidateType!==M.RemoteCandidateType||this.selectedCandidate.LocalAddress!==M.LocalAddress||this.selectedCandidate.RemoteAddress!==M.RemoteAddress||this.selectedCandidate.TransportType!==M.TransportType||this.selectedCandidate.LocalTransportType!==M.LocalTransportType){T.debug("WebRTC_Call::onSelectedCandidate() :",M),this.selectedCandidate=M,this.callControl&&this.callControl.autoRestart&&(T.debug("selectedCandidate, this.callControl.autoRestart.counter:",this.callControl.autoRestart.counter),T.debug("selectedCandidate, this.callControl.autoRestart.callIdWhenStartingTimer:",this.callControl.autoRestart.callIdWhenStartingTimer),this.callControl.autoRestart.counter&&(T.debug("Reinit of autoRestart.counter"),this.callControl.autoRestart.counter=0,void 0!==this.callControl.autoRestart.callIdWhenStartingTimer&&z.stopMaxCallRetriesTimer(this.callControl.autoRestart.callIdWhenStartingTimer))),this.myWebRTC_Event.createSelectedICECandidateEvent(this.callId,M.LocalCandidateType,M.RemoteCandidateType,M.LocalAddress,M.RemoteAddress,M.TransportType,M.LocalTransportType);var t=M;t.callId=this.callId,t.clientId=z.clientId,t.roomId=this.dest_roomId,void 0!==this.data.pubSub&&(t.pubSub=this.data.pubSub),void 0!==this.data.confId&&(t.confId=this.data.confId),void 0!==this.data.mesh&&(t.mesh=this.data.mesh),void 0!==this.data.instanceId&&(t.instanceId=this.data.instanceId),this.myWebRTC_Stack.sendInfo("callSelectedCandidate",t)}else T.debug("filtering duplicate candidate")},this.checkCandidateTypes=function(){T.debug("WebRTC_Call::checkCandidatesTypes()");var M=this,t={LocalCandidateType:"unknow",RemoteCandidateType:"unknow",LocalAddress:"unknow",RemoteAddress:"unknow",TransportType:"unknow",LocalTransportType:"unknow"},u=["googLocalAddress","googLocalCandidateType","googRemoteAddress","googRemoteCandidateType","googTransportType"];null===this.pc?(T.warn("Peer connection is null : no candidates"),M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t)):"undefined"!=typeof apiRTC_React?(T.warn("apiRTC_React : no info on candidates"),M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t)):"chrome"===d.wL.type?(T.debug("WebRTC_Call::checkCandidatesTypes() chrome"),this.pc.getStats(function(h){var y=h.result().filter(function(a){return 0===a.id.indexOf("Conn-")&&"true"===a.stat("googActiveConnection")})[0];y?(u.forEach(function(a){t[a.replace("goog","")]=y.stat(a)}),M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t)):(M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t))})):"firefox"===d.wL.type?(T.debug("WebRTC_Call::checkCandidatesTypes() firefox"),this.pc.getStats(null).then(function(h){var y=null;if(h.forEach(function(_){!0===_.selected&&(null!==y&&T.warn("multiple selected candidate-pairs"),y=_)}),null!==y){var a=h.get(y.localCandidateId),m=h.get(y.remoteCandidateId);t.LocalCandidateType=a.candidateType,t.RemoteCandidateType=m.candidateType,t.LocalAddress=a.address&&a.port?a.address+":"+a.port:a.ipAddress+":"+a.portNumber,t.RemoteAddress=m.address&&m.port?m.address+":"+m.port:m.ipAddress+":"+m.portNumber,t.TransportType=a.transport,t.LocalTransportType=a.mozLocalTransport,M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t)}}).catch(function(h){T.warn("failed to get stats",h)})):(T.debug("checkCandidateTypes not Chrome or Firefox"),M.myWebRTC_Event.createICECandidateTypeUpdateEvent(M.callId,t.LocalCandidateType,t.RemoteCandidateType),M.onSelectedCandidate(t))},this.belongsToRoom=function(){return!!(0,d.ki)(this.sessionMCU,"roomName","string")&&((0,d.ki)(this.data,"MCUType","string")&&("MCU-Caller"===this.data.MCUType||"MCU-Callee"===this.data.MCUType)&&(0,d.ki)(this.data,"confId","string")?this.data.confId===this.sessionMCU.roomName:this.dest_roomId===this.sessionMCU.roomName)},this.setLocalCallProfile=function(M){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=[],h={},y={},a=null,m=null,_="adaptation";!0!==this.dataCall&&"subscribe"!==this.settingUpType&&(this.localCallProfile.audioActive!==M.audioActive&&u.push("audioIsActive"),this.localCallProfile.videoActive!==M.videoActive&&u.push("videoIsActive"),this.localCallProfile=M,!0===this.screenSharing?!0===this.localCallProfile.audioActive&&!0===this.localCallProfile.videoActive?"screenSharingWithAudio"!==this.callType&&(this.callType="screenSharingWithAudio",u.push("callType")):!0===this.localCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",u.push("callType")):!0===this.localCallProfile.videoActive?"screenSharing"!==this.callType&&(this.callType="screenSharing",u.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",u.push("callType")):!0===this.localCallProfile.audioActive&&!0===this.localCallProfile.videoActive?"media"!==this.callType&&(this.callType="media",u.push("callType")):!0===this.localCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",u.push("callType")):!0===this.localCallProfile.videoActive?"videoOnly"!==this.callType&&(this.callType="videoOnly",u.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",u.push("callType")),!0===t&&u.length>0&&(h.available=this.localCallProfile.audio,h.active=this.localCallProfile.audioActive,h.muted=this.isLocalAudioMuted,y.available=this.localCallProfile.video,y.active=this.localCallProfile.videoActive,y.muted=this.isLocalVideoMuted,this.callConfiguration&&this.callConfiguration.userMediaStreamId&&(a=this.callConfiguration.userMediaStreamId,(m=apiCC.getUserMediaStream(a))&&(h.deviceLabel=m.audioDeviceLabel,y.deviceLabel=m.videoDeviceLabel)),this.updateCause&&(_=this.updateCause),this.myWebRTC_Event.createLocalStreamUpdatedEvent(u,h,y,!0,this.callType,this.callId,this.callLocalStream,a,_)))},this.setRemoteCallProfile=function(M){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=[],h={},y={},a="adaptation";!0!==this.dataCall&&(this.remoteCallProfile.audioActive!==M.audioActive&&u.push("audioIsActive"),this.remoteCallProfile.videoActive!==M.videoActive&&u.push("videoIsActive"),this.remoteCallProfile=M,"subscribe"===this.settingUpType?(!0===this.screenSharing?!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"screenSharingWithAudio"!==this.callType&&(this.callType="screenSharingWithAudio",u.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",u.push("callType")):!0===this.remoteCallProfile.videoActive?"screenSharing"!==this.callType&&(this.callType="screenSharing",u.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",u.push("callType")):!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"media"!==this.callType&&(this.callType="media",u.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",u.push("callType")):!0===this.remoteCallProfile.videoActive?"videoOnly"!==this.callType&&(this.callType="videoOnly",u.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",u.push("callType")),!0===t&&u.length>0&&(h.available=this.remoteCallProfile.audio,h.active=this.remoteCallProfile.audioActive,h.muted=this.isRemoteAudioMuted,y.available=this.remoteCallProfile.video,y.active=this.remoteCallProfile.videoActive,y.muted=this.isRemoteVideoMuted,this.updateCause&&(a=this.updateCause),this.myWebRTC_Event.createRemoteStreamUpdatedEvent(u,h,y,this.callType,this.callId,a))):(!0===this.screenSharing?!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"screenSharingWithAudio"!==this.destCallType&&(this.destCallType="screenSharingWithAudio",u.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.destCallType&&(this.destCallType="audio",u.push("callType")):!0===this.remoteCallProfile.videoActive?"screenSharing"!==this.destCallType&&(this.destCallType="screenSharing",u.push("callType")):"inactive"!==this.destCallType&&(this.destCallType="inactive",u.push("callType")):"publish"!==this.settingUpType&&"shareScreen"!==this.settingUpType||(!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"media"!==this.destCallType&&(this.destCallType="media",u.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.destCallType&&(this.destCallType="audio",u.push("callType")):!0===this.remoteCallProfile.videoActive?"videoOnly"!==this.destCallType&&(this.destCallType="videoOnly",u.push("callType")):"inactive"!==this.destCallType&&(this.destCallType="inactive",u.push("callType"))),!0===t&&u.length>0&&(h.available=this.remoteCallProfile.audio,h.active=this.remoteCallProfile.audioActive,h.muted=this.isRemoteAudioMuted,y.available=this.remoteCallProfile.video,y.active=this.remoteCallProfile.videoActive,y.muted=this.isRemoteVideoMuted,this.updateCause&&(a=this.updateCause),this.myWebRTC_Event.createRemoteStreamUpdatedEvent(u,h,y,this.destCallType,this.callId,a))))},this.setMediaConstraintsToSendOnlyOffer=function(){this.mediaConstraints="firefox"===d.wL.type?c.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}:"edge"===d.wL.type?{offerToReceiveAudio:0,offerToReceiveVideo:0}:"chrome"===d.wL.type&&d.wL.version<55?{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}:{offerToReceiveAudio:!1,offerToReceiveVideo:!1,mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},this.mediaConstraintsAudioOnly=this.mediaConstraints},this.applyOutgoingBitrate=function(M){var t=this;T.debug("applyOutgoingBitrate",this.callId,M);for(var u=null,h=0;h<this.rtpSenders.video.length;h+=1)if(this.rtpSenders.video[h].track){u=this.rtpSenders.video[h];break}if(u)if("function"==typeof u.getParameters&&"function"==typeof u.setParameters){var y=u.getParameters();if(Object.prototype.hasOwnProperty.call(y,"encodings")){if(1!==y.encodings.length)return void T.debug("encodings cannot be changed",this.callId,y.encodings.length)}else y.encodings=[{}];if(null!==M&&"number"==typeof M){M<50&&(M=50);var a=1e3*M;if(y.encodings[0].maxBitrate===a)return;y.encodings[0].maxBitrate=a}else{if(!Object.prototype.hasOwnProperty.call(y.encodings[0],"maxBitrate"))return;delete y.encodings[0].maxBitrate}u.setParameters(y).catch(function(m){T.error("applyOutgoingBitrate - setParameters",t.callId,m)})}else T.warn("no such functions: getParameters/setParameters",this.callId);else T.warn("no such video rtpSender",this.callId)},this.configureSimulcastEncodings=function(M){var t=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(T.debug("configureSimulcastEncodings",this.callId,M,u.maxBitrate),"RID"===this.simulcast){for(var h=null,y=0;y<this.rtpSenders.video.length;y+=1)if(this.rtpSenders.video[y].track){h=this.rtpSenders.video[y];break}if(h)if("function"==typeof h.getParameters&&"function"==typeof h.setParameters){var a=h.getParameters();if(Object.prototype.hasOwnProperty.call(a,"encodings"))if(3===a.encodings.length){for(var m=null,_=null,P=null,x=a.encodings.length;--x>=0;){var oe=a.encodings[x];m||"h"!==oe.rid?_||"m"!==oe.rid?P||"l"!==oe.rid||(P=oe):_=oe:m=oe}if(m&&Object.prototype.hasOwnProperty.call(m,"maxBitrate")&&_&&Object.prototype.hasOwnProperty.call(_,"maxBitrate")&&P&&Object.prototype.hasOwnProperty.call(P,"maxBitrate")){var K=!1,X=Math.floor(P.maxBitrate/1e3),me=!1,Q=!1;if(m.active&&m.maxBitrate>1&&(X+=Math.floor(m.maxBitrate/1e3),me=!0),_.active&&_.maxBitrate>1&&(X+=Math.floor(_.maxBitrate/1e3),Q=!0),T.debug("currentStatus",X,me,Q),"changeMaxBitrate"===M){if(!(0,d.ki)(u,"maxBitrate","number"))return;var re=u.maxBitrate;X<=re?(Q||X+this.callConfiguration.simulcast.encodings.medium.maxBitrate<=re&&("chrome"===d.wL.type?_.active=!0:"firefox"===d.wL.type&&(_.maxBitrate=1e3*this.callConfiguration.simulcast.encodings.medium.maxBitrate),this.callConfiguration.simulcast.encodings.medium.active=!0,Q=!0,X+=this.callConfiguration.simulcast.encodings.medium.maxBitrate,K=!0),me||X+this.callConfiguration.simulcast.encodings.high.maxBitrate<=re&&("chrome"===d.wL.type?m.active=!0:"firefox"===d.wL.type&&(m.maxBitrate=1e3*this.callConfiguration.simulcast.encodings.high.maxBitrate),this.callConfiguration.simulcast.encodings.high.active=!0,me=!0,X+=this.callConfiguration.simulcast.encodings.high.maxBitrate,K=!0)):(me&&(me=!1,this.callConfiguration.simulcast.encodings.high.active=!1,X-=Math.floor(m.maxBitrate/1e3),"chrome"===d.wL.type?m.active=!1:"firefox"===d.wL.type&&(m.maxBitrate=1),K=!0),X>re&&Q&&(Q=!1,this.callConfiguration.simulcast.encodings.medium.active=!1,X-=Math.floor(_.maxBitrate/1e3),"chrome"===d.wL.type?_.active=!1:"firefox"===d.wL.type&&(_.maxBitrate=1),K=!0))}else"disableEncoding"===M&&(me?(me=!1,this.callConfiguration.simulcast.encodings.high.active=!1,X-=Math.floor(m.maxBitrate/1e3),"chrome"===d.wL.type?m.active=!1:"firefox"===d.wL.type&&(m.maxBitrate=1),K=!0):Q&&(Q=!1,this.callConfiguration.simulcast.encodings.medium.active=!1,X-=Math.floor(_.maxBitrate/1e3),"chrome"===d.wL.type?_.active=!1:"firefox"===d.wL.type&&(_.maxBitrate=1),K=!0));T.debug("applyChanges",X,me,Q,K),K&&(h.setParameters(a).catch(function(ye){T.error("configureEncodings - setParameters",t.callId,ye)}),this.myWebRTC_Stack.sendInfo("configureEncodings",{pubSub:z.MCUClient.pubConnector,clientId:z.clientId,roomId:this.sessionMCU.roomName,callId:this.callId,instanceId:this.instanceId,hint:"simulcast",encodings:this.callConfiguration.simulcast.encodings}))}else T.warn("cannot find h/m/l encodings",this.callId)}else T.warn("wrong encodings",this.callId,a.encodings.length);else T.warn("no encodings configured",this.callId)}else T.warn("no such functions: getParameters/setParameters",this.callId);else T.warn("no such video rtpSender",this.callId)}}},ne=(e(4363),e(9653),function(z){this.disconnectionTimer=15e3,this.userMediaId=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),this.callType="media",this.audio=!1,this.video=!1,this.audioSdpDirection=null,this.videoSdpDirection=null,this.callConfiguration={},this.sessionMCU=null,this.myWebRTC_Stack=new L.S(z.socket),this.getUserMediaStream=function(){return this.callConfiguration&&this.callConfiguration.userMediaStreamId?apiCC.getUserMediaStream(this.callConfiguration.userMediaStreamId):null},this.releaseUserMediaStream=function(){if(this.callConfiguration&&this.callConfiguration.userMediaStreamId){var M=this.callConfiguration.userMediaStreamId;return delete this.callConfiguration.userMediaStreamId,apiCC.releaseUserMediaStream(M,this.userMediaId)}return!1},this.close=function(){(this.addAck||this.addTimeoutId)&&(delete this.addAck,clearTimeout(this.addTimeoutId),delete this.addTimeoutId)}});function le(z){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(z)}function W(z,M){var t="undefined"!=typeof Symbol&&z[Symbol.iterator]||z["@@iterator"];if(!t){if(Array.isArray(z)||(t=function(_,P){if(_){if("string"==typeof _)return be(_,P);var x=Object.prototype.toString.call(_).slice(8,-1);return"Object"===x&&_.constructor&&(x=_.constructor.name),"Map"===x||"Set"===x?Array.from(_):"Arguments"===x||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?be(_,P):void 0}}(z))||M&&z&&"number"==typeof z.length){t&&(z=t);var u=0,h=function(){};return{s:h,n:function(){return u>=z.length?{done:!0}:{done:!1,value:z[u++]}},e:function(_){throw _},f:h}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var y,a=!0,m=!1;return{s:function(){t=t.call(z)},n:function(){var _=t.next();return a=_.done,_},e:function(_){m=!0,y=_},f:function(){try{a||null==t.return||t.return()}finally{if(m)throw y}}}}function be(z,M){(null==M||M>z.length)&&(M=z.length);for(var t=0,u=new Array(M);t<M;t++)u[t]=z[t];return u}var de=i.Y.get("ApiCCMCUClient"),ce=apiCC.myWebRTC_Event,Ne=function(z,M){de.debug("ApiCCMCUClient creation"),this.pubConnector="janusConnector",this.meshModeEnabled=!1,this.sessionMCUs=[],this.distantCalls=[],this.streamList=[],this.disputableStreamList=[],this.publishCallId=null,this.joinSessionReqs=[],this.transitionCount=0,this.browserCapabilities={updateStream:!0,mesh2janusTransition:!0,checkCallStatus:!0},this.receiveSessionId=function(t){de.debug("receiveSessionId()"),ce.createMCUSessionCreationEvent(t.sessionId,t.token),this.publish(t.sessionId,t.token)},this.sendSessionInvitation=function(t,u,h){var a;de.debug("sendSessionInvitation()"),null!=u?(void 0===h&&(h=0),a=JSON.stringify({type:"MCUSessionInvitation",srcId:M,destId:t,sessionId:u,groupChatId:h}),de.log("C->S: "+a),apiCC.session.channel.socket.emit("MCUSessionInvitation",a)):de.log("Session is null or undefined, MCU Session invitation is not sended")},this.sendSessionInvitationToGroupChat=function(t,u){if(de.debug("sendSessionInvitationToGroupChat()"),null!=t)if(null!=u){var y;y=JSON.stringify({type:"MCUSessionInvitationToGroupChat",srcId:M,groupChatId:t,sessionId:u}),de.log("C->S: "+y),apiCC.session.channel.socket.emit("MCUSessionInvitationToGroupChat",y)}else de.log("Session is null or undefined, MCU Session invitation is not sended");else de.log("groupChatId is null or undefined, MCU Session invitation is not sended")},this.receiveSessionInvitation=function(t){de.debug("receiveSessionInvitation()"),de.log("msg.sessionId :"+t.sessionId),de.log("msg.token :"+t.token),de.log("msg.groupChatId :"+t.groupChatId),ce.createReceiveMCUSessionInvitationEvent(t.sessionId,t.token,t.groupChatId,t.srcId)},this.acceptSessionInvitation=function(t,u){de.debug("acceptSessionInvitation()"),de.log("sessionId :"+t),de.log("token :"+u),this.publish(t,u)},this.leaveSession=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};de.info("leaveSession()");var h=null,y=null,a=null;if(!(a=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0})))return new Error("leaveSession: session not set");!0!==u.noHangup&&(apiCC.session.apiCCWebRTCClient.webRTCClient.removeAllCallsFromRoom(a.roomName,"leaveSession"),this.meshOnHangup(null,null,{roomId:a.roomName}));var m=[];m.push(a.roomName),apiCC.session.leavePresenceGroup(m),apiCC.session.unsubscribePresenceGroup(m),h={type:"leaveSession",roomId:a.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},y=JSON.stringify(h),de.log("C->S: "+y),apiCC.session.channel.socket.emit("leaveSession",y),de.debug("leaveSession: distant call clean up");for(var _=this.distantCalls.length;--_>=0;)this.distantCalls[_].roomId===a.roomName&&(de.debug("leaveSession: remove distant call descriptor",this.distantCalls[_]),this.distantCalls.splice(_,1));apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({multi:!0,roomName:a.roomName});for(var P=this.streamList.length;--P>=0;)this.streamList[P].roomId===a.roomName&&this.streamList.splice(P,1);return this.removeSessionMCU(a),"OK"},this.createJoinSessionMessage=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=null;t||(h=u.hasOwnProperty("sessionMCU")?u.sessionMCU:this.getSessionMCU(null,{first:!0}))&&(t=h.roomName);var y=h&&"mesh"===h.roomMode||!0===this.meshModeEnabled||!0===u.meshModeEnabled,a=h&&!0===h.meshOnly||!0===u.meshOnlyEnabled,m={type:"joinSession",roomId:t,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector,meshModeEnabled:y,meshOnlyEnabled:a,videoBandwidthSettings:apiCC.session.apiCCWebRTCClient.webRTCClient.videoBandwidthSettings,browserInfo:{browserAbout:c.Xh+" "+c.dc,browserType:d.wL.type,browserVersion:d.wL.version,osName:c.BF,osVersion:c.MM,deviceType:c.vO}}};if(u.hasOwnProperty("transactionId")&&(m.transactionId=u.transactionId),u.hasOwnProperty("convId")?m.data.convId=u.convId:h&&h.hasOwnProperty("convId")&&(m.data.convId=h.convId),u.moderationEnabled&&(m.data.moderationEnabled=!0),u.moderator&&(m.data.moderator=!0),u.qualityAdaptationEnabled&&(m.data.qualityAdaptationEnabled=!0),Array.isArray(u.supportedVideoCodecs)){m.data.supportedVideoCodecs=[];var _,P=W(u.supportedVideoCodecs);try{for(P.s();!(_=P.n()).done;){var x=_.value;m.data.supportedVideoCodecs.push("h264"===x?{codec:"h264",profilelevelid:"42e01f"}:"string"==typeof x?{codec:x}:x)}}catch(oe){P.e(oe)}finally{P.f()}}else"safari"===d.wL.type&&("Safari"===c.Xh&&c.dc<12.1||"Mobile Safari"===c.Xh&&c.dc<12.1)&&(m.data.supportedVideoCodecs=[{codec:"h264",profilelevelid:"42e01f"}]);return m.data.capabilities=this.browserCapabilities,m},this.createSessionDescriptor=function(t){var u={roomId:t.roomName};return t.convId&&(u.convId=t.convId),t.roomMode&&(u.roomMode=t.roomMode),t.modeChangeKind&&(u.modeChangeKind=t.modeChangeKind),u},this.joinSession=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.getSessionMCU(t))return de.warn("joinSession: session already set"),new Error("joinSession: session already set");if(this.getJoinSessionReq(t))return de.warn("joinSession: session already requested"),new Error("joinSession: session already requested");var h={};h.roomId=t,h.transactionId=apiCC.randomString(12),this.joinSessionReqs.push(h);var y=Object.assign({},u);y.transactionId=h.transactionId,de.info("joinSession() on Apizee MCU with roomId:",t);var a=this.createJoinSessionMessage(t,y),m=JSON.stringify(a);return de.log("C->S: "+m),apiCC.session.channel.socket.emit("joinSession",m),"OK"},this.joinSessionAnswer=function(t){if(de.debug("joinSessionAnswer()"),this.getSessionMCU(t.roomName))de.warn("joinSessionAnswer: session already set");else{var u=null;if(t.hasOwnProperty("transactionId")&&(u=this.getJoinSessionReq(null,{transactionId:t.transactionId})),u||(u=this.getJoinSessionReq(t.roomName)),u){this.removeJoinSessionReq(u);var h={};h.roomID=t.sessionId,h.roomName=t.roomName,t.hasOwnProperty("convId")&&(h.convId=t.convId),h.joinSessionAnswer={},(0,d.ki)(t,"data","object")?(!0===t.data.failed?(h.joinSessionAnswer.failed=!0,h.joinSessionAnswer.reason=t.data.reason):h.joinSessionAnswer.failed=!1,t.data.mode&&"string"==typeof t.data.mode&&(h.roomMode=t.data.mode,de.debug("session joined with mode; roomMode: "+h.roomMode)),"mesh"===h.roomMode&&!0===t.data.meshOnly&&(h.meshOnly=!0,de.debug("meshOnly"))):h.joinSessionAnswer.failed=!1,this.sessionMCUs.push(h);var y=[];y.push(t.roomName),apiCC.session.joinPresenceGroup(y),apiCC.session.subscribePresenceGroup(y),ce.createJoinMCUSessionAnswerEvent(t.sessionId,t.token,t.groupChatId,t.initiator,h)}else de.debug("joinSessionAnswer: no joinSession requested")}},this.changeSessionMode=function(t,u){var h=this.getSessionMCU(t.roomName);if(h)if("mesh"===h.roomMode){for(var y=0,a=z.userMediaTable.length;--a>=0;)if(z.userMediaTable[a].sessionMCU===h){de.debug("changeSessionMode: userMedia",z.userMediaTable[a]),z.userMediaTable[a].distantCalls=[],y+=1;for(var m=this.distantCalls.length;--m>=0;)de.debug("changeSessionMode: distantCall",this.distantCalls[m]),"mesh"===this.distantCalls[m].callMode&&this.distantCalls[m].callFeed.callId===z.userMediaTable[a].userMediaId&&(de.debug("changeSessionMode: match"),z.userMediaTable[a].distantCalls.push(this.distantCalls[m]))}for(var _=0,P=z.callControlTable.length;--P>=0;)"subscribe"===z.callControlTable[P].type&&z.callControlTable[P].roomName===h.roomName&&(_+=1,z.callControlTable[P].autoRestart.force=!0);if(ce.createMCURoomModeChangedEvent(h.roomName,"mesh","sfu","ongoing"),0===y&&0===_)delete h.roomMode,ce.createMCURoomModeChangedEvent(h.roomName,"mesh","sfu","complete");else{h.modeChangeKind="old";var x={};x.roomID=t.roomName,x.roomName=t.roomName,t.hasOwnProperty("convId")&&(x.convId=t.convId),x.joinSessionAnswer={failed:!1},x.modeChangeKind="new",x.transitionTimeoutId=setTimeout(function(oe,K){delete K.transitionTimeoutId,z.finalizeMeshToJanusTransition(oe,K,{force:!0})}.bind(this,h,x),3e4),this.sessionMCUs.push(x),this.transitionCount+=1}}else de.warn("changeSessionMode: session not using mesh mode");else de.warn("changeSessionMode: no session")},this.updateSessionAnswer=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};de.debug("updateSessionAnswer");var h=this.getSessionMCU(t.roomName);if(!h){if(!u.createSession)return void de.warn("updateSessionAnswer: no such session",t.roomName);de.debug("force session creation; roomName: "+t.roomName),(h={}).roomID=t.roomName,h.roomName=t.roomName,t.hasOwnProperty("convId")&&(h.convId=t.convId),h.joinSessionAnswer={failed:!1},this.sessionMCUs.push(h);for(var y=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length;--y>=0;){var a=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[y];!a.data||"MCU-Caller"!==a.data.MCUType&&"MCU-Callee"!==a.data.MCUType||a.data.confId!==h.roomName||(a.sessionMCU=h)}}var m=!1;if(t.data&&"mesh"===t.data.mode?(h.roomMode="mesh",!0===t.data.meshOnly&&(h.meshOnly=!0)):("mesh"===h.roomMode&&(m=!0),delete h.roomMode),"new"===h.modeChangeKind){de.debug("transition already ongoing");var _=this.getSessionMCU(null,{callback:function(re){return re.roomName===h.roomName&&"old"===re.modeChangeKind}});_&&z.finalizeMeshToJanusTransition(_,h,{force:!0})}else if(m){de.debug("transition NOT ongoing but should be"),ce.createMCURoomModeChangedEvent(h.roomName,"mesh","sfu","ongoing"),h.modeChangeKind="old";var P={};P.roomID=h.roomID,P.roomName=h.roomName,h.hasOwnProperty("convId")&&(P.convId=h.convId),P.joinSessionAnswer={failed:!1},P.modeChangeKind="new",this.sessionMCUs.push(P),this.transitionCount+=1,z.finalizeMeshToJanusTransition(h,P,{force:!0})}if(u.updateCalls)if(de.debug("update stream list (prune)"),this.updateStreamList(t,{prune:!0}),"mesh"===h.roomMode){de.debug("restart publish/shareScreen calls");for(var x=z.userMediaTable.slice(),oe=x.length;--oe>=0;){var K=x[oe];K.sessionMCU===h&&z.onHangup(K.userMediaId,"disconnected")}}else{de.debug("restart publish/shareScreen calls with no PeerConnection");for(var X=z.callsTable.slice(),me=X.length;--me>=0;){var Q=X[me];Q.sessionMCU===h&&("publish"!==Q.settingUpType&&"shareScreen"!==Q.settingUpType||Q.data&&Q.data.mesh||Q.pc||z.onHangup(Q.callId,"disconnected"))}}},this.processCheckCallStatus=function(t){this.updateStreamList(t)},this.updateStreamList=function(t){for(var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=(0,d.ki)(t,"availableStreams","array")?t.availableStreams.slice():null,y=(0,d.ki)(t,"availableComposite","array")?t.availableComposite.slice():null,a=(0,d.ki)(t,"availableReplay","array")?t.availableReplay.slice():null,m=this.streamList.length;--m>=0;){var _=this.streamList[m];if("regular"===_.type){if(!h)continue;for(var P=h.length;--P>=0&&h[P].id!==_.streamInfo.id;);if(P>=0){(0,d.ki)(_,"clearDisputableEntry","function")&&_.clearDisputableEntry(),h.splice(P,1);continue}!0===u.prune?((0,d.ki)(_,"clearDisputableEntry","function")&&_.clearDisputableEntry(),apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:_.streamInfo}),ce.createMCURemovedStreamEvent(_.streamInfo.id),this.streamList.splice(m,1)):_.disputableTimeoutId||(_.disputableTimeoutId=setTimeout(Oe.bind(this,_.streamInfo.id),3e4),_.clearDisputableEntry=He.bind(this,_.streamInfo.id),this.disputableStreamList.push(_))}else if("composite"===_.type){if(!y)continue;for(var x=y.length;--x>=0&&y[x].id!==_.streamInfo.id;);if(x>=0){y.splice(x,1);continue}apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:_.streamInfo}),ce.createMCURemovedStreamEvent(_.streamInfo.id),this.streamList.splice(m,1)}else if("replay"===_.type){if(!a)continue;for(var oe=a.length;--oe>=0&&a[oe].id!==_.streamInfo.id;);oe>=0&&a.splice(oe,1)}}if(h)for(var K=0;K<h.length;K+=1){var X=[];X.push(h[K]);var me=this.newAvailableStream(X,"regular");ce.createMCUAvailableStreamEvent(X,me)}if(y)for(var Q=0;Q<y.length;Q+=1){var re=[];re.push(y[Q]);var ye=this.newAvailableStream(re,"composite");ce.createMCUAvailableCompositeEvent(re,ye)}if(a)for(var Se=0;Se<a.length;Se+=1){var ge=[];ge.push(a[Se]);var Pe=this.newAvailableReplay(ge);ce.createMCUAvailableReplayEvent(ge,Pe)}},this.getStreamList=function(){return de.debug("getStreamList :",this.streamList),this.streamList},this.getStreamFromList=function(t){var u;for(de.debug("getStreamFromList() with Id :",t),de.log("this.streamList :",this.streamList),u=0;u<this.streamList.length;u+=1){if(this.streamList[u].streamInfo.id===t)return de.log("stream found",this.streamList[u].streamInfo),this.streamList[u].streamInfo;de.log("not the same stream",t)}return null},this.getStreamIdOfUser=function(t){var u;for(de.debug("getStreamIdOfUser() with Id :",t),de.log("this.streamList :",this.streamList),u=0;u<this.streamList.length;u+=1)if("replay"!==this.streamList[u].type){if(this.streamList[u].userId===t)return de.log("stream found",this.streamList[u].streamInfo),this.streamList[u].streamInfo.id;de.log("not the same userId",t)}return null},this.getStreamOfUserCall=function(t,u){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=this.streamList.length,a=!1;for((0,d.ki)(h,"replay","boolean")&&!0===h.replay&&(a=!0);--y>=0;){if(!0===a){if("replay"!==this.streamList[y].type)continue}else if("replay"===this.streamList[y].type)continue;if(this.streamList[y].userId===t&&this.streamList[y].streamInfo.attributes.callId===u)return this.streamList[y].streamInfo}return null},this.newAvailableStream=function(t,u,h){de.debug("newAvailableStream():",t);var y=!1,a=!1,m=this.getSessionMCU(t[0].room);if(m){t[0].attributes.callerId!==M&&(y=!0);for(var _=z.getCallControls(["publish","shareScreen"],{addUserMedia:!0}),P=0;P<t.length;P+=1){for(var x=this.streamList.length;--x>=0&&("regular"!==this.streamList[x].type||t[P].id!==this.streamList[x].streamInfo.id););x>=0?(a=!0,(0,d.ki)(this.streamList[x],"clearDisputableEntry","function")?this.streamList[x].clearDisputableEntry():de.debug("clearDisputableEntry is not set")):de.debug("streamList is empty"),y=!Object.prototype.hasOwnProperty.call(_,t[P].attributes.callId);var oe={type:u,userId:t[P].attributes.callerId,roomId:m.roomName,isRemoteStream:y,streamInfo:t[P]};if(!0===a?this.streamList[x]=oe:this.streamList.push(oe),de.log("this.streamList :",this.streamList),!0!==y&&"mesh"===m.roomMode){var K=z.findUserMediaById(t[P].attributes.callId);K&&!0===K.addAck&&(delete K.addAck,clearTimeout(K.addTimeoutId),delete K.addTimeoutId,ce.createCallEstablishedEvent(m.roomName,K.callType,K.userMediaId,"none"))}var X=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:t[P]});if(X&&!X.autoRestart.pending){de.info("[newAvailableStream] auto subscribing to stream");var me=!!X.autoRestart.force;delete X.autoRestart.force;var Q=X.callId,re=this.subscribeToStreams([t[P]],X.mediaType,X.data,X.callConfiguration,{noStreamCheck:!0,force:me});Q&&re[0]&&ce.createCallRestartingEvent(X.callType,X.audioOnly,Q,re[0],"subscribe",apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,X.roomName,X.roomName,t[P].id)}!0!==a&&(0,d.Ym)(h,"function")&&h(y,t[P],u)}return y}de.debug("newAvailableStream() but client is not in session")},this.updateAvailableStream=function(t,u,h){de.info("updateAvailableStream():",t);var y=!1;if(this.getSessionMCU(t[0].room)){t[0].attributes.callerId!==M&&(y=!0);for(var a=0;a<t.length;a+=1)for(var m=this.streamList.length;--m>=0;)if(this.streamList[m].streamInfo.id===t[a].id){for(var _=[],P=0,x=["audio","audioMuted","video","videoMuted"];P<x.length;P++){var oe=x[P];this.streamList[m].streamInfo[oe]!==t[a][oe]&&(this.streamList[m].streamInfo[oe]=t[a][oe],_.push(oe))}this.streamList[m].streamInfo.attributes.callType!==t[a].attributes.callType&&(this.streamList[m].streamInfo.attributes.callType=t[a].attributes.callType,_.push("callType")),this.streamList[m].streamInfo.attributes.descriptor&&t[a].attributes.descriptor&&this.streamList[m].streamInfo.attributes.descriptor.priority!==t[a].attributes.descriptor.priority&&(this.streamList[m].streamInfo.attributes.descriptor.priority=t[a].attributes.descriptor.priority,_.push("priority")),_.length>0&&(0,d.Ym)(h,"function")&&h(y,t[a],u,_);break}return y}de.log("updateAvailableStream() but client is not in session")},this.newAvailableReplay=function(t){de.info("newAvailableReplay() :",t);var u=!1,h=this.getSessionMCU(t[0].room);if(h){t[0].attributes.callerId!==M&&(u=!0);for(var y=0;y<t.length;y+=1)this.streamList.push({type:"replay",userId:t[y].attributes.callerId,roomId:h.roomName,isRemoteStream:u,streamInfo:t[y]});return u}de.log("newAvailableReplay() but client is not in session")},this.subscribeToStreams=function(t,u,h,y){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};de.info("subscribeToStreams():",t);var m,_,P=[],x=null,oe=null,K=null,X=null,me=null;for(K in t){if(m=t[K],null===apiCC.session||void 0===apiCC.session)return de.debug("no session, leaving subscribeToStreams()"),P;if(null!==(x=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithStreamId(m.id,{ignoreModeChangeKindOld:!0}))){if(de.debug("call already exists"),!0!==a.force){P[K]=x.callId;continue}de.debug("Force is true")}else de.debug("call does not exist");for(_=this.streamList.length;--_>=0&&this.streamList[_].streamInfo.id!==m.id;);if(_>=0){if(de.debug("stream exists"),this.streamList[_].disputableTimeoutId){de.debug("stream temporarily not available"),P[K]=null,!0===a.autoSub&&((oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:m}))||apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"subscribe",roomName:m.room,mediaType:u,callConfiguration:y,data:h,stream:m}));continue}}else if(de.debug("stream does not exist"),!0!==a.noStreamCheck){P[K]=null,ce.createErrorEvent("stream not available","STREAM_NOT_AVAILABLE",null,m.room,null,{stream:m});continue}de.info("stream:",m);var Q=this.getSessionMCU(m.room);Q&&((oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:m}))||(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"subscribe",roomName:Q.roomName,mediaType:u,callConfiguration:y,data:h,stream:m})),"COMPOSITE"!==m.attributes.callType&&"janusConnector"===this.pubConnector?(void 0===h&&(h={}),h.mesh&&delete h.mesh,(0,d.Ym)(y,"qos","object")?(h.qos={},h.qos.videoForbidInactive=!1!==y.qos.videoForbidInactive):(h.qos={},h.qos.videoForbidInactive=!0),(0,d.Ym)(y,"simulcast","object")&&(h.simulcast={},y.simulcast.streamQuality&&("high"===y.simulcast.streamQuality?h.simulcast.substream=2:"medium"===y.simulcast.streamQuality?h.simulcast.substream=1:"low"===y.simulcast.streamQuality&&(h.simulcast.substream=0)),y.simulcast.streamFrameRate&&("high"===y.simulcast.streamFrameRate?h.simulcast.temporal=2:"medium"===y.simulcast.streamFrameRate?h.simulcast.temporal=1:"low"===y.simulcast.streamFrameRate&&(h.simulcast.temporal=0))),(x=new H(apiCC.session.apiCCWebRTCClient.webRTCClient)).instanceId=apiCC.generateInstanceId(),x.callControl=oe,(0,d.ki)(x.callControl.autoRestart,"counter","number")?(x.callControl.autoRestart.counter+=1,x.restarted=!0):x.callControl.autoRestart.counter=0,x.settingUpType="subscribe",x.setupTimeoutId=setTimeout(function(){de.warn("invite + SDP offer not received -> restart call"),z.onHangup(x.callId,"disconnected")},15e3),null!=y&&null!=y.turnServerAddress&&x.setCallTurnServer(y.turnServerAddress),x.generateCallId(),oe.callId=x.callId,x.callerId=Q.roomName,x.calleeId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,x.callee=!0,x.mcuRemoteStream=m,x.dest_roomId=Q.roomName,x.callType=m.attributes.callType,x.callControl.callType=m.attributes.callType,"audio"!==m.attributes.callType&&"AUDIOONLY"!==u||(x.audioOnly=!0,x.callControl.audioOnly=!0),x.remoteId=m.attributes.callerId,x.remoteMailAddress=m.attributes.mailAddress,x.streamId=m.id,x.mediaType=u,x.sessionMCU=Q,de.log("call.streamId: "+x.streamId),x.data=(0,d.Ym)(h,"object")?(0,d.ws)({},h):{},x.data.pubSub="janusConnector",x.data.type="subscribe",x.data.mode="passive",x.data.mediaType=u,x.data.capabilities=this.browserCapabilities,x.data.cloudConvId=Q.convId,x.data.instanceId=x.instanceId,apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(x),P[K]=x.callId,(X={}).type="invite",X.mode="passive",X.callId=x.callId,X.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,X.callerNickname=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,X.calleeId=Q.roomName,X.roomId=Q.roomName,X.callType=m.attributes.callType,X.data=x.data,X.stream=m,me=JSON.stringify(X),de.log("C->S: "+me),apiCC.session.apiCCWebRTCClient.webRTCClient.socket.emit("invite",me)):((x=new H(apiCC.session.apiCCWebRTCClient.webRTCClient)).instanceId=apiCC.generateInstanceId(),x.callControl=oe,(0,d.ki)(x.callControl.autoRestart,"counter","number")?(x.callControl.autoRestart.counter+=1,x.restarted=!0):x.callControl.autoRestart.counter=0,x.settingUpType="subscribe",null!=y&&null!=y.turnServerAddress&&x.setCallTurnServer(y.turnServerAddress),void 0===h&&(h={}),x.data=h,x.data.pubSub=this.pubConnector,x.data.type="subscribe",x.data.capabilities=this.browserCapabilities,x.data.cloudConvId=Q.convId,x.data.instanceId=x.instanceId,de.log("mediaType: ",u),de.log("stream.attributes.callType: ",m.attributes.callType),x.callType=m.attributes.callType,x.callControl.callType=m.attributes.callType,"COMPOSITE"===m.attributes.callType&&"janusConnector"===this.pubConnector||"audio"===m.attributes.callType||"AUDIOONLY"===u?(de.log("Setting call as audioOnly"),x.audioOnly=!0,x.callControl.audioOnly=!0,x.stripVideoSDPActivated=!0):"VIDEOONLY"===u&&(x.stripAudioSDPActivated=!0,x.callType="videoOnly",x.callControl.callType="videoOnly"),x.mcuRemoteStream=m,x.dest_roomId=Q.roomName,x.calleeId=Q.roomName,x.generateCallId(),oe.callId=x.callId,x.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,x.sessionMCU=Q,apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(x),x.createPeerConnection(),x.doCall(),x.started=!0,x.callType=m.attributes.callType,x.remoteId=m.attributes.callerId,x.remoteMailAddress=m.attributes.mailAddress,!0===m.audio?x.destCallType=!0===m.video?"media":"audio":!0===m.video&&(x.destCallType="videoOnly"),void 0===m.id&&de.log("stream.id is undefined :",m),x.streamId=m.id,x.mediaType=u,de.log("stream.attributes.callType: ",m.attributes.callType),P[K]=x.callId),x.asyncCallbacks={},x.asyncCallbacks.type="subscribe")}return P},this.unsubscribe=function(t){de.info("unsubscribe() :",t);var u=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithStreamId(t);null===u?de.log("error call not found on unsubscribe"):void 0!==u.callId&&apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(u.callId)},this.publish=function(t,u,h,y,a,m){de.info("publish roomName :",t),de.log("publish sessionId :",u),de.log("publish token :",h),de.log("publish callConfiguration :",y);var _=null,P=!1,x=!1,oe=null,K=null,X=this.getSessionMCU(t);if(!X)return de.error("roomName does not match any sessionMCU"),null;if(null!==a&&"object"===le(a)||(a={}),"janusConnector"===this.pubConnector&&!a.mesh&&m&&m.callControl&&m.callControl.callId&&apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(m.callControl.callId))return de.debug("call already exists",m.callControl.callId),m.callControl.callId;if(!0===y||"true"===y?(de.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),P=!0,y={}):!1===y||"false"===y?(de.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),y={}):null!==y&&"object"===le(y)||(y={}),!0===y.audioOnly&&!0===y.videoOnly)return ce.createErrorEvent("Cannot publish without audio nor video","PUBLISH_FAILURE",null,t),null;if(!0===y.audioOnly&&(P=!0),!0===y.videoOnly&&(x=!0),["audioOnly","videoOnly","record","private"].forEach(function(Q){y.hasOwnProperty(Q)&&((0,d.ki)(a,"callConfiguration","object")||(a.callConfiguration={}),a.callConfiguration[Q]=y[Q])}),X.convId&&(a.cloudConvId=X.convId),(0,d.Ym)(y,"qos","object")?(a.qos={},y.qos.videoMinBitrate?a.qos.videoMinBitrate=y.qos.videoMinBitrate:a.qos.videoMinQuality=y.qos.videoMinQuality&&["excellent","good","medium","bad"].indexOf(y.qos.videoMinQuality)>=0?y.qos.videoMinQuality:"bad",y.qos.videoStartBitrate?a.qos.videoStartBitrate=y.qos.videoStartBitrate:y.qos.videoStartQuality&&["upper","excellent","good","medium","bad"].indexOf(y.qos.videoStartQuality)>=0&&(a.qos.videoStartQuality=y.qos.videoStartQuality),a.qos.videoForbidInactive=!1!==y.qos.videoForbidInactive):a.qos={videoMinQuality:"bad",videoForbidInactive:!0},y.simulcast&&(y.userMediaStreamId&&(K=apiCC.getUserMediaStream(y.userMediaStreamId))&&K.isSimulcastCompliant()||delete y.simulcast),function(Q){if(!(0,d.ki)(Q,"simulcast","object")||"safari"===d.wL.type&&"SDP"!==Q.simulcast.mode)return delete Q.simulcast,!1;delete Q.simulcast.sendEncodings,(0,d.ki)(Q.simulcast,"maxBitrate","number")?"chrome"===d.wL.type&&d.wL.version>=78&&"SDP"!==Q.simulcast.mode?(de.debug("configure simulcast RID chrome maxBitrate"),!we(Q.simulcast,Q.simulcast.maxBitrate)&&(de.warn("cannot configure simulcast"),delete Q.simulcast)):"firefox"===d.wL.type?(de.debug("configure simulcast RID firefox maxBitrate"),!we(Q.simulcast,Q.simulcast.maxBitrate)&&(de.warn("cannot configure simulcast"),delete Q.simulcast)):delete Q.simulcast.encodings:(0,d.ki)(Q.simulcast,"encodings","object")?"chrome"===d.wL.type&&d.wL.version>=78&&"SDP"!==Q.simulcast.mode?(de.debug("configure simulcast RID chrome encodings"),!ze(Q.simulcast)&&(de.warn("cannot configure simulcast"),delete Q.simulcast)):"firefox"===d.wL.type?(de.debug("configure simulcast RID firefox encodings"),!ze(Q.simulcast)&&(de.warn("cannot configure simulcast"),delete Q.simulcast)):delete Q.simulcast.encodings:"chrome"===d.wL.type&&d.wL.version>=78&&"SDP"!==Q.simulcast.mode?(de.debug("configure simulcast RID chrome default"),Q.simulcast.encodings={high:{maxBitrate:900},medium:{maxBitrate:300,scaleResolutionDownBy:2},low:{maxBitrate:100,scaleResolutionDownBy:4}},!ze(Q.simulcast)&&delete Q.simulcast):"firefox"===d.wL.type&&(de.debug("configure simulcast RID firefox default"),Q.simulcast.encodings={high:{maxBitrate:900},medium:{maxBitrate:300,scaleResolutionDownBy:2},low:{maxBitrate:100,scaleResolutionDownBy:4}},!ze(Q.simulcast))&&delete Q.simulcast}(y),y.distributedBroadcastEnabled&&!y.simulcast&&(a.distributedBroadcastEnabled=!0),["audioLabels","videoLabels"].forEach(function(Q){(0,d.Ym)(y[Q],"array")&&(a[Q]=[],y[Q].forEach(function(re){(0,d.Ym)(re,"string")&&a[Q].push(re)}))}),(0,d.Ym)(y,"context","object"))try{JSON.stringify(y.context),a.context=y.context}catch(Q){}if((0,d.Ym)(y,"profileType","string")&&(a.profileType=y.profileType),(0,d.Ym)(y,"priority","number")&&y.priority>=0&&(a.priority=y.priority),(0,d.Ym)(y,"downgradeProfileList","array")&&(a.downgradeProfileList=y.downgradeProfileList),de.debug("callConfiguration; audioOnly: "+P+", videoOnly: "+x),m&&!0===m.forceScreenSharingCallType)de.debug("publish screenSharing");else if(!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return de.debug("publish without any device, leaving publish ..."),a.publishWithoutMediaDeviceDetected=!0,apiCC.session.setUserData(a),ce.createErrorEvent("Cannot publish without audio nor video","PUBLISH_FAILURE",null,t),null;!0!==P&&(de.debug("publish video, but no webcam present, forcing callType to audio"),P=!0)}else!1===apiCC.mediaDeviceMgr.audioDevicePresent&&!0!==x&&(de.debug("publish video, but no microphone present, forcing callType to videoOnly"),x=!0);if(_=new H(apiCC.session.apiCCWebRTCClient.webRTCClient),void 0!==a.mesh&&void 0!==a.instanceId?(de.debug("keeping instanceId "),_.instanceId=a.instanceId):_.instanceId=apiCC.generateInstanceId(),"janusConnector"!==this.pubConnector||a.mesh?(_.settingUpType="publish",_.generateCallId()):(_.settingUpType="publish",m&&m.callControl?(_.callControl=m.callControl,_.callControl.autoRestart.counter+=1,_.callId=_.callControl.callId,_.restarted=!0):(_.callControl=apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"publish",roomName:t,callConfiguration:y,data:a}),_.callControl.sessionId=u,_.callControl.token=h,_.callControl.autoRestart.counter=0,_.generateCallId(),_.callControl.callId=_.callId)),null!=y&&null!=y.turnServerAddress&&_.setCallTurnServer(y.turnServerAddress),y.userMediaStreamId&&((K=apiCC.getUserMediaStream(y.userMediaStreamId))?(_.callType=K.callType,de.debug("Setting callType to "+_.callType),"screenSharing"===_.callType&&(_.screenSharing=!0)):(de.debug("callConfiguration.userMediaStreamId is setted but stream is not present"),delete y.userMediaStreamId)),_.data=a,_.data.instanceId=_.instanceId,"restarted"===u&&(_.restarted=!0),_.mediaTypeForIncomingCall="NONE",!0===P?(de.log("Setting call as audioOnly"),_.audioOnly=!0,_.callType="audio",_.mediaTypeForOutgoingCall="AUDIO"):!0===x?(de.log("Setting call as videoOnly"),_.callType="videoOnly",_.mediaTypeForOutgoingCall="VIDEOONLY"):de.log("Not Setting call as audioOnly nor videoOnly"),_.dest_roomId=X.roomName,_.calleeId=X.roomName,_.data.pubSub=this.pubConnector,_.data.type="publish",_.data.capabilities=this.browserCapabilities,_.data.cloudConvId=X.convId,_.callConfiguration=y,_.sessionMCU=X,_.setMediaConstraintsToSendOnlyOffer(),_.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,(0,d.Ym)(y,"simulcast","object")){var me=null;K&&(me=K.getSimulcastProfile()),"chrome"===d.wL.type&&d.wL.version>=78&&"SDP"!==y.simulcast.mode?(de.debug("simulcast chrome 78+ -> RID",y.simulcast),_.simulcast="RID",_.data.simulcast={enabled:!0,mode:"RID"},_.data.simulcast.encodings=Object.assign({},y.simulcast.encodings),me&&(_.data.simulcast.profile=me)):"chrome"===d.wL.type?(de.debug("simulcast chrome -> SDP",y.simulcast),_.simulcast="SDP",_.data.simulcast={enabled:!0,mode:"SDP"}):"firefox"===d.wL.type?(de.debug("simulcast firefox -> RID",y.simulcast),_.simulcast="RID",_.data.simulcast={enabled:!0,mode:"RID"},_.data.simulcast.encodings=Object.assign({},y.simulcast.encodings),me&&(_.data.simulcast.profile=me)):"safari"===d.wL.type&&(de.debug("simulcast safari -> SDP",y.simulcast),_.simulcast="SDP",_.data.simulcast={enabled:!0,mode:"SDP"})}return de.log("webRTCClient.accessToLocalMedia :",z.accessToLocalMedia),apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(_),this.publishCallId=_.callId,_.callControl&&_.callControl.autoRestart.stream&&de.debug("call.callControl.autoRestart.stream.active :",_.callControl.autoRestart.stream.active),"janusConnector"===this.pubConnector&&_.callControl&&_.callControl.autoRestart.stream&&_.callControl.autoRestart.stream.active?(apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,_.callLocalStream=_.callControl.autoRestart.stream,_.establishCall(),_.callId):(void 0!==a.mesh&&null!==(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(a.mesh.calleeCallId))&&oe.callConfiguration&&oe.callConfiguration.userMediaStreamId&&(_.callType=oe.callType,y.userMediaStreamId=oe.callConfiguration.userMediaStreamId),y.userMediaStreamId?((K=apiCC.getUserMediaStream(y.userMediaStreamId)).addCallInfo(_.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===this.pubConnector&&_.callControl&&(_.callControl.autoRestart.stream=K.stream),_.callConfiguration.userMediaStreamId=K.userMediaStreamId,_.callLocalStream=K.stream,_.establishCall(),_.callId):apiCC.userMediaStreamTable.length>0?((K=apiCC.userMediaStreamTable[0]).addCallInfo(_.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===this.pubConnector&&_.callControl&&(_.callControl.autoRestart.stream=K.stream),_.callConfiguration.userMediaStreamId=K.userMediaStreamId,_.callLocalStream=K.stream,_.establishCall(),_.callId):(apiCC.createUserMediaStream({callId:_.callId,type:_.callType,audioSourceId:z.audioSourceId,videoSourceId:z.videoSourceId,success:function(Q){de.debug("[publish] success; userMediaStreamId: "+Q.userMediaStreamId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&_.callControl&&(_.callControl.autoRestart.stream=Q.stream),_.callConfiguration.userMediaStreamId=Q.userMediaStreamId,_.callLocalStream=Q.stream,_.establishCall()}}),_.callId))},this.publishScreen=function(t,u,h,y){de.info("publishScreen()");var a=this.getSessionMCU(t);return a?(null==u&&(u={}),null==h&&(h={}),void 0!==h.record&&(void 0!==u.callConfiguration||(u.callConfiguration={}),u.callConfiguration.record=h.record),void 0!==h.private&&(void 0!==u.callConfiguration||(u.callConfiguration={}),u.callConfiguration.private=h.private),u.pubSub=this.pubConnector,u.type="publish",apiCC.session.apiCCWebRTCClient.webRTCClient.shareScreen(a.roomName,u,y,h)):(de.error("roomId does not match any sessionMCU"),null)},this.unpublish=function(t){de.info("unpublish call with callId :",t),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(t),this.publishCallId=null},this.removeMCUStream=function(t,u,h){var y,a=!1;for("Broken_by_MCU"!==h&&"disconnected"!==h||(a=!0),de.debug("streamId:",u),de.debug("reason:",h),de.debug("quiet:",a),y=0;y<this.streamList.length;y+=1)if(de.log("this.streamList[i].streamInfo.id :",this.streamList[y].streamInfo.id),this.streamList[y].streamInfo.id===u){!0===a?(de.debug("add stream into disputableStreamList: ",u),this.streamList[y].disputableTimeoutId=setTimeout(Oe.bind(this,this.streamList[y].streamInfo.id),3e4),this.streamList[y].clearDisputableEntry=He.bind(this,this.streamList[y].streamInfo.id),this.disputableStreamList.push(this.streamList[y])):(de.debug("remove stream from streamList:",u),apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:this.streamList[y].streamInfo}),this.streamList.splice(y,1));break}void 0!==t&&apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(t),!0!==a&&ce.createMCURemovedStreamEvent(u)},this.startStreaming=function(t,u,h,y){de.info("startStreaming");var a,m,_=null!=t&&t.length>0,P=null!=u&&u.length>0,x={};if(!_&&!P||null==h||0===h.length)return!1;if(void 0===y){if(null===this.publishCallId)return de.log("Cannot start streaming as no stream is published"),!1;y=this.publishCallId}var oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(y);return oe||(oe=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(y))?oe.sessionMCU?(_||(t="custom"),x.pubSub=this.pubConnector,x.service=t,P&&(x.server=u),x.streamKey=h,de.log("startStreaming() on Apizee MCU with roomId:",oe.sessionMCU.roomName),a={type:"startStreaming",roomId:oe.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:y,data:x},m=JSON.stringify(a),de.log("C->S: "+m),apiCC.session.channel.socket.emit("startStreaming",m),!0):(de.error("no such sessionMCU"),!1):(de.error("callIdToStream does not match any call"),!1)},this.stopStreaming=function(t){var u,h;if(de.info("stopStreaming"),void 0===t){if(null===this.publishCallId)return de.log("Cannot stop streaming as no stream is published"),!1;t=this.publishCallId}var y=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(t);if(!y)return de.error("callIdToStream does not match any call"),!1;var a=this.getSessionMCU(y.dest_roomId);return a?(de.log("stopStreaming() on Apizee MCU with roomId:",a.roomName),u={type:"stopStreaming",roomId:a.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:t,data:{pubSub:this.pubConnector}},h=JSON.stringify(u),de.log("C->S: "+h),apiCC.session.channel.socket.emit("stopStreaming",h),!0):(de.error("dest_roomId does not match any sessionMCU"),!1)},this.startRecording=function(t,u,h,y,a){var m,_;if(de.info("startRecording"),null==y){if(null===this.publishCallId)return void de.log("Call recording can not start as stream is not published");y=this.publishCallId}var P=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(y);return P||(P=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(y))?P.sessionMCU?("AUDIO-ONLY"!==t&&"VIDEO-ONLY"!==t&&(t="AUDIO-VIDEO"),null==a&&(a={}),a.pubSub=this.pubConnector,de.log("startRecording() on Apizee MCU with roomId :",P.sessionMCU.roomName),m={type:"startRecording",roomId:P.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:y,data:a,customIdInFilename:u,mediaType:t,convId:h},_=JSON.stringify(m),de.log("C->S: "+_),void apiCC.session.channel.socket.emit("startRecording",_)):(de.error("no such sessionMCU"),!1):(de.error("callIdToRecord does not match any call"),!1)},this.stopRecording=function(t){var u,h;if(de.info("stopRecording"),void 0===t){if(null===this.publishCallId)return void de.log("Call recording can not stop as stream is not published");t=this.publishCallId}var y=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(t);if(!y)return de.error("callIdToRecord does not match any call"),!1;var a=this.getSessionMCU(y.dest_roomId);if(!a)return de.error("dest_roomId does not match any sessionMCU"),!1;de.log("stopRecording() on Apizee MCU with roomId :",a.roomName),u={type:"stopRecording",roomId:a.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:t,data:{pubSub:this.pubConnector}},h=JSON.stringify(u),de.log("C->S: "+h),apiCC.session.channel.socket.emit("stopRecording",h)},this.recordingStarted=function(t){de.info("recordingStarted:",t),ce.createMCURecordingStartedEvent(t.roomName,t.callId,t.clientId,t.recordType,t.time,t.convId,t.mediaId,t.mediaURL,t.remoteId,t.recordedFileName,t.mediaType,t.descriptor)},this.recordingStopped=function(t){de.info("recordingStopped:",t),ce.createMCURecordingStoppedEvent(t.roomName,t.callId,t.clientId,t.recordType,t.time,t.convId,t.mediaId,t.mediaURL,t.remoteId,t.recordedFileName,t.mediaType,t.descriptor)},this.recordingStreamAvailable=function(t){de.info("recordingStreamAvailable :",t),ce.createMCURecordedStreamsAvailableEvent(t.roomName,t.callId,t.clientId,t.recordedFileName,t.convId,t.mediaId,t.mediaURL,t.recordType,t.remoteId,t.mediaType,t.descriptor),"janusConnector"===this.pubConnector&&t.hasOwnProperty("confId")&&t.hasOwnProperty("remoteId")&&ce.createRecordedStreamsAvailableEvent(t.confId,t.clientId,t.remoteId,t.callId,t.convId,t.mediaId,t.mediaURL)},this.streamingStarted=function(t){de.info("streamingStarted: ",t),ce.createMCUStreamingStartedEvent(t.roomName,t.callId,t.clientId,t.time)},this.streamingStopped=function(t){de.info("streamingStopped: ",t),ce.createMCUStreamingStoppedEvent(t.roomName,t.callId,t.clientId,t.time)},this.startComposite=function(t){var u,h,y;(y=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(de.log("startComposite() on Apizee MCU with roomId :",y.roomName),u={type:"startComposite",roomId:y.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},h=JSON.stringify(u),de.log("C->S: "+h),apiCC.session.channel.socket.emit("startComposite",h)):de.log("startComposite() but client is not in session")},this.stopComposite=function(t){var u,h,y;(y=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(de.log("stopComposite() on Apizee MCU with roomId :",y.roomName),u={type:"stopComposite",roomId:y.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},h=JSON.stringify(u),de.log("C->S: "+h),apiCC.session.channel.socket.emit("stopComposite",h)):de.log("stopComposite() but client is not in session")},this.startCompositeRecording=function(t,u,h,y,a){var m,_,P;de.info("startCompositeRecording with convId :",h),(P=a?this.getSessionMCU(a):this.getSessionMCU(null,{first:!0}))?("AUDIO-ONLY"!==t&&"VIDEO-ONLY"!==t&&(t="AUDIO-VIDEO"),(y=(0,d.Ym)(y,"object")?(0,d.ws)({},y):{}).pubSub=this.pubConnector,["complete","efficient","audioOnly"].indexOf(y.mode)<0&&(y.mode="complete"),y.labelEnabled=!0===y.labelEnabled,(0,d.Ym)(y,"labels","array")||(y.labels=["microphone","camera","screenSharing","sip"]),de.log("startRecording() on Apizee MCU with roomId :",P.roomName),m={type:"startRecording",roomId:P.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:"COMPOSITE",data:y,customIdInFilename:u,mediaType:t,convId:h},_=JSON.stringify(m),de.log("C->S: "+_),apiCC.session.channel.socket.emit("startRecording",_)):de.log("startCompositeRecording() but client is not in session")},this.stopCompositeRecording=function(t){var u,h,y;de.info("stopCompositeRecording"),(y=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(de.log("stopRecording() on Apizee MCU with roomId :",y.roomName),u={type:"stopRecording",roomId:y.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:"COMPOSITE",data:{pubSub:this.pubConnector}},h=JSON.stringify(u),de.log("C->S: "+h),apiCC.session.channel.socket.emit("stopRecording",h)):de.log("stopCompositeRecording() but client is not in session")},this.enforceMCU=function(t){var u;if(u=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0})){var h={type:"info",infoType:"enforceMCU",data:{clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,roomId:u.roomName,pubSub:this.pubConnector}},y=JSON.stringify(h);de.log("C->S: "+y),apiCC.session.channel.socket.emit("info",y)}else de.log("enforceMCU() but client is not in session")},this.meshPublish=function(t,u,h,y,a,m){var _=!1,P=null,x=null,oe=this.getSessionMCU(t);if(!oe)return de.error("meshPublish() - missing sessionMCU"),null;if(!0===y||!1===y||"true"===y||"false"===y?(de.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),_=y,y={}):null!==y&&"object"===le(y)||(y={}),null!==a&&"object"===le(a)||(a={}),(0,d.Ym)(y,"profileType","string")&&(a.profileType=y.profileType),(0,d.Ym)(y,"priority","number")&&y.priority>=0&&(a.priority=y.priority),(0,d.Ym)(y,"downgradeProfileList","array")&&(a.downgradeProfileList=y.downgradeProfileList),void 0!==y.audioOnly&&(_=y.audioOnly,void 0!==a.callConfiguration||(a.callConfiguration={}),a.callConfiguration.audioOnly=y.audioOnly),(0,d.Ym)(y,"context","object"))try{JSON.stringify(y.context),a.context=y.context}catch(K){}return P=new ne(apiCC.session.apiCCWebRTCClient.webRTCClient),!0!==_&&"true"!==_||(de.log("Setting call as audioOnly"),P.callType="audio"),P.roomId=t,P.sessionId=u,P.token=h,P.callConfiguration=y,P.data=a,P.options=m,P.sessionMCU=oe,apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.push(P),y.userMediaStreamId?((x=apiCC.getUserMediaStream(y.userMediaStreamId)).addCallInfo(P.userMediaId,"userMedia"),P.callConfiguration.userMediaStreamId=x.userMediaStreamId,P.callType=x.callType,P.audio=x.audio,P.video=x.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(P),apiCC.checkMutingStateForUserMedia(y,x)):apiCC.createUserMediaStream({callId:P.userMediaId,callFlavor:"userMedia",type:P.callType,audioSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.audioSourceId,videoSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.videoSourceId,success:function(K){de.debug("[meshPublish] success; userMediaStreamId: "+K.userMediaStreamId),P.callConfiguration.userMediaStreamId=K.userMediaStreamId,P.callType=K.callType,P.audio=K.audio,P.video=K.video,apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(P),apiCC.checkMutingStateForUserMedia(y,K)}}),P.userMediaId},this.meshOnUserMediaSuccess=function(t){var u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=null,y=null;!0===u?((h={}).type="streamStatusChanged",h.callerId=z.clientId,h.roomId=t.roomId,h.streams={},h.streams[t.userMediaId]={eventType:"modify",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},h.data={},h.data.meshPublish=!0,h.data.pubSub=this.pubConnector,y=JSON.stringify(h),de.log("C->S: "+y),apiCC.session.channel.socket.emit("streamStatusChanged",y)):(this.publishCallId=t.userMediaId,t.addAck=!0,t.addTimeoutId=setTimeout(function(){z.onRemoteHangup(t.userMediaId,z.clientId,t.roomId,"Unable_to_establish",null,null)},t.disconnectionTimer),(h={}).type="streamStatusChanged",h.callerId=z.clientId,h.roomId=t.roomId,h.streams={},h.streams[t.userMediaId]={eventType:"add",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},h.data=t.data,h.data.meshPublish=!0,h.data.pubSub=this.pubConnector,y=JSON.stringify(h),de.log("C->S: "+y),apiCC.session.channel.socket.emit("streamStatusChanged",y))},this.meshPublishScreen=function(t,u,h,y,a){var m=null,_=null,P=this.getSessionMCU(t);return P?(null!==h&&"object"===le(h)||(h={}),(m=new ne(apiCC.session.apiCCWebRTCClient.webRTCClient)).roomId=t,m.data=u,m.callConfiguration=h,m.captureSourceType=y,m.sessionMCU=P,apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.push(m),h.userMediaStreamId?((_=apiCC.getUserMediaStream(h.userMediaStreamId)).addCallInfo(m.userMediaId,"userMedia"),m.callConfiguration.userMediaStreamId=_.userMediaStreamId,m.callType=_.callType,m.audio=_.audio,m.video=_.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(m)):apiCC.createUserMediaStream({callId:m.userMediaId,callFlavor:"userMedia",type:"screenSharing",captureSourceType:y,success:function(x){de.debug("[meshPublishScreen] success; userMediaStreamId: "+x.userMediaStreamId),m.callConfiguration.userMediaStreamId=x.userMediaStreamId,m.callType=x.callType,m.audio=x.audio,m.video=x.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnScreenMediaSuccess(m)}}),m.userMediaId):(de.error("meshPublishScreen() - missing sessionMCU"),null)},this.meshOnScreenMediaSuccess=function(t){var u,h=null;t.addAck=!0,t.addTimeoutId=setTimeout(function(){z.onRemoteHangup(t.userMediaId,z.clientId,t.roomId,"Unable_to_establish",null,null)},t.disconnectionTimer),(h={}).type="streamStatusChanged",h.callerId=z.clientId,h.roomId=t.roomId,h.streams={},h.streams[t.userMediaId]={eventType:"add",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},h.data={},h.data.pubSub=this.pubConnector,u=JSON.stringify(h),de.log("C->S: "+u),apiCC.session.channel.socket.emit("streamStatusChanged",u)},this.meshOnHangup=function(t,u){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=0,a=null,m=null,_=null;if(null!==u&&"object"===le(u)||(u={}),t){if(null!==(a=z.findUserMediaById(t)))for(a.close(),!0!==a.streamStolen&&(z.myWebRTC_Event.createHangupEvent("local",z.clientId,0,!0,null,a.userMediaId,a.callType),a.releaseUserMediaStream()),(m={}).type="streamStatusChanged",m.callerId=z.clientId,m.roomId=a.roomId,m.streams={},m.streams[a.userMediaId]={eventType:"remove",callId:a.userMediaId,callType:a.callType},h.restart&&(m.streams[a.userMediaId].restart=!0),m.data={},m.data.pubSub=this.pubConnector,_=JSON.stringify(m),de.log("C->S: "+_),apiCC.session.channel.socket.emit("streamStatusChanged",_),y=z.userMediaTable.length;--y>=0;)if(z.userMediaTable[y]===a){z.userMediaTable.splice(y,1);break}}else for(y=z.userMediaTable.length;--y>=0;)a=z.userMediaTable[y],h.hasOwnProperty("roomId")&&a.sessionMCU.roomName!==h.roomId||(z.myWebRTC_Event.createHangupEvent("local",z.clientId,0,!0,null,a.userMediaId,a.callType),a.close(),a.releaseUserMediaStream(),(m={}).type="streamStatusChanged",m.callerId=z.clientId,m.roomId=a.roomId,m.streams={},m.streams[a.userMediaId]={eventType:"remove",callId:a.userMediaId,callType:a.callType},m.data={},m.data.pubSub=this.pubConnector,_=JSON.stringify(m),de.log("C->S: "+_),apiCC.session.channel.socket.emit("streamStatusChanged",_),z.userMediaTable.splice(y,1))},this.participantEjected=function(t){(0,d.Ym)(t.data,"clientId","string")&&z.myWebRTC_Event.createMCUParticipantEjectedEvent(t.roomId,t.data.clientId,t.data.info)},this.ejectParticipant=function(t,u,h){var y;if(y=h?this.getSessionMCU(h):this.getSessionMCU(null,{first:!0})){var a={type:"ejectParticipant",roomId:y.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector,clientId:t}};u&&(a.data.info=u);var m=JSON.stringify(a);de.log("C->S: "+m),apiCC.session.channel.socket.emit("ejectParticipant",m)}else de.debug("ejectParticipant() - missing sessionMCU")},this.getJoinSessionReq=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=null;if(!t){if(u.hasOwnProperty("transactionId")){for(var y=this.joinSessionReqs.length;--y>=0;)if(this.joinSessionReqs[y].transactionId===u.transactionId){h=this.joinSessionReqs[y];break}return h}return null}for(var a=this.joinSessionReqs.length;--a>=0;)if(this.joinSessionReqs[a].roomId===t){h=this.joinSessionReqs[a];break}return h},this.removeJoinSessionReq=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t){if(!0===u.all)return this.joinSessionReqs.splice(0,this.joinSessionReqs.length),!0;u.hasOwnProperty("roomId")&&(t=this.getJoinSessionReq(u.roomId))}if(!t)return!1;for(var h=this.joinSessionReqs.length;--h>=0&&this.joinSessionReqs[h]!==t;);return h>=0&&(this.joinSessionReqs.splice(h,1),!0)},this.getSessionMCU=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=null;if(!t){if(!0===u.first)return this.sessionMCUs[0];if((0,d.Ym)(u.callback,"function")){de.debug("getSessionMCU callback");for(var y=this.sessionMCUs.length;--y>=0;)if(u.callback(this.sessionMCUs[y])){h=this.sessionMCUs[y];break}}return h}for(var a=this.sessionMCUs.length;--a>=0;)if(this.sessionMCUs[a].roomName===t){h=this.sessionMCUs[a];break}return h},this.removeSessionMCU=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t&&!0===u.all)return this.sessionMCUs.splice(0,this.sessionMCUs.length),!0;if(!t)return!1;for(var h=this.sessionMCUs.length;--h>=0&&this.sessionMCUs[h]!==t;);return h>=0&&(this.sessionMCUs.splice(h,1),!0)},this.callback=function(t,u){return this.closureHandler=function(h){return t[u](h)},this.closureHandler}};function Oe(z){de.debug("disputableEntryTimeout",z);for(var M=apiCC.session.apiCCWebRTCClient.webRTCClient,t=this.disputableStreamList.length;--t>=0;)if(this.disputableStreamList[t].streamInfo.id===z){this.disputableStreamList.splice(t,1);break}for(var u=null,h=this.streamList.length;--h>=0;)if(this.streamList[h].streamInfo.id===z){u=M.destroyCallControl({type:"subscribe",stream:this.streamList[h].streamInfo}),this.streamList.splice(h,1);break}u&&u.callId&&ce.createHangupEvent("remote",M.clientId,u.roomName,!1,"Hangup_From_Callee",u.callId,u.callType),ce.createMCURemovedStreamEvent(z)}function He(z){de.debug("clearDisputableEntry",z);for(var M=this.disputableStreamList.length;--M>=0;)if(this.disputableStreamList[M].streamInfo.id===z){this.disputableStreamList.splice(M,1);break}for(var t=this.streamList.length;--t>=0;)if(this.streamList[t].streamInfo.id===z){this.streamList[t].disputableTimeoutId&&(clearTimeout(this.streamList[t].disputableTimeoutId),delete this.streamList[t].disputableTimeoutId),delete this.streamList[t].clearDisputableEntry;break}}function ke(z){var M={};return(0,d.ki)(z,"maxBitrate","number")&&(M.maxBitrate=z.maxBitrate),(0,d.ki)(z,"scaleResolutionDownBy","number")&&(M.scaleResolutionDownBy=z.scaleResolutionDownBy),M}function ze(z){return(0,d.Ym)(z.encodings,"object")?(0,d.ki)(z.encodings.high,"maxBitrate","number")&&(0,d.ki)(z.encodings.medium,"maxBitrate","number")&&(0,d.ki)(z.encodings.low,"maxBitrate","number")?(z.encodings.high=Object.assign({active:!0},ke(z.encodings.high)),z.encodings.medium=Object.assign({active:!0},ke(z.encodings.medium)),z.encodings.low=Object.assign({active:!0},ke(z.encodings.low)),z.sendEncodings=[{rid:"h",active:!0},{rid:"m",active:!0},{rid:"l",active:!0}],z.sendEncodings[0].maxBitrate=1e3*z.encodings.high.maxBitrate,z.sendEncodings[1].maxBitrate=1e3*z.encodings.medium.maxBitrate,z.sendEncodings[2].maxBitrate=1e3*z.encodings.low.maxBitrate,(0,d.ki)(z.encodings.medium,"scaleResolutionDownBy","number")&&(z.sendEncodings[1].scaleResolutionDownBy=z.encodings.medium.scaleResolutionDownBy),(0,d.ki)(z.encodings.low,"scaleResolutionDownBy","number")&&(z.sendEncodings[2].scaleResolutionDownBy=z.encodings.low.scaleResolutionDownBy),!0):(de.warn("no such maxBitrate"),!1):(de.warn("no such encodings"),!1)}function we(z,M){if(M<650)return!1;var t=Math.floor(9*M/13),u=Math.floor(3*M/13);return z.encodings={high:{maxBitrate:t},medium:{maxBitrate:u,scaleResolutionDownBy:2},low:{maxBitrate:M-t-u,scaleResolutionDownBy:4}},ze(z)}i.Y.get("CallControl");var gt=function(z){this.type=z.type,z.callId&&(this.callId=z.callId),this.callType=z.callType?z.callType:"media",Object.prototype.hasOwnProperty.call(z,"audioOnly")&&(this.audioOnly=!!z.audioOnly),z.roomName&&(this.roomName=z.roomName),z.mediaType&&(this.mediaType=z.mediaType),z.callConfiguration&&(this.callConfiguration=z.callConfiguration),z.data&&(this.data=z.data),z.stream&&(this.stream=z.stream),this.autoRestart={}},ft=function(){var z=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];this.a=1,this.b=0,this.c=7,this.d=0,this.update=function(M,t,u){var h=0;for(null==t&&(t=0),null==u&&(u=M.length);h<u;h+=1)this.a=(this.a+M[t+h])%65521,this.b=(this.b+this.a)%65521,this.c=(this.c+3)*(M[t+h]+5)%65521,this.d=(this.d+this.c)%65521},this.digest=function(M){return z[this.d>>12&15]+z[this.d>>8&15]+z[this.d>>4&15]+z[15&this.d]+z[this.c>>12&15]+z[this.c>>8&15]+z[this.c>>4&15]+z[15&this.c]+z[this.b>>12&15]+z[this.b>>8&15]+z[this.b>>4&15]+z[15&this.b]+z[this.a>>12&15]+z[this.a>>8&15]+z[this.a>>4&15]+z[15&this.a]}};function at(z,M){return null==M&&(M={}),"checksum64"===z?new ft:null}function Ze(z){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(z)}var ie=i.Y.get("WebRTC_Client"),bt=apiCC.myWebRTC_Event,Ct=function(z){function M(t,u,h){var y,a=t.width,m=a<<2,_=t.height,P=null,x=0,oe=0,K=0,X=0,me=0,Q=0,re=0,ye=0,Se=0,ge=0,Pe=0,xe=0,We=0,rt=0,Et=0,Qe=0;if(u){for(P=u.data,h<0&&(h=0),ye=1-((me=(2.44413*(x=h>=2.5?.98711*h-.9633:h>=.5?3.97156-4.14554*Math.sqrt(1-.26891*h):2*h*(3.97156-4.14554*Math.sqrt(.865545)))+2.85619*(oe=x*x)+1.26661*(K=oe*x))/(X=1.57825+2.44413*x+1.4281*oe+.422205*K))+(Q=-(1.4281*oe+1.26661*K)/X)+(re=.422205*K/X)),y=0;y<3;y++)for(Se=0;Se<_;Se++){for(Pe=Se*m+(a-1<<2)+y,Et=rt=We=xe=P[ge=Se*m+y],ge=Se*m+y;ge<=Pe;ge+=4)P[ge]=xe=ye*P[ge]+me*We+Q*rt+re*Et,Et=rt,rt=We,We=xe;for(Pe=Se*m+y,Et=rt=We=xe=P[ge=Se*m+(a-1<<2)+y],ge=Se*m+(a-1<<2)+y;ge>=Pe;ge-=4)P[ge]=xe=ye*P[ge]+me*We+Q*rt+re*Et,Et=rt,rt=We,We=xe}for(y=0;y<3;y++)for(Qe=0;Qe<a;Qe++){for(Pe=(_-1)*m+(Qe<<2)+y,Et=rt=We=xe=P[ge=(Qe<<2)+y],ge=(Qe<<2)+y;ge<=Pe;ge+=m)P[ge]=xe=ye*P[ge]+me*We+Q*rt+re*Et,Et=rt,rt=We,We=xe;for(Pe=(Qe<<2)+y,Et=rt=We=xe=P[ge=(_-1)*m+(Qe<<2)+y],ge=(_-1)*m+(Qe<<2)+y;ge>=Pe;ge-=m)P[ge]=xe=ye*P[ge]+me*We+Q*rt+re*Et,Et=rt,rt=We,We=xe}return u}}this.localVideo=null,this.miniVideo=null,this.remoteVideo=null,this.localStream=null,this.statusDiv=null,this.commandDiv=null,this.remoteStream=null,this.channelReady=!1,this.socket=z.channel.socket,this.clientId=z.apiCCId,this.compositeClientId=z.apiCCId+"@"+z.apiCCSessionId,this.apiKey=z.apiKey,this.isVideoMuted=!1,this.isAudioMuted=!1,this.callURLDestRoom=0,this.callControlTable=[],this.userMediaTable=[],this.callsTable=[],this.callsRetriesTable={},this.restartCallDelay=1e3,this.maxCallsRetriesDuration=15e4,this.accessToLocalMedia=!1,this.unidirectionelCallOnly=!1,this.NtoNConf=!1,this.autoAnswer=!1,this.RTPMedia=!1,this.logoAdded=!1,this.preferOpusCodec=!1,this.preferVP9Codec=!1,"undefined"!=typeof apiRTC_React&&"iOS"===c.BF?(ie.log("React and iOS : Setting H264 as preferred codec"),this.preferH264Codec=!0):this.preferH264Codec=!1,this.preferSendingH264Codec=!1,this.setStereo=!1,this.allowedAudioCodecs="",this.allowedVideoCodecs="",this.mediaRoutingModeEnum={hostOnly:1,stun:2,stunOnly:3,turn:4,turnOnly:5},this.mediaRoutingMode=this.mediaRoutingModeEnum.turn,this.myWebRTC_Event=apiCC.myWebRTC_Event,this.getUserMediaOnGoing=!1,this.userAcceptOnIncomingCall=!1,this.userAcceptOnIncomingCallBeforeGetUserMedia=!1,this.userAcceptOnIncomingDataCall=!1,this.userAcceptOnIncomingScreenSharingCall=!1,this.maxWidthRemoteVideo=0,this.maxHeightRemoteVideo=0,this.nickname=z.nickname,this.hideLocalVideoOnCall=!0,this.allowMultipleCalls=!1,this.mySDPManager=new v,this.MCUClient=new Ne(this,this.clientId),this.audioSourceId=null,this.audioOutputId=null,this.videoSourceId=null,this.facingMode=null,this.apiRTCExtensionInstalled=!1,this.trickleIce=!0,this.waitingShareScreenCallId=0,this.waitingShareScreenDestNumber=0,this.waitingCaptureSourceType=null,this.qosEnable=!1,this.qosInterval=5e3,this.csmEnable=!1,this.qualityScoreEnable=!1,this.qualityScoreIntervalMs=5e3,this.csmIntervalMs=5e3,this.recordedCall=!1,this.audioBandwidth=null,this.videoBandwidth=null,this.videoRemoteBandwidth=null,this.videoBandwidthSettings={},this.dataBandwidth=null,this.pc_config="",this.clientIncomingCandidatesQueue=[],this.cleanStoredCallCandidateTimer=6e4,this.initializeGumConfig=function(){this.gum_config="Edge"===c.Xh&&c.PR>=15?{audio:!0,video:!0}:"Chrome"===c.Xh&&c.PR<49||"Firefox"===c.Xh&&c.PR<50?{audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}}:{audio:{},video:{}}},this.initializeGumConfig(),this.setGumConfigWithDevicePresent=function(){!1===apiCC.mediaDeviceMgr.audioDevicePresent&&(this.gum_config.audio=!1),!1===apiCC.mediaDeviceMgr.videoDevicePresent&&(this.gum_config.video=!1),!1===apiCC.mediaDeviceMgr.audioDevicePresent&&!1===apiCC.mediaDeviceMgr.videoDevicePresent&&(this.unidirectionelCallOnly=!0),ie.log("this.gum_config:",this.gum_config)},this.userMediaErrorDetected=!1,this.lastUsedUserMediaConstraint=null,this.mediaTypeForIncomingCall="VIDEO",this.mediaTypeForOutgoingCall="VIDEO",this.allowAsymetricMediaCalls=!1,this.receiveMediaDeactivated=!1,this.configTurnServer=null,apiCC.myWebRTC_Adapter.adaptForIoSCordova(),this.pc_config={iceServers:[{urls:["turns:mp1.apizee.com:443?transport=udp","turns:mp1.apizee.com:443?transport=tcp","turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp","turns:mp2.apizee.com:443?transport=udp","turns:mp2.apizee.com:443?transport=tcp","turn:mp2.apizee.com:443?transport=udp","turn:mp2.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]},"Firefox"===c.Xh&&c.PR<53?(ie.log("createPeerConnection FIREFOX"),ie.log("webrtcDetectedVersion : "+apiCC.myWebRTC_Adapter.webrtcDetectedVersion),this.pc_config=c.PR<38?{iceServers:[{url:"stun:mp1.apizee.com:443",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443",credential:"password",username:"anonymous"}]}:c.PR>=42?{iceServers:[{urls:["turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]}:{iceServers:[{urls:"turn:mp1.apizee.com:443?transport=tcp",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443?transport=tcp",credential:"password",username:"anonymous"}]}):"IE"===c.Xh||"Safari"===c.Xh&&c.PR<11?(ie.log("Browser is :"+c.Xh+" - using Plugin"),this.pc_config={iceServers:[{url:"stun:mp1.apizee.com:443",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443",credential:"password",username:"anonymous"}]}):"Edge"===c.Xh&&c.PR<45?(ie.log("Browser is Edge - removing Turns config"),this.pc_config={iceServers:[{urls:["turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp","turn:mp2.apizee.com:443?transport=udp","turn:mp2.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]}):ie.log("default this.pc_config configuration"),this.pc_constraints={optional:[]},"edge"===d.wL.type?ie.debug("not data channel capable"):"safari"===d.wL.type?d.wL.version>=11?this.dataChannelCapable=!0:ie.debug("not data channel capable"):this.dataChannelCapable=!0,"chrome"===d.wL.type&&d.wL.version>=68||"firefox"===d.wL.type&&d.wL.version>=64||"safari"===d.wL.type&&d.wL.version>=12?(ie.debug("RTCRtpSender#setParameters is available"),this.rtpSenderSetParamatersCapable=!0):(ie.debug("RTCRtpSender#setParameters is NOT available"),this.rtpSenderSetParamatersCapable=!1),this.initialize=function(t,u,h,y,a){this.localVideo=document.getElementById(t),null===this.localVideo&&ie.log("localVideo Div Name is not correct : INCORRECT_DIV_NAME_LOCALVIDEO"),this.miniVideo=document.getElementById(u),null===this.miniVideo&&ie.log("miniVideo Div Name is not correct : INCORRECT_DIV_NAME_MINIVIDEO"),this.remoteVideo=document.getElementById(h),null===this.remoteVideo&&ie.log("remoteVideo Div Name is not correct : INCORRECT_DIV_NAME_REMOTEVIDEO"),this.statusDiv=document.getElementById(y),null===this.statusDiv&&ie.log("status Div Name is not correct : INCORRECT_DIV_NAME_STATUS"),this.commandDiv=document.getElementById(a),null===this.commandDiv?ie.log("command Div Name is not correct : INCORRECT_DIV_NAME_COMMAND"):(ie.log("Command buttons are managed by ApiRTC"),this.displayCallButtonInCommand()),0!==this.callURLDestRoom&&(ie.log("callURLDestRoom is not null"),this.callperURL(this.callURLDestRoom),this.callURLDestRoom=0),this.initMediaElementState(),this.setStatus("<div>Your phone is registered, you can be reached at this number : "+this.clientId+"</div>")},this.setClientTurnServer=function(t){ie.info("setClientTurnServer :",t);var u=JSON.stringify(this.pc_config);u=u.replace(/mp1.apizee.com/g,t),this.pc_config=JSON.parse(u)},this.activateScreenSharing=function(t){apiCC.activateScreenSharing(t)},this.setGetUserMediaConfig=function(t){if(ie.log("setGetUserMediaConfig :",t),null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices.getSupportedConstraints&&void 0!==navigator.mediaDevices.getSupportedConstraints){var u=navigator.mediaDevices.getSupportedConstraints();ie.log("Supported Constraints :",u)}void 0!==t.video&&(void 0===t.video.height&&void 0===t.video.width||void 0!==t.optional&&(ie.warn("contraints with both optional/mandatory and specific or advanced constraints usage : this may failed depending of browsers"),ie.log("setGetUserMediaConfig : contraints modification to avoid both optional/mandatory and specific or advanced constraints usage"),void 0!==t.optional.sourceId&&(ie.log("sourceId contraints modification to deviceId"),void 0===t.video.deviceId&&(t.video.deviceId={}),t.video.deviceId.ideal=t.optional.sourceId),delete t.optional)),ie.log("this.gum_config :",this.gum_config),this.gum_config=t},this.getUserMedia=function(){try{this.gum_config=apiCC.setAudioSourceIdInConstraint(this.audioSourceId,this.gum_config),this.gum_config=apiCC.setVideoSourceIdInConstraint(this.videoSourceId,this.gum_config),this.lastUsedUserMediaConstraint=this.gum_config,"IE"===c.Xh&&c.dc>8?apiCC.getUserMediaWithCB(this.gum_config,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):apiCC.getUserMedia(this.gum_config).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError"))}catch(t){ie.error("getUserMedia() failed. Is this a WebRTC capable browser?"),ie.log("getUserMedia failed with exception: "+t.message)}},this.onUserMediaSuccess=function(t){ie.info("onUserMediaSuccess : User has granted access to local media."),this.accessToLocalMedia=!0;var u=!1,h="Unknown",y=!1,a="Unknown";this.miniVideo&&apiCC.attachMediaStream(this.miniVideo,t),this.localVideo&&(apiCC.attachMediaStream(this.localVideo,t),this.localVideo.style.opacity=1),this.localStream=t,t.getAudioTracks().length>0&&(u=!0,t.getAudioTracks()[0].label&&(h=t.getAudioTracks()[0].label),ie.log("Using audio device: "+h)),t.getVideoTracks().length>0&&(y=!0,t.getVideoTracks()[0].label&&(a=t.getVideoTracks()[0].label),ie.log("Using video device: "+a)),this.myWebRTC_Event.createUserMediaSuccessEvent(!1,u,h,y,a,"media",null,t,null,!1)},this.onUserMediaError=function(t){ie.info("onUserMediaError : Failed to get access to local media. Error : ",t),ie.error(t),this.accessToLocalMedia=!1,"electron"!==c.$6&&"Chrome"===c.Xh&&c.PR>47&&(ie.log("browser_version > 47"),"https:"!==window.location.protocol&&ie.error("HTTPS is now mandatory to use getUserMedia()")),this.myWebRTC_Event.createUserMediaErrorEvent(!1,"media",t,null,null,null,this.gum_config),t=null,!0===apiCC.session.tryAudioCallAfterUserMediaError?(ie.log("this.lastUsedUserMediaConstraint :",this.lastUsedUserMediaConstraint),ie.log("this.lastUsedUserMediaConstraint.video :",this.lastUsedUserMediaConstraint.video),!1!==this.lastUsedUserMediaConstraint.video?(ie.log("this.lastUsedUserMediaConstraint.audio :",this.lastUsedUserMediaConstraint.audio),ie.log("UserMediaError, Trying to getUserMedia with audioOnly"),this.videoSourceId=null,this.gum_config.video=!1,this.getUserMedia()):ie.log("onUserMediaError without video")):ie.log("try AudioCall after UserMediaError is not activated")},this.evalCallProfileWithSdp=function(t,u,h){return this.evalCallProfileWithSdpGuideline(this.mySDPManager.createGuideline(t),t,u,h)},this.evalCallProfileWithSdpGuideline=function(t,u,h,y){var a={};return t.hasOwnProperty("audio")?(a.audio=!0,a.audioActive="local"===h&&"send"===y?"sendrecv"===t.audio.direction||"sendonly"===t.audio.direction:"local"===h&&"receive"===y||"remote"===h&&"send"===y?"sendrecv"===t.audio.direction||"recvonly"===t.audio.direction:"remote"===h&&"receive"===y&&("sendrecv"===t.audio.direction||"sendonly"===t.audio.direction)):(a.audio=!1,a.audioActive=!1),t.hasOwnProperty("video")?(a.video=!0,a.videoActive="local"===h&&"send"===y?"sendrecv"===t.video.direction||"sendonly"===t.video.direction:"local"===h&&"receive"===y||"remote"===h&&"send"===y?"sendrecv"===t.video.direction||"recvonly"===t.video.direction:"remote"===h&&"receive"===y&&("sendrecv"===t.video.direction||"sendonly"===t.video.direction)):(a.video=!1,a.videoActive=!1),a},this.checkDestCallTypeWithSDP=function(t,u){ie.debug("checkDestCallTypeWithSDP");var h=this.mySDPManager.createGuideline(t),y=!1,a=!1;!h.audio||"sendrecv"!==h.audio.direction&&"sendonly"!==h.audio.direction||(y=!0),!h.video||"sendrecv"!==h.video.direction&&"sendonly"!==h.video.direction||(a=!0),u.destCallType=!0===y?!0===a?"media":"audio":!0===a?"videoOnly":"inactive",ie.debug("call.destCallType: "+u.destCallType),!0!==u.callee||h.audio&&"sendonly"!==h.audio.direction||h.video&&"sendonly"!==h.video.direction||(u.userMediaAccessRequired=!1,u.mediaTypeForOutgoingCall="NONE",ie.debug("access to user media not required"))},this.evaluateVideoCap=function(t){delete t.videoCap,t.belongsToRoom()?"publish"!==t.settingUpType&&"shareScreen"!==t.settingUpType||t.localCallProfile&&t.localCallProfile.video&&t.localCallProfile.videoActive&&this.evalOutgoingVideoBandwithCap(t):(this.rtpSenderSetParamatersCapable||!t.callee)&&t.localCallProfile&&t.localCallProfile.video&&t.localCallProfile.videoActive&&this.evalOutgoingVideoBandwithCap(t)},this.processInvite=function(t){ie.info("processInvite() - invite received from :"+t.callerId);var u,h=0,y=null,a=null,m=null,_=null,P=!1,x=null,oe=null,K=null,X={};if(void 0!==t.data&&"publish"===t.data.type&&void 0!==t.data.mesh){if(ie.info("received invite publish mesh; mesh: "+JSON.stringify(t.data.mesh)),null==(y=this.findCallWithCallIdAndInstanceId(t.data.mesh.callerCallId,t.data.instanceId)))return void ie.error("cannot find call; callId: "+t.data.mesh.callerCallId);y.userMediaAccessRequired=!1,y.data.mesh=t.data.mesh,y.setupTimeoutId&&(clearTimeout(y.setupTimeoutId),delete y.setupTimeoutId),P=!0}else{if(void 0!==t.data&&"subscribe"===t.data.type&&void 0!==t.data.mesh){if(ie.debug("received invite subscribe mesh; mesh: ",t.data.mesh),null!==(a=this.findUserMediaById(t.data.mesh.calleeCallId)))if(this.MCUClient.distantCalls.push({early:!0,roomId:t.roomId,clientId:t.data.mesh.callerId,callId:t.data.mesh.callerCallId,callMode:"mesh",callDirection:"recvonly",callFeed:{clientId:t.data.mesh.calleeId,callId:t.data.mesh.calleeCallId}}),setTimeout(function(re,ye,Se){ie.debug("early distant call descriptor timeout");for(var ge=this.MCUClient.distantCalls.length;--ge>=0;)if(this.MCUClient.distantCalls[ge].early&&this.MCUClient.distantCalls[ge].roomId===re&&this.MCUClient.distantCalls[ge].clientId===ye&&this.MCUClient.distantCalls[ge].callId===Se){ie.debug("remove early distant call descriptor: timeout"),this.MCUClient.distantCalls.splice(ge,1);break}}.bind(this,t.roomId,t.data.callerId,t.data.callerCallId),3e4),"screenSharing"===a.callType||"screenSharingWithAudio"===a.callType)X.type="publish",X.mesh=t.data.mesh,X.instanceId=t.data.instanceId,this.MCUClient.publishScreen(t.roomId,X,null,a.captureSourceType);else{var me=(0,d.ws)({},a.callConfiguration);"AUDIOONLY"===t.data.mediaType?me.audioOnly=!0:"VIDEOONLY"===t.data.mediaType&&(me.videoOnly=!0),(m=apiCC.getUserMediaStream(me.userMediaStreamId))&&(m.audioMuted&&m.videoMuted?me.muted="VIDEO":m.audioMuted?me.muted="AUDIOONLY":m.videoMuted?me.muted="VIDEOONLY":delete me.muted),delete me.distributedBroadcastEnabled,delete me.simulcast,X.type="publish",X.mesh=t.data.mesh,X.instanceId=t.data.instanceId,this.MCUClient.publish(t.roomId,null,null,me,X,null)}else ie.debug("media not found: sending bye : Call_not_found"),new L.S(apiCC.session.channel.socket).sendBye(t.callId,t.calleeId,t.roomId,t.callerId,"Call_not_found",t.data);return}if(void 0!==t.data&&"publish"===t.data.type&&"passive"===t.data.mode){if(null==(y=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId,t.data.instanceId)))return void ie.debug("cannot find call; callId: "+t.callId+", callerId: "+t.callerId+", instanceId: "+t.data.instanceId);y.userMediaAccessRequired=!1,y.setupTimeoutId&&(clearTimeout(y.setupTimeoutId),delete y.setupTimeoutId),P=!0}else(y=new H(this)).callId=t.callId,y.instanceId=t.data.instanceId,y.callerId=t.callerId,y.calleeId=this.clientId,y.callee=!0,y.remoteId=t.callerId}if(y.dest_roomId=t.roomId,void 0!==y.data&&!0===P)for(K in t.data)t.data.hasOwnProperty(K)&&(y.data[K]=t.data[K]);else y.data=t.data;if(y.data.instanceId=y.instanceId,void 0!==t.data&&"sipConnector"===t.data.pubSub&&(y.trickleIce=!1,y.remoteType="sip"),y.checkDTLSCompliancy(),"Edge"===c.Xh&&(x=apiCC.session.getConnectedUserInfo(t.callerId,"userData"),ie.log("destUserInfo :",x),"User_Not_Found"!==x&&void 0!==x&&"Chrome"===(oe=JSON.parse(x)).browser&&"Android"===oe.osName&&(ie.log("Browser is Edge and caller is Chrome on Android, setting VP8 as prefered codec for the call"),y.preferVP8Codec=!0)),void 0!==t.data&&"publish"===t.data.type&&"passive"===t.data.mode&&void 0!==t.stream&&void 0!==t.stream.id&&(y.streamId=t.stream.id,ie.log("call.streamId: "+y.streamId)),ie.log("processInvite() - Actual call Number is :"+(h=this.callsTable.length)),"screenSharing"===t.callType||"screenSharingWithAudio"===t.callType)y.screenSharing=!0,y.callType=t.callType;else if("data"!==t.callType&&!1===this.allowMultipleCalls){for(ie.log("processInvite() - Refusing double call checking ..."),u=0;u<h;u+=1)if("screenSharing"!==this.callsTable[u].callType&&"screenSharingWithAudio"!==this.callsTable[u].callType&&"data"!==this.callsTable[u].callType)return ie.log("processInvite() - Refusing double call"),!1===P?this.callsTable.push(y):ie.log("callAlreadyExist in table"),this.myWebRTC_Event.createCallAttemptEvent(this.clientId,t.callerId,t.callerNickname,y.callId),void this.refuseCall(y.callId,"User_Busy");ie.log("NOT Refusing double call")}!1===P?(h=this.callsTable.push(y),ie.log("processInvite() - New call Number is :"+h)):(ie.log("callAlreadyExist in table"),ie.log("processInvite() - call Number is :"+h)),this.checkDestCallTypeWithSDP(t.sdpoffer.sdp,y);var Q=this.mySDPManager.createGuideline(t.sdpoffer.sdp);if(y.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(Q,t.sdpoffer.sdp,"remote","send")),y.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(Q,t.sdpoffer.sdp,"remote","receive")),this.rtpSenderSetParamatersCapable||(this.evaluateVideoCap(y),y.videoCap&&(Q.video.bandwidth=y.videoCap,t.sdpoffer.sdp=Q.generate())),y.receivedSdpOfferMessage=t.sdpoffer,(0,d.ki)(t,"stream","object")&&(!0===t.stream.audioMuted&&(y.isRemoteAudioMuted=!0),!0===t.stream.videoMuted&&(y.isRemoteVideoMuted=!0)),!0===this.autoAnswer&&this.displayHangUpButtonInCommand(),"data"===t.callType){if(ie.log("Receiving DATA call"),y.callType="data",y.dataCall=!0,"Edge"===c.Xh&&c.PR<79)return ie.warn("Cannot create DataChannel as it is not supported on Edge"),void this.refuseCall(y.callId,"DataChannel_Not_Supported");this.setStatus("Incoming data Call from ongoing :"+t.callerId),this.userAcceptOnIncomingDataCall||y.onUserMediaSuccessTestUni(),this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,y.callId,!1,h,!1,t.callType,!1,y.remoteType,y.destCallType)}else!1===y.userMediaAccessRequired||this.unidirectionelCallOnly||!0===y.screenSharing?(ie.log("call.userMediaAccessRequired :",y.userMediaAccessRequired),ie.log("this.unidirectionelCallOnly :",this.unidirectionelCallOnly),ie.log("call.screenSharing :",y.screenSharing),this.unidirectionelCallOnly&&this.setStatus("You are connected to "+t.callerId+', your audio and video media are not transmitted. <input type="button" id="AddMedia" value="Activate Audio & Video" onclick="apiCC.session.apiCCWebRTCClient.addMedia('+y.callId+')" />'),!0===y.screenSharing?!1===this.userAcceptOnIncomingScreenSharingCall?(this.setStatus("Screensharing session activated, accepting unidirectionnel call"),y.onUserMediaSuccessTestUni()):ie.debug("userAcceptOnIncomingScreenSharingCall is activated : need user accept"):!0===P?(ie.log("processInvite() - callAlreadyExist"),y.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCall||!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("processInvite() - Waiting for call accept or refuse from user - 1"):(ie.log("processInvite() - userAcceptOnIncomingCall is not activated"),y.onUserMediaSuccessTestUni()),void 0!==t.data&&!0===t.data.subscribeOrder||!1!==P||this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,y.callId,!1,h,!1,t.callType,!1,y.remoteType,y.destCallType)):(apiCC.userMediaStreamTable.length>0&&(_=apiCC.userMediaStreamTable[0].userMediaStreamId),!0!==this.accessToLocalMedia&&!_||!0!==this.autoAnswer?(this.setStatus("Incoming Call from :"+t.callerId+'. Click on "Autoriser" button to accept.'),!0===y.audioOnly&&!1===apiCC.mediaDeviceMgr.audioDevicePresent?(ie.log("processInvite() - audio and video media are not transmitted"),this.setStatus("You are connected to "+t.callerId+', your audio and video media are not transmitted. <input type="button" id="AddMedia" value="Activate Audio & Video" onclick="apiCC.session.apiCCWebRTCClient.addMedia('+y.callId+')" />'),y.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("Stand-by :: wait for getUserMediaOnCall && establishCall"):(ie.debug("processInvite() - call.getUserMediaOnCall()"),ie.log("processInvite() - this.autoAnswer :"+this.autoAnswer),y.getUserMediaOnCall()),!1===P&&this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,y.callId,!1,h,y.audioOnly,t.callType,!1,y.remoteType,y.destCallType)):(this.setStatus("You are connected to :"+t.callerId),ie.log("processInvite() :: User has already granted access to local media and AutoAnswer activated : establishing call"),!0===this.userAcceptOnIncomingCall||!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("processInvite() - Waiting for call accept or refuse from user - 2"):_?(ie.log("using First available stream on apiRTC"),(m=apiCC.getUserMediaStream(_)).addCallInfo(y.callId),null!=y.callConfiguration||(y.callConfiguration={}),y.callConfiguration.userMediaStreamId=m.userMediaStreamId,y.onUserMediaSuccessOnCall(m.stream)):y.establishCall(),!1===P&&this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,y.callId,!0,h,y.audioOnly,t.callType,!1,y.remoteType,y.destCallType)))},this.setRemoteDescriptionProcess=function(t,u){this.preferSendingH264Codec&&(ie.log("Modification of SDP to set H264 as prefered sending codec"),u.sdp=this.mySDPManager.maybePreferCodec(u.sdp,"video","H264")),"Chrome"===c.Xh&&c.PR<55||"Firefox"===c.Xh&&c.PR<50||"IE"===c.Xh||"undefined"!=typeof apiRTC_React?null!==t.pc?t.pc.setRemoteDescription(u,t.callback(t,"onSetRemoteDescriptionSuccess"),t.callback(t,"onSetRemoteDescriptionFailure")):ie.debug("setRemoteDescriptionProcess - pc is null"):(ie.log("before setRemoteDescription - Promise version"),null!==t.pc?t.pc.setRemoteDescription(u).then(t.callback(t,"onSetRemoteDescriptionSuccess")).catch(t.callback(t,"onSetRemoteDescriptionFailure")):ie.debug("setRemoteDescriptionProcess - pc is null"))},this.process200OK=function(t){var u,h=null,y=null;if(void 0!==t.data&&void 0!==t.data.instanceId?(ie.info("200OK received from callId :"+t.calleeId+", intanceId is :"+t.data.instanceId),h=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.calleeId,t.data.instanceId)):(ie.info("200OK received from callId :"+t.calleeId),h=this.findCallWithCallIdAndRemoteId(t.callId,t.calleeId)),null===h)return ie.warn("200OK received but callId and instanceId are not matching, no process"),void this.myWebRTC_Event.createErrorEvent("200OK received but callId is not matching, no process","NOT_MATCHING_CALLID_ON_200OK");h.calleeId=t.calleeId,t.sdpanswer&&"no-answer"!==t.sdpanswer.type?!1===h.message200OKReceived?(ie.debug("first 200OK for the call"),h.message200OKReceived=!0,"subscribe"!==h.data.type&&this.checkDestCallTypeWithSDP(t.sdpanswer.sdp,h),u=this.mySDPManager.createGuideline(t.sdpanswer.sdp),h.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(u,t.sdpanswer.sdp,"remote","send")),h.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(u,t.sdpanswer.sdp,"remote","receive")),this.evaluateVideoCap(h),!this.rtpSenderSetParamatersCapable&&h.videoCap&&(u.video.bandwidth=h.videoCap,t.sdpanswer.sdp=u.generate()),h.receivedSdpOfferMessage=t.sdpanswer,ie.log("process200OK : before setRemoteDescription"),y=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpanswer),this.videoRemoteBandwidth&&(ie.log("Modification of SDP to set remote video bandwidth"),y.sdp=this.mySDPManager.setVideoBandwidth(y.sdp,this.videoRemoteBandwidth)),this.setRemoteDescriptionProcess(h,y),this.setStatus("You are connected to :"+t.calleeId),null!=t.data&&(h.data=null!=h.data?(0,d.S6)(h.data,t.data):t.data)):ie.debug("200OK has already been received for this call, leaving process200OK"):bt.createCallEstablishedEvent(h.calleeId,h.callType,h.callId,h.destCallType)},this.cleanStoredCallCandidate=function(t,u){ie.debug("cleanStoredCallCandidate from callId :"+t+", instanceId is :"+u),void 0!==this.clientIncomingCandidatesQueue[t+"-"+u]&&0!==this.clientIncomingCandidatesQueue[t+"-"+u].length&&(this.clientIncomingCandidatesQueue[t+"-"+u].splice(0,this.clientIncomingCandidatesQueue[t+"-"+u].length),delete this.clientIncomingCandidatesQueue[t+"-"+u])},this.processCandidate=function(t){var u=null,h=t.data&&t.data.instanceId?t.data.instanceId:null;ie.debug("Candidate received from callId :"+t.callId+", instanceId is :"+h),u=t.callerId===this.clientId?h?this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.calleeId,h):this.findCallWithCallIdAndRemoteId(t.callId,t.calleeId):h?this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId,h):this.findCallWithCallIdAndRemoteId(t.callId,t.callerId),ie.trace("msg.label :"+t.label),ie.log("msg.candidate :"+t.candidate),null!==u?u.started&&u.remoteDescriptionSetted?u.processCandidateMsg(t):(ie.log("Call not started or remoteDescription is not yet setted"),u.incomingcandidatesQueue.push(t)):h&&(ie.debug("Call not found, Candidate message is not handled, storing candidate message in client"),null!=this.clientIncomingCandidatesQueue[t.callId+"-"+h]||(this.clientIncomingCandidatesQueue[t.callId+"-"+h]=[],ie.debug("First candidate for this call, starting a timeout before candidate storage cleaning"),setTimeout(this.cleanStoredCallCandidate.bind(this),this.cleanStoredCallCandidateTimer,t.callId,h)),this.clientIncomingCandidatesQueue[t.callId+"-"+h].push(t))},this.processUpdate=function(t){ie.info("Update message on:"+t.roomId);var u,h=null;if(null!==(h=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId===this.clientId?t.calleeId:t.callerId,t.data.instanceId)))if(t.hasOwnProperty("sdpoffer")&&t.sdpoffer.hasOwnProperty("sdp"))h.setRemoteCallProfile(this.evalCallProfileWithSdp(t.sdpoffer.sdp,"remote","receive"),!0),h.updateOngoingTimeoutId=setTimeout(function(){delete h.updateOngoingTimeoutId},4e4),this.checkDestCallTypeWithSDP(t.sdpoffer.sdp,h),ie.log("processUpdate : before setRemoteDescription"),u=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpoffer),this.setRemoteDescriptionProcess(h,u),h.doUpdateAnswer();else if((0,d.ki)(t.data,"mesh","object")&&(t.data.mesh.calleeCompositeUserId?t.data.mesh.calleeCompositeUserId===this.compositeClientId:t.data.mesh.calleeId===this.clientId)){ie.debug("mesh update from subscriber");var y={};"AUDIOONLY"===t.data.mediaType?y.audioOnly=!0:"VIDEOONLY"===t.data.mediaType&&(y.videoOnly=!0),this.updateCallConfigurationOnCall(t.callId,y).then(function(){ie.debug("updateCallConfigurationOnCall OK")}).catch(function(a){ie.error("updateCallConfigurationOnCall failed",a)})}else ie.error("update without SDP offer");else this.myWebRTC_Event.createErrorEvent("Cannot find call to process Update","CALL_NOT_FOUND_ON_UPDATE")},this.process200Update=function(t){ie.info("200 Update received from :"+t.calleeId),this.setStatus("You are connected to :"+t.calleeId);var u,h=null,y=null;if(null===(h=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId===this.clientId?t.calleeId:t.callerId,t.data.instanceId)))return ie.info("Call not found on 200 Update"),void this.myWebRTC_Event.createErrorEvent("Cannot find call to process 200 Update","CALL_NOT_FOUND_ON_200UPDATE");h.calleeId=t.calleeId,u=this.mySDPManager.createGuideline(t.sdpanswer.sdp),h.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(u,t.sdpanswer.sdp,"remote","send"),!0),h.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(u,t.sdpanswer.sdp,"remote","receive"),!0),this.evaluateVideoCap(h),!this.rtpSenderSetParamatersCapable&&h.videoCap&&(u.video.bandwidth=h.videoCap,t.sdpanswer.sdp=u.generate()),ie.log("process200Update : before setRemoteDescription"),y=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpanswer),this.videoBandwidth&&(ie.log("Modification of SDP to set remote video bandwidth"),y.sdp=this.mySDPManager.setVideoBandwidth(y.sdp,this.videoBandwidth)),this.setRemoteDescriptionProcess(h,y),ie.log("msg.sdpanswer.sdp :",t.sdpanswer.sdp),!0===h.addingUserMedia&&(ie.log("adding localvideo in mini"),this.miniVideo&&(this.miniVideo.style.opacity=1),h.addingUserMedia=!1),!0===h.updateUserMedia&&(h.updateUserMedia=!1),h.updateCause&&(h.updateCause=null)},this.processSlowLink=function(t,u){for(var h=this.callsTable.length,y=null;--h>=0;)if(this.callsTable[h].callId===t){y=this.callsTable[h];break}if(null!==y){var a=null;u&&u.advice&&(a=u.advice),this.myWebRTC_Event.createSlowLinkEvent(y.callId,a)}},this.processAudioAmplitude=function(t,u){bt.createAudioAmplitudeEvent(t.descriptor.audioAmplitude,u,t.callId,t.descriptor.streamID)},this.processDistantIceError=function(t){"disconnected"===t.descriptor.iceState?this.myWebRTC_Event.createErrorEvent("distant iceDisconnection detected","DISTANT_ICE_CONNECTION_STATE_DISCONNECTED",null,t.roomId,null,t.descriptor):"failed"===t.descriptor.iceState&&bt.createErrorEvent("distant iceConnection failed detected","DISTANT_ICE_CONNECTION_STATE_FAILED",null,t.roomId,null,t.descriptor)},this.processStreamTrackMuteChanged=function(t,u,h){for(var y=this.callsTable.length,a=null,m=[],_={},P={};--y>=0;)if(this.callsTable[y].callId===t){a=this.callsTable[y];break}null!==a&&("audio"===u?(a.isRemoteAudioMuted=h,m.push("audioIsMuted"),_.available=a.remoteCallProfile.audio,_.active=a.remoteCallProfile.audioActive,_.muted=a.isRemoteAudioMuted,P.available=a.remoteCallProfile.video,P.active=a.remoteCallProfile.videoActive,P.muted=a.isRemoteVideoMuted):"video"===u&&(a.isRemoteVideoMuted=h,m.push("videoIsMuted"),_.available=a.remoteCallProfile.audio,_.active=a.remoteCallProfile.audioActive,_.muted=a.isRemoteAudioMuted,P.available=a.remoteCallProfile.video,P.active=a.remoteCallProfile.videoActive,P.muted=a.isRemoteVideoMuted),m.length>0&&this.myWebRTC_Event.createRemoteStreamUpdatedEvent(m,_,P,a.destCallType,a.callId,"userAction"))},this.processUpdateStream=function(t,u,h){for(var y=this.callsTable.length,a=null;--y>=0;)if((0,d.ki)(this.callsTable[y].data,"mesh","object")&&this.callsTable[y].data.mesh.calleeCallId===t||this.callsTable[y].callId===t){a=this.callsTable[y];break}if(!a)return!1;var m=!1;return"audio"===u?"inactive"===h?"media"===a.callType&&(a.callType="videoOnly",a.updateUserMedia=!0,a.updateCause="adaptation",a.audioSdpDirection="inactive",a.establishCall(),m=!0):"videoOnly"===a.callType&&(a.callType="media",a.updateUserMedia=!0,a.updateCause="adaptation",a.audioSdpDirection=null,a.establishCall(),m=!0):"video"===u&&("inactive"===h?"media"===a.callType&&(this.evalOutgoingVideoBandwithCap(a),a.callType="audio",a.updateUserMedia=!0,a.updateCause="adaptation",a.videoSdpDirection="inactive",a.establishCall(),m=!0):"audio"===a.callType&&(this.evalOutgoingVideoBandwithCap(a),a.callType="media",a.updateUserMedia=!0,a.updateCause="adaptation",a.videoSdpDirection=null,a.establishCall(),m=!0)),m},this.processUpdateVideoQuality=function(t,u){ie.debug("processUpdateVideoQuality",t,u);var h=this.findCallWithCallId(t);if(h)if(h.sessionMCU&&"mesh"!==h.sessionMCU.roomMode){var y=apiCC.getUserMediaStream(h.callConfiguration.userMediaStreamId);if(y){var a=y.getVideoTrack();if(a){var m={};u.width&&u.height&&(m.width=u.width,m.height=u.height),u.frameRate&&(m.frameRate=u.frameRate),a.applyConstraints(m).then(function(_){ie.debug("processUpdateVideoQuality - applyConstraints; OK")}).catch(function(_){ie.error("processUpdateVideoQuality - applyConstraints",_)})}else ie.warn("processUpdateVideoQuality - no such video track; callId:",t)}else ie.warn("processUpdateVideoQuality - no such userMediaStream; callId:",t)}else ie.warn("processUpdateVideoQuality - wrong roomMode; callId:",t);else ie.warn("processUpdateVideoQuality - no such call; callId:",t)},this.removeAllCallsFromRoom=function(t,u){ie.info("removeAllCallsFromRoom :"+t+" with reason :"+u);var h,y,a=this.callsTable.length,m=[];for(h=0;h<a;h+=1)this.callsTable[h].dest_roomId==t&&(ie.log("Call is attached to the room, removing ..."),m.push({callId:this.callsTable[h].callId}));for(y=0;y<m.length;y+=1)this.removeCallFromTableWithCallIdAndSendBye(m[y].callId,u);m.splice(0,m.length)},this.onHangup=function(t,u){var h=null,y=null,a=null,m=null,_=[],P=!1,x=!1,oe=null,K=null;if(t?"string"!=typeof t&&(t=String(t)):t=null,u?"string"!=typeof u&&(u=null):u=null,this.setStatus("<div>Your phone is registered, you can be reached at this number : "+this.clientId+"</div>"),ie.info("Hanging up."),this.initMediaElementState(),null===t)ie.log("Leaving all calls that are established"),this.MCUClient&&this.MCUClient.meshOnHangup(),this.removeAllCalls(),this.callControlTable.splice(0,this.callControlTable.length);else if(null!==(y=this.findUserMediaById(t))){for("janusConnector"!==this.MCUClient.pubConnector||"RTC_Setup_Timeout"!==u&&"disconnected"!==u||(a=y.getUserMediaStream())&&a.stream&&("mesh"===y.sessionMCU.roomMode?(P=!0,x=!0,oe=a.stream,y.streamStolen=!0):(P=!0,oe=a.stream,y.streamStolen=!0,(K=a.getCallInfo(y.userMediaId))&&(K.flavor="call"))),m=this.callsTable.length;--m>=0;)(0,d.Ym)(this.callsTable[m].data,"object")&&(0,d.Ym)(this.callsTable[m].data.mesh,"object")&&this.callsTable[m].data.mesh.calleeCallId===t&&_.push(this.callsTable[m].callId);for(m=_.length;--m>=0;)this.removeCallFromTableWithCallIdAndSendBye(_[m],u);this.MCUClient.meshOnHangup(t,null,{restart:P})}else null!==(h=this.findCallWithCallId(t))&&("janusConnector"!==this.MCUClient.pubConnector||"RTC_Setup_Timeout"!==u&&"disconnected"!==u||("publish"===h.settingUpType||"shareScreen"===h.settingUpType?h.data&&h.data.mesh||(P=!0,h.streamStolen=!0):"subscribe"===h.settingUpType&&(P=!0)),ie.log("Leaving call with callId :"+t),this.removeCallFromTableWithCallIdAndSendBye(t,u));this.displayCallButtonInCommand(),!0===P?null!==h?this.restartCall(h):null!==y&&this.restartCall(y,!0===x?{userMedia:!0,mesh:!0}:{userMedia:!0,stream:oe}):(h&&h.callControl&&this.destroyCallControl(h.callControl),this.stopMaxCallRetriesTimer(t),this.stopRestartCallTimer(t),delete this.callsRetriesTable[t])},this.stopStream=function(t){ie.info("stopStream in client");var u,h=null;if("Chrome"===c.Xh&&c.PR<45||"Firefox"===c.Xh&&c.PR<44||"Opera"===c.Xh&&c.PR<34||"Chromium"===c.Xh&&c.PR<44||"Chrome WebView"===c.Xh&&c.PR<45)t.onended=null,t.stop();else{for(t.onended=null,ie.log("MediaStream.stop is now deprecated, using MediaStreamTrack.stop"),h=t.getTracks(),u=0;u<h.length;u+=1)h[u].onended=null,h[u].stop();ie.log("... tracks stopped")}t=null},this.clearCallTimeouts=function(t){var u;for(ie.debug("clearCallTimeouts"),0!==t.send200OKTrickleIceFalseTimeOutId&&(ie.debug("clearing send200OKTrickleIceFalseTimeOutId"),clearTimeout(t.send200OKTrickleIceFalseTimeOutId),t.send200OKTrickleIceFalseTimeOutId=0),0!==t.sendInviteTrickleIceFalseTimeOutId&&(ie.debug("clearing sendInviteTrickleIceFalseTimeOutId"),clearTimeout(t.sendInviteTrickleIceFalseTimeOutId),t.sendInviteTrickleIceFalseTimeOutId=0),0!==t.disconnectionTimeoutId&&(ie.debug("clearing disconnectionTimeout"),clearTimeout(t.disconnectionTimeoutId),t.disconnectionTimeoutId=0),0!==t.disconnectionWarningInterval&&(ie.debug("clearing disconnectionWarningInterval"),clearInterval(t.disconnectionWarningInterval),t.disconnectionWarningInterval=0),u=0;u<t.checkCandidateTypesTimeoutTable.length;u+=1)ie.debug("clearing checkCandidateTypesTimeout :",t.checkCandidateTypesTimeoutTable[u]),clearTimeout(t.checkCandidateTypesTimeoutTable[u]);t.checkCandidateTypesTimeoutTable.splice(0,t.checkCandidateTypesTimeoutTable.length)},this.removeAllCalls=function(){ie.info("removeAllCalls");var t,u=this.callsTable.length,h=0,a=null,m=0,_=null;for(ie.log("callsNumber = "+u),t=0;t<u;t+=1){if(h=this.callsTable[t-m].callee?this.callsTable[t-m].callerId:this.callsTable[t-m].calleeId,!0===this.callsTable[t-m].callee)this.callsTable[t-m].myWebRTC_Stack.sendBye(this.callsTable[t-m].callId,this.clientId,this.callsTable[t-m].dest_roomId,h,a="Hangup_From_Callee",this.callsTable[t-m].data);else{if(a="Hangup_From_Caller",!0!==this.callsTable[t-m].inviteSended){this.callsTable[t-m].callCancelled=!0,ie.warn("Leaving call iteration on removeAllCalls");continue}this.callsTable[t-m].myWebRTC_Stack.sendBye(this.callsTable[t-m].callId,this.clientId,this.callsTable[t-m].dest_roomId,h,a,this.callsTable[t-m].data)}(0,d.ki)(this.callsTable[t-m].sessionMCU,"roomName","string")&&(0,d.ki)(this.callsTable[t-m].data,"MCUType","string")&&("MCU-Caller"===this.callsTable[t-m].data.MCUType||"MCU-Callee"===this.callsTable[t-m].data.MCUType)&&this.MCUClient.leaveSession(this.callsTable[t-m].sessionMCU.roomName,{noHangup:!0}),this.callsTable[t-m].callConfiguration&&this.callsTable[t-m].callConfiguration.userMediaStreamId&&(_=apiCC.getUserMediaStream(this.callsTable[t-m].callConfiguration.userMediaStreamId))&&apiCC.releaseUserMediaStream(_.userMediaStreamId,this.callsTable[t-m].callId),null!==this.callsTable[t-m].screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.callsTable[t-m].screenStream),bt.createUserMediaStopEvent(this.callsTable[t-m].callId,"screen")),null!==this.callsTable[t-m].pc&&(ie.log("Closing PC"),this.qosEnable&&null!=this.callsTable[t-m].qm&&"function"==typeof this.callsTable[t-m].qm.saveStatsToDb&&(this.callsTable[t-m].qm.saveStatsToDb(!0),clearInterval(this.callsTable[t-m].statisticId)),this.callsTable[t-m].csmIntervalId&&clearInterval(this.callsTable[t-m].csmIntervalId),this.callsTable[t-m].pc.close(),this.callsTable[t-m].pc=null),this.removeRemoteVideoDisplay(this.callsTable[t-m].callId+"-"+this.callsTable[t-m].calleeId),this.myWebRTC_Event.createHangupEvent("local",this.clientId,this.callsTable[t-m].remoteId,!0,a,this.callsTable[t-m].callId,this.callsTable[t-m].callType),null!=this.callsTable[t-m].data&&("janusConnector"===this.callsTable[t-m].data.pubSub||"MCU-Caller"!==this.callsTable[t-m].data.MCUType&&"MCU-Callee"!==this.callsTable[t-m].data.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(this.callsTable[t-m].data.confId,this.callsTable[t-m].callerId,this.callsTable[t-m].calleeId,this.callsTable[t-m].callId)),this.clearCallTimeouts(this.callsTable[t-m]),0!==this.callsTable[t-m].incomingcandidatesQueue.length&&this.callsTable[t-m].incomingcandidatesQueue.splice(0,this.callsTable[t-m].incomingcandidatesQueue.length),void 0!==this.clientIncomingCandidatesQueue[this.callsTable[t-m].callId+"-"+this.callsTable[t-m].instanceId]&&0!==this.clientIncomingCandidatesQueue[this.callsTable[t-m].callId+"-"+this.callsTable[t-m].instanceId].length&&this.clientIncomingCandidatesQueue[this.callsTable[t-m].callId+"-"+this.callsTable[t-m].instanceId].splice(0,this.clientIncomingCandidatesQueue[this.callsTable[t-m].callId+"-"+this.callsTable[t-m].instanceId].length),ie.log("Removing call from table"),this.callsTable.splice(t-m,1),m+=1}},this.onRemoteHangup=function(t,u,h,y,a,m){var _=this;ie.debug("onRemoteHangup");var P=null,x=null,oe=null,K=null,X=!1,me=!1,Q=!1,re=null,ye=null;if(ie.log("callId :"+t),ie.log("confId :"+a),"janusConnector"===this.MCUClient.pubConnector)if("RTC_Setup_Timeout"===y||"Broken_by_MCU"===y||"disconnected"===y)if(null!=(x=null==m?this.findCallWithCallId(t):this.findCallWithCallIdAndInstanceId(t,m.instanceId))){if(x.setupTimeoutId&&(clearTimeout(x.setupTimeoutId),delete x.setupTimeoutId),!0===x.restarting)return void ie.debug("call restarting");if("publish"===x.settingUpType||"shareScreen"===x.settingUpType?x.data&&x.data.mesh||(X=!0,x.streamStolen=!0):"subscribe"===x.settingUpType&&(X=!0),null!==x.sessionMCU&&"old"===x.sessionMCU.modeChangeKind)return void ie.debug("onRemoteHangup ignore")}else null!==(oe=this.findUserMediaById(t))?(oe.close(),(K=oe.getUserMediaStream())&&K.stream&&(null!==oe.sessionMCU&&"old"===oe.sessionMCU.modeChangeKind?(X=!0,re=K.stream,oe.streamStolen=!0,oe.distantCalls.length>0&&(Q=!0),(ye=K.getCallInfo(oe.userMediaId))&&(ye.flavor="call")):null!==oe.sessionMCU&&"mesh"===oe.sessionMCU.roomMode?(X=!0,me=!0,re=K.stream,oe.streamStolen=!0):(X=!0,re=K.stream,oe.streamStolen=!0,(ye=K.getCallInfo(oe.userMediaId))&&(ye.flavor="call")))):ie.debug("No call and no userMedia found");else(x=null==m?this.findCallWithCallId(t):this.findCallWithCallIdAndInstanceId(t,m.instanceId))?(x.setupTimeoutId&&(clearTimeout(x.setupTimeoutId),delete x.setupTimeoutId),"subscribe"===x.settingUpType&&(X=!0)):(oe=this.findUserMediaById(t))&&oe.close();if(!Q)if(null!==oe){var Se=null,ge=[];for(Se=this.callsTable.length;--Se>=0;)(0,d.ki)(this.callsTable[Se].data,"mesh","object")&&this.callsTable[Se].data.mesh.calleeCallId===t&&"subscribe"!==this.callsTable[Se].settingUpType&&ge.push(this.callsTable[Se].callId);for(Se=ge.length;--Se>=0;)this.removeCallFromTableWithCallIdAndSendBye(ge[Se],y);if(this.MCUClient.meshOnHangup(t),"old"===oe.sessionMCU.modeChangeKind){var Pe=this.MCUClient.getSessionMCU(null,{callback:function(xe){return xe.roomName===oe.sessionMCU.roomName&&"new"===xe.modeChangeKind}});Pe&&this.finalizeMeshToJanusTransition(oe.sessionMCU,Pe)}}else void 0!==t?P=null==m?this.removeCallFromTableWithCallIdandRemoteId(t,u,y):this.removeCallFromTableWithCallIdandInstanceId(t,m.instanceId,y):void 0!==a&&(P=this.removeCallFromTableWithConfIdandRemoteId(a,u,y));ie.log("Reason : "+y),void 0===y?this.setStatus("<div>Your partner : "+u+" have left the call. you can be reached at this number : "+this.clientId+"</div>"):(this.setStatus("<div>Call hangup with reason : "+y+". you can be reached at this number : "+this.clientId+"</div>"),ie.log("Remote Hangup for reason : "+y)),x&&!0!==X?0===this.callsTable.length&&0===this.userMediaTable.length?(ie.log("No more established calls for client"),this.initMediaElementState(),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,u,!0,y),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,u,!0,y,t,P),this.displayCallButtonInCommand(),!0===this.getUserMediaOnGoing&&!0!==z.deactivateReloadOnCancel&&(ie.log("Cancel from Remote"),"undefined"==typeof apiRTC_React&&location.reload(),this.getUserMediaOnGoing=!1)):(ie.log("Other calls are still established"),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,u,!1,y),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,u,!1,y,t,P)):x&&"subscribe"===x.settingUpType&&(this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,u,!1,"restarted"),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,u,!1,"restarted",t,P)),null!=m&&("janusConnector"===this.MCUClient.pubConnector||"MCU-Caller"!==m.MCUType&&"MCU-Callee"!==m.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(a,this.clientId,u,t)),!0===X?null!==x?this.restartCall(x):null!==oe&&(!0===me?this.restartCall(oe,{userMedia:!0,mesh:!0}):this.randomDelayOnRestart?(ie.debug("onRemoteHangup - randomDelayOnRestart"),setTimeout(function(){_.restartCall(oe,{userMedia:!0,stream:re})},5e3*Math.random())):this.restartCall(oe,{userMedia:!0,stream:re})):(x&&x.callControl&&this.destroyCallControl(x.callControl),(x||oe)&&(this.stopMaxCallRetriesTimer(t),this.stopRestartCallTimer(t),delete this.callsRetriesTable[t]))},this.startMaxCallRetriesTimer=function(t){var u=this;ie.debug("startMaxCallRetriesTimer for callIdWhenStartingTimer :",t);var h=setTimeout(function(){ie.debug("[restartCall] MaxCallRetriesTimer reached for callIdWhenStartingTimer :",t),u.callsRetriesTable[t].allowedStatus=!1,delete u.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId},this.maxCallsRetriesDuration);this.callsRetriesTable[t]={},this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId=h},this.stopMaxCallRetriesTimer=function(t){ie.debug("stopMaxCallRetriesTimer for callId :",t),void 0!==this.callsRetriesTable[t]&&void 0!==this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId&&(clearTimeout(this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId),ie.debug("[restartCall] MaxCallRetriesTimer cleared for callId :",t),delete this.callsRetriesTable[t])},this.stopRestartCallTimer=function(t){ie.debug("stopRestartCallTimer for callId :",t),void 0!==this.callsRetriesTable[t]&&void 0!==this.callsRetriesTable[t].restartCallTimeOutId&&(clearTimeout(this.callsRetriesTable[t].restartCallTimeOutId),ie.error("[restartCall] RestartCallTimer cleared for callId :",t),delete this.callsRetriesTable[t].restartCallTimeOutId)},this.restartCall=function(t){var u=this,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ie.debug("[restartCall] restartCall for callId :",t.callId);var y=-1;if(!0!==h.userMedia)if(t.callControl&&t.callControl.autoRestart)if(0===(y=t.callControl.autoRestart.counter)&&(t.callControl.autoRestart.callIdWhenStartingTimer=t.callId,this.startMaxCallRetriesTimer(t.callId)),void 0!==this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&void 0===this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].allowedStatus){ie.debug("[restartCall] ... for callIdWhenStartingTimer :",t.callControl.autoRestart.callIdWhenStartingTimer),ie.debug("AutoRestartCounter :",y),ie.debug("Calling restartCallProcess in :",this.restartCallDelay*Math.pow(2,y));var a=setTimeout(function(){ie.debug("Timer reached for restartCall"),delete t.callControl.autoRestart.pending,u.restartCallProcess(t,h),void 0!==u.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&void 0!==u.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId&&delete u.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId},this.restartCallDelay*Math.pow(2,y));t.callControl.autoRestart.pending=!0,this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId=a}else ie.warn("CALL_ABORTED, retries not allowed (maxCallsRetriesDuration reached) for callIdWhenStartingTimer :",t.callControl.autoRestart.callIdWhenStartingTimer),this.destroyCallControl(t.callControl),bt.createErrorEvent("call aborted after calls retries (maxCallsRetriesDuration reached)","CALL_ABORTED",t.callId,t.callControl.roomName),void 0!==this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&delete this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer];else ie.debug("[restartCall] autoRestart options not defined");else this.restartCallProcess(t,h)},this.restartCallProcess=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ie.debug("restartCallProcess ");var h=!1,y=!1,a=null;if(!0!==t.restarting){if(t.restarting=!0,!0===u.userMedia&&(h=!0),!0===u.mesh&&(y=!0),!0===h)if(!0===y)"screenSharing"===t.callType||"screenSharingWithAudio"===t.callType?(t.restarting=!1,this.userMediaTable.push(t),this.MCUClient.meshOnScreenMediaSuccess(t)):(t.restarting=!1,this.userMediaTable.push(t),this.MCUClient.meshOnUserMediaSuccess(t));else if("screenSharing"===t.callType||"screenSharingWithAudio"===t.callType){delete t.data.meshPublish,t.data.type="publish";var m=this.createCallControl({type:"shareScreen",callId:t.userMediaId,roomName:t.roomId,callConfiguration:t.callConfiguration,data:t.data});m.captureSourceType=t.captureSourceType,m.autoRestart.counter=0,m.autoRestart.stream=u.stream,this.shareScreen(t.roomId,t.data,t.captureSourceType,t.callConfiguration,{callControl:m}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.userMediaId,t.userMediaId,"publish",this.clientId,t.roomId,t.roomId,null)}else{delete t.data.meshPublish;var _=this.createCallControl({type:"publish",callId:t.userMediaId,callType:t.callType,roomName:t.roomId,callConfiguration:t.callConfiguration,data:t.data});_.audioOnly="audio"===t.callType,_.sessionId=t.sessionId,_.token=t.token,_.autoRestart.counter=0,_.autoRestart.stream=u.stream,this.MCUClient.publish(t.roomId,t.sessionId,t.token,t.callConfiguration,t.data,{callControl:_}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,"audio"===t.callType,t.userMediaId,t.userMediaId,"publish",this.clientId,t.roomId,t.roomId,null)}else if("publish"===t.settingUpType)(0,d.Ym)(t.callControl,"object")?(ie.debug("[restartCall] restarting call publish"),this.MCUClient.publish(t.callControl.roomName,t.callControl.sessionId,t.callControl.token,t.callControl.callConfiguration,t.callControl.data,{callControl:t.callControl}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.callId,t.callId,"publish",this.clientId,t.callControl.roomName,t.callControl.roomName,null)):ie.warn("[restartCall] cannot auto restart; missing info");else if("shareScreen"===t.settingUpType)(0,d.Ym)(t.callControl,"object")?(ie.debug("[restartCall] restarting call shareScreen"),this.shareScreen(t.callControl.roomName,t.callControl.data,t.callControl.captureSourceType,t.callControl.callConfiguration,{callControl:t.callControl}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.callId,t.callId,"publish",this.clientId,t.callControl.roomName,t.callControl.roomName,null)):ie.warn("[restartCall] cannot auto restart; missing info");else if("subscribe"===t.settingUpType&&(ie.debug("[restartCall] restarting call subscribe"),a=!0===t.mcuRemoteStream.replay?this.MCUClient.getStreamOfUserCall(t.mcuRemoteStream.attributes.callerId,t.mcuRemoteStream.attributes.callId,{replay:!0}):this.MCUClient.getStreamOfUserCall(t.mcuRemoteStream.attributes.callerId,t.mcuRemoteStream.attributes.callId),(0,d.Ym)(t.callControl,"object")&&a)){ie.debug("[restartCall] stream exists, subscribing to it");var P=!!t.callControl.autoRestart.force;delete t.callControl.autoRestart.force;var x=t.callControl.callId,oe=this.MCUClient.subscribeToStreams([a],t.callControl.mediaType,t.callControl.data,t.callControl.callConfiguration,{noStreamCheck:!0,autoSub:!0,force:P});x&&oe[0]&&this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,x,oe[0],"subscribe",this.clientId,t.callControl.roomName,t.callControl.roomName,a.id)}}else ie.debug("[restartCall] call already restarting")},this.closingCallProcess=function(t,u){ie.log("Session terminated.");var h=null;(0,d.ki)(this.callsTable[t].sessionMCU,"roomName","string")&&(0,d.ki)(this.callsTable[t].data,"MCUType","string")&&("MCU-Caller"===this.callsTable[t].data.MCUType||"MCU-Callee"===this.callsTable[t].data.MCUType)&&this.MCUClient.leaveSession(this.callsTable[t].sessionMCU.roomName),this.callsTable[t].callConfiguration&&this.callsTable[t].callConfiguration.userMediaStreamId&&!0!==this.callsTable[t].streamStolen&&(h=apiCC.getUserMediaStream(this.callsTable[t].callConfiguration.userMediaStreamId))&&apiCC.releaseUserMediaStream(h.userMediaStreamId,this.callsTable[t].callId),null!==this.callsTable[t].screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.callsTable[t].screenStream),bt.createUserMediaStopEvent(this.callsTable[t].callId,"screen")),null!==this.callsTable[t].pc&&(ie.log("Closing PC"),this.qosEnable&&null!=this.callsTable[t].qm&&"function"==typeof this.callsTable[t].qm.saveStatsToDb&&(this.callsTable[t].qm.saveStatsToDb(!0),clearInterval(this.callsTable[t].statisticId)),this.callsTable[t].csmIntervalId&&clearInterval(this.callsTable[t].csmIntervalId),this.callsTable[t].beginTimeoutId&&(clearTimeout(this.callsTable[t].beginTimeoutId),delete this.callsTable[t].beginTimeoutId),this.callsTable[t].dcfs?"Ice_failed"===u?this.callsTable[t].dcfs.failure="iceFailed":this.callsTable[t].dcfs.canceled=!0:"data"===this.callsTable[t].callType&&"dataChannelConnector"===this.callsTable[t].calleeId&&(this.callsTable[t].failure||this.callsTable[t].success||setTimeout(function(y,a){bt.createEvent({eventType:"onFileSended",callId:y.callId,remoteId:y.remoteId,name:y.data.filename,error:a}),y.callbacks&&y.callbacks.failure&&y.callbacks.failure(a)},0,this.callsTable[t],"Ice_failed"===u?"iceFailed":"canceled")),this.callsTable[t].pc.close(),this.callsTable[t].pc=null)},this.removeCallProcess=function(t){var h=this,y=this.callsTable[t];this.clearCallTimeouts(y),0!==y.incomingcandidatesQueue.length&&y.incomingcandidatesQueue.splice(0,y.incomingcandidatesQueue.length),void 0!==this.clientIncomingCandidatesQueue[y.callId+"-"+y.instanceId]&&0!==this.clientIncomingCandidatesQueue[y.callId+"-"+y.instanceId].length&&this.clientIncomingCandidatesQueue[y.callId+"-"+y.instanceId].splice(0,this.clientIncomingCandidatesQueue[y.callId+"-"+y.instanceId].length),ie.log("Removing call from table"),this.callsTable.splice(t,1),ie.log("this.callsTable.length :",this.callsTable.length),ie.log("Call is terminated"),setTimeout(function(){h.startNextPushData()}),this.miniVideo&&0!==this.callsTable.length&&(ie.log("calling attachMediaStream"),apiCC.attachMediaStream(this.miniVideo,this.callsTable[0].callLocalStream)),this.evalOutgoingVideoBandwithCap()},this.removeCallFromTableWithCallIdAndSendBye=function(t,u){ie.debug("removeCallFromTableWithCallIdAndSendBye()",t);var h,a=null;if(-1!==(h=this.findCallIndexWithCallId(t))){if(this.closingCallProcess(h,u),this.removeRemoteVideoDisplay(this.callsTable[h].callId+"-"+this.callsTable[h].calleeId),this.callsTable[h].callee?(a=this.callsTable[h].callerId,null===u&&(u="Hangup_From_Callee")):(a=this.callsTable[h].calleeId,null===u&&(u="Hangup_From_Caller")),ie.log("reason is :"+u),"LOCAL"!==this.callsTable[h].calleeId){var m=apiCC.session.getConnectedUserInfo(this.callsTable[h].calleeId,"userData"),_=null;if("User_Not_Found"!==m)try{_=JSON.parse(m)}catch(P){ie.error("userInfo parse fail",m)}null!=_&&"true"===_.isSimulated?apiCC.session.channel.socket.emit("simulatedAgentCancelCallRequest",{number:this.callsTable[h].calleeId,callId:t}):this.callsTable[h].myWebRTC_Stack.sendBye(this.callsTable[h].callId,this.clientId,this.callsTable[h].dest_roomId,a,u,this.callsTable[h].data)}"Broken_by_MCU"!==u&&this.myWebRTC_Event.createHangupEvent("local",this.clientId,this.callsTable[h].remoteId,!0,u,this.callsTable[h].callId,this.callsTable[h].callType),null!=this.callsTable[h].data&&("janusConnector"===this.callsTable[h].data.pubSub||"MCU-Caller"!==this.callsTable[h].data.MCUType&&"MCU-Callee"!==this.callsTable[h].data.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(this.callsTable[h].data.confId,this.callsTable[h].callerId,this.callsTable[h].calleeId,this.callsTable[h].callId)),this.removeCallProcess(h)}else ie.log("No call removed");this.MCUClient.publishCallId===t&&(this.publishCallId=null)},this.removeCall=function(t){ie.info("removeCall");var h=null;return-1!==t?(this.closingCallProcess(t,null),0!==this.callsTable[t].disconnectionWarningTimeout&&(ie.debug("clearing disconnectionWarningTimeout"),clearTimeout(this.callsTable[t].disconnectionWarningTimeout),this.callsTable[t].disconnectionWarningTimeout=0),this.removeRemoteVideoDisplay(this.callsTable[t].callId+"-"+this.callsTable[t].calleeId),h=this.callsTable[t].callType,this.removeCallProcess(t)):ie.debug("No call removed"),h},this.removeCallFromTableWithConfIdandRemoteId=function(t,u,h){var y;return ie.debug("removeCallFromTableWithConfIdandRemoteId() with reason :"+h),h=null,y=this.findCallIndexWithConfIdAndRemoteId(t,u),this.removeCall(y)},this.removeCallFromTableWithCallIdandRemoteId=function(t,u,h){var y;return ie.debug("removeCallFromTableWithCallIdandRemoteId() with reason :"+h),ie.log("callId :"+t),ie.log("remoteId :"+u),h=null,y=this.findCallIndexWithCallIdAndRemoteId(t,u),this.removeCall(y)},this.removeCallFromTableWithCallIdandInstanceId=function(t,u,h){var y;return ie.debug("removeCallFromTableWithCallIdandInstanceId() with reason :"+h),ie.log("callId :"+t),ie.log("instanceId :"+u),h=null,y=this.findCallIndexWithCallIdAndInstanceId(t,u),this.removeCall(y)},this.transitionToActive=function(){ie.debug("transitionToActive"),this.remoteVideo&&(this.remoteVideo.style.opacity=1),setTimeout(this.callback(this,"callback2"),1e3)},this.callback2=function(){this.miniVideo&&(this.miniVideo.style.opacity=1)},this.initMediaElementState=function(){!1===this.autoAnswer?this.localVideo&&(this.localVideo.style.opacity=0,this.localVideo.src=""):this.localVideo&&(this.localVideo.style.opacity=1),this.remoteVideo&&(this.remoteVideo.style.opacity=0,this.remoteVideo.src=""),this.miniVideo&&(this.miniVideo.style.opacity=0),!0===this.autoAnswer?ie.log("autoAnswer Activated : localStream is not stopped"):this.miniVideo&&(this.miniVideo.src="")},this.toggleVideoMute=function(t){ie.debug("toggleVideoMute");var u,h,y=this.callsTable.length,a=null,m=null;if(null==t){for(ie.debug("no callId defined, toggleVideoMute all local video"),this.isVideoMuted?null!==this.localStream&&(ie.debug("localStream unMuteTracks"),this.unMuteTracks(this.localStream.getVideoTracks())):null!==this.localStream&&(ie.debug("localStream muteTracks"),this.muteTracks(this.localStream.getVideoTracks())),this.isVideoMuted=!this.isVideoMuted,u=0;u<y;u+=1)this.callsTable[u].data&&this.callsTable[u].data.mesh||(m=null,this.callsTable[u].callConfiguration&&(m=apiCC.getUserMediaStream(this.callsTable[u].callConfiguration.userMediaStreamId)),m?m.videoMuted?m.unMuteVideoOnStreams():m.muteVideoOnStreams():null!==this.callsTable[u].callLocalStream&&(this.callsTable[u].isLocalVideoMuted?(ie.debug("unmuting call :",this.callsTable[u].callId),this.unMuteTracks(this.callsTable[u].callLocalStream.getVideoTracks())):(ie.debug("muting call :",this.callsTable[u].callId),this.muteTracks(this.callsTable[u].callLocalStream.getVideoTracks())),this.callsTable[u].isLocalVideoMuted=!this.callsTable[u].isLocalVideoMuted));for(y=this.userMediaTable.length,u=0;u<y;u+=1)m=null,this.userMediaTable[u].callConfiguration&&(m=apiCC.getUserMediaStream(this.userMediaTable[u].callConfiguration.userMediaStreamId)),m&&(m.videoMuted?m.unMuteVideoOnStreams():m.muteVideoOnStreams());return{muteState:this.isVideoMuted,callId:"ALL"}}return ie.debug("callId is defined :",t),(h=this.findCallIndexWithCallId(t))>=0?(this.callsTable[h].callConfiguration&&(m=apiCC.getUserMediaStream(this.callsTable[h].callConfiguration.userMediaStreamId)),m?(m.videoMuted?m.unMuteVideoOnStreams():m.muteVideoOnStreams(),{muteState:m.videoMuted,callId:t}):null!==this.callsTable[h].callLocalStream?(this.callsTable[h].isLocalVideoMuted?(ie.debug("unmuting call :",this.callsTable[h].callId),this.unMuteTracks(this.callsTable[h].callLocalStream.getVideoTracks())):(ie.debug("muting call :",this.callsTable[h].callId),this.muteTracks(this.callsTable[h].callLocalStream.getVideoTracks())),this.callsTable[h].isLocalVideoMuted=!this.callsTable[h].isLocalVideoMuted,{muteState:this.callsTable[h].isLocalVideoMuted,callId:t}):{muteState:"STREAM_NOT_FOUND",callId:t}):(a=this.findUserMediaById(t))&&(a.callConfiguration&&(m=apiCC.getUserMediaStream(a.callConfiguration.userMediaStreamId)),m)?(m.videoMuted?m.unMuteVideoOnStreams():m.muteVideoOnStreams(),{muteState:m.videoMuted,callId:t}):{muteState:"CALL_NOT_FOUND",callId:t}},this.unMuteTracks=function(t){var u;if(0!==t.length){for(u=0;u<t.length;u+=1)t[u].enabled=!0;ie.log("tracks unMuted.")}else ie.log("No tracks available.")},this.muteTracks=function(t){var u;if(0!==t.length){for(u=0;u<t.length;u+=1)t[u].enabled=!1;ie.log("tracks muted.")}else ie.log("No tracks available.")},this.toggleAudioMute=function(t){ie.debug("toggleAudioMute");var u,h,y=this.callsTable.length,a=null,m=null;if(null==t){for(ie.debug("no callId defined, toggleAudioMute all local audio"),this.isAudioMuted?null!==this.localStream&&(ie.debug("localStream unMuteTracks"),this.unMuteTracks(this.localStream.getAudioTracks())):null!==this.localStream&&(ie.debug("localStream muteTracks"),this.muteTracks(this.localStream.getAudioTracks())),this.isAudioMuted=!this.isAudioMuted,u=0;u<y;u+=1)this.callsTable[u].data&&this.callsTable[u].data.mesh||(m=null,this.callsTable[u].callConfiguration&&(m=apiCC.getUserMediaStream(this.callsTable[u].callConfiguration.userMediaStreamId)),m?m.audioMuted?m.unMuteAudioOnStreams():m.muteAudioOnStreams():null!==this.callsTable[u].callLocalStream&&(this.callsTable[u].isLocalAudioMuted?(ie.debug("unmuting call :",this.callsTable[u].callId),this.unMuteTracks(this.callsTable[u].callLocalStream.getAudioTracks())):(ie.debug("muting call :",this.callsTable[u].callId),this.muteTracks(this.callsTable[u].callLocalStream.getAudioTracks())),this.callsTable[u].isLocalAudioMuted=!this.callsTable[u].isLocalAudioMuted));for(y=this.userMediaTable.length,u=0;u<y;u+=1)m=null,this.userMediaTable[u].callConfiguration&&(m=apiCC.getUserMediaStream(this.userMediaTable[u].callConfiguration.userMediaStreamId)),m&&(m.audioMuted?m.unMuteAudioOnStreams():m.muteAudioOnStreams());return{muteState:this.isAudioMuted,callId:"ALL"}}return ie.debug("callId is defined :",t),(h=this.findCallIndexWithCallId(t))>=0?(this.callsTable[h].callConfiguration&&(m=apiCC.getUserMediaStream(this.callsTable[h].callConfiguration.userMediaStreamId)),m?(m.audioMuted?m.unMuteAudioOnStreams():m.muteAudioOnStreams(),{muteState:m.audioMuted,callId:t}):null!==this.callsTable[h].callLocalStream?(this.callsTable[h].isLocalAudioMuted?(ie.debug("unmuting call :",this.callsTable[h].callId),this.unMuteTracks(this.callsTable[h].callLocalStream.getAudioTracks())):(ie.debug("muting call :",this.callsTable[h].callId),this.muteTracks(this.callsTable[h].callLocalStream.getAudioTracks())),this.callsTable[h].isLocalAudioMuted=!this.callsTable[h].isLocalAudioMuted,{muteState:this.callsTable[h].isLocalAudioMuted,callId:t}):{muteState:"STREAM_NOT_FOUND",callId:t}):(a=this.findUserMediaById(t))&&(a.callConfiguration&&(m=apiCC.getUserMediaStream(a.callConfiguration.userMediaStreamId)),m)?(m.audioMuted?m.unMuteAudioOnStreams():m.muteAudioOnStreams(),{muteState:m.audioMuted,callId:t}):{muteState:"CALL_NOT_FOUND",callId:t}},this.sendDTMF=function(t,u,h,y){ie.debug("sendDTMF");var a=0;null!=t?(ie.debug("callId is defined :",t),a=this.findCallIndexWithCallId(t),ie.debug("index :",a),a>=0&&(ie.debug("index :",a),this.callsTable[a].sendTones(u,h,y))):ie.debug("no callId defined, leaving sendDTMF")},this.xhr=function(t,u,h,y){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&200===a.status&&h(a.responseText)},void 0!==y&&(a.upload.onprogress=y),a.open("POST",t),a.send(u)},this.takeSnapshot=function(t,u,h,y,a,m,_){var P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};ie.info("takeSnapshot");var x,oe=null,K=null,X=document.createElement("canvas"),me=null,Q=null,re=new Date,ye=re.toJSON(),Se=ye.replace(new RegExp(":","g"),"-"),ge=null;switch(y){case"Desactivated":x=0;break;case"Low":x=2;break;case"Medium":x=4;break;case"High":x=6;break;default:ie.log("blurLevel not defined switch case : "+y),x=0}if(void 0!==_){if(ie.log("takeSnapshot of defined video Id :"+_),null===(ge=document.getElementById(_)))return ie.log("Cannot find video with Id :"+_),ie.log("Leaving takeSnapshot"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT")}else if(ie.warn("ApiRTC DEPRECATED : Please add videoId for TakeSnapshot"),null!==this.localVideo)ge=this.localVideo,ie.log("using localVideo for takeSnapshot");else{if(null===(ge=document.getElementById("myLocalVideo")))return ie.log("Cannot find video with Id : myLocalVideo"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT");ie.log("using Video with Id : myLocalVideo for takeSnapshot")}X.width=ge.videoWidth,X.height=ge.videoHeight,P.hasOwnProperty("width")&&(ie.debug("options.width is set :"+P.width),X.width=P.width),P.hasOwnProperty("height")&&(ie.debug("options.height is set :"+P.height),X.height=P.height),ie.log("snapshot.width : "+X.width),ie.log("snapshot.height :"+X.height),(oe=X.getContext("2d")).drawImage(ge,0,0,X.width,X.height),(K=document.createElement("img")).src=X.toDataURL("image/png"),K.style.padding=5,K.width=X.width,K.height=X.height,0!==x?(ie.log("Adding Blur on Photo"),me=oe.getImageData(0,0,X.width,X.height),ie.log("av pixels data : "+me.data),me=M(K,me,x),ie.log("ap pixels data : "+me.data),oe.putImageData(me,0,0),K.src=X.toDataURL("image/png")):ie.log("blur on photo is desactivated"),"object"===Ze(u)?null!==u?u.src=K.src:ie.log("localPhotoIdOrDiv is null"):null!==document.getElementById(u)?document.getElementById(u).src=K.src:ie.log("localPhotoId is not defined"),Q=new FormData,void 0!==a?(ie.log("sessionId !== undefined :"+a),Q.append("destFileName",this.clientId+"-"+Se+".png"),Q.append("data",X.toDataURL("image/png")),Q.append("sessionId",a)):(ie.log("Upload on data1"),Q.append("photo",X.toDataURL("image/png")),Q.append("clientId",this.clientId),Q.append("apiKey",apiCC.session.apiKey)),this.xhr(t,Q,function(Pe){if(ie.log("fileName :",Pe),null!==Pe)try{var xe=JSON.parse(Pe);"OK"===xe.resultCode&&(ie.log("files loaded, filename :"+xe.fileUrl),bt.createSnapShotPhotoUploaded(xe.fileUrl))}catch(We){ie.log("Parsing error:",We)}"Photo received"!==Pe&&"An error occurred."!==Pe&&"Photo-"!==Pe.substring(0,6)||bt.createSnapShotPhotoUploaded(Pe)},m)},this.takeSnapshotAndSendOnDataChannel=function(t,u,h,y){ie.info("takeSnapshotAndSendOnDataChannel");var a,m=null,_=document.createElement("canvas"),P=null;if(void 0!==u){if(ie.log("takeSnapshot of defined video Id :"+u),null===(P=document.getElementById(u)))return ie.log("Cannot find video with Id :"+u),ie.log("Leaving takeSnapshot"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT")}else ie.warn("ApiRTC DEPRECATED : Please add videoId for TakeSnapshot");null!=P&&(_.width=P.clientWidth,_.height=P.clientHeight),ie.log("snapshot.width : "+_.width),ie.log("snapshot.height :"+_.height),_.getContext("2d").drawImage(P,0,0,_.width,_.height),(m=document.createElement("img")).src=_.toDataURL("image/png"),m.style.padding=5,m.width=_.width,m.height=_.height,"object"===Ze(t)?null!==t?t.src=m.src:ie.log("localPhotoIdOrDiv is null"):null!==document.getElementById(t)?document.getElementById(t).src=m.src:ie.log("localPhotoId is not defined"),a=_.toDataURL("image/png"),this.sendDataWithCallId(h,{file:a,name:"nomFichier",type:"image/png-dataUrl"},y)},this.callWithNumber=function(t,u,h,y){ie.info("Click on Call Button, video activated : "+u),ie.log("callConfiguration : ",y);var a=null,m=0,_=null,P=null,x=null,oe=null,K=null;if("number"==typeof t&&(ie.log("called number type is number, converting to string"),t=t.toString()),""!==t&&t!==this.clientId){if(this.setStatus("Calling Destination number :"+t),(a=new H(this)).instanceId=apiCC.generateInstanceId(),ie.log("Calling destination number :"+t),null==y||null==y.apzcallId?a.generateCallId():a.callId=y.apzcallId,!0===apiCC.isSIPNumber(t)?(ie.log("Prefix 0 , + , or 'sip:' detected, calling a SIP device"),!0===t.toString().startsWith("sip:")&&(t=t.toString().replace("sip:",""),ie.log("called SIP number is :",t)),null!=h?h.pubSub="sipConnector":(h={}).pubSub="sipConnector",a.trickleIce=!1):ie.log("Establishing Web call"),a.callerId=this.clientId,a.calleeId=t,a.dest_roomId=t,a.audioOnly=!u,a.remoteId=t,a.callConfiguration=y,null!=y?("VIDEO"===y.mediaTypeForOutgoingCall||"AUDIO"===y.mediaTypeForOutgoingCall||"VIDEOONLY"===y.mediaTypeForOutgoingCall||"NONE"===y.mediaTypeForOutgoingCall?(ie.log("Setting mediaTypeForOutgoingCall :"+y.mediaTypeForOutgoingCall),a.mediaTypeForOutgoingCall=y.mediaTypeForOutgoingCall):(ie.log("mediaTypeForOutgoingCall is not set"),!1===u&&(ie.log("videoActivated is false, setting mediaTypeForOutgoingCall to AUDIO"),a.mediaTypeForOutgoingCall="AUDIO")),null!=y.mediaRoutingMode&&a.setCallMediaRoutingMode(y.mediaRoutingMode),null!=y.turnServerAddress&&a.setCallTurnServer(y.turnServerAddress),!0!==y.preferVP9Codec&&!1!==y.preferVP9Codec||(a.preferVP9Codec=y.preferVP9Codec),y.hasOwnProperty("forceCallType")&&(a.callType=y.forceCallType,"screenSharing"!==a.callType&&"screenSharingWithAudio"!==a.callType||(a.screenSharing=!0))):ie.log("callConfiguration is not set"),void 0!==h&&void 0!==h.MCUType&&("MCU-Caller"!==h.MCUType&&"MCU-Callee"!==h.MCUType||("janusConnector"===this.MCUClient.pubConnector&&"Firefox"===c.Xh&&(a.mediaConstraints=c.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}),h.pubSub=this.MCUClient.pubConnector,h.videoBandwidthSettings=this.videoBandwidthSettings,"groupKurentoConnector"===h.pubSub&&(h.pubSub="kurentoConnector"))),a.checkDTLSCompliancy(),_=a.callId,P=apiCC.session.getConnectedUserInfo(t,"userData"),ie.log("userInfo :",P),"User_Not_Found"!==P&&void 0!==P&&void 0!==(x=JSON.parse(P))&&"true"===x.react&&(ie.log("userInfoJson.react :",JSON.stringify(x.react)),ie.log("userInfoJson.osName :",JSON.stringify(x.osName)),"iOS"===x.osName&&(ie.log("Callee : React and iOS detected, setting H264 as preferred codec for the call"),a.preferH264Codec=!0)),!0===a.audioOnly&&(a.callType="audio"),void 0!==h?a.data=h:h={},h.convId&&(h.cloudConvId||(h.cloudConvId=h.convId),delete h.convId),!0===h.dataCall&&(a.dataCall=!0),a.data.instanceId=a.instanceId,m=this.callsTable.push(a),ie.log("Call Number is :"+m),a.data&&"MCU-Caller"===a.data.MCUType&&"NONE"===a.mediaTypeForOutgoingCall)return a.inviteSended=!0,a.myWebRTC_Stack.sendInvite(a.callId,a.callerId,this.nickname,a.dest_roomId,a.dest_roomId,{type:"no-offer"},"none",a.data),a.callId;a.data&&"MCU-Caller"===a.data.MCUType&&(a.settingUpType="publish",a.callControl=this.createCallControl({type:"publish",callId:a.callId,roomName:a.data.confId,callConfiguration:a.callConfiguration,data:a.data}),a.callControl.sessionId=a.data.confId,a.callControl.token=a.data.confId,a.callControl.autoRestart.counter=0,a.setMediaConstraintsToSendOnlyOffer()),(0,d.ki)(y,"userMediaStreamId","string")&&(K=y.userMediaStreamId),null!=x&&"true"===x.isSimulated?apiCC.session.channel.socket.emit("simulatedAgentCallRequest",{number:t,call:a,videoActivated:u,data:h,callConfiguration:{apzcallId:a.callId}}):!0===this.accessToLocalMedia&&!0===this.autoAnswer||a.dataCall||K?a.dataCall?(ie.log("Datachannel call"),a.establishCall()):(ie.log("callWithNumber :: User has already granted access to local media and AutoAnswer activated : establishing call"),K?((oe=apiCC.getUserMediaStream(K)).addCallInfo(a.callId),null!=a.callConfiguration||(a.callConfiguration={}),a.callConfiguration.userMediaStreamId=oe.userMediaStreamId,a.onUserMediaSuccessOnCall(oe.stream)):a.establishCall()):"MCU-Callee"===h.MCUType&&!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("Stand-by :: wait for AcceptCall on recorded 1to1 call"):a.getUserMediaOnCall(),!0===this.autoAnswer&&this.displayHangUpButtonInCommand()}else this.setStatus("Dialed call number is not correct :"+t+".you can be reached at this number : "+this.clientId),ie.log("Call Number is incorrect");return _},this.startTestCall=function(t,u){ie.info("startTestCall : video activated : "+t);var h,y,a=null,m=null,_={};return this.setStatus("Starting test call."),(a=new H(this)).generateCallId(),a.instanceId=apiCC.generateInstanceId(),a.callerId=this.clientId,a.calleeId=12345,a.dest_roomId=12345,a.audioOnly=!t,a.remoteId=12345,a.callConfiguration=u,null!=u?("VIDEO"===u.mediaTypeForOutgoingCall||"AUDIO"===u.mediaTypeForOutgoingCall||"VIDEOONLY"===u.mediaTypeForOutgoingCall||"NONE"===u.mediaTypeForOutgoingCall?(ie.log("Setting mediaTypeForOutgoingCall :"+u.mediaTypeForOutgoingCall),a.mediaTypeForOutgoingCall=u.mediaTypeForOutgoingCall):ie.log("mediaTypeForOutgoingCall is not set"),null!=u.mediaRoutingMode&&a.setCallMediaRoutingMode(u.mediaRoutingMode),null!=u.turnServerAddress&&a.setCallTurnServer(u.turnServerAddress),!0!==u.preferVP9Codec&&!1!==u.preferVP9Codec||(a.preferVP9Codec=u.preferVP9Codec)):(ie.log("callConfiguration is not set"),u={}),a.checkDTLSCompliancy(),y=a.callId,_.pubSub="testCallKurentoConnector",a.data=_,a.data.instanceId=a.instanceId,!0===a.audioOnly&&(a.callType="audio"),h=this.callsTable.push(a),ie.log("Call Number is :"+h),!0===this.accessToLocalMedia&&!0===this.autoAnswer||a.dataCall||u.userMediaStreamId||apiCC.userMediaStreamTable.length>0?a.dataCall?(ie.log("Datachannel call"),a.establishCall()):(ie.log("startTestCall :: User has already granted access to local media and AutoAnswer activated : establishing call"),u.userMediaStreamId?((m=apiCC.getUserMediaStream(u.userMediaStreamId)).addCallInfo(a.callId),null!=a.callConfiguration||(a.callConfiguration={}),a.callConfiguration.userMediaStreamId=m.userMediaStreamId,a.callLocalStream=m.stream,a.establishCall()):(apiCC.userMediaStreamTable.length>0&&((m=apiCC.userMediaStreamTable[0]).addCallInfo(a.callId),null!=a.callConfiguration||(a.callConfiguration={}),a.callConfiguration.userMediaStreamId=m.userMediaStreamId,a.callLocalStream=m.stream),a.establishCall())):a.getUserMediaOnCall(),!0===this.autoAnswer&&this.displayHangUpButtonInCommand(),y},this.extensionInstallationSuccessCallback=function(){ie.debug("extensionInstallationSuccessCallback"),apiCC.session.apiCCWebRTCClient.webRTCClient.apiRTCExtensionInstalled=!0},this.extensionInstallationFailureCallback=function(t,u){ie.debug("extensionInstallationFailureCallback : Error :"+t+", "+u),t=null,u=null,bt.createDesktopCaptureEvent("Extension_installation_Error",this.waitingShareScreenCallId,this.waitingShareScreenDestNumber,this.waitingCaptureSourceType),this.setStatus('Inline extension installation is not possible, please install extension using following link: <a href="https://chrome.google.com/webstore/detail/apizee-desktop-capture/mjjnofoemoepfididplbfimokpnpcoeg?hl=fr" target="_blank">ApiRTC desktopCapture extension</a>')},this.manageNotInstalledExtension=function(t,u,h){ie.debug("manageNotInstalledExtension"),this.setStatus("ApiRTC extension need to be installed to enable screen sharing.<br>You can be reached at this number : "+this.clientId),ie.warn("apiRTC extension not installed"),bt.createDesktopCaptureEvent("Extension_not_installed",t,u),ie.warn("Starting apiRTC extension installation"),this.waitingShareScreenDestNumber=u,this.waitingShareScreenCallId=t,this.waitingCaptureSourceType=h,chrome.webstore.install("https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",this.callback(this,"extensionInstallationSuccessCallback"),this.callback(this,"extensionInstallationFailureCallback"))},this.shareScreen=function(t,u,h,y,a){ie.info("shareScreen");var m=null,_=null,P=null,x=null;if(!0===apiCC.isScreenSharingCompliant())if(""!==t&&t!==this.clientId){if(null!==u&&"object"===Ze(u)||(u={}),"janusConnector"===this.MCUClient.pubConnector&&!u.mesh&&a&&a.callControl&&a.callControl.callId&&this.findCallWithCallId(a.callControl.callId))return ie.debug("call already exists",a.callControl.callId),a.callControl.callId;if(null!==y&&"object"===Ze(y)||(y={}),null!==y.qos&&"object"===Ze(y.qos)?(u.qos={},u.qos.videoMinQuality="excellent"===y.qos.videoMinQuality?"excellent":"good"===y.qos.videoMinQuality?"good":"medium"===y.qos.videoMinQuality?"medium":"bad",!0===y.qos.videoForbidInactive&&(u.qos.videoForbidInactive=!0)):u.qos={videoMinQuality:"bad"},["audioLabels","videoLabels"].forEach(function(K){(0,d.Ym)(y[K],"array")&&(u[K]=[],y[K].forEach(function(X){(0,d.Ym)(X,"string")&&u[K].push(X)}))}),(0,d.Ym)(y,"context","object"))try{JSON.stringify(y.context),u.context=y.context}catch(K){}ie.log("shareScreen; callConfiguration: "+JSON.stringify(y)),_=new H(apiCC.session.apiCCWebRTCClient.webRTCClient),void 0!==u.mesh&&void 0!==u.instanceId?(ie.debug("keeping instanceId "),_.instanceId=u.instanceId):_.instanceId=apiCC.generateInstanceId(),ie.log("Calling destination number :"+t);var oe=this.MCUClient.getSessionMCU(t);if(oe&&(_.sessionMCU=oe),_.sessionMCU&&"janusConnector"===this.MCUClient.pubConnector&&!u.mesh?(_.settingUpType="shareScreen",a&&a.callControl?(_.callControl=a.callControl,_.callControl.autoRestart.counter+=1,_.callId=_.callControl.callId,_.restarted=!0):(_.callControl=this.createCallControl({type:"shareScreen",roomName:t,callConfiguration:y,data:u}),_.callControl.captureSourceType=h,_.callControl.autoRestart.counter=0,_.generateCallId(),_.callControl.callId=_.callId)):(_.settingUpType="shareScreen",_.generateCallId()),m=_.callId,_.callerId=this.clientId,_.calleeId=t,_.dest_roomId=t,_.audioOnly=!1,_.screenSharing=!0,_.remoteId=t,_.callType="screenSharing",_.captureSourceType=h,_.callConfiguration=y,_.data=u,_.data.instanceId=_.instanceId,null!=y&&null!=y.turnServerAddress&&_.setCallTurnServer(y.turnServerAddress),_.checkDTLSCompliancy(),apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(_),_.sessionMCU&&"janusConnector"===this.MCUClient.pubConnector&&_.callControl&&_.callControl.autoRestart.stream)return ie.debug("shareScreen; autoRestart"),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,_.callLocalStream=_.callControl.autoRestart.stream,_.establishCall(),_.callId;if(void 0!==u&&void 0!==u.mesh&&null!==(P=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(u.mesh.calleeCallId))&&P.callConfiguration&&P.callConfiguration.userMediaStreamId)return(x=apiCC.getUserMediaStream(P.callConfiguration.userMediaStreamId)).addCallInfo(_.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,_.sessionMCU&&"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&_.callControl&&(_.callControl.autoRestart.stream=x.stream),_.callConfiguration.userMediaStreamId=x.userMediaStreamId,_.callLocalStream=x.stream,_.establishCall(),_.callId;apiCC.createUserMediaStream({callId:_.callId,type:_.callType,captureSourceType:h,success:function(K){ie.debug("[shareScreen] success; userMediaStreamId: "+K.userMediaStreamId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,_.sessionMCU&&"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&_.callControl&&(_.callControl.autoRestart.stream=K.stream),_.callConfiguration.userMediaStreamId=K.userMediaStreamId,_.callLocalStream=K.stream,_.establishCall()}})}else this.setStatus("Dialed call number is not correct :"+t+".You can be reached at this number : "+this.clientId),ie.log("Call Number is incorrect");else ie.log("shareScreen is not supported on this browser"),bt.createDesktopCaptureEvent("Browser_Not_Compatible",m,t);return ie.info("shareScreen, callId :",m),m},this.startScreenSharingOnCall=function(t,u){ie.info("getScreenMedia for callId :"+t);var h=null;if("Chrome"===c.Xh)if(null!==(h=this.findCallWithCallId(t))){if(!1===this.apiRTCExtensionInstalled)return void this.manageNotInstalledExtension(h.callId,h.remoteId,u);null==u&&(u=["screen","window","tab"]),window.postMessage({command:"getDesktopId",callNumber:h.callId,remoteId:h.remoteId,captureSourceType:u,browser_major_version:c.PR},"*")}else ie.log("call not found");else ie.log("shareScreen is only available for chrome Browser"),bt.createDesktopCaptureEvent("Browser_Not_Compatible",t,null)},this.toggleVideoScreen=function(t){ie.info("toggleVideoScreen for callId :"+t);var u=this.findCallWithCallId(t);null!==u?u.toggleVideoScreen():ie.log("call not found")},this.switchVideoToScreen=function(t){ie.info("switchVideoToScreen for callId :"+t);var u=this.findCallWithCallId(t);null!==u?u.switchVideoToScreen():ie.log("call not found")},this.switchScreenToVideo=function(t){ie.info("switchScreenToVideo for callId :"+t);var u=this.findCallWithCallId(t);null!==u?u.switchScreenToVideo():ie.log("call not found")},this.addVideoMedia=function(t){ie.info("webRTCClient::addVideoMedia for callId :"+t);var u=this.findCallWithCallId(t);null!==u?u.addVideoMedia():ie.log("call not found")},this.callbymail=function(t){var u;ie.info("Click on Call per mail Button"),u=t,new RegExp("^[0-9a-z._-]+@{1}[0-9a-z.-]{2,}[.]{1}[a-z]{2,5}$","i").test(u)?(ie.log("Calling Destination mail :"+t),this.socket.emit("webrtc_invite_permail",t),z.channel.socket.emit("webrtc_invite_permail",t)):ie.log("Mail address is not correct :"+t)},this.callperURL=function(t){ie.info("Call per URL");var u,h=null;(h=new H(this)).instanceId=apiCC.generateInstanceId(),ie.log("Calling Destination number :"+t),h.generateCallId(),h.callerId=this.clientId,h.calleeId=t,h.dest_roomId=t,h.audioOnly=!1,h.getUserMediaOnCall(),h.remoteId=t,h.checkDTLSCompliancy(),u=this.callsTable.push(h),ie.log("Call Number is :"+u)},this.acceptCall=function(t,u){ie.info("acceptCall for callId :"+t),ie.log("acceptCall() - callConfiguration : ",u);var h=null,y=null;if(null!==(h=this.findCallWithCallId(t))){if(ie.log("acceptCall() - Call found"),h.isAccepted=!0,null!=u?("VIDEO"===u.mediaTypeForIncomingCall||"AUDIO"===u.mediaTypeForIncomingCall||"VIDEOONLY"===u.mediaTypeForIncomingCall||"NONE"===u.mediaTypeForIncomingCall||"DATA"===u.mediaTypeForIncomingCall?(ie.log("acceptCall() - Setting mediaTypeForIncomingCall :"+u.mediaTypeForIncomingCall),h.mediaTypeForIncomingCall=u.mediaTypeForIncomingCall):ie.log("acceptCall() - mediaTypeForIncomingCall is not set"),null!=u.mediaRoutingMode&&h.setCallMediaRoutingMode(u.mediaRoutingMode),null!=u.turnServerAddress&&h.setCallTurnServer(u.turnServerAddress),!0!==u.preferVP9Codec&&!1!==u.preferVP9Codec||(h.preferVP9Codec=u.preferVP9Codec)):(ie.log("acceptCall() - callConfiguration is not set"),u={}),!0===h.screenSharing&&(ie.log("acceptCall() for screenSharing : forcing mediaTypeForIncomingCall to NONE"),u.mediaTypeForIncomingCall="NONE",h.mediaTypeForIncomingCall="NONE"),h.callConfiguration=(0,d.S6)(h.callConfiguration,u),"VIDEO"===h.mediaTypeForIncomingCall?h.setLocalCallProfile({audio:!0,audioActive:!0,video:!0,videoActive:!0}):"AUDIO"===h.mediaTypeForIncomingCall?h.setLocalCallProfile({audio:!0,audioActive:!0,video:!1,videoActive:!1}):"VIDEOONLY"===h.mediaTypeForIncomingCall?h.setLocalCallProfile({audio:!1,audioActive:!1,video:!0,videoActive:!0}):"NONE"===h.mediaTypeForIncomingCall&&h.setLocalCallProfile({audio:!1,audioActive:!1,video:!1,videoActive:!1}),h.data&&"MCU-Callee"===h.data.MCUType&&"NONE"===h.mediaTypeForIncomingCall)return void h.myWebRTC_Stack.sendInvite(h.callId,h.callerId,this.nickname,h.dest_roomId,h.dest_roomId,{type:"no-offer"},"none",h.data);h.data&&"MCU-Callee"===h.data.MCUType&&(h.mediaTypeForOutgoingCall=h.mediaTypeForIncomingCall,h.settingUpType="publish",h.callControl=this.createCallControl({type:"publish",callId:h.callId,roomName:h.data.confId,callConfiguration:h.callConfiguration,data:h.data}),h.callControl.sessionId=h.data.confId,h.callControl.token=h.data.confId,h.callControl.autoRestart.counter=0,h.setMediaConstraintsToSendOnlyOffer()),this.unidirectionelCallOnly?(ie.log("acceptCall() - unidirectional call"),h.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?(ie.log("acceptCall with userAcceptOnIncomingCallBeforeGetUserMedia"),u.userMediaStreamId?((y=apiCC.getUserMediaStream(u.userMediaStreamId)).addCallInfo(h.callId),null!=h.callConfiguration||(h.callConfiguration={}),h.callConfiguration.userMediaStreamId=y.userMediaStreamId,h.onUserMediaSuccessOnCall(y.stream)):h.getUserMediaOnCall()):!0===h.accessToMedia||u.userMediaStreamId||h.dataCall?(ie.log("acceptCall() :: User has already granted access to local media and AutoAnswer activated : establishing call"),h.dataCall||u.userMediaStreamId&&((y=apiCC.getUserMediaStream(u.userMediaStreamId)).addCallInfo(h.callId),null!=h.callConfiguration||(h.callConfiguration={}),h.callConfiguration.userMediaStreamId=y.userMediaStreamId,h.callLocalStream=y.stream),h.establishCall()):ie.log("acceptCall() - call will be established when user accept his media")}else ie.log("Call not found")},this.refuseCall=function(t,u){ie.info("refuseCall for callId :"+t);var h,y=null;h=void 0!==u?u:"User_Refused_Call",null!==(y=this.findCallWithCallId(t))?(ie.log("Call found"),"MCU-Callee"===y.data.MCUType?(y.myWebRTC_Stack.sendBye(y.callId,y.callerId,y.dest_roomId,y.calleeId,"User_Media_Error",y.data),this.removeCallFromTableWithCallIdandRemoteId(y.callId,y.calleeId,h)):(y.myWebRTC_Stack.sendBye(y.callId,y.calleeId,y.dest_roomId,y.callerId,h,y.data),this.removeCallFromTableWithCallIdandRemoteId(y.callId,y.callerId,h)),0===this.callsTable.length&&(ie.log("No more established calls for client"),this.initMediaElementState())):ie.log("Call not found")},this.stopMedia=function(t){var u=this;return new Promise(function(h,y){var a=null,m=null;return(a=u.findCallWithCallId(t))?a.callLocalStream?void a.removeStream(a.callLocalStream).then(function(){return a.callLocalStream=null,(0,d.ki)(a.callConfiguration,"userMediaStreamId","string")&&(apiCC.releaseUserMediaStream(a.callConfiguration.userMediaStreamId,a.callId),delete a.callConfiguration.userMediaStreamId),h()}).catch(y):h():((m=u.findUserMediaById(t))&&m.releaseUserMediaStream(),h())})},this.addMedia=function(t,u,h,y){var a=this;ie.info("addMedia for callId :"+t);var m=null,_=null,P=null,x=function(){return Promise.resolve()},oe=function(){return Promise.resolve()};!0===u&&(x=function(){return a.stopMedia(t)}),(0,d.Ym)(h,"string")&&(P=apiCC.getUserMediaStream(h),h=null);var K=function(Q){null!=Q.callConfiguration||(Q.callConfiguration={}),Q.isLocalAudioMuted&&Q.isLocalVideoMuted?Q.callConfiguration.muted="VIDEO":Q.isLocalAudioMuted?Q.callConfiguration.muted="AUDIOONLY":Q.isLocalVideoMuted&&(Q.callConfiguration.muted="VIDEOONLY")},X=function(Q,re,ye){"audio"===re?Q.audioSdpDirection=ye?null:(0,d.ki)(Q.remoteCallProfile,"audio","boolean")&&!0===Q.remoteCallProfile.audio&&!0===Q.remoteCallProfile.audioActive?"recvonly":"inactive":"video"===re&&(Q.videoSdpDirection=ye?null:(0,d.ki)(Q.remoteCallProfile,"video","boolean")&&!0===Q.remoteCallProfile.video&&!0===Q.remoteCallProfile.videoActive?"recvonly":"inactive")},me=function(Q,re,ye,Se){var ge,Pe,xe;null!=Q.callConfiguration||(Q.callConfiguration={}),Q.callConfiguration.userMediaStreamId=re.userMediaStreamId,X(Q,"audio",re.audio),X(Q,"video",re.video),K(Q),ge=Q,xe=re.video,(Pe=re.audio)&&xe?(ge.audioOnly=!1,ge.mediaTypeForIncomingCall="VIDEO",ge.mediaTypeForOutgoingCall="VIDEO"):Pe?(ge.audioOnly=!1,ge.mediaTypeForIncomingCall="AUDIO",ge.mediaTypeForOutgoingCall="AUDIO"):xe?(ge.audioOnly=!1,ge.mediaTypeForIncomingCall="VIDEOONLY",ge.mediaTypeForOutgoingCall="VIDEOONLY"):(ge.audioOnly=!1,ge.mediaTypeForIncomingCall="NONE",ge.mediaTypeForOutgoingCall="NONE"),Q.callLocalStream=re.stream,Q.started?Q.addingUserMedia=!0:a.accessToLocalMedia=!0,Q.asyncCallbacks={},Q.asyncCallbacks.type="addingUserMedia",Q.asyncCallbacks.resolve=ye,Q.asyncCallbacks.reject=Se,Q.asyncCallbacks.timeoutId=setTimeout(function(){Q.asyncCallbacks&&"function"==typeof Q.asyncCallbacks.reject&&(Q.asyncCallbacks.reject("addMedia timeout"),delete Q.asyncCallbacks)},4e4),Q.establishCall()};if(null!==(m=this.findCallWithCallId(t))){if(m.asyncCallbacks)return Promise.reject("job already ongoing");oe=function(){return new Promise(function(Q,re){P?(P.addCallInfo(m.callId),me(m,P,Q,re)):h?apiCC.createUserMediaStream({type:"media",callId:m.callId,stream:h,sync:!0,success:function(ye){ie.debug("[addMedia] success; userMediaStreamId: "+ye.userMediaStreamId),me(m,ye,Q,re)},failure:function(ye,Se){return re(Se)}}):(0,d.ki)(y,"getUserMediaStreamId","function")?y.getUserMediaStreamId().then(function(ye){if(!(P=apiCC.getUserMediaStream(ye)))return re("wrong userMediaStreamId");P.addCallInfo(m.callId),me(m,P,Q,re)}).catch(re):apiCC.userMediaStreamTable.length>0?((P=apiCC.userMediaStreamTable[0]).addCallInfo(m.callId),me(m,P,Q,re)):(K(m),m.addingUserMedia=!0,m.asyncCallbacks={},m.asyncCallbacks.type="addingUserMedia",m.asyncCallbacks.resolve=Q,m.asyncCallbacks.reject=re,m.asyncCallbacks.timeoutId=setTimeout(function(){m.asyncCallbacks&&"function"==typeof m.asyncCallbacks.reject&&(m.asyncCallbacks.reject("addMedia timeout"),delete m.asyncCallbacks)},4e4),m.getUserMediaOnCall())})}}else if(_=this.findUserMediaById(t)){if(!0===_.addingUserMedia)return Promise.reject("addMedia already ongoing");oe=function(){return new Promise(function(Q,re){_.addingUserMedia=!0,new Promise(function(ye,Se){if(P)return P.addCallInfo(_.userMediaId,"userMedia"),null!=_.callConfiguration||(_.callConfiguration={}),_.callConfiguration.userMediaStreamId=P.userMediaStreamId,_.callType=P.callType,_.audio=P.audio,_.video=P.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(_,!0),ye(P.userMediaStreamId);if(h)apiCC.createUserMediaStream({callId:_.userMediaId,callFlavor:"userMedia",type:_.callType,stream:h,sync:!0,success:function(ge){return ie.debug("[addMedia] success; userMediaStreamId: "+ge.userMediaStreamId),null!=_.callConfiguration||(_.callConfiguration={}),_.callConfiguration.userMediaStreamId=ge.userMediaStreamId,_.callType=ge.callType,_.audio=ge.audio,_.video=ge.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(_,!0),ye(ge.userMediaStreamId)},failure:function(ge,Pe){return Se(Pe)}});else if((0,d.ki)(y,"getUserMediaStreamId","function"))y.getUserMediaStreamId().then(function(ge){return(P=apiCC.getUserMediaStream(ge))?(P.addCallInfo(_.userMediaId,"userMedia"),null!=_.callConfiguration||(_.callConfiguration={}),_.callConfiguration.userMediaStreamId=P.userMediaStreamId,_.callType=P.callType,_.audio=P.audio,_.video=P.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(_,!0),ye(P.userMediaStreamId)):Se("wrong userMediaStreamId")}).catch(Se);else{if(apiCC.userMediaStreamTable.length>0)return(P=apiCC.userMediaStreamTable[0]).addCallInfo(_.userMediaId,"userMedia"),null!=_.callConfiguration||(_.callConfiguration={}),_.callConfiguration.userMediaStreamId=P.userMediaStreamId,_.callType=P.callType,_.audio=P.audio,_.video=P.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(_,!0),ye(P.userMediaStreamId);apiCC.createUserMediaStream({callId:_.userMediaId,callFlavor:"userMedia",type:_.callType,audioSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.audioSourceId,videoSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.videoSourceId,success:function(ge){return ie.debug("[addMedia] success; userMediaStreamId: "+ge.userMediaStreamId),null!=_.callConfiguration||(_.callConfiguration={}),_.callConfiguration.userMediaStreamId=ge.userMediaStreamId,_.callType=ge.callType,_.audio=ge.audio,_.video=ge.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(_,!0),ye(ge.userMediaStreamId)},failure:function(ge,Pe){return Se(Pe)}})}}).then(function(ye){return Se=ye,new Promise(function(ge,Pe){for(var xe=[],We=0;We<apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length;We+=1){var rt=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[We];void 0!==rt.data&&void 0!==rt.data.mesh&&rt.data.mesh.calleeCallId===t&&xe.push(apiCC.session.apiCCWebRTCClient.webRTCClient.addMedia(rt.callId,!0,Se))}Promise.all(xe).then(function(){return ge(Se)}).catch(Pe)});var Se}).then(function(ye){return delete _.addingUserMedia,Q(ye)}).catch(function(ye){return delete _.addingUserMedia,re(ye)})})}}else oe=function(){return Promise.reject("no suitable replacement")};return new Promise(function(Q,re){x().then(function(){return oe()}).then(function(ye){return ie.info("addMedia success; userMediaStreamId: "+ye),Q(ye)}).catch(function(ye){ie.error("addMedia failure: "+ye);var Se=null,ge=null;return m?(m.callControl&&(Se=m.callControl.roomName,ge=m.callControl.type),bt.createErrorEvent("Failed to addMedia","MEDIA_UPDATE_ERROR",m.callId,Se,ge)):_&&bt.createErrorEvent("Failed to addMedia","MEDIA_UPDATE_ERROR",_.userMediaId,null,"publish"),re(ye)})})},this.updateMediaDeviceOnCall=function(t,u){return ie.info("updateMediaDeviceOnCall for callId :"+t),this.addMedia(t,!0,u),t},this.updateMediaTypeOnCall=function(t,u){var h=function(m,_,P){return new Promise(function(x,oe){var K,X={};m.callControl.mediaType=P,m.mediaType=P,m.data.mediaType=P,m.updateCause="userAction",X.type="update",X.mode="passive",X.callId=m.callId,X.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,X.callerNickname=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,X.calleeId=m.sessionMCU.roomName,X.roomId=m.sessionMCU.roomName,X.callType=_.attributes.callType,X.data=(0,d.S6)(m.data),X.data.type="subscribe",X.stream=_,K=JSON.stringify(X),ie.log("C->S: "+K),apiCC.session.apiCCWebRTCClient.webRTCClient.socket.emit("update",K),m.asyncCallbacks={},m.asyncCallbacks.type="updateMediaType",m.asyncCallbacks.resolve=x,m.asyncCallbacks.reject=oe,m.asyncCallbacks.timeoutId=setTimeout(function(){m.asyncCallbacks&&"function"==typeof m.asyncCallbacks.reject&&(m.asyncCallbacks.reject("timeout"),delete m.asyncCallbacks)},2e4)})},y=this.findCallWithCallId(t);if(!y)return Promise.reject("call not found");if("subscribe"!==y.settingUpType)return Promise.reject("wrong call type");if(y.asyncCallbacks)return Promise.reject("job already ongoing");var a=this.MCUClient.getStreamFromList(y.streamId);if(!a)return Promise.reject("wrong streamId");if("VIDEO"===y.callControl.mediaType){if("AUDIOONLY"===u&&a.audio||"VIDEOONLY"===u&&a.video)return h(y,a,u)}else if("AUDIOONLY"===y.callControl.mediaType){if("VIDEO"===u&&a.video||"VIDEOONLY"===u&&a.video)return h(y,a,u)}else if("VIDEOONLY"===y.callControl.mediaType&&("VIDEO"===u&&a.video||"AUDIOONLY"===u&&a.audio))return h(y,a,u);return Promise.reject("wrong mediaType")},this.updateSimulcastFeedOnCall=function(t,u){var h=this.findCallWithCallId(t);if(!h)return Promise.reject("call not found");if("subscribe"!==h.settingUpType)return Promise.reject("wrong call type");if(h.asyncCallbacks)return Promise.reject("job already ongoing");var y=this.MCUClient.getStreamFromList(h.streamId);if(!y)return Promise.reject("wrong streamId");if(!u)return Promise.reject("wrong simulcast");h.callControl.callConfiguration.simulcast||(h.callControl.callConfiguration.simulcast={}),h.data.simulcast||(h.data.simulcast={}),u.streamQuality&&("high"===u.streamQuality?(h.callControl.callConfiguration.simulcast.substream=2,h.data.simulcast.substream=2):"medium"===u.streamQuality?(h.callControl.callConfiguration.simulcast.substream=1,h.data.simulcast.substream=1):"low"===u.streamQuality?(h.callControl.callConfiguration.simulcast.substream=0,h.data.simulcast.substream=0):(h.callControl.callConfiguration.simulcast.substream=-1,h.data.simulcast.substream=-1)),u.streamFrameRate&&("high"===u.streamFrameRate?(h.callControl.callConfiguration.simulcast.temporal=2,h.data.simulcast.temporal=2):"medium"===u.streamFrameRate?(h.callControl.callConfiguration.simulcast.temporal=1,h.data.simulcast.temporal=1):"low"===u.streamFrameRate?(h.callControl.callConfiguration.simulcast.temporal=0,h.data.simulcast.temporal=0):(h.callControl.callConfiguration.simulcast.temporal=-1,h.data.simulcast.temporal=-1));var a={type:"updateSimulcastFeed"};a.callId=h.callId,a.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,a.callerNickname=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,a.calleeId=h.sessionMCU.roomName,a.roomId=h.sessionMCU.roomName,a.callType=y.attributes.callType,a.data=(0,d.S6)(h.data),a.stream=y;var m=JSON.stringify(a);return ie.log("C->S: "+m),apiCC.session.apiCCWebRTCClient.webRTCClient.socket.emit("updateSimulcastFeed",m),Promise.resolve()},this.updateCallConfigurationOnCall=function(t,u){var a,m,h=function(a,m,_){"audio"===m?a.audioSdpDirection=_?null:"inactive":"video"===m&&(a.videoSdpDirection=_?null:"inactive")},y=this.findCallWithCallId(t);return y?"publish"!==y.settingUpType?Promise.reject("wrong call type"):y.asyncCallbacks?Promise.reject("job already ongoing"):((0,d.Ym)(u,"object")||(u={}),(0,d.ki)(u,"audioOnly","boolean")||(u.audioOnly=!1),(0,d.ki)(u,"videoOnly","boolean")||(u.videoOnly=!1),a=y,m=u,new Promise(function(_,P){a.mediaTypeForIncomingCall="NONE",!0===m.audioOnly?(ie.log("Setting call as audioOnly"),a.audioOnly=!0,a.callType="audio",a.mediaTypeForOutgoingCall="AUDIO",h(a,"audio",!0),h(a,"video",!1)):!0===m.videoOnly?(ie.log("Setting call as videoOnly"),a.audioOnly=!1,a.callType="videoOnly",a.mediaTypeForOutgoingCall="VIDEOONLY",h(a,"audio",!1),h(a,"video",!0)):(ie.log("Setting call as media"),a.audioOnly=!1,a.callType="media",a.mediaTypeForOutgoingCall="VIDEO",h(a,"audio",!0),h(a,"video",!0)),a.updateUserMedia=!0,a.updateCause="userAction",a.establishCall(),a.asyncCallbacks={},a.asyncCallbacks.type="updateCallConfiguration",a.asyncCallbacks.resolve=_,a.asyncCallbacks.reject=P,a.asyncCallbacks.timeoutId=setTimeout(function(){a.asyncCallbacks&&"function"==typeof a.asyncCallbacks.reject&&(a.asyncCallbacks.reject("timeout"),delete a.asyncCallbacks)},2e4)})):Promise.reject("call not found")},this.findUserMediaById=function(t){for(var u=this.userMediaTable.length;--u>=0;)if(this.userMediaTable[u].userMediaId===t)return this.userMediaTable[u];return null},this.findCallIndexWithCallIdAndRemoteId=function(t,u){ie.debug("findCallIndexWithCallIdAndRemoteId");var h,y=this.callsTable.length;for(ie.trace("callsNumber : "+y),h=0;h<y;h+=1)if(this.callsTable[h].callId===t&&(ie.log("callId found"),ie.log("this.callsTable[i].callee :"+this.callsTable[h].callee),ie.log("this.callsTable[i].calleeId :"+this.callsTable[h].calleeId),!0===this.callsTable[h].callee&&this.callsTable[h].callerId===u||!1===this.callsTable[h].callee&&this.callsTable[h].calleeId===u))return h;return ie.log("Call not found"),-1},this.findCallIndexWithConfIdAndRemoteId=function(t,u){ie.debug("findCallIndexWithConfIdAndRemoteId"),ie.log("confId :"+t),ie.log("remoteId :"+u);var h,y=this.callsTable.length;for(h=0;h<y;h+=1)if(ie.log("this.callsTable[i].data.confId :"+this.callsTable[h].data.confId),this.callsTable[h].data.confId===t){if(!0===this.callsTable[h].callee&&this.callsTable[h].callerId===u||!1===this.callsTable[h].callee&&this.callsTable[h].calleeId===u)return h}else ie.debug("ConfId is different");return ie.debug("Call not found - findCallIndexWithConfIdAndRemoteId"),-1},this.findCallIndexWithCallId=function(t){ie.debug("findCallIndexWithCallId");var u,h=this.callsTable.length;for(u=0;u<h;u+=1)if(this.callsTable[u].callId===t)return ie.log("Call found with callId"),u;return ie.debug("Call not found - findCallIndexWithCallId"),-1},this.findCallWithCallIdAndInstanceId=function(t,u){ie.debug("findCallWithCallIdAndInstanceId :"+t+" ,instanceId : "+u),void 0===u&&ie.debug("instanceId is undefined : must be a mesh publish call, id must be a streamId");var h,y=this.callsTable.length;for(ie.trace("callsNumber :"+y),h=0;h<y;h+=1)if(this.callsTable[h].callId===t&&this.callsTable[h].instanceId===u)return this.callsTable[h];return ie.debug("Call not found, findCallWithCallIdAndInstanceId"),null},this.findCallIndexWithCallIdAndInstanceId=function(t,u){ie.debug("findCallIndexWithCallIdAndInstanceId :"+t+" ,instanceId : "+u),void 0===u&&ie.debug("instanceId is undefined : must be a mesh publish call, id must be a streamId");var h,y=this.callsTable.length;for(ie.trace("callsNumber :"+y),h=0;h<y;h+=1)if(this.callsTable[h].callId===t&&this.callsTable[h].instanceId===u)return h;return ie.debug("Call not found, findCallIndexWithCallIdAndInstanceId"),-1},this.findCallWithCallId=function(t){ie.trace("findCallWithCallId :"+t);var u,h=this.callsTable.length;for(ie.trace("callsNumber :"+h),u=0;u<h;u+=1)if(ie.trace("this.callsTable[i].callId :"+this.callsTable[u].callId),this.callsTable[u].callId===t)return this.callsTable[u];return ie.debug("Call not found"),null},this.findCallWithStreamId=function(t,u){ie.debug("findCallWithStreamId :"+t);var h,y=!(!u||!u.ignoreModeChangeKindOld),a=this.callsTable.length;for(ie.trace("callsNumber :"+a),h=0;h<a;h+=1)if(ie.log("this.callsTable[i].streamId :"+this.callsTable[h].streamId),!(this.callsTable[h].streamId!=t||y&&this.callsTable[h].sessionMCU&&"old"===this.callsTable[h].sessionMCU.modeChangeKind))return ie.log("Call found"),this.callsTable[h];return ie.log("Call not found"),null},this.findCallWithCallIdAndRemoteIdAndInstanceId=function(t,u,h){ie.debug("findCallWithCallIdAndRemoteIdAndInstanceId callId : "+t+" ,instanceId : "+h);var y,a=this.callsTable.length;for(ie.trace("callsNumber :"+a),y=0;y<a;y+=1)if(this.callsTable[y].callId===t&&this.callsTable[y].instanceId===h&&(!0===this.callsTable[y].callee&&this.callsTable[y].callerId===u||!1===this.callsTable[y].callee&&this.callsTable[y].calleeId===u))return this.callsTable[y];return ie.debug("Call not found"),null},this.findCallWithCallIdAndRemoteId=function(t,u){ie.log("findCallWithCallIdAndRemoteId");var h,y=this.callsTable.length;for(ie.trace("callsNumber :"+y),h=0;h<y;h+=1)if(this.callsTable[h].callId===t&&(!0===this.callsTable[h].callee&&this.callsTable[h].callerId===u||!1===this.callsTable[h].callee&&this.callsTable[h].calleeId===u))return this.callsTable[h];return ie.log("Call not found"),null},this.remoteVideoDisplayManager=function(){ie.debug("remoteVideoDisplayManager");var t,u=[],h=0,y=0,a=0,m=0,_=0,P=0,x=0;for(this.remoteVideo&&(0===this.maxWidthRemoteVideo&&(this.maxWidthRemoteVideo=this.remoteVideo.clientWidth),0===this.maxHeightRemoteVideo&&(this.maxHeightRemoteVideo=this.remoteVideo.clientHeight),h=(u=this.remoteVideo.children).length,a=this.maxHeightRemoteVideo,ie.log("maxWidth"+(y=this.maxWidthRemoteVideo)),ie.log("maxHeight"+a),m=this.remoteVideo.clientWidth),m>y&&(m=y),(_=3/4*(m/=h))>a&&(m=4/3*(_=a)),P=m/y*100,x=_/a*100,x+="%",ie.log("widthinPercent"+(P+="%")),ie.log("heightinPercent"+x),t=0;t<h;t+=1)u[t].style.cssText="width:"+P+";height:"+x+";"},this.removeRemoteVideoDisplay=function(t){ie.debug("removeRemoteVideoDisplay with callId ="+t);var u,h="callId_"+t,y=[],a=0;for(this.remoteVideo&&(a=(y=this.remoteVideo.children).length),u=0;u<a;u+=1)if(y[u].id===h)return this.remoteVideo.removeChild(y[u]),void ie.log("VideoDisplay removed for "+h);this.remoteVideoDisplayManager()},this.setStatus=function(t){null!==this.statusDiv?this.statusDiv.innerHTML=t:ie.log("Status Div Null")},this.displayCallButtonInCommand=function(){null!==this.commandDiv&&(this.commandDiv.innerHTML='<form name="form1" action=""><input type="texte" name="mail" value="" placeholder="Enter Destination number..."><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.call(document.forms.form1.mail.value);"><img src="http://www.apizee.com/Demo/images/Call.png" height="30px"></a></input></form>')},this.displayHangUpButtonInCommand=function(){ie.debug("displayHangUpButtonInCommand"),null!==this.commandDiv&&(this.commandDiv.innerHTML='<a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleAudioMute()"> <img src="http://www.apizee.com/Demo/images/Microphone.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleVideoMute();"> <img src="http://www.apizee.com/Demo/images/Camera2.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.hangUp()"> <img src="http://www.apizee.com/Demo/images/Hangup.png" height="30px" disabled="true"> </a>')},this.checkURLForCallDestination=function(){var t=0;return"room"===location.search.substring(1,5)&&(ie.log("Call establishment using URL"),t=location.search.substring(6),ie.log("Destination call number is :"+t)),t},this.releaseUserMedia=function(){ie.info("releaseUserMedia"),null!==this.localStream&&(ie.log("stopping localStream"),this.stopStream(this.localStream),bt.createUserMediaStopEvent(null,"media"),this.accessToLocalMedia=!1,this.autoAnswer=!1,ie.log("this.autoAnswer :"+this.autoAnswer)),null!=this.screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.screenStream),bt.createUserMediaStopEvent(null,"screen"))},this.startDataChannelOnCall=function(t){ie.info("startDataChannelOnCall with callId :"+t);var u=this.findCallWithCallId(t);u?(ie.log("Call found",u),u.addingDataChannelOnCallOngoing=!0,u.createDataChannel()):ie.log("Call not found")},this.sendDataWithCallId=function(t,u,h){ie.info("sendDataWithCallId :"+t);var y=this.findCallWithCallId(t);y?(ie.log("Call found",y),y.sendData(u,h)):ie.log("Call not found")},this.processDataAck=function(t){ie.debug("processDataAck",t);var u=this.findCallWithCallId(t.callId);if(u)if("ok"===t.result)if((0,d.ki)(t,"capabilities","object")&&(0,d.ki)(t.capabilities,"dataEndAckEnabled","boolean")&&(u.dataEndAckEnabled=t.capabilities.dataEndAckEnabled,ie.debug("dataEndAckEnabled",u.dataEndAckEnabled)),"complete"===t.state)u.beginTimeoutId&&(clearTimeout(u.beginTimeoutId),delete u.beginTimeoutId),u.callbacks.success({state:"complete",filename:u.data.filename,size:u.data.size,mediaURL:t.mediaURL,mediaId:t.mediaId}),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(u.callId);else if("incomplete"===t.state){var h,y,a=1<<17,m=[],_=Math.floor(u.data.size/a),P=u.data.size%a;for(h=0;h<_;h+=1)(y=at("checksum64")).update(u.fileContent,h*a,a),m.push(y.digest("hex"));if(P>0&&((y=at("checksum64")).update(u.fileContent,_*a,P),m.push(y.digest("hex"))),ie.debug(JSON.stringify(m)),t.checksums.length===m.length){for(h=0;h<m.length&&t.checksums[h]===m[h];h+=1);u.data.offset=a*h}u.mediaURL=t.mediaURL,u.mediaId=t.mediaId,u.establishCall()}else"missing"===t.state?(u.mediaURL=t.mediaURL,u.mediaId=t.mediaId,u.establishCall()):"ready"===t.state?u.establishCall():(ie.debug("wrong state "+t.state),u.beginTimeoutId&&(clearTimeout(u.beginTimeoutId),delete u.beginTimeoutId),u.callbacks.failure("serverError"),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(u.callId));else ie.debug("wrong result "+t.result),u.beginTimeoutId&&(clearTimeout(u.beginTimeoutId),delete u.beginTimeoutId),u.callbacks.failure("serverError"),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(u.callId);else ie.debug("no such call",t.callId)},this.processDataEndAck=function(t){ie.debug("processDataEndAck",t);var u=this.findCallWithCallId(t.callId);if(u){var h=null;if(!u.dcfs){if(!u.data||"pipeline"!==u.data.transferType)return void ie.debug("not pipeline");ie.debug("pipeline"),h=u,u.clientCall?(ie.debug("resolve client call"),u=u.clientCall):(ie.debug("no client call"),u=null)}u&&(u.success&&t.data&&(u.success.data=t.data),"ok"===t.result?(!0===t.complete||(delete u.success,u.failure="transferIncomplete"),u.dcfs.terminateTransfer()):"error"===t.result&&(delete u.success,u.failure=t.errorInfo,u.dcfs.terminateTransfer())),h&&"error"===t.result&&(ie.debug("error on pipeline"),h.failure=t.errorInfo,bt.createEvent({eventType:"onFileSended",callId:h.callId,remoteId:h.remoteId,name:h.filename,error:h.failure}),h.callbacks.failure(h.failure),this.onHangup(h.callId))}else ie.debug("no such call",t.callId)},this.pushData=function(t,u,h,y){var a=this;if(!(0,d.Ym)(u,"object")||((u=Object.assign({},u)).transferType||(u.transferType="file"),"file"===u.transferType&&!t)||"file"!==u.transferType&&"pipeline"!==u.transferType&&"plugin"!==u.transferType||!("plugin"!==u.transferType||u.pluginName&&u.pluginData))return null;(0,d.Ym)(y,"object")||(y={}),"function"!=typeof y.pending&&(y.pending=function(){}),"function"!=typeof y.progress&&(y.progress=function(){}),"function"!=typeof y.success&&(y.success=function(){}),"function"!=typeof y.failure&&(y.failure=function(){});var m=new H(apiCC.session.apiCCWebRTCClient.webRTCClient);if(m.generateCallId(),m.instanceId=apiCC.generateInstanceId(),m.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,m.calleeId="dataChannelConnector",m.dest_roomId="dataChannelConnector",m.callType="data",m.dataCall=!0,m.remoteId="dataChannelConnector",u.pipelineCallId&&(m.pipelineCallId=u.pipelineCallId),m.data={},m.data.pubSub="dataChannelConnector",m.data.transferType=u.transferType,"pipeline"===u.transferType?(u.checksumEnabled=!1,m.transferCount=0):"plugin"===u.transferType&&(u.checksumEnabled=!1,m.data.pluginName=u.pluginName,m.data.pluginData=Object.assign({},u.pluginData),m.data.pluginData.headers&&(m.data.pluginData.headers=Object.assign({},m.data.pluginData.headers)),m.data.pluginData.data&&(m.data.pluginData.data=Object.assign({},m.data.pluginData.data)),m.data.pluginData.formData&&(m.data.pluginData.formData=Object.assign({},m.data.pluginData.formData))),(0,d.ki)(u,"context","object"))try{JSON.stringify(u.context),m.data.context=Object.assign({},u.context)}catch(_){}if(!0===u.overwrite&&(m.data.overwrite=!0),(0,d.Ym)(u,"ttl","number")&&u.ttl>0&&(m.data.ttl=u.ttl),m.data.instanceId=m.instanceId,t&&(m.data.cloudConvId=t),m.callbacks=y,null!=h&&null!=h.turnServerAddress&&m.setCallTurnServer(h.turnServerAddress),"pipeline"===m.data.transferType)m.data.size=0,m.pushDataStatus={type:"pipeline",state:"pending",data:u},this.callsTable.push(m),setTimeout(function(){a.startNextPushData()});else if((0,d.Ym)(u,"file","object")&&(u.file instanceof File||u.file.constructor===File||!0===u.asFile))m.data.filename=(0,d.Ym)(u,"filename","string")?u.filename:u.file.name,m.data.contentType=(0,d.Ym)(u,"filetype","string")?u.filetype:u.file.type,(0,d.Ym)(u,"sourceType","string")&&u.sourceType.length>0&&(m.data.sourceType=u.sourceType),m.data.size=u.file.size,m.data.metadata=u.metadata,m.pushDataStatus={type:"file",state:"pending",convId:String(t),data:u},this.callsTable.push(m),setTimeout(function(){a.startNextPushData()});else{if(!((0,d.Ym)(u,"buffer","object")&&(u.buffer instanceof ArrayBuffer||u.buffer.constructor===ArrayBuffer||!0===u.asBuffer)&&(0,d.Ym)(u,"filename","string")&&(0,d.Ym)(u,"filetype","string")))return null;m.data.filename=u.filename,m.data.contentType=u.filetype,(0,d.Ym)(u,"sourceType","string")&&u.sourceType.length>0&&(m.data.sourceType=u.sourceType),m.data.size=u.buffer.byteLength,m.data.metadata=u.metadata,m.pushDataStatus={type:"buffer",state:"pending",convId:String(t),data:u},this.callsTable.push(m),setTimeout(function(){a.startNextPushData()})}return m.callId},this.startNextPushData=function(){for(var t=this,u=[],h=0;h<this.callsTable.length;h+=1){var y=this.callsTable[h];if("data"===y.callType&&y.dataCall&&"dataChannelConnector"===y.remoteId&&y.pushDataStatus){if("ready"===y.pushDataStatus.state)continue;u.push(y)}}if(0===u.length)return!1;var a=null;"active"===u[0].pushDataStatus.state?u.splice(0,1):"pending"===u[0].pushDataStatus.state&&(a=u[0],u.splice(0,1));for(var m=0;m<u.length;m+=1){var _=u[m];_.pushDataStatus.rank!==m&&(_.pushDataStatus.rank=m,bt.createEvent({eventType:"onFilePending",callId:_.callId,remoteId:_.remoteId,name:_.data.filename,rank:m}),_.callbacks.pending({state:"pending",callId:_.callId,rank:m}))}if(!a)return!1;ie.debug("startNextPushData",a.callId);var P=a.pushDataStatus.data;if(delete a.pushDataStatus.data,"pipeline"===a.pushDataStatus.type){a.pushDataStatus.state="active";var x={type:"pushData",callerId:apiCC.session.apiCCId,callId:a.callId,data:a.data},oe=JSON.stringify(x);return ie.debug("C->S: "+oe),apiCC.session.channel.socket.emit("pushData",oe),!0}if("file"===a.pushDataStatus.type){a.pushDataStatus.state="active";var K=new FileReader;K.onload=function(X){apiCC.session.apiCCWebRTCClient.webRTCClient.startPushData(a,P,X.target.result)},K.readAsArrayBuffer(P.file)}else{if("buffer"!==a.pushDataStatus.type)return ie.error("startNextPushData - wrong type"),a.callbacks.failure("start",a.callId),this.onHangup(a.callId),!1;a.pushDataStatus.state="active",this.startPushData(a,P,P.buffer)}return a.beginTimeoutId=setTimeout(function(){delete a.beginTimeoutId,a.callbacks.failure("timeout",a.callId),t.onHangup(a.callId)},2e4),!0},this.startPushData=function(t,u,h){if(t.fileContent=new Uint8Array(h),t.pipelineCallId){var y=this.findCallWithCallId(t.pipelineCallId);if(!y)return ie.error("no such pipeline call"),void this.onHangup(t.callId);t.pipelineCall=y,y.clientCall=t,t.sendDataChannel=y.sendDataChannel,t.startTransfer({delay:0===y.transferCount?100:0}),y.transferCount+=1}else{if(!Object.prototype.hasOwnProperty.call(u,"checksumEnabled")||u.checksumEnabled){var m=at("checksum64");m.update(t.fileContent),t.data.checksum=m.digest("hex")}else t.data.checksumEnabled=!1;var _={type:"pushData",callerId:apiCC.session.apiCCId,convId:t.pushDataStatus.convId,callId:t.callId,data:t.data},P=JSON.stringify(_);ie.debug("C->S: "+P),apiCC.session.channel.socket.emit("pushData",P)}},this.cancelPushData=function(t){for(var u=null,h=this.callsTable.length;--h>=0;){var y=this.callsTable[h];if(y.callId===t&&"data"===y.callType&&y.dataCall&&"dataChannelConnector"===y.remoteId&&y.pushDataStatus){u=y;break}}if(!u)return ie.error("cancelPushData - no such call",t),"no such call";if("pending"===u.pushDataStatus.state)bt.createEvent({eventType:"onFileSended",callId:u.callId,remoteId:u.remoteId,name:u.data.filename,error:"canceled"}),u.callbacks.failure("canceled"),this.onHangup(u.callId);else if("active"===u.pushDataStatus.state)this.onHangup(u.callId);else{if("ready"!==u.pushDataStatus.state)return ie.error("cancelPushData - wrong state"),"wrong state";u.clientCall&&this.cancelPushData(u.clientCall.callId),u.success={state:"complete"},bt.createEvent({eventType:"onFileSended",callId:u.callId,remoteId:u.remoteId}),u.callbacks.success(u.success),this.onHangup(u.callId)}return null},this.setVideoBandwidth=function(t,u,h){var y=!1,a=!1;if("overall"===u?"incoming"===h?t>0?(this.videoBandwidthSettings.overallIncoming=t,y=!0):(delete this.videoBandwidthSettings.overallIncoming,y=!0):"outgoing"===h&&(t>0?(this.videoBandwidthSettings.overallOutgoing=t,y=!0,a=!0):(delete this.videoBandwidthSettings.overallOutgoing,y=!0,a=!0)):"perCall"===u?"incoming"===h?t>0?(this.videoBandwidthSettings.perCallIncoming=t,y=!0):(delete this.videoBandwidthSettings.perCallIncoming,y=!0):"outgoing"===h&&(t>0?(this.videoBandwidthSettings.perCallOutgoing=t,y=!0,a=!0):(delete this.videoBandwidthSettings.perCallOutgoing,y=!0,a=!0)):"remote"===u&&(this.videoRemoteBandwidth=t),y)for(var m=this.MCUClient.sessionMCUs.length;--m>=0;){var P=JSON.stringify({type:"info",infoType:"setVideoBandwidthSettings",data:{clientId:this.clientId,roomId:this.MCUClient.sessionMCUs[m].roomName,pubSub:this.MCUClient.pubConnector,videoBandwidthSettings:this.videoBandwidthSettings}});ie.log("C->S: "+P),apiCC.session.channel.socket.emit("info",P)}a&&this.evalOutgoingVideoBandwithCap()},this.setAudioBandwidth=function(t){this.audioBandwidth=t},this.setDataBandwidth=function(t){this.dataBandwidth=t},this.processCheckCallStatus=function(t){this.MCUClient.processCheckCallStatus(t);var u={type:"updateCallStatus",clientId:this.clientId,data:{}};t.data.pubSub&&(u.data.pubSub=t.data.pubSub),u.sessions=[];for(var h=0;h<this.MCUClient.sessionMCUs.length;h+=1)u.sessions.push(this.MCUClient.createSessionDescriptor(this.MCUClient.sessionMCUs[h]));u.calls=[];for(var y=0;y<this.userMediaTable.length;y+=1){var a=this.userMediaTable[y];u.calls.push({callId:a.userMediaId,callType:a.callType,remoteId:a.remoteId,roomId:a.roomId,data:a.data,meshPublish:!0})}for(var m=0;m<this.callsTable.length;m+=1){var _=this.callsTable[m];u.calls.push({callId:_.callId,callType:_.callType,remoteId:_.remoteId,roomId:_.roomId,data:_.data,remoteStream:_.mcuRemoteStream})}var P=JSON.stringify(u);apiCC.session.channel.socket.emit("updateCallStatus",P)},this.processRemoteStreamAdded=function(t,u){if(t.sessionMCU&&"new"===t.sessionMCU.modeChangeKind){ie.debug("processRemoteStreamAdded",t);var h=this.MCUClient.getSessionMCU(null,{callback:function(a){return a.roomName===t.sessionMCU.roomName&&"old"===a.modeChangeKind}});if(!h)return void ie.error("wrong roomId: no such old session");ie.debug("oldSessionMCU",h);for(var y=this.callsTable.length;--y>=0;)if(this.callsTable[y].sessionMCU===h&&(0,d.ki)(this.callsTable[y],["mcuRemoteStream","attributes","callId"],"string")&&this.callsTable[y].mcuRemoteStream.attributes.callId===t.mcuRemoteStream.attributes.callId){ie.debug("processRemoteStreamAdded: bye",this.callsTable[y]),this.removeCallFromTableWithCallIdAndSendBye(this.callsTable[y].callId);break}}},this.processDistantCallEstablished=function(t){if(ie.debug("processDistantCallEstablished",t),(0,d.ki)(t,["descriptor","callFeed","callId"],"string"))if(t.descriptor.callFeed.clientId===this.clientId){var u=null;if("mesh"===t.descriptor.callMode?u=this.MCUClient.getSessionMCU(null,{callback:function(ge){return ge.roomName===t.descriptor.roomId&&"mesh"===ge.roomMode}}):"sfu"===t.descriptor.callMode&&(u=this.MCUClient.getSessionMCU(null,{callback:function(ge){return ge.roomName===t.descriptor.roomId&&!ge.hasOwnProperty("roomMode")}})),u){ie.debug("sessionMCU",u);var h=null,y=null;if("mesh"===t.descriptor.callMode?(h=this.findUserMediaById(t.descriptor.callFeed.callId),ie.debug("userMedia",h)):(y=this.findCallWithCallId(t.descriptor.callFeed.callId),ie.debug("call",y)),t.active){if(!h&&!y)return void ie.debug("wrong callId: no such call");for(var a=this.MCUClient.distantCalls.length;--a>=0&&(this.MCUClient.distantCalls[a].roomId!==t.descriptor.roomId||this.MCUClient.distantCalls[a].clientId!==t.descriptor.clientId||this.MCUClient.distantCalls[a].callId!==t.descriptor.callId););if(a>=0){if(!this.MCUClient.distantCalls[a].early)return void ie.debug("processDistantCallEstablished: descriptor already exists");ie.debug("processDistantCallEstablished: replace early descriptor",this.MCUClient.distantCalls[a],t.descriptor),this.MCUClient.distantCalls[a]=t.descriptor}else ie.debug("processDistantCallEstablished: add descriptor",t.descriptor),this.MCUClient.distantCalls.push(t.descriptor)}else if("old"===u.modeChangeKind){for(var m=this.MCUClient.distantCalls.length;--m>=0;)if(this.MCUClient.distantCalls[m].roomId===t.descriptor.roomId&&this.MCUClient.distantCalls[m].clientId===t.descriptor.clientId&&this.MCUClient.distantCalls[m].callId===t.descriptor.callId){ie.debug("processDistantCallEstablished: set descriptor to removed",this.MCUClient.distantCalls[m]),this.MCUClient.distantCalls[m].removed=!0;break}}else for(var _=this.MCUClient.distantCalls.length;--_>=0;)if(this.MCUClient.distantCalls[_].roomId===t.descriptor.roomId&&this.MCUClient.distantCalls[_].clientId===t.descriptor.clientId&&this.MCUClient.distantCalls[_].callId===t.descriptor.callId){ie.debug("processDistantCallEstablished: remove descriptor",this.MCUClient.distantCalls[_]),this.MCUClient.distantCalls.splice(_,1);break}if("new"===u.modeChangeKind){var P=this.MCUClient.getSessionMCU(null,{callback:function(ge){return ge.roomName===t.descriptor.roomId&&"old"===ge.modeChangeKind}});if(!P)return void ie.error("wrong roomId: no such old session");ie.debug("oldSessionMCU",P),ie.debug("processDistantCallEstablished: replacement");for(var x=!1,oe=this.userMediaTable.length;--oe>=0;){var K=this.userMediaTable[oe];if(K.sessionMCU===P){var X=!1,me=0;ie.debug("processDistantCallEstablished: userMedia",K);for(var Q=K.distantCalls.length;--Q>=0;)K.distantCalls[Q].replaced?me+=1:K.distantCalls[Q].callFeed.callId===t.descriptor.callFeed.callId&&(ie.debug("processDistantCallEstablished: distantCall",K.distantCalls[Q]),X=!0,K.distantCalls[Q].replaced=!0,me+=1);if(X){if(me===K.distantCalls.length){ie.debug("processDistantCallEstablished: remove replaced distant call descriptors");for(var re=this.MCUClient.distantCalls.length;--re>=0;)"mesh"===this.MCUClient.distantCalls[re].callMode&&this.MCUClient.distantCalls[re].callFeed.callId===K.userMediaId&&this.MCUClient.distantCalls[re].replaced&&(ie.debug("processDistantCallEstablished: remove distantCall",this.MCUClient.distantCalls[re]),this.MCUClient.distantCalls.splice(re,1));ie.debug("processDistantCallEstablished: close old calls");for(var ye=this.callsTable.slice(),Se=ye.length;--Se>=0;)(0,d.ki)(ye[Se].data,"mesh","object")&&ye[Se].data.mesh.calleeCallId===K.userMediaId&&"subscribe"!==ye[Se].settingUpType&&this.removeCallFromTableWithCallIdAndSendBye(ye[Se].callId);this.MCUClient.meshOnHangup(K.userMediaId),x=!0}break}}}x&&this.finalizeMeshToJanusTransition(P,u)}}else ie.debug("wrong roomId: no such session")}else ie.debug("wrong clientId: message not intended for self");else ie.debug("wrong format: missing callFeed")},this.finalizeMeshToJanusTransition=function(t,u){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ie.debug("finalizeMeshToJanusTransition");var y=0,a=0;if(!0===h.force){for(var m=this.callsTable.slice(),_=m.length;--_>=0;){var P=m[_];P.sessionMCU===t&&(("publish"===P.settingUpType||"shareScreen"===P.settingUpType)&&P.data&&P.data.mesh?this.onHangup(P.callId):this.onHangup(P.callId,"disconnected"))}for(var x=this.userMediaTable.slice(),oe=x.length;--oe>=0;){var K=x[oe];K.sessionMCU===t&&this.onHangup(K.userMediaId,"disconnected")}}else for(var X=this.userMediaTable.length;--X>=0;){var me=this.userMediaTable[X];if(me.sessionMCU===t){y+=1;for(var Q=0,re=me.distantCalls.length;--re>=0;)ie.debug("finalizeMeshToJanusTransition: distantCall",me.distantCalls[re]),me.distantCalls[re].replaced&&(Q+=1);Q===me.distantCalls.length&&(a+=1)}}y===a&&(ie.debug("finalizeMeshToJanusTransition: finalize transition"),u.transitionTimeoutId&&(clearTimeout(u.transitionTimeoutId),delete u.transitionTimeoutId),this.MCUClient.removeSessionMCU(t),delete u.modeChangeKind,this.MCUClient.transitionCount-=1,this.MCUClient.transitionCount<=0&&this.evalOutgoingVideoBandwithCap(),bt.createMCURoomModeChangedEvent(u.roomName,"mesh","sfu","complete"))},this.processConfigureEncodings=function(t){var u=this.findCallWithCallId(t.callId);if(u&&Object.prototype.hasOwnProperty.call(t,"command")&&"RID"===u.simulcast){var h={};Object.prototype.hasOwnProperty.call(t,"maxBitrate")&&(h.maxBitrate=t.maxBitrate),u.configureSimulcastEncodings(t.command,h)}},this.processSimulcastFeedChanged=function(t){var u=this.findCallWithCallId(t.callId);if(u){var h={};2===t.substream?h.streamQuality="high":1===t.substream?h.streamQuality="medium":0===t.substream&&(h.streamQuality="low"),2===t.temporal?h.streamFrameRate="high":1===t.temporal?h.streamFrameRate="medium":0===t.temporal&&(h.streamFrameRate="low"),Object.keys(h).length>0&&bt.createSimulcastFeedChanged(u.callId,h)}},this.createCallControl=function(t){var u=new gt(t);return this.callControlTable.push(u),u},this.destroyCallControl=function(t){if(t.multi){if(!t.roomName)return ie.warn("findCallControl: cannot destroy without roomName"),null;for(var u=[],h=this.callControlTable.length;--h>=0;)this.callControlTable[h].roomName===t.roomName&&(u.push(this.callControlTable[h]),this.callControlTable.splice(h,1));return u}var y=this.findCallControl(t,{accept:"index"});if(null!==y&&y>=0){var a=this.callControlTable[y];return this.callControlTable.splice(y,1),a}return null},this.findCallControl=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h="index"===u.accept;if("publish"===t.type||"shareScreen"===t.type){if(!t.callId)return ie.warn("findCallControl: cannot search without callId"),null;for(var y=null,a=null,m=this.callControlTable.length;--m>=0;)if(("publish"===this.callControlTable[m].type||"shareScreen"===this.callControlTable[m].type)&&this.callControlTable[m].callId===t.callId){y=this.callControlTable[m],a=m;break}return y?h?a:y:null}if("subscribe"===t.type){if(!(0,d.ki)(t,"stream","object")||!Object.prototype.hasOwnProperty.call(t.stream,"id")||!(0,d.ki)(t.stream,"attributes","object"))return ie.warn("findCallControl: cannot search without stream"),null;for(var _=null,P=null,x=this.callControlTable.length;--x>=0;)if("subscribe"===this.callControlTable[x].type&&(this.callControlTable[x].stream.id===t.stream.id||this.callControlTable[x].stream.attributes.callerId===t.stream.attributes.callerId&&this.callControlTable[x].stream.attributes.callId===t.stream.attributes.callId)){_=this.callControlTable[x],P=x;break}return _?h?P:_:null}return ie.warn("findCallControl: wrong type",t.type),null},this.getCallControls=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h={};if(u.addUserMedia)for(var y=this.userMediaTable.length;--y>=0;){var a=this.userMediaTable[y];h[a.userMediaId]=a}if(t){for(var m=this.callControlTable.length;--m>=0;){var _=this.callControlTable[m];t.indexOf(_.type)>=0&&(h[_.callId]=_)}return h}for(var P=this.callControlTable.length;--P>=0;){var x=this.callControlTable[P];h[x.callId]=x}return h},this.getCallIds=function(t){for(var u=[],h=this.callControlTable.length;--h>=0;){var y=this.callControlTable[h];t.indexOf(y.type)>=0&&u.push(y.callId)}return u},this.evalOutgoingVideoBandwithCap=function(t){if(ie.debug("evalOutgoingVideoBandwithCap"),!(this.MCUClient.transitionCount>0)){var u=null;this.videoBandwidthSettings.perCallOutgoing&&(u=this.videoBandwidthSettings.perCallOutgoing);for(var h=[],y=this.callsTable.length;--y>=0;)this.callsTable[y].belongsToRoom()&&"publish"!==this.callsTable[y].settingUpType&&"shareScreen"!==this.callsTable[y].settingUpType||this.callsTable[y].localCallProfile&&this.callsTable[y].localCallProfile.video&&this.callsTable[y].localCallProfile.videoActive&&h.push(this.callsTable[y]);if(0===h.length)return u;if(this.videoBandwidthSettings.overallOutgoing){var a=Math.floor(this.videoBandwidthSettings.overallOutgoing/h.length);u=u?Math.min(u,a):a}for(var m=h.length;--m>=0;)t&&h[m]===t?u&&h[m].videoCap!==u?(h[m].videoCap=u,this.rtpSenderSetParamatersCapable&&h[m].applyOutgoingBitrate(h[m].videoCap)):!u&&h[m].videoCap&&(delete h[m].videoCap,this.rtpSenderSetParamatersCapable&&h[m].applyOutgoingBitrate(null)):u&&h[m].videoCap!==u?(h[m].videoCap=u,this.rtpSenderSetParamatersCapable?h[m].applyOutgoingBitrate(h[m].videoCap):setTimeout(function(_){_.belongsToRoom()||!_.callee?(_.updateUserMedia=!0,_.establishCall()):ie.debug("Call is not to be updated")},0,h[m])):!u&&h[m].videoCap&&(delete h[m].videoCap,this.rtpSenderSetParamatersCapable?h[m].applyOutgoingBitrate(null):setTimeout(function(_){_.belongsToRoom()||!_.callee?(_.updateUserMedia=!0,_.establishCall()):ie.debug("Call is not to be updated")},0,h[m]));return u}ie.debug("evalOutgoingVideoBandwithCap - transition ongoing")},this.callback=function(t,u){return this.closureHandler=function(h){return t[u](h)},this.closureHandler},this.callbackWithParams=function(t,u){return this.closureHandler=function(h,y,a){return t[u](h,y,a)},this.closureHandler},this.simulatedAgentLaunchWaitingCall=function(){this.socket.emit("simulatedAgentLaunchWaitingCall",{type:"simulatedAgentLaunchWaitingCall"})}},et=(e(2707),i.Y.get("PreCallTest")),Be=2e4,Lt=apiCC.myWebRTC_Event,jt=function(z,M,t,u,h){var y=this;this.webRTCClient=z.webRTCClient,this.notifyTerminated=z.notifyTerminated,this.audioSourceId=u,this.videoSourceId=h,this.testId="initial",this.stepId="initial",this.report={tests:[],resolutions:[],failurCause:""},this.maxHeight=240,this.maxWidth=320,this.resolutions=[[320,240,"QVGA"],[640,480,"VGA"],[1024,576,"SD"],[1280,720,"HD 720p"],[1920,1080,"HD 1080p"]],this.currentResolution=0,this.userMediastreamId=null,"simpleVideoRecordTest"===t&&(et.warn("Simple video record test is activated"),this.simpleVideoRecordTest=!0),!0===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled&&(et.debug("Forcing meshModeEnabled to false for precall test"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled=!1,this.modifyMeshModeEnabledValueBeforePreCall=!0),this.generateId=function(a){for(var m="",_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",P=0;P<a;P+=1)m+=_.charAt(Math.floor(Math.random()*_.length));return m},this.generateRoomId=function(){return"PC-"+this.generateId(4)+"-"+this.generateId(4)+"-"+this.generateId(4)},this.pushStats=function(a,m){return a.data.push(m),!0},this.evalQuartiles=function(a,m,_){var P=[];if(a.forEach(void 0===_?function(ht){"number"==typeof ht[m]&&P.push(ht[m])}:function(ht){P.push(_(ht[m]))}),P.sort(function(ht,mi){return ht<mi?-1:ht===mi?0:1}),P.length%2==0){var x=P.length/2,oe=Math.floor((P[x-1]+P[x])/2);if(x%2==0){var K=x/2,X=Math.floor((P[K-1]+P[K])/2),me=x+K,Q=Math.floor((P[me-1]+P[me])/2);return{min:P[0],firstQuartile:X,median:oe,thirdQuartile:Q,max:P[P.length-1]}}var re=Math.floor(x/2);return{min:P[0],firstQuartile:P[re],median:oe,thirdQuartile:P[x+re],max:P[P.length-1]}}var ge=Math.floor(P.length/2),Pe=P[ge];if((ge+1)%2==0){var xe=(ge+1)/2,We=Math.floor((P[xe-1]+P[xe])/2),rt=ge+xe,Et=Math.floor((P[rt-1]+P[rt])/2);return{min:P[0],firstQuartile:We,median:Pe,thirdQuartile:Et,max:P[P.length-1]}}var Qe=Math.floor(ge/2);return{min:P[0],firstQuartile:P[Qe],median:Pe,thirdQuartile:P[ge+Qe],max:P[P.length-1]}},this.runBitRateTest=function(){apiCC.webRTCCompliant?(et.debug("Run bitrate test"),"initial"===this.testId&&(this.handlers=[{type:"joinMCUSessionAnswer",callback:this.handleJoinMCUSessionAnswer.bind(this)},{type:"MCUAvailableStream",callback:this.handleMCUAvailableStream.bind(this)},{type:"onCallStatsUpdate",callback:this.handleOnCallStatsUpdate.bind(this)},{type:"remoteStreamAdded",callback:this.handleRemoteStreamAdded.bind(this)},{type:"userMediaSuccess",callback:this.handleuserMediaSuccess.bind(this)},{type:"MCURecordedStreamsAvailable",callback:this.handleRecordingStreamAvailable.bind(this)}],this.handlers.forEach(function(a){apiRTC.addEventListener(a.type,a.callback)}),this.webRTCClient.setMCUConnector("mcu4.apizee.com"),this.webRTCClient.setAllowMultipleCalls(!0),this.webRTCClient.enableCallStatsMonitoring(!0,1e3),this.webRTCClient.enableQualityEvaluating(!0,1e3),this.startNextTest())):(this.report.failurCause="Your device is not WebRTC Compliant",this.terminate())},this.startNextTest=function(){if(!0===this.simpleVideoRecordTest)"initial"===this.testId?(et.debug("initial simple test"),M?this.runResolutionTest():this.startTestAudioNlVideo(2e3)):"resolution-test"===this.testId?(et.debug("resolution-test simple"),this.startTestAudioNlVideo(2e3)):"audio-and-video-2000"===this.testId&&(et.debug("Before recordThenTerminate simple"),this.recordThenTerminate());else if("initial"===this.testId)M?this.runResolutionTest():this.startTestAudioNlVideo(t);else if("resolution-test"===this.testId)this.startTestAudioNlVideo(t);else if(this.testId==="audio-and-video-"+t)if("success"===this.report[this.testId].status){var m=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==m.bitsReceivedPerSecond.max&&m.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():m.bitsReceivedPerSecond.max>=15e5?this.startTestAudioNlVideo(1500):m.bitsReceivedPerSecond.max>=1e6?this.startTestAudioNlVideo(1e3):m.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):m.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-1500"===this.testId)if("success"===this.report[this.testId].status){var P=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==P.bitsReceivedPerSecond.max&&P.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():P.bitsReceivedPerSecond.max>=1e6?this.startTestAudioNlVideo(1e3):P.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):P.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-1000"===this.testId)if("success"===this.report[this.testId].status){var oe=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==oe.bitsReceivedPerSecond.max&&oe.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():oe.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):oe.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-600"===this.testId)if("success"===this.report[this.testId].status){var X=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==X.bitsReceivedPerSecond.max&&X.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():X.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-250"===this.testId)if("success"===this.report[this.testId].status){var Q=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==Q.bitsReceivedPerSecond.max&&Q.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else this.recordThenTerminate()},this.startTestAudioNlVideo=function(a){this.prepareEnvForNewTest(),et.debug("%ctestAudioNlVideo"+a),this.testId="audio-and-video-"+a,this.report.tests.push(this.testId),this.audioEnabled=!0,this.videoEnabled=!0,this.videoBandwidth=a,this.webRTCClient.setRemoteVideoBandwidth(this.videoBandwidth),this.stats={},this.report[this.testId]={audioEnabled:!0,audioLimited:!1,videoEnabled:!0,videoLimited:!0,videoBandwidth:this.videoBandwidth,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Be)},this.startTestAudioNlOnly=function(){this.prepareEnvForNewTest(),et.debug("%cstartTestAudioNlOnly"),this.testId="audio-only",this.report.tests.push(this.testId),this.audioEnabled=!0,this.videoEnabled=!1,this.webRTCClient.setRemoteVideoBandwidth(null),this.stats={},this.report[this.testId]={audioEnabled:!0,audioLimited:!1,videoEnabled:!1,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Be)},this.startTestVideoNlOnly=function(){this.prepareEnvForNewTest(),et.debug("%cstartTestVideoNlOnly"),this.testId="video-only",this.report.tests.push(this.testId),this.audioEnabled=!1,this.videoEnabled=!0,this.videoBandwidth=600,this.webRTCClient.setRemoteVideoBandwidth(this.videoBandwidth),this.stats={},this.report[this.testId]={audioEnabled:!1,audioLimited:!1,videoEnabled:!0,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Be)},this.recordThenTerminate=function(){!0===y.modifyMeshModeEnabledValueBeforePreCall&&(et.debug("Restoring meshModeEnabled to true, as it was modified for precall test"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled=!0);var a=null;if(y.videoEnabled&&y.audioEnabled?a="AUDIO-VIDEO":y.audioEnabled?a="AUDIO-ONLY":y.videoEnabled&&(a="VIDEO-ONLY"),!a)return et.error("Can't define record type"),void y.terminate();et.debug("Start recording with type:",a),y.webRTCClient.startRecording(a,"recordPreCall",null,null,{ttl:900}),setTimeout(function(){et.debug("Stop recording"),y.webRTCClient.stopRecording()},1e4)},this.terminate=function(){et.debug("Terminate"),this.testId="terminated",this.handlers&&this.handlers.forEach(function(a){apiRTC.removeEventListener(a.type,a.callback)}),this.notifyTerminated(this.report),this.leaveSession()},this.succeed=function(){Lt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"success",stepId:this.stepId}),this.report[this.testId].status="success",this.startNextTest()},this.fail=function(){et.debug("fail"),Lt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"failure",stepId:this.stepId}),this.report[this.testId].status="failure",this.report[this.testId].stepId=this.stepId,this.leaveSession(),this.startNextTest()},this.prepareEnvForNewTest=function(){void 0!==y.mcuSession&&y.leaveSession()},this.abortJoinMCUSession=function(){et.debug("abortJoinMCUSession"),this.fail()},this.abortStreamPublishing=function(){et.debug("abortStreamPublishing"),this.fail()},this.abortStreamSubscribing=function(){et.debug("abortStreamSubscribing"),this.fail()},this.observeStreamPublished=function(){if(et.debug("observeStreamPublished"),"Safari"===apiRTC.browser||"Mobile Safari"===apiRTC.browser)return et.info("Safari"),et.error("observeStreamPublished not supported on Safari"),clearInterval(this.intervalId),void this.fail();if(this.intervalCounter+=1,this.intervalCounter>30)return clearInterval(this.intervalId),void this.fail();if(this.audioEnabled&&this.videoEnabled){var a=0;if(void 0!==this.stats[this.publishCallId]&&(void 0!==this.stats[this.publishCallId].audioSent&&void 0!==this.stats[this.publishCallId].audioSent.bitsSentPerSecond&&this.stats[this.publishCallId].audioSent.bitsSentPerSecond.thirdQuartile>=2e4&&(a+=1),void 0!==this.stats[this.publishCallId].videoSent&&void 0!==this.stats[this.publishCallId].videoSent.bitsSentPerSecond&&this.stats[this.publishCallId].videoSent.bitsSentPerSecond.thirdQuartile>=125e3&&(a+=1)),2===a){clearInterval(this.intervalId);var m=this.streams[0];this.subscribeToUserStream(m.attributes.callerId,m.id,"VIDEO"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Be)}else et.debug("okCnt !== 2")}else if(this.audioEnabled)if(void 0!==this.stats[this.publishCallId])if(void 0!==this.stats[this.publishCallId].audioSent&&void 0!==this.stats[this.publishCallId].audioSent.bitsSentPerSecond)if(this.stats[this.publishCallId].audioSent.bitsSentPerSecond.thirdQuartile>=2e4){clearInterval(this.intervalId);var _=this.streams[0];this.subscribeToUserStream(_.attributes.callerId,_.id,"AUDIOONLY"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Be)}else et.debug("no stats audio 1 ");else et.debug("no stats audio 2");else et.debug("no stats audio 3");else if(this.videoEnabled)if(void 0!==this.stats[this.publishCallId])if(void 0!==this.stats[this.publishCallId].videoSent&&void 0!==this.stats[this.publishCallId].videoSent.bitsSentPerSecond)if(this.stats[this.publishCallId].videoSent.bitsSentPerSecond.thirdQuartile>=125e3){clearInterval(this.intervalId);var P=this.streams[0];this.subscribeToUserStream(P.attributes.callerId,P.id,"VIDEOONLY"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Be)}else et.debug("no stats video 1 ");else et.debug("no stats video 2");else et.debug("no stats video 3");else et.debug("no audio or video"),clearInterval(this.intervalId),this.fail()},this.observeStreamSubscribed=function(){if(this.intervalCounter+=1,this.intervalCounter>30)return clearInterval(this.intervalId),void this.succeed();var a=null,m=null,_=0,P=0;this.audioEnabled&&(a=this.stats[this.publishCallId].audioSent),this.videoEnabled&&(m=this.stats[this.publishCallId].videoSent);for(var x=0;x<this.subscribeCallIds.length;x+=1){var oe=this.subscribeCallIds[x];if(this.audioEnabled&&this.videoEnabled){var K=0;void 0!==this.stats[oe]&&(void 0!==this.stats[oe].audioReceived&&void 0!==this.stats[oe].audioReceived.bitsReceivedPerSecond&&null!=a&&void 0!==a.bitsSentPerSecond&&this.stats[oe].audioReceived.bitsReceivedPerSecond.thirdQuartile>=a.bitsSentPerSecond.firstQuartile-2e3&&(K+=1),void 0!==this.stats[oe].videoReceived&&void 0!==this.stats[oe].videoReceived.bitsReceivedPerSecond&&null!=m&&void 0!==m.bitsSentPerSecond&&this.stats[oe].videoReceived.bitsReceivedPerSecond.thirdQuartile>=m.bitsSentPerSecond.firstQuartile&&(K+=1)),2===K&&(_+=1)}else this.audioEnabled?void 0!==this.stats[oe]&&void 0!==this.stats[oe].audioReceived&&void 0!==this.stats[oe].audioReceived.bitsReceivedPerSecond&&null!=a&&void 0!==a.bitsSentPerSecond&&this.stats[oe].audioReceived.bitsReceivedPerSecond.thirdQuartile>=a.bitsSentPerSecond.firstQuartile&&(_+=1):P+=1}P>0?(clearInterval(this.intervalId),this.fail()):_===this.subscribeCallIds.length&&(clearInterval(this.intervalId),this.succeed())},this.handleJoinMCUSessionAnswer=function(a){if("joining-mcu-session"===this.stepId){if(Lt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"start",stepId:this.stepId}),clearTimeout(this.timeoutId),this.mcuSession.sessionId=a.detail.sessionId,this.mcuSession.token=a.detail.token,this.audioEnabled&&this.videoEnabled){var m=this,_={audio:{},video:{}};_=apiCC.setResolutionInConstraint(this.maxWidth,this.maxHeight,_),et.debug("constraints :",_),apiRTC.createUserMediaStream({type:"media",audioSourceId:this.audioSourceId,videoSourceId:this.videoSourceId,gum_config:_,release:function(P){et.debug("createUserMediaStream release",P.userMediaStreamId)},success:function(P){et.debug("createUserMediaStream success",P.userMediaStreamId),et.debug("audioSourceId",u),et.debug("videoSourceId",h)},failure:function(P,x){et.error("createUserMediaStream failure",P.userMediaStreamId),et.error("failure; userMediaStreamId: "+P.userMediaStreamId),et.error("failure; error: "+x),Lt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"failure",stepId:this.stepId,createUserMediaStreamError:x}),m.terminate()}})}else if(this.audioEnabled)this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,{audioOnly:!0});else{if(!this.videoEnabled)return void this.fail();this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,{videoOnly:!0,qos:{videoStartQuality:"upper"}})}this.subscribeCallIds=[],this.report[this.testId].publishCallId=this.publishCallId,this.report[this.testId].subscribeCallIds=[],this.streams=[],this.stepId="stream-publishing",this.timeoutId=setTimeout(this.abortStreamPublishing.bind(this),Be)}},this.handleuserMediaSuccess=function(a){var m={userMediaStreamId:a.detail.userMediaStreamId,qos:{videoStartQuality:"upper"}};this.userMediastreamId=a.detail.userMediaStreamId,this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,m),this.report[this.testId].publishCallId=this.publishCallId},this.handleRecordingStreamAvailable=function(a){et.debug("handleRecordingStreamAvailable"),this.terminate()},this.handleMCUAvailableStream=function(a){if("stream-publishing"===this.stepId&&!1===a.detail.isRemoteStream)for(var m=0;m<a.detail.streams.length;m+=1){var _=a.detail.streams[m];if(_.room===this.mcuSession.roomId&&_.attributes.callId===this.publishCallId&&"stream-publishing"===this.stepId){if(clearTimeout(this.timeoutId),this.stepId="stream-published",this.streams.push(_),!0===this.simpleVideoRecordTest){var P="VIDEO";!1===_.audio&&(P="VIDEOONLY"),!1===_.video&&(P="AUDIOONLY"),this.subscribeToUserStream(_.attributes.callerId,_.id,P),this.stepId="stream-subscribing"}else this.intervalId=setInterval(this.observeStreamPublished.bind(this),1e3);this.intervalCounter=0}}},this.handleRemoteStreamAdded=function(a){"stream-subscribing"===this.stepId&&void 0!==this.subscribeCallIds.find(function(m){return m===a.detail.callId})&&(clearTimeout(this.timeoutId),this.stepId="stream-subscribed",this.intervalId=setInterval(this.observeStreamSubscribed.bind(this),1e3),this.intervalCounter=0)},this.handleOnCallStatsUpdate=function(a){var m=this;if("stream-published"!==this.stepId&&"stream-subscribing"!==this.stepId&&"stream-subscribed"!==this.stepId||(void 0===this.stats[this.publishCallId]&&(this.stats[this.publishCallId]={}),void 0!==a.detail.stats.audioSent&&(void 0===this.stats[this.publishCallId].audioSent&&(this.stats[this.publishCallId].audioSent={startTime:a.detail.stats.audioSent.timestamp,data:[]}),this.pushStats(this.stats[this.publishCallId].audioSent,a.detail.stats.audioSent)?this.stats[this.publishCallId].audioSent.data.length>=5&&["bitsSentPerSecond","packetsSentPerSecond"].forEach(function(oe){var K=m.evalQuartiles(m.stats[m.publishCallId].audioSent.data,oe);K.sampleCount=m.stats[m.publishCallId].audioSent.data.length,K.time=a.detail.stats.audioSent.timestamp-m.stats[m.publishCallId].audioSent.startTime,m.stats[m.publishCallId].audioSent[oe]=K}):et.debug("audio stats not pushed for :",this.publishCallId)),void 0!==a.detail.stats.videoSent&&(void 0===this.stats[this.publishCallId].videoSent&&(this.stats[this.publishCallId].videoSent={startTime:a.detail.stats.videoSent.timestamp,data:[]}),this.pushStats(this.stats[this.publishCallId].videoSent,a.detail.stats.videoSent)?this.stats[this.publishCallId].videoSent.data.length>=5&&(["bitsSentPerSecond","packetsSentPerSecond","framesEncodedPerSecond"].forEach(function(oe){var K=m.evalQuartiles(m.stats[m.publishCallId].videoSent.data,oe);K.sampleCount=m.stats[m.publishCallId].videoSent.data.length,K.time=a.detail.stats.videoSent.timestamp-m.stats[m.publishCallId].videoSent.startTime,m.stats[m.publishCallId].videoSent[oe]=K}),this.stats[this.publishCallId].videoSent.width=a.detail.stats.videoSent.width,this.stats[this.publishCallId].videoSent.height=a.detail.stats.videoSent.height):et.debug("video stats not pushed for :",this.publishCallId))),"stream-subscribed"===this.stepId)for(var _=function(oe){x=0;var K=m.subscribeCallIds[oe];void 0===m.stats[K]&&(m.stats[K]={}),void 0!==a.detail.stats.audioReceived&&(void 0===m.stats[K].audioReceived&&(m.stats[K].audioReceived={startTime:a.detail.stats.audioReceived.timestamp,data:[]}),m.pushStats(m.stats[K].audioReceived,a.detail.stats.audioReceived)?(void 0===m.stats[K].audioReceived.data[(x=m.stats[K].audioReceived.data.length)-1].mosS&&(m.stats[K].audioReceived.data[x-1].mosS={}),m.stats[K].audioReceived.data[x-1].mosS=a.detail.stats.quality.mosS,m.stats[K].audioReceived.data.length>=15&&(["bitsReceivedPerSecond","packetsReceivedPerSecond","delay"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].audioReceived.data,X);me.sampleCount=m.stats[K].audioReceived.data.length,me.time=a.detail.stats.audioReceived.timestamp-m.stats[K].audioReceived.startTime,m.stats[K].audioReceived[X]=me}),void 0!==m.stats[K].audioReceived.data[0].jitter&&["jitter"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].audioReceived.data,X,function(Q){return Math.floor(1e3*Q)});me.sampleCount=m.stats[K].audioReceived.data.length,me.time=a.detail.stats.audioReceived.timestamp-m.stats[K].audioReceived.startTime,m.stats[K].audioReceived[X]=me}),m.stats[K].audioReceived.packetsLost={max:a.detail.stats.audioReceived.packetsLost,sampleCount:m.stats[K].audioReceived.data.length,time:a.detail.stats.audioReceived.timestamp-m.stats[K].audioReceived.startTime},["packetsLostRatio"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].audioReceived.data,X);me.sampleCount=m.stats[K].audioReceived.data.length,me.time=a.detail.stats.audioReceived.timestamp-m.stats[K].audioReceived.startTime,m.stats[K].audioReceived[X]=me}),void 0===m.stats[K].audioReceived.mosS&&(m.stats[K].audioReceived.mosS={}),["mosS"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].audioReceived.data,X);me.sampleCount=m.stats[K].audioReceived.data.length,m.stats[K].audioReceived[X]=me}))):et.error("audio stats not pushed for callId :",K)),void 0!==a.detail.stats.videoReceived&&(void 0===m.stats[K].videoReceived&&(m.stats[K].videoReceived={startTime:a.detail.stats.videoReceived.timestamp,data:[]}),m.pushStats(m.stats[K].videoReceived,a.detail.stats.videoReceived)?(void 0===m.stats[K].videoReceived.data[(x=m.stats[K].videoReceived.data.length)-1].mosV&&(m.stats[K].videoReceived.data[x-1].mosV={}),void 0===m.stats[K].videoReceived.data[x-1].mosAV&&(m.stats[K].videoReceived.data[x-1].mosAV={}),m.stats[K].videoReceived.data[x-1].mosV=a.detail.stats.quality.mosV,m.stats[K].videoReceived.data[x-1].mosAV=a.detail.stats.quality.mosAV,m.stats[K].videoReceived.data.length>=15&&(["bitsReceivedPerSecond","packetsReceivedPerSecond","framesDecodedPerSecond"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].videoReceived.data,X);me.sampleCount=m.stats[K].videoReceived.data.length,me.time=a.detail.stats.videoReceived.timestamp-m.stats[K].videoReceived.startTime,m.stats[K].videoReceived[X]=me}),void 0!==m.stats[K].videoReceived.data[0].jitter&&["jitter"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].videoReceived.data,X,function(Q){return Math.floor(1e3*Q)});me.sampleCount=m.stats[K].videoReceived.data.length,me.time=a.detail.stats.videoReceived.timestamp-m.stats[K].videoReceived.startTime,m.stats[K].videoReceived[X]=me}),m.stats[K].videoReceived.packetsLost={max:a.detail.stats.videoReceived.packetsLost,sampleCount:m.stats[K].videoReceived.data.length,time:a.detail.stats.videoReceived.timestamp-m.stats[K].videoReceived.startTime},["packetsLostRatio"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].videoReceived.data,X);me.sampleCount=m.stats[K].videoReceived.data.length,me.time=a.detail.stats.videoReceived.timestamp-m.stats[K].videoReceived.startTime,m.stats[K].videoReceived[X]=me}),void 0===m.stats[K].videoReceived.mosV&&(m.stats[K].videoReceived.mosV={}),["mosV"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].videoReceived.data,X);me.sampleCount=m.stats[K].videoReceived.data.length,m.stats[K].videoReceived[X]=me}),void 0===m.stats[K].videoReceived.mosAV&&(m.stats[K].videoReceived.mosAV={}),["mosAV"].forEach(function(X){var me=m.evalQuartiles(m.stats[K].videoReceived.data,X);me.sampleCount=m.stats[K].videoReceived.data.length,m.stats[K].videoReceived[X]=me}),m.stats[K].videoReceived.width=a.detail.stats.videoReceived.width,m.stats[K].videoReceived.height=a.detail.stats.videoReceived.height)):et.error("video stats not pushed for callId :",K))},P=0;P<this.subscribeCallIds.length;P+=1){var x;_(P)}},this.subscribeToUserStream=function(a,m,_){var P=this,x=this.webRTCClient.getStreamFromList(m);if(null!=x){var oe=[];oe.push(x),this.webRTCClient.subscribe(oe,_).forEach(function(K){P.subscribeCallIds.push(K),P.report[P.testId].subscribeCallIds.push(K)})}},this.leaveSession=function(){et.debug("leaveSession"),void 0!==this.streams&&"number"==typeof this.streams[0]&&this.webRTCClient.unsubscribe(this.streams[0]),null!==this.userMediastreamId&&apiRTC.releaseUserMediaStream(this.userMediastreamId),delete this.streams,delete this.subscribeCallIds,"string"==typeof this.publishCallId&&this.webRTCClient.unpublish(this.publishCallId),delete this.publishCallId,void 0!==this.mcuSession&&void 0!==this.mcuSession.sessionId&&(this.webRTCClient.leaveMCUSession(),delete this.mcuSession.sessionId),delete this.mcuSession,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.splice(0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.length),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionReqs.splice(0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionReqs.length),et.debug("leaveSession done")},this.runResolutionTest=function(){this.testId="resolution-test",this.stepId="resolution-test",Lt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"start",stepId:this.stepId}),et.debug("Run resolution test"),this.startGetUserMedia(this.resolutions[this.currentResolution])},this.startGetUserMedia=function(a){et.debug("startGetUserMedia :",a);var m={audio:!1,video:{}};m=apiCC.setVideoSourceIdInConstraint(this.videoSourceId,m),m=apiCC.setResolutionInConstraint(a[0],a[1],m),et.debug("startGetUserMedia constraints:",m),apiCC.getUserMedia(m).then(function(_){this.resolutions.length>1?(this.report.resolutions.push(a[2]+":   "+a[0]+"x"+a[1]),this.maxWidth=a[0],this.maxHeight=a[1],_.getTracks().forEach(function(P){P.stop()}),this.maybeContinueGetUserMedia()):et.debug("No video track in returned stream.")}.bind(this)).catch(function(_){et.debug("startGetUserMedia catch error:",_),this.resolutions.length>1?et.debug(a[0]+"x"+a[1]+" not supported"):et.error("getUserMedia failed with error: "+_.name),this.maybeContinueGetUserMedia()}.bind(this))},this.maybeContinueGetUserMedia=function(){this.currentResolution!==this.resolutions.length-1?(this.currentResolution++,this.startGetUserMedia(this.resolutions[this.currentResolution])):this.startNextTest()}},Ge=i.Y.get("ApiCCWebRTCClient"),Pt=function(z,M,t,u,h,y){Ge.debug("apiCC.ApiCCWebRTCClient"),this.myWebRTC_Event=apiCC.myWebRTC_Event,this.webRTCClient=new Ct(z),this.webRTCClient.channelReady=!0,this.callTest=null,"undefined"==typeof apiRTC_React&&this.webRTCClient.initialize(M,t,u,h,y),this.call=function(a,m,_){return"RECORD"===m&&Ge.warn("DEPRECATED : usage of data parameter on call() as a string with 'RECORD' value will be deprecated in a next version of apiRTC. Please consider using a JSON Data parameter instead : data = {isRecorded : true}"),!0===this.webRTCClient.recordedCall&&(Ge.log("recordedCall option is activated"),void 0!==m&&"RECORD"!==m||(m={}),m.MCUType="MCU-Caller",m.confId=Math.floor(1000001*Math.random()).toString()),void 0!==m&&("RECORD"!==m&&!0!==m.isRecorded||(Ge.log("recordedCall option is activated"),"RECORD"===m&&(m={}),m.MCUType="MCU-Caller",m.confId=Math.floor(1000001*Math.random()).toString())),null!=_&&!0===_.record&&(Ge.log("callConfiguration record option is activated"),void 0!==m&&"RECORD"!==m||(m={}),m.MCUType="MCU-Caller",m.confId=Math.floor(1000001*Math.random()).toString()),Ge.log("session.webRTCPluginActivated =",z.webRTCPluginActivated),("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&!0===z.webRTCPluginActivated?(Ge.log("managing call with WebRTC Plugin"),null==_&&(_={}),_.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){Ge.log("manageWebRTCPlugin cb in call"),apiCC.session.apiCCWebRTCClient.webRTCClient.callWithNumber(a,!0,m,_)},function(){Ge.log("actionOnInstallationNeeded")}),_.apzcallId):(Ge.log("managing call with browser"),this.webRTCClient.callWithNumber(a,!0,m,_))},this.getStatsFromCall=function(a,m){var _=this.webRTCClient.findCallWithCallId(a);null===_?m(new Error("Call was not found"),null):null===_.pc?m(new Error("Call has no peerconnection"),null):!0===this.webRTCClient.csmEnable?m(null,this.webRTCClient.csmLastResults):m(new Error("Call stats monitoring not activated"),null)},this.testCall=function(a){return Ge.log("session.webRTCPluginActivated =",z.webRTCPluginActivated),("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&!0===z.webRTCPluginActivated?(Ge.log("managing call with WebRTC Plugin"),null==a&&(a={}),a.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){Ge.log("manageWebRTCPlugin cb in call"),apiCC.session.apiCCWebRTCClient.webRTCClient.startTestCall(!0,a)},function(){Ge.log("actionOnInstallationNeeded")}),a.apzcallId):(Ge.log("managing call with browser"),this.webRTCClient.startTestCall(!0,a))},this.setClientTurnServer=function(a){this.webRTCClient.setClientTurnServer(a)},this.activateScreenSharing=function(a){this.webRTCClient.activateScreenSharing(a)},this.shareScreen=function(a,m,_){return Ge.info("shareScreen"),this.webRTCClient.shareScreen(a,m,_)},this.startScreenSharingOnCall=function(a,m){Ge.info("startScreenSharingOnCall"),this.webRTCClient.startScreenSharingOnCall(a,m)},this.startDataChannel=function(a,m){if(Ge.info("startDataChannel"),!("Edge"===c.Xh&&c.PR<79))return void 0!==m?m.dataCall=!0:(m={}).dataCall=!0,this.webRTCClient.callWithNumber(a,!0,m,null);Ge.warn("Cannot startDataChannel as it is not supported on Edge")},this.startDataChannelOnCall=function(a){this.webRTCClient.startDataChannelOnCall(a)},this.sendDataWithCallId=function(a,m,_){this.webRTCClient.sendDataWithCallId(a,m,_)},this.callAudio=function(a,m,_){return Ge.info("callAudio"),this.webRTCClient.callWithNumber(a,!1,m,_)},this.callbymail=function(a){this.webRTCClient.callbymail(a)},this.addMedia=function(a){return this.webRTCClient.addMedia(a),a},this.hangUp=function(a){this.webRTCClient.onHangup(a)},this.getMyMedia=function(a,m){Ge.info("getMyMedia : ",a),"screen"===a?this.webRTCClient.shareScreen("LOCAL",{},m):this.webRTCClient.getUserMedia()},this.releaseStream=function(a){Ge.info("releaseStream : ",a),Ge.info("releaseStream.callId : ",a.callId),void 0!==a.callId?this.webRTCClient.removeCallFromTableWithCallIdAndSendBye(a.callId,"stop_ScreenSharing"):this.webRTCClient.stopStream(a)},this.autoAnswerUserMediaSuccessHandler=function(a){Ge.info("autoAnswerUserMediaSuccessHandler :"+a),a=null,this.webRTCClient.autoAnswer=!0},this.autoAnswerUserMediaErrorHandler=function(a){Ge.info("autoAnswerUserMediaErrorHandler :"+a),a=null,this.webRTCClient.autoAnswer=!1},this.activateAutoAnswer=function(){apiCC.addEventListener("userMediaSuccess",this.callback(this,"autoAnswerUserMediaSuccessHandler")),apiCC.addEventListener("userMediaError",this.callback(this,"autoAnswerUserMediaErrorHandler")),this.webRTCClient.getUserMedia()},this.getAutoAnswer=function(){return this.webRTCClient.autoAnswer},this.setUnidirectionalCall=function(a){!0===a||!1===a?this.webRTCClient.unidirectionelCallOnly=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUnidirectionalCall()","PARAMETER_ERROR_SETUNIDIRCALL")},this.setReceiveMediaDeactivated=function(a){!0===a||!1===a?this.webRTCClient.receiveMediaDeactivated=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setReceiveMediaDeactivated()","PARAMETER_ERROR_SETRECVMEDIADEACTIVATED")},this.setPreferVP9Codec=function(a){!0===a||!1===a?this.webRTCClient.preferVP9Codec=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setPreferVP9Codec()","PARAMETER_ERROR_SETPREFERVP9CODEC")},this.setPreferH264Codec=function(a){!0===a||!1===a?this.webRTCClient.preferH264Codec=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setPreferH264Codec()","PARAMETER_ERROR_SETPREFERH264CODEC")},this.getUnidirectionalCall=function(){return this.webRTCClient.unidirectionelCallOnly},this.toggleVideoMute=function(a){return this.webRTCClient.toggleVideoMute(a)},this.isVideoMuted=function(a){var m;return Ge.debug("isVideoMuted :",a),null==a?this.webRTCClient.isVideoMuted:(Ge.debug("callId is defined :",a),-1!==(m=this.webRTCClient.findCallIndexWithCallId(a))?this.webRTCClient.callsTable[m].isLocalVideoMuted:void 0)},this.toggleAudioMute=function(a){return this.webRTCClient.toggleAudioMute(a)},this.sendDTMF=function(a,m,_,P){return this.webRTCClient.sendDTMF(a,m,_,P)},this.isAudioMuted=function(a){var m;return Ge.debug("isAudioMuted :",a),null==a?this.webRTCClient.isAudioMuted:(Ge.debug("callId is defined :",a),-1!==(m=this.webRTCClient.findCallIndexWithCallId(a))?this.webRTCClient.callsTable[m].isLocalAudioMuted:void 0)},this.setNtoNConf=function(a){!0===a||!1===a?this.webRTCClient.NtoNConf=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setNtoNConf()","PARAMETER_ERROR_SETNTONCONF")},this.getNtoNConf=function(){return this.webRTCClient.NtoNConf},this.setRTPMedia=function(a){!0===a||!1===a?this.webRTCClient.RTPMedia=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setRTPMedia()","PARAMETER_ERROR_SETRTPMEDIA")},this.getRTPMedia=function(){return this.webRTCClient.RTPMedia},this.setMediaRoutingMode=function(a){"hostOnly"===a?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.hostOnly:"stun"===a?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.stun:"stunOnly"===a?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.stunOnly:"turn"===a?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turn:"turnOnly"===a?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turnOnly:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setMediaRoutingMode()","PARAMETER_ERROR_SETMEDIAROUTINGMODE")},this.enableQos=function(a,m){"Chrome"!==apiCC.browser&&"Firefox"!==apiCC.browser&&(Ge.warn("enableQos() is only supported on Chrome and Firefox, support on other browsers will be added soon"),a=!1),Ge.info("this.enableQos="+a),this.webRTCClient.qosEnable=a,this.webRTCClient.qosInterval=m||this.webRTCClient.qosInterval},this.enableCallStatsMonitoring=function(a,m){["chrome","firefox"].indexOf(d.wL.type)<0?Ge.warn("enableCallStatsMonitoring() is only supported on Chrome and Firefox, support on other browsers will be added soon"):(this.webRTCClient.csmEnable=a,m&&(this.webRTCClient.csmIntervalMs=m))},this.enableQualityEvaluating=function(a,m){["chrome","firefox"].indexOf(d.wL.type)<0?Ge.warn("enableQualityEvaluating() is only supported on Chrome and Firefox, support on other browsers will be added soon"):(this.webRTCClient.qualityScoreEnable=a,m&&(this.webRTCClient.qualityScoreIntervalMs=m))},this.getMediaRoutingMode=function(){var a=null;return this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.hostOnly?a="hostOnly":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.stun?a="stun":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.stunOnly?a="stunOnly":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turn?a="turn":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turnOnly&&(a="turnOnly"),a},this.setMediaTypeForIncomingCall=function(a){Ge.debug("setMediaTypeForIncomingCall :",a),"VIDEO"===a||"AUDIO"===a||"VIDEOONLY"===a||"NONE"===a?this.webRTCClient.mediaTypeForIncomingCall=a:Ge.log("setMediaTypeForIncomingCall, value is not correct",a)},this.setMediaTypeForOutgoingCall=function(a){Ge.debug("setMediaTypeForOutgoingCall :",a),"VIDEO"===a||"AUDIO"===a||"VIDEOONLY"===a||"NONE"===a?this.webRTCClient.mediaTypeForOutgoingCall=a:Ge.log("setMediaTypeForOutgoingCall, value is not correct",a)},this.setStereo=function(a){Ge.info("setStereo :",a),!0===a?(this.webRTCClient.setStereo=a,this.webRTCClient.gum_config={audio:{mandatory:{echoCancellation:!1,googEchoCancellation:!1},optional:[]},video:{mandatory:{},optional:[]}}):!1===a?this.webRTCClient.setStereo=a:Ge.log("setStereo, value is not correct",a)},this.setMCUConnector=function(a){Ge.info("setMCUConnector :",a),Ge.log("setting value :",a),"mcu4.apizee.com"===a?this.webRTCClient.MCUClient.pubConnector="janusConnector":"mcu3.apizee.com"===a?this.webRTCClient.MCUClient.pubConnector="groupKurentoConnector":Ge.log("value is incorrect :",a)},this.enableMeshRoomMode=function(a){Ge.info("enableMeshRoomMode :",a),"IE"===c.Xh?(Ge.log("IE detected, MeshRoomMode is not supported"),this.webRTCClient.MCUClient.meshModeEnabled=!1):this.webRTCClient.MCUClient.meshModeEnabled=a},this.setAllowAsymetricMediaCalls=function(a){Ge.info("setAllowAsymetricMediaCalls :",a),!0===a||!1===a?this.webRTCClient.allowAsymetricMediaCalls=a:Ge.log("setAllowAsymetricMediaCalls, value is not correct",a)},this.takeSnapshot=function(a,m,_,P,x,oe,K){this.webRTCClient.takeSnapshot(a,m,z.apiKey,_,P,x,oe,K)},this.takeSnapshotAndSendOnDataChannel=function(a,m,_,P){this.webRTCClient.takeSnapshotAndSendOnDataChannel(a,m,_,P)},this.setUserAcceptOnIncomingCall=function(a){Ge.info("setUserAcceptOnIncomingCall :",a),!0===a||!1===a?this.webRTCClient.userAcceptOnIncomingCall=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALL")},this.setUserAcceptOnIncomingCallBeforeGetUserMedia=function(a){Ge.info("setUserAcceptOnIncomingCallBeforeGetUserMedia :",a),!0===a||!1===a?this.webRTCClient.userAcceptOnIncomingCallBeforeGetUserMedia=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingCallBeforeGetUserMedia()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALLBEFOREGUM")},this.setUserAcceptOnIncomingDataCall=function(a){!0===a||!1===a?this.webRTCClient.userAcceptOnIncomingDataCall=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingDataCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALL")},this.setUserAcceptOnIncomingScreenSharingCall=function(a){!0===a||!1===a?this.webRTCClient.userAcceptOnIncomingScreenSharingCall=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingScreenSharingCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOSCREENSHARINGCALL")},this.setHideLocalVideoOnCall=function(a){!0===a||!1===a?this.webRTCClient.hideLocalVideoOnCall=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : hideLocalVideoOnCall()","PARAMETER_ERROR_SETHIDELOCALVIDEOONCALL")},this.setAllowMultipleCalls=function(a){!0===a||!1===a?this.webRTCClient.allowMultipleCalls=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setAllowMultipleCalls()","PARAMETER_ERROR_SETALLOWMULTIPLECALLS")},this.setPcConfig=function(a){Ge.info("Setting PC_config to :",a),this.webRTCClient.pc_config=a},this.setPcConstraints=function(a){Ge.info("Setting PC_constraints to :"+a),this.webRTCClient.pc_constraints=a},this.setGetUserMediaConfig=function(a){this.webRTCClient.setGetUserMediaConfig(a)},this.setTrickleIce=function(a){Ge.info("Setting trickleIce to :"+a),!0===a||!1===a?this.webRTCClient.trickleIce=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setTrickleIce()","PARAMETER_ERROR_SETTRICKLEICE")},this.setRecordedCall=function(a){!0===a||!1===a?this.webRTCClient.recordedCall=a:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setRecordedCall()","PARAMETER_ERROR_SETRECORDEDCALL")},this.getRecordedCall=function(){return this.webRTCClient.recordedCall},this.acceptCall=function(a,m){this.webRTCClient.acceptCall(a,m)},this.refuseCall=function(a){Ge.info("refuseCall"),this.webRTCClient.refuseCall(a)},this.toggleVideoScreen=function(a){Ge.info("toggleVideoScreen"),this.webRTCClient.toggleVideoScreen(a)},this.switchVideoToScreen=function(a){Ge.info("switchVideoToScreen"),this.webRTCClient.switchVideoToScreen(a)},this.switchScreenToVideo=function(a){Ge.info("switchScreenToVideo"),this.webRTCClient.switchScreenToVideo(a)},this.addVideoMedia=function(a){Ge.info("addVideoMedia"),this.webRTCClient.addVideoMedia(a)},this.updateMediaDeviceOnCall=function(a,m){return Ge.info("updateMediaDeviceOnCall"),this.webRTCClient.updateMediaDeviceOnCall(a,m)},this.updateMediaTypeOnCall=function(a,m){return!(0,d.Ym)(a,"string")||"VIDEO"!==m&&"AUDIOONLY"!==m&&"VIDEOONLY"!==m?Promise.reject("wrong arguments"):this.webRTCClient.updateMediaTypeOnCall(a,m)},this.releaseUserMedia=function(){this.webRTCClient.releaseUserMedia()},this.setAllowedAudioCodecs=function(a){this.webRTCClient.allowedAudioCodecs=a},this.setAllowedVideoCodecs=function(a){this.webRTCClient.allowedVideoCodecs=a},this.setAudioBandwidth=function(a){this.webRTCClient.setAudioBandwidth(a)},this.setVideoBandwidth=function(a){},this.setRemoteVideoBandwidth=function(a){this.webRTCClient.setVideoBandwidth(a,"remote")},this.setOverallIncomingVideoBandwidth=function(a){this.webRTCClient.setVideoBandwidth(a,"overall","incoming")},this.setOverallOutgoingVideoBandwidth=function(a){this.webRTCClient.setVideoBandwidth(a,"overall","outgoing")},this.setPerCallIncomingVideoBandwidth=function(a){this.webRTCClient.setVideoBandwidth(a,"perCall","incoming")},this.setPerCallOutgoingVideoBandwidth=function(a){this.webRTCClient.setVideoBandwidth(a,"perCall","outgoing")},this.setDataBandwidth=function(a){this.webRTCClient.setDataBandwidth(a)},this.createMCUSession=function(a,m){Ge.info("createMCUSession"),this.webRTCClient.MCUClient.initDivElements(a,m),this.webRTCClient.MCUClient.createSession()},this.joinMCUSession=function(a){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ge.debug("joinMCUSession"),a?this.webRTCClient.MCUClient.joinSession(a,m):new Error("wrong roomId")},this.getMCUStreamList=function(){return Ge.debug("getMCUStreamList"),this.webRTCClient.MCUClient.getStreamList()},this.getStreamFromList=function(a){return Ge.debug("getStreamFromList"),this.webRTCClient.MCUClient.getStreamFromList(a)},this.getStreamIdOfUser=function(a){return Ge.debug("getStreamIdOfUser"),this.webRTCClient.MCUClient.getStreamIdOfUser(a)},this.getCallIdFromStreamId=function(a){Ge.debug("getCallIdFromStreamId");var m=this.webRTCClient.findCallWithStreamId(a);return null===m?(Ge.log("call not found in getCallIdFromStreamId"),null):m.callId},this.getCallIdFromRemoteMCUUser=function(a){var m,_;return Ge.debug("getCallIdFromRemoteMCUUser"),m=this.webRTCClient.MCUClient.getStreamIdOfUser(a),null===(_=this.webRTCClient.findCallWithStreamId(m))?(Ge.log("call not found in getCallIdFromRemoteMCUUser"),null):_.callId},this.ejectParticipantFromMCUSession=function(a,m,_){this.webRTCClient.MCUClient.ejectParticipant(a,m,_)},this.publish=function(a,m,_,P,x,oe){if("IE"===c.Xh&&(Ge.log("apiCC.session.webRTCPluginActivated ="+apiCC.session.webRTCPluginActivated),Ge.log("apiCC.webRTCPluginInstalled ="+apiCC.webRTCPluginInstalled)),("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&!0===apiCC.session.webRTCPluginActivated&&!1===apiCC.webRTCPluginInstalled)return Ge.log("managing call with WebRTC Plugin"),null==P&&(P={}),P.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){apiCC.webRTCPluginInstalled=!0,Ge.info("manageWebRTCPlugin cb in call");var X=this.webRTCClient.MCUClient.getSessionMCU(a);return X&&"mesh"===X.roomMode?this.webRTCClient.MCUClient.meshPublish(a,m,_,P,x,oe):(Ge.debug("publish"),this.webRTCClient.MCUClient.publish(a,m,_,P,x,oe))},function(){Ge.log("actionOnInstallationNeeded")}),P.apzcallId;var K=this.webRTCClient.MCUClient.getSessionMCU(a);return K&&"mesh"===K.roomMode?this.webRTCClient.MCUClient.meshPublish(a,m,_,P,x,oe):(Ge.debug("publish"),this.webRTCClient.MCUClient.publish(a,m,_,P,x,oe))},this.unpublish=function(a){Ge.info("unpublish"),this.webRTCClient.MCUClient.unpublish(a)},this.publishScreen=function(a,m,_,P){var x=this.webRTCClient.MCUClient.getSessionMCU(a);return x&&"mesh"===x.roomMode?(Ge.info("publishScreen"),this.webRTCClient.MCUClient.meshPublishScreen(a,m,_,P)):(Ge.info("publishScreen"),this.webRTCClient.MCUClient.publishScreen(a,m,_,P))},this.subscribe=function(a,m,_,P,x){return Ge.info("subscribe :",a),"IE"===c.Xh&&(Ge.log("apiCC.session.webRTCPluginActivated ="+apiCC.session.webRTCPluginActivated),Ge.log("apiCC.webRTCPluginInstalled ="+apiCC.webRTCPluginInstalled)),("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&!0===apiCC.session.webRTCPluginActivated&&!1===apiCC.webRTCPluginInstalled?(Ge.log("managing call with WebRTC Plugin"),apiCC.manageWebRTCPlugin(function(){return apiCC.webRTCPluginInstalled=!0,Ge.log("manageWebRTCPlugin cb in subscribe"),"boolean"==typeof m&&(Ge.warn("DEPRECATED : usage of audioOnly parameter on subscribe() is now replaced by mediatype with value VIDEO, AUDIOONLY or VIDEOONLY and will be deprecated in a next version of apiRTC"),m=!0===m?"AUDIOONLY":"VIDEO"),apiCC.session.apiCCWebRTCClient.subscribe(a,m,_,P)},function(){Ge.log("actionOnInstallationNeeded")}),"WebRTC_Plugin"):("boolean"==typeof m&&(Ge.warn("DEPRECATED : usage of audioOnly parameter on subscribe() is now replaced by mediatype with value VIDEO, AUDIOONLY or VIDEOONLY and will be deprecated in a next version of apiRTC"),m=!0===m?"AUDIOONLY":"VIDEO"),this.webRTCClient.MCUClient.subscribeToStreams(a,m,_,P,x))},this.unsubscribe=function(a){Ge.info("unsubscribe :",a),this.webRTCClient.MCUClient.unsubscribe(a)},this.startStreaming=function(a,m,_,P){return Ge.info("startStreaming"),this.webRTCClient.MCUClient.startStreaming(a,m,_,P)},this.stopStreaming=function(a){return Ge.info("stopStreaming"),this.webRTCClient.MCUClient.stopStreaming(a)},this.startRecording=function(a,m,_,P,x){Ge.info("startRecording"),this.webRTCClient.MCUClient.startRecording(a,m,_,P,x)},this.stopRecording=function(a){Ge.info("stopRecording"),this.webRTCClient.MCUClient.stopRecording(a)},this.changeStreamPriority=function(a,m){var _=this.webRTCClient.findCallWithCallId(a);if(!_&&!(_=this.webRTCClient.findUserMediaById(a)))return Ge.error("changeStreamPriority - no such call",a),!1;if(!_.sessionMCU)return Ge.error("changeStreamPriority - no such sessionMCU"),!1;if(!(0,d.Ym)(m,"number")||m<0)return Ge.error("changeStreamPriority - wrong priority",m),!1;var P=JSON.stringify({type:"changeStreamPriority",roomId:_.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:a,data:{pubSub:this.webRTCClient.MCUClient.pubConnector,priority:m}});return Ge.log("C->S: "+P),apiCC.session.channel.socket.emit("changeStreamPriority",P),!0},this.startComposite=function(a){Ge.info("startComposite"),this.webRTCClient.MCUClient.startComposite(a)},this.stopComposite=function(a){Ge.info("stopComposite"),this.webRTCClient.MCUClient.stopComposite(a)},this.startCompositeRecording=function(a,m,_,P,x){Ge.info("startCompositeRecording"),this.webRTCClient.MCUClient.startCompositeRecording(a,m,_,P,x)},this.stopCompositeRecording=function(a){Ge.info("stopCompositeRecording"),this.webRTCClient.MCUClient.stopCompositeRecording(a)},this.checkCallExist=function(a){for(var m=null,_=this.webRTCClient.callsTable.length;--_>=0;){var P=this.webRTCClient.callsTable[_];if(P.callId===a&&P.data&&P.sessionMCU&&("MCU-Caller"===P.data.MCUType||"MCU-Callee"===P.data.MCUType)&&P.data.confId===P.sessionMCU.roomName){m=P;break}}return m||Ge.error("startCallRecording: no such call"),m},this.startCallRecording=function(a){var m;if(m=this.checkCallExist(a)){var _=(0,d.ws)({},m.data);this.webRTCClient.MCUClient.startCompositeRecording("AUDIO-VIDEO",null,m.sessionMCU.convId,_,m.sessionMCU.roomName)}},this.stopCallRecording=function(a){var m;(m=this.checkCallExist(a))&&this.webRTCClient.MCUClient.stopCompositeRecording(m.sessionMCU.roomName)},this.enforceMCU=function(a){this.webRTCClient.MCUClient.enforceMCU(a)},this.takeSnapshotOnMCUSession=function(a){return Ge.info("takeSnapshotOnMCUSession"),this.webRTCClient.MCUClient.takeSnapshot(a)},this.sendMCUSessionInvitation=function(a,m,_){this.webRTCClient.MCUClient.sendSessionInvitation(a,m,_)},this.sendMCUSessionInvitationToGroupChat=function(a,m){this.webRTCClient.MCUClient.sendSessionInvitationToGroupChat(a,m)},this.acceptMCUSessionInvitation=function(a,m,_,P){this.webRTCClient.MCUClient.initDivElements(_,P),this.webRTCClient.MCUClient.acceptSessionInvitation(a,m)},this.leaveMCUSession=function(a){this.webRTCClient.MCUClient.leaveSession(a)},this.recordStream=function(a){Ge.info("recordStream :",a),void 0!==MediaRecorder?apiCC.recordMgr.record(a).then(function(){Ge.log("Recording started")}).catch(function(m){Ge.error("startRecord failed :",m)}):Ge.debug("MediaRecorder is not supported on this browser, leaving recordStream process")},this.stopRecordStream=function(a){Ge.info("stopRecordStream"),void 0!==MediaRecorder?apiCC.recordMgr.stop().then(function(m){Ge.log("Recording stopped"),a(m)}).catch(function(m){Ge.error("stopRecord failed :",m)}):Ge.debug("MediaRecorder is not supported on this browser, leaving recordStream process")},this.getMediaDevices=function(a){Ge.debug("getMediaDevices 2"),apiCC.getMediaDevices().then(function(m){a(m),apiCC.mediaDeviceMgr.gotSources(m)}).catch(function(m){a(null),apiCC.mediaDeviceMgr.gotSources(null)})},this.setAudioSourceId=function(a){Ge.info("setAudioSourceId :"+a),this.webRTCClient.audioSourceId=a},this.setAudioOutputId=function(a){Ge.info("setaudioOutputId :"+a),this.webRTCClient.audioOutputId=a},this.setVideoSourceId=function(a){Ge.info("setVideoSourceId :"+a),this.webRTCClient.videoSourceId=a},this.setVideoFacingMode=function(a){Ge.info("setVideoFacingMode :"+a),"user"===a||"environment"===a||"left"===a||"right"===a||"deactivated"===a?this.webRTCClient.facingMode="deactivated"===a?null:a:Ge.log("facingMode value is not correct")},this.attachMediaStream=function(a,m){Ge.debug("attachMediaStream"),apiCC.attachMediaStream(a,m)},this.addStreamInDiv=function(a,m,_,P,x,oe){Ge.debug("addStreamInDiv"),apiCC.addStreamInDiv(a,m,_,P,x,oe)},this.removeElementFromDiv=function(a,m){Ge.debug("removeElementFromDiv"),apiCC.removeElementFromDiv(a,m)},this.setSelectedStream=function(a){Ge.warn("setSelectedStream() is now deprecated")},this.callback=function(a,m){return this.closureHandler=function(_){return a[m](_)},this.closureHandler},this.startPrecallTest=function(a,m,_,P,x){this.callTest=new jt({webRTCClient:this,notifyTerminated:a},m,_,P,x),this.callTest.runBitRateTest()}}},6527:(F,Y,e)=>{"use strict";e.d(Y,{p:()=>c}),e(3843),e(3710),e(7941),e(2772),e(2564),e(561),e(1058),e(9653),e(3290),e(6755),e(4916),e(3123),e(2222),e(4812);var i=e(1549).Y.get("ApiCCWhiteBoardClient"),c=function(d,L,w,A,C){function S(n){n.style.display="none"}i.debug("Loading apiCC.ApiCCWhiteBoardClient"),this.roomId=null,this.whiteBoardDisconnectionTimeoutId=0,this.sessionStarted=!1,this.prev={},this.lastEmit=Date.now(),this.clients={},this.listenedPeers={},this.touchScreenActivated=!1,this.touchControlPoint={},this.drawElements=[],this.ghostElements={},this.redoStack=[],this.undoIndex=0,this.userCursorColor=null,this.cursors={},this.cursorStyle="cross",this.CURSOR_STYLES=["circle","cross"],this.currentScale=1,this.dx=0,this.dy=0,this.instructionsFaded=!1,this.canvas=null,this.ctx=null,this.currentTool="pen",this.currentColor="rgba(0, 0, 0, 1)",this.currentBrushWidth=1,this.readOnly=!1,this.isDrawing=!1,this.focusOnDrawing=!1,this.paperSheetId=0,this.drawingId=0,this.offline=!1,this.roomJoined=!1,this.laserModeActivated=!1,this.AVAILABLE_TOOLS=["pen","ellipse","rectangle","erase","void","arrow"],this.GEOMETRY_TOOLS=["arrow","rectangle","ellipse"],this.disconnectionTimer=void 0!==C?C:3e4,i.log("Setting Whiteboard disconnectionTimer to : "+this.disconnectionTimer),this.setCanvas=function(n){i.debug("[Whiteboard] setCanvas() :",n),null!==this.canvas&&(i.log("Unsetting old canvas events"),this.sessionStarted&&!this.readOnly&&(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1)))),null!==n&&null!==document.getElementById(n)?(this.canvas=document.getElementById(n),this.ctx=this.canvas.getContext("2d"),this.sessionStarted&&!this.readOnly&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove,this.touchScreenActivated&&(this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)))):(null!==n&&null===document.getElementById(n)&&i.warn("No such element whose id is : "+n),this.canvas=null,this.ctx=null)},this.setCanvas(L),this.sendDataToRoom=function(n){if(i.info("[Whiteboard] sendDataToRoom()"),!1===this.offline&&null!==this.roomId){if(null===apiCC.session||void 0===apiCC.session)return void i.info("apiCC.session does not exist, leaving process");i.debug("this.drawElements :",this.drawElements),i.debug("data.tool :",n.tool);var v=[];i.debug("drawElementsToSend :",v);var R,p={x:0,y:0,drawing:!1,tool:this.currentTool,cursorColor:this.userCursorColor,color:this.currentColor,width:this.currentBrushWidth,paperSheetId:this.paperSheetId,drawElements:v,id:apiCC.session.apiCCId},o=Object.keys(n);for(R=0;R<o.length;R++)p[o[R]]=n[o[R]];apiCC.session.roomMgr.sendMessageToRoom(this.roomId,"whiteBoard",p)}},this.setCursorsDiv=function(){i.warn("[Whiteboard] setCursorsDiv() - method obsolete, please use setUserCursorColor to set a cursor pointer that will be seen by other users")},this.setUserCursorColor=function(n){i.debug("[Whiteboard] setUserCursorColor() : "+n),null===n||"invisible"===n?this.userCursorColor="invisible":/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)?this.userCursorColor=n:(i.warn("[Whiteboard] setUserCursorColor() color "+n+" is invalid, defaulting to invisible"),this.userCursorColor="invisible")},this.setUserCursorColor(w),this.setCursorStyle=function(n){i.debug("[Whiteboard] setCursorStyle() : "+n),this.CURSOR_STYLES.indexOf(n)>-1?(this.userCursorColor="invisible",this.cursorStyle=n):i.error("[Whiteboard] setCursorStyle() style "+n+" is invalid")},this.setFocusOnDrawing=function(n){i.debug("[Whiteboard] setFocusOnDrawing()"),this.focusOnDrawing=n},this.createRoom=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.debug("[Whiteboard] createRoom()"),apiCC.session.roomMgr.createRoom("whiteBoard",n)},this.requestContactListInRoom=function(n){i.log("[Whiteboard] requestContactListInRoom :"+n),apiCC.session.roomMgr.requestContactListInRoom(n)},this.setDrawingTool=function(n){i.debug("[Whiteboard] setDrawingTool()");var v=0;null!==apiCC.session&&(v=apiCC.session.apiCCId),this.AVAILABLE_TOOLS.indexOf(n)>-1&&(this.currentTool=n,this.ghostElements[v]=null)},this.setReadOnly=function(n){i.debug("[Whiteboard] setReadOnly()");var v=0;null!==apiCC.session&&(v=apiCC.session.apiCCId),this.ghostElements[v]=null,this.readOnly=!0===n,this.readOnly&&null!==this.canvas?(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1))):null!==this.canvas&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove,this.touchScreenActivated&&(this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)))},this.laserModeProcess=function(n){var v=this;setTimeout(function(){return v.undo(n)},5e3)},this.undo=function(n){i.debug("[Whiteboard] undo()");var v=this.drawElements.length-1,R=null,p=[],o=[],f=null,I=0;if(null!==apiCC.session&&(I=apiCC.session.apiCCId),void 0===n)for(;v>=0;)this.drawElements[v].userId==I&&(null===R&&(R=this.drawElements[v].undoIndex),R===this.drawElements[v].undoIndex&&(f=this.drawElements.splice(v,1)[0],p.push(f),o.push(f.drawingId))),v--;else for(v=0;v<this.drawElements.length;v++)this.drawElements[v].userId==I&&this.drawElements[v].drawingId===n&&(i.debug("[Whiteboard] element found with drawingId in undo laser :",n),f=this.drawElements.splice(v,1)[0],p.push(f),o.push(f.drawingId));p.length>0&&(this.redraw(),this.sendDataToRoom({tool:"void",delete:o,undoneElements:p}),this.redoStack.push(p))},this.redo=function(){i.debug("[Whiteboard] redo()");var n,v=[];if(this.redoStack.length>0){for(v=this.redoStack.pop(),n=0;n<v.length;n++)this.addNewDrawing(v[n]);this.sendDataToRoom({tool:"void",drawObjectsArray:v}),this.redraw()}},this.setBrushSize=function(n){i.debug("[Whiteboard] setBrushSize()"),!isNaN(n)&&n>0&&(this.currentBrushWidth=n)},this.setBrushColor=function(n){i.debug("[Whiteboard] setBrushColor()"),this.currentColor=n},this.setScale=function(n){i.debug("[Whiteboard] setScale()"),n>0?(this.currentScale=n,this.redraw()):i.warn("Scale factor must be > 0!")},this.getScale=function(){return i.debug("[Whiteboard] getScale()"),this.currentScale},this.setOffset=function(n,v){i.debug("[Whiteboard] setOffset()");var R=parseInt(n,10),p=parseInt(v,10);isNaN(R)||isNaN(p)||(this.dx=Number(R),this.dy=Number(p),this.redraw())},this.getOffset=function(){return i.debug("[Whiteboard] getOffset()"),{x:this.dx,y:this.dy}},this.printSharedText=function(n,v,R,p,o,f){i.debug("[Whiteboard] printSharedText()"),this.setBrushStyle(this.currentColor,this.currentBrushWidth),this.undoIndex++,this.redoStack=[];var I=0;null!==apiCC.session&&(I=apiCC.session.apiCCId);var l={type:"text",x:n,y:v,text:R,size:p,font:o,border:f,userId:I,drawingId:this.drawingId,color:this.currentColor,width:this.currentBrushWidth,undoIndex:this.undoIndex,time:Date.now()};this.sendDataToRoom({x:n,y:v,tool:"void",drawObject:l}),this.drawingId++,this.addNewDrawing(l)},this.addPeerListener=function(n,v){i.debug("[Whiteboard] addPeerListener()"),this.listenedPeers.hasOwnProperty(n)||(this.listenedPeers[n]=[]),this.listenedPeers[n].push(v)},this.inviteInRoom=function(n,v,R){var p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i.debug("[Whiteboard] inviteInRoom()"),null!==n?null!==v?apiCC.session.roomMgr.inviteInRoom(n,v,"whiteBoard",R,p):i.debug("wrong destId"):i.debug("wrong roomId")},this.answerToRoomInvitation=function(n,v){i.info("[Whiteboard] answerToRoomInvitation()");var R=v&&!this.isInRoom();return this.isInRoom()?i.error("[Whiteboard] cannot answer room invitation : user is already in a room"):apiCC.session.roomMgr.answerToRoomInvitation(n,v,"whiteBoard"),R&&(i.log("[Whiteboard] user joining room"),this.paperSheetId=0,this.drawingId=0,this.roomId=n,this.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})),R},this.joinRoom=function(n){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.info("[Whiteboard] joinRoom() roomId :",n),null==n?i.error("[Whiteboard] cannot join room : room is null or undefined"):this.isInRoom()&&!0===this.roomJoined?i.error("[Whiteboard] cannot join room : user is already in a room"):apiCC.session.roomMgr.joinRoom(n,"whiteBoard",v)},this.leaveRoom=function(){i.info("[Whiteboard] leaveRoom()"),this.isInRoom()&&(apiCC.session.roomMgr.leaveRoom(this.roomId,"whiteBoard"),this.roomId=null,this.paperSheetId=0,this.drawingId=0,this.listenedPeers={},this.roomJoined=!1)},this.isInRoom=function(){return null!==this.roomId},this.clearPaper=function(){i.debug("[Whiteboard] clearPaper()"),this.deleteHistory()},this.refreshCanvas=function(){null!==this.canvas&&null!==this.ctx&&(this.canvas.width=this.canvas.width)},this.deleteHistory=function(){i.info("[Whiteboard] deleteHistory()");var n=0;null!==apiCC.session&&(n=apiCC.session.apiCCId),this.refreshCanvas(),this.drawElements=[],this.ghostElements[n]=null,this.paperSheetId++,this.drawingId=0,this.sendDataToRoom({tool:"void",deleteHistory:!0})},this.setBrushStyle=function(n,v){null!==this.ctx&&(this.ctx.strokeStyle=n,this.ctx.fillStyle=n,this.ctx.lineWidth=v)},this.redraw=function(){var n,v,R;for(i.debug("[Whiteboard] redraw()"),this.refreshCanvas(),n=0;n<this.drawElements.length;n++)this.drawSingleObject(this.drawElements[n]);for(v=Object.keys(this.ghostElements),n=0;n<v.length;n++)null!==this.ghostElements[v[n]]&&this.drawSingleObject(this.ghostElements[v[n]]);for(v=Object.keys(this.cursors),n=0;n<v.length;n++)if(null!==this.cursors[v[n]]&&"invisible"!==this.cursors[v[n]].color&&(0!==this.cursors[v[n]].x||0!==this.cursors[v[n]].y))switch(R={fromx:(this.cursors[v[n]].x-this.dx)*this.currentScale-13,fromy:(this.cursors[v[n]].y-this.dy)*this.currentScale-13,tox:(this.cursors[v[n]].x-this.dx)*this.currentScale+13,toy:(this.cursors[v[n]].y-this.dy)*this.currentScale+13},this.setBrushStyle(this.cursors[v[n]].color,4),this.cursorStyle){case"circle":null!==this.ctx&&(this.ctx.globalAlpha=.4,this.fillEllipse(R.fromx,R.fromy,R.tox,R.toy),this.drawEllipse(R.fromx+2,R.fromy+2,R.tox-2,R.toy-2),this.ctx.globalAlpha=1);break;case"cross":null!==this.ctx&&(this.ctx.globalAlpha=.7,this.ctx.beginPath(),this.ctx.moveTo(R.fromx+(R.tox-R.fromx)/2,R.fromy),this.ctx.lineTo(R.fromx+(R.tox-R.fromx)/2,R.toy),this.ctx.lineCap="butt",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(R.fromx,R.fromy+(R.toy-R.fromy)/2),this.ctx.lineTo(R.tox,R.fromy+(R.toy-R.fromy)/2),this.ctx.lineCap="butt",this.ctx.stroke(),this.ctx.globalAlpha=1)}},this.addNewDrawing=function(n){var v=0;this.drawElements.push(n),this.drawSingleObject(n),null!==apiCC.session&&(v=apiCC.session.apiCCId),n.userId===v&&!0===this.laserModeActivated&&this.laserModeProcess(n.drawingId)},this.drawSingleObject=function(n){if(null!==this.ctx&&null!==this.canvas){var v={};switch(this.setBrushStyle(n.color,n.width),this.ctx.scale(this.currentScale,this.currentScale),v.fromx=n.fromx-this.dx,v.tox=n.tox-this.dx,v.x=n.x-this.dx,v.fromy=n.fromy-this.dy,v.toy=n.toy-this.dy,v.y=n.y-this.dy,n.type){case"arrow":this.drawArrow(v.fromx,v.fromy,v.tox,v.toy);break;case"ellipse":this.drawEllipse(v.fromx,v.fromy,v.tox,v.toy);break;case"rectangle":this.drawRectangle(v.fromx,v.fromy,v.tox,v.toy);break;case"pen":this.drawLine(v.fromx,v.fromy,v.tox,v.toy);break;case"erase":this.eraseArea(v.fromx,v.fromy);break;case"text":this.drawText(v.x,v.y,n.text,n.size,n.font,n.border)}this.ctx.scale(1/this.currentScale,1/this.currentScale)}},this.drawLine=function(n,v,R,p){null!==this.ctx&&(this.ctx.beginPath(),this.ctx.moveTo(n,v),this.ctx.lineTo(R,p),this.ctx.lineCap="round",this.ctx.stroke())},this.drawText=function(n,v,R,p,o,f){if(null!==this.ctx){var I,l,V="Arial";null!=o&&(V=o),this.ctx.font=p+"px "+V,this.ctx.fillText(R,n,v),null!=f&&(I=this.ctx.strokeStyle,l=this.ctx.lineWidth,this.ctx.strokeStyle=f,this.ctx.lineWidth=1,this.ctx.strokeText(R,n,v),this.ctx.strokeStyle=I,this.ctx.lineWidth=l)}},this.eraseArea=function(n,v){null!==this.ctx&&this.ctx.clearRect(n-this.ctx.lineWidth-1,v-this.ctx.lineWidth-1,2*this.ctx.lineWidth+2,2*this.ctx.lineWidth+2)},this.drawArrow=function(n,v,R,p){if(null!==this.ctx){var o=Math.atan2(p-v,R-n);this.ctx.beginPath(),this.ctx.lineCap="butt",this.ctx.moveTo(n,v),this.ctx.lineTo(R,p),this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(R,p),this.ctx.rotate(o+Math.PI/2),this.ctx.moveTo(0,-this.ctx.lineWidth),this.ctx.lineTo(5*this.ctx.lineWidth*.5+1,10+.25*this.ctx.lineWidth),this.ctx.lineTo(-5*this.ctx.lineWidth*.5-1,10+.25*this.ctx.lineWidth),this.ctx.closePath(),this.ctx.restore(),this.ctx.fill()}},this.drawEllipse=function(n,v,R,p){var o=null,f=null;null!==this.ctx&&(o={x:Math.abs(n-R)/2,y:Math.abs(v-p)/2},f={x:n-(n-R)/2,y:v-(v-p)/2},this.ctx.beginPath(),"IE"!==apiRTC.browser&&this.ctx.ellipse(f.x,f.y,o.x,o.y,0,0,2*Math.PI),this.ctx.stroke())},this.fillEllipse=function(n,v,R,p){if(null!==this.ctx){var o={x:Math.abs(n-R)/2,y:Math.abs(v-p)/2},f={x:n-(n-R)/2,y:v-(v-p)/2};this.ctx.beginPath(),"IE"!==apiRTC.browser&&this.ctx.ellipse(f.x,f.y,o.x,o.y,0,0,2*Math.PI),this.ctx.fill()}},this.drawRectangle=function(n,v,R,p){if(null!==this.ctx){this.ctx.beginPath();var o=n,f=v;n>R&&(o=R),v>p&&(f=p),this.ctx.rect(o,f,Math.abs(n-R),Math.abs(v-p)),this.ctx.stroke()}},this.getContext=function(){return this.ctx},this.loadPhotoInBackground=function(n){i.debug("[Whiteboard] loadPhotoInBackground :"+n);var v=document.getElementsByTagName("body")[0];v.style.backgroundImage="url("+n+")",v.style.backgroundPosition="50% 50%",v.style.backgroundRepeat="no-repeat"},this.messageProcessing=function(n){i.debug("[Whiteboard] messageProcessing");var v,R=null,p=null,o=!1,f=null,I=null,l=null,V=null,T=null;if(this.cursors[n.id]||(i.log("[Whiteboard] messageProcessing - creating cursor for new user : "+n.id),this.cursors[n.id]={id:n.id},this.clients[n.id]={}),this.cursors[n.id].x=n.x,this.cursors[n.id].y=n.y,this.cursors[n.id].lastUpdate=Date.now(),this.cursors[n.id].color=n.cursorColor&&null!==n.cursorColor?n.cursorColor:"invisible",void 0===apiRTC.userAgentInstance||"ON"===apiRTC.userAgentInstance.capabilities.whiteboardCursor?"invisible"!==this.cursors[n.id].color&&(o=!0):(i.debug("[Whiteboard] - cursor is not supported on userAgent"),this.cursors[n.id].color="invisible"),null!==this.ghostElements[n.id]&&(this.ghostElements[n.id]=null,o=!0),this.listenedPeers.hasOwnProperty(n.id))for(f={id:n.id,x:n.x,y:n.y,tool:n.tool,drawing:n.drawing},v=0;v<this.listenedPeers[n.id].length;v++)"function"==typeof this.listenedPeers[n.id][v]?this.listenedPeers[n.id][v](f):i.warn("[Whiteboard] Peer listenener is not a function!");if(n.drawing&&this.clients[n.id]&&(i.debug("data.drawing && this.clients[data.id]"),this.GEOMETRY_TOOLS.indexOf((p={fromx:void 0!==n.prevX?n.prevX:this.clients[n.id].x,fromy:void 0!==n.prevY?n.prevY:this.clients[n.id].y,tox:n.x,toy:n.y,type:null!==n.tool?n.tool:"pen",color:n.color,width:n.width,userId:n.id,drawingId:n.drawingId}).type)>-1?n.prevX&&n.prevY&&(this.ghostElements[n.id]=p,o=!0):this.addNewDrawing(p),this.focusOnDrawing&&((R=this.canvas.parentNode).scrollLeft=this.currentScale*(n.x-this.dx)-R.clientWidth/2,R.scrollTop=this.currentScale*(n.y-this.dy)-R.clientHeight/2)),n.drawObject&&((p=n.drawObject).color=n.color,p.width=n.width,this.ghostElements[n.id]=null,this.addNewDrawing(p),this.focusOnDrawing&&((R=this.canvas.parentNode).scrollLeft=this.currentScale*(n.x-this.dx)-R.clientWidth/2,R.scrollTop=this.currentScale*(n.y-this.dy)-R.clientHeight/2)),n.hasOwnProperty("drawObjectsArray"))for(v=0;v<n.drawObjectsArray.length;v++)this.addNewDrawing(n.drawObjectsArray[v]);if(n.hasOwnProperty("delete"))for(v=this.drawElements.length-1,o=!0;v>=0;)n.delete.indexOf(this.drawElements[v].drawingId)>-1&&this.drawElements[v].userId==n.id&&this.drawElements.splice(v,1),v--;if(n.hasOwnProperty("paperSheetId")){if(n.paperSheetId<this.paperSheetId)i.debug("[Whiteboard] - data.paperSheetId < this.paperSheetId");else if(n.paperSheetId>this.paperSheetId){if(i.debug("[Whiteboard] - messageProcessing : peer has a more recent version : "+this.paperSheetId+" vs "+n.paperSheetId),n.hasOwnProperty("deleteHistory")&&i.debug("User : "+n.id+" ,has deleted the history"),n.hasOwnProperty("drawElements")){for(i.debug("[Whiteboard] - messageProcessing : receiving update from peer"),this.drawElements=null!==n.drawElements?n.drawElements:[],v=0;v<this.drawElements.length;v++)this.drawElements[v].hasOwnProperty("userId")&&this.drawElements[v].hasOwnProperty("drawingId")&&(this.clients[this.drawElements[v].userId]={x:0,y:0,drawing:!1,tool:"pen",cursorColor:null,color:null,width:1,paperSheetId:this.paperSheetId,drawingId:this.drawElements[v].drawingId,id:this.drawElements[v].userId});this.paperSheetId=n.paperSheetId,this.drawingId=0,o=!0}}else if(n.hasOwnProperty("drawingId"))if(i.debug("[Whiteboard] - data.hasOwnProperty(drawingId): "),0!==n.drawingId&&void 0===this.clients[n.id]||void 0!==this.clients[n.id]&&this.clients[n.id].hasOwnProperty("drawingId")&&n.drawingId-this.clients[n.id].drawingId>1)i.log("[Whiteboard] - messageProcessing : catchup from peer required : "+n.drawingId),V=n.id+"||-1",void 0!==this.clients[n.id]&&this.clients[n.id].hasOwnProperty("drawingId")&&(V=n.id+"||"+this.clients[n.id].drawingId),this.sendDataToRoom({tool:"void",needCatchUp:V});else if(n.hasOwnProperty("needCatchUp")&&(n.needCatchUp.startsWith(apiCC.session.apiCCId+"||")||n.needCatchUp.startsWith("*||"))){for(i.debug("[Whiteboard] - messageProcessing : letting peer catchup: "+n.id),I=n.needCatchUp.split("||")[1],l=[],v=0;v<this.drawElements.length;v++)(T=this.drawElements[v]).hasOwnProperty("userId")&&T.hasOwnProperty("drawingId")&&T.userId===apiCC.session.apiCCId&&T.drawingId>parseInt(I,10)&&l.push(T);this.sendDataToRoom({tool:"void",catchUpData:l,catchupIndex:I})}else i.debug("[Whiteboard] - else - drawingId");else if(n.hasOwnProperty("needCatchUp")){for(i.debug("[Whiteboard] - messageProcessing : needCatchUp"+n.id),I=n.needCatchUp.split("||")[1],l=[],v=0;v<this.drawElements.length;v++)l.push(T=this.drawElements[v]);i.debug("[Whiteboard] - sending catchUpData : ",l),this.sendDataToRoom({tool:"void",catchUpData:l,catchupIndex:I})}else i.debug("[Whiteboard] - else - paperSheetId");if(n.hasOwnProperty("catchUpData")){for(i.debug("[Whiteboard] - messageProcessing : catching up: "+n.id),"complete"===n.catchUpStatus&&(i.debug("catchUpData is complete, cleaning drawElements"),this.drawElements.splice(0,this.drawElements.length)),v=0;v<n.catchUpData.length;v++)T=n.catchUpData[v],n.userId===apiCC.session.apiCCId&&T.hasOwnProperty("drawingId")&&this.drawingId<T.drawingId&&(this.drawingId=T.drawingId+1);this.drawElements=n.catchUpData.concat(this.drawElements),this.paperSheetId=n.paperSheetId,o=!0}}o&&this.redraw(),this.clients[n.id]=n},this.isStarted=function(){return this.sessionStarted},this.start=function(){this.isStarted()?i.warn("[Whiteboard] WhiteBoardClient is already started"):(i.info("[Whiteboard] starting WhiteBoardClient"),this.isDrawing=!1,this.prev={},this.lastEmit=Date.now(),this.currentScale=1,this.dx=0,this.dy=0,this.drawingId=0,this.clients={},this.listenedPeers={},this.cursors={},this.drawElements=[],this.touchScreenActivated=!1,this.sessionStarted=!0,null!==this.canvas&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove),this.redraw()),null!==apiCC.session&&void 0!==apiCC.session.roomMgr||(i.log("[Whiteboard] roomMgr is not defined, setting offline mode"),this.offline=!0)},this.stop=function(){this.isStarted()?(i.info("[Whiteboard] Stopping WhiteBoardClient"),this.isInRoom()&&this.leaveRoom(),this.sessionStarted=!1,null!==this.canvas&&(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1))),this.drawElements=[],this.ghostElements={},this.redoStack=[]):i.info("[Whiteboard] cannot stop WhiteboardClient as it is not started")},this.getTouchOffSet=function(n){i.debug("[Whiteboard] getTouchOffSet():");var v,R,p,o,f=null,I={offsetX:0,offsetY:0};return f=n.target,v=window.getComputedStyle(f,null),R=parseInt(v.borderLeftWidth,10),p=parseInt(v.borderTopWidth,10),o=f.getBoundingClientRect(),I.offsetX=n.clientX-R-o.left,I.offsetY=n.clientY-p-o.top,i.log("offset.offsetX :"+I.offsetX),i.log("offset.offsetY :"+I.offsetY),I},this.toggleTouchScreen=function(){!0===this.touchScreenActivated?this.deactivateTouchScreen():this.activateTouchScreen()},this.activateTouchScreen=function(){null!==this.canvas?(this.touchScreenActivated=!0,this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)):i.warn("Trying to activateTouchScreen() while canvas is null.")},this.deactivateTouchScreen=function(){null!==this.canvas?(this.touchScreenActivated=!1,this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1)):i.warn("Trying to deactivateTouchScreen() while canvas is null.")},this.activateLaserMode=function(){this.laserModeActivated=!0},this.deactivateLaserMode=function(){this.laserModeActivated=!1},this.sendDrawingData=function(n,v,R){i.debug("[Whiteboard] sendDrawingData()");var p={x:n.offsetX,y:n.offsetY,drawing:v,prevX:this.prev.x,prevY:this.prev.y};if(!1!==v||"invisible"!==this.userCursorColor){var o=0;null!==apiCC.session&&(o=apiCC.session.apiCCId),null!==R&&(p.drawObject=R,p.drawObject.drawingId=this.drawingId,p.drawObject.userId=o,this.drawingId++),p.drawingId=this.drawingId,this.sendDataToRoom(p)}else i.debug("isDrawing false and userCursorColor invisible - leaving sendDrawingData")},this.onmousedown=function(n){n.preventDefault();var v,R,p=n.target||n.srcElement,o=p.currentStyle||window.getComputedStyle(p,null),f=parseInt(o.borderLeftWidth,10)||0,I=parseInt(o.borderTopWidth,10)||0,l=p.getBoundingClientRect(),V={offsetX:this.dx+1/this.currentScale*(n.clientX-f-l.left),offsetY:this.dy+1/this.currentScale*(n.clientY-I-l.top)};if(this.prev.x=V.offsetX,this.prev.y=V.offsetY,this.isDrawing=!0,this.undoIndex++,this.redoStack=[],null===(v=document.getElementById(A))||this.instructionsFaded||(S(v),this.instructionsFaded=!0),"erase"===this.currentTool){this.sendDrawingData(V,this.isDrawing,null);var T=0;null!==apiCC.session&&(T=apiCC.session.apiCCId),this.lastEmit=Date.now(),R={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:T,drawingId:this.drawingId,undoIndex:this.undoIndex,time:Date.now()},this.drawingId++,this.addNewDrawing(R),this.redraw()}}.bind(this),this.onmouseup=function(n){var v,R=null,p=null,o=0,f=0,I=null,l={offsetX:0,offsetY:0},V=0;this.isDrawing&&this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(p=(R=n.target||n.srcElement).currentStyle||window.getComputedStyle(R,null),o=parseInt(p.borderLeftWidth,10)||0,f=parseInt(p.borderTopWidth,10)||0,I=R.getBoundingClientRect(),l.offsetX=this.dx+1/this.currentScale*(n.clientX-o-I.left),l.offsetY=this.dy+1/this.currentScale*(n.clientY-f-I.top),null!==apiCC.session&&(V=apiCC.session.apiCCId),v={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,tox:l.offsetX,toy:l.offsetY,color:this.currentColor,width:this.currentBrushWidth,userId:V,undoIndex:this.undoIndex,time:Date.now()},this.sendDrawingData(l,this.isDrawing,v),this.ghostElements[V]=null,this.redraw(),this.addNewDrawing(v),this.prev.x=l.offsetX,this.prev.y=l.offsetY),this.isDrawing=!1,this.ghostElements[V]=null}.bind(this),this.onmouseleave=function(){var n=0;null!==apiCC.session&&(n=apiCC.session.apiCCId),this.isDrawing=!1,this.sendDrawingData({offsetX:0,offsetY:0},this.isDrawing,null),this.ghostElements[n]=null}.bind(this),this.onmousemove=function(n){var v,R,p,o,f,I=null,l={};if(v=(I=n.target||n.srcElement).currentStyle||window.getComputedStyle(I,null),R=parseInt(v.borderLeftWidth,10)||0,p=parseInt(v.borderTopWidth,10)||0,o=I.getBoundingClientRect(),l.offsetX=this.dx+1/this.currentScale*(n.clientX-R-o.left),l.offsetY=this.dy+1/this.currentScale*(n.clientY-p-o.top),Date.now()-this.lastEmit>30)if(this.sendDrawingData(l,this.isDrawing,null),this.lastEmit=Date.now(),this.isDrawing){var V=0;null!==apiCC.session&&(V=apiCC.session.apiCCId),f={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:V,undoIndex:this.undoIndex,time:Date.now()},"pen"===this.currentTool||"erase"===this.currentTool?("pen"===this.currentTool&&(f.tox=l.offsetX,f.toy=l.offsetY),f.drawingId=this.drawingId,this.drawingId++,this.addNewDrawing(f),this.prev.x=l.offsetX,this.prev.y=l.offsetY):this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(f.tox=l.offsetX,f.toy=l.offsetY,this.ghostElements[V]=f),"pen"!==this.currentTool&&this.redraw()}else"erase"===this.currentTool&&(this.redraw(),f={type:"rectangle",fromx:l.offsetX-this.currentBrushWidth,fromy:l.offsetY-this.currentBrushWidth,tox:parseInt(l.offsetX,10)+parseInt(this.currentBrushWidth,10),toy:parseInt(l.offsetY,10)+parseInt(this.currentBrushWidth,10),color:"#444444",width:1},this.drawSingleObject(f),f.color="#DDDDDD",f.fromx=f.fromx-1,f.fromy=f.fromy-1,f.tox=f.tox+1,f.toy=f.toy+1,this.drawSingleObject(f))}.bind(this),this.onTouchStart=function(n){i.debug("[Whiteboard] handleStart"),n.preventDefault();var v,R=n.changedTouches,p={};this.isDrawing=!0,this.undoIndex++,this.redoStack=[],(p=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*p.offsetX,p.offsetY=this.dy+1/this.currentScale*p.offsetY,this.prev.x=p.offsetX,this.prev.y=p.offsetY,this.sendDrawingData(p,!1,null),null!==(v=document.getElementById(A))&&S(v)}.bind(this),this.onTouchEnd=function(n){i.debug("[Whiteboard] handleEnd :"+n);var v,R=null,p=null,o={},f=n.changedTouches,I=0;this.isDrawing&&this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(p=(R=n.target||n.srcElement).currentStyle||window.getComputedStyle(R,null),parseInt(p.borderLeftWidth,10),parseInt(p.borderTopWidth,10),R.getBoundingClientRect(),(o=this.getTouchOffSet(f[0])).offsetX=this.dx+1/this.currentScale*o.offsetX,o.offsetY=this.dy+1/this.currentScale*o.offsetY,null!==apiCC.session&&(I=apiCC.session.apiCCId),v={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,tox:o.offsetX,toy:o.offsetY,color:this.currentColor,width:this.currentBrushWidth,userId:I,undoIndex:this.undoIndex,time:Date.now()},this.sendDrawingData(o,this.isDrawing,v),this.addNewDrawing(v),this.prev.x=o.offsetX,this.prev.y=o.offsetY),this.isDrawing=!1,this.ghostElements[I]=null,n=null}.bind(this),this.onTouchCancel=function(n){i.debug("[Whiteboard] handleCancel :"+n);var v=0;null!==apiCC.session&&(v=apiCC.session.apiCCId),this.isDrawing=!1,this.ghostElements[v]=null,n=null}.bind(this),this.onTouchMove=function(n){i.debug("[Whiteboard] handleMove :"+n);var v,R=n.changedTouches,p={};if(Date.now()-this.lastEmit>30&&((p=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*p.offsetX,p.offsetY=this.dy+1/this.currentScale*p.offsetY,this.sendDrawingData(p,this.isDrawing,null),this.lastEmit=Date.now(),this.isDrawing)){(p=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*p.offsetX,p.offsetY=this.dy+1/this.currentScale*p.offsetY;var o=0;null!==apiCC.session&&(o=apiCC.session.apiCCId),v={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:o,undoIndex:this.undoIndex,time:Date.now()},"pen"===this.currentTool||"erase"===this.currentTool?("pen"===this.currentTool&&(v.tox=p.offsetX,v.toy=p.offsetY),v.drawingId=this.drawingId,this.drawingId++,this.addNewDrawing(v),this.prev.x=p.offsetX,this.prev.y=p.offsetY):this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(v.tox=p.offsetX,v.toy=p.offsetY,this.ghostElements[o]=v,this.redraw())}}.bind(this)}},2719:(F,Y,e)=>{"use strict";e.r(Y),e(2772),e(3710),e(9554),e(1539),e(8674),e(561),e(2564),e(8309),e(4916),e(3123),e(1058),e(6992),e(8783),e(3948),e(285),e(1637),e(4363),e(9653),e(9714),e(3843),e(7941),e(4812),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2222),e(9600),e(6755),e(2526),e(1817),e(2165);var i=e(1549),c=e(5945),d=e(8765),L=e(1215),w=e(3173),A=i.Y.get("RecordManager"),C=e(4708);function S(o){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(o)}var n=i.Y.get("ApiCC_Methods"),v=e(6075).F;apiCC.myWebRTC_Adapter=new v,apiCC.myWebRTC_Event=new d.K;var R=apiCC.myWebRTC_Event;apiCC,apiCC.myEventTable=[],apiCC.ApiCCSession=e(3720).K,apiCC.ApiCCWebRTCClient=e(5882).D,apiCC.ApiCCUserMediaStream=e(5981).q,apiCC.ApiCCPointerSharingClient=e(9213).X,apiCC.ApiCCWhiteBoardClient=e(6527).p,apiCC.ApiCCDataClient=e(128)._,apiCC.ApiCCIMClient=e(6844).U,apiCC.ApiCCCoBrowsingClient=e(1254).W,apiCC.recordMgr=new function(){A.debug("RecordManager creation"),this.mediaRecorder=null,this.recordedBlobs=[],this.mimeType=null,this.record=function(o,f){var I=this;return A.info("record"),A.log("stream :"+o),A.log("stream :",o),new Promise(function(l,V){var T=null;if(void 0===MediaRecorder)return A.debug("MediaRecorder is not supported on this browser, leaving recordStream process"),void V(L.g.createError(w.g.ERROR_STREAM_RECORD,"MediaRecorder is not supported on this browser, leaving recordStream process",A));if(null===o)return A.debug("Stream has no data, cannot record"),void V(L.g.createError(w.g.ERROR_STREAM_RECORD,"Stream has no data, cannot record",A));if(null!==I.mediaRecorder&&(A.log("this.mediaRecorder.state :"+I.mediaRecorder.state),"recording"===I.mediaRecorder.state||"paused"===I.mediaRecorder.state))return A.log("mediaRecorder is already ongoing, use stopRecordStream before trying another record"),void V(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already ongoing, use stopRecordStream before trying another record",A));if(A.debug("checking MediaRecorderOptions mimeType support"),null!=f?(A.debug("options is defined :",f),null!=f.mimeType&&(A.debug("contentType is defined :",f.mimeType),MediaRecorder.isTypeSupported(f.mimeType)&&(T=f.mimeType))):f={},null===T){var b="video/webm;codecs=vp8,opus";MediaRecorder.isTypeSupported(b)||(A.debug(b+" is not Supported"),b="video/webm;codecs=vp9,opus",MediaRecorder.isTypeSupported(b)||(A.debug(b+" is not Supported"),b="video/webm",MediaRecorder.isTypeSupported(b)||(A.debug(b+" is not Supported"),b=""))),f.mimeType=b}I.mimeType=f.mimeType,A.debug("Start record with MediaRecorderOptions :",f);try{I.recordedBlobs=[],I.mediaRecorder=new MediaRecorder(o,f)}catch(H){return A.error("Exception while creating MediaRecorder: "+H+". mimeType: "+f.mimeType),void V(L.g.createError(w.g.ERROR_STREAM_RECORD,"Exception while creating MediaRecorder: "+H+". mimeType: "+f.mimeType,A))}I.mediaRecorder.onstart=function(H){A.log("onstart :"+H),this.onerror=null,l()},I.mediaRecorder.ondataavailable=function(H){H.data&&H.data.size>0&&apiCC.recordMgr.recordedBlobs.push(H.data)},I.mediaRecorder.onerror=function(H){A.log("onerror :"+H),V(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+H,A)),this.onerror=null},I.mediaRecorder.start(10),A.log("MediaRecorder started",I.mediaRecorder)})},this.stop=function(){var o=this;return A.info("stop"),new Promise(function(f,I){return o.mediaRecorder.onstop=function(l){A.log("mediaRecorder onstop :"+l),this.onstart=null,this.onstop=null,this.onerror=null,this.onpause=null,this.onresume=null,this.ondataavailable=null;var V=new Blob(apiCC.recordMgr.recordedBlobs,{type:this.mimeType});f(V)},void 0===MediaRecorder?(A.debug("MediaRecorder is not supported on this browser, leaving recordStream process"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"MediaRecorder is not supported on this browser, leaving recordStream process",A))):null===o.mediaRecorder?(A.log("mediaRecorder is not running, use startRecordStream before trying to stop"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to stop",A))):(A.log("this.mediaRecorder.state :"+o.mediaRecorder.state),"inactive"===o.mediaRecorder.state?(A.log("mediaRecorder is already inactive"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already inactive",A))):void o.mediaRecorder.stop())})},this.pause=function(){var o=this;return A.info("pause"),new Promise(function(f,I){return null===o.mediaRecorder?(A.log("mediaRecorder is not running, use startRecordStream before trying to pause"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to pause",A))):(A.log("this.mediaRecorder.state :"+o.mediaRecorder.state),"paused"===o.mediaRecorder.state?(A.log("mediaRecorder is already paused"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already paused",A))):"inactive"===o.mediaRecorder.state?(A.log("mediaRecorder is inactive"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is inactive",A))):(o.mediaRecorder.onerror=function(l){A.log("onerror :"+l),I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+l,A)),this.onerror=null},o.mediaRecorder.onpause=function(l){A.log("onpause :"+l),this.onerror=null,f()},void o.mediaRecorder.pause()))})},this.resume=function(){var o=this;return A.info("resume"),new Promise(function(f,I){return null===o.mediaRecorder?(A.log("mediaRecorder is not running, use startRecordStream before trying to resume"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to resume",A))):(A.log("this.mediaRecorder.state :"+o.mediaRecorder.state),"recording"===o.mediaRecorder.state?(A.log("mediaRecorder is already recording"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already recording",A))):"inactive"===o.mediaRecorder.state?(A.log("mediaRecorder is inactive"),void I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is inactive",A))):(o.mediaRecorder.onerror=function(l){A.log("onerror :"+l),I(L.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+l,A)),this.onerror=null},o.mediaRecorder.onresume=function(l){A.log("onresume :"+l),this.onerror=null,f()},void o.mediaRecorder.resume()))})}},"electron"!==c.$6?e(2746):n.debug("Electron detected, not loading onbeforeunload"),apiCC.addEventListener=function(o,f){var l=null;["sessionReady","incomingCall","callEstablished","remoteHangup","userMediaSuccess","userMediaError","userMediaStop","error","receiveIMMessage","updatePresence","webRTCClientCreated","updateUserStatus","channelEvent","groupChatCreation","groupChatInvitation","groupChatMemberUpdate","addUserInGroupChatAnswer","receiveGroupChatMessage","userDataAnswer","receiveConversationList","receiveConversationHistory","receiveConversationDetailReport","receiveContactOccurrencesFromConversationList","receiveMCUSessionInvitation","MCUSessionCreation","MCUAvailableStream","MCUAvailableStreamUpdate","MCUAvailableReplay","MCURemoveStream","canPlayRemoteVideo","recordedFileAvailable","receiveData","roomCreation","roomJoined","roomInvitation","roomMemberUpdate","receiveRoomMessage","contactListInRoom","snapShotPhotoUploaded","stopRecord","callAttempt","joinMCUSessionAnswer","hangup","desktopCapture","remoteStreamAdded","localStreamRemoved","remoteStreamRemoved","switchStream","sendDataChannelOpen","sendDataChannelClose","sendDataChannelError","receiveDataChannelOpen","receiveDataChannelClose","receiveDataChannelError","connectedUsersListUpdate","onFileSended","onFileSending","onFileReceiving","onFileReceived","onFileProgress","onFilePending","recordedStreamsAvailable","closingWhiteBoard","webRTCPluginInstallation","onQosStatsUpdate","onQosChange","onQosAudioChange","onCallScoreUpdate","activeSpeaker","stopSpeaking","audioAmplitude","preCallTestStatus","onQosVideoChange","onCallStatsUpdate","cpuLimited","bandwidthLimited","MCURecordedStreamsAvailable","MCURecordingStarted","MCURecordingStopped","ICECandidateTypeUpdate","disconnectionWarning","MCUAvailableComposite","callRestarting","selectedICECandidate","MCUParticipantEjected","MCURoomModeChanged","MCUStreamingStarted","MCUStreamingStopped","mediaDeviceChanged","externalJsLoadingStatus","slowLink","localStreamUpdated","remoteStreamUpdated","simulcastFeedChanged","videoQualityChanged","bandwidthResourceManagement","backgroundSubstractionStopVisibilityChange","backgroundSubstractionStopComputeTime","AIESnapshot","AIELog","cloudEventOccurred"].indexOf(o)>-1?("remoteHangup"===o&&n.warn("DEPRECATED : ApiRTC : remoteHangup event is now deprecated, please use hangup event instead"),n.log("Adding listener on type :"+o),"undefined"!=typeof apiRTC_React?eventManager.addEventListener(o,f):document.addEventListener?document.addEventListener(o,f,!1):"undefined"!=typeof $jqApz?(n.log("using $jqApz"),$jqApz(document).on(o,f)):"undefined"!=typeof jQuery?(n.log("using jQuery"),jQuery(document).on(o,f)):n.warn("Custom Events not supported on this browser : addEventListener()"),l=apiCC.myEventTable.push({type:o,listener:f}),n.trace("number of myEventTable:"+l)):(R.createErrorEvent("ERROR: Trying to add a listener on an unknow event","UNKNOWN_EVENT_ON_ADDLISTENER"),n.log("ERROR: Trying to add a listener on an unknow event :"+o))},apiCC.removeEventListener=function(o,f){n.debug("Removing listener on type :"+o),document.removeEventListener?document.removeEventListener(o,f,!1):"undefined"!=typeof jQuery?jQuery(document).off(o,f):n.log("Custom Events not supported on this browser")},apiCC.setCookie=function(o,f,I){n.debug("setCookie"),I=I||36e5;var l=new Date,V=new Date;V.setTime(l.getTime()+I),document.cookie=o+"="+encodeURIComponent(f)+";expires="+V.toGMTString()},apiCC.isWebRTCCompliant=function(){n.debug("isWebRTCCompliant");var o=!1,f=!1;return["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(I){o||I in window&&(o=!0)}),!1===o?(n.debug("isWebRTCCompliant::isWebRTCSupported false"),!1):(["getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia"].forEach(function(I){f||I in navigator&&(f=!0)}),!1===f?(n.debug("isWebRTCCompliant::isWebRTCGUMSupported false or you are connected with HTTP"),!1):"MIUI Browser"===c.Xh?(n.debug("isWebRTCCompliant::MIUI Browser detected false"),!1):("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&!0!==this.webRTCPluginActivated?(n.debug("isWebRTCCompliant FALSE : IE or Safari"),!1):(n.debug("isWebRTCCompliant:: WebRTC is supported"),!0))},apiCC.isQoSStatCompliant=function(){var o=!1;return["chrome","firefox"].indexOf(apiCC.browserDetails.type)<0?(n.debug("QoS Statistics is only supported on Chrome and Firefox"),o):o=!0},apiCC.isScreenSharingCompliant=function(){var o=!1;return"IE"===c.Xh||"Android"===c.BF||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova||("Chrome"===c.Xh||"Firefox"===c.Xh&&c.PR>=52||navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia?o=!0:n.debug("ScreenSharing is not supported")),o},apiCC.getMediaDevices=function(){return n.debug("getMediaDevices"),new Promise(function(o,f){if("undefined"!=typeof apiRTC_React)n.log("enumerateDevices() is supported - React Native"),mediaDevices.enumerateDevices().then(function(I){n.log("enumerateDevices(), sources :",I),apiCC.mediaDeviceMgr.mediaSourceInfos=I,o(I)}).catch(function(I){n.log("enumerateDevices(), error :",I),f(I)});else if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)n.log("enumerateDevices() is supported."),navigator.mediaDevices.enumerateDevices().then(function(I){n.log("enumerateDevices(), sources :",I),apiCC.mediaDeviceMgr.mediaSourceInfos=I,o(I)}).catch(function(I){n.log("enumerateDevices(), error :",I),f(I)});else if(n.log("enumerateDevices() not supported."),"undefined"==typeof MediaStreamTrack)n.warn("This browser does not support MediaStreamTrack"),f(new Error("getMediaDevices() - MediaStreamTrack undefined"));else try{MediaStreamTrack.getSources(o)}catch(I){n.debug("catch MediaStreamTrack.getSources :"+I),f(new Error("getMediaDevices() - Error on MediaStreamTrack.getSources :"+I))}})},apiCC.getMediaDevicesWithCB=function(o){if(n.debug("getMediaDevicesWithCB"),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)n.log("enumerateDevices() is supported."),navigator.mediaDevices.enumerateDevices().then(o).catch(function(f){n.log("navigator.mediaDevices.enumerateDevices error: ",f),f=null});else if(n.log("enumerateDevices() not supported."),"undefined"==typeof MediaStreamTrack)o(null),n.warn("This browser does not support MediaStreamTrack");else try{MediaStreamTrack.getSources(o)}catch(f){n.debug("catch MediaStreamTrack.getSources :"+f),o(null)}},apiCC.getUserMedia=function(o){return n.info("getUserMedia"),n.debug("with constraints :",o),new Promise(function(f,I){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia?(n.debug("webRTC getUserMedia with promises"),navigator.mediaDevices.getUserMedia(o).then(f).catch(I)):"undefined"!=typeof apiRTC_React?(n.debug("webRTC getUserMedia with promises on React Native"),mediaDevices.getUserMedia(o).then(f).catch(I)):(n.debug("webRTC getUserMedia without promises"),apiCC.myWebRTC_Adapter.getUserMedia(o,f,I))})},apiCC.getUserMediaWithCB=function(o,f,I){n.info("getUserMediaWithCB"),n.debug("with constraints :"+JSON.stringify(o)),void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia?(n.log("getUserMedia with promises"),navigator.mediaDevices.getUserMedia(o).then(f).catch(I)):(n.log("getUserMedia without promises"),apiCC.myWebRTC_Adapter.getUserMedia(o,f,I))},apiCC.userMediaStreamTable=[],apiCC.getUserMediaStreamIds=function(){for(var o=[],f=apiCC.userMediaStreamTable.length;--f>=0;)o.push(apiCC.userMediaStreamTable[f].userMediaStreamId);return o},apiCC.getUserMediaStream=function(o,f){var I=null,l=apiCC.userMediaStreamTable.length;if(null==o){if(f&&"function"==typeof f.accept)for(;--l>=0;)if(!0===f.accept(apiCC.userMediaStreamTable[l])){I=apiCC.userMediaStreamTable[l];break}}else for(;--l>=0;)if(apiCC.userMediaStreamTable[l].userMediaStreamId===o){I=apiCC.userMediaStreamTable[l];break}return I},apiCC.getFirstUserMediaStream=function(){return apiCC.userMediaStreamTable.length>0?apiCC.userMediaStreamTable[0]:null},apiCC.createUserMediaStream=function(o){var f=function(V){for(var T=apiCC.userMediaStreamTable.length;--T>=0;)if(apiCC.userMediaStreamTable[T].userMediaStreamId===V){apiCC.userMediaStreamTable.splice(T,1);break}},I=new apiCC.ApiCCUserMediaStream,l="call";return n.debug("[createUserMediaStream] userMediaStreamId: "+I.userMediaStreamId),null==o&&(o={}),o.type&&(I.callType=o.type),o.stream?(I.stream=o.stream,I.streamStolen=!0,I.notifyUserMediaStop=!1):o.gum_config&&(I.gum_config=(0,C.S6)(o.gum_config)),o.audioSourceId&&(I.inputs.audioSourceId=o.audioSourceId),o.videoSourceId&&(I.inputs.videoSourceId=o.videoSourceId),o.facingMode&&(I.inputs.facingMode=o.facingMode),o.captureSourceType&&(I.captureSourceType=o.captureSourceType),o.notifyUserMediaSuccess&&(I.notifyUserMediaSuccess=o.notifyUserMediaSuccess),o.notifyUserMediaError&&(I.notifyUserMediaError=o.notifyUserMediaError),o.tryAudioCallAfterUserMediaError&&(I.tryAudioCallAfterUserMediaError=o.tryAudioCallAfterUserMediaError),o.displayMediaStreamConstraints&&(I.displayMediaStreamConstraints=o.displayMediaStreamConstraints),o.forceExtensionOnChrome&&(I.forceExtensionOnChrome=o.forceExtensionOnChrome),o.filters&&(I.filters=o.filters),o.callId&&("call"!==o.callFlavor&&"userMedia"!==o.callFlavor||(l=o.callFlavor),I.addCallInfo(o.callId,l,null===I.stream)),I.callbacks.release="function"==typeof o.release?o.release:function(){},I.callbacks.success="function"==typeof o.success?o.success:function(){},I.callbacks.failure="function"==typeof o.failure?o.failure:function(){},apiCC.userMediaStreamTable.push(I),null===I.stream?"screenSharing"===I.callType||"screenSharingWithAudio"===I.callType?I.getScreenMedia():"data"!==I.callType?I.getUserMedia():!0===o.sync?(f(I.userMediaStreamId),I.callbacks.failure(I,"wrong type")):setTimeout(function(){f(I.userMediaStreamId),I.callbacks.failure(I,"wrong type")},0):(I.updateMediaProperties(I.stream),!0===o.sync?I.callbacks.success(I):setTimeout(function(){I.callbacks.success(I)},0)),I},apiCC.releaseUserMediaStream=function(o,f,I){var l=!1,V=apiCC.userMediaStreamTable.length,T=null;if(null!==f&&"string"!=typeof f&&(f=null),null==o){if(I&&"function"==typeof I.accept)for(;--V>=0;)if(!0===I.accept(apiCC.userMediaStreamTable[V])){if(f){if(null===(T=apiCC.userMediaStreamTable[V].getOwnerCallInfo())||T.callId!==f){apiCC.userMediaStreamTable[V].removeCallInfo(f);break}}else if(null!==(T=apiCC.userMediaStreamTable[V].getOwnerCallInfo()))break;n.debug("[releaseUserMediaStream] match; userMediaStreamId: "+apiCC.userMediaStreamTable[V].userMediaStreamId),apiCC.userMediaStreamTable[V].release(),f&&apiCC.userMediaStreamTable[V].removeCallInfo(f),apiCC.userMediaStreamTable.splice(V,1),l=!0;break}}else for(;--V>=0;)if(apiCC.userMediaStreamTable[V].userMediaStreamId===o){if(f){if(null===(T=apiCC.userMediaStreamTable[V].getOwnerCallInfo())||T.callId!==f){apiCC.userMediaStreamTable[V].removeCallInfo(f);break}}else if(null!==(T=apiCC.userMediaStreamTable[V].getOwnerCallInfo()))break;n.debug("[releaseUserMediaStream] id; userMediaStreamId: "+apiCC.userMediaStreamTable[V].userMediaStreamId),apiCC.userMediaStreamTable[V].release(),f&&apiCC.userMediaStreamTable[V].removeCallInfo(f),apiCC.userMediaStreamTable.splice(V,1),l=!0;break}return l},apiCC.activeSpeakerDetect=!1,apiCC.activeSpeakerThreshold=100,apiCC.enableActiveSpeakerDetecting=function(o,f){apiCC.activeSpeakerDetect=o,f&&(apiCC.activeSpeakerThreshold=f)},apiCC.apiRTCExtensionInstalled=!1,apiCC.extensionInstallationSuccessCallback=function(){n.debug("extensionInstallationSuccessCallback"),apiCC.apiRTCExtensionInstalled=!0},apiCC.extensionInstallationFailureCallback=function(o,f){n.debug("extensionInstallationFailureCallback : Error :"+o+", "+f),o=null,f=null,R.createDesktopCaptureEvent("Extension_installation_Error",apiRTC.waitingShareScreenCallId,apiRTC.waitingShareScreenDestNumber,apiRTC.waitingCaptureSourceType)},apiCC.manageNotInstalledExtension=function(o,f,I){n.debug("manageNotInstalledExtension"),n.warn("apiRTC extension not installed"),R.createDesktopCaptureEvent("Extension_not_installed",o,f),n.warn("Starting apiRTC extension installation"),apiRTC.waitingShareScreenDestNumber=f,apiRTC.waitingShareScreenCallId=o,apiRTC.waitingCaptureSourceType=I,c.PR>=71?(n.debug("Chrome >= 71, opening Chrome web Store"),apiRTC.extensionInstallationFailureCallback("Chrome71 : chrome.webstore.install() no more supported","Chrome71-screenShare"),window.open("https://chrome.google.com/webstore/detail/apizee-desktop-capture/mjjnofoemoepfididplbfimokpnpcoeg")):chrome.webstore.install("https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",apiRTC.extensionInstallationSuccessCallback,apiRTC.extensionInstallationFailureCallback)},apiCC.activateScreenSharing=function(o){n.debug("activateScreenSharing");var f=null;void 0!==o?n.log("extensionId is defined :"+o):(n.log("using apizee extension's Id"),o="mjjnofoemoepfididplbfimokpnpcoeg"),"Chrome"===c.Xh?null!==document.getElementById(o)?(n.log("extensionLink is present, screenSharing is already activated"),window.postMessage("apiRTC-extension","*")):(n.log("screenSharing is not yet activated"),(f=document.createElement("link")).href="https://chrome.google.com/webstore/detail/"+o,f.rel="chrome-webstore-item",f.id=o,document.getElementsByTagName("head")[0].appendChild(f),window.addEventListener("message",function(I){var l=null;if(n.log("message: event: "+JSON.stringify(I.data)),I.origin==window.location.origin){if("apiRTC-DeskstopCapture-loaded"!==I.data)return"extensionInstalledAndLoaded"===I.data?(apiCC.apiRTCExtensionInstalled=!0,null!==apiCC.waitingShareScreenUserMediaStream&&void 0!==apiCC.waitingShareScreenUserMediaStream&&(apiCC.userMediaStreamTable.push(apiCC.waitingShareScreenUserMediaStream[0]),delete apiCC.waitingShareScreenUserMediaStream),void(apiCC.waitingShareScreenUserMediaStreamId&&(l=apiCC.getUserMediaStream(apiCC.waitingShareScreenUserMediaStreamId),delete apiCC.waitingShareScreenUserMediaStreamId,l&&l.getScreenMedia()))):void("object"===S(I.data)&&void 0!==I.data.desktopId&&("getScreenMedia"!==I.data.remoteId||null===(l=apiCC.getUserMediaStream(I.data.callNumber))||l.registerScreenMedia(I.data.captureSourceType,I.data.desktopId)));apiCC.apiRTCExtensionInstalled=!0}}),window.postMessage("apiRTC-extension","*")):(n.log("activateScreenSharing is only available for chrome Browser"),R.createDesktopCaptureEvent("Browser_Not_Compatible",null,null))},apiCC.checkIfAudioSourceIdExistOnDevice=function(o){n.log("checkIfAudioSourceIdExistOnDevice :",o);var f,I=!1,l=null;if(null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)"audio"!==(l=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).kind&&"audioinput"!==l.kind||(l.deviceId===o?(n.log("Audio device present :",o),I=!0):n.log("not this deviceId"));return I},apiCC.setAudioSourceIdInConstraint=function(o,f){return n.log("setAudioSourceIdInConstraint:",f),null==o?n.log("audioSourceId not defined"):!1===f.audio?n.log("constraints.audio === false, no audio device present"):!1===apiCC.checkIfAudioSourceIdExistOnDevice(o)?(n.log("audioSourceId not found on device"),f.audio={}):(!0!==f.audio&&void 0!==f.audio||(f.audio={}),n.log("audioSourceId is defined :",o),"iOS"===c.ag.name?"Mobile Safari"===c.Xh||(f.audio.deviceId=o):"Firefox"===c.Xh&&c.PR>=50?f.audio.deviceId=o:"Chrome"===c.Xh&&c.PR<48||"Safari"===c.Xh&&c.PR<11?f.audio.optional=[{sourceId:o}]:f.audio.deviceId=o?{ideal:o}:void 0),n.debug("constraints =",f),f},apiCC.checkIfVideoSourceIdExistOnDevice=function(o){n.log("checkIfVideoSourceIdExistOnDevice :",o);var f,I=!1,l=null;if(n.debug("apiCC.mediaDeviceMgr.mediaSourceInfos :",apiCC.mediaDeviceMgr.mediaSourceInfos),null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)"video"!==(l=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).kind&&"videoinput"!==l.kind||(l.deviceId===o?(n.log("Video device present :",o),I=!0):n.log("not this deviceId"));return I},apiCC.getMediaDeviceLabelFromDeviceid=function(o){n.log("getMediaDeviceLabelFromDeviceid :",o);var f,I="Not_Found",l=null;if(n.debug("apiCC.mediaDeviceMgr.mediaSourceInfos :",apiCC.mediaDeviceMgr.mediaSourceInfos),null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)(l=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).deviceId===o?(n.log("Video device present :",o),I=l.label):n.log("not this deviceId");return I},apiCC.setVideoSourceIdInConstraint=function(o,f){if(n.log("setVideoSourceIdInConstraint : ",f),null==o)n.log("videoSourceId not defined");else if(!1===f.video)n.log("constraints.video === false, no video device present");else if(!1===apiCC.checkIfVideoSourceIdExistOnDevice(o))n.log("videoSourceId not found on device"),f.video={};else if(n.log("videoSourceId is defined :",o),!0!==f.video&&void 0!==f.video||(f.video={}),"iOS"===c.ag.name)if("Mobile Safari"===c.Xh){if(o){var I=!1,l=c.ag.version.split(".");l.length>0&&parseInt(l[0])<13&&(I=!0),f.video.deviceId=I?{exact:o}:{ideal:o}}}else f.video.deviceId=o;else"Firefox"===c.Xh&&c.PR>=50?"Firefox"===c.Xh&&c.PR>=77?(n.debug("FX > 77 using exact to set deviceId"),f.video.deviceId={exact:o}):f.video.deviceId=o:"Chrome"===c.Xh&&c.PR<48||"Safari"===c.Xh&&c.PR<11?f.video.optional=[{sourceId:o}]:f.video.deviceId=o?{ideal:o}:void 0;return n.log("constraints =",f),f},apiCC.setVideoFacingModeInConstraint=function(o,f){n.log("setVideoFacingModeInConstraint");var I={};return!1===f.video?(n.log("facingMode value is not setted, constraints.video is false"),f):null==o?(n.log("facingMode value is not setted"),f):"user"!==o&&"environment"!==o&&"left"!==o&&"right"!==o?(n.log("facingMode value is not correct"),f):(null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices.getSupportedConstraints&&void 0!==navigator.mediaDevices.getSupportedConstraints&&(I=navigator.mediaDevices.getSupportedConstraints()),I.hasOwnProperty("facingMode")?(n.log("Setting FacingMode in constraint"),!0===f.video&&(f.video={}),f.video.facingMode={ideal:o}):n.log("FacingMode not supported by device"),n.debug("constraints =",f),f)},apiCC.setResolutionInConstraint=function(o,f,I){return n.log("setResolutionInConstraint"),o<=0||f<=0?(n.log("Resolution value must be positif non null"),I):(!0===I.video||void 0!==I.video?"iOS"===c.ag.name?"Mobile Safari"===c.Xh?(I.video.width=o?{exact:o}:void 0,I.video.height=f?{exact:f}:void 0):(I.video.width=o,I.video.height=f):"Firefox"===c.Xh&&c.PR>=50?(I.video.width=o,I.video.height=f):"Safari"===c.Xh&&c.PR>=11||"Mobile Safari"===c.Xh||"Edge"===c.Xh||"Chrome"===c.Xh&&c.PR>=49||"Firefox"===c.Xh&&c.PR>=50?(I.video.width=o?{exact:o}:void 0,I.video.height=f?{exact:f}:void 0):I.video.mandatory=[{width:o,height:f}]:n.error("setResolutionInConstraint : contraint.video must be true or defined"),n.debug("constraints =",I),I)},apiCC.checkConstraintDependingOnDevice=function(o){n.debug("checkConstraintDependingOnDevice :",o),"Mobile Safari"===c.Xh&&c.PR>=13&&void 0!==o.video&&void 0!==o.video.height&&void 0!==o.video.width&&1080===o.video.height.ideal&&1920===o.video.width.ideal&&(n.debug("Downgrading selected height and width resolution on iOS, to avoid stream issue"),o.video.height.ideal=720,o.video.width.ideal=1280)},apiCC.attachMediaStream=function(o,f){n.debug("attachMediaStream"),null!==o?(void 0!==o.srcObject?o.srcObject=f:void 0!==o.mozSrcObject?o.mozSrcObject=f:void 0!==o.src?"Chrome"===c.Xh&&c.PR<46?(n.log("Attaching media stream for Chrome < 46"),o.src=webkitURL.createObjectURL(f)):o.src=URL.createObjectURL(f):n.error("Error attaching stream to element."),"iOS"===c.ag.name&&(n.log("iOS detected"),o.setAttribute("playsinline",!0))):n.log("videoElt is null")},apiCC.addStreamInDiv=function(o,f,I,l,V,T,b){n.debug("addStreamInDiv");var H,ne=null,le=null,W=!1,be=null;(0,C.Ym)(b,"object")&&null!=b.type&&(f=b.type),(0,C.Ym)(b,"object")&&void 0!==b.forceAudioAndVideoMediaElementSeparation&&(n.debug("forceAudioAndVideoMediaElementSeparation is set"),W=!0),"audio"===f?ne=document.createElement("audio"):("iOS"===c.BF&&"Mobile Safari"===c.Xh&&(n.debug("iOS && Mobile Safari"),W=!0),ne=document.createElement("video")),ne.id=l,ne.autoplay=!0,!0===W&&!1===T?(n.debug("before adding separated MediaEltAudio"),(be=document.createElement("audio")).id=l+"_sepAudio",be.muted=T,be.autoplay=!0,ne.muted=!0):ne.muted=T,ne.style.width=V.width,ne.style.height=V.height,H=function(de){var ce=null,Ee=de.play();ce=function(){var Ne=de.play();n.log("funcFixIoS"),void 0!==Ne&&Ne.then(function(){n.log("Autoplay started"),apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.setStatus("Audio is now activated"),document.removeEventListener("touchstart",ce)}).catch(function(Oe){n.error("Autoplay was prevented")})},void 0!==Ee&&Ee.then(function(){n.log("Autoplay started")}).catch(function(Ne){"iOS"===c.ag.name?(n.warn("iOS : Autoplay was prevented, activating touch event to start media play"),apiCC.myWebRTC_Event.createErrorEvent("ERROR: iOS : Autoplay was prevented","IOS_AUTOPLAY_PREVENTED"),document.addEventListener("touchstart",ce),apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.setStatus("WARNING : Audio autoplay was prevented by iOS, touch screen to activate audio")):n.warn("Autoplay was prevented")})},"Chrome"===c.Xh&&"61"===c.PR&&"Android"===c.BF&&(ne.style.borderRadius="1px",n.log("Patch for video display on Chrome 61 Android")),apiCC.session&&apiCC.session.apiCCWebRTCClient&&void 0!==apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId&&null!==apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId?(n.log("audioOutputId set to: "+apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId),ne.setSinkId(apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId).then(function(){n.log("Success, audio output device attached")})):n.log("No audioOutputId set"),"iOS"!==c.BF&&(le=document.getElementById(I)).appendChild(ne),void 0!==o&&(apiCC.attachMediaStream(ne,o),!0===W&&!1===T&&apiCC.attachMediaStream(be,o)),"iOS"===c.BF&&(le=document.getElementById(I)).appendChild(ne),!0===W&&!1===T&&null!==le&&le.appendChild(be),H(ne),!0===W&&!1===T&&H(be)},apiCC.removeElementFromDiv=function(o,f){n.debug("removeElementFromDiv");var I,l,V=null;I=document.getElementById(f),V=document.getElementById(o),null!==I&&(n.log("Removing video element with Id : "+f),null!==V&&V.removeChild(I)),null!==(l=document.getElementById(f+"_sepAudio"))&&(n.log("iOS : Removing audio element with Id : "+f+"_sepAudio"),null!==V&&V.removeChild(l))},apiCC.randomString=function(o,f){for(var I="string"==typeof f&&f.length>0?f:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l="";--o>=0;)l+=I.charAt(Math.floor(Math.random()*I.length));return l},apiCC.generateCallId=function(){var o;return o=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),n.debug("new callId :"+o),o},apiCC.generateInstanceId=function(){var o;return o=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),n.debug("new instanceId :"+o),o},apiCC.myApiCCWhiteBoardClient=null,apiCC.createWhiteBoard=function(o,f,I,l){return n.debug("createWhiteBoard"),apiCC.myApiCCWhiteBoardClient=new apiCC.ApiCCWhiteBoardClient(apiCC.session,o,f,I,l),apiCC.myApiCCWhiteBoardClient},apiCC.closeWhiteBoardClient=function(o){n.info("closeWhiteBoardClient"),R.createClosingWhiteBoardEvent(apiCC.myApiCCWhiteBoardClient.roomId,o),apiCC.myApiCCWhiteBoardClient.isInRoom()&&apiCC.myApiCCWhiteBoardClient.leaveRoom(),apiCC.myApiCCWhiteBoardClient.stop()},apiCC.registerIOsDevice=function(o){n.debug("call registerIOsDevice 1");var f={type:"registerIOsDevice",senderId:apiCC.session.apiCCId,token:o},I=JSON.stringify(f);n.debug("call registerIOsDevice "+I),apiCC.session.channel.socket.emit("registerIOsDevice",I),n.debug("call registerIOsDevice  done")},apiCC.registerAndroidDevice=function(o){n.debug("registerAndroidDevice");var f={type:"registerAndroidDevice",senderId:apiCC.session.apiCCId,token:o},I=JSON.stringify(f);apiCC.session.channel.socket.emit("registerAndroidDevice",I)},apiCC.unRegisterIOsDevice=function(o){n.debug("unRegisterIOsDevice");var f={type:"unRegisterIOsDevice",senderId:apiCC.session.apiCCId,token:o},I=JSON.stringify(f);apiCC.session.channel.socket.emit("unRegisterIOsDevice",I)},apiCC.unRegisterAndroidDevice=function(o){n.debug("unRegisterAndroidDevice");var f={type:"unRegisterAndroidDevice",senderId:apiCC.session.apiCCId,token:o},I=JSON.stringify(f);apiCC.session.channel.socket.emit("unRegisterAndroidDevice",I)},apiCC.storeSessionCookies=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.info("storeSessionCookies",o),apiCC.session){var f=5e3;(0,C.ki)(apiCC.session,"apiCCIdPersistenceTimeout","number")&&apiCC.session.apiCCIdPersistenceTimeout>=0&&(f=apiCC.session.apiCCIdPersistenceTimeout),(0,C.Ym)(o.apiCCIdPersistenceTimeout,"number")&&o.apiCCIdPersistenceTimeout>=0&&(f=o.apiCCIdPersistenceTimeout),apiCC.setCookie("apiCCId",apiCC.session.apiCCId,f),apiCC.setCookie("apiKey",apiCC.session.apiKey,f),null!==apiCC.session.sessionId&&apiCC.setCookie("sessionId",apiCC.session.sessionId,f)}},apiCC.disconnect=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.info("disconnect",o),null!==apiCC&&apiCC.cleanAllEventListener(),null!==apiCC.session&&void 0!==apiCC.session&&("undefined"==typeof apiRTC_React&&!0!==o.invalidateApiCCId&&apiCC.storeSessionCookies(o),null!==apiCC.myApiCCWhiteBoardClient&&(n.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId&&apiCC.closeWhiteBoardClient("USER_DISCONNECTION")),n.log("Disconnecting from Server"),void 0!==apiCC.session.channel.socket&&null!==apiCC.session.channel.socket&&apiCC.session.channel.socket.disconnect(),apiCC.session.channel.channelHasBeenDisconnected=!1,apiCC.session.connectedUsersList.splice(0,apiCC.session.connectedUsersList.length)),apiCC&&(apiCC.session=null,apiCC.jsLoaded=!1)},apiCC.reconnect=function(){n.log("Reconnect"),n.log("apiCC.session.channel.socket:",apiCC.session.channel.socket),apiCC.session.channel.socket.socket.connect()},apiCC.cleanApiRTCContext=function(){null!==apiCC.session&&void 0!==apiCC.session&&(null!==apiCC.session.apiCCWebRTCClient&&void 0!==apiCC.session.apiCCWebRTCClient&&(0!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length&&n.warn("Call is still established and will be disconnected"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.length>0&&n.log("MCU session is still established and will be disconnected"),apiCC.session.apiCCWebRTCClient.hangUp(),null!==apiCC.session.apiCCWebRTCClient.webRTCClient.localStream&&(apiCC.session.apiCCWebRTCClient.webRTCClient.stopStream(apiCC.session.apiCCWebRTCClient.webRTCClient.localStream),R.createUserMediaStopEvent(null,"media")),apiCC.session.apiCCWebRTCClient=null),null!==apiCC.session.apiCCIMClient&&void 0!==apiCC.session.apiCCIMClient&&(apiCC.session.apiCCIMClient=null),null!==apiCC.session.apiCCDataClient&&void 0!==apiCC.session.apiCCDataClient&&(apiCC.session.apiCCDataClient=null),null!==apiCC.myApiCCWhiteBoardClient&&void 0!==apiCC.myApiCCWhiteBoardClient&&(apiCC.myApiCCWhiteBoardClient=null),null!==apiCC.session.apiCCCoBrowsingClient&&void 0!==apiCC.session.apiCCCoBrowsingClient&&(apiCC.session.apiCCCoBrowsingClient=null))},apiCC.cleanAllEventListener=function(){var o,f=0;if(null!==apiCC&&null!==apiCC.myEventTable&&(f=apiCC.myEventTable.length),0!==f){for(n.trace("number of myEventTable:"+f),o=0;o<f;o+=1)apiCC.removeEventListener(apiCC.myEventTable[o].type,apiCC.myEventTable[o].listener);apiCC.myEventTable.splice(0,f),f=apiCC.myEventTable.length,n.trace("number of myEventTable after splice:"+f)}},apiCC.testUserPing=function(o){n.debug("testUserPing()");var f,I,l,V,T=apiCC.bandwidthTestServer+"/upload-test",b=new XMLHttpRequest,H=new FormData,ne=Math.round(5*Math.random()),le=!1;"withCredentials"in b?b.open("POST",T,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest).open("POST",T):b=null,f=new Blob([ne],{type:"text/xml"}),H.append("file",f),b?(b.onload=function(){200===b.status&&(V=Date.now()-I,le||(clearTimeout(l),o(null,V)))},b.onerror=function(W){n.log("testUserUpload onerror status :",W.target.status),o({err:"An error occured during XMLHttpRequest",msg:W.target.status},null)},l=setTimeout(function(){le=!0,o("Ping timeout",-1)},5e3),b.send(H),I=Date.now()):o({err:"XMLHttpRequest is not defined",msg:"XMLHttpRequest is not defined"},null)},apiCC.testUserDownload=function(o,f){n.debug("testUserDownload()");var I,l,T,b,H,ne=apiCC.bandwidthTestServer+"/files/noise_"+o+"ko.jpg",le=0,W=new Image,be=0;ne+="?nnn="+Date.now();var de=[[256,257529],[500,525944],[768,787234],[1e3,1055741],[1500,1541044],[2e3,1992034],[2500,2596028],[3e3,2904977],[3500,3648299],[4e3,4151187],[4500,4741712],[5e3,5264577],[5500,5776081],[6e3,6318553],[6500,6779868],[7e3,7334256],[7500,7874040],[8e3,8081460],[8500,8651795],[9e3,9081899],[9500,9503574],[1e4,10082008],[10500,10543425],[11e3,11200424],[11500,11200424],[12e3,12110671],[12500,12715962],[13e3,13222120],[13500,13605073],[14e3,13954769],[14500,14777594],[15e3,15178928],[15500,15602106],[16e3,16054618],[16500,16578623],[17e3,17048069],[17500,17456403],[18e3,17910332],[18500,18725846],[19e3,19284746],[19500,19771902],[2e4,20121527],[21e3,20975042],[22e3,22189200],[23e3,23027928],[24e3,24027870],[25e3,24878845],[26e3,26237503],[27e3,27112004],[28e3,27953446],[29e3,29313013],[3e4,30474095]];for(b=0;b<de.length;b++)o===de[b][0]&&(le=de[b][1]);apiCC.testUserPing(function(ce,Ee){W.onload=function(){for((l=Date.now()-I)-Ee>10&&(l-=Ee),T=Math.round(le/(l/1e3)/1e3),H={type:"download",kBPerSec:T},b=0;b<apiCC.bandwidthRatingThresholds.length;b++)8*H.kBPerSec>=apiCC.bandwidthRatingThresholds[b]&&be++;H.rating=be+"/"+apiCC.bandwidthRatingThresholds.length,f(null,H)},W.onerror=function(Ne,Oe){f({label:"Error when downloading",err:Ne,msg:Oe},null)},I=(new Date).getTime(),W.src=ne})},apiCC.testUserUpload=function(o,f){n.debug("testUserUpload()");var I,l,V,T,b,ne,le=apiCC.bandwidthTestServer+"/upload-test",W=new XMLHttpRequest,be=new FormData,de="",ce=0;for(("withCredentials"in W?W.open("POST",le,!0):"undefined"!=typeof XDomainRequest?(W=new XDomainRequest).open("POST",le):W=null,l=0);l<o;l++)de+=Math.round(5*Math.random());I=new Blob([de],{type:"text/xml"}),be.append("file",I),W?(W.onload=function(){if(200===W.status){for(b=Date.now()-T,ne=Math.round(o/(b/1e3)/1e3),V={type:"upload",kBPerSec:ne},l=0;l<apiCC.bandwidthRatingThresholds.length;l++)8*V.kBPerSec>=apiCC.bandwidthRatingThresholds[l]&&ce++;V.rating=ce+"/"+apiCC.bandwidthRatingThresholds.length,f(null,V)}else f({err:"An error occured during XMLHttpRequest",msg:W.status},null)},W.onerror=function(Ee){n.log("testUserUpload onerror status :",Ee.target.status),f({err:"An error occured during XMLHttpRequest",msg:Ee.target.status},null)},W.send(be),T=Date.now()):f({err:"XMLHttpRequest is not defined",msg:"XMLHttpRequest is not defined"},null)},apiCC.testUserUploadLoop=function(o,f,I){var l={type:"upload",kBPerSec:f.kbps/8,kbps:f.kbps,rating:f.rating},V=0;f.kbps>1e3?apiCC.testUserUpload(o,function(T,b){null!==T?I({err:"An error occured during XMLHttpRequest"},null):(l.kBPerSec=b.kBPerSec,l.kbps=8*b.kBPerSec,l.rating=b.rating,V=l.kbps-f.kbps,n.debug("upload "+o+" "+JSON.stringify(l)+"; diff "+V),V>=2e4&&o<12e6?apiCC.testUserUploadLoop(o+8e6,l,I):V>=1e4&&o<14e6?apiCC.testUserUploadLoop(o+6e6,l,I):V>=5e3&&o<16e6?apiCC.testUserUploadLoop(o+4e6,l,I):V>=1e3&&o<18e6?apiCC.testUserUploadLoop(o+2e6,l,I):V>=200&&o<19e6?apiCC.testUserUploadLoop(o+1e6,l,I):I(null,l))}):I(null,l)},apiCC.testUserDownloadLoop=function(o,f,I){var l={type:"download",kBPerSec:f.kbps/8,kbps:f.kbps,rating:f.rating},V=0;f.kbps>=3500?apiCC.testUserDownload(o,function(T,b){null!==T?I({err:"Error when downloading"},null):(l.kBPerSec=b.kBPerSec,l.kbps=8*b.kBPerSec,l.rating=b.rating,V=l.kbps-f.kbps,n.debug("download "+o+" "+JSON.stringify(l)+"; diff "+V),V>=2e4?apiCC.testUserDownloadLoop(3e4,l,I):V>=1e4&&o<=2e4?apiCC.testUserDownloadLoop(o+1e4,l,I):V>=5e3&&o<=25e3?apiCC.testUserDownloadLoop(o+5e3,l,I):V>=1e3&&o<=27e3?apiCC.testUserDownloadLoop(o+3e3,l,I):V>=200&&o<=29e3?apiCC.testUserDownloadLoop(o+1e3,l,I):I(null,l))}):I(null,l)},apiCC.listenedAudioSources={};var p=window.AudioContext||window.webkitAudioContext||!1;apiCC.audioContext=null,apiCC.getAudioContext=function(){return"iOS"===apiRTC.osName&&"undefined"!=typeof cordova?n.debug("No audioContext for iOS cordova"):p&&null===apiCC.audioContext&&(apiCC.audioContext=new p),apiCC.audioContext},apiCC.listenToAudioSources=function(o){n.debug("listenToAudioSources()");var f,I=apiCC.getAudioContext();null!=I?(Object.keys(apiCC.listenedAudioSources).length>0&&apiCC.stopAudioSourceListening(),apiCC.getMediaDevices().then(function(l){for(n.log(l),f=0;f<l.length;f++)"audioinput"===l[f].kind&&(apiCC.listenedAudioSources[l[f].deviceId]={deviceId:l[f].deviceId,callback:o,label:l[f].label},navigator.getUserMedia({audio:{optional:[{sourceId:l[f].deviceId}]},video:!1},function(V){n.log("new stream processing function for : "+this.device.deviceId),this.device.audioListener=this;var T=this,b=I.createScriptProcessor(2048,1,1),H=I.createMediaStreamSource(V);b.connect(I.destination),b.onaudioprocess=function(){var le,be=new Uint8Array(this.analyser.frequencyBinCount),de=0;for(this.analyser.getByteFrequencyData(be),le=0;le<be.length;le++)de+=be[le];T.device.callback({deviceId:T.device.deviceId,label:T.device.label,amplitude:de/be.length,active:V.active})},b.analyser=I.createAnalyser(),b.analyser.smoothingTimeConstant=.3,b.analyser.fftSize=1024,H.connect(b.analyser),b.analyser.connect(b),this.destroy=function(){n.log("destroy()");var ne,le=V.getTracks();for(ne=0;ne<le.length;ne+=1)le[ne].stop();H.disconnect(),b.analyser.disconnect(),b.disconnect()}}.bind({device:apiCC.listenedAudioSources[l[f].deviceId]}),function(V){n.error("Error getting microphone",V)}))},function(l){n.debug("listenToAudioSources() - getMediaDevices error :",l)})):n.debug("listenToAudioSources() - Unable to create audio context")},apiCC.stopAudioSourceListening=function(){var o;for(n.debug("stopAudioSourceListening()"),o=0;o<Object.keys(apiCC.listenedAudioSources).length;o++)void 0!==apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[o]]?void 0!==apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[o]].audioListener?apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[o]].audioListener.destroy():n.warn("error on stopAudioSourceListening, audioListener"):n.warn("error on stopAudioSourceListening, listenedAudioSources element");apiCC.listenedAudioSources={}},apiCC.webRTCPluginInstalled=!1,apiCC.iePluginInstallationPreventUnload=!1,apiCC.setlogStorageActivated=function(o,f){n.debug("setlogStorageActivated :",o),this.logStorageActivated=(!0===o||!1===o)&&o,void 0!==f&&(this.logStorageLevel=f)},apiCC.sendLogToCloud=function(o,f,I,l){n.info("sendLogToCloud");var V,T,b=[],ne=[],le=null,W=null;for(b.push(JSON.stringify({title:"ApiRTC logs",description:"Logs of apiRTC client"})),b.push(JSON.stringify({ts:Date.now(),name:"system-info",args:{browserName:apiCC.browser,browserVersion:apiCC.browser_version,platform:apiCC.osName}})),V=0;V<o.length;V++)b.push(JSON.stringify("error"===o[V][0]?{name:"test-run",args:{error:o[V][1]}}:{name:"test-run",args:{info:o[V][1]}}));ne=b.concat(apiCC.logStorage),le=new FormData,T="["+ne.join(",\n")+"]",n.debug("fileContent :",T),!0!==l&&(le.append("data",T),le.append("apiKey",apiCC.initApiKey),void 0!==f&&le.append("id",f),(W=new XMLHttpRequest).open("POST",I+"/test/api/",!0),W.onreadystatechange=function(){4===W.readyState&&200===W.status&&console.info("[apiRTC_Logs] POST'd successfully"),console.trace(W.responseText)},W.send(le))},apiCC.manageWebRTCPlugin=function(o,f){var I;n.debug("manageWebRTCPlugin"),I="https:"!==window.location.protocol?"http":"https",loadjs([I+"://cdn.temasys.io/adapterjs/0.15.x/adapter.debug.js"],"temAdapter",{async:!0,numRetries:apiCC.extJsLoadingRetryNb||100,reqdelay:apiCC.extJsLoadingRetryDelay||200,success:function(){n.log("End of .js loading for plugin"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","loaded"),AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,AdapterJS.WebRTCPlugin.pluginInfo.type,function(){apiCC.myWebRTC_Adapter.RTCSessionDescription=RTCSessionDescription,apiCC.myWebRTC_Adapter.RTCIceCandidate=RTCIceCandidate,apiCC.myWebRTC_Adapter.RTCPeerConnection=RTCPeerConnection,apiCC.myWebRTC_Adapter.getUserMedia=navigator.getUserMedia,apiCC.attachMediaStream=attachMediaStream,AdapterJS.webRTCReady(function(l){return n.log("webRTCReady, plugin already installed"),o()})},function(){return apiCC.iePluginInstallationPreventUnload=!0,f(),AdapterJS.webRTCReady(function(l){return n.log("webRTCReady after plugin install"),apiCC.iePluginInstallationPreventUnload=!1,apiCC.myWebRTC_Adapter.RTCSessionDescription=RTCSessionDescription,apiCC.myWebRTC_Adapter.RTCIceCandidate=RTCIceCandidate,apiCC.myWebRTC_Adapter.RTCPeerConnection=RTCPeerConnection,apiCC.myWebRTC_Adapter.getUserMedia=navigator.getUserMedia,apiCC.attachMediaStream=attachMediaStream,o()}),apiCC.session.apiCCWebRTCClient.myWebRTC_Event.createEvent({eventType:"webRTCPluginInstallation"}),null})},error:function(l){n.error("temAdapter loading error"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","error")},retrycb:function(l,V){n.warn("temAdapter loading retry :"+l+" ,delay before retry :"+V),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","retry")}})},apiCC.checkMutingStateForUserMedia=function(o,f){n.debug("checkMutingStateForUserMedia"),(0,C.ki)(o,"muted","string")&&(n.log("callConfiguration muted is set :",o.muted),"VIDEO"===o.muted&&(f.muteVideoOnStreams(),f.muteAudioOnStreams()),"AUDIOONLY"===o.muted&&f.muteAudioOnStreams(),"VIDEOONLY"===o.muted&&f.muteVideoOnStreams())},apiCC.isSIPNumber=function(o){var f,I=null,l=!1;return f=o.toString().startsWith("sip:"),o.toString().length<=20&&(I=!0),(0!==o.toString().indexOf("0")&&0!==o.toString().indexOf("+")||!0!==I)&&!0!==f||(l=!0),l},apiCC.loadSentry=function(o,f){n.debug("Remote logging activation"),loadjs([f+"://browser.sentry-cdn.com/5.24.2/bundle.tracing.min.js"],"Sentry",{async:!0,numRetries:10,reqdelay:500,success:function(){Sentry.init({dsn:"https://c24c226714f841dbbc3d1518b6cc7fe8@o333237.ingest.sentry.io/5448622",release:apiCC.version,tracesSampleRate:1}),Sentry.configureScope(function(I){I.setTag("apiKey",o)})},error:function(I){console.error("Remote logging - loading error")},retrycb:function(I,l){console.warn("Remote logging - loading retry :"+I+" ,delay before retry :"+l)}})}},5945:(F,Y,e)=>{"use strict";e.d(Y,{ag:()=>A,E2:()=>c,cf:()=>R,Xh:()=>d,dc:()=>L,PR:()=>w,vO:()=>n,BF:()=>C,MM:()=>S,$6:()=>v}),e(8309),e(2772),e(9064);var i,c=null,d=null,L=null,w=null,A=null,C=null,S=null,n=null,v=null,R=null;i=(c=new UAParser).getBrowser(),A=c.getOS(),R=c.getBrowser(),"undefined"!=typeof apiRTC_React?(L=DeviceInfo.getSystemVersion(),C=DeviceInfo.getSystemName(),d=DeviceInfo.getUserAgent(),n=DeviceInfo.getModel()):(L=i.version,C=c.getOS().name,S=c.getOS().version,d=i.name,n=c.getDevice().type),w=void 0!==L?i.major:99,window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf(" electron/")>=0&&(v="electron")},944:(F,Y,e)=>{"use strict";function i(C,S){return function(n){if(Array.isArray(n))return n}(C)||function(n,v){var R=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=R){var p,o,f=[],I=!0,l=!1;try{for(R=R.call(n);!(I=(p=R.next()).done)&&(f.push(p.value),!v||f.length!==v);I=!0);}catch(V){l=!0,o=V}finally{try{I||null==R.return||R.return()}finally{if(l)throw o}}return f}}(C,S)||function(n,v){if(n){if("string"==typeof n)return c(n,v);var R=Object.prototype.toString.call(n).slice(8,-1);return"Object"===R&&n.constructor&&(R=n.constructor.name),"Map"===R||"Set"===R?Array.from(n):"Arguments"===R||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R)?c(n,v):void 0}}(C,S)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(C,S){(null==S||S>C.length)&&(S=C.length);for(var n=0,v=new Array(S);n<S;n++)v[n]=C[n];return v}function L(C,S){var n;return n=(C/=255)<.09804?.001857/.09804*C:C<.2?.05807/.10196*(C-.09804)+.001857:C<.298?.1267/.09804*(C-.2)+.05993:C<.4?.1564/.10196*(C-.298)+.1866:C<.498?.1539/.09804*(C-.4)+.343:C<.6?.1601/.10196*(C-.498)+.4969:C<.698?.1506/.09804*(C-.6)+.657:C<.8?.1325/.10196*(C-.698)+.8076:C<.898?.05753/.09804*(C-.8)+.9401:.002403/.10196*(C-.898)+.9976,255*Math.pow(n,S)}function w(C,S){return 255*Math.pow(C/255,S)}e.d(Y,{H:()=>A}),e(7327),e(6992),e(9575),e(1539),e(9743),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(9070),e(9753),e(2526),e(1817),e(2165),e(8783),e(3948),e(7042),e(8309),e(1038);var A=function(){function C(v,R,p){(function(o,f){if(!(o instanceof f))throw new TypeError("Cannot call a class as a function")})(this,C),this.image=v,this.width=R,this.height=p,this.length=this.width*this.height}var n;return n=[{key:"mean",value:function(){var v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=0,p=0,o=0;if(v)for(var f=0;f<this.length;f++)R+=Math.pow(this.image.data[4*f+0],2)/(255*this.length),p+=Math.pow(this.image.data[4*f+1],2)/(255*this.length),o+=Math.pow(this.image.data[4*f+2],2)/(255*this.length);else for(var I=0;I<this.length;I++)R+=this.image.data[4*I+0]/this.length,p+=this.image.data[4*I+1]/this.length,o+=this.image.data[4*I+2]/this.length;return[R,p,o]}},{key:"mad",value:function(){var v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=this.mean(v),p=i(R,3),o=p[0],f=p[1],I=p[2],l=0,V=0,T=0;if(v)for(var b=0;b<this.length;b++)l+=Math.abs(Math.pow(this.image.data[4*b+0],2)/255-o)/this.length,V+=Math.abs(Math.pow(this.image.data[4*b+1],2)/255-f)/this.length,T+=Math.abs(Math.pow(this.image.data[4*b+2],2)/255-I)/this.length;else for(var H=0;H<this.length;H++)l+=Math.abs(this.image.data[4*H+0]-o)/this.length,V+=Math.abs(this.image.data[4*H+1]-f)/this.length,T+=Math.abs(this.image.data[4*H+2]-I)/this.length;return[l,V,T]}},{key:"std",value:function(){var v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=this.mean(v),p=i(R,3),o=p[0],f=p[1],I=p[2],l=0,V=0,T=0;if(v)for(var b=0;b<this.length;b++)l+=Math.pow(Math.pow(this.image.data[4*b+0],2)/255-o,2)/this.length,V+=Math.pow(Math.pow(this.image.data[4*b+1],2)/255-f,2)/this.length,T+=Math.pow(Math.pow(this.image.data[4*b+2],2)/255-I,2)/this.length;else for(var H=0;H<this.length;H++)l+=Math.pow(this.image.data[4*H+0]-o,2)/this.length,V+=Math.pow(this.image.data[4*H+1]-f,2)/this.length,T+=Math.pow(this.image.data[4*H+2]-I,2)/this.length;return[l=Math.sqrt(l),V=Math.sqrt(V),T=Math.sqrt(T)]}},{key:"blur",value:function(){var v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,R=new OffscreenCanvas(this.width,this.height),p=R.getContext("2d");R.width=this.width,R.height=this.height,p.putImageData(this.image,0,0),p.filter="blur("+v+"px)",p.drawImage(R,0,0);var o=p.getImageData(0,0,this.width,this.height);return o}},{key:"threshold",value:function(v,R,p){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=new ImageData(this.image.data,this.width,this.height),l=0;if(f){var V=l;l=o,o=V}for(var T=0;T<this.length;T++)I.data[4*T+0]=this.image.data[4*T+0]<v?l:o,I.data[4*T+1]=this.image.data[4*T+1]<R?l:o,I.data[4*T+2]=this.image.data[4*T+2]<p?l:o;return I}},{key:"powerFilter",value:function(v){var R=new Uint8ClampedArray(4*this.length);if(1===v)return this.image;for(var p=0;p<this.length;p++)R[4*p+0]=w(this.image.data[4*p+0],v),R[4*p+1]=w(this.image.data[4*p+1],v),R[4*p+2]=w(this.image.data[4*p+2],v),R[4*p+3]=255;return new ImageData(R,this.width,this.height)}},{key:"sigmoidFilter",value:function(v){for(var R=new Uint8ClampedArray(4*this.length),p=0;p<this.length;p++)R[4*p+0]=L(this.image.data[4*p+0],v),R[4*p+1]=L(this.image.data[4*p+1],v),R[4*p+2]=L(this.image.data[4*p+2],v),R[4*p+3]=255;return new ImageData(R,this.width,this.height)}},{key:"weightedSum",value:function(v,R){for(var p=new Uint8ClampedArray(4*this.length),o=0;o<this.length;o++)p[4*o+0]=R*this.image.data[4*o+0]+(1-R)*v.data[4*o+0],p[4*o+1]=R*this.image.data[4*o+1]+(1-R)*v.data[4*o+1],p[4*o+2]=R*this.image.data[4*o+2]+(1-R)*v.data[4*o+2],p[4*o+3]=255;return new ImageData(p,this.width,this.height)}},{key:"weightedSumMask",value:function(v,R){for(var p=new Uint8ClampedArray(4*this.length),o=0;o<this.length;o++){var f=R.data[4*o]/255;p[4*o+0]=f*this.image.data[4*o+0]+(1-f)*v.data[4*o+0],p[4*o+1]=f*this.image.data[4*o+1]+(1-f)*v.data[4*o+1],p[4*o+2]=f*this.image.data[4*o+2]+(1-f)*v.data[4*o+2],p[4*o+3]=255}return new ImageData(p,this.width,this.height)}}],n&&function(C,S){for(var n=0;n<S.length;n++){var v=S[n];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(C,v.key,v)}}(C.prototype,n),C}()},4708:(F,Y,e)=>{"use strict";function i(l){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(V){return typeof V}:function(V){return V&&"function"==typeof Symbol&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V})(l)}e.d(Y,{_C:()=>d,Pj:()=>L,yJ:()=>w,dD:()=>A,Wc:()=>C,S6:()=>S,ws:()=>n,wL:()=>v,cw:()=>p,Ym:()=>o,ki:()=>f,fS:()=>I}),e(4603),e(4916),e(9714),e(3123),e(9600),e(1249),e(7941),e(4723),e(1058),e(6992),e(9575),e(1539),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(9753),e(7042),e(2526),e(1817),e(2165),e(8783),e(3948);var c=e(1549).Y.get("Utils");function d(l){return new RegExp("^[0-9-.]*$","g").test(l)}function L(){return"undefined"!=typeof apiRTC_React||"https:"===window.location.protocol}function w(){return"undefined"==typeof apiRTC_React&&"http:"===window.location.protocol}function A(l){var V,T,b,H,ne={};for(b=0,H=(V=l.split("&")).length;b<H;b++)ne[(T=V[b].split("="))[0]]=T[1];return ne}function C(l){return Object.keys(l).map(function(V){return V+"="+l[V]}).join("&")}function S(l,V){c.debug("mergeJSON");var T={},b=null;if(l)for(b in l)l.hasOwnProperty(b)&&(T[b]=l[b]);if(V)for(b in V)V.hasOwnProperty(b)&&(T[b]=V[b]);return c.log(T),T}var n=function(l,V){var T,b,H;for(null==l&&(l={}),T=1;T<arguments.length;T+=1)for(b in H=arguments[T])H.hasOwnProperty(b)&&(l[b]=H[b]);return l},v=function(){var l=function(T,b,H){var ne=T.match(b);return ne&&ne.length>=H&&parseInt(ne[H],10)},V={};if("undefined"!=typeof apiRTC_React)return V.type="react-native",V;if(void 0!==window&&void 0!==window.navigator)if(window.navigator.mozGetUserMedia)V.type="firefox",V.version=l(window.navigator.userAgent,/Firefox\/(\d+)\./,1);else if(window.navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)V.type="chrome",V.version=l(window.navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!window.navigator.userAgent.match(/Version\/(\d+).(\d+)/))return V;V.type="safari",V.version=l(window.navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(window.navigator.mediaDevices&&window.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))V.type="edge",V.version=l(window.navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.navigator.mediaDevices||!window.navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return V;V.type="safari",V.version=l(window.navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return V}(),R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-/=",p={decode:function(l){var V,T=R.indexOf(l.charAt(l.length-1)),b=R.indexOf(l.charAt(l.length-2)),H=l.length/4*3,ne=null,le=null,W=null,be=null,de=null,ce=null,Ee=0,Ne=null;for(64===T&&H--,64===b&&H--,Ne=new Uint8Array(H),V=0;V<H;V+=3)ne=R.indexOf(l.charAt(Ee++))<<2|(be=R.indexOf(l.charAt(Ee++)))>>4,le=(15&be)<<4|(de=R.indexOf(l.charAt(Ee++)))>>2,W=(3&de)<<6|(ce=R.indexOf(l.charAt(Ee++))),Ne[V]=ne,64!==de&&(Ne[V+1]=le),64!==ce&&(Ne[V+2]=W);return Ne},encode:function(l){var V,T="",b=new Uint8Array(l),H=b.byteLength,ne=H%3,le=H-ne,W=null;for(V=0;V<le;V+=3)T+=R[(16515072&(W=b[V]<<16|b[V+1]<<8|b[V+2]))>>18]+R[(258048&W)>>12]+R[(4032&W)>>6]+R[63&W];return 1===ne?T+=R[(252&(W=b[le]))>>2]+R[(3&W)<<4]+"==":2===ne&&(T+=R[(64512&(W=b[le]<<8|b[le+1]))>>10]+R[(1008&W)>>4]+R[(15&W)<<2]+"="),T}};function o(l,V){return 3===arguments.length?f(arguments[0],arguments[1],arguments[2]):"null"===V?null===l:"array"===V?null!==l&&"object"===i(l)&&Array.isArray(l):null!==l&&i(l)===V}function f(l,V,T){if(null!==V&&"object"===i(V)&&Array.isArray(V)&&V.length>=1){var b=V[0];if(V.length>1)return o(l,"object")&&o(b,"string")&&l.hasOwnProperty(b)&&o(l[b],"object")&&f(l[b],V.slice(1),T);V=b}return"undefined"===T?o(l,"object")&&o(V,"string")&&!l.hasOwnProperty(V)&&o(l[V],T):o(l,"object")&&o(V,"string")&&l.hasOwnProperty(V)&&o(l[V],T)}function I(l,V){if(l===V)return!0;if(!(l instanceof Object&&V instanceof Object)||l.constructor!==V.constructor)return!1;for(var T in l)if(l.hasOwnProperty(T)){if(!V.hasOwnProperty(T))return!1;if(l[T]===V[T])continue;if("object"!==i(l[T])||!I(l[T],V[T]))return!1}for(T in V)if(V.hasOwnProperty(T)&&!l.hasOwnProperty(T))return!1;return!0}},6075:(F,Y,e)=>{"use strict";e.d(Y,{F:()=>c});var i=e(1549).Y.get("WebRTC_Stack"),c=function(){this.adaptForIoSCordova=function(){if("iOS"===apiRTC.osName&&"undefined"!=typeof cordova){if(i.log("Modification for iOS cordova"),void 0===cordova.plugins)return void i.log("cordova.plugins not defined");if(void 0===cordova.plugins.iosrtc)return void i.log("cordova.plugins.iosrtc not defined");this.RTCPeerConnection=cordova.plugins.iosrtc.RTCPeerConnection,this.RTCSessionDescription=cordova.plugins.iosrtc.RTCSessionDescription,this.RTCIceCandidate=cordova.plugins.iosrtc.RTCIceCandidate}},"undefined"!=typeof RTCSessionDescription?this.RTCSessionDescription=RTCSessionDescription:i.log("RTCSessionDescription is undefined"),"undefined"!=typeof RTCIceCandidate?this.RTCIceCandidate=RTCIceCandidate:i.log("RTCIceCandidate is undefined"),"undefined"!=typeof RTCPeerConnection?this.RTCPeerConnection=RTCPeerConnection:i.log("RTCPeerConnection is undefined"),void 0!==navigator.getUserMedia?this.getUserMedia=navigator.getUserMedia:"undefined"!=typeof getUserMedia?this.getUserMedia=getUserMedia:i.log("getUserMedia is undefined")}},8765:(F,Y,e)=>{"use strict";e.d(Y,{K:()=>A}),e(6755),e(2772),e(3710),e(8309),e(9601),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(1549),c=e(5945),d=e(4708);function L(C){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(S){return typeof S}:function(S){return S&&"function"==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(C)}var w=i.Y.get("WebRTC_Event"),A=function(){if(w.debug("WebRTC_Event"),this.customEventIsDefined="notTested","notTested"===this.customEventIsDefined)try{new CustomEvent("test",{detail:"test",bubbles:!0,cancelable:!0}),this.customEventIsDefined=!0}catch(C){this.customEventIsDefined=!1,w.log("customEvent error :"+C)}("IE"===c.Xh&&c.dc>8||"Netscape"===c.Xh)&&(w.log("polyfill the CustomEvent()"),function(){function C(S,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var v=document.createEvent("CustomEvent");return v.initCustomEvent(S,n.bubbles,n.cancelable,n.detail),v}C.prototype=window.CustomEvent.prototype,window.CustomEvent=C}(),this.customEventIsDefined=!0),"IE"===c.Xh&&c.dc>8&&(w.log("polyfill startsWith()"),String.prototype.startsWith||(String.prototype.startsWith=function(C,S){return this.indexOf(C,S=S||0)===S})),this.eventDispatchMgr=function(C,S){if("undefined"!=typeof apiRTC_React)eventManager.dispatchEvent({type:C,detail:S});else if(!1===this.customEventIsDefined)"undefined"!=typeof $jqApz?(w.log("CustomEvent not supported by Browser, using $jqApz "),$jqApz.event.trigger({type:C,detail:S})):"undefined"!=typeof jQuery?(w.log("CustomEvent not supported by Browser, using jQuery "),jQuery.event.trigger({type:C,detail:S})):w.warn("Custom Events not supported on this browser : eventDispatchMgr()");else{var v=new CustomEvent(C,{detail:S,bubbles:!0,cancelable:!0});document.dispatchEvent(v)}},this.createIncomingCallEvent=function(C,S,n,v,R,p,o,f,I,l,V){var T={eventType:"incomingCall",time:new Date,clientId:C,callerId:S,callId:v,autoAnswerActivated:R,callNumber:p,callerNickname:n,audioOnly:o,callType:f,destCallType:V,recordedCall:I,remoteType:l};this.eventDispatchMgr("incomingCall",T)},this.createCallAttemptEvent=function(C,S,n,v){var R={eventType:"callAttempt",time:new Date,clientId:C,callerId:S,callId:v,callerNickname:n};this.eventDispatchMgr("callAttempt",R)},this.createCallEstablishedEvent=function(C,S,n,v){w.debug("createCallEstablishedEvent with callType : "+S),w.debug("destCallType : "+v);var R={eventType:"callEstablished",time:new Date,calleeId:C,callType:S,callId:n,destCallType:v};this.eventDispatchMgr("callEstablished",R)},this.createHangupEvent=function(C,S,n,v,R,p,o){var f={eventType:"hangup",time:new Date,hangupType:C,clientId:S,remoteId:n,lastEstablishedCall:v,reason:R,callId:p,callType:o};this.eventDispatchMgr("hangup",f)},this.createRemoteHangupEvent=function(C,S,n,v){var R={eventType:"remoteHangup",time:new Date,clientId:C,remoteId:S,lastEstablishedCall:n,reason:v};this.eventDispatchMgr("remoteHangup",R)},this.createCallRestartingEvent=function(C,S,n,v,R,p,o,f,I){var l={eventType:"callRestarting",time:new Date,callType:C,audioOnly:S,oldCallId:n,newCallId:v,dataType:R,clientId:p,remoteId:o,destRoom:f,streamId:I};this.eventDispatchMgr("callRestarting",l)},this.createUserMediaSuccessEvent=function(C,S,n,v,R,p,o,f,I,l,V){var T={eventType:"userMediaSuccess",time:new Date,onCallEstablishment:C,audioIsAvailable:S,audioDeviceLabel:n,videoIsAvailable:v,videoDeviceLabel:R,callType:p,callId:o,stream:f,remoteId:I,restarted:l,userMediaStreamId:V};this.eventDispatchMgr("userMediaSuccess",T)},this.createUserMediaErrorEvent=function(C,S,n,v,R,p,o){var f={eventType:"userMediaError",time:new Date,onCallEstablishment:C,callType:S,userMediaStreamId:v,callId:R,tryAudioCallActivated:p,gumConfig:o};"object"===L(n)?(f.error={},f.error.message=n.message,f.error.code=n.code,f.error.name=n.name):f.error=n,this.eventDispatchMgr("userMediaError",f)},this.createUserMediaStopEvent=function(C,S,n){var v={eventType:"userMediaStop",time:new Date,callId:C,mediaType:S,userMediaStreamId:n};this.eventDispatchMgr("userMediaStop",v)},this.createICECandidateTypeUpdateEvent=function(C,S,n){var v={eventType:"ICECandidateTypeUpdate",time:new Date,callId:C,localCandidate:S,remoteCandidate:n};this.eventDispatchMgr("ICECandidateTypeUpdate",v)},this.createSelectedICECandidateEvent=function(C,S,n,v,R,p,o){var f={eventType:"selectedICECandidate",time:new Date,callId:C,localCandidateType:S,remoteCandidateType:n,localAddress:v,remoteAdress:R,transportType:p,localTransportType:o};this.eventDispatchMgr("selectedICECandidate",f)},this.createErrorEvent=function(C,S,n,v,R,p,o){var f={eventType:"error",time:new Date,errorInfo:C,errorCode:S,callId:n,roomName:v,roomCallType:R};(0,d.Ym)(p,"object")&&(f.data=p),(0,d.Ym)(o,"string")&&(f.convId=o),this.eventDispatchMgr("error",f)},this.createReceiveIMMessageEvent=function(C,S,n,v,R,p){var o={eventType:"receiveIMMessage",time:new Date,senderId:C,senderNickname:S,senderPhotoURL:n,message:v,UUCSeq:R,convId:p};this.eventDispatchMgr("receiveIMMessage",o)},this.createChannelEvent=function(C,S){var n={eventType:"channelEvent",time:new Date,channelEvent:C,event:S};this.eventDispatchMgr("channelEvent",n)},this.createSessionReadyEvent=function(C){w.debug("createSessionReadyEvent");var S={eventType:"sessionReady",time:new Date,apiCCId:C};this.eventDispatchMgr("sessionReady",S)},this.createWebRTCClientCreatedEvent=function(){var C={eventType:"webRTCClientCreated",time:new Date};this.eventDispatchMgr("webRTCClientCreated",C)},this.createUpdatePresenceEvent=function(C,S,n){var v={eventType:"updatePresence",time:new Date,connectedUsersList:C,connectedUsersListWithStatus:n,state:S};this.eventDispatchMgr("updatePresence",v)},this.createCloudEventOccurredEvent=function(C,S){var n={eventType:"cloudEventOccurred",time:new Date,topic:C,target:S};this.eventDispatchMgr("cloudEventOccurred",n)},this.createUpdateUserStatusEvent=function(C){var S={eventType:"updateUserStatus",time:new Date,message:C};this.eventDispatchMgr("updateUserStatus",S)},this.createGroupChatCreationEvent=function(C,S,n,v,R,p){var o={eventType:"groupChatCreation",time:new Date,status:C,groupChatId:S,initialDestId:n,invitationSendedToInitialDestId:v,newContactId:R,invitationSendedToNewContactId:p};this.eventDispatchMgr("groupChatCreation",o)},this.createGroupChatInvitationEvent=function(C,S,n,v,R){var p={eventType:"groupChatInvitation",time:new Date,groupChatId:C,contactList:R,senderId:S,senderNickname:n,senderPhotoURL:v};this.eventDispatchMgr("groupChatInvitation",p)},this.createGroupChatMemberUpdateEvent=function(C,S,n){var v={eventType:"groupChatMemberUpdate",time:new Date,groupChatId:C,contactList:S,status:n};this.eventDispatchMgr("groupChatMemberUpdate",v)},this.createAddUserInGroupChatEvent=function(C,S,n){var v={eventType:"addUserInGroupChatAnswer",time:new Date,invitationSended:C,groupChatId:S,contactId:n};this.eventDispatchMgr("addUserInGroupChatAnswer",v)},this.createReceiveGroupChatMessageEvent=function(C,S,n,v,R){var p={eventType:"receiveGroupChatMessage",time:new Date,groupChatId:C,senderId:S,senderNickname:n,message:v};(0,d.Ym)(R,"object")&&(p.metadata=R),this.eventDispatchMgr("receiveGroupChatMessage",p)},this.createReceiveConversationListAnswerEvent=function(C){var S={eventType:"receiveConversationList",time:new Date,convList:C};this.eventDispatchMgr("receiveConversationList",S)},this.createReceiveContactOccurrencesFromConversationListAnswerEvent=function(C){var S={eventType:"receiveContactOccurrencesFromConversationList",time:new Date,occurrencesList:C};this.eventDispatchMgr("receiveContactOccurrencesFromConversationList",S)},this.createReceiveConversationDetailReportAnswerEvent=function(C){var S={eventType:"receiveConversationDetailReport",time:new Date,CDR:C};this.eventDispatchMgr("receiveConversationDetailReport",S)},this.createReceiveConversationHistoryEvent=function(C,S,n){var v={eventType:"receiveConversationHistory",time:new Date,convId:C,convHistory:S,status:n};this.eventDispatchMgr("receiveConversationHistory",v)},this.createUserDataAnswerEvent=function(C,S,n,v){var R={eventType:"userDataAnswer",time:new Date,userFound:C,contactId:S,nickname:n,photoURL:v};this.eventDispatchMgr("userDataAnswer",R)},this.createReceiveDataEvent=function(C,S,n){var v={eventType:"receiveData",time:new Date,senderId:C,dstRoomId:S,data:n};this.eventDispatchMgr("receiveData",v)},this.createMCUSessionCreationEvent=function(C,S){var n={eventType:"MCUSessionCreation",time:new Date,sessionId:C,token:S};this.eventDispatchMgr("MCUSessionCreation",n)},this.createJoinMCUSessionAnswerEvent=function(C,S,n,v,R){var p={eventType:"joinMCUSessionAnswer",time:new Date,sessionId:C,token:S,groupChatId:n,initiator:v,roomId:R.roomName};R.roomMode&&(p.mode=R.roomMode),!0===R.meshOnly&&(p.meshOnly=!0),R.joinSessionAnswer&&(p.result=Object.assign({},R.joinSessionAnswer)),this.eventDispatchMgr("joinMCUSessionAnswer",p)},this.createMCUAvailableStreamEvent=function(C,S){var n={eventType:"MCUAvailableStream",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableStream",n)},this.createMCUAvailableReplayEvent=function(C,S){var n={eventType:"MCUAvailableReplay",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableReplay",n)},this.createMCUAvailableCompositeEvent=function(C,S){var n={eventType:"MCUAvailableComposite",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableComposite",n)},this.createMCURemovedStreamEvent=function(C){var S={eventType:"MCURemoveStream",time:new Date,streamId:C};this.eventDispatchMgr("MCURemoveStream",S)},this.createMCUAvailableStreamUpdateEvent=function(C,S){var n={eventType:"MCUAvailableStreamUpdate",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableStreamUpdate",n)},this.createMCUParticipantEjectedEvent=function(C,S,n){var v={eventType:"MCUParticipantEjected",time:new Date,roomId:C,clientId:S};n&&(v.data=n),this.eventDispatchMgr("MCUParticipantEjected",v)},this.createReceiveMCUSessionInvitationEvent=function(C,S,n,v){void 0===n&&(n=0);var R={eventType:"receiveMCUSessionInvitation",time:new Date,sessionId:C,token:S,groupChatId:n,initiatorId:v};this.eventDispatchMgr("receiveMCUSessionInvitation",R)},this.createRemoteStreamAddedEvent=function(C,S,n,v,R,p,o){var f={eventType:"remoteStreamAdded",time:new Date,callId:S,callType:C,stream:n,remoteId:v,destCallType:R,audioIsAvailable:p.available,audioIsActive:p.active,audioIsMuted:p.muted,videoIsAvailable:o.available,videoIsActive:o.active,videoIsMuted:o.muted};this.eventDispatchMgr("remoteStreamAdded",f)},this.createRemoteStreamRemovedEvent=function(C,S,n,v,R){var p={eventType:"remoteStreamRemoved",time:new Date,callId:S,callType:C,stream:n,remoteId:v,destCallType:R};this.eventDispatchMgr("remoteStreamRemoved",p)},this.createSimulcastFeedChanged=function(C,S){var n={eventType:"simulcastFeedChanged",time:new Date,callId:C,simulcast:S};this.eventDispatchMgr("simulcastFeedChanged",n)},this.createLocalStreamRemovedEvent=function(C,S,n,v,R){var p={eventType:"localStreamRemoved",time:new Date,callId:S,callType:C,stream:n,remoteId:v,destCallType:R};this.eventDispatchMgr("localStreamRemoved",p)},this.createSlowLinkEvent=function(C,S){var n={eventType:"slowLink",time:new Date,callId:C};S&&(n.advice=S),this.eventDispatchMgr("slowLink",n)},this.createVideoQualityChangedEvent=function(C,S,n,v){var R={eventType:"videoQualityChanged",time:new Date,roomname:S,callId:C,hint:n,profileType:v.name};v.bitrate&&(R.bitrate=v.bitrate),v.width&&v.height&&(R.width=v.width,R.height=v.height),v.frameRate&&(R.frameRate=v.frameRate),this.eventDispatchMgr("videoQualityChanged",R)},this.createAudioAmplitudeEvent=function(C,S,n,v){var R={eventType:"audioAmplitude",time:new Date,callId:n,userMediaStreamId:v,descriptor:{amplitude:C,isSpeaking:S}};this.eventDispatchMgr("audioAmplitude",R)},this.createLocalStreamUpdatedEvent=function(C,S,n,v,R,p,o,f,I){var l={eventType:"localStreamUpdated",time:new Date,changeList:C,audioIsAvailable:S.available,audioDeviceLabel:S.deviceLabel,audioIsActive:S.active,audioIsMuted:S.muted,videoIsAvailable:n.available,videoDeviceLabel:n.deviceLabel,videoIsActive:n.active,videoIsMuted:n.muted,onCall:v,callType:R,callId:p,stream:o,userMediaStreamId:f,cause:I};this.eventDispatchMgr("localStreamUpdated",l)},this.createRemoteStreamUpdatedEvent=function(C,S,n,v,R,p){var o={eventType:"remoteStreamUpdated",time:new Date,changeList:C,audioIsAvailable:S.available,audioIsActive:S.active,audioIsMuted:S.muted,videoIsAvailable:n.available,videoIsActive:n.active,videoIsMuted:n.muted,callType:v,callId:R,cause:p};this.eventDispatchMgr("remoteStreamUpdated",o)},this.createCanPlayRemoteVideoEvent=function(C,S,n){var v={eventType:"canPlayRemoteVideo",time:new Date,videoDivId:C,callType:S,remoteId:n};this.eventDispatchMgr("canPlayRemoteVideo",v)},this.createRecordedFileAvailableEvent=function(C){var S={eventType:"recordedFileAvailable",time:new Date,fileName:C};this.eventDispatchMgr("recordedFileAvailable",S)},this.createRecordedStreamsAvailableEvent=function(C,S,n,v,R,p,o){var f={eventType:"recordedStreamsAvailable",time:new Date,confId:C,userId1:S,userId2:n,callId:v,apiKey:apiCC.session.apiKey};R&&(f.convId=R),p&&(f.mediaId=p),o&&(f.mediaURL=o),this.eventDispatchMgr("recordedStreamsAvailable",f)},this.createMCURecordedStreamsAvailableEvent=function(C,S,n,v,R,p,o,f,I,l,V){var T={eventType:"MCURecordedStreamsAvailable",time:new Date,roomName:C,callId:S,clientId:n,convId:R,mediaId:p,mediaURL:o,recordType:f};I&&(T.remoteId=I),v&&(T.recordedFileName=v),l&&(T.mediaType=l),(0,d.Ym)(V,"object")?(T.descriptor={},(0,d.Ym)(V,"mode","string")&&(T.descriptor.mode=V.mode),(0,d.Ym)(V,"labelEnabled","boolean")&&(T.descriptor.labelEnabled=V.labelEnabled),!0===T.descriptor.labelEnabled&&(0,d.Ym)(V,"labels","array")&&(T.descriptor.labels=V.labels)):T.descriptor={mode:"complete",labelEnabled:!1},this.eventDispatchMgr("MCURecordedStreamsAvailable",T)},this.createMCURecordingStartedEvent=function(C,S,n,v,R,p,o,f,I,l,V,T){var b={eventType:"MCURecordingStarted",time:new Date,roomName:C,callId:S,clientId:n,recordType:v,recordStartTime:R};p&&(b.convId=p),o&&(b.mediaId=o),f&&(b.mediaURL=f),I&&(b.remoteId=I),l&&(b.recordedFileName=l),V&&(b.mediaType=V),(0,d.Ym)(T,"object")&&(b.descriptor={},(0,d.Ym)(T,"mode","string")&&(b.descriptor.mode=T.mode),(0,d.Ym)(T,"labelEnabled","boolean")&&(b.descriptor.labelEnabled=T.labelEnabled),!0===b.descriptor.labelEnabled&&(0,d.Ym)(T,"labels","array")&&(b.descriptor.labels=T.labels)),this.eventDispatchMgr("MCURecordingStarted",b)},this.createMCURecordingStoppedEvent=function(C,S,n,v,R,p,o,f,I,l,V,T){var b={eventType:"MCURecordingStopped",time:new Date,roomName:C,callId:S,clientId:n,recordType:v,recordStartTime:R};p&&(b.convId=p),o&&(b.mediaId=o),f&&(b.mediaURL=f),I&&(b.remoteId=I),l&&(b.recordedFileName=l),V&&(b.mediaType=V),(0,d.Ym)(T,"object")&&(b.descriptor={},(0,d.Ym)(T,"mode","string")&&(b.descriptor.mode=T.mode),(0,d.Ym)(T,"labelEnabled","boolean")&&(b.descriptor.labelEnabled=T.labelEnabled),!0===b.descriptor.labelEnabled&&(0,d.Ym)(T,"labels","array")&&(b.descriptor.labels=T.labels)),this.eventDispatchMgr("MCURecordingStopped",b)},this.createStopRecordEvent=function(){var C={eventType:"stopRecord",time:new Date};this.eventDispatchMgr("stopRecord",C)},this.createMCUStreamingStartedEvent=function(C,S,n,v){var R={eventType:"MCUStreamingStarted",time:new Date,roomName:C,callId:S,clientId:n,streamingStartTime:v};this.eventDispatchMgr("MCUStreamingStarted",R)},this.createMCUStreamingStoppedEvent=function(C,S,n,v){var R={eventType:"MCUStreamingStopped",time:new Date,roomName:C,callId:S,clientId:n,streamingEndTime:v};this.eventDispatchMgr("MCUStreamingStopped",R)},this.createMCURoomModeChangedEvent=function(C,S,n,v){var R={eventType:"MCURoomModeChanged",time:new Date,roomId:C,oldMode:S,newMode:n,state:v};this.eventDispatchMgr("MCURoomModeChanged",R)},this.createSnapShotPhotoUploaded=function(C){var S={eventType:"snapShotPhotoUploaded",time:new Date,fileName:C};this.eventDispatchMgr("snapShotPhotoUploaded",S)},this.createRoomCreationEvent=function(C,S,n){var v={eventType:"roomCreation",time:new Date,status:C,roomId:S,roomType:n};this.eventDispatchMgr("roomCreation",v)},this.createRoomJoinedEvent=function(C,S,n){var v={eventType:"roomJoined",time:new Date,status:C,roomId:S,roomType:n};this.eventDispatchMgr("roomJoined",v)},this.createRoomInvitationEvent=function(C,S,n,v,R,p){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},f="roomInvitation",I={eventType:"roomInvitation",time:new Date,roomId:C,contactList:R,senderId:S,senderNickname:n,senderPhotoURL:v,roomType:p};o.cloudConvId&&(I.cloudConvId=o.cloudConvId),!0===o.webconf&&(I.webconf=!0),this.eventDispatchMgr(f,I)},this.createRoomMemberUpdateEvent=function(C,S,n,v){var R={eventType:"roomMemberUpdate",time:new Date,roomId:C,contactList:S,status:n,roomType:v};this.eventDispatchMgr("roomMemberUpdate",R)},this.createContactListInRoomEvent=function(C,S,n){var v={eventType:"contactListInRoom",time:new Date,roomId:C,contactList:S,roomType:n};this.eventDispatchMgr("contactListInRoom",v)},this.createReceiveRoomMessageEvent=function(C,S,n,v,R){var p={eventType:"receiveRoomMessage",time:new Date,roomId:C,senderId:S,senderNickname:n,message:v,roomType:R};this.eventDispatchMgr("receiveRoomMessage",p)},this.createDesktopCaptureEvent=function(C,S,n){var v={eventType:"desktopCapture",time:new Date,event:C,callId:S,remoteId:n};this.eventDispatchMgr("desktopCapture",v)},this.createMediaDeviceChangedEvent=function(C,S,n){var v="NotDefined";null!=S&&(v=S);var R={eventType:"mediaDeviceChanged",time:new Date,diff:C,updateReason:v,firstMediaDeviceListInitialization:n};this.eventDispatchMgr("mediaDeviceChanged",R)},this.createSwitchStreamEvent=function(C,S){var n={eventType:"switchStream",time:new Date,callId:C,stream:S};this.eventDispatchMgr("switchStream",n)},this.createConnectedUsersListUpdateEvent=function(C,S,n,v){var R={eventType:"ConnectedUsersListUpdate",time:new Date,group:C,usersList:S,status:n,updateReason:v};this.eventDispatchMgr("connectedUsersListUpdate",R)},this.createClosingWhiteBoardEvent=function(C,S){var n={eventType:"closingWhiteBoard",time:new Date,roomId:C,reason:S};this.eventDispatchMgr("closingWhiteBoard",n)},this.createExternalJsLoadingStatusEvent=function(C,S){var n={eventType:"externalJsLoadingStatus",extjs:C,status:S,time:new Date};this.eventDispatchMgr("externalJsLoadingStatus",n)},this.createBackgroundSubstractionStopVisibilityChangeEvent=function(C){this.eventDispatchMgr("backgroundSubstractionStopVisibilityChange",{userMediaStreamId:C})},this.createBackgroundSubstractionStopComputeTimeEvent=function(C){this.eventDispatchMgr("backgroundSubstractionStopComputeTime",{userMediaStreamId:C})},this.createAIESnapshotEvent=function(C,S){this.eventDispatchMgr("AIESnapshot",{userMediaStreamId:C,image:S})},this.createAIELogEvent=function(C,S){this.eventDispatchMgr("AIELog",{userMediaStreamId:C,log:S})},this.createEvent=function(C){if(!C.eventType)throw new Error("The event json must have an eventType"+C);C.time=new Date,this.eventDispatchMgr(C.eventType,C)}}},940:(F,Y,e)=>{"use strict";e.d(Y,{S:()=>L}),e(2772);var i=e(1549),c=e(5945),d=i.Y.get("WebRTC_Stack"),L=function(w){this.sendInvite=function(A,C,S,n,v,R,p,o,f){d.debug("WebRTC_Stack::sendInvite()");var I,l=null,V=null;null==p&&(p="media"),null===f&&(f=void 0),("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&(d.log("JSON.stringify(offer.sdp) :"+JSON.stringify(R.sdp)),d.log("JSON.stringify(offer.type) :"+JSON.stringify(R.type)),(V={}).sdp=R.sdp,V.type=R.type,R=V),null!==o?(d.log("call data is defined :"+o),l={type:"invite",callId:A,callerId:C,callerNickname:S,calleeId:n,roomId:v,sdpoffer:R,callType:p,data:o,stream:f}):(d.log("call data is undefined"),l={type:"invite",callId:A,callerId:C,callerNickname:S,calleeId:n,roomId:v,sdpoffer:R,callType:p}),I=JSON.stringify(l),d.info("C->S: "+I),w.emit("invite",I)},this.sendInviteBroadcast=function(A,C,S,n,v,R){var o;d.debug("WebRTC_Stack::sendInviteBroadcast()"),o=JSON.stringify({type:"invite",callId:A,callerId:C,callerNickname:S,calleeId:n,roomId:v,sdpoffer:R}),d.debug("C->S: "+o),w.emit("invite_broadcast",o)},this.send200OK=function(A,C,S,n,v,R,p){d.debug("WebRTC_Stack::send200OK()");var f,I=null;("IE"===c.Xh||"Safari"===c.Xh&&c.PR<11)&&(d.log("JSON.stringify(offer.sdp) :"+JSON.stringify(R.sdp)),d.log("JSON.stringify(offer.type) :"+JSON.stringify(R.type)),(I={}).sdp=R.sdp,I.type=R.type,R=I),f=JSON.stringify({type:"200OK",callId:A,callerId:C,calleeId:S,calleeNickname:n,roomId:v,sdpanswer:R,data:p}),d.info("C->S: "+f),w.emit("200OK",f)},this.sendCandidate=function(A,C,S,n,v,R,p,o,f,I){d.debug("WebRTC_Stack::sendCandidate()");var l,V=null,T={};d.debug("completeCandidate :",I),"IE"===c.Xh?(d.log("Browser is IE, adapting completeCandidate"),T.sdpMLineIndex=I.sdpMLineIndex,T.candidate=I.candidate,T.sdpMid=I.sdpMid):T=I,null!==f?(d.log("call data is defined :",f),V={type:"candidate",callId:A,callerId:C,calleeId:S,roomId:n,dst:v,label:R,id:p,candidate:o,data:f,completeCandidate:T}):(d.log("call data is undefined"),V={type:"candidate",callId:A,callerId:C,calleeId:S,roomId:n,dst:v,label:R,id:p,candidate:o,completeCandidate:T}),l=JSON.stringify(V),w.emit("candidate",l),d.info("C->S: "+l)},this.sendBye=function(A,C,S,n,v,R){d.debug("WebRTC_Stack::sendBye()");var p,o=null;null!==R?(d.log("call data is defined :"+R),o={type:"bye",callId:A,clientId:C,roomId:S,dst:n,reason:v,data:R}):(d.log("call data is undefined"),o={type:"bye",callId:A,clientId:C,roomId:S,dst:n,reason:v}),p=JSON.stringify(o),d.info("C->S: "+p),w.emit("bye",p)},this.sendUpdate=function(A,C,S,n,v,R,p,o){d.debug("WebRTC_Stack::sendUpdate()");var f,I=null;I={type:"update",callId:A,callerId:C,calleeId:S,roomId:n,dst:v,sdpoffer:R,callType:p},null!=o&&(d.log("call data is defined: "+o),I.data=o),f=JSON.stringify(I),d.info("C->S: "+f),w.emit("update",f)},this.send200Update=function(A,C,S,n,v,R,p){d.debug("WebRTC_Stack::send200Update()");var o,f=null;null!==p?(d.log("call data is defined :"+p),f={type:"200update",callId:A,callerId:C,calleeId:S,roomId:n,dst:v,sdpanswer:R,data:p}):(d.log("call data is undefined"),f={type:"200update",callId:A,callerId:C,calleeId:S,roomId:n,dst:v,sdpanswer:R}),o=JSON.stringify(f),d.info("C->S: "+o),w.emit("200update",o)},this.sendDebugCommand=function(A,C,S){var v;d.debug("WebRTC_Stack::sendDebugCommand :"+A),v=JSON.stringify({type:"debugCommand",command:A,apiKey:C,clientId:S}),d.info("C->S: "+v),w.emit("debugCommand",v)},this.sendAck=function(A,C,S){var v;d.debug("WebRTC_Stack::sendAck()"),v=JSON.stringify({type:"Ack",AckMessageType:A,cSeq:C,dst:S}),d.info("C->S: "+v),w.emit("Ack",v)},this.sendInfo=function(A,C){var n,v=["activeSpeaker","callStats","stopSpeaking"];v.indexOf(A)<0&&d.debug("WebRTC_Stack::sendInfo()"),n=JSON.stringify({type:"info",infoType:A,data:C}),v.indexOf(A)<0&&d.info("C->S: "+n),w.emit("info",n)},this.sendDataMessage=function(A,C){d.debug("WebRTC_Stack::sendDataMessage()");var n=JSON.stringify({type:"apiRTCDataMessage",senderId:A,data:C});d.info("C->S: "+n),w.emit("apiRTCDataMessage",n)}}},2746:(F,Y,e)=>{"use strict";e.r(Y);var i=e(1549).Y.get("onbeforeunload");apiCC.beforeUnloadFct=function(c){i.debug("User has refreshed or left the page, eventType :",c);try{if("undefined"!=typeof mailClicked&&null!==mailClicked&&(i.log("mailClicked variable is defined"),!0===mailClicked))return i.log("mailClicked is true : leaving onbeforeunload"),void(mailClicked=!1)}catch(d){i.log("Catch error on PATCH/WORKAROUND to avoid reload of page in chrome when mailto :"+d)}try{if(void 0!==apiCC.iePluginInstallationPreventUnload&&null!==apiCC.iePluginInstallationPreventUnload&&!0===apiCC.iePluginInstallationPreventUnload)return void i.log("iePluginInstallationPreventUnload is true : leaving onbeforeunload")}catch(d){i.log("Catch error on PATCH/WORKAROUND to avoid reload of page in IE when installing webRTC plugin :"+d)}null!=apiCC&&(apiCC.storeSessionCookies(),apiCC.cleanApiRTCContext(),apiCC.disconnect({invalidateApiCCId:!0}),apiCC.cleanAllEventListener(),apiCC.myEventTable=[]),null!=apiCC&&(apiCC.session=null,apiCC.jsLoaded=!1)},"Mobile Safari"===apiRTC.browser?window.addEventListener("pagehide",function(){apiCC.beforeUnloadFct("unload_MobileSafari")}):window.onbeforeunload=function(){apiCC.beforeUnloadFct("unload")}},9064:(F,Y,e)=>{"use strict";function i(c){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&"function"==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}e(2222),e(2772),e(4916),e(3123),e(5306),e(3210),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948),F=e.hmd(F),function(c){var d="function",L="undefined",w="object",A="model",C="name",S="type",n="vendor",v="version",R="architecture",p="console",o="mobile",f="tablet",I="smarttv",l="wearable",V={extend:function(be,de){var ce={};for(var Ee in be)ce[Ee]=de[Ee]&&de[Ee].length%2==0?de[Ee].concat(be[Ee]):be[Ee];return ce},has:function(be,de){return"string"==typeof be&&-1!==de.toLowerCase().indexOf(be.toLowerCase())},lowerize:function(be){return be.toLowerCase()},major:function(be){return"string"===i(be)?be.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(be){return be.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},T={rgx:function(be,de){for(var ce,Ee,Ne,Oe,He,ke,ze=0;ze<de.length&&!He;){var we=de[ze],gt=de[ze+1];for(ce=Ee=0;ce<we.length&&!He;)if(He=we[ce++].exec(be))for(Ne=0;Ne<gt.length;Ne++)ke=He[++Ee],i(Oe=gt[Ne])===w&&Oe.length>0?2==Oe.length?this[Oe[0]]=i(Oe[1])==d?Oe[1].call(this,ke):Oe[1]:3==Oe.length?this[Oe[0]]=i(Oe[1])!==d||Oe[1].exec&&Oe[1].test?ke?ke.replace(Oe[1],Oe[2]):void 0:ke?Oe[1].call(this,ke,Oe[2]):void 0:4==Oe.length&&(this[Oe[0]]=ke?Oe[3].call(this,ke.replace(Oe[1],Oe[2])):void 0):this[Oe]=ke||void 0;ze+=2}},str:function(be,de){for(var ce in de)if(i(de[ce])===w&&de[ce].length>0){for(var Ee=0;Ee<de[ce].length;Ee++)if(V.has(de[ce][Ee],be))return"?"===ce?void 0:ce}else if(V.has(de[ce],be))return"?"===ce?void 0:ce;return be}},b={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},H={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[C,v],[/(opios)[\/\s]+([\w\.]+)/i],[[C,"Opera Mini"],v],[/\s(opr)\/([\w\.]+)/i],[[C,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[C,v],[/(konqueror)\/([\w\.]+)/i],[[C,"Konqueror"],v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[C,"IE"],v],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[C,"Edge"],v],[/(yabrowser)\/([\w\.]+)/i],[[C,"Yandex"],v],[/(Avast)\/([\w\.]+)/i],[[C,"Avast Secure Browser"],v],[/(AVG)\/([\w\.]+)/i],[[C,"AVG Secure Browser"],v],[/(puffin)\/([\w\.]+)/i],[[C,"Puffin"],v],[/(focus)\/([\w\.]+)/i],[[C,"Firefox Focus"],v],[/(opt)\/([\w\.]+)/i],[[C,"Opera Touch"],v],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[C,"UCBrowser"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[C,/_/g," "],v],[/(windowswechat qbcore)\/([\w\.]+)/i],[[C,"WeChat(Win) Desktop"],v],[/(micromessenger)\/([\w\.]+)/i],[[C,"WeChat"],v],[/(brave)\/([\w\.]+)/i],[[C,"Brave"],v],[/(qqbrowserlite)\/([\w\.]+)/i],[C,v],[/(QQ)\/([\d\.]+)/i],[C,v],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[C,v],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[C,v],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[C,v],[/(MetaSr)[\/\s]?([\w\.]+)/i],[C],[/(LBBROWSER)/i],[C],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[C,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[v,[C,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[C,v],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[v,[C,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[C,/(.+)/,"$1 WebView"],v],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[C,/(.+(?:g|us))(.+)/,"$1 $2"],v],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[v,[C,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[C,"Sailfish Browser"],v],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[C,v],[/(dolfin)\/([\w\.]+)/i],[[C,"Dolphin"],v],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[C,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[C,"Chrome"],v],[/(coast)\/([\w\.]+)/i],[[C,"Opera Coast"],v],[/fxios\/([\w\.-]+)/i],[v,[C,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[C,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,C],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[C,"GSA"],v],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[C,[v,T.str,b.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[C,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[C,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[C,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[R,"amd64"]],[/(ia32(?=;))/i],[[R,V.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[R,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[R,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[R,/ower/,"",V.lowerize]],[/(sun4\w)[;\)]/i],[[R,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[R,V.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[A,n,[S,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[A,[n,"Apple"],[S,f]],[/(apple\s{0,1}tv)/i],[[A,"Apple TV"],[n,"Apple"],[S,I]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[n,A,[S,f]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[A,[n,"Amazon"],[S,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[A,T.str,b.device.amazon.model],[n,"Amazon"],[S,o]],[/android.+aft([bms])\sbuild/i],[A,[n,"Amazon"],[S,I]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[A,n,[S,o]],[/\((ip[honed|\s\w*]+);/i],[A,[n,"Apple"],[S,o]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[n,A,[S,o]],[/\(bb10;\s(\w+)/i],[A,[n,"BlackBerry"],[S,o]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[A,[n,"Asus"],[S,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[n,"Sony"],[A,"Xperia Tablet"],[S,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[A,[n,"Sony"],[S,o]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[n,A,[S,p]],[/android.+;\s(shield)\sbuild/i],[A,[n,"Nvidia"],[S,p]],[/(playstation\s[34portablevi]+)/i],[A,[n,"Sony"],[S,p]],[/(sprint\s(\w+))/i],[[n,T.str,b.device.sprint.vendor],[A,T.str,b.device.sprint.model],[S,o]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[n,[A,/_/g," "],[S,o]],[/(nexus\s9)/i],[A,[n,"HTC"],[S,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[A,[n,"Huawei"],[S,o]],[/android.+(bah2?-a?[lw]\d{2})/i],[A,[n,"Huawei"],[S,f]],[/(microsoft);\s(lumia[\s\w]+)/i],[n,A,[S,o]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[A,[n,"Microsoft"],[S,p]],[/(kin\.[onetw]{3})/i],[[A,/\./g," "],[n,"Microsoft"],[S,o]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[A,[n,"Motorola"],[S,o]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[A,[n,"Motorola"],[S,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[n,V.trim],[A,V.trim],[S,I]],[/hbbtv.+maple;(\d+)/i],[[A,/^/,"SmartTV"],[n,"Samsung"],[S,I]],[/\(dtv[\);].+(aquos)/i],[A,[n,"Sharp"],[S,I]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[n,"Samsung"],A,[S,f]],[/smart-tv.+(samsung)/i],[n,[S,I],A],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[n,"Samsung"],A,[S,o]],[/sie-(\w*)/i],[A,[n,"Siemens"],[S,o]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[n,"Nokia"],A,[S,o]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[A,[n,"Acer"],[S,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[A,[n,"LG"],[S,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[n,"LG"],A,[S,f]],[/(lg) netcast\.tv/i],[n,A,[S,I]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[A,[n,"LG"],[S,o]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[n,A,[S,f]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[A,[n,"Lenovo"],[S,f]],[/(lenovo)[_\s-]?([\w-]+)/i],[n,A,[S,o]],[/linux;.+((jolla));/i],[n,A,[S,o]],[/((pebble))app\/[\d\.]+\s/i],[n,A,[S,l]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[n,A,[S,o]],[/crkey/i],[[A,"Chromecast"],[n,"Google"],[S,I]],[/android.+;\s(glass)\s\d/i],[A,[n,"Google"],[S,l]],[/android.+;\s(pixel c)[\s)]/i],[A,[n,"Google"],[S,f]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[A,[n,"Google"],[S,o]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[A,/_/g," "],[n,"Xiaomi"],[S,o]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[A,/_/g," "],[n,"Xiaomi"],[S,f]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[A,[n,"Meizu"],[S,o]],[/(mz)-([\w-]{2,})/i],[[n,"Meizu"],A,[S,o]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[A,[n,"OnePlus"],[S,o]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[A,[n,"RCA"],[S,f]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[A,[n,"Dell"],[S,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[A,[n,"Verizon"],[S,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[n,"Barnes & Noble"],A,[S,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[A,[n,"NuVision"],[S,f]],[/android.+;\s(k88)\sbuild/i],[A,[n,"ZTE"],[S,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[A,[n,"Swiss"],[S,o]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[A,[n,"Swiss"],[S,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[A,[n,"Zeki"],[S,f]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[n,"Dragon Touch"],A,[S,f]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[A,[n,"Insignia"],[S,f]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[A,[n,"NextBook"],[S,f]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[n,"Voice"],A,[S,o]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[n,"LvTel"],A,[S,o]],[/android.+;\s(PH-1)\s/i],[A,[n,"Essential"],[S,o]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[A,[n,"Envizen"],[S,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[n,A,[S,f]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[A,[n,"MachSpeed"],[S,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[n,A,[S,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[A,[n,"Rotor"],[S,f]],[/android.+(KS(.+))\s+build/i],[A,[n,"Amazon"],[S,f]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[n,A,[S,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[S,V.lowerize],n,A],[/[\s\/\(](smart-?tv)[;\)]/i],[[S,I]],[/(android[\w\.\s\-]{0,9});.+build/i],[A,[n,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[C,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[C,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[C,v],[/rv\:([\w\.]{1,9}).+(gecko)/i],[v,C]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[C,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[C,[v,T.str,b.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[C,"Windows"],[v,T.str,b.os.windows.version]],[/\((bb)(10);/i],[[C,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[C,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[C,"Symbian"],v],[/\((series40);/i],[C],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[C,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[C,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[C,"Chromium OS"],v],[/(sunos)\s?([\w\.\d]*)/i],[[C,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[C,v],[/(haiku)\s(\w+)/i],[C,v],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[v,/_/g,"."],[C,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[C,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[C,v]]},ne=function be(de,ce){if("object"===i(de)&&(ce=de,de=void 0),!(this instanceof be))return new be(de,ce).getResult();var Ee=de||(c&&c.navigator&&c.navigator.userAgent?c.navigator.userAgent:""),Ne=ce?V.extend(H,ce):H;return this.getBrowser=function(){var Oe={name:void 0,version:void 0};return T.rgx.call(Oe,Ee,Ne.browser),Oe.major=V.major(Oe.version),Oe},this.getCPU=function(){var Oe={architecture:void 0};return T.rgx.call(Oe,Ee,Ne.cpu),Oe},this.getDevice=function(){var Oe={vendor:void 0,model:void 0,type:void 0};return T.rgx.call(Oe,Ee,Ne.device),Oe},this.getEngine=function(){var Oe={name:void 0,version:void 0};return T.rgx.call(Oe,Ee,Ne.engine),Oe},this.getOS=function(){var Oe={name:void 0,version:void 0};return T.rgx.call(Oe,Ee,Ne.os),Oe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ee},this.setUA=function(Oe){return Ee=Oe,this},this};ne.VERSION="0.7.21",ne.BROWSER={NAME:C,MAJOR:"major",VERSION:v},ne.CPU={ARCHITECTURE:R},ne.DEVICE={MODEL:A,VENDOR:n,TYPE:S,CONSOLE:p,MOBILE:o,SMARTTV:I,TABLET:f,WEARABLE:l,EMBEDDED:"embedded"},ne.ENGINE={NAME:C,VERSION:v},ne.OS={NAME:C,VERSION:v},("undefined"==typeof exports?"undefined":i(exports))!==L?(i(F)!==L&&F.exports&&(exports=F.exports=ne),exports.UAParser=ne,c.UAParser=ne):"function"==typeof define&&e.amdO?define(function(){return ne}):c&&(c.UAParser=ne);var le=c&&(c.jQuery||c.Zepto);if(le&&!le.ua){var W=new ne;le.ua=W.getResult(),le.ua.get=function(){return W.getUA()},le.ua.set=function(be){W.setUA(be);var de=W.getResult();for(var ce in de)le.ua[ce]=de[ce]}}}("object"===("undefined"==typeof window?"undefined":i(window))?window:void 0)},4918:(F,Y,e)=>{"use strict";e.r(Y),e.d(Y,{Call:()=>yi,CloudApi:()=>lo,Conference:()=>ar,Contact:()=>Ei,Conversation:()=>Gt,ConversationCall:()=>Va,DataChannel:()=>Jn,Enterprise:()=>dr,EventCenter:()=>b,EventEmitter:()=>w,MediaDevice:()=>le,Observable:()=>Ne,PointerSharingRoom:()=>Sr,ReceivedCallInvitation:()=>Pi,ReceivedConversationInvitation:()=>ye,ReceivedConversationJoinRequest:()=>Vn,ReceivedDataChannelInvitation:()=>hn,ReceivedFileTransferInvitation:()=>Tn,ReceivedInvitation:()=>m,ReceivedPointerSharingInvitation:()=>Z,ReceivedWhiteboardInvitation:()=>Bt,SentInvitation:()=>St,Session:()=>Ii,Stream:()=>wn,UserAgent:()=>oo,UserData:()=>ot,default:()=>is}),e(7941),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(3173);function c(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function d(D){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}e(4603),e(4916),e(9714),e(7042),e(561),e(9070),e(8309),e(1038),e(9753);var w=function(){function D(){!function(E,U){if(!(E instanceof U))throw new TypeError("Cannot call a class as a function")}(this,D)}var B;return B=[{key:"getListeners",value:function(E){var U,ae,pe=this._getEvents();if(E instanceof RegExp)for(ae in U={},pe)pe.hasOwnProperty(ae)&&E.test(ae)&&(U[ae]=pe[ae]);else U=pe[E]||(pe[E]=[]);return U}},{key:"flattenListeners",value:function(E){var U,ae=[];for(U=0;U<E.length;U+=1)ae.push(E[U].listener);return ae}},{key:"getListenersAsObject",value:function(E){var U,ae=this.getListeners(E);return ae instanceof Array&&((U={})[E]=ae),U||ae}},{key:"emit",value:function(E){var U=Array.prototype.slice.call(arguments,1);return this.emitEvent(E,U)}},{key:"addListener",value:function(E,U){if(!n(U))throw new TypeError("listener must be a function");var ae,pe=this.getListenersAsObject(E),G="object"===d(U);for(ae in pe)pe.hasOwnProperty(ae)&&-1===C(pe[ae],U)&&pe[ae].push(G?U:{listener:U,once:!1});if("contactListUpdate"===E){apiRTC.userAgentInstance.currentSession.contactListUpdateListenerSetted=!0;var r,s=function(ee,te){var $="undefined"!=typeof Symbol&&ee[Symbol.iterator]||ee["@@iterator"];if(!$){if(Array.isArray(ee)||($=function(kt,Ut){if(kt){if("string"==typeof kt)return c(kt,void 0);var fi=Object.prototype.toString.call(kt).slice(8,-1);return"Object"===fi&&kt.constructor&&(fi=kt.constructor.name),"Map"===fi||"Set"===fi?Array.from(kt):"Arguments"===fi||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(fi)?c(kt,void 0):void 0}}(ee))){$&&(ee=$);var ue=0,Ie=function(){};return{s:Ie,n:function(){return ue>=ee.length?{done:!0}:{done:!1,value:ee[ue++]}},e:function(kt){throw kt},f:Ie}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Ue,vt=!0,pt=!1;return{s:function(){$=$.call(ee)},n:function(){var kt=$.next();return vt=kt.done,kt},e:function(kt){pt=!0,Ue=kt},f:function(){try{vt||null==$.return||$.return()}finally{if(pt)throw Ue}}}}(apiRTC.userAgentInstance.currentSession.waitingContactListUpdateEvent);try{for(s.s();!(r=s.n()).done;)this.emit("contactListUpdate",r.value)}catch(ee){s.e(ee)}finally{s.f()}apiRTC.userAgentInstance.currentSession.waitingContactListUpdateEvent=[]}else if("mediaDeviceChanged"===E&&!0===apiRTC.mediaDeviceMgr.mediaDeviceChangedDetected){var q=apiRTC.mediaDeviceMgr.getMediaDeviceListsDiff(apiRTC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiRTC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources);apiRTC.myWebRTC_Event.createMediaDeviceChangedEvent(q,"updatedOnDeviceChange",apiRTC.mediaDeviceMgr.realMediaDevicesListInitializationWasAlreadyDone)}return this}},{key:"addOnceListener",value:function(E,U){return this.addListener(E,{listener:U,once:!0})}},{key:"defineEvent",value:function(E){return this.getListeners(E),this}},{key:"defineEvents",value:function(E){for(var U=0;U<E.length;U+=1)this.defineEvent(E[U]);return this}},{key:"removeListener",value:function(E,U){var ae,pe,G=this.getListenersAsObject(E);for(pe in G)G.hasOwnProperty(pe)&&-1!==(ae=C(G[pe],U))&&G[pe].splice(ae,1);return this}},{key:"addListeners",value:function(E,U){return this.manipulateListeners(!1,E,U)}},{key:"removeListeners",value:function(E,U){return this.manipulateListeners(!0,E,U)}},{key:"manipulateListeners",value:function(E,U,ae){var pe,G,r=E?this.removeListener:this.addListener,s=E?this.removeListeners:this.addListeners;if("object"!==d(U)||U instanceof RegExp)for(pe=ae.length;pe--;)r.call(this,U,ae[pe]);else for(pe in U)U.hasOwnProperty(pe)&&(G=U[pe])&&("function"==typeof G?r.call(this,pe,G):s.call(this,pe,G));return this}},{key:"removeEvent",value:function(E){var U,ae=d(E),pe=this._getEvents();if("string"===ae)delete pe[E];else if(E instanceof RegExp)for(U in pe)pe.hasOwnProperty(U)&&E.test(U)&&delete pe[U];else delete this._events;return this}},{key:"emitEvent",value:function(E,U){var ae,pe,G,r,s=this.getListenersAsObject(E);for(r in s)if(s.hasOwnProperty(r))for(ae=s[r].slice(0),G=0;G<ae.length;G++)!0===(pe=ae[G]).once&&this.removeListener(E,pe.listener),pe.listener.apply(this,U||[])===this._getOnceReturnValue()&&this.removeListener(E,pe.listener);return this}},{key:"setOnceReturnValue",value:function(E){return this._onceReturnValue=E,this}},{key:"_getOnceReturnValue",value:function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue}},{key:"_getEvents",value:function(){return this._events||(this._events={})}}],B&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(D.prototype,B),D}(),A=w.prototype,C=function(D,O){for(var B=D.length;B--;)if(D[B].listener===O)return B;return-1},S=function(D){return function(){return this[D].apply(this,arguments)}},n=function D(O){return"function"==typeof O||O instanceof RegExp||!(!O||"object"!==d(O))&&D(O.listener)};A.on=S("addListener"),A.once=S("addOnceListener"),A.off=S("removeListener"),A.removeAllListeners=S("removeEvent"),A.trigger=S("emitEvent"),e(1249);var v=e(5945),R=e(1549),p=e(4708),o=(R.Y.get("ApiCC"),{});o[1]="ERROR",o[2]="WARN",o[3]="INFO",o[4]="DEBUG",o[5]="TRACE";var f={description:"Apizee Cloud Communication Library",session:null,jsLoaded:!1,initApiKey:null,initApiCCId:null,extJsLoadingRetryNb:null,extJsLoadingRetryDelay:null,bandwidthTestServer:"https://cloud.apizee.com",bandwidthRatingThresholds:[300,500,1e3,1500,2e3],LOG_LEVEL_OFF:0,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL_TRACE:5,browser:v.Xh,browser_major_version:v.PR,browser_version:v.dc,osName:v.BF,osVersion:v.MM,osUAParser:v.ag,browserInfo:v.cf,browserDetails:p.wL,parser:v.E2,logStorageActivated:!1,logStorageLevel:3,logStorage:[],eventCenter:null},l=R.Y.get("EventCenter"),V="eventCenterData",T="[REMOTE-EVENTCENTER]",b=function(){function D(){var E=this;(function(U,ae){if(!(U instanceof ae))throw new TypeError("Cannot call a class as a function")})(this,D),this.consoleOutputEnabled=!1,"undefined"==typeof apiRTC_React&&(document.addEventListener("error",function(U){E.handleErrorEvent(U)}),document.addEventListener("userMediaError",function(U){E.handleErrorEvent(U)}))}var B;return(B=[{key:"handleErrorEvent",value:function(E){var U=E.detail;if(void 0!==U){var ae={},pe={},G="UNKNOWN";ae.type=E.type;for(var r=0,s=Object.keys(U);r<s.length;r++){var N=s[r];"eventType"!==N&&(ae[N]=U[N])}ae.systemInfo={apiRTC:f.version,app:v.$6,device:v.vO,osName:v.BF,osVersion:v.MM,browser:v.Xh,browser_version:v.dc},null!=f.session?G=f.session.apiCCId:null!=f.initApiCCId&&(G=f.initApiCCId),ae.userInfo={apiCCId:G,apiKey:apiRTC.initApiKey};var q=localStorage.getItem(V);(q=q?JSON.parse(q):[]).unshift(ae),q.length>100&&q.splice(100,q.length-100),localStorage.setItem(V,JSON.stringify(q)),this.consoleOutputEnabled&&l.error("[EVENTCENTER]",ae),"undefined"!=typeof Sentry&&("USER_MEDIA_ERROR"!==E.detail.errorCode?(pe.type=E.type,E.detail.error&&(pe.error=E.detail.error),E.detail.errorInfo&&(pe.errorInfo=E.detail.errorInfo),E.detail.errorCode&&(pe.errorCode=E.detail.errorCode),E.detail.callId&&(pe.callId=E.detail.callId),E.detail.convId&&(pe.convId=E.detail.convId),E.detail.gumConfig&&(pe.gumConfigVideo=!1!==E.detail.gumConfig.video),Sentry.withScope(function(ee){ee.setTag("event-center",!0),ee.setTag("userId",f.session.apiCCId),Sentry.captureException(new Error(JSON.stringify(pe)))})):l.debug("Filtering error event for USER_MEDIA_ERROR for Sentry"))}else l.error("Can't handle error event: data is undefined")}},{key:"handleDataAnswer",value:function(E){E?E.map(function(U){l.debug(T+": ",U)}):l.debug(T+": "+this.getUsername()+" has no event records")}},{key:"getStoredData",value:function(){var E=localStorage.getItem(V);return void 0===E?(l.warn("No data was stored by event center"),null):JSON.parse(E)}},{key:"clearStoredData",value:function(){localStorage.removeItem(V)}},{key:"enableConsoleOutput",value:function(E){this.consoleOutputEnabled=E}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(D.prototype,B),D}();e(3710);var ne=R.Y.get("MediaDevice"),le=function(){function D(E,U,ae,pe){(function(G,r){if(!(G instanceof r))throw new TypeError("Cannot call a class as a function")})(this,D),ne.trace("Create "+U+" MediaDevice"),this.id=E,this.type=U,this.label=ae,this.capabilities=pe}var B;return(B=[{key:"getId",value:function(){return this.id.toString()}},{key:"getType",value:function(){return this.type}},{key:"getLabel",value:function(){return this.label}},{key:"isCamera",value:function(){return"videoinput"===this.type}},{key:"isMicrophone",value:function(){return"audioinput"===this.type}},{key:"isAudioOutput",value:function(){return"audiooutput"===this.type}},{key:"getCapabilities",value:function(){return this.capabilities}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(D.prototype,B),D}(),W=(e(1532),e(4129),e(9653),e(4363),e(2772),e(9554),e(4747),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2707),e(2564),e(8674),e(7327),e(9600),e(285),e(1637),e(2479),e(8304),e(489),e(2419),e(8011),e(4819),e(5003),e(1215));function be(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function de(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}var ce=new WeakMap,Ee=new WeakMap,Ne=function(){function D(U){(function(ae,pe){if(!(ae instanceof pe))throw new TypeError("Cannot call a class as a function")})(this,D),Ee.set(this,U),ce.set(this,new w)}var O,B,E;return O=D,E=[{key:"getAvailableEvents",value:function(){return[]}}],(B=[{key:"on",value:function(U,ae){return this.constructor.getAvailableEvents().indexOf(U)>-1?ce.get(this).on(U,ae):Ee.get(this).error("No such event "+U),this}},{key:"removeListener",value:function(U,ae){if(this.constructor.getAvailableEvents().indexOf(U)>-1){var pe,G=!1,r=function(s,N){var q="undefined"!=typeof Symbol&&s[Symbol.iterator]||s["@@iterator"];if(!q){if(Array.isArray(s)||(q=function(Ue,vt){if(Ue){if("string"==typeof Ue)return be(Ue,void 0);var pt=Object.prototype.toString.call(Ue).slice(8,-1);return"Object"===pt&&Ue.constructor&&(pt=Ue.constructor.name),"Map"===pt||"Set"===pt?Array.from(Ue):"Arguments"===pt||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(pt)?be(Ue,void 0):void 0}}(s))){q&&(s=q);var ee=0,te=function(){};return{s:te,n:function(){return ee>=s.length?{done:!0}:{done:!1,value:s[ee++]}},e:function(Ue){throw Ue},f:te}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var $,ue=!0,Ie=!1;return{s:function(){q=q.call(s)},n:function(){var Ue=q.next();return ue=Ue.done,Ue},e:function(Ue){Ie=!0,$=Ue},f:function(){try{ue||null==q.return||q.return()}finally{if(Ie)throw $}}}}(ce.get(this).getListeners(U));try{for(r.s();!(pe=r.n()).done;)if(pe.value.listener===ae){G=!0;break}}catch(s){r.e(s)}finally{r.f()}G?ce.get(this).off(U,ae):Ee.get(this).trace("removeListener() - No such listener for event "+U)}else Ee.get(this).error("No such event "+U);return this}}])&&de(O.prototype,B),E&&de(O,E),D}();function Oe(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return He(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?He(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function He(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function ke(D){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ze(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}e(6699),e(2023),e(6755),e(3843);var we=R.Y.get("ApiRTCManager"),gt=["sessionReady","incomingCall","callEstablished","userMediaSuccess","userMediaStop","userMediaError","callRestarting","error","receiveIMMessage","updatePresence","webRTCClientCreated","updateUserStatus","channelEvent","groupChatCreation","groupChatInvitation","groupChatMemberUpdate","addUserInGroupChatAnswer","receiveGroupChatMessage","userDataAnswer","receiveConversationList","receiveConversationHistory","receiveConversationDetailReport","receiveContactOccurrencesFromConversationList","receiveMCUSessionInvitation","MCUSessionCreation","MCUAvailableStream","MCUAvailableStreamUpdate","MCURemoveStream","canPlayRemoteVideo","recordedFileAvailable","receiveData","roomCreation","roomJoined","roomInvitation","roomMemberUpdate","receiveRoomMessage","contactListInRoom","snapShotPhotoUploaded","stopRecord","callAttempt","joinMCUSessionAnswer","hangup","desktopCapture","remoteStreamAdded","remoteStreamRemoved","switchStream","sendDataChannelOpen","sendDataChannelClose","sendDataChannelError","receiveDataChannelOpen","receiveDataChannelClose","receiveDataChannelError","connectedUsersListUpdate","onFileSended","onFileSending","onFileReceiving","onFileReceived","onFileProgress","onFilePending","recordedStreamsAvailable","closingWhiteBoard","webRTCPluginInstallation","onQosStatsUpdate","onQosChange","onQosAudioChange","onQosVideoChange","MCURecordedStreamsAvailable","MCURecordingStarted","MCURecordingStopped","ICECandidateTypeUpdate","disconnectionWarning","MCUAvailableComposite","MCUParticipantEjected","MCUStreamingStarted","MCUStreamingStopped","MCUAvailableReplay","MCURoomModeChanged","onCallStatsUpdate","slowLink","localStreamUpdated","remoteStreamUpdated","audioAmplitude","videoQualityChanged","cpuLimited","bandwidthLimited","simulcastFeedChanged","cloudEventOccurred","groupUnsubscribed","transferBegun","transferProgress","transferEnded"],ft=null,at=!1,Ze=!1,ie=function(D){if(null!==ft&&ft.isInitialized()){if("groupUnsubscribed"===D||"transferBegun"===D||"transferProgress"===D||"transferEnded"===D)return;apiRTC.addEventListener(D,function(O){we.trace("Emiting "+D,O),ft.eventEmitter.emit(D,O)})}},bt=function(D){null!==ft&&ft.isInitialized()&&apiRTC.removeEventListener(D,function(O){we.trace("Emiting "+D,O),ft.eventEmitter.emit(D,O)})},Rt=function(){function D(){if(function(U,ae){if(!(U instanceof ae))throw new TypeError("Cannot call a class as a function")}(this,D),null!==ft)throw"Cannot construct singleton ApiRTCManager";this.eventEmitter=new w,this.apiRTCSession=null,this.whiteBoardClient=null,this.pointerSharingClient=null,this.webRTCClient=null,this.dataClient=null,this.IMClient=null,this.contactDisconnectionDelay=i.g.CONTACT_DISCONNECTION_DELAY,ft=this}var O,B,E;return O=D,B=[{key:"onEvent",value:function(U,ae){return gt.indexOf(U)>-1?this.eventEmitter.on(U,ae):we.error("No such apiRTC event "+U),this}},{key:"onceEvent",value:function(U,ae){gt.indexOf(U)>-1?this.eventEmitter.once(U,ae):we.error("No such apiRTC event "+U)}},{key:"sendData",value:function(U,ae){var pe=this;return new Promise(function(G,r){null===pe.dataClient?r(i.g.ERROR_APIRTC_INITIALISATION_FAILED):pe.dataClient.sendData(U,ae,function(s){var N=i.g.ERROR_OTHER;null!=s?"timeoutReached"!==s.reason&&"destNotFound"!==s.reason?G():("timerReached"===s.reason?N=i.g.ERROR_TIMED_OUT:"destNotFound"===s.reason&&(N=i.g.ERROR_NOT_FOUND),r(N)):r(N)})})}},{key:"sendMessage",value:function(U,ae){var pe=this,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,s){null===pe.IMClient?s(i.g.ERROR_APIRTC_INITIALISATION_FAILED):pe.IMClient.sendMessage(U,ae,function(N){var q=i.g.ERROR_OTHER;null!=N?"timeoutReached"!==N.reason&&"destNotFound"!==N.reason?r(N.UUCSeq):("timerReached"===N.reason?q=i.g.ERROR_TIMED_OUT:"destNotFound"===N.reason&&(q=i.g.ERROR_NOT_FOUND),s(q)):s(q)},G)})}},{key:"joinGroupChat",value:function(U){var ae=this;return new Promise(function(pe,G){if(null===ae.IMClient)return G(W.g.createError(i.g.ERROR_WRONG_STATE,"joinGroupChat() - cannot join group chat"));ae.IMClient.joinGroupChat(U),pe()})}},{key:"leaveGroupChat",value:function(U){var ae=this;return new Promise(function(pe,G){if(null===ae.IMClient)return G(W.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - cannot leave group chat"));ae.IMClient.leaveGroupChat(U),pe()})}},{key:"sendMessageToGroupChat",value:function(U,ae){var pe=this,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,s){if(null===pe.IMClient)s(i.g.ERROR_APIRTC_INITIALISATION_FAILED);else{var N={};W.g.isTypeof(G,"metadata","object")&&(N.metadata=G.metadata),pe.IMClient.sendMessageToGroupChat(U,ae,function(q){return null!==q&&"object"===ke(q)?"ack"===q.reason?r(q.UUCSeq):s("timeoutReached"===q.reason?i.g.ERROR_TIMED_OUT:"destNotFound"===q.reason?i.g.ERROR_NOT_FOUND:i.g.ERROR_OTHER):s(i.g.ERROR_OTHER)},N)}})}},{key:"removeEventListener",value:function(U,ae){null!=ae&&(gt.indexOf(U)>-1?this.eventEmitter.off(U,ae):we.error("No such apiRTC event "+U))}},{key:"isInitialized",value:function(){return at}},{key:"unsubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.unsubscribePresenceGroup([U]),ft.eventEmitter.emit("groupUnsubscribed",U)):we.error("apiRTC session is not initialized")}},{key:"joinAndSubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.joinPresenceGroup([U]),this.apiRTCSession.subscribePresenceGroup([U])):we.error("apiRTC session is not initialized")}},{key:"leaveAndUnsubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.leavePresenceGroup([U]),this.unsubscribeToPresenceGroup(U)):we.error("apiRTC session is not initialized")}},{key:"subscribeToCloudEvent",value:function(U,ae){this.apiRTCSession?this.apiRTCSession.subscribeToCloudEvent(U,ae):we.error("apiRTC session is not initialized")}},{key:"unsubscribeToCloudEvent",value:function(U,ae){this.apiRTCSession?this.apiRTCSession.unsubscribeToCloudEvent(U,ae):we.error("apiRTC session is not initialized")}},{key:"disconnect",value:function(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(apiRTC.disconnect(U),at=!1,this.apiRTCSession=null,this.webRTCClient=null,this.dataClient=null,this.IMClient=null,Ze){var ae,pe=Oe(gt);try{for(pe.s();!(ae=pe.n()).done;){var G=ae.value;bt(G)}}catch(r){pe.e(r)}finally{pe.f()}Ze=!1}}},{key:"initializeApiRTC",value:function(U){return we.info("initializeApiRTC()"),new Promise(function(ae,pe){if(void 0===U&&void 0===U.apiKey)pe("Invalid apiRTC initialization params");else{var G=function(r){switch(we.debug("onChannelEventDuringInit()",r.detail),r.detail.channelEvent){case"onChannelError":pe("Channel Error : "+r.detail.event);break;case"onChannelConnectError":r.detail.event.message.includes("access token failure")&&pe("Channel Connect Error: "+r.detail.event.message);break;case"onChannelOpened":we.debug("onChannelOpened");break;default:we.debug("Unhandle case in onChannelEventDuringInit :",r.detail.channelEvent)}};apiRTC.addEventListener("channelEvent",G),U.onReady=function(){if(at=!0,ft.webRTCClient=apiRTC.session.createWebRTCClient({}),ft.webRTCClient.setMCUConnector(U.hasOwnProperty("mcu")?U.mcu:i.g.DEFAULT_MCU),W.g.isPropertyTypeof(U,"turnServerAddress","string")&&ft.webRTCClient.setClientTurnServer(U.turnServerAddress),ft.webRTCClient.setUserAcceptOnIncomingCallBeforeGetUserMedia(!0),W.g.isPropertyTypeof(U,"userAcceptOnIncomingDataCall","boolean")?ft.webRTCClient.setUserAcceptOnIncomingDataCall(U.userAcceptOnIncomingDataCall):ft.webRTCClient.setUserAcceptOnIncomingDataCall(!0),W.g.isPropertyTypeof(U,"userAcceptOnIncomingScreenSharingCall","boolean")?ft.webRTCClient.setUserAcceptOnIncomingScreenSharingCall(U.userAcceptOnIncomingScreenSharingCall):ft.webRTCClient.setUserAcceptOnIncomingScreenSharingCall(!1),ft.dataClient=apiRTC.session.createDataClient(),ft.IMClient=apiRTC.session.createIMClient(),ft.pointerSharingClient=apiRTC.session.createPointerSharingClient(),ft.webRTCClient.setAllowMultipleCalls(!0),ft.apiRTCSession=apiRTC.session,!Ze){var r,s=Oe(gt);try{for(s.s();!(r=s.n()).done;)ie(r.value)}catch(q){s.e(q)}finally{s.f()}Ze=!0}apiRTC.removeEventListener("channelEvent",G),ae(apiRTC.session.apiCCId)},at=!1,ft.apiRTCSession=null,ft.webRTCClient=null,ft.dataClient=null,ft.IMClient=null,apiRTC.init(U)}})}},{key:"createWhiteBoard",value:function(){we.debug("createWhiteBoard()"),ft.whiteBoardClient=apiRTC.createWhiteBoard(null,"invisible",null,6e4)}},{key:"getMediaDevices",value:function(){return we.debug("ApiRTCManager::getMediaDevices()"),new Promise(function(U,ae){apiRTC.getMediaDevices().then(function(pe){we.debug("ApiRTCManager::getMediaDevices(), sources :",pe),U(pe)}).catch(function(pe){var G="getMediaDevices() - error";we.error(G,pe),ae(new Error(G))})})}},{key:"getUserMedia",value:function(U){return new Promise(function(ae,pe){apiRTC.getUserMedia(U).then(function(G){we.debug("ApiRTCManager::getUserMedia() success"),ae(G)}).catch(function(G){we.error("ApiRTCManager::getUserMedia() - Could not get user media :",G),pe(new Error("ApiRTCManager::getUserMedia() - Could not get user media :"+G))})})}},{key:"setAudioSourceIdInConstraint",value:function(U,ae){return apiRTC.setAudioSourceIdInConstraint(U,ae)}},{key:"setVideoSourceIdInConstraint",value:function(U,ae){return apiRTC.setVideoSourceIdInConstraint(U,ae)}},{key:"attachMediaStream",value:function(U,ae){apiRTC.attachMediaStream(U,ae)}},{key:"addStreamInDiv",value:function(U,ae,pe,G,r,s,N){apiRTC.addStreamInDiv(U,ae,pe,G,r,s,N)}},{key:"removeElementFromDiv",value:function(U,ae){we.debug("removeElementFromDiv"),apiRTC.removeElementFromDiv(U,ae)}},{key:"getClientId",value:function(){return null!==this.apiRTCSession&&null!==this.apiRTCSession.apiCCWebRTCClient?this.apiRTCSession.apiCCWebRTCClient.webRTCClient.clientId:null}},{key:"getActiveApiKey",value:function(){return void 0!==apiRTC.session&&null!==apiRTC.session?apiRTC.session.apiKey:null}}],E=[{key:"get",value:function(){return null===ft&&(ft=new D),ft}}],B&&ze(O.prototype,B),E&&ze(O,E),D}();function Ct(D){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function et(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function wt(D,O){return(wt=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Be(D,O){if(O&&("object"===Ct(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Lt(D)}function Lt(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function jt(D){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var Ge=R.Y.get("Invitation"),Pt=new WeakMap,z=["statusChange"],M=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&wt(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=jt(U);if(ae){var N=jt(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Be(this,r)});function G(){var r;return function(s,N){if(!(s instanceof N))throw new TypeError("Cannot call a class as a function")}(this,G),(r=pe.call(this,Ge)).id=null,Pt.set(Lt(r),i.g.INVITATION_STATUS_STANDBY),r.apiRTCManager=Rt.get(),r.type="not_defined",r}return O=G,E=[{key:"getAvailableEvents",value:function(){return z}}],(B=[{key:"setStatus",value:function(r){Pt.set(this,r),ce.get(this).emit("statusChange",{status:r,id:this.id})}},{key:"getStatus",value:function(){return Pt.get(this)}}])&&et(O.prototype,B),E&&et(O,E),G}(Ne);function t(D){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function h(D,O){return(h=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function y(D,O){if(O&&("object"===t(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function a(D){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}R.Y.get("ReceivedInvitation");var m=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&h(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=a(E);if(U){var s=a(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return y(this,G)});function pe(G,r){var s;return function(N,q){if(!(N instanceof q))throw new TypeError("Cannot call a class as a function")}(this,pe),(s=ae.call(this)).id=r,s.sender=G,s.receiveTime=Date.now(),s}return(B=[{key:"accept",value:function(){return new Promise}},{key:"decline",value:function(G){}},{key:"getSender",value:function(){return this.sender}},{key:"getReceiveTime",value:function(){return this.receiveTime}},{key:"getId",value:function(){return this.id}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(M);function _(D){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function P(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function oe(D,O){return(oe=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function K(D,O){if(O&&("object"===_(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return X(D)}function X(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function me(D){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var Q=R.Y.get("ReceivedInvitation"),re=new WeakMap,ye=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&oe(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=me(E);if(U){var s=me(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return K(this,G)});function pe(G,r,s){var N,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return P(this,pe),N=ae.call(this,G,r.invitationId),Q.info("Create ReceivedConversationInvitation"),N.conversation=s,N.type="conversation",N.invitationData=r,re.set(X(N),q),N}return B=[{key:"accept",value:function(G){var r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=function(){return new Promise(function(ee,te){var $=re.get(r);s.hasOwnProperty("password")&&($.password=s.password),s.hasOwnProperty("session")&&($.session=s.session),r.conversation.join($).then(function(){null!=G&&r.conversation.publish(G),ee(r.conversation)}).catch(function(ue){te(W.g.createError(i.g.ERROR_OTHER,"accept() - cannot join webconf",Q,{fromError:ue}))})})},q=function(){return new Promise(function(ee,te){r.conversation.joinGroupChat().then(function(){ee(r.conversation)}).catch(function($){te(W.g.createError(i.g.ERROR_OTHER,"accept() - cannot join groupChat",Q,{fromError:$}))})})};return new Promise(function(ee,te){return r.getStatus()!==i.g.INVITATION_STATUS_STANDBY?te(W.g.createError(i.g.ERROR_WRONG_STATE,"accept() - cannot accept invitation",Q)):(r.setStatus(i.g.INVITATION_STATUS_ACCEPTED),r.apiRTCManager.sendData(r.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:r.id,answer:"accept"}),r.invitationData&&r.invitationData.conversationTypes?r.invitationData.conversationTypes.indexOf("WEBCONF")>=0?N().then(ee).catch(te):r.invitationData.conversationTypes.indexOf("GROUP_CHAT")>=0?q().then(ee).catch(te):void 0:N().then(ee).catch(te))})}},{key:"decline",value:function(G){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:G,answer:"decline"}))}},{key:"getConversation",value:function(){return this.conversation}}],B&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(m);function Se(D){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ge(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return Pe(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?Pe(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function Pe(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function xe(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function We(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function rt(D,O){return(rt=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Et(D,O){if(O&&("object"===Se(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Qe(D)}function Qe(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function yt(D){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}e(189);var ct=R.Y.get("Call"),ht=Rt.get(),mi=["streamAdded","streamRemoved","response","accepted","declined","hangup","localStreamAvailable","recordAvailable","statsUpdate","error","disconnectionWarning","userMediaError","desktopCapture","remoteStreamUpdated","recordingStarted","recordingStopped","recordingAvailable"],Bi=new Set(["audioSent","videoSent","audioReceived","videoReceived","quality"]),Yt=new WeakMap,oi=new WeakMap,ei=new WeakMap,Ci=new WeakMap,Ai=new WeakMap,yi=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&rt(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=yt(U);if(ae){var N=yt(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Et(this,r)});function G(r,s){var N,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(xe(this,G),N=pe.call(this,ct),ct.debug("Create Call with id "+r),Yt.set(Qe(N),r),oi.set(Qe(N),s),N.publishedStreams=new Map,N.receivedStreams=new Map,N.stats={},ei.set(Qe(N),q.hasOwnProperty("started")&&q.started?i.g.CALL_STATUS_ONGOING:i.g.CALL_STATUS_WAITING_FOR_CALLEE),Ci.set(Qe(N),!!q.hasOwnProperty("isRecorded")&&q.isRecorded),q.isRecorded){N.confId=null,N.recordingStatus=null;for(var ee=ht.webRTCClient.webRTCClient.callsTable.length;--ee>=0;){var te=ht.webRTCClient.webRTCClient.callsTable[ee];if(te.callId===r&&te.data){N.confId=te.data.confId;break}}Ci.set(Qe(N),!0)}else Ci.set(Qe(N),!1);var $={hangup:function(Ie){N.getId()===Ie.detail.callId&&N.destroy()},receiveData:function(Ie){void 0!==Ie.detail.data.info&&Ie.detail.data.info===i.g.INVITATION_ANSWER_IDENTIFIER&&Ie.detail.data.invitationId.toString()===N.getId()&&N.getStatus()===i.g.CALL_STATUS_WAITING_FOR_CALLEE&&(ct.info("Call answer from "+N.getContact().getUsername()+" for "+N.getId()),"accept"===Ie.detail.data.answer?(ei.set(Qe(N),i.g.CALL_STATUS_ONGOING),ce.get(Qe(N)).emit("accepted"),ce.get(Qe(N)).emit("response","accepted")):(ei.set(Qe(N),i.g.CALL_STATUS_ENDED),ce.get(Qe(N)).emit("declined",{reason:"User_Refused_Call"}),ce.get(Qe(N)).emit("response","declined")))},remoteStreamUpdated:function(Ie){if(N.getId()===Ie.detail.callId){var Ue={callId:Ie.detail.callId,audio:Ie.detail.audioIsAvailable&&Ie.detail.audioIsActive,audioMuted:Ie.detail.audioIsMuted,video:Ie.detail.videoIsAvailable&&Ie.detail.videoIsActive,videoMuted:Ie.detail.videoIsMuted};ce.get(Qe(N)).emit("remoteStreamUpdated",Ue)}},MCURecordingStarted:function(Ie){if(Ci.get(Qe(N))&&Ie.detail.roomName===N.confId){var Ue=W.g.parseRecordingEvent("MCURecordingStarted",Ie.detail);"COMPOSITE"===Ue.callId&&(N.recordingStatus=Ue,ce.get(Qe(N)).emit("recordingStarted",Ue))}},MCURecordingStopped:function(Ie){if(Ci.get(Qe(N))&&Ie.detail.roomName===N.confId){var Ue=W.g.parseRecordingEvent("MCURecordingStopped",Ie.detail);"COMPOSITE"===Ue.callId&&(delete N.recordingStatus,ce.get(Qe(N)).emit("recordingStopped",Ue))}},MCURecordedStreamsAvailable:function(Ie){if(Ci.get(Qe(N))&&Ie.detail.roomName===N.confId){var Ue=W.g.parseRecordingEvent("MCURecordedStreamsAvailable",Ie.detail);ce.get(Qe(N)).emit("recordingAvailable",Ue)}}};for(var ue in $)ht.onEvent(ue,$[ue]);return Ai.set(Qe(N),$),N}return O=G,E=[{key:"getAvailableEvents",value:function(){return mi}}],(B=[{key:"destroy",value:function(){var r=Ai.get(this);if(r){for(var s in r)ht.removeEventListener(s,r[s]);Ai.delete(this)}}},{key:"getId",value:function(){return Yt.get(this).toString()}},{key:"isRecorded",value:function(){return Ci.get(this)}},{key:"getContact",value:function(){return oi.get(this)}},{key:"getStatus",value:function(){return ei.get(this)}},{key:"setStatus",value:function(r){ei.set(this,r)}},{key:"getPublishedStreams",value:function(){var r,s=[],N=ge(this.publishedStreams.values());try{for(N.s();!(r=N.n()).done;)s.push(r.value)}catch(ee){N.e(ee)}finally{N.f()}return s}},{key:"getReceivedStreams",value:function(){var r,s=[],N=ge(this.receivedStreams.values());try{for(N.s();!(r=N.n()).done;)s.push(r.value)}catch(ee){N.e(ee)}finally{N.f()}return s}},{key:"hangUp",value:function(){this.getStatus()===i.g.CALL_STATUS_ENDED?ct.error("hangUp() - Call has already ended"):ht.webRTCClient.hangUp(this.getId())}},{key:"getStats",value:function(){return W.g.assignObject({},this.stats)}},{key:"stopPublishedStreams",value:function(){return ht.webRTCClient.webRTCClient.stopMedia(this.getId())}},{key:"replacePublishedStreams",value:function(r,s){var N=this,q=function(ee){if(Nn.has(ee))return Nn.get(ee);var te=apiCC.getUserMediaStream(ee);if(te){var $="audio";return!0===te.video&&($="video"),new wn(te.stream,{type:$,constructor:!0,userMediaStreamId:te.userMediaStreamId})}return null};return new Promise(function(ee,te){if(N.getStatus()!==i.g.CALL_STATUS_ONGOING)return te(new Error("replacePublishedStreams() - Cannot replace stream as call is not ongoing"));if(null===r)if(W.g.isPropertyTypeof(s,"getStream","function")){var $={getUserMediaStreamId:function(){return s.getStream().then(function(ue){return ue.userMediaStreamId}).catch(te)}};ht.webRTCClient.webRTCClient.addMedia(N.getId(),!0,null,$).then(function(ue){return ee(q(ue))}).catch(function(ue){return te(new Error("replacePublishedStreams() - "+ue))})}else ht.webRTCClient.webRTCClient.addMedia(N.getId(),!0,null,null).then(function(ue){return ee(q(ue))}).catch(function(ue){return te(new Error("replacePublishedStreams() - "+ue))});else ht.webRTCClient.webRTCClient.addMedia(N.getId(),!0,r.userMediaStreamId).then(function(ue){return ee(q(ue))}).catch(function(ue){return te(new Error("replacePublishedStreams() - "+ue))})})}},{key:"getRecordingInfo",value:function(){return Ci.get(this)?this.recordingStatus:null}},{key:"startRecording",value:function(){var r=this;return new Promise(function(s,N){if(r.asyncCallbacks)return N(W.g.createError(i.g.ERROR_OTHER,"startRecording() - busy",ct));r.asyncCallbacks={},r.asyncCallbacks.timeoutId=setTimeout(function(){return r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"startRecording() - timeout",ct))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),r.asyncCallbacks.error=function(q){if(r.confId===q.detail.roomName&&"COMPOSITE"===q.detail.callId&&q.detail.errorCode.indexOf("START_RECORD")>=0)return r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"startRecording() - "+q.detail.errorInfo,ct))},r.asyncCallbacks.recordingStarted=function(q){if(r.confId===q.detail.roomName&&"COMPOSITE"===q.detail.callId){r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks);var ee=W.g.parseRecordingEvent("MCURecordingStarted",q.detail);return s(ee)}},ht.onEvent("error",r.asyncCallbacks.error),ht.onEvent("MCURecordingStarted",r.asyncCallbacks.recordingStarted),ht.webRTCClient.startCallRecording(Yt.get(r))})}},{key:"stopRecording",value:function(){var r=this;return new Promise(function(s,N){if(r.asyncCallbacks)return N(W.g.createError(i.g.ERROR_OTHER,"stopRecording() - busy",ct));r.asyncCallbacks={},r.asyncCallbacks.timeoutId=setTimeout(function(){return r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"stopRecording() - timeout",ct))},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),r.asyncCallbacks.error=function(q){if(r.confId===q.detail.roomName&&"COMPOSITE"===q.detail.callId&&q.detail.errorCode.indexOf("STOP_RECORD")>=0)return r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"stopRecording() - "+q.detail.errorInfo,ct))},r.asyncCallbacks.recordingStopped=function(q){if(r.confId===q.detail.roomName&&"COMPOSITE"===q.detail.callId){r.asyncCallbacks&&(ht.removeEventListener("error",r.asyncCallbacks.error),ht.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks);var ee=W.g.parseRecordingEvent("MCURecordingStopped",q.detail);return s(ee)}},ht.onEvent("error",r.asyncCallbacks.error),ht.onEvent("MCURecordingStopped",r.asyncCallbacks.recordingStopped),ht.webRTCClient.stopCallRecording(Yt.get(r))})}},{key:"manageCallEstablishedEvent",value:function(r){ct.debug("callEstablished",r.detail,this.getId());var s=r.detail.callId.toString();this.getId()===s&&(ct.info("callEstablished from "+this.getContact().getUsername(),r),this.getStatus()!==i.g.CALL_STATUS_ONGOING&&this.getStatus()!==i.g.CALL_STATUS_ENDED&&(ce.get(this).emit("accepted"),ce.get(this).emit("response","accepted"),ei.set(this,i.g.CALL_STATUS_ONGOING)))}},{key:"manageRemoteStreamAddedEvent",value:function(r){ct.debug("remoteStreamAdded",r.detail,this.getId());var s=r.detail.callId.toString();if(this.getId()===s){var ee=new wn(r.detail.stream,{screensharing:"screenSharing"===r.detail.callType,type:"audio"===r.detail.destCallType?"audio":"video",contact:this.getContact(),streamId:r.detail.stream.id,callId:r.detail.callId,callAudioAvailable:r.detail.audioIsAvailable,callAudioActive:r.detail.audioIsActive,callAudioMuted:r.detail.audioIsMuted,callVideoAvailable:r.detail.videoIsAvailable,callVideoActive:r.detail.videoIsActive,callVideoMuted:r.detail.videoIsMuted,constructor:!0});this.receivedStreams.set(r.detail.stream.id,ee),ce.get(this).emit("streamAdded",ee)}}},{key:"manageRemoteStreamRemovedEvent",value:function(r){ct.debug("remoteStreamRemoved",r.detail,this.getId());var s=r.detail.callId.toString();if(this.getId()===s){var N=this.receivedStreams.get(r.detail.stream.id);this.receivedStreams.delete(r.detail.stream.id),ce.get(this).emit("streamRemoved",N)}}},{key:"manageUserMediaSuccessEvent",value:function(r){ct.debug("UserMediaSuccess",r.detail,this.getId());var s,N=null;if(s=!0===r.detail.videoIsAvailable?"video":"audio",null!==r.detail.callId&&(N=r.detail.callId.toString()),this.getId()===N){ct.info("localStreamAvailable",r.detail);var q=Nn.get(r.detail.userMediaStreamId);q||(q=new wn(r.detail.stream,{type:s,constructor:!0,userMediaStreamId:r.detail.userMediaStreamId})),this.publishedStreams.set(W.g.guid(),q),ce.get(this).emit("localStreamAvailable",q)}}},{key:"manageCallStatsUpdateEvent",value:function(r){if(this.getId()===r.detail.callId){for(var s=0,N=Object.keys(r.detail.stats);s<N.length;s++){var q=N[s];Bi.has(q)&&(this.stats[q]=r.detail.stats[q])}ce.get(this).emit("statsUpdate",W.g.assignObject({},{stats:this.stats}))}}},{key:"manageErrorEvent",value:function(r){if(ct.debug("Error",r.detail,this.getId()),this.getId()===r.detail.callId){var s={errorCode:r.detail.errorCode,errorInfo:r.detail.errorInfo};r.detail.data&&(s.descriptor=r.detail.data),ce.get(this).emit("error",s)}}},{key:"manageDisconnectionWarningEvent",value:function(r){ct.debug("DisconnectionWarning",r.detail,this.getId()),this.getId()===r.detail.callId&&ce.get(this).emit("disconnectionWarning",{tries:r.detail.tries})}},{key:"manageHangupEvent",value:function(r){ct.debug("hangup",r.detail,this.getId());var s=r.detail.callId.toString(),N=this.getStatus()===i.g.CALL_STATUS_WAITING_FOR_CALLEE&&"remote"===r.detail.hangupType;if(this.getId()===s&&this.getStatus()!==i.g.CALL_STATUS_ENDED){ei.set(this,i.g.CALL_STATUS_ENDED),ct.info("Hangup from "+this.getContact().getUsername(),r);var q,ee=ge(this.receivedStreams.keys());try{for(ee.s();!(q=ee.n()).done;){var te=q.value,$=this.receivedStreams.get(te);this.receivedStreams.delete(te),ce.get(this).emit("streamRemoved",$)}}catch(ue){ee.e(ue)}finally{ee.f()}ce.get(this).emit("hangup",{from:r.detail.hangupType,reason:r.detail.reason}),N&&(ce.get(this).emit("declined",{reason:r.detail.reason}),ce.get(this).emit("response","declined"))}}},{key:"manageRecordAvailableEvent",value:function(r){ct.warn("recordedStreamsAvailable",r.detail,this.getId()),ce.get(this).emit("recordAvailable",{mediaURL:r.detail.mediaURL})}},{key:"manageUserMediaErrorEvent",value:function(r){ct.warn("userMediaError",r.detail,this.getId()),ce.get(this).emit("userMediaError",{callType:r.detail.callType,error:r.detail.error,onCallEstablishment:r.detail.onCallEstablishment,userMediaStreamId:r.detail.userMediaStreamId,tryAudioCallActivated:r.detail.tryAudioCallActivated})}},{key:"manageDesktopCaptureEvent",value:function(r){ct.warn("desktopCapture",r.detail,this.getId()),ce.get(this).emit("desktopCapture",{event:r.detail.event})}}])&&We(O.prototype,B),E&&We(O,E),G}(Ne);function gi(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function ki(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}var Gi=R.Y.get("ConversationCatalog"),_i=null,Ni=function(){function D(){if(function(U,ae){if(!(U instanceof ae))throw new TypeError("Cannot call a class as a function")}(this,D),null!==_i)throw"Cannot construct singleton CallCatalog";this.callList=new Map,_i=this}var O,B,E;return O=D,E=[{key:"get",value:function(){return null===_i&&(_i=new D),_i}}],(B=[{key:"getOrCreateCall",value:function(U,ae,pe){var G=null;return null!=U&&(this.callList.has(U.toString())?G=this.callList.get(U.toString()):(G=new yi(U.toString(),ae,pe),this.callList.set(U.toString(),G))),G}},{key:"getCall",value:function(U,ae){var pe=null;if(null!=U){if(!this.callList.has(U.toString()))return null;pe=this.callList.get(U.toString())}else if(ae){var G,r=function(q,ee){var te="undefined"!=typeof Symbol&&q[Symbol.iterator]||q["@@iterator"];if(!te){if(Array.isArray(q)||(te=function(pt,kt){if(pt){if("string"==typeof pt)return gi(pt,void 0);var Ut=Object.prototype.toString.call(pt).slice(8,-1);return"Object"===Ut&&pt.constructor&&(Ut=pt.constructor.name),"Map"===Ut||"Set"===Ut?Array.from(pt):"Arguments"===Ut||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ut)?gi(pt,void 0):void 0}}(q))){te&&(q=te);var $=0,ue=function(){};return{s:ue,n:function(){return $>=q.length?{done:!0}:{done:!1,value:q[$++]}},e:function(pt){throw pt},f:ue}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Ie,Ue=!0,vt=!1;return{s:function(){te=te.call(q)},n:function(){var pt=te.next();return Ue=pt.done,pt},e:function(pt){vt=!0,Ie=pt},f:function(){try{Ue||null==te.return||te.return()}finally{if(vt)throw Ie}}}}(this.callList.values());try{for(r.s();!(G=r.n()).done;){var s=G.value,N=s.getContact();if(N&&N.getId()===ae.getId()){pe=s;break}}}catch(q){r.e(q)}finally{r.f()}}return pe}},{key:"removeCallFromList",value:function(U){Gi.log("removeCallFromList : av instance.callList :",_i.callList),_i.callList.has(U)&&_i.callList.delete(U),Gi.log("removeCallFromList : ap instance.callList :",_i.callList)}},{key:"getCalls",value:function(){return this.callList}}])&&ki(O.prototype,B),E&&ki(O,E),D}();function Oi(D){return(Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function cn(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Di(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function ji(D,O){return(ji=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Zi(D,O){if(O&&("object"===Oi(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return bn(D)}function bn(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function qi(D){return(qi=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var dn=R.Y.get("ReceivedInvitation"),_n=Ni.get(),Qn=["expired","statusChange"],Pi=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&ji(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=qi(U);if(ae){var N=qi(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Zi(this,r)});function G(r,s,N){var q,ee=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return cn(this,G),q=pe.call(this,r,s),dn.info("Create ReceivedCallInvitation with call type "+N),q.type="call",q.callType=N,q.isRecordedCall=!!ee.hasOwnProperty("isRecorded")&&ee.isRecorded,q.call=_n.getOrCreateCall(q.id,q.sender,{isRecorded:q.isRecorded()}),q.apiRTCManager.onEvent("hangup",function(te){var $=te.detail.callId.toString();q.id.toString()===$&&q.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(q.setStatus(i.g.INVITATION_STATUS_EXPIRED),ce.get(bn(q)).emit("expired"))}),q}return O=G,B=[{key:"getCallType",value:function(){return this.callType}},{key:"isRecorded",value:function(){return this.isRecordedCall}},{key:"accept",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(q,ee){var te="audio"===s.getCallType(),$=!0,ue=N;N.hasOwnProperty("audioOnly")&&(te=N.audioOnly,delete N.audioOnly,null!=ue.mediaTypeForIncomingCall||!0===N.audioOnly&&(ue.mediaTypeForIncomingCall="AUDIO")),N.hasOwnProperty("noStream")&&(ue.mediaTypeForIncomingCall="NONE",$=!1),"NONE"===ue.mediaTypeForIncomingCall&&($=!1),s.getStatus()===i.g.INVITATION_STATUS_STANDBY?(s.setStatus(i.g.INVITATION_STATUS_ACCEPTED),s.apiRTCManager.sendData(s.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:s.id,answer:"accept"}),s.call.setStatus(i.g.CALL_STATUS_ONGOING),$&&null!==r&&r instanceof wn&&(dn.debug("accept() - A stream was preselected; audio only : ",te),ue.userMediaStreamId=r.userMediaStreamId),s.apiRTCManager.webRTCClient.acceptCall(s.id,ue),q(s.call)):ee(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this call, invitation state invalid",dn))})}},{key:"decline",value:function(r){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:r,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}},{key:"getCall",value:function(){return this.call}}],E=[{key:"getAvailableEvents",value:function(){return Qn}}],B&&Di(O.prototype,B),E&&Di(O,E),G}(m);function un(D){return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Un(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function yn(D,O){return(yn=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function $n(D,O){if(O&&("object"===un(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function Ln(D){return(Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var Hi=R.Y.get("ReceivedInvitation"),Hn=["error","progress","statusChange"],Tn=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&yn(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=Ln(U);if(ae){var N=Ln(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return $n(this,r)});function G(r,s,N){var q;return function(ee,te){if(!(ee instanceof te))throw new TypeError("Cannot call a class as a function")}(this,G),q=pe.call(this,r,s),Hi.debug("Create ReceivedFileTransferInvitation"),q.type="sendFile",q.fileInfo=N,q.apiRTCManager.onEvent("hangup",function(ee){Hi.debug("hangup");var te=ee.detail.callId.toString();q.getId()===te&&(Hi.debug("hangup for ReceivedFileTransferInvitation"),q.getStatus()===i.g.INVITATION_STATUS_ENDED?Hi.debug("invitation ended"):(Hi.debug("invitation is cancelled"),q.setStatus(i.g.INVITATION_STATUS_CANCELLED)),apiRTC.userAgentInstance.currentSession.invitationsMap.has(ee.detail.remoteId+"-sendfile-"+te)&&apiRTC.userAgentInstance.currentSession.invitationsMap.delete(ee.detail.remoteId+"-sendfile-"+te))}),q}return O=G,E=[{key:"getAvailableEvents",value:function(){return Hn}}],(B=[{key:"accept",value:function(){var r=this;return new Promise(function(s,N){if(r.getStatus()!==i.g.INVITATION_STATUS_STANDBY)N(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this file transfer session, invitation state invalid",Hi));else{r.setStatus(i.g.INVITATION_STATUS_ACCEPTED),r.apiRTCManager.sendData(r.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:r.id,answer:"accept"});var q=r;r.apiRTCManager.onEvent("onFileReceived",function ee(te){if(te.detail.callId.toString()===q.id.toString()){if(Hi.debug("typeof(e.detail.data.file) :",un(te.detail.data.file)),"string"==typeof te.detail.data.file)s({file:te.detail.data.file,name:te.detail.data.name,type:te.detail.data.type});else{var $=new FileReader;$.addEventListener("loadend",function(){r.setStatus(i.g.INVITATION_STATUS_ENDED),r.apiRTCManager.webRTCClient.hangUp(q.id.toString());try{Hi.info("accept() - file received from "+q.sender.getUsername()+" !"),s({file:te.detail.data.file,name:te.detail.data.name,type:te.detail.data.type})}catch(ue){Hi.error("File Error",ue),N(W.g.createError(i.g.ERROR_OTHER,"accept() - Could not read file received",Hi))}}),$.readAsArrayBuffer(te.detail.data.file)}r.apiRTCManager.removeEventListener("onFileReceived",ee)}}),r.apiRTCManager.onEvent("onFileProgress",function(ee){ee.detail.callId.toString()===q.id.toString()&&(Hi.trace("file transfering",ee.detail),ce.get(q).emit("progress",{uuid:ee.detail.uuid,fileSize:ee.detail.fileSize,remainingSize:ee.detail.remainingSize,percentage:ee.detail.percentage,sendChunkNb:ee.detail.sendChunkNb,transferDuration:ee.detail.transferDuration,lastPacket:ee.detail.lastPacket}))}),r.apiRTCManager.onEvent("receiveDataChannelError",function(ee){ee.detail.callId.toString()===q.id.toString()&&(Hi.warn("receiveDataChannelError",ee.detail),ce.get(q).emit("error","receiveDataChannelError"))}),r.apiRTCManager.webRTCClient.acceptCall(r.id,{mediaTypeForIncomingCall:"DATA"})}})}},{key:"getFileInfo",value:function(){return this.fileInfo}},{key:"decline",value:function(r){Hi.log("decline"),this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:r,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}}])&&Un(O.prototype,B),E&&Un(O,E),G}(m);function Ui(D){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Zn(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Re(D,O){return(Re=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function lt(D,O){if(O&&("object"===Ui(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function It(D){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var it=R.Y.get("ReceivedInvitation"),Bt=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&Re(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=It(E);if(U){var s=It(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return lt(this,G)});function pe(G,r){var s,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Zn(this,pe),s=ae.call(this,G,r),it.info("Create ReceivedWhiteboardInvitation"),s.type="whiteboard",N.cloudConvId&&(s.cloudConvId=N.cloudConvId),!0===N.webconf&&(s.webconf=!0),s}return(B=[{key:"accept",value:function(){var G=this;return new Promise(function(r,s){if(G.getStatus()===i.g.INVITATION_STATUS_STANDBY){G.setStatus(i.g.INVITATION_STATUS_ACCEPTED),G.apiRTCManager.sendData(G.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:"wb-"+G.id,answer:"accept"}),G.apiRTCManager.whiteBoardClient.leaveRoom(),G.apiRTCManager.whiteBoardClient.start();var N={};G.cloudConvId&&(N.convId=G.cloudConvId),!0===G.webconf&&(N.webconf=!0),G.apiRTCManager.whiteBoardClient.joinRoom(G.id,N),r(G.id)}else s(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this whiteboard session, invitation state invalid",it))})}},{key:"decline",value:function(G){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:"wb-"+this.id,reason:G,answer:"decline"}))}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(m);function nt(D){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function vi(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function di(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function ai(D,O){return(ai=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Mt(D,O){if(O&&("object"===nt(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Vt(D)}function Vt(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Ft(D){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var ui=R.Y.get("DataChannel"),xn=Rt.get(),ea=["response","accepted","declined","error","opened","closed","error","transferProgress","transferComplete","dataReceived","ended"],ta=new WeakMap,oa=new WeakMap,Mn=new WeakMap,Wn=new WeakMap,Jn=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&ai(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=Ft(U);if(ae){var N=Ft(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Mt(this,r)});function G(r,s){var N,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return vi(this,G),N=pe.call(this,ui),ui.debug("Create DataChannel with id "+r),ta.set(Vt(N),r),oa.set(Vt(N),s),Wn.set(Vt(N),i.g.DATACHANNEL_TYPE_RECEIVE),q.hasOwnProperty("type")&&(q.type===i.g.DATACHANNEL_TYPE_RECEIVE?Wn.set(Vt(N),i.g.DATACHANNEL_TYPE_RECEIVE):q.type===i.g.DATACHANNEL_TYPE_SEND&&Wn.set(Vt(N),i.g.DATACHANNEL_TYPE_SEND)),Mn.set(Vt(N),i.g.DATACHANNEL_STATUS_WAITING),xn.onEvent("receiveData",function(ee){void 0!==ee.detail.data.info&&ee.detail.data.info===i.g.INVITATION_ANSWER_IDENTIFIER&&ee.detail.data.invitationId.toString()===N.getId()&&N.getStatus()===i.g.DATACHANNEL_STATUS_WAITING&&(ui.info("DataChannel answer from "+N.getContact().getUsername()+" for "+N.getId()),"accept"===ee.detail.data.answer?ce.get(Vt(N)).emit("accepted"):(Mn.set(Vt(N),i.g.DATACHANNEL_STATUS_ENDED),ce.get(Vt(N)).emit("declined")),ce.get(Vt(N)).emit("response"))}).onEvent("callEstablished",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&(ui.info("callEstablished from "+N.getContact().getUsername(),ee),N.getStatus()!==i.g.DATACHANNEL_STATUS_ONGOING&&N.getStatus()!==i.g.DATACHANNEL_STATUS_ENDED&&ce.get(Vt(N)).emit("accepted"))}).onEvent("hangup",function(ee){var te=ee.detail.callId.toString(),$=N.getStatus()===i.g.DATACHANNEL_STATUS_WAITING&&"remote"===ee.detail.hangupType;N.getId()===te&&N.getStatus()!==i.g.DATACHANNEL_STATUS_ENDED&&(Mn.set(Vt(N),i.g.DATACHANNEL_STATUS_ENDED),ui.info("Hangup from "+N.getContact().getUsername(),ee),ce.get(Vt(N)).emit("ended",{from:ee.detail.hangupType}),$&&ce.get(Vt(N)).emit("declined"))}).onEvent("onFileReceived",function(ee){if(ee.detail.callId.toString()===N.getId()){var te=ee.detail.data,$=new FileReader;$.addEventListener("loadend",function(){try{var ue=W.g.arrayBuffertoString($.result);ui.info("dataReceived !"),ce.get(Vt(N)).emit("dataReceived",{uuid:te.uuid,data:ue})}catch(Ie){ui.error("dataReceived Error",Ie)}}),$.readAsArrayBuffer(te.file)}}).onEvent("onFileProgress",function(ee){if(ee.detail.callId.toString()===N.getId()){var te=ee.detail;ui.trace("file transfering",te);var $={uuid:te.uuid,fileSize:te.fileSize,remainingSize:te.remainingSize,percentage:te.percentage,sendChunkNb:te.sendChunkNb,transferDuration:te.transferDuration,lastPacket:te.lastPacket};ce.get(Vt(N)).emit("transferProgress",$),te.transferEnded&&ce.get(Vt(N)).emit("transferComplete",$)}}).onEvent("receiveDataChannelError",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&ce.get(Vt(N)).emit("error","receiveDataChannelError")}).onEvent("sendDataChannelError",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&ce.get(Vt(N)).emit("error","sendDataChannelError")}).onEvent("receiveDataChannelClose",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&ce.get(Vt(N)).emit("closed")}).onEvent("sendDataChannelClose",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&ce.get(Vt(N)).emit("closed")}).onEvent("receiveDataChannelOpen",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&(Mn.set(Vt(N),i.g.DATACHANNEL_STATUS_ONGOING),ce.get(Vt(N)).emit("opened"))}).onEvent("sendDataChannelOpen",function(ee){var te=ee.detail.callId.toString();N.getId()===te&&ce.get(Vt(N)).emit("opened")}),N}return O=G,E=[{key:"getAvailableEvents",value:function(){return ea}}],(B=[{key:"getId",value:function(){return ta.get(this).toString()}},{key:"getContact",value:function(){return oa.get(this)}},{key:"getType",value:function(){return Wn.get(this)}},{key:"getStatus",value:function(){return Mn.get(this)}},{key:"sendData",value:function(r){var s=this;return new Promise(function(N,q){var ee=!1;s.getStatus()!==i.g.DATACHANNEL_STATUS_ONGOING?q(W.g.createError(i.g.ERROR_OTHER,"Cannot send data as datachannel session is not ongoing",ui)):s.getType()!==i.g.DATACHANNEL_TYPE_SEND?q(W.g.createError(i.g.ERROR_OTHER,"Cannot send data as datachannel session is receiving only",ui)):xn.webRTCClient.sendDataWithCallId(s.getId(),{file:r},function(te){ee||(ee=!0,N(te.uuid)),ui.trace("sendData() - progress : ",te);var $={uuid:te.uuid,fileSize:te.fileSize,remainingSize:te.remainingSize,percentage:te.percentage,sendChunkNb:te.sendChunkNb,transferDuration:te.transferDuration,lastPacket:te.lastPacket};ce.get(s).emit("transferProgress",$),te.transferEnded&&ce.get(s).emit("transferComplete",$)})})}},{key:"close",value:function(){this.getStatus()===i.g.DATACHANNEL_STATUS_ENDED?ui.error("close() - DataChannel session has already ended"):xn.webRTCClient.hangUp(this.getId())}}])&&di(O.prototype,B),E&&di(O,E),G}(Ne);function zn(D){return(zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ia(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function sa(D,O){return(sa=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Ea(D,O){if(O&&("object"===zn(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return ha(D)}function ha(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Yn(D){return(Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var na=R.Y.get("ReceivedInvitation"),pa=["expired","statusChange"],hn=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&sa(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=Yn(U);if(ae){var N=Yn(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Ea(this,r)});function G(r,s){var N;return function(q,ee){if(!(q instanceof ee))throw new TypeError("Cannot call a class as a function")}(this,G),N=pe.call(this,r,s),na.info("Create ReceivedDataChannelInvitation "),N.type="dataChannel",N.apiRTCManager.onEvent("hangup",function(q){var ee=q.detail.callId.toString();N.id.toString()===ee&&N.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(N.setStatus(i.g.INVITATION_STATUS_EXPIRED),ce.get(ha(N)).emit("expired"))}),N}return O=G,E=[{key:"getAvailableEvents",value:function(){return pa}}],(B=[{key:"accept",value:function(){var r=this;return new Promise(function(s,N){if(r.getStatus()===i.g.INVITATION_STATUS_STANDBY){r.setStatus(i.g.INVITATION_STATUS_ACCEPTED),r.apiRTCManager.sendData(r.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:r.id,answer:"accept"});var q=new Jn(r.id,r.sender,{started:!0,type:i.g.DATACHANNEL_TYPE_SEND});r.apiRTCManager.webRTCClient.acceptCall(r.id,{mediaTypeForIncomingCall:"DATA"}),s(q)}else N(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this datachannel session, invitation state invalid",na))})}},{key:"decline",value:function(r){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:r,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}}])&&ia(O.prototype,B),E&&ia(O,E),G}(m);function fa(D){return(fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ba(D,O){return(ba=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function jn(D,O){if(O&&("object"===fa(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function aa(D){return(aa=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var la=R.Y.get("ReceivedInvitation"),Vn=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&ba(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=aa(E);if(U){var s=aa(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return jn(this,G)});function pe(G,r,s){var N;return function(q,ee){if(!(q instanceof ee))throw new TypeError("Cannot call a class as a function")}(this,pe),N=ae.call(this,G,s),la.info("Create ReceivedConversationJoinRequest"),N.type="conversationJoinRequest",N.conversation=r||null,N}return(B=[{key:"getConversation",value:function(){return this.conversation}},{key:"accept",value:function(){var G=this;return new Promise(function(r,s){G.getStatus()===i.g.INVITATION_STATUS_STANDBY?(G.setStatus(i.g.INVITATION_STATUS_ACCEPTED),G.conversation?G.conversation.allowEntry(G.sender,{invitationId:G.id,answer:"accept",ackEnabled:!0}).then(r).catch(s):(G.apiRTCManager.sendData(G.sender.getId(),{roomname:G.id,event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:G.id,answer:"accept",command:"access",value:{access:!0}}),r())):s(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot accept request, invitation state invalid",la))})}},{key:"decline",value:function(G){var r=this;return new Promise(function(s,N){r.getStatus()===i.g.INVITATION_STATUS_STANDBY?(r.setStatus(i.g.INVITATION_STATUS_DECLINED),r.conversation?r.conversation.denyEntry(r.sender,{invitationId:r.id,answer:"decline",reason:G}).then(s).catch(N):(r.apiRTCManager.sendData(r.sender.getId(),{roomname:r.id,event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:r.id,reason:G,answer:"decline",command:"access",value:{access:!1}}),s())):N(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"decline() - Cannot decline request, invitation state invalid",la))})}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(m);function Fn(D){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ma(D,O){return(ma=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function g(D,O){if(O&&("object"===Fn(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function k(D){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var J=R.Y.get("ReceivedInvitation"),Z=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&ma(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=k(E);if(U){var s=k(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return g(this,G)});function pe(G,r,s){var N;return function(q,ee){if(!(q instanceof ee))throw new TypeError("Cannot call a class as a function")}(this,pe),(N=ae.call(this,G,r)).session=s,N.type="pointerSharing",N}return(B=[{key:"accept",value:function(){var G=this;return new Promise(function(r,s){G.getStatus()===i.g.INVITATION_STATUS_STANDBY?(G.setStatus(i.g.INVITATION_STATUS_ACCEPTED),G.session.joinPointerSharingRoom(G.id).then(r).catch(function(N){s(W.g.createError(i.g.ERROR_OTHER,"accept() - cannot accept invitation",J))})):s(W.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - cannot accept invitation",J))})}},{key:"decline",value:function(G){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&this.setStatus(i.g.INVITATION_STATUS_DECLINED)}}])&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(m),he=e(9852),fe=e.n(he);function ve(D){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function _e(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function De(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}e(4723),e(4812),e(9601);var Ve=R.Y.get("UserData"),Ye=Rt.get(),ot=function(){function D(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var ae in _e(this,D),U)U.hasOwnProperty(ae)&&(this[ae]=U[ae])}var O,B,E;return O=D,E=[{key:"equals",value:function(U,ae){if(!(U instanceof Object&&ae instanceof Object))return!1;for(var pe in U)if(void 0===ae[pe]||"object"===ve(ae[pe])&&!this.equals(ae[pe],U[pe])||ae[pe]!==U[pe])return!1;for(var G in ae)if(void 0===U[G]||"object"===ve(U[G])&&!this.equals(U[G],ae[G])||U[G]!==ae[G])return!1;return!0}}],(B=[{key:"get",value:function(U){return this.hasOwnProperty(U)&&void 0!==this[U]&&"null"!==this[U]&&null!==this[U]?this[U]:null}},{key:"setToSession",value:function(){try{var U={};for(var ae in this)this.hasOwnProperty(ae)&&"function"!=typeof this[ae]&&(U[ae]=this[ae]);Ye.apiRTCSession.setUserData(U)}catch(pe){Ve.error("setUserData() - could not set userData")}}},{key:"setProp",value:function(U,ae){return this[U]=ae,this}},{key:"setProps",value:function(U){for(var ae in U)U.hasOwnProperty(ae)&&(this[ae]=U[ae]);return this}}])&&De(O.prototype,B),E&&De(O,E),D}();function Je(D){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Xe(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Te(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function j(D,O){return(j=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function se(D,O){if(O&&("object"===Je(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Me(D)}function Me(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Le(D){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var $e=R.Y.get("SentInvitation"),mt=["response","receive","statusChange"],St=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&j(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=Le(U);if(ae){var N=Le(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return se(this,r)});function G(r,s){var N,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Xe(this,G),(N=pe.call(this)).conversation=s,$e.info("Create SentInvitation"),N.destination=r,N.id=W.g.guid(),N.sendTime=Date.now(),N.expirationTime=null,N.expirationTimeout=null,q.hasOwnProperty("expirationTime")&&(N.expirationTime=q.expirationTime,N.expirationTimeout=setTimeout(function(){N.getStatus()===i.g.INVITATION_STATUS_STANDBY&&($e.info("Conversation invitation expired"),N.setStatus(i.g.INVITATION_STATUS_EXPIRED),ce.get(Me(N)).emit("response",N.getStatus()))},q.expirationTime)),q.hasOwnProperty("receiveNotifier")&&q.receiveNotifier.on("receive",function(){ce.get(Me(N)).emit("receive")}),N.apiRTCManager.onEvent("receiveData",function(ee){void 0!==ee.detail.data.event&&ee.detail.data.event===i.g.INVITATION_ANSWER_IDENTIFIER&&ee.detail.data.invitationId.toString()===N.id.toString()&&N.getStatus()===i.g.INVITATION_STATUS_STANDBY&&($e.info("Received invitation answer for "+N.id,ee.detail.data),null!==N.expirationTimeout&&clearTimeout(N.expirationTimeout),N.setStatus("accept"===ee.detail.data.answer?i.g.INVITATION_STATUS_ACCEPTED:i.g.INVITATION_STATUS_DECLINED),ce.get(Me(N)).emit("response",N.getStatus()))}),N.apiRTCManager.onEvent("hangup",function(ee){$e.debug("hangup");var te=ee.detail.callId.toString();N.getId()===te&&($e.debug("hangup for sentInvitation"),N.setStatus(i.g.INVITATION_STATUS_ENDED))}),N}return O=G,E=[{key:"getAvailableEvents",value:function(){return mt}}],(B=[{key:"getId",value:function(){return this.id}},{key:"onResponse",value:function(r){this.on("response",r)}},{key:"cancel",value:function(){$e.info("cancel"),"sendFile"===this.type?($e.info("cancel sendfile"),this.apiRTCManager.webRTCClient.hangUp(this.id)):$e.warn("cancel is not managed for invitation with type :",this.type)}}])&&Te(O.prototype,B),E&&Te(O,E),G}(M);function Xt(D){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Ht(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return Qt(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?Qt(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function Qt(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function li(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Li(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function bi(D,O){return(bi=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Vi(D,O){if(O&&("object"===Xt(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return $t(D)}function $t(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function wi(D){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var Dt=R.Y.get("Contact"),ii=Rt.get(),hi=new(fe()),tn=Ni.get(),In=["message","conversationInvitation","data","joinGroup","leaveGroup","whiteboardInvitation","fileSentSuccessfully","fileTransferInvitation","fileTransferProgress","dataChannelInvitation","incomingCall","newMediaAvailable","customEvent","fileTransferError","incomingScreenSharingCall","incomingScreenSharingCallInvitation"],An=new WeakMap,Zt=new WeakMap,Si=new Map,Ei=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&bi(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=wi(U);if(ae){var N=wi(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Vi(this,r)});function G(r){var s,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return li(this,G),s=pe.call(this,Dt),Dt.debug("Create Contact with id "+r),Dt.debug("Create Contact with userData :",N),Zt.set($t(s),r.toString()),s.groups=[],s.previousMessages=[],s.userData=new ot(N),s.enterprise=null,s.streams=new Map,s.profile=null,s.fileTransfers=[],An.set($t(s),[]),ii.onEvent("roomInvitation",function(q){if(null!=q.detail.senderId&&"whiteBoard"===q.detail.roomType&&q.detail.senderId.toString()===s.getId()){Dt.info("Received whiteboard invitation from "+s.getUsername());var ee={};q.detail.cloudConvId&&(ee.cloudConvId=q.detail.cloudConvId),!0===q.detail.webconf&&(ee.webconf=!0),ce.get($t(s)).emit("whiteboardInvitation",new Bt($t(s),q.detail.roomId,ee))}}).onEvent("receiveIMMessage",function(q){q.detail.senderId.toString()===s.getId()&&(ce.get($t(s)).emit("message",{content:q.detail.message,uuid:q.detail.UUCSeq,time:q.detail.time}),s.addMessageToHistory(q.detail.message,Math.round(q.detail.time.getTime()/1e3),q.detail.UUCSeq,!0))}).onEvent("receiveData",function(q){if(q.detail.senderId.toString()===s.getId()){Dt.debug("Received data e.detail.data : ",q.detail.data);var ee=q.detail.data,te=null,$=rn.get();if(void 0!==ee.roomname&&(te=$.isConference(ee.roomname)?$.getOrCreateConference($.getNameFromTechnicalName(ee.roomname)):$.getOrCreateConversation($.getNameFromTechnicalName(ee.roomname))),void 0!==ee.event)switch(ee.event){case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:case i.g.INVITATION_ANSWER_IDENTIFIER:break;case i.g.CONTACT_SEND_DATA_IDENTIFIER:Dt.trace("Received data from "+s.getUsername(),ee.content),ce.get($t(s)).emit("data",ee.content);break;case i.g.CONVERSATION_INVITATION_IDENTIFIER:if(null!==te){Dt.debug("Received conversation invitation from "+s.getId());var ue={};ee.hasOwnProperty("password")&&(ue.password=ee.password),ce.get($t(s)).emit("conversationInvitation",new ye($t(s),ee,te,ue))}break;case i.g.CONTACT_SEND_FILEINFO_IDENTIFIER:Dt.debug("Received file info from "+s.getUsername(),ee.fileInfo);var Ie=ee.callId.toString();if(W.g._private.dataCallsFileInfo.set(Ie,ee.fileInfo),W.g._private.dataCallsOnHold.has(Ie)){var Ue=null;apiRTC.userAgentInstance.currentSession.invitationsMap.has(s.getId()+"-sendfile-"+Ie)?(Ue=apiRTC.userAgentInstance.currentSession.invitationsMap.get(s.getId()+"-sendfile-"+Ie),Dt.debug("invitation already exist :",Ue)):(Ue=new Tn($t(s),Ie,ee.fileInfo),apiRTC.userAgentInstance.currentSession.invitationsMap.set(s.getId()+"-sendfile-"+Ie,Ue)),ce.get($t(s)).emit("fileTransferInvitation",Ue)}break;case i.g.CONTACT_DATACHANNEL_INVITATION:Dt.debug("Received datachannel invitation from "+s.getUsername()),W.g._private.dataChannelInvitations.set(ee.callId.toString(),!0),W.g._private.dataCallsOnHold.has(ee.callId.toString())&&ce.get($t(s)).emit("dataChannelInvitation",new hn($t(s),ee.callId.toString()));break;case i.g.CONTACT_NEW_MEDIA_IDENTIFIER:Dt.debug("New media available from "+s.getUsername(),ee.fileinfo),ce.get($t(s)).emit("newMediaAvailable",{media:ee.media});break;case i.g.CONTACT_EVENTCENTER_DATA_REQUEST:Dt.debug("New request for event center data from "+s.getUsername());var vt=apiRTC.eventCenter.getStoredData();if(void 0===vt)return void Dt.error("Can't send event center stored data, it's undefined");Dt.debug("Sending requested event center data"),s.sendCustomEvent(i.g.CONTACT_EVENTCENTER_DATA_ANSWER,{data:vt});break;case i.g.CONTACT_EVENTCENTER_DATA_ANSWER:if(Dt.debug("New event center data from "+s.getUsername()),void 0===ee.data)return void Dt.error("Can't handle remote event center data, it's undefined");apiRTC.eventCenter.handleDataAnswer(ee.data);break;case i.g.CONTACT_GET_CAPABILITIES_IDENTIFIER:Dt.debug("New getCapabilities from "+ee.requesterId+" on stream "+ee.streamId);var pt=s.getLocalStreamWithCallId(ee.streamId),kt=Ii.getActiveSession().getOrCreateContact(ee.requesterId),Ut=Ii.getActiveSession().getActiveConversations(),fi=null;Object.keys(Ut).forEach(function(Kn){ee.streamActiveConversations.forEach(function(wa){wa===Kn&&(fi=Kn)})});var $i={roomName:fi,streamId:ee.streamId},ln=pt.getCapabilities();ln.hasOwnProperty("error")?($i.error=!0,$i.errorMessage=ln.errorMessage):$i.capabilities=ln,kt.sendCustomEvent(i.g.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER,$i);break;case i.g.CONTACT_GET_SETTINGS_IDENTIFIER:Dt.debug("New getSettings from "+ee.requesterId+" on stream "+ee.streamId);var hr=s.getLocalStreamWithCallId(ee.streamId),ja=Ii.getActiveSession().getOrCreateContact(ee.requesterId),qn=Ii.getActiveSession().getActiveConversations(),Qa=null;if(Object.keys(qn).forEach(function(Kn){ee.streamActiveConversations.forEach(function(wa){wa===Kn&&(Qa=Kn)})}),null!==ja){var Pr={roomName:Qa,streamId:ee.streamId,settings:hr.getSettings()};ja.sendCustomEvent(i.g.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER,Pr)}break;case i.g.CONTACT_GET_CONSTRAINTS_IDENTIFIER:Dt.debug("New getConstraints from "+ee.requesterId+" on stream "+ee.streamId);var Ur=s.getLocalStreamWithCallId(ee.streamId),po=Ii.getActiveSession().getOrCreateContact(ee.requesterId),ns=Ii.getActiveSession().getActiveConversations(),fo=null;if(Object.keys(ns).forEach(function(Kn){ee.streamActiveConversations.forEach(function(wa){wa===Kn&&(fo=Kn)})}),null!==po){var as={roomName:fo,streamId:ee.streamId,constraints:Ur.getConstraints()};po.sendCustomEvent(i.g.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER,as)}break;case i.g.CONTACT_SET_CONSTRAINTS_IDENTIFIER:var mo=s.getLocalStreamWithCallId(ee.streamId);mo.authorizedRemoteCapabilityContacts.indexOf(ee.requestorId)>-1&&mo.setCapability(ee.capability,ee.value);break;case i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_IDENTIFIER:Dt.debug("New getConstraints from "+ee.requesterId+" on stream "+ee.streamId);var rs=s.getLocalStreamWithCallId(ee.streamId),go=Ii.getActiveSession().getOrCreateContact(ee.requesterId),os=Ii.getActiveSession().getActiveConversations(),vo=null;Object.keys(os).forEach(function(Kn){ee.streamActiveConversations.forEach(function(wa){wa===Kn&&(vo=Kn)})}),null!==go&&rs.sendRemoteCapabilityRequest({roomName:vo,streamId:ee.streamId,requestor:go});break;case i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_ACCEPT_IDENTIFIER:var Co=rn.get(),bo=Co.getOrCreateConversation(Co.getNameFromTechnicalName(ee.roomName)).getSubscribedStream(ee.streamId);null!==bo?bo.sendRemoteCapabilityRequestAccepted(ee.requestorId):Dt.error("Something went wrong during remote stream acceptation process");break;case i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_REFUSE_IDENTIFIER:var yo=rn.get(),So=yo.getOrCreateConversation(yo.getNameFromTechnicalName(ee.roomName)).getSubscribedStream(ee.streamId);null!==So?So.sendRemoteCapabilityRequestRefused(ee.requestorId):Dt.error("Something went wrong during remote stream acceptation process");break;case i.g.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER:var To=rn.get(),Io=To.getOrCreateConversation(To.getNameFromTechnicalName(ee.roomName)).getSubscribedStream(ee.streamId),pr={};ee.hasOwnProperty("error")&&ee.hasOwnProperty("errorMessage")?(pr.error=ee.error,pr.errorMessage=ee.errorMessage):pr=ee.capabilities,null!==Io?Io.sendRemoteStreamCapabilities(pr):Dt.error("Something went wrong during remote stream getCapabilities process");break;case i.g.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER:var Ro=rn.get(),wo=Ro.getOrCreateConversation(Ro.getNameFromTechnicalName(ee.roomName)).getSubscribedStream(ee.streamId),fr={};ee.hasOwnProperty("error")&&ee.hasOwnProperty("errorMessage")?(fr.error=ee.error,fr.errorMessage=ee.errorMessage):fr=ee.settings,null!==wo?wo.sendRemoteStreamSettings(fr):Dt.error("Something went wrong during remote stream getSettings process");break;case i.g.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER:var Eo=rn.get(),Mo=Eo.getOrCreateConversation(Eo.getNameFromTechnicalName(ee.roomName)).getSubscribedStream(ee.streamId),mr={};ee.hasOwnProperty("error")&&ee.hasOwnProperty("errorMessage")?(mr.error=ee.error,mr.errorMessage=ee.errorMessage):mr=ee.constraints,null!==Mo?Mo.sendRemoteStreamConstraints(mr):Dt.error("Something went wrong during remote stream getConstraints process");break;default:var Ao={event:ee.event,content:ee};null!==te&&(Ao.conversation=te),ce.get($t(s)).emit("customEvent",Ao)}}}).onEvent("incomingCall",function(q){if(q.detail.callerId.toString()===s.getId()){var ee=q.detail.callId.toString();if("data"===q.detail.callType)if(Dt.debug("Received file transfer invitation from "+s.getUsername()),W.g._private.dataCallsFileInfo.has(ee)){var te=W.g._private.dataCallsFileInfo.get(ee),$=null;apiRTC.userAgentInstance.currentSession.invitationsMap.has(s.getId()+"-sendfile-"+ee)?($=apiRTC.userAgentInstance.currentSession.invitationsMap.get(s.getId()+"-sendfile-"+ee),Dt.debug("invitation already exist :",$)):($=new Tn($t(s),ee,te),apiRTC.userAgentInstance.currentSession.invitationsMap.set(s.getId()+"-sendfile-"+ee,$)),ce.get($t(s)).emit("fileTransferInvitation",$)}else W.g._private.dataChannelInvitations.has(ee)?ce.get($t(s)).emit("dataChannelInvitation",new hn($t(s),ee)):(Dt.info("File information has not been received yet, putting invitation on hold"),W.g._private.dataCallsOnHold.set(ee));else if("screenSharing"===q.detail.callType)if(!0===apiRTC.session.apiCCWebRTCClient.webRTCClient.userAcceptOnIncomingScreenSharingCall){Dt.debug("Received screenSharingCallInvitation from "+s.getUsername());var ue=new Pi($t(s),ee,q.detail.callType,{isRecorded:!!q.detail.hasOwnProperty("recordedCall")&&q.detail.recordedCall});ce.get($t(s)).emit("incomingScreenSharingCallInvitation",ue)}else{Dt.debug("Received screenSharingCall from "+s.getUsername());var Ie=tn.getOrCreateCall(ee,$t(s),{started:!0,isRecorded:!!q.detail.hasOwnProperty("recordedCall")&&q.detail.recordedCall});ce.get($t(s)).emit("incomingScreenSharingCall",Ie)}else Dt.info("Received call invitation from "+s.getUsername()),ce.get($t(s)).emit("incomingCall",new Pi($t(s),ee,q.detail.callType,{isRecorded:!!q.detail.hasOwnProperty("recordedCall")&&q.detail.recordedCall}))}}).onEvent("hangup",function(q){var ee=q.detail.callId.toString();s.getId()===q.detail.remoteId.toString()&&(Dt.debug("hangup event :",q.detail),s.fileTransfers.includes(ee)&&(Dt.info("File transfer finished from "+s.getUsername()),s.fileTransfers.splice(s.fileTransfers.indexOf(ee),1)))}).onEvent("sendDataChannelError",function(q){var ee=q.detail.callId.toString();s.getId()===q.detail.remoteId.toString()&&s.fileTransfers.includes(ee)&&(Dt.info("File transfer error from "+s.getUsername()),ce.get($t(s)).emit("fileTransferError",{error:"sendDataChannelError",invitationId:ee}))}),s}return O=G,B=[{key:"getId",value:function(){return Zt.get(this)}},{key:"id",get:function(){return Dt.warn("contact.id is deprecated, please use contact.getId() instead"),this.getId()}},{key:"fetchProfileInformation",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(N,q){null===r.profile||s?hi.getUserProfile(ii.getActiveApiKey(),r.getId()).then(function(ee){r.profile=ee,N(ee)}).catch(q):N(r.profile)})}},{key:"getActiveStreams",value:function(){return this.streams.values()}},{key:"getLocalStreamWithCallId",value:function(r){for(var s=null,N=wn.getLocalStreams(),q=N.next();!q.done;){for(var ee=q.value,te=ee.publishedInConversations.values(),$=te.next();!$.done;)$.value===r&&(s=ee),$=te.next();q=N.next()}return s}},{key:"addMessageToHistory",value:function(r,s,N,q){-1===An.get(this).indexOf(N.toString())&&(this.previousMessages.push({content:r,timestamp:s,uuid:N,fromContact:q}),An.get(this).push(N.toString()))}},{key:"getPreviousMessages",value:function(){return this.previousMessages.sort(function(r,s){return new Date(s.timestamp)-new Date(r.timestamp)}),this.previousMessages}},{key:"getUserData",value:function(){return this.userData}},{key:"getUsername",value:function(){return null!==this.userData.get("username")?this.userData.get("username"):null!==this.userData.get("nickname")?this.userData.get("nickname"):this.getId()}},{key:"getPhotoUrl",value:function(){return null!==this.userData.get("photo_url")?this.userData.get("photo_url"):null!==this.userData.get("photoUrl")?this.userData.get("photoUrl"):hi.getUserPhotoUrl(this.getId())}},{key:"fetchWebSessionInformation",value:function(r){var s=this;return new Promise(function(N,q){r instanceof Ii?Si.has(s.getId()+":"+r.getId())?N(Si.get(s.getId()+":"+r.getId())):hi.getWebSession(r,s,ii.getActiveApiKey()).then(function(ee){Si.set(s.getId()+":"+r.getId(),ee),N(ee)}).catch(function(ee){q(W.g.createError(i.g.ERROR_OTHER,"fetchWebSessionInformation() - could not fetch web session information",Dt))}):q(W.g.createError(i.g.ERROR_BAD_PARAMETER,"fetchWebSessionInformation() - parameter is not an instance of apiRTC.Session",Dt))})}},{key:"loadMessageHistory",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(q,ee){s.fetchWebSessionInformation(r).then(function(te){return hi.getSessionHistory(te.webSessionId,r.getToken(),N)}).then(function(te){Dt.debug("loadMessageHistory() - got messages",te.messages);var $,ue=Ht(te.messages);try{for(ue.s();!($=ue.n()).done;){var Ie=$.value;s.addMessageToHistory(Ie.value,Ie.timestamp,Ie.uuid,Ie.destId.toString()!==s.getId())}}catch(Ue){ue.e(Ue)}finally{ue.f()}q()}).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"loadMessageHistory() - could not load session history",Dt))})})}},{key:"addToGroup",value:function(r){this.inGroup(r)||(this.groups.push(r),ce.get(this).emit("joinGroup",r))}},{key:"removeFromGroup",value:function(r){this.inGroup(r)&&(this.groups.splice(this.groups.indexOf(r),1),ce.get(this).emit("leaveGroup",r))}},{key:"inGroup",value:function(r){return this.groups.includes(r)}},{key:"isOnline",value:function(){return 0!==this.groups.length}},{key:"sendData",value:function(r){var s=this;return this.isOnline()||Dt.warn("sendData() - contact "+this.getUsername()+" does not seem to be connected."),new Promise(function(N,q){ii.sendData(s.getId(),{event:i.g.CONTACT_SEND_DATA_IDENTIFIER,content:r}).then(N).catch(function(ee){switch(ee){case i.g.ERROR_TIMED_OUT:q(W.g.createError(i.g.ERROR_TIMED_OUT,"sendData() - Data transmission timed out ",Dt));break;case i.g.ERROR_NOT_FOUND:q(W.g.createError(i.g.ERROR_NOT_FOUND,"sendData() - Contact was not found ",Dt));break;default:q(W.g.createError(i.g.ERROR_OTHER,"sendData() - Data transmission timed out ",Dt))}})})}},{key:"sendCustomEvent",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isOnline()||Dt.warn("sendCustomEvent() - contact "+this.getUsername()+" does not seem to be connected."),new Promise(function(q,ee){var te=N;te.event=r,ii.sendData(s.getId(),te).then(q).catch(function($){switch($){case i.g.ERROR_TIMED_OUT:ee(W.g.createError(i.g.ERROR_TIMED_OUT,"sendCustomEvent() - Data transmission timed out ",Dt));break;case i.g.ERROR_NOT_FOUND:ee(W.g.createError(i.g.ERROR_NOT_FOUND,"sendCustomEvent() - Contact was not found ",Dt));break;default:ee(W.g.createError(i.g.ERROR_OTHER,"sendCustomEvent() - Data transmission timed out ",Dt))}})})}},{key:"sendMessage",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isOnline()||Dt.warn("sendMessage() - contact "+this.getUsername()+" does not seem to be connected.");var q=null,ee=function(){return new Promise(function(te,$){N.hasOwnProperty("session")?s.fetchWebSessionInformation(N.session).then(function(ue){te({save:!0,cloudSessionId:ue.webSessionId,apiRTCId:N.session.getId()})}).catch($):te({})})};return new Promise(function(te,$){"string"!=typeof r?$(W.g.createError(i.g.ERROR_BAD_PARAMETER,"sendMessage() - message parameter is not instance of string",Dt)):ee().then(function(ue){return Dt.info("sendMessage() - with options :",q=ue),ii.sendMessage(s.getId(),r,q)},function(ue){$(W.g.createError(i.g.ERROR_OTHER,"sendMessage() - Error occured when fetching options for sending message",Dt))}).then(function(ue){s.addMessageToHistory(r,Math.floor(Date.now()/1e3),ue,!1),te(ue)},function(ue){switch(ue){case i.g.ERROR_TIMED_OUT:$(W.g.createError(i.g.ERROR_TIMED_OUT,"sendMessage() - Data transmission timed out ",Dt));break;case i.g.ERROR_NOT_FOUND:$(W.g.createError(i.g.ERROR_NOT_FOUND,"sendMessage() - Contact was not found ",Dt));break;default:$(W.g.createError(i.g.ERROR_OTHER,"sendMessage() - Data transmission timed out ",Dt))}})})}},{key:"inviteTo",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sendConversationInvitation(r,s)}},{key:"sendConversationInvitation",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r instanceof Gt?r.sendInvitation(this,s):(Dt.error("sendConversationInvitation() - Parameter is not a conversation"),null)}},{key:"sendWhiteboardInvitation",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ii.whiteBoardClient.roomId!==r&&(ii.whiteBoardClient.leaveRoom(),ii.whiteBoardClient.start(),ii.whiteBoardClient.joinRoom(r));var N=s.context?s.context:null,q={};s.cloudConversationId&&(q.convId=s.cloudConversationId),ii.whiteBoardClient.inviteInRoom(r,this.getId(),N,q);var ee=new St(this,null);return ee.id="wb-"+r,ee.type="whiteboard",ee}},{key:"call",value:function(r){var s,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{mediaTypeForOutgoingCall:"VIDEO",record:!1};this.isOnline()||Dt.warn("call() - contact "+this.getUsername()+" does not seem to be connected.");var q={},ee=W.g.assignObject({},N),te=!!N.hasOwnProperty("audioOnly")&&N.audioOnly;N.hasOwnProperty("record")&&(null!=ee.record||(ee.record=N.record)),null!==r&&r instanceof wn&&(ee.userMediaStreamId=r.userMediaStreamId,r.isScreensharing()&&(ee.forceCallType="screenSharing")),ee.cloudConversationId&&(q.cloudConvId=ee.cloudConversationId,delete ee.cloudConversationId),s=te?ii.webRTCClient.callAudio(this.getId(),q,ee):ii.webRTCClient.call(this.getId(),q,ee);var $=tn.getOrCreateCall(s,this,{isRecorded:ee.record});return $}},{key:"shareScreen",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isOnline()||Dt.warn("call() - contact "+this.getUsername()+" does not seem to be connected.");var s={},N=null,q=r,ee=r.captureSourceType;Dt.warn("call() - contact "+this.getUsername()+" does not seem to be connected."),N=ii.webRTCClient.shareScreen(this.getId(),s,ee);var te=tn.getOrCreateCall(N,this,{isRecorded:q.record});return te}},{key:"startDataChannel",value:function(){if(this.isOnline()||Dt.warn("startDataChannel() - contact "+this.getUsername()+" does not seem to be connected."),!("Edge"===v.Xh&&v.PR<79)){var r=ii.webRTCClient.startDataChannel(this.getId());return ii.sendData(this.getId(),{callId:r,event:i.g.CONTACT_DATACHANNEL_INVITATION}),new Jn(r,this,{type:i.g.DATACHANNEL_TYPE_SEND})}Dt.warn("Cannot startDataChannel as it is not supported on Edge")}},{key:"sendFile",value:function(r,s){if(this.isOnline()||Dt.warn("sendFile() - contact "+this.getUsername()+" does not seem to be connected."),"Edge"===v.Xh&&v.PR<79)return Dt.warn("Cannot sendFile as Datachannel is not supported on Edge"),null;var N=ii.webRTCClient.startDataChannel(this.getId()),q=this;if(void 0===N)return Dt.warn("Error on startDataChannel"),null;ii.sendData(this.getId(),{fileInfo:r,callId:N,event:i.g.CONTACT_SEND_FILEINFO_IDENTIFIER}),ii.onEvent("sendDataChannelOpen",function te($){Dt.debug("sendFile() - DataChannel open",$.detail),$.detail.callId.toString()===N.toString()&&(ii.webRTCClient.sendDataWithCallId(N,{file:s,name:r.name,type:r.type},function(ue){Dt.trace("sendFile() - progress : ",ue);var Ie={uuid:ue.uuid,fileSize:ue.fileSize,remainingSize:ue.remainingSize,percentage:ue.percentage,sendChunkNb:ue.sendChunkNb,transferDuration:ue.transferDuration,lastPacket:ue.lastPacket};ce.get(q).emit("fileTransferProgress",{fileInfo:r,transferInformation:Ie}),ue.transferEnded&&ce.get(q).emit("fileSentSuccessfully",{fileInfo:r,transferInformation:Ie})}),ii.removeEventListener("sendDataChannelOpen",te))}),this.fileTransfers.push(N.toString());var ee=new St(this,null);return ee.id=N.toString(),ee.type="sendFile",ee.on("response",function(){ee.getStatus()!==i.g.INVITATION_STATUS_ACCEPTED&&Dt.log("sendFile() - invitation has not been accepted, cleaning listeners")}),ee}},{key:"pushMedia",value:function(r,s){var N=this,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(ee,te){N.fetchWebSessionInformation(s).then(function($){return q.token=s.token,hi.pushConversationMedia($.conversationId,r,ii.getActiveApiKey(),q)}).then(function($){ii.sendData(N.getId(),{event:i.g.CONTACT_NEW_MEDIA_IDENTIFIER,media:{url:$.url,id:$.id}}),ee({url:$.url,id:$.id})}).catch(function($){te(W.g.createError(i.g.ERROR_OTHER,"pushMedia() - failed to push media",Dt))})})}},{key:"fetchMediaList",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Dt.debug("fetchMediaList()"),new Promise(function(q,ee){s.fetchWebSessionInformation(r).then(function(te){return N.token=r.getToken(),hi.getConversationMediaList(te.conversationId,ii.getActiveApiKey(),N)}).then(q).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"getMediaList() - failed to get media list",Dt))})})}},{key:"sendEventCenterDataRequest",value:function(){return this.sendCustomEvent(i.g.CONTACT_EVENTCENTER_DATA_REQUEST)}}],E=[{key:"getAvailableEvents",value:function(){return In}}],B&&Li(O.prototype,B),E&&Li(O,E),G}(Ne);function pn(D){return(pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function fn(D,O){return(fn=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function ga(D,O){if(O&&("object"===pn(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function ca(D){return(ca=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var mn=R.Y.get("ConversationCall"),Ti=Rt.get(),Va=function(D){!function(G,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(r&&r.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),r&&fn(G,r)}(pe,D);var B,E,U,ae=(E=pe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(G){return!1}}(),function(){var G,r=ca(E);if(U){var s=ca(this).constructor;G=Reflect.construct(r,arguments,s)}else G=r.apply(this,arguments);return ga(this,G)});function pe(G,r,s){var N;return function(q,ee){if(!(q instanceof ee))throw new TypeError("Cannot call a class as a function")}(this,pe),(N=ae.call(this,mn)).conversation=G,N.callId=r,N.stream=s,N}return B=[{key:"getConversation",value:function(){return this.conversation}},{key:"getCallId",value:function(){return this.callId}},{key:"getStream",value:function(){return this.stream}},{key:"isRecorded",value:function(){return!!this.recordingStatus}},{key:"getRecordingInfo",value:function(){return this.isRecorded()?this.recordingStatus:null}},{key:"isStreamed",value:function(){return!!this.streamingStatus}},{key:"getStreamingInfo",value:function(){return this.isStreamed()?this.streamingStatus:null}},{key:"startRecordingPublishedStream",value:function(G){var r=this;return G||(G={}),new Promise(function(s,N){if(r.asyncCallbacks)return N(W.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - busy",mn));r.asyncCallbacks={},r.asyncCallbacks.timeoutId=setTimeout(function(){return r.asyncCallbacks&&(Ti.removeEventListener("error",r.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - timeout",mn))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),r.asyncCallbacks.error=function($){if(String($.detail.convId)===r.conversation.getCloudConversationId()&&$.detail.callId===r.callId&&$.detail.errorCode.indexOf("START_RECORD")>=0)return r.asyncCallbacks&&(Ti.removeEventListener("error",r.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - "+$.detail.errorInfo,mn))},r.asyncCallbacks.recordingStarted=function($){if(String($.detail.convId)===r.conversation.getCloudConversationId()&&$.detail.callId===r.callId){r.asyncCallbacks&&(Ti.removeEventListener("error",r.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStarted",r.asyncCallbacks.recordingStarted),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks);var ue=W.g.parseRecordingEvent("MCURecordingStarted",$.detail);return s(ue)}},Ti.onEvent("error",r.asyncCallbacks.error),Ti.onEvent("MCURecordingStarted",r.asyncCallbacks.recordingStarted);var q="AUDIO-VIDEO";!0===G.audioOnly?q="AUDIO-ONLY":!0===G.videoOnly&&(q="VIDEO-ONLY");var ee="userStream";W.g.isPropertyTypeof(G,"customIdInFilename","string")&&(ee=G.customIdInFilename);var te={};W.g.isPropertyTypeof(G,"data","object")&&(te=Object.assign({},G.data)),W.g.isPropertyTypeof(G,"ttl","number")&&G.ttl>0&&(te.ttl=G.ttl),Ti.webRTCClient.startRecording(q,ee,r.conversation.getCloudConversationId(),r.callId,te)})}},{key:"stopRecordingPublishedStream",value:function(){var G=this;return new Promise(function(r,s){if(G.asyncCallbacks)return s(W.g.createError(i.g.ERROR_OTHER,"stopRecordingPublishedStream() - busy",mn));G.asyncCallbacks={},G.asyncCallbacks.timeoutId=setTimeout(function(){return G.asyncCallbacks&&(Ti.removeEventListener("error",G.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStopped",G.asyncCallbacks.recordingStopped),delete G.asyncCallbacks),r(G.recordingStatus)},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),G.asyncCallbacks.error=function(N){if(String(N.detail.convId)===G.conversation.getCloudConversationId()&&N.detail.callId===G.callId&&N.detail.errorCode.indexOf("STOP_RECORD")>=0)return G.asyncCallbacks&&(Ti.removeEventListener("error",G.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStopped",G.asyncCallbacks.recordingStopped),clearTimeout(G.asyncCallbacks.timeoutId),delete G.asyncCallbacks),s(W.g.createError(i.g.ERROR_OTHER,"stopRecordingPublishedStream() - "+N.detail.errorInfo,mn))},G.asyncCallbacks.recordingStopped=function(N){if(String(N.detail.convId)===G.conversation.getCloudConversationId()&&N.detail.callId===G.callId){G.asyncCallbacks&&(Ti.removeEventListener("error",G.asyncCallbacks.error),Ti.removeEventListener("MCURecordingStopped",G.asyncCallbacks.recordingStopped),clearTimeout(G.asyncCallbacks.timeoutId),delete G.asyncCallbacks);var q=W.g.parseRecordingEvent("MCURecordingStopped",N.detail);return r(q)}},Ti.onEvent("error",G.asyncCallbacks.error),Ti.onEvent("MCURecordingStopped",G.asyncCallbacks.recordingStopped),Ti.webRTCClient.stopRecording(G.callId)})}},{key:"replacePublishedStream",value:function(G,r){var s=this;return new Promise(function(N,q){if(null===G){if(!W.g.isPropertyTypeof(r,"getStream","function"))return q(new Error("replacePublishedStream() - Cannot replace stream, wrong arguments"));s.stream.publishedInConversations.delete(s.conversation.getName()),s.conversation.conversationPublishedStreams.delete(s.stream.userMediaStreamId);var ee={getUserMediaStreamId:function(){return r.getStream().then(function($){s.stream=$,$.publishedInConversations.set(s.conversation.getName(),s.callId),s.conversation.callIdToStreamId.set(s.callId,$.userMediaStreamId);var ue={contact:null,isRemote:!1,hasAudio:$.hasAudio(),hasVideo:$.hasVideo(),isScreensharing:$.isScreensharing(),streamId:$.userMediaStreamId,callId:s.callId};return s.conversation.conversationPublishedStreams.set($.userMediaStreamId,ue),$.userMediaStreamId}).catch(q)}};Ti.webRTCClient.webRTCClient.addMedia(s.callId,!0,null,ee).then(function($){return N(function(ue){if(Nn.has(ue))return Nn.get(ue);var Ie=apiCC.getUserMediaStream(ue);if(Ie){var Ue="audio";return!0===Ie.video&&(Ue="video"),new wn(Ie.stream,{type:Ue,constructor:!0,userMediaStreamId:Ie.userMediaStreamId})}return null}($))}).catch(function($){return q(new Error("replacePublishedStream() - "+$))})}else{s.stream.publishedInConversations.delete(s.conversation.getName()),s.conversation.conversationPublishedStreams.delete(s.stream.userMediaStreamId),Ti.webRTCClient.webRTCClient.addMedia(s.callId,!0,G.userMediaStreamId).then(function($){return N(G)}).catch(function($){return q(new Error("replacePublishedStream() - "+$))}),s.stream=G,G.publishedInConversations.set(s.conversation.getName(),s.callId),s.conversation.callIdToStreamId.set(s.callId,G.userMediaStreamId);var te={contact:null,isRemote:!1,hasAudio:G.hasAudio(),hasVideo:G.hasVideo(),isScreensharing:G.isScreensharing(),streamId:G.userMediaStreamId,callId:s.callId};s.conversation.conversationPublishedStreams.set(G.userMediaStreamId,te)}})}},{key:"startStreaming",value:function(){var G=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(s,N){return G.asyncCallbacks?N(W.g.createError(i.g.ERROR_OTHER,"startStreaming() - busy",mn)):Ti.webRTCClient.startStreaming(r.service,r.server,r.streamKey,G.callId)?(G.asyncCallbacks={},G.asyncCallbacks.timeoutId=setTimeout(function(){return G.asyncCallbacks&&(Ti.removeEventListener("MCUStreamingStarted",G.asyncCallbacks.streamingStarted),delete G.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"startStreaming() - timeout",mn))},i.g.CONVERSATION_STREAMING_STARTED_DELAY),G.asyncCallbacks.streamingStarted=function(q){if(q.detail.roomName===G.conversation._getTechnicalName()&&q.detail.callId===G.callId){G.asyncCallbacks&&(Ti.removeEventListener("MCUStreamingStarted",G.asyncCallbacks.streamingStarted),clearTimeout(G.asyncCallbacks.timeoutId),delete G.asyncCallbacks);var ee=Sn("MCUStreamingStarted",q.detail);return s(ee)}},void Ti.onEvent("MCUStreamingStarted",G.asyncCallbacks.streamingStarted)):N(W.g.createError(i.g.ERROR_BAD_PARAMETER,"startStreaming() - cannot start streaming",mn))})}},{key:"stopStreaming",value:function(){var G=this;return new Promise(function(r,s){return G.asyncCallbacks?s(W.g.createError(i.g.ERROR_OTHER,"stopStreaming() - busy",mn)):Ti.webRTCClient.stopStreaming(G.callId)?(G.asyncCallbacks={},G.asyncCallbacks.timeoutId=setTimeout(function(){return G.asyncCallbacks&&(Ti.removeEventListener("MCUStreamingStopped",G.asyncCallbacks.streamingStopped),delete G.asyncCallbacks),s(W.g.createError(i.g.ERROR_OTHER,"stopStreaming() - timeout",mn))},i.g.CONVERSATION_STREAMING_STOPPED_DELAY),G.asyncCallbacks.streamingStopped=function(N){if(N.detail.roomName===G.conversation._getTechnicalName()&&N.detail.callId===G.callId){G.asyncCallbacks&&(Ti.removeEventListener("MCUStreamingStopped",G.asyncCallbacks.streamingStopped),clearTimeout(G.asyncCallbacks.timeoutId),delete G.asyncCallbacks);var q=Sn("MCUStreamingStopped",N.detail);return r(q)}},void Ti.onEvent("MCUStreamingStopped",G.asyncCallbacks.streamingStopped)):s(W.g.createError(i.g.ERROR_BAD_PARAMETER,"stopStreaming() - cannot stop streaming",mn))})}},{key:"changeStreamPriority",value:function(G){var r=this;return new Promise(function(s,N){return Ti.webRTCClient.changeStreamPriority(r.callId,G)?(r.conversation.changeStreamPriority(r.stream.userMediaStreamId,!1,G),s()):N(W.g.createError(i.g.ERROR_BAD_PARAMETER,"changeStreamPriority() - cannot change stream priority",mn))})}},{key:"updatePublishedStream",value:function(G,r){var s=this;return new Promise(function(N,q){return"audio"!==G&&"video"!==G?q(W.g.createError(i.g.ERROR_BAD_PARAMETER,"updatePublishedStream() - wrong type",mn)):Ti.webRTCClient.webRTCClient.processUpdateStream(s.callId,G,r?"sendonly":"inactive")?N():q(W.g.createError(i.g.ERROR_OTHER,"updatePublishedStream() - cannot update",mn))})}}],B&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(pe.prototype,B),pe}(Ne);function Bn(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return $a(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?$a(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function $a(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function Za(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}var nn=R.Y.get("ContactCatalog"),an=null,Gn={},gn={leftGroup:{},joinedGroup:{},userDataChanged:[]},Ji=function(){function D(){if(function(ae,pe){if(!(ae instanceof pe))throw new TypeError("Cannot call a class as a function")}(this,D),null!==an)throw"Cannot construct singleton ContactCatalog";this.contactList=new Map,this.eventEmitter=new w,an=this;var U=Rt.get();U.onEvent("connectedUsersListUpdate",function(ae){var pe=apiRTC.session.apiCCId.toString(),G={};switch(ae.detail.updateReason){case"newConnectionState":if("online"===ae.detail.status){nn.debug("new connection");var r,s=Bn(ae.detail.usersList);try{for(s.s();!(r=s.n()).done;)(G={userId:r.value,group:ae.detail.group}).userId.toString()!==pe&&er(G)}catch($){s.e($)}finally{s.f()}}else{nn.debug("new disconnection");var N,q=Bn(ae.detail.usersList);try{for(q.s();!(N=q.n()).done;)void 0===Gn[(G={userId:N.value,group:ae.detail.group}).group]&&(Gn[G.group]={}),G.userId.toString()!==pe&&(Gn[G.group][G.userId.toString()]=setTimeout(Xn(G),U.contactDisconnectionDelay))}catch($){q.e($)}finally{q.f()}}break;case"userDataUpdate":nn.debug("userDataUpdate");var ee,te=Bn(ae.detail.usersList);try{for(te.s();!(ee=te.n()).done;)(G={userId:ee.value,group:ae.detail.group}).userId.toString()!==pe&&tr(G)}catch($){te.e($)}finally{te.f()}break;case"callState":nn.debug("callState change for user");break;default:nn.warn("default case for updateReason value")}}).onEvent("groupUnsubscribed",function(ae){var pe,G=an.getContacts(ae),r=Bn(G.keys());try{for(r.s();!(pe=r.n()).done;)G.get(pe.value).removeFromGroup(ae)}catch(N){r.e(N)}finally{r.f()}})}var O,B,E;return O=D,E=[{key:"get",value:function(){return null===an&&(an=new D),an}}],(B=[{key:"onUpdate",value:function(U){this.eventEmitter.on("update",U)}},{key:"removeUpdateListener",value:function(U){this.eventEmitter.off("update",U)}},{key:"getContact",value:function(U){return null!=U&&this.contactList.has(U.toString())?this.contactList.get(U.toString()):null}},{key:"getOrCreateContact",value:function(U){var ae=null;if(null!=U)if(this.contactList.has(U.toString()))ae=this.contactList.get(U.toString());else try{ae=new Ei(U.toString(),{}),this.contactList.set(U.toString(),ae)}catch(pe){nn.debug("Contact not added : "+pe)}return ae}},{key:"getContacts",value:function(U){if(null==U)return this.contactList;var ae,pe=new Map,G=Bn(this.contactList.keys());try{for(G.s();!(ae=G.n()).done;){var r=ae.value;this.contactList.get(r).inGroup(U)&&pe.set(r,this.contactList.get(r))}}catch(s){G.e(s)}finally{G.f()}return pe}},{key:"getOnlineContacts",value:function(U){var ae=new Map;if(null==U){var pe,G=Bn(this.contactList.keys());try{for(G.s();!(pe=G.n()).done;){var r=pe.value;this.contactList.get(r).isOnline()&&ae.set(r,this.contactList.get(r))}}catch(ee){G.e(ee)}finally{G.f()}}else{var s,N=Bn(this.contactList.keys());try{for(N.s();!(s=N.n()).done;){var q=s.value;this.contactList.get(q).inGroup(U)&&this.contactList.get(q).isOnline()&&ae.set(q,this.contactList.get(q))}}catch(ee){N.e(ee)}finally{N.f()}}return ae}}])&&Za(O.prototype,B),E&&Za(O,E),D}();function Xn(D){return function(){var E,U,O=D.userId.toString();if(nn.info("Contact disconnected "+O+" from "+D.group),an.contactList.has(O)){var B=an.contactList.get(O);if(void 0===B)return void nn.debug("Contact not exist with userId :",O);B.removeFromGroup(D.group),E=D.group,U=B,nn.debug("updateContactListOnUserDisconnect()"),void 0===gn.leftGroup[E]&&(gn.leftGroup[E]=[]),gn.leftGroup[E].push(U),Ma(),void 0!==Gn[D.group]&&void 0!==Gn[D.group][O]&&delete Gn[D.group][O]}}}function Ma(){0===Object.keys(gn.leftGroup).length&&0===Object.keys(gn.joinedGroup).length&&0===gn.userDataChanged.length||(an.eventEmitter.emit("update",gn),gn={leftGroup:{},joinedGroup:{},userDataChanged:[]})}function er(D){nn.debug("updateContactListOnUserConnection()");var O=D.userId.toString(),B=null,E=apiRTC.session.getConnectedUserInfo(O,"userData");nn.debug("userData :",E);try{D.userData=JSON.parse(E)}catch(U){nn.warn("userData parse error : "+U)}if(an.contactList.has(O))B=an.contactList.get(D.userId),ot.equals(B.userData,D.userData)||(B.userData=new ot(D.userData),gn.userDataChanged.push(B));else{try{B=new Ei(O,D.userData),an.contactList.set(O,B)}catch(U){nn.debug("Contact not added : "+U)}B=an.contactList.get(O)}void 0!==B?(void 0!==Gn[D.group]&&void 0!==Gn[D.group][O]&&(clearTimeout(Gn[D.group][O]),delete Gn[D.group][O]),B.inGroup(D.group)||(B.addToGroup(D.group),void 0===gn.joinedGroup[D.group]&&(gn.joinedGroup[D.group]=[]),gn.joinedGroup[D.group].push(B)),Ma()):nn.debug("Contact not exist with userId :",O)}function tr(D){nn.debug("updateContactListOnUserDataUpdate()");var O=D.userId.toString(),B=an.contactList.get(D.userId);if(void 0!==B){var E=apiRTC.session.getConnectedUserInfo(O,"userData");nn.debug("userData :",E);try{D.userData=JSON.parse(E)}catch(U){nn.warn("userData parse error : "+U)}ot.equals(B.userData,D.userData)||(B.userData=new ot(D.userData),gn.userDataChanged.push(B)),Ma()}else nn.debug("Contact not exist with userId :",O)}function Aa(D){return(Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function ni(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return Sa(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?Sa(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function Sa(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function Dn(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function On(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function Ta(D,O){return(Ta=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function ir(D,O){if(O&&("object"===Aa(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Ot(D)}function Ot(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Oa(D){return(Oa=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var qe=R.Y.get("Conversation"),ut=Rt.get(),Rn=new(fe()),zi=Ji.get(),_a=["adaptationTriggered","audioAmplitude","availableStreamsUpdated","bandwidthLimited","callStatsUpdate","compositeListChanged","contactJoined","contactJoinedWaitingRoom","contactLeft","contactLeftWaitingRoom","cpuLimited","customEvent","data","disconnectionWarning","entryAllowed","entryDenied","error","hangup","joined","left","localStreamUpdated","message","messageNotDelivered","moderatorConnected","newMediaAvailable","newWhiteboardSession","participantEjected","persistentDataUpdated","pointerLocationChanged","pointerSharingEnabled","recordingAvailable","recordingStarted","recordingStopped","remoteStreamUpdated","replayListChanged","roomModeChanged","simulcastFeedChanged","slowLink","streamAdded","streamListChanged","streamRemoved","streamingStarted","streamingStopped","transferPending","transferBegun","transferEnded","transferProgress","whiteboardRoomMemberUpdate","videoQualityChanged","waitingForModeratorAcceptance"],Ia=new Set(["CHAT","CALL","GROUP_CHAT","WEBCONF","REPORT","REPORT_PART","TICKET","EVENT","OTHER","BOT"]),Fa=new Set(["audioSent","videoSent","audioReceived","videoReceived","quality"]),Da=new Set(["CALL_ABORTED","SET_LOCAL_DESCRIPTION_FAILURE","SET_REMOTE_DESCRIPTION_FAILURE"]),da=new WeakMap,ua=new WeakMap,Ce=new WeakMap,Ae=new WeakMap,je=new WeakMap,st=new WeakMap,Fe=new WeakMap,dt=new WeakMap,Tt=new WeakMap,_t=new WeakMap,Nt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,Gt=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&Ta(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=Oa(U);if(ae){var N=Oa(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return ir(this,r)});function G(r){var s,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Dn(this,G),s=pe.call(this,qe),qe.debug("Create Conversation"),da.set(Ot(s),null==r?W.g.guid().toString():r.toString()),ua.set(Ot(s),"OTHER"),s.active=!Object.prototype.hasOwnProperty.call(N,"active")||"boolean"!=typeof N.active||N.active,s.meshModeEnabled=!0===N.meshModeEnabled,s.meshOnlyEnabled=!0===N.meshOnlyEnabled,s.moderationEnabled=!0===N.moderationEnabled,s.moderator=!0===N.moderator,s.conversationCalls=new Map,s.callIdToStreamId=new Map,s.token=null,s.sessionId=null,s.webconfId=null,s.conversationStreams=new Map,s.conversationPublishedStreams=new Map,s.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED,s.status=i.g.CONVERSATION_STATUS_NOT_JOINED,s.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_NOT_STARTED,s.pointerSharingState=i.g.STATE_IDLE,s.pointerSharingAutoInvite=!1,s.pgroupWaitingRoomSubscribedTo=!1,je.set(Ot(s),null),st.set(Ot(s),null),Fe.set(Ot(s),new Map),Ae.set(Ot(s),null),dt.set(Ot(s),null),Ce.set(Ot(s),{}),Nt.set(Ot(s),new Map),Jt.set(Ot(s),null),Kt.set(Ot(s),null),s.transferCallIds=[],s.uploadCap=null,s.downloadCap=null,s.reservedStreams=[];var q={contactCatalog:{}};for(var ee in q.contactCatalog.onUpdate=function($){qe.debug("onUpdate: contactList",$);var ue=s._getTechnicalName();if(void 0!==$.joinedGroup[ue]){var Ie,Ue=ni($.joinedGroup[ue]);try{for(Ue.s();!(Ie=Ue.n()).done;){var vt=Ie.value;qe.debug(vt.getUsername()+" joined conversation "+s.getName()),ce.get(Ot(s)).emit("contactJoined",vt),s.pointerSharingState===i.g.STATE_ACTIVE&&!0===s.pointerSharingAutoInvite&&ut.pointerSharingClient.inviteInRoom(ue,vt.getId())}}catch(qn){Ue.e(qn)}finally{Ue.f()}}else qe.debug("not an event joinedGroup for conversation");if(void 0!==$.leftGroup[ue]){var pt,kt=ni($.leftGroup[ue]);try{for(kt.s();!(pt=kt.n()).done;){var Ut=pt.value;qe.debug(Ut.getUsername()+" left conversation "+s.getName()),ce.get(Ot(s)).emit("contactLeft",Ut)}}catch(qn){kt.e(qn)}finally{kt.f()}}else qe.debug("not an event leftGroup for conversation");if(s.getRole()===i.g.CONVERSATION_ROLE_MODERATOR){var fi,$i=zi.getContacts(i.g.CONVERSATION_WAITING_ROOM_PREFIX+ue),ln=ni(Nt.get(Ot(s)).keys());try{for(ln.s();!(fi=ln.n()).done;){var hr=fi.value;if(!$i.has(hr)){var ja=zi.getContact(hr);null!==ja&&(qe.debug(ja.getUsername()+" left waiting room "+s.getName()),ce.get(Ot(s)).emit("contactLeftWaitingRoom",ja))}}}catch(qn){ln.e(qn)}finally{ln.f()}$i.forEach(function(qn,Qa){Nt.get(Ot(s)).has(Qa)||null===qn||(qe.debug(qn.getUsername()+" joined waiting room "+s.getName()),ce.get(Ot(s)).emit("contactJoinedWaitingRoom",qn),ut.sendData(Qa,{event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected",roomname:ue}).catch(function(Pr){var Ur=W.g.createError(Pr,"Notification not delivered",qe);ce.get(Ot(s)).emit("messageNotDelivered",{error:Ur,contact:qn,event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected"})}))}),Nt.set(Ot(s),$i)}},zi.onUpdate(q.contactCatalog.onUpdate),ce.get(Ot(s)).on("contactJoined",function($){s.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&ut.sendData($.getId(),{event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected",roomname:s._getTechnicalName()}).catch(function(ue){var Ie=W.g.createError(ue,"Notification not delivered",qe);ce.get(Ot(s)).emit("messageNotDelivered",{error:Ie,contact:$,event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected"})})}),q.apiRTCManager={},q.apiRTCManager.receiveData=function($){var ue=$.detail.data;if(ue.roomname===s._getTechnicalName()){var Ie=zi.getOrCreateContact($.detail.senderId);if(ue.event)switch(ue.event){case i.g.CONVERSATION_SEND_DATA_IDENTIFIER:if(s.status!==i.g.CONVERSATION_STATUS_JOINED)break;ce.get(Ot(s)).emit("data",{sender:Ie,content:ue.content});break;case i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER:if(s.status!==i.g.CONVERSATION_STATUS_JOINED)break;qe.info("New media available in conversation",ue.media),ce.get(Ot(s)).emit("newMediaAvailable",{sender:Ie,media:ue.media});break;case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:if(s.status!==i.g.CONVERSATION_STATUS_JOINED)break;s.updateData();break;case i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER:ce.get(Ot(s)).emit("moderatorConnected",Ie);break;case i.g.CONVERSATION_CLOSED_IDENTIFIER:ue.instanceId===s.getInstanceId()&&(qe.info("Conference "+s.getName()+" has been closed..."),ce.get(Ot(s)).emit("closed"),s.leave());break;case i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER:if(null==ue.access){qe.error("Conversation join answer has no access data");break}ce.get(Ot(s)).emit(ue.access?"entryAllowed":"entryDenied");break;default:ce.get(Ot(s)).emit("customEvent",{event:ue.event,content:ue,sender:Ie})}else if("new_snapshot"===ue.command){if(s.status!==i.g.CONVERSATION_STATUS_JOINED)return;qe.info("New media available in conversation",ue.value.snapshot),ce.get(Ot(s)).emit("newMediaAvailable",{sender:Ie,media:ue.value.snapshot})}else qe.debug("Unprocessed conversation message",ue)}},q.apiRTCManager.receiveGroupChatMessage=function($){if((s.status===i.g.CONVERSATION_STATUS_JOINED||s.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED)&&$.detail.groupChatId.toString()===s._getTechnicalName()){var ue={sender:zi.getOrCreateContact($.detail.senderId),sender_id:$.detail.senderId,content:$.detail.message,time:new Date};W.g.isTypeof($.detail,"metadata","object")&&(ue.metadata=$.detail.metadata),ce.get(Ot(s)).emit("message",ue)}},q.apiRTCManager.receiveRoomMessage=function($){if("pointerSharing"===$.detail.roomType&&s.pointerSharingState===i.g.STATE_ACTIVE&&"pointerLocation"===$.detail.message.type&&$.detail.roomId===s._getTechnicalName()){var ue={sender:zi.getOrCreateContact($.detail.senderId),source:$.detail.message.source,x:$.detail.message.x,y:$.detail.message.y};W.g.isPropertyTypeof($.detail.message,"data","object")&&(ue.data=$.detail.message.data),ce.get(Ot(s)).emit("pointerLocationChanged",ue)}},q.apiRTCManager.roomInvitation=function($){if(qe.info("roomInvitation event handler ",$),$.detail.roomId.toString()===s._getTechnicalName())if(qe.info("roomInvitation for actual conversation",$),"whiteBoard"===$.detail.roomType){if(s.status===i.g.CONVERSATION_STATUS_JOINED){var ue=zi.getOrCreateContact($.detail.senderId);ce.get(Ot(s)).emit("newWhiteboardSession",{sender:ue})}}else"pointerSharing"===$.detail.roomType&&Wi(Ot(s),!1,!0).then(function(){}).catch(function(Ie){})},q.apiRTCManager.onFilePending=function($){if(s.transferCallIds.includes($.detail.callId)){var ue={id:$.detail.callId,name:$.detail.name,rank:$.detail.rank};ce.get(Ot(s)).emit("transferPending",ue)}},q.apiRTCManager.onFileSending=function($){if(s.transferCallIds.includes($.detail.callId)){var ue={id:$.detail.callId,name:$.detail.name};ce.get(Ot(s)).emit("transferBegun",ue)}},q.apiRTCManager.onFileProgress=function($){if(s.transferCallIds.includes($.detail.callId)){var ue={id:$.detail.callId,name:$.detail.name,size:$.detail.fileSize,remBytes:$.detail.remainingSize,percentage:$.detail.percentage};ce.get(Ot(s)).emit("transferProgress",ue)}},q.apiRTCManager.onFileSended=function($){var ue=s.transferCallIds.indexOf($.detail.callId);if(ue>=0){var Ie={id:$.detail.callId,name:$.detail.name};$.detail.error&&(Ie.error=$.detail.error),ce.get(Ot(s)).emit("transferEnded",Ie),s.transferCallIds.splice(ue,1)}},q.apiRTCManager)ut.onEvent(ee,q.apiRTCManager[ee]);Tt.set(Ot(s),q);var te={MCUAvailableStream:function($){var ue,Ie=ni($.detail.streams);try{for(Ie.s();!(ue=Ie.n()).done;){var Ue=ue.value;if(Ue.room===s._getTechnicalName()){var vt={contact:zi.getOrCreateContact(Ue.attributes.callerId),isRemote:$.detail.isRemoteStream,hasAudio:Ue.audio,hasVideo:Ue.video,isAudioMuted:Ue.audioMuted,isVideoMuted:Ue.videoMuted,isScreensharing:"screenSharing"===Ue.attributes.callType,isSIP:!0===Ue.sip,isSimulcast:!0===Ue.simulcast,streamId:Ue.id,type:"regular",callId:Ue.attributes.callId,descriptor:Ue.attributes.descriptor,context:Ue.context};s.conversationStreams.set(vt.streamId,vt);var pt={listEventType:"added"};W.g.assignObject(pt,vt),ce.get(Ot(s)).emit("streamListChanged",pt)}}}catch(ln){Ie.e(ln)}finally{Ie.f()}qe.debug("Nb stream into conversation :"+s.conversationStreams.size);var kt,Ut={},fi=ni(s.conversationStreams.keys());try{for(fi.s();!(kt=fi.n()).done;){var $i=kt.value;Ut[$i]=s.conversationStreams.get($i)}}catch(ln){fi.e(ln)}finally{fi.f()}ce.get(Ot(s)).emit("availableStreamsUpdated",Ut)},MCUAvailableStreamUpdate:function($){var ue,Ie=ni($.detail.streams);try{for(Ie.s();!(ue=Ie.n()).done;){var Ue=ue.value;if(Ue.room===s._getTechnicalName()){var vt=s.conversationStreams.get(Ue.id);if(vt&&"regular"===vt.type){vt.hasAudio=Ue.audio,vt.hasVideo=Ue.video,vt.isAudioMuted=Ue.audioMuted,vt.isVideoMuted=Ue.videoMuted,vt.descriptor=Ue.attributes.descriptor;var pt={listEventType:"updated"};W.g.assignObject(pt,vt),ce.get(Ot(s)).emit("streamListChanged",pt),vt.descriptor&&Object.prototype.hasOwnProperty.call(vt.descriptor,"priority")&&s.changeStreamPriority(vt.streamId,!0,vt.descriptor.priority)}}}}catch(ln){Ie.e(ln)}finally{Ie.f()}qe.debug("Nb stream into conversation :"+s.conversationStreams.size);var kt,Ut={},fi=ni(s.conversationStreams.keys());try{for(fi.s();!(kt=fi.n()).done;){var $i=kt.value;Ut[$i]=s.conversationStreams.get($i)}}catch(ln){fi.e(ln)}finally{fi.f()}ce.get(Ot(s)).emit("availableStreamsUpdated",Ut)},MCUAvailableComposite:function($){var ue,Ie=ni($.detail.streams);try{for(Ie.s();!(ue=Ie.n()).done;){var Ue=ue.value;if(Ue.room===s._getTechnicalName()){var vt={isRemote:$.detail.isRemoteStream,hasAudio:Ue.audio,hasVideo:Ue.video,isAudioMuted:Ue.audioMuted,isVideoMuted:Ue.videoMuted,isScreensharing:"screenSharing"===Ue.attributes.callType,isSIP:!0===Ue.sip,streamId:Ue.id,type:"composite",callId:Ue.attributes.callId,descriptor:Ue.attributes.descriptor,context:Ue.context};s.conversationStreams.set(vt.streamId,vt);var pt={listEventType:"added"};W.g.assignObject(pt,vt),ce.get(Ot(s)).emit("compositeListChanged",pt)}}}catch(kt){Ie.e(kt)}finally{Ie.f()}},MCUAvailableReplay:function($){var ue,Ie=ni($.detail.streams);try{for(Ie.s();!(ue=Ie.n()).done;){var Ue=ue.value;if(Ue.room===s._getTechnicalName()){var vt={contact:zi.getOrCreateContact(Ue.attributes.callerId),isRemote:$.detail.isRemoteStream,hasAudio:Ue.audio,hasVideo:Ue.video,isAudioMuted:Ue.audioMuted,isVideoMuted:Ue.videoMuted,isScreensharing:"screenSharing"===Ue.attributes.callType,isSIP:!0===Ue.sip,streamId:Ue.id,type:"replay",callId:Ue.attributes.callId,descriptor:Ue.attributes.descriptor,context:Ue.context};s.conversationStreams.set(vt.streamId,vt);var pt={listEventType:"added"};W.g.assignObject(pt,vt),ce.get(Ot(s)).emit("replayListChanged",pt)}}}catch(kt){Ie.e(kt)}finally{Ie.f()}},MCURemoveStream:function($){if(s.conversationStreams.has($.detail.streamId)){var ue={listEventType:"removed"};W.g.assignObject(ue,s.conversationStreams.get($.detail.streamId)),"regular"===ue.type?ce.get(Ot(s)).emit("streamListChanged",ue):"composite"===ue.type&&ce.get(Ot(s)).emit("compositeListChanged",ue),s.conversationStreams.delete($.detail.streamId),qe.debug("Nb stream into conversation :"+s.conversationStreams.size);var Ie,Ue={},vt=ni(s.conversationStreams.keys());try{for(vt.s();!(Ie=vt.n()).done;){var pt=Ie.value;Ue[pt]=s.conversationStreams.get(pt)}}catch(kt){vt.e(kt)}finally{vt.f()}ce.get(Ot(s)).emit("availableStreamsUpdated",Ue)}else qe.debug("Not a conversation's stream")},remoteStreamAdded:function($){if(s.callIdToStreamId.has($.detail.callId)){qe.info("remoteStreamAdded",$.detail);var ue=zi.getOrCreateContact($.detail.remoteId),Ie=s.callIdToStreamId.get($.detail.callId),Ue=Fe.get(Ot(s));Ue.has(Ie)&&ce.get(Ot(s)).emit("streamRemoved",Ue.get(Ie));var kt=new wn($.detail.stream,{type:"audio"===$.detail.callType?"audio":"video",contact:ue,streamId:Ie,callId:$.detail.callId,callAudioAvailable:$.detail.audioIsAvailable,callAudioActive:$.detail.audioIsActive,callAudioMuted:$.detail.audioIsMuted,callVideoAvailable:$.detail.videoIsAvailable,callVideoActive:$.detail.videoIsActive,callVideoMuted:$.detail.videoIsMuted,screensharing:"screenSharing"===$.detail.callType,constructor:!0});kt.publishedInConversations.set(s.getName(),$.detail.callId),Fe.get(Ot(s)).set(Ie,kt),ce.get(Ot(s)).emit("streamAdded",kt)}},remoteStreamRemoved:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie=Fe.get(Ot(s));Ie.has(ue)&&(ce.get(Ot(s)).emit("streamRemoved",Ie.get(ue)),Ie.delete(ue))}},roomMemberUpdate:function($){qe.info("roomMemberUpdate event handler ",$);var ue,Ie=[],Ue=ni($.detail.contactList);try{for(Ue.s();!(ue=Ue.n()).done;)Ie.push(zi.getOrCreateContact(ue.value.contactId))}catch(pt){Ue.e(pt)}finally{Ue.f()}"whiteBoard"===$.detail.roomType&&(qe.info("Received whiteboard room member update"),ce.get(Ot(s)).emit("whiteboardRoomMemberUpdate",{contacts:Ie,roomId:$.detail.roomId,status:$.detail.status}))},slowLink:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue};$.detail.advice&&(Ie.advice=$.detail.advice),ce.get(Ot(s)).emit("slowLink",Ie)}},videoQualityChanged:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,hint:$.detail.hint,profileType:$.detail.profileType};$.detail.bitrate&&(Ie.bitrate=$.detail.bitrate),$.detail.width&&$.detail.height&&(Ie.width=$.detail.width,Ie.height=$.detail.height),$.detail.frameRate&&(Ie.frameRate=$.detail.frameRate),ce.get(Ot(s)).emit("videoQualityChanged",Ie)}},simulcastFeedChanged:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,simulcast:$.detail.simulcast};ce.get(Ot(s)).emit("simulcastFeedChanged",Ie)}},localStreamUpdated:function($){if($.detail.onCall&&s.callIdToStreamId.has($.detail.callId)){var ue={callId:$.detail.callId,streamId:$.detail.userMediaStreamId,audio:$.detail.audioIsAvailable&&$.detail.audioIsActive,audioMuted:$.detail.audioIsMuted,video:$.detail.videoIsAvailable&&$.detail.videoIsActive,videoMuted:$.detail.videoIsMuted,cause:$.detail.cause};ce.get(Ot(s)).emit("localStreamUpdated",ue)}},remoteStreamUpdated:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,audio:$.detail.audioIsAvailable&&$.detail.audioIsActive,audioMuted:$.detail.audioIsMuted,video:$.detail.videoIsAvailable&&$.detail.videoIsActive,videoMuted:$.detail.videoIsMuted,cause:$.detail.cause};setTimeout(function(){ce.get(Ot(s)).emit("remoteStreamUpdated",Ie)})}},MCURecordingStarted:function($){if($.detail.roomName===s._getTechnicalName()){var ue=W.g.parseRecordingEvent("MCURecordingStarted",$.detail);if("COMPOSITE"===ue.callId)s.recordingStatus=ue;else{var Ie=s.conversationCalls.get(ue.callId);Ie&&(Ie.recordingStatus=ue)}ce.get(Ot(s)).emit("recordingStarted",ue)}},MCURecordingStopped:function($){if($.detail.roomName===s._getTechnicalName()){var ue=W.g.parseRecordingEvent("MCURecordingStopped",$.detail);if("COMPOSITE"===ue.callId)delete s.recordingStatus;else{var Ie=s.conversationCalls.get(ue.callId);Ie&&delete Ie.recordingStatus}ce.get(Ot(s)).emit("recordingStopped",ue)}},MCURecordedStreamsAvailable:function($){if($.detail.roomName===s._getTechnicalName()){var ue=W.g.parseRecordingEvent("MCURecordedStreamsAvailable",$.detail);ce.get(Ot(s)).emit("recordingAvailable",ue)}},MCUStreamingStarted:function($){if($.detail.roomName===s._getTechnicalName()){var ue=Sn("MCUStreamingStarted",$.detail),Ie=s.conversationCalls.get(ue.callId);Ie&&(Ie.streamingStatus=ue),ce.get(Ot(s)).emit("streamingStarted",ue)}},MCUStreamingStopped:function($){if($.detail.roomName===s._getTechnicalName()){var ue=Sn("MCUStreamingStopped",$.detail),Ie=s.conversationCalls.get(ue.callId);Ie&&delete Ie.streamingStatus,ce.get(Ot(s)).emit("streamingStopped",ue)}},onCallStatsUpdate:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,stats:{}};$.detail.userId&&(Ie.mesh=!0,Ie.userId=$.detail.userId,Ie.contact=zi.getOrCreateContact($.detail.userId));for(var Ue=0,vt=Object.keys($.detail.stats);Ue<vt.length;Ue++){var pt=vt[Ue];Fa.has(pt)&&(Ie.stats[pt]=$.detail.stats[pt])}ce.get(Ot(s)).emit("callStatsUpdate",Ie)}},cpuLimited:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,encodeUsagePercent:$.detail.encodeUsagePercent};ce.get(Ot(s)).emit("cpuLimited",Ie)}},bandwidthLimited:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,resolutionChanged:!0};ce.get(Ot(s)).emit("bandwidthLimited",Ie)}},audioAmplitude:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie={callId:$.detail.callId,streamId:ue,amplitude:$.detail.descriptor.amplitude,isSpeaking:$.detail.descriptor.isSpeaking,descriptor:{amplitude:$.detail.descriptor.amplitude,isSpeaking:$.detail.descriptor.isSpeaking}};ce.get(Ot(s)).emit("audioAmplitude",Ie)}},hangup:function($){if(s.callIdToStreamId.has($.detail.callId)){var ue=s.callIdToStreamId.get($.detail.callId),Ie=Fe.get(Ot(s));Ie.has(ue)&&(ce.get(Ot(s)).emit("streamRemoved",Ie.get(ue)),Ie.delete(ue)),"restarted"!==$.detail.reason&&"disconnected"!==$.detail.reason&&"Broken_by_MCU"!==$.detail.reason&&"RTC_Setup_Timeout"!==$.detail.reason&&(s.conversationCalls.has($.detail.callId)?Ri(Ot(s),$.detail.callId):(s.callIdToStreamId.delete($.detail.callId),s.releaseResources(ue,{isRemote:!0,triggerAdaptation:!0})),ce.get(Ot(s)).emit("hangup",{from:$.detail.hangupType,reason:$.detail.reason,streamId:ue}))}},callRestarting:function($){if(s.callIdToStreamId.has($.detail.oldCallId)){var ue=s.callIdToStreamId.get($.detail.oldCallId);s.callIdToStreamId.delete($.detail.oldCallId),s.callIdToStreamId.set($.detail.newCallId,ue)}},MCUParticipantEjected:function($){if(s._getTechnicalName()===$.detail.roomId){var ue=dt.get(Ot(s));if($.detail.clientId===ue.getId())s.leave().catch(function(Ue){qe.error("leave",Ue)}).then(function(){ce.get(Ot(s)).emit("participantEjected",{self:!0})});else{var Ie=zi.getOrCreateContact($.detail.clientId);ce.get(Ot(s)).emit("participantEjected",{self:!1,contact:Ie})}}},MCURoomModeChanged:function($){s._getTechnicalName()===$.detail.roomId&&ce.get(Ot(s)).emit("roomModeChanged",{oldMode:$.detail.oldMode,newMode:$.detail.newMode,state:$.detail.state})}};return _t.set(Ot(s),te),ce.get(Ot(s)).on("left",function(){s.pgroupWaitingRoomSubscribedTo&&(ut.apiRTCSession.unsubscribePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+s._getTechnicalName()]),s.pgroupWaitingRoomSubscribedTo=!1),je.set(Ot(s),null),st.set(Ot(s),null),dt.set(Ot(s),null),Jt.set(Ot(s),null)}),s}return O=G,B=[{key:"destroy",value:function(){rn.get().deleteConversation(this.getName());var r=Tt.get(this);if(r){if(r.apiRTCManager)for(var s in r.apiRTCManager)ut.removeEventListener(s,r.apiRTCManager[s]);r.contactCatalog&&zi.removeUpdateListener(r.contactCatalog.onUpdate),Tt.delete(this)}}},{key:"getStatus",value:function(){return this.status}},{key:"getName",value:function(){return da.get(this).toString()}},{key:"_getTechnicalName",value:function(){return da.get(this).toString()}},{key:"getRole",value:function(){return je.get(this)}},{key:"getInstanceId",value:function(){return Jt.get(this)}},{key:"getFriendlyName",value:function(){return null}},{key:"getModerator",value:function(){return st.get(this)}},{key:"getType",value:function(){return ua.get(this)}},{key:"setType",value:function(r){return!this.isBound()&&!!Ia.has(r)&&(ua.set(this,r),!0)}},{key:"getCloudConversationId",value:function(){var r=Ae.get(this);return r?r.toString():null}},{key:"bind",value:function(r){var s=this;r||(r={});var N=Ae.get(this);return null!==N?Promise.resolve(String(N)):new Promise(function(q,ee){xi(s,r).then(function(te){q(String(te.id))}).catch(function(te){ee(W.g.createError(i.g.ERROR_HTTP,"bind() - cannot bind conversation",qe,{fromError:te}))})})}},{key:"isBound",value:function(){return null!==Ae.get(this)}},{key:"isGroupChatJoined",value:function(){return this.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED}},{key:"joinGroupChat",value:function(){var r=this;return new Promise(function(s,N){if(r.groupChatStatus!==i.g.CONVERSATION_STATUS_NOT_JOINED)return N(W.g.createError(i.g.ERROR_WRONG_STATE,"joinGroupChat() - cannot join group chat",qe));r.bind().then(function(){return new Promise(function(q,ee){if(r.asyncCallbacks)return ee(W.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - busy",qe));r.asyncCallbacks={},r.asyncCallbacks.timeoutId=setTimeout(function(){return ut.removeEventListener("groupChatMemberUpdate",r.asyncCallbacks.groupChatMemberUpdate),delete r.asyncCallbacks,ee(W.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - timeout",qe))},i.g.CONVERSATION_GROUP_CHAT_MEMBER_UPDATE_DELAY),r.asyncCallbacks.groupChatMemberUpdate=function(te){if(te.detail.groupChatId===r._getTechnicalName()&&"online"===te.detail.status&&function($,ue){for(var Ie=$.length;--Ie>=0;)if($[Ie].contactId===ue)return!0;return!1}(te.detail.contactList,ut.getClientId()))return r.asyncCallbacks&&(ut.removeEventListener("groupChatMemberUpdate",r.asyncCallbacks.groupChatMemberUpdate),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks),q()},ut.onEvent("groupChatMemberUpdate",r.asyncCallbacks.groupChatMemberUpdate),ut.joinGroupChat(r._getTechnicalName())})}).then(function(){r.groupChatStatus=i.g.CONVERSATION_STATUS_JOINED,ut.joinAndSubscribeToPresenceGroup(r._getTechnicalName()),s()}).catch(function(q){N(W.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - cannot join group chat",qe,{fromError:q}))})})}},{key:"leaveGroupChat",value:function(){var r=this;return new Promise(function(s,N){return r.groupChatStatus!==i.g.CONVERSATION_STATUS_JOINED?N(W.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - group chat not joined",qe)):r.status!==i.g.CONVERSATION_STATUS_NOT_JOINED?N(W.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - webconf active",qe)):void ut.leaveGroupChat(r._getTechnicalName()).then(function(){r.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED,ut.leaveAndUnsubscribeToPresenceGroup(r._getTechnicalName()),s()}).catch(function(q){N(W.g.createError(i.g.ERROR_OTHER,"leaveGroupChat() - cannot leave group chat",qe,{fromError:q}))})})}},{key:"isJoined",value:function(){return this.status===i.g.CONVERSATION_STATUS_JOINED}},{key:"isPublishedStream",value:function(r){return r.publishedInConversations.has(this.getName())}},{key:"publish",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){if(N.status!==i.g.CONVERSATION_STATUS_JOINED)return ee(W.g.createError(i.g.ERROR_OTHER,"publish() - conversation not joined",qe));if(!(r instanceof wn))return ee(W.g.createError(i.g.ERROR_OTHER,"publish() - No stream specified",qe));if(N.isPublishedStream(r))return ee(W.g.createError(i.g.ERROR_OTHER,"publish() - Stream is already published in this conversation!",qe));var te={};te.userMediaStreamId=r.userMediaStreamId,null!==s&&"object"===Aa(s)&&(te.audioOnly=s.audioOnly,te.videoOnly=s.videoOnly,te.private=s.private,te.record=s.record,te.turnServerAddress=s.turnServerAddress,te.profileType=s.profileType,te.priority=s.priority,te.downgradeProfileList=s.downgradeProfileList,te.distributedBroadcastEnabled=s.distributedBroadcastEnabled),W.g.isPropertyTypeof(s,"mediaType","string")&&(te.mediaType=s.mediaType,te.audioOnly&&(te.mediaType="AUDIOONLY"),te.videoOnly&&(te.mediaType="VIDEOONLY")),W.g.isPropertyTypeof(s,"qos","object")&&(te.qos={},W.g.isPropertyTypeof(s.qos,"videoMinBitrate","number")&&(te.qos.videoMinBitrate=s.qos.videoMinBitrate),W.g.isPropertyTypeof(s.qos,"videoMinQuality","string")&&(te.qos.videoMinQuality=s.qos.videoMinQuality),W.g.isPropertyTypeof(s.qos,"videoStartBitrate","number")&&(te.qos.videoStartBitrate=s.qos.videoStartBitrate),W.g.isPropertyTypeof(s.qos,"videoStartQuality","string")&&(te.qos.videoStartQuality=s.qos.videoStartQuality),W.g.isPropertyTypeof(s.qos,"videoForbidInactive","boolean")&&(te.qos.videoForbidInactive=s.qos.videoForbidInactive)),W.g.isPropertyTypeof(s,"simulcast","object")&&!te.audioOnly&&(te.simulcast={},W.g.isPropertyTypeof(s.simulcast,"mode","string")&&["RID","SDP"].indexOf(s.simulcast.mode)>=0&&(te.simulcast.mode=s.simulcast.mode),W.g.isPropertyTypeof(s.simulcast,"maxBitrate","number")?te.simulcast.maxBitrate=s.simulcast.maxBitrate:W.g.isPropertyTypeof(s.simulcast,"encodings","object")&&(te.simulcast.encodings=Object.assign({},s.simulcast.encodings))),["audioLabels","videoLabels"].forEach(function(kt){W.g.isTypeof(s,kt,"array")&&(te[kt]=[],s[kt].forEach(function(Ut){W.g.isTypeof(Ut,"string")&&te[kt].push(Ut)}))}),W.g.isPropertyTypeof(s,"context","object")&&(te.context=s.context);var $=null;if(r.hasVideo()&&N.getNetworkCap({capacity:!0})&&s.profileType&&s.downgradeProfileList)for(var ue=s.downgradeProfileList.length;--ue>=0;)if(s.downgradeProfileList[ue].name===s.profileType){s.downgradeProfileList[ue].bitrate&&($=s.downgradeProfileList[ue].bitrate);break}if($){if(!N.reserveResources(s.profileType,$,r.userMediaStreamId,!1,s.priority,{isVideoOnly:!r.hasAudio(),isVideoMuted:te.audioOnly,control:!0})&&!N.disableLowerPriorityVideo(!1,$,s.priority)){if(!r.hasAudio())return ee(W.g.createError(i.g.ERROR_OTHER,"publish() - not enough bandwidth",qe));te.audioOnly=!0}N.reserveResources(s.profileType,$,r.userMediaStreamId,!1,s.priority,{isVideoOnly:!r.hasAudio(),isVideoMuted:te.audioOnly})}qe.info("callConfiguration:",te);var Ie=r.isScreensharing(),Ue=ut.webRTCClient.publish(N.sessionId,N.sessionId,N.token,te,{},{forceScreenSharingCallType:Ie});if(!Ue)return N.releaseResources(r.userMediaStreamId),ee(W.g.createError(i.g.ERROR_OTHER,"publish() - failed to establish call",qe));N.conversationCalls.set(Ue,new Va(N,Ue,r)),r.publishedInConversations.set(N.getName(),Ue),N.callIdToStreamId.set(Ue,r.userMediaStreamId);var vt={contact:null,isRemote:!1,hasAudio:r.hasAudio(),hasVideo:r.hasVideo(),isScreensharing:r.isScreensharing(),streamId:r.userMediaStreamId,callId:Ue};N.conversationPublishedStreams.set(r.userMediaStreamId,vt);var pt={callEstablishedHandler:function(kt){kt.detail.callId.toString()===Ue.toString()&&(ut.removeEventListener("callEstablished",pt.callEstablishedHandler),N.removeListener("error",pt.errorHandler),q(r))}};ut.onEvent("callEstablished",pt.callEstablishedHandler),pt.errorHandler=function(kt){kt.callId===Ue&&(ut.removeEventListener("callEstablished",pt.callEstablishedHandler),N.removeListener("error",pt.errorHandler),N.releaseResources(r.userMediaStreamId),ee(W.g.createError(i.g.ERROR_OTHER,"publish() - "+kt.errorInfo,qe)))},N.on("error",pt.errorHandler)})}},{key:"unpublish",value:function(r,s){if(s||(s={}),r instanceof wn)if(this.isPublishedStream(r)){var N=r.publishedInConversations.get(this.getName());Ri(this,N,{stream:r,triggerAdaptation:!s.noTriggerAdaptation}),ut.webRTCClient.unpublish(N)}else qe.error("unpublish() - Stream is not publishing to conversation");else qe.error("unpublish() - No stream specified",r)}},{key:"getConversationCall",value:function(r){if(!r)return null;var s=r.publishedInConversations.get(this.getName());return s?this.conversationCalls.get(s):null}},{key:"getCallId",value:function(r){return r.publishedInConversations.get(this.getName())}},{key:"checkAccess",value:function(r){var s=this;return r||(r={}),new Promise(function(N,q){if(!0!==r.force&&s.accessStatus)return N(s.accessStatus);r.hasOwnProperty("session")||null===Ii.getActiveSession()||(r.session=Ii.getActiveSession()),s.bind(r).then(function(ee){return r.convId=ee,Rn.checkConferenceAccess(s._getTechnicalName(),ut.getActiveApiKey(),r)}).then(function(ee){return ee.access!==i.g.CONVERSATION_ACCESS_GRANTED&&ee.access!==i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION&&qe.warn("checkAccess() - unknown access response:",ee.access),ee.role!==i.g.CONVERSATION_ROLE_MODERATOR&&ee.role!==i.g.CONVERSATION_ROLE_CONTRIBUTOR&&ee.role!==i.g.CONVERSATION_ROLE_GUEST&&qe.warn("checkAccess() - unknown role response:",ee.role),ee.hasOwnProperty("webconfId")&&(s.webconfId=ee.webconfId,delete ee.webconfId),s.accessStatus=W.g.assignObject({},ee),N(s.accessStatus)}).catch(function(ee){q(W.g.createError(i.g.ERROR_APIRTC_INITIALISATION_FAILED,"checkAccess() - cannot check access",qe,{fromError:ee}))})})}},{key:"join",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return qe.debug("Joining "+this.getName()),new Promise(function(N,q){if(r.status!==i.g.CONVERSATION_STATUS_NOT_JOINED)return q(W.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation",qe));s=Object.assign({},s);var ee=!1;s.qualityAdaptationEnabled&&(ee=!0,delete s.qualityAdaptationEnabled);var te=null;s.supportedVideoCodecs&&(te=s.supportedVideoCodecs,delete s.supportedVideoCodecs),r.checkAccess(s).then(function($){if(!r.conference){if("public"!==$.type)return Promise.reject(W.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - wrong conference type",qe));if($.access!==i.g.CONVERSATION_ACCESS_GRANTED)return Promise.reject(W.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - access to conference not granted",qe))}return Yi(r,$)}).then(function($){if(je.set(r,$.role),r.status=i.g.CONVERSATION_STATUS_JOINING,r.conference)return s.hasOwnProperty("password")&&Kt.set(r,s.password),r.friendlyName=$.hasOwnProperty("friendlyName")?$.friendlyName:r.friendlyName,Jt.set(r,$.instanceId),vn(r,dt.get(r),ut.getActiveApiKey())}).then(function(){var $=r,ue=function vt(pt){if(qe.debug("joinMCUSessionAnswer",$._getTechnicalName(),pt.detail),pt.detail.roomId.toString()===$._getTechnicalName()){if(pt.detail.result&&pt.detail.result.failed)return qe.error("Conversation "+$.getName()+" join failed",pt.detail),this.status=i.g.CONVERSATION_STATUS_NOT_JOINED,q(W.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - "+(pt.detail.result.reason?pt.detail.result.reason:"join failed"),qe));qe.info("Conversation "+$.getName()+" joined",pt.detail),ut.removeEventListener("joinMCUSessionAnswer",vt),$.status=i.g.CONVERSATION_STATUS_JOINED,$.token=pt.detail.token,$.sessionId=pt.detail.sessionId,$.mode=pt.detail.mode,$.conversationStreams=new Map;var Ut=_t.get($);ut.onEvent("MCUAvailableStream",Ut.MCUAvailableStream).onEvent("MCUAvailableStreamUpdate",Ut.MCUAvailableStreamUpdate).onEvent("MCURemoveStream",Ut.MCURemoveStream).onEvent("MCUAvailableComposite",Ut.MCUAvailableComposite).onEvent("MCUAvailableReplay",Ut.MCUAvailableReplay).onEvent("MCUParticipantEjected",Ut.MCUParticipantEjected).onEvent("remoteStreamAdded",Ut.remoteStreamAdded).onEvent("remoteStreamRemoved",Ut.remoteStreamRemoved).onEvent("roomMemberUpdate",Ut.roomMemberUpdate).onEvent("slowLink",Ut.slowLink).onEvent("localStreamUpdated",Ut.localStreamUpdated).onEvent("remoteStreamUpdated",Ut.remoteStreamUpdated).onEvent("simulcastFeedChanged",Ut.simulcastFeedChanged).onEvent("MCURecordingStarted",Ut.MCURecordingStarted).onEvent("MCURecordingStopped",Ut.MCURecordingStopped).onEvent("MCURecordedStreamsAvailable",Ut.MCURecordedStreamsAvailable).onEvent("MCUStreamingStarted",Ut.MCUStreamingStarted).onEvent("MCUStreamingStopped",Ut.MCUStreamingStopped).onEvent("MCURoomModeChanged",Ut.MCURoomModeChanged).onEvent("onCallStatsUpdate",Ut.onCallStatsUpdate).onEvent("hangup",Ut.hangup).onEvent("callRestarting",Ut.callRestarting).onEvent("audioAmplitude",Ut.audioAmplitude).onEvent("videoQualityChanged",Ut.videoQualityChanged).onEvent("cpuLimited",Ut.cpuLimited).onEvent("bandwidthLimited",Ut.bandwidthLimited),$.conference&&$.updateData(),$.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&(ut.apiRTCSession.subscribePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+$._getTechnicalName()]),$.pgroupWaitingRoomSubscribedTo=!0),$.groupChatStatus!==i.g.CONVERSATION_STATUS_NOT_JOINED&&($.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED),ce.get($).emit("joined");var fi={};"mesh"===pt.detail.mode&&(fi.mode="mesh",!0===pt.detail.meshOnly&&(fi.meshOnly=!0)),N(fi)}};ut.onEvent("joinMCUSessionAnswer",ue);var Ie={};Ie.convId=r.getCloudConversationId(),r.meshModeEnabled&&(Ie.meshModeEnabled=r.meshModeEnabled),r.meshOnlyEnabled&&(Ie.meshOnlyEnabled=r.meshOnlyEnabled),r.conference||(r.moderationEnabled&&(Ie.moderationEnabled=!0),r.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&(Ie.moderator=!0)),ee&&(Ie.qualityAdaptationEnabled=!0),te&&(Ie.supportedVideoCodecs=te);var Ue=ut.webRTCClient.joinMCUSession(r._getTechnicalName(),Ie);if(Ue instanceof Error)return ut.removeEventListener("joinMCUSessionAnswer",ue),$.status=i.g.CONVERSATION_STATUS_NOT_JOINED,q(W.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation :"+Ue.message,qe))}).catch(function($){return r.status=i.g.CONVERSATION_STATUS_NOT_JOINED,q(W.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation",qe,{fromError:$}))})})}},{key:"cancelJoin",value:function(){return null!==this.cancelJoin0&&"function"==typeof this.cancelJoin0&&this.cancelJoin0()}},{key:"eject",value:function(r,s){var N=this;return new Promise(function(q,ee){if(N.status!==i.g.CONVERSATION_STATUS_JOINED)return ee(W.g.createError(i.g.ERROR_OTHER,"eject() - conference not joined",qe));if(N.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return ee(W.g.createError(i.g.ERROR_UNAUTHORIZED,"eject() - only moderator can eject a contact",qe));var te={};te.timeoutId=setTimeout(function(){return te&&(ut.removeEventListener("MCUParticipantEjected",te.ejected),te=!1),ee(W.g.createError(i.g.ERROR_OTHER,"eject() - timeout",qe))},i.g.CONVERSATION_PARTICIPANT_EJECTION_DELAY),te.ejected=function($){if($.detail.roomId===N._getTechnicalName()&&$.detail.clientId===r.getId())return te&&(clearTimeout(te.timeoutId),ut.removeEventListener("MCUParticipantEjected",te.ejected),te=!1),q()},ut.onEvent("MCUParticipantEjected",te.ejected),ut.webRTCClient.ejectParticipantFromMCUSession(r.getId(),s)})}},{key:"allowEntry",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){if(N.status!==i.g.CONVERSATION_STATUS_JOINED)return ee(W.g.createError(i.g.ERROR_OTHER,"allowEntry() - conference not joined",qe));if(!(r instanceof Ei))return ee(W.g.createError(i.g.ERROR_BAD_PARAMETER,"allowEntry() - parameter is not an instance of apiRTC.Contact",qe));if(N.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return ee(W.g.createError(i.g.ERROR_UNAUTHORIZED,"allowEntry() - only moderator can allow entry to a contact",qe));var te={roomname:N._getTechnicalName(),event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,access:!0,command:"access",value:{access:!0}};if(s.hasOwnProperty("invitationId")&&(te.invitationId=s.invitationId),s.hasOwnProperty("answer")&&(te.answer=s.answer),ut.sendData(r.getId(),te).catch(function(ue){var Ie=W.g.createError(ue,"Notification not delivered",qe);ce.get(N).emit("messageNotDelivered",{error:Ie,contact:r,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})}),!0===s.ackEnabled){var $=setInterval(function(){te.command="access-new",ut.sendData(r.getId(),te).catch(function(ue){var Ie=W.g.createError(ue,"Notification not delivered",qe);ce.get(N).emit("messageNotDelivered",{error:Ie,contact:r,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})})},i.g.CONVERSATION_JOIN_REQUEST_INTERVAL);ut.onEvent("receiveData",function ue(Ie){var Ue=zi.getOrCreateContact(Ie.detail.senderId);Ie.detail.hasOwnProperty("data")&&"access-ack"===Ie.detail.data.command&&Ie.detail.data.roomname===N._getTechnicalName()&&Ue.getId()===r.getId()&&(clearInterval($),ut.removeEventListener("receiveData",ue))})}return q()})}},{key:"denyEntry",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){if(N.status!==i.g.CONVERSATION_STATUS_JOINED)return ee(W.g.createError(i.g.ERROR_OTHER,"denyEntry() - conference not joined",qe));if(!(r instanceof Ei))return ee(W.g.createError(i.g.ERROR_BAD_PARAMETER,"denyEntry() - parameter is not an instance of apiRTC.Contact",qe));if(N.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return ee(W.g.createError(i.g.ERROR_UNAUTHORIZED,"denyEntry() - only moderator can deny entry to a contact",qe));var te={roomname:N._getTechnicalName(),event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,access:!1,command:"access",value:{access:!1}};return s.hasOwnProperty("invitationId")&&(te.invitationId=s.invitationId),s.hasOwnProperty("answer")&&(te.answer=s.answer),s.hasOwnProperty("reason")&&(te.reason=s.reason),ut.sendData(r.getId(),te).catch(function($){var ue=W.g.createError($,"Notification not delivered",qe);ce.get(N).emit("messageNotDelivered",{error:ue,contact:r,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})}),q()})}},{key:"sendJoinRequest",value:function(){var r=this;if(this.status===i.g.CONVERSATION_STATUS_WAITING){if(!this.joinRequestIntervalId){var s=ti(this);s&&(ut.sendData(s,{roomname:this._getTechnicalName(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,invitationId:this._getTechnicalName(),sendTime:Date.now(),command:"userWaiting",value:{username:pi()}}).catch(function(N){var q=W.g.createError(N,"Notification not delivered",qe);ce.get(r).emit("messageNotDelivered",{error:q,contact:r.getModerator(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,command:"userWaiting"})}),this.joinRequestIntervalId=setInterval(function(){ut.sendData(s,{roomname:r._getTechnicalName(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,invitationId:r._getTechnicalName(),sendTime:Date.now(),command:"userWaiting-new",value:{username:pi()}}).catch(function(N){var q=W.g.createError(N,"Notification not delivered",qe);ce.get(r).emit("messageNotDelivered",{error:q,contact:r.getModerator(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,command:"userWaiting-new"})})},i.g.CONVERSATION_JOIN_REQUEST_INTERVAL))}}else qe.error("sendJoinRequest() - Not in conversation's waiting room, cannot send join request")}},{key:"leave",value:function(){var r=this;return new Promise(function(s,N){if(r.status!==i.g.CONVERSATION_STATUS_JOINED)return N(W.g.createError(i.g.ERROR_WRONG_STATE,"leave() - webconf not joined",qe));for(var q=_t.get(r),ee=0,te=Object.keys(q);ee<te.length;ee++){var $=te[ee];qe.info("Session, removing apiRTCManager event :",$),ut.removeEventListener($,q[$])}var Ie,Ue=ni(r.conversationStreams.keys());try{for(Ue.s();!(Ie=Ue.n()).done;){var vt=Ie.value;qe.trace("Leave() - unsubscribe to "+vt),ut.webRTCClient.unsubscribe(vt)}}catch(pt){Ue.e(pt)}finally{Ue.f()}Wi(r,!1,!1).then(function(){}).catch(function(pt){}),ut.IMClient.leaveGroupChat(r._getTechnicalName()),ut.webRTCClient.leaveMCUSession(),r.conversationStreams=new Map,r.status=i.g.CONVERSATION_STATUS_NOT_JOINED,ce.get(r).emit("left"),s()})}},{key:"subscribeToStream",value:function(r,s){var N=this;if(s||(s={}),qe.debug("subscribeToMedia",r),!this.isJoined())return Promise.reject(W.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - conversation not joined",qe));var q={};null!=s.turnServerAddress&&(q.turnServerAddress=s.turnServerAddress),W.g.isPropertyTypeof(s,"qos","object")&&(q.qos={},W.g.isPropertyTypeof(s.qos,"videoForbidInactive","boolean")&&(q.qos.videoForbidInactive=s.qos.videoForbidInactive));var ee=Number(r),te=ut.webRTCClient.getStreamFromList(ee),$=this.conversationStreams.get(ee);if(!te||!$)return Promise.reject(W.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - no such stream",qe));if(W.g.isPropertyTypeof(s,"simulcast","object")){var ue=["high","medium","low"];q.simulcast={},s.simulcast.streamQuality&&(q.simulcast.streamQuality=ue.indexOf(s.simulcast.streamQuality)>=0?s.simulcast.streamQuality:"default"),s.simulcast.streamFrameRate&&(q.simulcast.streamFrameRate=ue.indexOf(s.simulcast.streamFrameRate)>=0?s.simulcast.streamFrameRate:"default")}return new Promise(function(Ie,Ue){var vt="VIDEO";if($.hasVideo&&N.getNetworkCap({capacity:!0})&&W.g.isPropertyTypeof($,"descriptor","object")){var pt=$.descriptor;if(!N.reserveResources(pt.profileType,pt.bitrate,ee,!0,pt.priority,{isVideoOnly:!$.hasAudio,isVideoMuted:s.audioOnly,control:!0})&&!N.disableLowerPriorityVideo(!0,pt.bitrate,pt.priority)){if(!$.hasAudio)return Ue(W.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - not enough bandwidth",qe));s.audioOnly=!0}N.reserveResources(pt.profileType,pt.bitrate,ee,!0,pt.priority,{isVideoOnly:!$.hasAudio,isVideoMuted:s.audioOnly})}!0===s.audioOnly?vt="AUDIOONLY":!0===s.videoOnly&&(vt="VIDEOONLY");var kt=ut.webRTCClient.subscribe([te],vt,{},q,s)[0];if(!kt)return N.releaseResources(ee),Ue(W.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - stream not available",qe));N.callIdToStreamId.set(kt,ee),qe.debug("Subscribed to stream "+r+" through call "+kt);var Ut={streamAddedHandler:function(fi){fi.streamId===ee&&(N.removeListener("streamAdded",Ut.streamAddedHandler),N.removeListener("error",Ut.errorHandler),Ie(fi))}};N.on("streamAdded",Ut.streamAddedHandler),Ut.errorHandler=function(fi){fi.callId===kt&&(N.removeListener("streamAdded",Ut.streamAddedHandler),N.removeListener("error",Ut.errorHandler),N.releaseResources(ee),Ue(W.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - "+fi.errorInfo,qe)))},N.on("error",Ut.errorHandler)})}},{key:"updateSubscribedStream",value:function(r,s){s||(s={});var N=Number(r);if(!Fe.get(this).has(N))return qe.error("updateSubscribedStream() - Conversation stream "+r+" does not exist or was not subscribed to"),Promise.reject("wrong streamId");var q=Fe.get(this).get(N);if(W.g.isTypeof(s.simulcast,"object"))return ut.webRTCClient.webRTCClient.updateSimulcastFeedOnCall(q.callId,s.simulcast);var ee="VIDEO";return!0===s.audioOnly?ee="AUDIOONLY":!0===s.videoOnly&&(ee="VIDEOONLY"),ut.webRTCClient.webRTCClient.updateMediaTypeOnCall(q.callId,ee)}},{key:"unsubscribeToStream",value:function(r,s){s||(s={});var N=Number(r);ut.webRTCClient.unsubscribe(N),this.releaseResources(r,{isRemote:!0,triggerAdaptation:!s.noTriggerAdaptation})}},{key:"subscribeToMedia",value:function(r,s){return this.subscribeToStream(r,s)}},{key:"unsubscribeToMedia",value:function(r){this.unsubscribeToStream(r)}},{key:"startRecording",value:function(r){var s=this;return r||(r={}),new Promise(function(N,q){if(s.status!==i.g.CONVERSATION_STATUS_JOINED)return q(W.g.createError(i.g.ERROR_OTHER,"startRecording() - conversation not joined",qe));if(s.asyncCallbacks)return q(W.g.createError(i.g.ERROR_OTHER,"startRecording() - busy",qe));s.asyncCallbacks={},s.asyncCallbacks.timeoutId=setTimeout(function(){return s.asyncCallbacks&&(ut.removeEventListener("error",s.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",s.asyncCallbacks.recordingStarted),delete s.asyncCallbacks),q(W.g.createError(i.g.ERROR_OTHER,"startRecording() - timeout",qe))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),s.asyncCallbacks.error=function(ue){if(String(ue.detail.convId)===s.getCloudConversationId()&&"COMPOSITE"===ue.detail.callId&&ue.detail.errorCode.indexOf("START_RECORD")>=0)return s.asyncCallbacks&&(ut.removeEventListener("error",s.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",s.asyncCallbacks.recordingStarted),clearTimeout(s.asyncCallbacks.timeoutId),delete s.asyncCallbacks),q(W.g.createError(i.g.ERROR_OTHER,"startRecording() - "+ue.detail.errorInfo,qe))},s.asyncCallbacks.recordingStarted=function(ue){if(String(ue.detail.convId)===s.getCloudConversationId()&&"COMPOSITE"===ue.detail.callId){s.asyncCallbacks&&(ut.removeEventListener("error",s.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",s.asyncCallbacks.recordingStarted),clearTimeout(s.asyncCallbacks.timeoutId),delete s.asyncCallbacks);var Ie=W.g.parseRecordingEvent("MCURecordingStarted",ue.detail);return N(Ie)}},ut.onEvent("error",s.asyncCallbacks.error),ut.onEvent("MCURecordingStarted",s.asyncCallbacks.recordingStarted);var ee="AUDIO-VIDEO";!0===r.audioOnly?ee="AUDIO-ONLY":!0===r.videoOnly&&(ee="VIDEO-ONLY");var te="composite";W.g.isPropertyTypeof(r,"customIdInFilename","string")&&(te=r.customIdInFilename);var $={};W.g.isPropertyTypeof(r,"data","object")&&($=W.g.assignObject({},r.data)),$.mode=["complete","efficient","audioOnly"].indexOf(r.mode)>=0?r.mode:"complete",$.labelEnabled=!0===r.labelEnabled,!0===$.labelEnabled&&($.labels=[],W.g.isTypeof(r.labels,"array")&&r.labels.forEach(function(ue){W.g.isTypeof(ue,"string")&&$.labels.push(ue)})),W.g.isTypeof(r,"ttl","number")&&r.ttl>0&&($.ttl=r.ttl),ut.webRTCClient.startCompositeRecording(ee,te,s.getCloudConversationId(),$)})}},{key:"stopRecording",value:function(){var r=this;return new Promise(function(s,N){if(r.asyncCallbacks)return N(W.g.createError(i.g.ERROR_OTHER,"stopRecording() - busy",qe));r.asyncCallbacks={},r.asyncCallbacks.timeoutId=setTimeout(function(){return r.asyncCallbacks&&(ut.removeEventListener("error",r.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),delete r.asyncCallbacks),s(r.recordingStatus)},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),r.asyncCallbacks.error=function(q){if(String(q.detail.convId)===r.getCloudConversationId()&&"COMPOSITE"===q.detail.callId&&q.detail.errorCode.indexOf("STOP_RECORD")>=0)return r.asyncCallbacks&&(ut.removeEventListener("error",r.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks),N(W.g.createError(i.g.ERROR_OTHER,"stopRecording() - "+q.detail.errorInfo,qe))},r.asyncCallbacks.recordingStopped=function(q){if(String(q.detail.convId)===r.getCloudConversationId()&&"COMPOSITE"===q.detail.callId){r.asyncCallbacks&&(ut.removeEventListener("error",r.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",r.asyncCallbacks.recordingStopped),clearTimeout(r.asyncCallbacks.timeoutId),delete r.asyncCallbacks);var ee=W.g.parseRecordingEvent("MCURecordingStopped",q.detail);return s(ee)}},ut.onEvent("error",r.asyncCallbacks.error),ut.onEvent("MCURecordingStopped",r.asyncCallbacks.recordingStopped),ut.webRTCClient.stopCompositeRecording()})}},{key:"getContacts",value:function(){qe.debug("getContacts()");var r={};if(this.isBound()){var s,N=Ji.get().getContacts(this._getTechnicalName()),q=ni(N.keys());try{for(q.s();!(s=q.n()).done;){var ee=s.value;r[ee]=N.get(ee)}}catch(te){q.e(te)}finally{q.f()}}else qe.warn("getContacts() - Cannot get contacts as conversation is not joined");return r}},{key:"getContactsNumber",value:function(){qe.debug("getContactsNumber()");var r=0;return this.isBound()?r=Ji.get().getContacts(this._getTechnicalName()).size:qe.warn("getContactsNumber() - Cannot get contacts as conversation is not joined"),r}},{key:"getData",value:function(){return qe.debug("getData()"),this.isBound()||qe.warn("getData() - Cannot get most recent data as conversation is not joined, you may want to call Conversation.updateData() instead"),Ce.get(this)}},{key:"setData",value:function(r){var s=this;return new Promise(function(N,q){s.bind().then(function(){return Rn.setConversationData(Ae.get(s),JSON.stringify(r),ut.getActiveApiKey(),{token:dt.get(s).token})}).then(function(){Ce.set(s,r),ut.dataClient.sendDataToGroup(s._getTechnicalName(),{event:i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER,roomname:s._getTechnicalName()}),N()}).catch(function(){q(W.g.createError(i.g.ERROR_OTHER,"setData() - cannot set conversation data",qe))})})}},{key:"updateData",value:function(){var r=this;return new Promise(function(s,N){(r.isBound()?xi(r):r.bind()).then(function(){s(),ce.get(r).emit("persistentDataUpdated",Ce.get(r))}).catch(function(q){N(W.g.createError(i.g.ERROR_OTHER,"updateData() - cannot update conversation data",qe,{fromError:q}))})})}},{key:"getAvailableMediaList",value:function(){return qe.warn("Function deprecated, please use Conversation.getAvailableStreamList() instead"),this.getAvailableStreamList()}},{key:"getAvailableStreamList",value:function(){var r,s=[],N=ni(this.conversationStreams.keys());try{for(N.s();!(r=N.n()).done;)s.push(this.conversationStreams.get(r.value))}catch(ee){N.e(ee)}finally{N.f()}return s}},{key:"getStreamInfo",value:function(r){return this.conversationStreams.get(r)}},{key:"getSubscribedStream",value:function(r){return Fe.get(this).get(Number(r))}},{key:"linkWhiteboardClientToConversation",value:function(){qe.warn("DEPRECATED : linkWhiteboardClientToConversation : no more needed")}},{key:"startNewWhiteboardSession",value:function(r,s){var N=this;return qe.debug("startNewWhiteboardSession()"),new Promise(function(q,ee){N.bind().then(function(){if(N.whiteboardStarted===i.g.CONVERSATION_WHITEBOARD_NOT_STARTED){ut.whiteBoardClient.start();var te=N.getCloudConversationId();ut.whiteBoardClient.joinRoom(N._getTechnicalName(),{convId:te,webconf:!0}),ut.whiteBoardClient.setCanvas(r),null!=s&&ut.whiteBoardClient.setUserCursorColor(s),ut.whiteBoardClient.deleteHistory(),N.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_STARTED}q()}).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"startNewWhiteboardSession() - cannot start whiteboard session",qe,{fromError:te}))})})}},{key:"stopNewWhiteboardSession",value:function(){var r=this;return qe.debug("stopNewWhiteboardSession()"),new Promise(function(s,N){r.bind().then(function(){return r.whiteboardStarted!==i.g.CONVERSATION_WHITEBOARD_STARTED?(qe.error("Conversation is not joined!"),N(W.g.createError(i.g.ERROR_WRONG_STATE,"stopWhiteBoard() - Conversation not joined",qe))):ut.whiteBoardClient.roomId!==r._getTechnicalName()?(qe.error("Whiteboard session is not joined for this conversation!"),N(W.g.createError(i.g.ERROR_WRONG_STATE,"stopWhiteBoard() - whiteboard not joined",qe))):(ut.whiteBoardClient.leaveRoom(),ut.whiteBoardClient.stop(),r.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_NOT_STARTED,void s())}).catch(function(q){N(W.g.createError(i.g.ERROR_OTHER,"stopNewWhiteboardSession() - cannot stop whiteboard session",qe,{fromError:q}))})})}},{key:"enablePointerSharing",value:function(r){return Wi(this,!0,r)}},{key:"sendPointerLocation",value:function(r,s,N,q){ut.pointerSharingClient.sendPointerLocation(this._getTechnicalName(),r,s,N,q)}},{key:"sendData",value:function(r){var s=this;return new Promise(function(N,q){s.bind().then(function(){ut.dataClient.sendDataToGroup(s._getTechnicalName(),{event:i.g.CONVERSATION_SEND_DATA_IDENTIFIER,content:r,roomname:s._getTechnicalName()}),N()}).catch(function(ee){q(W.g.createError(i.g.ERROR_OTHER,"sendData() - cannot send data",qe))})})}},{key:"sendRawData",value:function(r){var s=this;return new Promise(function(N,q){s.bind().then(function(){ut.dataClient.sendDataToGroup(s._getTechnicalName(),r),N()}).catch(function(ee){q(W.g.createError(i.g.ERROR_OTHER,"sendRawData() - cannot send data",qe))})})}},{key:"sendCustomEvent",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(q,ee){s.bind().then(function(){var te=N;te.event=r,te.roomname=s._getTechnicalName(),ut.dataClient.sendDataToGroup(s._getTechnicalName(),te),q()}).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"sendCustomEvent() - cannot send data",qe))})})}},{key:"sendMessage",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){return N.groupChatStatus!==i.g.CONVERSATION_STATUS_JOINED&&N.status!==i.g.CONVERSATION_STATUS_JOINED?ee(W.g.createError(i.g.ERROR_WRONG_STATE,"sendMessage() - group chat not joined",qe)):null===r||"string"!=typeof r?ee(W.g.createError(i.g.ERROR_BAD_PARAMETER,"sendMessage() - wrong type of message",qe)):void N.bind().then(function(){var te={};return W.g.isTypeof(s,"metadata","object")&&(te.metadata=s.metadata),ut.sendMessageToGroupChat(N._getTechnicalName(),r,te)}).then(function(te){return $=te,new Promise(function(ue,Ie){var Ue=dt.get(N);null!==Ue?Rn.saveGroupChatMessage(N,Ue,ut.getActiveApiKey(),r,$,s).then(function(){ue($)}).catch(Ie):ue($)});var $}).then(q).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"sendMessage() - cannot send message",qe,{fromError:te}))})})}},{key:"pushMedia",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){N.bind().then(function(){return s.hasOwnProperty("token")||(s.token=dt.get(N).token),Rn.pushConversationMedia(Ae.get(N),r,ut.getActiveApiKey(),s)}).then(function(te){ut.dataClient.sendDataToGroup(N._getTechnicalName(),{event:i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER,roomname:N._getTechnicalName(),media:{url:te.url,id:te.id},command:"new_snapshot",value:{snapshot:te.url}}),q({url:te.url,id:te.id})}).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"pushMedia() - cannot push media",qe,{fromError:te}))})})}},{key:"pushData",value:function(r){var s=this,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return N=W.g.assignObject({},N),new Promise(function(q,ee){if(!0!==ut.webRTCClient.webRTCClient.dataChannelCapable||!0===N.forceHTTP){if(!r.file)return ee(W.g.createError(i.g.ERROR_BAD_PARAMETER,"pushData() - missing file",qe));var te={};if(W.g.isTypeof(r,"metadata","object"))try{te.metadata=JSON.stringify(r.metadata)}catch($){qe.error("JSON.stringify",$)}te.asFile=!0,te.filename=W.g.isTypeof(r,"filename","string")?r.filename:r.file.name,!0===r.overwrite&&(te.overwrite=!0),W.g.isTypeof(r,"ttl","number")&&r.ttl>0&&(te.ttl=r.ttl),s.pushMedia(r.file,te).then(q).catch(ee)}else s.bind().then(function(){var $=s._getTechnicalName(),ue={};N.hasOwnProperty("turnServerAddress")&&(ue.turnServerAddress=N.turnServerAddress,delete N.turnServerAddress);var Ie=ut.webRTCClient.webRTCClient.pushData(s.getCloudConversationId(),r,ue,{success:function(Ue){if("complete"!==Ue.state)return ee(W.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",qe));ut.dataClient.sendDataToGroup($,{event:i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER,roomname:$,media:{url:Ue.mediaURL,id:Ue.mediaId},command:"new_snapshot",value:{snapshot:Ue.mediaURL}}),q({url:Ue.mediaURL,id:Ue.mediaId})},failure:function(Ue,vt){if("iceFailed"===Ue){var pt=W.g.assignObject({},N);return pt.forceHTTP=!0,void s.pushData(r,pt).then(q).catch(ee)}if("timeout"===Ue){if(vt){var kt=s.transferCallIds.indexOf(vt);kt>=0&&s.transferCallIds.splice(kt,1)}return ee(W.g.createError(i.g.ERROR_TIMED_OUT,"pushData() - push data timed out",qe))}return ee("canceled"===Ue?W.g.createError(i.g.ERROR_OPERATION_CANCELED,"pushData() - push data canceled",qe):W.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",qe,{fromError:Ue}))}});if(!Ie)return ee(W.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",qe));s.transferCallIds.push(Ie)}).catch(function($){return ee(W.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",qe,{fromError:$}))})})}},{key:"cancelPushData",value:function(r){var s=this;return new Promise(function(N,q){if(!s.transferCallIds.includes(r))return q(W.g.createError(i.g.ERROR_OTHER,"cancelPushData() - no such push data",qe));var ee=ut.webRTCClient.webRTCClient.cancelPushData(r);if(ee)return q(W.g.createError(i.g.ERROR_OTHER,"cancelPushData() - "+ee,qe));N()})}},{key:"fetchMediaList",value:function(r,s){var N=this;return s||(s={}),new Promise(function(q,ee){N.bind().then(function(){return s.token=W.g.isTypeof(r,"object")&&r instanceof Ii?r.getToken():dt.get(N).token,Rn.getConversationMediaList(Ae.get(N),ut.getActiveApiKey(),s)}).then(q).catch(function(te){ee(W.g.createError(i.g.ERROR_OTHER,"fetchMediaList() - cannot fetch media list",qe,{fromError:te}))})})}},{key:"getWaitingRoomContacts",value:function(){qe.debug("getWaitingRoomContacts()");var r={};if(this.status!==i.g.CONVERSATION_STATUS_JOINED)qe.error("getWaitingRoomContacts() - Conversation is not joined, cannot get waiting room contacts");else if(this.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)qe.error("getWaitingRoomContacts() - Role is not moderator, cannot get waiting room contacts");else{var s,N=Ji.get().getContacts(i.g.CONVERSATION_WAITING_ROOM_PREFIX+this._getTechnicalName()),q=ni(N.keys());try{for(q.s();!(s=q.n()).done;){var ee=s.value;r[ee]=N.get(ee)}}catch(te){q.e(te)}finally{q.f()}}return r}},{key:"fetchMessageHistory",value:function(r){var s=this;return new Promise(function(N,q){s.bind().then(function(){return W.g.isTypeof(r,"object")&&r instanceof Ii||(r=dt.get(s)),Rn.loadGroupChatMessages(s,r)}).then(function(ee){var te=ee.map(function($){var ue={content:$.content,timestamp:1e3*$.created_at,date:new Date(1e3*$.created_at),sender_id:$.user_id};return $.user_id.toString()!==r.getId()&&(ue.sender=r.getOrCreateContact($.user_id)),ue});N(te)}).catch(function(ee){q(W.g.createError(i.g.ERROR_OTHER,"fetchMessageHistory() - cannot fetch message history",qe))})})}},{key:"sendInvitation",value:function(r,s){var N=this;if(s||(s={}),r instanceof Ei){qe.info("Invite "+r.getId()+" to "+this._getTechnicalName()),r.isOnline()||qe.warn("sendInvitation() - contact "+r.getUsername()+" does not seem to be connected.");var q={receiveNotifier:new w};s.hasOwnProperty("expirationTime")&&(q.expirationTime=s.expirationTime);var ee=new St(r,this,q);ee.type="conversation";var te={event:i.g.CONVERSATION_INVITATION_IDENTIFIER,invitationId:ee.id,roomname:this._getTechnicalName(),sendTime:ee.sendTime,conversationTypes:[]};return this.status===i.g.CONVERSATION_STATUS_JOINED?te.conversationTypes.push("WEBCONF"):this.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED&&te.conversationTypes.push("GROUP_CHAT"),ut.sendData(r.getId(),te).then(function(){q.receiveNotifier.emit("receive")}).catch(function($){var ue=W.g.createError($,"Invitation not delivered",qe);ce.get(N).emit("messageNotDelivered",{error:ue,contact:r,event:i.g.CONVERSATION_INVITATION_IDENTIFIER})}),ee}return qe.error("Parameter is not a contact"),null}},{key:"isRecorded",value:function(){return!!this.recordingStatus}},{key:"getRecordingInfo",value:function(){return this.isRecorded()?this.recordingStatus:null}},{key:"setNetworkCap",value:function(r,s){return"number"!=typeof r||"number"!=typeof s?(qe.error("setNetworkCap - wrong cap",r,s),!1):r<=0||s<=0?(this.uploadCap=null,this.downloadCap=null,!0):(this.uploadCap=r,this.downloadCap=s,!0)}},{key:"getNetworkCap",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.uploadCap||!this.downloadCap)return null;if(r.capacity)return[this.uploadCap,this.downloadCap];for(var s=this.uploadCap,N=this.downloadCap,q=this.reservedStreams.length;--q>=0;)this.reservedStreams[q].isVideoMuted||(this.reservedStreams[q].isRemote?N-=this.reservedStreams[q].resource:s-=this.reservedStreams[q].resource);return[s,N]}},{key:"getStreamResourceReservation",value:function(r){for(var s=this.reservedStreams.length;--s>=0;)if(this.reservedStreams[s].streamId===r)return this.reservedStreams[s];return null}},{key:"reserveResources",value:function(r,s,N,q,ee){var te=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(qe.debug("reserveResources",N),this.getStreamResourceReservation(N))throw new Error("reserveResources - already reserved stream");var $=!1,ue={streamId:N,profileType:r,priority:ee,resource:s,isRemote:q};if(ue.isVideoOnly=!!te.isVideoOnly,te.isVideoMuted)ue.isVideoMuted=!0,$=!0;else{ue.isVideoMuted=!1;var Ie=this.getNetworkCap();$=q?Ie[1]>=ue.resource:Ie[0]>=ue.resource}if(te.control)return $;if(!$)throw new Error("reserveResources - no such bandwidth availability");return this.reservedStreams.push(ue),this.reservedStreams.sort(function(Ue,vt){return Ue.priority>vt.priority?-1:Ue.priority===vt.priority?0:1}),qe.debug("reservedStreams",this.reservedStreams),!0}},{key:"releaseResources",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.getNetworkCap({capacity:!0}))return!1;qe.debug("releaseResources",r);for(var N=!1,q=this.reservedStreams.length;--q>=0;)if(this.reservedStreams[q].streamId===r){this.reservedStreams.splice(q,1),N=!0;break}return qe.debug("reservedStreams",this.reservedStreams),N&&s.triggerAdaptation&&this.enableHigherPriorityVideo(!!s.isRemote),N}},{key:"changeStreamPriority",value:function(r,s,N){qe.debug("changeStreamPriority",r,s,N);for(var q=null,ee=this.reservedStreams.length;--ee>=0;)if(this.reservedStreams[ee].isRemote===s&&this.reservedStreams[ee].streamId===r){q=this.reservedStreams[ee];break}return!(!q||q.priority===N||(q.priority=N,this.reservedStreams.sort(function(te,$){return te.priority>$.priority?-1:te.priority===$.priority?0:1}),qe.debug("reservedStreams",this.reservedStreams),q.isVideoMuted?this.disableLowerPriorityVideo(q.isRemote,q.resource,q.priority)&&sn(this,q):this.enableHigherPriorityVideo(q.isRemote,{resource:q.resource,priority:q.priority,control:!0})&&(kn(this,q),this.enableHigherPriorityVideo(q.isRemote)),0))}},{key:"disableLowerPriorityVideo",value:function(r,s,N){qe.debug("disableLowerPriorityVideo",r,s,N);for(var q=[],ee=0,te=this.reservedStreams.length;--te>=0&&(this.reservedStreams[te].isRemote!==r||this.reservedStreams[te].isVideoMuted||this.reservedStreams[te].priority>=N||(q.push(this.reservedStreams[te]),!((ee+=this.reservedStreams[te].resource)>=s))););if(0===q.length||ee<s)return!1;for(var $=q.length;--$>=0;)kn(this,q[$]);return!0}},{key:"enableHigherPriorityVideo",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};qe.debug("enableHigherPriorityVideo",r);var N=this.getNetworkCap(),q=r?N[1]:N[0];s.resource&&s.resource>0&&(q+=s.resource);for(var ee=[],te=0;te<this.reservedStreams.length;te+=1)this.reservedStreams[te].isRemote===r&&this.reservedStreams[te].isVideoMuted&&(Object.prototype.hasOwnProperty.call(s,"priority")&&this.reservedStreams[te].priority<=s.priority||this.reservedStreams[te].resource<=q&&(q-=this.reservedStreams[te].resource,ee.push(this.reservedStreams[te])));if(0===ee.length)return!1;if(s.control)return!0;for(var $=ee.length;--$>=0;)sn(this,ee[$]);return!0}},{key:"startComposite",value:function(){var r=this;return new Promise(function(s,N){if(r.status!==i.g.CONVERSATION_STATUS_JOINED)return N(W.g.createError(i.g.ERROR_OTHER,"startComposite() - conversation not joined",qe));ut.webRTCClient.startComposite(r._getTechnicalName()),s()})}},{key:"stopComposite",value:function(){var r=this;return new Promise(function(s,N){if(r.status!==i.g.CONVERSATION_STATUS_JOINED)return N(W.g.createError(i.g.ERROR_OTHER,"stopComposite() - conversation not joined",qe));ut.webRTCClient.stopComposite(r._getTechnicalName()),s()})}},{key:"manageDisconnectionWarningEvent",value:function(r){qe.debug("manageDisconnectionWarningEvent",r.detail);var s={};if(this.callIdToStreamId.has(r.detail.callId)){qe.debug("call is linked with conversation");var N=this.callIdToStreamId.get(r.detail.callId);s="publish"===r.detail.settingUpType||"shareScreen"===r.detail.settingUpType?this.conversationPublishedStreams.get(N):this.conversationStreams.get(N),ce.get(this).emit("disconnectionWarning",{streamInfo:s})}else qe.debug("call is not linked with conversation")}},{key:"manageErrorEvent",value:function(r){if(qe.debug("manageErrorEvent",r.detail),"DISTANT_ICE_CONNECTION_STATE_DISCONNECTED"===r.detail.errorCode||"DISTANT_ICE_CONNECTION_STATE_FAILED"===r.detail.errorCode)ce.get(this).emit("error",{errorCode:r.detail.errorCode,errorInfo:r.detail.errorInfo,descriptor:r.detail.data});else if(this.callIdToStreamId.has(r.detail.callId)){qe.debug("call is linked with conversation");var s=this.callIdToStreamId.get(r.detail.callId),N={streamInfo:"publish"===r.detail.settingUpType?this.conversationPublishedStreams.get(s):this.conversationStreams.get(s),errorCode:r.detail.errorCode,errorInfo:r.detail.errorInfo,callId:r.detail.callId,streamId:s};if(r.detail.data&&(N.descriptor=r.detail.data),ce.get(this).emit("error",N),Da.has(r.detail.errorCode)){var q=this.conversationCalls.get(r.detail.callId);q?this.unpublish(q.stream):(this.unsubscribeToStream(s),"CALL_ABORTED"===r.detail.errorCode&&this.callIdToStreamId.delete(r.detail.callId))}}else qe.debug("call is not linked with conversation")}}],E=[{key:"getAvailableEvents",value:function(){return _a}}],B&&On(O.prototype,B),E&&On(O,E),G}(Ne),pi=function(){var D="guest";if(apiRTC.userAgentInstance){var O=apiRTC.userAgentInstance.getUsername();O&&(D=O)}return D},xi=function(D){var O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(B,E){var U=null;if(W.g.isPropertyTypeof(O,"session","object")&&O.session instanceof Ii)U=O.session;else{if(null===Ii.getActiveSession())return E(W.g.createError(i.g.ERROR_BAD_PARAMETER,"getOrCreateConversation() - missing session",qe));U=Ii.getActiveSession()}var ae={};ae.token=U.getToken(),ae.active=D.active,Rn.getOrCreateConversation(D,ut.getActiveApiKey(),ae).then(function(pe){W.g.isTypeof(pe,"public_id","string")&&(pe.id=pe.public_id,delete pe.public_id),Ae.set(D,pe.id),Ce.set(D,pe.data),W.g.isTypeof(pe.typeString,"string")&&Ia.has(pe.typeString)&&ua.set(D,pe.typeString),dt.set(D,U),B(pe)}).catch(function(pe){Ae.set(D,null),Ce.set(D,null),ua.set(D,null),E(W.g.createError(i.g.ERROR_HTTP,"getOrCreateConversation() - cannot get/create conversation",qe,{fromError:pe}))})})},ti=function(D){var O=D.getModerator();return O?O.getId():!D.conference&&D.moderationEnabled?"#":null},Yi=function(D,O){return new Promise(function(B,E){if(D.conference){if(O.access===i.g.CONVERSATION_ACCESS_GRANTED)return B(O);if(O.access!==i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION)return E(W.g.createError(i.g.ERROR_BAD_PARAMETER,"You were not allowed to join the conference"));var U=zi.getOrCreateContact(O.moderator);st.set(D,U),Xi(D).then(function(){B(O)}).catch(E)}else{if(!D.moderationEnabled)return B(Object.assign(O,{access:i.g.CONVERSATION_ACCESS_GRANTED,role:i.g.CONVERSATION_ROLE_GUEST}));if(D.moderator)return B(Object.assign(O,{access:i.g.CONVERSATION_ACCESS_GRANTED,role:i.g.CONVERSATION_ROLE_MODERATOR}));Xi(D).then(function(){B(Object.assign(O,{access:i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION,role:i.g.CONVERSATION_ROLE_GUEST}))}).catch(E)}})},Xi=function(D){return new Promise(function(O,B){var E=D.getModerator();D.status=i.g.CONVERSATION_STATUS_WAITING;var U=!1,ae=setTimeout(function(){ut.apiRTCSession.joinPresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]),U=!0},i.g.JOIN_WAITING_ROOM_PRESENCE_GROUP_TIMEOUT);E&&ce.get(D).emit("waitingForModeratorAcceptance",E);var pe=new St(E,D);pe.id=D._getTechnicalName(),pe.type=D.conference?"conference":"conversation",D.sendJoinRequest();var G=function r(s){qe.debug("dataMessage (waitingRoom)",s.detail);var N=s.detail.data;if(N.roomname===D._getTechnicalName()){var q=s.detail.senderId.toString();"access"===N.command||"access-new"===N.command||N.event===i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER?(delete D.cancelJoin0,D.joinRequestIntervalId&&(clearInterval(D.joinRequestIntervalId),delete D.joinRequestIntervalId),ut.removeEventListener("receiveData",r),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):ae&&clearTimeout(ae),N.value.hasOwnProperty("access")&&N.value.access||N.access?(ut.sendData(q,{roomname:D._getTechnicalName(),command:"access-ack"}).catch(function(ee){var te=W.g.createError(ee,"Notification not delivered",qe);ce.get(D).emit("messageNotDelivered",{error:te,contact:E,command:"access-ack"})}),O()):(D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,B(W.g.createError(i.g.ERROR_NOT_ALLOWED,"You were not allowed to join the conversation",qe)))):N.event===i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER&&N.roomname===D._getTechnicalName()&&ce.get(D).emit("moderatorConnected",zi.getOrCreateContact(q))}};ut.onEvent("receiveData",G),pe.onResponse(function(r){ut.removeEventListener("receiveData",G),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):ae&&clearTimeout(ae),r===i.g.INVITATION_STATUS_ACCEPTED?O():(D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,B(W.g.createError(i.g.ERROR_NOT_ALLOWED,"You were not allowed to join the conversation",qe)))}),D.cancelJoin0=function(){return delete D.cancelJoin0,D.joinRequestIntervalId&&(clearInterval(D.joinRequestIntervalId),delete D.joinRequestIntervalId),ut.removeEventListener("receiveData",G),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):ae&&clearTimeout(ae),D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,B(W.g.createError(i.g.ERROR_OPERATION_CANCELED,"Operation canceled",qe)),!0}})},vn=function(D,O,B){return new Promise(function(E){Rn.updateConferencePresence(D,O,B).then(E,function(U){qe.warn("updateConferencePresence",U),E()})})},Ri=function(D,O){var B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},E=B.stream;if(!E){var U=D.conversationCalls.get(O);if(!U)return!1;E=U.stream}return B.noTriggerAdaptation?D.releaseResources(E.userMediaStreamId):D.releaseResources(E.userMediaStreamId,{triggerAdaptation:!0}),E.publishedInConversations.delete(D.getName()),D.conversationPublishedStreams.delete(E.userMediaStreamId),D.callIdToStreamId.delete(O),D.conversationCalls.delete(O),!0},kn=function(D,O){var B={streamId:O.streamId,isRemote:O.isRemote};if(O.isRemote)if(O.isVideoOnly){B.action="hangup";var E=Fe.get(D).get(O.streamId);E&&(B.callId=E.callId),qe.debug("disableVideoTrack - hangup",O.streamId),D.unsubscribeToStream(O.streamId,{noTriggerAdaptation:!0})}else{B.action="disableTrack",B.trackType="video";var U=Fe.get(D).get(O.streamId);U&&(B.callId=U.callId),qe.debug("disableVideoTrack - disable video track",O.streamId),D.updateSubscribedStream(O.streamId,{audioOnly:!0}).catch(function(r){qe.error("disableVideoTrack - updateSubscribedStream",r)}),O.isVideoMuted=!0}else if(O.isVideoOnly){B.action="hangup";var ae=Nn.get(O.streamId),pe=D.getConversationCall(ae);pe&&(B.callId=pe.callId),qe.debug("disableVideoTrack - hangup",O.streamId),D.unpublish(ae,{noTriggerAdaptation:!0})}else{var G=D.getConversationCall(Nn.get(O.streamId));G?(B.action="disableTrack",B.trackType="video",B.callId=G.callId,qe.debug("disableVideoTrack - disable video track",O.streamId),G.updatePublishedStream("video",!1).catch(function(r){qe.error("disableVideoTrack - updatePublishedStream",r)}),O.isVideoMuted=!0):B=null}B&&ce.get(D).emit("adaptationTriggered",B)},sn=function(D,O){var B={streamId:O.streamId,isRemote:O.isRemote,action:"enableTrack",trackType:"video"};if(O.isRemote){var E=Fe.get(D).get(O.streamId);E&&(B.callId=E.callId),qe.debug("enableVideoTrack - enable video track",O.streamId),D.updateSubscribedStream(O.streamId,{audioOnly:!1}).catch(function(ae){qe.error("enableVideoTrack - updateSubscribedStream",ae)}),O.isVideoMuted=!1}else{var U=D.getConversationCall(Nn.get(O.streamId));U?(B.callId=U.callId,qe.debug("enableVideoTrack - enable video track",O.streamId),U.updatePublishedStream("video",!0).catch(function(ae){qe.error("enableVideoTrack - updatePublishedStream",ae)}),O.isVideoMuted=!1):B=null}B&&ce.get(D).emit("adaptationTriggered",B)},Wi=function(D,O,B){return!0===B?D.pointerSharingState===i.g.STATE_IDLE?(D.pointerSharingState=i.g.STATE_JOINING,new Promise(function(E,U){ut.pointerSharingClient.joinRoom(D._getTechnicalName(),{success:function(ae){D.pointerSharingState=i.g.STATE_ACTIVE,!0===O&&(D.pointerSharingAutoInvite=!0);var pe={enabled:!0,roomId:ae};ce.get(D).emit("pointerSharingEnabled",pe),E(),!0===D.pointerSharingAutoInvite&&zi.getContacts(D._getTechnicalName()).forEach(function(G){ut.pointerSharingClient.inviteInRoom(D._getTechnicalName(),G.getId())})},failure:function(ae,pe){D.pointerSharingState=i.g.STATE_IDLE,D.pointerSharingAutoInvite=!1,U(ae)}})})):Promise.reject(W.g.createError(i.g.ERROR_WRONG_STATE,"enablePointerSharing() - cannot enable pointer sharing")):!1===B?D.pointerSharingState===i.g.STATE_ACTIVE?(D.pointerSharingState=i.g.STATE_LEAVING,new Promise(function(E,U){ut.pointerSharingClient.leaveRoom(D._getTechnicalName()),D.pointerSharingState=i.g.STATE_IDLE,D.pointerSharingAutoInvite=!1;var ae={enabled:!1,roomId:D._getTechnicalName()};ce.get(D).emit("pointerSharingEnabled",ae),E()})):Promise.reject(W.g.createError(i.g.ERROR_WRONG_STATE,"enablePointerSharing() - cannot disable pointer sharing")):Promise.reject(W.g.createError(i.g.ERROR_BAD_PARAMETER,"enablePointerSharing() - cannot enable/disable pointer sharing"))},Sn=function(D,O){var B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return["roomName","callId","clientId"].forEach(function(E){O.hasOwnProperty(E)&&(B[E]=String(O[E]))}),B};function va(D){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function nr(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Ba(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function Ga(D,O,B){return(Ga="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(E,U,ae){var pe=function(r,s){for(;!Object.prototype.hasOwnProperty.call(r,s)&&null!==(r=ka(r)););return r}(E,U);if(pe){var G=Object.getOwnPropertyDescriptor(pe,U);return G.get?G.get.call(ae):G.value}})(D,O,B||D)}function vr(D,O){return(vr=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Do(D,O){if(O&&("object"===va(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return function(B){if(void 0===B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}(D)}function ka(D){return(ka=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}e(2222);var Ki=R.Y.get("Conference"),ko=Gt.getAvailableEvents().concat(["closed"]),ar=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&vr(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=ka(U);if(ae){var N=ka(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Do(this,r)});function G(r){var s,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return nr(this,G),s=pe.call(this,r,N),Ki.info("Create conference"),s.conference=!0,s.friendlyName=N.hasOwnProperty("friendlyName")?N.friendlyName:r,s}return O=G,E=[{key:"getAvailableEvents",value:function(){return ko}}],(B=[{key:"destroy",value:function(){rn.get().deleteConference(this.getName()),Ga(ka(G.prototype),"destroy",this).call(this)}},{key:"_getTechnicalName",value:function(){return No()+da.get(this)}},{key:"getFriendlyName",value:function(){return this.friendlyName}},{key:"getInfo",value:function(){var r=this;return new Promise(function(s,N){var q={},ee=dt.get(r);ee&&(q.token=ee.getToken()),Rn.getWebconf(r._getTechnicalName(),q).then(function(te){return s({dtmfCode:te.dtmfCode,endTime:te.end,hasPassword:te.hasPassword,sipNumber:te.sipNumber,startTime:te.start,state:te.state,type:te.type})}).catch(function(te){return N(W.g.createError(i.g.ERROR_OTHER,"getInfo() - Cannot get conference info",Ki))})})}},{key:"close",value:function(){var r=this;return Ki.debug("Closing "+this.getName()),new Promise(function(s,N){r.status!==i.g.CONVERSATION_STATUS_JOINED?N(W.g.createError(i.g.ERROR_OTHER,"close() - Conversation has to be joined to be closed",Ki)):r.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR?N(W.g.createError(i.g.ERROR_UNAUTHORIZED,"close() - Role has to be moderator to close the conversation",Ki)):Rn.closeConferenceInstance(r,dt.get(r)).then(function(){Ki.debug("Conversation closed successfully"),ut.dataClient.sendDataToGroup(r._getTechnicalName(),{event:i.g.CONVERSATION_CLOSED_IDENTIFIER,instanceId:r.getInstanceId(),roomname:r._getTechnicalName()}),ce.get(r).emit("closed"),r.leave(),s()}).catch(function(q){var ee="close() - An error occured when closing conversation",te={error:new Error(ee),code:i.g.ERROR_OTHER};Ki.error(ee,q),q.hasOwnProperty("code")?te.code=q.code:q.hasOwnProperty("http_code")&&(te.code=q.http_code.toString().startsWith("4")?i.g.ERROR_UNAUTHORIZED:i.g.ERROR_SERVER_UNAVAILABLE),N(te)})})}},{key:"sendInvitation",value:function(r,s){var N=this;if(s||(s={}),r instanceof Ei){Ki.info("Invite "+r.getId()+" to "+this._getTechnicalName()),r.isOnline()||Ki.warn("sendInvitation() - contact "+r.getUsername()+" does not seem to be connected.");var q={receiveNotifier:new w};s.hasOwnProperty("expirationTime")&&(q.expirationTime=s.expirationTime);var ee=new St(r,this,q),te={event:i.g.CONVERSATION_INVITATION_IDENTIFIER,invitationId:ee.id,roomname:this._getTechnicalName(),friendlyName:this.getFriendlyName(),sendTime:ee.sendTime};return ee.type="conference",null!==Kt.get(this)&&(te.password=Kt.get(this)),ut.sendData(r.getId(),te).then(function(){q.receiveNotifier.emit("receive")}).catch(function($){var ue=W.g.createError($,"Invitation not delivered",Ki);ce.get(N).emit("messageNotDelivered",{error:ue,contact:r,event:i.g.CONVERSATION_INVITATION_IDENTIFIER})}),ee}return Ki.error("Parameter is not a contact"),null}},{key:"getTags",value:function(){var r=this;return new Promise(function(s,N){var q=Ii.getActiveSession();if(!q)return N(W.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - no session found",Ki));var ee=q.getUserAgent().getEnterprise();if(!ee)return N(W.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - no enterprise found",Ki));ee.getTags(r).then(function(te){for(var $=[],ue=0;ue<te.length;ue+=1)!0===te[ue].selected&&$.push(te[ue]);return s($)}).catch(function(te){return N(W.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - cannot get tags",Ki,{fromError:te}))})})}},{key:"setTags",value:function(r){var s=this;return new Promise(function(N,q){if(!Array.isArray(r))return q(W.g.createError(i.g.ERROR_BAD_PARAMETER,"setTags() - wrong tags",Ki));if(!s.webconfId)return q(W.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no webconf found",Ki));var ee=Ii.getActiveSession();if(!ee)return q(W.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no session found",Ki));var te=ee.getUserAgent().getEnterprise();if(!te)return q(W.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no enterprise found",Ki));var $=ee.getToken();if(!$)return q(W.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no token found",Ki));for(var ue=[],Ie=0;Ie<r.length;Ie+=1){if(!r[Ie].hasOwnProperty("id"))return q(W.g.createError(i.g.ERROR_BAD_PARAMETER,"setTags() - wrong tags",Ki));ue.push(r[Ie].id)}Rn.updateWebconfTags(te.getId(),s.webconfId,ue,$).then(function(){return N()}).catch(function(Ue){return q(W.g.createError(i.g.ERROR_OTHER,"setTags() - cannot set tags",Ki,{fromError:Ue}))})})}}])&&Ba(O.prototype,B),E&&Ba(O,E),G}(Gt),No=function(){return ut.getActiveApiKey()+":"};function Lr(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}R.Y.get("ConversationCatalog");var qa=null,rn=function(){function D(){if(function(U,ae){if(!(U instanceof ae))throw new TypeError("Cannot call a class as a function")}(this,D),null!==qa)throw"Cannot construct singleton ConversationCatalog";this.conversationList=new Map,this.conferenceList=new Map,qa=this}var O,B,E;return O=D,B=[{key:"deleteConversation",value:function(U){return!!(W.g.isTypeof(U,"string")&&U.length>0)&&this.conversationList.delete(U)}},{key:"deleteConference",value:function(U){return!!(W.g.isTypeof(U,"string")&&U.length>0)&&this.conferenceList.delete(U)}},{key:"getOrCreateConversation",value:function(U){var ae=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},pe=null;return null!=U&&""!==U?this.conversationList.has(U.toString())?pe=this.conversationList.get(U.toString()):(pe=new Gt(U.toString(),ae),this.conversationList.set(U.toString(),pe)):(pe=new Gt(null,ae),this.conversationList.set(pe.getName(),pe)),pe}},{key:"getOrCreateConference",value:function(U){var ae=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},pe=null;return null!=U&&""!==U?this.conferenceList.has(U.toString())?pe=this.conferenceList.get(U.toString()):(pe=new ar(U.toString(),ae),this.conferenceList.set(U.toString(),pe)):(pe=new ar(null,ae),this.conferenceList.set(pe.getName(),pe)),pe}},{key:"getConversations",value:function(){return this.conversationList}},{key:"getConferences",value:function(){return this.conferenceList}},{key:"isConference",value:function(U){return xr(U).hasOwnProperty("apiKey")}},{key:"getNameFromTechnicalName",value:function(U){return xr(U).name}}],E=[{key:"get",value:function(){return null===qa&&(qa=new D),qa}}],B&&Lr(O.prototype,B),E&&Lr(O,E),D}();function xr(D){var O=D.match(/^([^:]+)[:]([^:]+)$/);return null===O||O.length<3?{name:D}:{apiKey:O[1],name:O[2]}}function Cr(D){return(Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Na(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return Wr(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?Wr(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function Wr(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function jr(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function br(D,O){return(br=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Po(D,O){if(O&&("object"===Cr(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return ci(D)}function ci(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function rr(D){return(rr=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var At=R.Y.get("Session"),Mi=Rt.get(),Ha=new(fe()),Cn=Ni.get(),Uo=["rawData","whiteboardInvitation","fileTransferInvitation","conversationMessage","conversationData","dataChannelInvitation","contactMessage","contactData","customEvent","conversationInvitation","incomingCall","disconnect","error","contactListUpdate","reconnecting","reconnection","conversationJoinRequest","newMediaAvailableFromContact","whiteboardRoomMemberUpdate","incomingScreenSharingCall","pointerSharingInvitation","pointerLocationChanged","incomingScreenSharingCallInvitation","cloudEventOccurred"],Vr=new WeakMap,Ja=new WeakMap,or=null,yr=new WeakMap,za=new WeakMap,Ii=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&br(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=rr(U);if(ae){var N=rr(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Po(this,r)});function G(r){var s;(function(te,$){if(!(te instanceof $))throw new TypeError("Cannot call a class as a function")})(this,G),s=pe.call(this,At),At.debug("Create Session"),s.id=null,s.token=null,s.ccsToken=null,Vr.set(ci(s),r),Ja.set(ci(s),null),za.set(ci(s),{}),s.isRecording=!1,s.userData=new ot,s.contactListUpdateListenerSetted=!1,s.waitingContactListUpdateEvent=[];var N=Ji.get(),q=rn.get(),ee={};return s.invitationsMap=new Map,ee.channelEvent=function(te){switch(te.detail.channelEvent){case"onChannelReconnecting":ce.get(ci(s)).emit("reconnecting",te);break;case"onChannelReconnect":ce.get(ci(s)).emit("reconnection",te);break;case"onChannelError":ce.get(ci(s)).emit("error",te);break;case"onChannelDisconnect":At.error("Session :: onChannelDisconnect"),ce.get(ci(s)).emit("disconnect",te)}},ee.incomingCall=function(te){var $=N.getOrCreateContact(te.detail.callerId),ue=te.detail.callId.toString();if("data"===te.detail.callType)if(At.info("Received file transfer invitation from "+$.getUsername()),W.g._private.dataCallsFileInfo.has(ue)){var Ie=W.g._private.dataCallsFileInfo.get(ue),Ue=null;s.invitationsMap.has(te.detail.callerId+"-sendfile-"+ue)?(Ue=s.invitationsMap.get(te.detail.callerId+"-sendfile-"+ue),At.debug("invitation already exist :",Ue)):(Ue=new Tn($,ue,Ie),s.invitationsMap.set(te.detail.callerId+"-sendfile-"+ue,Ue)),ce.get(ci(s)).emit("fileTransferInvitation",Ue)}else W.g._private.dataChannelInvitations.has(ue)?ce.get(ci(s)).emit("dataChannelInvitation",new hn($,ue)):(At.debug("File information has not been received yet, putting invitation on hold"),W.g._private.dataCallsOnHold.set(ue));else if("screenSharing"===te.detail.callType)if(!0===apiRTC.session.apiCCWebRTCClient.webRTCClient.userAcceptOnIncomingScreenSharingCall){At.debug("Received screenSharingCallInvitation from "+$.getUsername());var vt=new Pi($,ue,te.detail.callType,{isRecorded:!!te.detail.hasOwnProperty("recordedCall")&&te.detail.recordedCall});ce.get(ci(s)).emit("incomingScreenSharingCallInvitation",vt)}else{At.debug("Received screenSharingCall from "+$.getUsername());var pt=Cn.getOrCreateCall(ue,$,{started:!0,isRecorded:!!te.detail.hasOwnProperty("recordedCall")&&te.detail.recordedCall});ce.get(ci(s)).emit("incomingScreenSharingCall",pt)}else{At.info("Received call invitation from "+$.getUsername());var kt=new Pi($,ue,te.detail.callType,{isRecorded:!!te.detail.hasOwnProperty("recordedCall")&&te.detail.recordedCall});ce.get(ci(s)).emit("incomingCall",kt)}},ee.roomInvitation=function(te){var $=N.getOrCreateContact(te.detail.senderId);if("whiteBoard"===te.detail.roomType){if(null!==$){At.info("Received whiteboard invitation from "+$.getUsername());var ue={};te.detail.cloudConvId&&(ue.cloudConvId=te.detail.cloudConvId),!0===te.detail.webconf&&(ue.webconf=!0),ce.get(ci(s)).emit("whiteboardInvitation",new Bt($,te.detail.roomId,ue))}}else"pointerSharing"===te.detail.roomType&&(null===$||q.getConversations().has(te.detail.roomId)||q.getConferences().has(te.detail.roomId)||(At.info("Received pointer sharing invitation from "+$.getUsername()),ce.get(ci(s)).emit("pointerSharingInvitation",new Z($,te.detail.roomId,ci(s)))))},ee.roomMemberUpdate=function(te){var $,ue=[],Ie=Na(te.detail.contactList);try{for(Ie.s();!($=Ie.n()).done;)ue.push(N.getOrCreateContact($.value.contactId))}catch(vt){Ie.e(vt)}finally{Ie.f()}"whiteBoard"===te.detail.roomType&&(At.info("Received whiteboard room member update"),ce.get(ci(s)).emit("whiteboardRoomMemberUpdate",{contacts:ue,roomId:te.detail.roomId,status:te.detail.status}))},ee.receiveRoomMessage=function(te){if(At.debug("receiveRoomMessage",te),"pointerSharing"===te.detail.roomType&&"pointerLocation"===te.detail.message.type&&za.get(ci(s)).hasOwnProperty(te.detail.roomId)){var $={sender:N.getOrCreateContact(te.detail.senderId),source:te.detail.message.source,x:te.detail.message.x,y:te.detail.message.y};W.g.isPropertyTypeof(te.detail.message,"data","object")&&($.data=te.detail.message.data),ce.get(ci(s)).emit("pointerLocationChanged",$)}},ee.receiveIMMessage=function(te){var $=N.getOrCreateContact(te.detail.senderId);At.debug("Received IM from "+$.getUsername()+" : ",te.detail.message),ce.get(ci(s)).emit("contactMessage",{sender:$,content:te.detail.message,uuid:te.detail.UUCSeq,time:te.detail.time})},ee.receiveData=function(te){var $=N.getOrCreateContact(te.detail.senderId),ue=te.detail.data,Ie=null;if(void 0!==ue.roomname&&(Ie=q.isConference(ue.roomname)?q.getOrCreateConference(q.getNameFromTechnicalName(ue.roomname)):q.getOrCreateConversation(q.getNameFromTechnicalName(ue.roomname))),At.trace("Received data from "+$.getId(),te.detail),ce.get(ci(s)).emit("rawData",{sender:$,content:ue}),void 0!==ue.event)switch(ue.event){case i.g.INVITATION_ANSWER_IDENTIFIER:case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:case i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER:case i.g.CONVERSATION_CLOSED_IDENTIFIER:break;case i.g.CONTACT_SEND_DATA_IDENTIFIER:At.debug("Received contact data from "+$.getUsername(),ue.content),ce.get(ci(s)).emit("contactData",{sender:$,content:ue.content});break;case i.g.CONVERSATION_SEND_DATA_IDENTIFIER:void 0!==ue.roomname&&(At.debug("Received conversation data from "+$.getUsername(),ue.content),ce.get(ci(s)).emit("conversationData",{sender:$,conversation:Ie,content:ue.content}));break;case i.g.CONTACT_NEW_MEDIA_IDENTIFIER:ce.get(ci(s)).emit("newMediaAvailableFromContact",{sender:$,media:ue.media});break;case i.g.CONTACT_DATACHANNEL_INVITATION:At.debug("Received datachannel invitation from "+$.getUsername()),W.g._private.dataChannelInvitations.set(ue.callId.toString(),!0),W.g._private.dataCallsOnHold.has(ue.callId.toString())&&ce.get(ci(s)).emit("dataChannelInvitation",new hn($,ue.callId.toString()));break;case i.g.CONTACT_SEND_FILEINFO_IDENTIFIER:At.debug("Received file info from "+$.getUsername(),ue.fileInfo);var Ue=ue.callId.toString();if(W.g._private.dataCallsFileInfo.set(Ue,ue.fileInfo),W.g._private.dataCallsOnHold.has(Ue)){var vt=null;s.invitationsMap.has($.getId()+"-sendfile-"+Ue)?(vt=s.invitationsMap.get($.getId()+"-sendfile-"+Ue),At.debug("invitation already exist :",vt)):(vt=new Tn($,Ue,ue.fileInfo),s.invitationsMap.set(te.detail.callerId+"-sendfile-"+Ue,vt)),ce.get(ci(s)).emit("fileTransferInvitation",vt)}else At.debug("no dataCallsOnHold");break;case i.g.CONVERSATION_INVITATION_IDENTIFIER:if(void 0!==ue.roomname){At.info("Received conversation invitation from "+$.getUsername());var pt={session:ci(s)};ue.hasOwnProperty("password")&&(pt.password=ue.password),Ie?(ue.hasOwnProperty("friendlyName")&&Ie.name===Ie.friendlyName&&(Ie.friendlyName=ue.friendlyName),ce.get(ci(s)).emit("conversationInvitation",new ye($,ue,Ie,pt))):ce.get(ci(s)).emit("conversationInvitation",new ye($,ue,null,pt))}break;case i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER:At.info("Received conversation join request from "+$.getUsername()),Ie?ce.get(ci(s)).emit("conversationJoinRequest",new Vn($,Ie,ue.invitationId)):ce.get(ci(s)).emit("conversationJoinRequest",new Vn($,null,null));break;default:var kt={event:ue.event,content:ue,sender:$};null!==Ie&&(kt.conversation=Ie),ce.get(ci(s)).emit("customEvent",kt)}else if(void 0!==ue.command)switch(ue.command){case"userWaiting":case"userWaiting-new":At.info("Received conversation join request from "+$.getUsername()),Ie?ce.get(ci(s)).emit("conversationJoinRequest",new Vn($,Ie,null)):ce.get(ci(s)).emit("conversationJoinRequest",new Vn($,null,null))}},ee.receiveGroupChatMessage=function(te){var $=N.getOrCreateContact(te.detail.senderId),ue=null,Ie=te.detail.groupChatId.toString();if(void 0!==Ie&&(ue=q.isConference(Ie)?q.getOrCreateConference(q.getNameFromTechnicalName(Ie)):q.getOrCreateConversation(q.getNameFromTechnicalName(Ie))),null!==ue){At.debug("Received conversation message from "+$.getUsername(),te.detail.message);var Ue={sender:$,conversation:ue,content:te.detail.message};W.g.isTypeof(te.detail,"metadata","object")&&(Ue.metadata=te.detail.metadata),ce.get(ci(s)).emit("conversationMessage",Ue)}},ee.cloudEventOccurred=function(te){var $={topic:te.detail.topic,target:te.detail.target};ce.get(ci(s)).emit("cloudEventOccurred",$)},ee.callEstablished=function(te){if(void 0!==te.detail.callId){var $=te.detail.callId.toString();At.debug("callEstablished",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&ue.manageCallEstablishedEvent(te)}else At.debug("callEstablished",te.detail)},ee.remoteStreamAdded=function(te){if(void 0!==te.detail.callId){var $=te.detail.callId.toString();At.debug("remoteStreamAdded",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&ue.manageRemoteStreamAddedEvent(te)}else At.debug("remoteStreamAdded",te.detail)},ee.remoteStreamRemoved=function(te){if(void 0!==te.detail.callId){var $=te.detail.callId.toString();At.debug("remoteStreamRemoved",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&ue.manageRemoteStreamRemovedEvent(te)}else At.debug("remoteStreamRemoved",te.detail)},ee.userMediaSuccess=function(te){var $=null;if(null!=te.detail.callId){$=te.detail.callId.toString(),At.debug("userMediaSuccess",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&ue.manageUserMediaSuccessEvent(te)}else At.debug("userMediaSuccess",te.detail)},ee.onCallStatsUpdate=function(te){if(void 0!==te.detail.callId){var $=te.detail.callId.toString(),ue=Cn.getCall($,null,{});null!==ue&&ue.manageCallStatsUpdateEvent(te)}else At.debug("onCallStatsUpdate",te.detail)},ee.error=function(te){if(At.debug("error",te.detail),null!=te.detail.roomName){At.debug("error on conversation :",te.detail,te.detail.roomName,te.detail.callId);var $=null;void 0!==te.detail.roomName&&null!==($=q.isConference(te.detail.roomName)?q.getOrCreateConference(q.getNameFromTechnicalName(te.detail.roomName)):q.getOrCreateConversation(q.getNameFromTechnicalName(te.detail.roomName)))&&$.manageErrorEvent(te)}else if(void 0!==te.detail.callId){var ue=te.detail.callId.toString();At.debug("error",te.detail,ue);var Ie=Cn.getCall(ue,null,{});null!==Ie&&(Ie.manageErrorEvent(te),"RECORDING_FAILED"===te.detail.errorCode&&Cn.removeCallFromList(Ie.getId()))}else At.debug("error",te.detail),ce.get(ci(s)).emit("error",te.detail)},ee.disconnectionWarning=function(te){if(null!==te.detail.roomName){At.debug("disconnectionWarning on conversation :",te.detail,te.detail.roomName,te.detail.callId);var $=null;void 0!==te.detail.roomName&&null!==($=q.isConference(te.detail.roomName)?q.getOrCreateConference(q.getNameFromTechnicalName(te.detail.roomName)):q.getOrCreateConversation(q.getNameFromTechnicalName(te.detail.roomName)))&&$.manageDisconnectionWarningEvent(te)}else if(te.detail.callId){var ue=te.detail.callId.toString();At.debug("disconnectionWarning",te.detail,ue);var Ie=Cn.getCall(ue,null,{});null!==Ie&&Ie.manageDisconnectionWarningEvent(te)}else At.debug("disconnectionWarning",te.detail)},ee.hangup=function(te){if(te.detail.callId){var $=te.detail.callId.toString();At.debug("hangup",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&(ue.manageHangupEvent(te),!1===ue.isRecorded()&&Cn.removeCallFromList(ue.getId()))}else At.debug("hangup",te.detail)},ee.recordedStreamsAvailable=function(te){if(te.detail.userId2){var $=N.getOrCreateContact(te.detail.userId2),ue=Cn.getCall(null,$);ue&&(ue.manageRecordAvailableEvent(te),Cn.removeCallFromList(ue.getId()))}else At.debug("recordedStreamsAvailable",te.detail)},ee.desktopCapture=function(te){if(te.detail.callId){var $=te.detail.callId.toString();At.warn("desktopCapture",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&(ue.manageDesktopCaptureEvent(te),Cn.removeCallFromList(ue.getId()))}else At.debug("desktopCapture",te.detail)},ee.userMediaError=function(te){if(te.detail.callId){var $=te.detail.callId.toString();At.warn("userMediaError",te.detail,$);var ue=Cn.getCall($,null,{});null!==ue&&(ue.manageUserMediaErrorEvent(te),!1===te.detail.tryAudioCallActivated&&Cn.removeCallFromList(ue.getId()))}else At.debug("userMediaError",te.detail)},At.debug("av apiRTCManager onEvent ..."),Mi.onEvent("disconnectionWarning",ee.disconnectionWarning).onEvent("incomingCall",ee.incomingCall).onEvent("roomInvitation",ee.roomInvitation).onEvent("roomMemberUpdate",ee.roomMemberUpdate).onEvent("receiveRoomMessage",ee.receiveRoomMessage).onEvent("receiveIMMessage",ee.receiveIMMessage).onEvent("receiveData",ee.receiveData).onEvent("receiveGroupChatMessage",ee.receiveGroupChatMessage).onEvent("cloudEventOccurred",ee.cloudEventOccurred).onEvent("callEstablished",ee.callEstablished).onEvent("remoteStreamAdded",ee.remoteStreamAdded).onEvent("remoteStreamRemoved",ee.remoteStreamRemoved).onEvent("userMediaSuccess",ee.userMediaSuccess).onEvent("onCallStatsUpdate",ee.onCallStatsUpdate).onEvent("error",ee.error).onEvent("hangup",ee.hangup).onEvent("recordedStreamsAvailable",ee.recordedStreamsAvailable).onEvent("desktopCapture",ee.desktopCapture).onEvent("userMediaError",ee.userMediaError),apiRTC.addEventListener("channelEvent",ee.channelEvent),N.onUpdate(function(te){!1===s.contactListUpdateListenerSetted&&(At.debug("No listener for contactListUpdate, storing event ..."),s.waitingContactListUpdateEvent.push(te)),ce.get(ci(s)).emit("contactListUpdate",te)}),yr.set(ci(s),ee),s}return O=G,B=[{key:"getToken",value:function(){return this.token}},{key:"getId",value:function(){return this.id}},{key:"getUserAgent",value:function(){return Vr.get(this)}},{key:"getContact",value:function(r){return At.warn("getContact() - Method deprecated, use Session.getOrCreateContact() instead"),Ji.get().getOrCreateContact(r)}},{key:"getOrCreateContact",value:function(r){return Ji.get().getOrCreateContact(r)}},{key:"createConversation",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.warn("createConversation() - Method deprecated, use Session.getConversation() instead"),this.getConversation(r,s)}},{key:"getConversation",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.trace("Getting conversation "+r,s),rn.get().getOrCreateConversation(r)}},{key:"getConference",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.trace("Getting conference "+r,s),rn.get().getOrCreateConference(r)}},{key:"getOrCreateConversation",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=rn.get().getNameFromTechnicalName(r);return rn.get().isConference(r)?rn.get().getOrCreateConference(N,s):rn.get().getOrCreateConversation(N,s)}},{key:"getOrCreateConference",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getOrCreateConversation(r,s)}},{key:"getActiveConversations",value:function(){var r,s={},N=rn.get().getConversations(),q=Na(N.keys());try{for(q.s();!(r=q.n()).done;){var ee=r.value,te=N.get(ee);te.isJoined()&&(s[ee]=te)}}catch($){q.e($)}finally{q.f()}return s}},{key:"getActiveConferences",value:function(){var r,s={},N=rn.get().getConferences(),q=Na(N.keys());try{for(q.s();!(r=q.n()).done;){var ee=r.value,te=N.get(ee);te.isJoined()&&(s[ee]=te)}}catch($){q.e($)}finally{q.f()}return s}},{key:"getWhiteboardClient",value:function(){return At.trace("getWhiteboardClient()"),Mi.whiteBoardClient}},{key:"setUserData",value:function(r){this.userData.setProps(r).setToSession()}},{key:"setUsername",value:function(r){this.userData.setProp("username",r).setToSession()}},{key:"setPhotoUrl",value:function(r){this.userData.setProp("photo_url",r).setToSession()}},{key:"getUserData",value:function(){return this.userData}},{key:"getUsername",value:function(){return null!==this.userData.get("username")?this.userData.get("username"):null!==this.userData.get("nickname")?this.userData.get("nickname"):this.id.toString()}},{key:"getPhotoUrl",value:function(){return null!==this.userData.get("photo_url")?this.userData.get("photo_url"):null!==this.userData.get("photoUrl")?this.userData.get("photoUrl"):this.userId?Ha.getUserPhotoUrl(this.userId):null}},{key:"subscribeToGroup",value:function(r){this.getSubscribedPresenceGroup().includes(r)?At.debug("Already subscribed to this group"):Mi.apiRTCSession.subscribePresenceGroup([r])}},{key:"unsubscribeToGroup",value:function(r){this.getSubscribedPresenceGroup().includes(r)?Mi.unsubscribeToPresenceGroup(r):At.debug("Not subscribed to this group")}},{key:"joinGroup",value:function(r){this.getPresenceGroup().includes(r)?At.debug("Already joined this group"):Mi.joinAndSubscribeToPresenceGroup(r)}},{key:"leaveGroup",value:function(r){this.getPresenceGroup().includes(r)?Mi.leaveAndUnsubscribeToPresenceGroup(r):At.debug("Group was not joined")}},{key:"subscribeToCloudEvent",value:function(r,s){Mi.subscribeToCloudEvent(r,s)}},{key:"unsubscribeToCloudEvent",value:function(r,s){Mi.unsubscribeToCloudEvent(r,s)}},{key:"joinConversationSpace",value:function(r){Mi.apiRTCSession.joinConversationSpace(r)}},{key:"leaveConversationSpace",value:function(r){Mi.apiRTCSession.leaveConversationSpace(r)}},{key:"getContacts",value:function(r){At.trace("getContacts()");var s,N={},q=Ji.get().getContacts(r),ee=Na(q.keys());try{for(ee.s();!(s=ee.n()).done;){var te=s.value;N[te]=q.get(te)}}catch($){ee.e($)}finally{ee.f()}return N}},{key:"getContactsArray",value:function(r){At.log("getContactsArray");var s=Ji.get().getContacts(r);return Array.from(s.values())}},{key:"getOnlineContactsArray",value:function(r){At.log("getOnlineContactsArray");var s=Ji.get().getOnlineContacts(r);return Array.from(s.values())}},{key:"getCall",value:function(r){return At.trace("getCall()"),Ni.get().getCall(r)}},{key:"getCalls",value:function(){At.trace("getCalls()");var r,s={},N=Ni.get().getCalls(),q=Na(N.keys());try{for(q.s();!(r=q.n()).done;){var ee=r.value;s[ee]=N.get(ee)}}catch(te){q.e(te)}finally{q.f()}return s}},{key:"disconnect",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{invalidateUserToken:!0};return new Promise(function(N,q){if(At.info("disconnect()"),null===r.token&&null===r.id)At.error("disconnect() - Session is already disconnected"),q("disconnect() - Session is already disconnected");else{var ee,te=Na(rn.get().getConversations().keys());try{for(te.s();!(ee=te.n()).done;){var $=ee.value;$.status===i.g.CONVERSATION_STATUS_JOINED&&$.leave()}}catch(kt){te.e(kt)}finally{te.f()}if(clearInterval(Ja.get(r)),Ja.set(r,null),null!==r.token&&s.hasOwnProperty("invalidateUserToken")&&s.invalidateUserToken)Ha.invalidateUserToken(r.token).then(function(){or=null,Mi.disconnect({invalidateApiCCId:!0}),r.id=null,r.token=null;for(var kt=yr.get(r),Ut=0,fi=Object.keys(kt);Ut<fi.length;Ut++){var $i=fi[Ut];At.info("Session, removing apiRTCManager event :",$i),Mi.removeEventListener($i,kt[$i])}N()}).catch(function(kt){At.error("disconnect() - An error occured during disconnection",kt),q(new Error("disconnect() - An error occured during disconnection"))});else{or=null,Mi.disconnect(),r.id=null;for(var ue=yr.get(r),Ie=0,Ue=Object.keys(ue);Ie<Ue.length;Ie++){var vt=Ue[Ie];At.info("Session, removing apiRTCManager event :",vt),Mi.removeEventListener(vt,ue[vt])}N()}}})}},{key:"cloudRequest",value:function(r,s,N){return Ha.cloudRequest(r,s,N)}},{key:"sendRawData",value:function(r,s){return new Promise(function(N,q){null!=r?Mi.sendData(r.getId(),s).then(N).catch(function(ee){switch(ee){case i.g.ERROR_TIMED_OUT:q(W.g.createError(i.g.ERROR_TIMED_OUT,"sendRawData() - Data transmission timed out ",At));break;case i.g.ERROR_NOT_FOUND:q(W.g.createError(i.g.ERROR_NOT_FOUND,"sendRawData() - Contact was not found ",At));break;default:q(W.g.createError(i.g.ERROR_OTHER,"sendRawData() - Data transmission timed out ",At))}}):q(W.g.createError(i.g.ERROR_OTHER,"sendRawData() - Contact undefined",At))})}},{key:"startRecordingOutgoingStream",value:function(r,s){this.isRecording?At.error("startRecordingOutgoingStream() - already recording"):(Mi.webRTCClient.startRecording(r,s),this.isRecording=!0)}},{key:"stopRecordingOutgoingStream",value:function(){var r=this;return new Promise(function(s,N){r.isRecording?(r.isRecording=!1,Mi.onceEvent("MCURecordedStreamsAvailable",function(q){s({filename:q.detail.recordedFileName,url:i.g.RECORD_PLAY_URL+q.detail.recordedFileName})}),Mi.webRTCClient.stopRecording()):(At.error("stopRecordingOutgoingStream() - not recording"),N(new Error("stopRecordingOutgoingStream() - not recording")))})}},{key:"init",value:function(r){var s=this;this.id=r,or=this,null===Ja.get(this)&&Ja.set(this,setInterval(function(){Lo(s)},3e4))}},{key:"setMCUServer",value:function(r){Mi.webRTCClient.setMCUConnector(r)}},{key:"allowMultipleCalls",value:function(r){Mi.webRTCClient.setAllowMultipleCalls(r)}},{key:"setCallStatsMonitoringEnabled",value:function(r,s){Mi.webRTCClient.enableCallStatsMonitoring(r,s)}},{key:"setQualityEvaluatingEnabled",value:function(r,s){Mi.webRTCClient.enableQualityEvaluating(r,s)}},{key:"getContactFromWebSession",value:function(r){var s=this;return new Promise(function(N,q){Ha.getSessionHistory(r,s.getToken()).then(function(ee){"1"!==ee.exist.toString()?q(W.g.createError(i.g.ERROR_NOT_FOUND,"No such web session",At)):ee.user1.toString()===s.getId()?N(s.getContact(ee.user2)):ee.user2.toString()===s.getId()?N(s.getContact(ee.user1)):q(W.g.createError(i.g.ERROR_UNAUTHORIZED,"User has no access to this web session",At))}).catch(function(ee){ee.hasOwnProperty("code")?q({code:ee.code,error:ee.error}):ee.hasOwnProperty("http_code")?ee.http_code.toString().startsWith("4")?q(W.g.createError(i.g.ERROR_OTHER,"Error while getting contact from websession",At)):q(W.g.createError(i.g.ERROR_SERVER_UNAVAILABLE,"Error while getting contact from websession",At)):q(W.g.createError(i.g.ERROR_OTHER,"Error while getting contact from websession",At))})})}},{key:"joinPointerSharingRoom",value:function(r){var s=this;return new Promise(function(N,q){if(za.get(s).hasOwnProperty(r))return q(W.g.createError(i.g.ERROR_WRONG_STATE,"joinPointerSharingRoom() - cannot join pointer sharing room again",At));Mi.pointerSharingClient.joinRoom(r,{success:function(ee){var te=new Sr(s,ee);za.get(s)[ee]=te,N(te)},failure:function(ee,te){q(W.g.createError("timeout"===ee?i.g.ERROR_TIMED_OUT:i.g.ERROR_OTHER,"joinPointerSharingRoom() - cannot join pointer sharing room",At))}})})}},{key:"getSubscribedPresenceGroup",value:function(){return void 0!==apiCC&&null!==apiCC.session&&void 0!==apiCC.session?apiCC.session.subscribeToPresenceGroup:null}},{key:"getPresenceGroup",value:function(){return void 0!==apiCC&&null!==apiCC.session&&void 0!==apiCC.session?apiCC.session.presenceGroup:null}}],E=[{key:"getAvailableEvents",value:function(){return Uo}},{key:"getActiveSession",value:function(){return or}}],B&&jr(O.prototype,B),E&&jr(O,E),G}(Ne),Sr=function(D,O){this.session=D,this.roomId=O,this.getRoomId=function(){return this.roomId},this.isActive=function(){return null!==this.session&&null!==this.roomId&&Mi.pointerSharingClient.roomActive(this.roomId)},this.leaveRoom=function(){var B=this;return new Promise(function(E,U){if(null===B.session||null===B.roomId)return U(W.g.createError(i.g.ERROR_WRONG_STATE,"leaveRoom() - cannot leave room again",At));Mi.pointerSharingClient.leaveRoom(B.roomId),delete za.get(B.session)[B.roomId],B.session=null,B.roomId=null,E()})},this.invite=function(B,E){var U=this;return new Promise(function(ae,pe){if(null===U.session||null===U.roomId)return pe(W.g.createError(i.g.ERROR_WRONG_STATE,"invite() - cannot invite",At));Mi.pointerSharingClient.inviteInRoom(U.roomId,B.getId(),E),ae()})},this.sendPointerLocation=function(B,E,U,ae){var pe=this;return new Promise(function(G,r){return null===pe.session||null===pe.roomId?r(W.g.createError(i.g.ERROR_WRONG_STATE,"sendPointerLocation() - cannot send pointer location",At)):Mi.pointerSharingClient.sendPointerLocation(pe.roomId,B,E,U,ae)?void G():r(W.g.createError(i.g.ERROR_WRONG_STATE,"sendPointerLocation() - cannot send pointer location",At))})}},Lo=function(D){for(var O=D.getActiveConferences(),B=0,E=Object.keys(O);B<E.length;B++)Ha.updateConferencePresence(O[E[B]],D,Mi.getActiveApiKey())},Pa=(e(9743),e(944));function Fr(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Br(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function Gr(D,O,B){return O&&Br(D.prototype,O),B&&Br(D,B),D}function Tr(D,O){return function(B){if(Array.isArray(B))return B}(D)||function(B,E){var U=null==B?null:"undefined"!=typeof Symbol&&B[Symbol.iterator]||B["@@iterator"];if(null!=U){var ae,pe,G=[],r=!0,s=!1;try{for(U=U.call(B);!(r=(ae=U.next()).done)&&(G.push(ae.value),!E||G.length!==E);r=!0);}catch(N){s=!0,pe=N}finally{try{r||null==U.return||U.return()}finally{if(s)throw pe}}return G}}(D,O)||function(B,E){if(B){if("string"==typeof B)return qr(B,E);var U=Object.prototype.toString.call(B).slice(8,-1);return"Object"===U&&B.constructor&&(U=B.constructor.name),"Map"===U||"Set"===U?Array.from(B):"Arguments"===U||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(U)?qr(B,E):void 0}}(D,O)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qr(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function Hr(D,O){var B=Tr(D,3),E=B[0],U=B[1],ae=B[2],pe=Tr(O,3),G=pe[0],r=pe[1],s=pe[2];return Math.pow(E*G+U*r+ae*s,2)/((Math.pow(E,2)+Math.pow(U,2)+Math.pow(ae,2))*(Math.pow(G,2)+Math.pow(r,2)+Math.pow(s,2)))}var Jr=function(){function D(O,B,E){Fr(this,D),this.width=B,this.height=E,this.length=this.width*this.height,this.frameBack=O,this.thresholdsAreComputed=!1,this.cosineThresholdIsComputed=!1}return Gr(D,[{key:"computeThresholds",value:function(){var O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],B=new Pa.H(this.frameBack,this.width,this.height),E=B.mad(O),U=Tr(E,3),ae=U[0],pe=U[1],G=U[2];return this.thresholdR=Math.max(1.25*ae,20),this.thresholdG=Math.max(1.25*pe,20),this.thresholdB=Math.max(1.25*G,20),this.meanThreshold=(this.thresholdR+this.thresholdG+this.thresholdB)/3,this.thresholdsAreComputed=!0,[this.thresholdR,this.thresholdG,this.thresholdB,this.meanThreshold]}},{key:"computeCosineThreshold",value:function(){var O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],B=new Pa.H(this.frameBack,this.width,this.height),E=B.mean(O);this.cosineThreshold=0;for(var U=0;U<this.length;U++){var ae=void 0;ae=O?[Math.pow(this.frameBack.data[4*U+0],2)/255,Math.pow(this.frameBack.data[4*U+1],2)/255,Math.pow(this.frameBack.data[4*U+2],2)/255]:[this.frameBack.data[4*U+0],this.frameBack.data[4*U+1],this.frameBack.data[4*U+2]],this.cosineThreshold+=Hr(ae,E)/this.length}return this.cosineThresholdIsComputed=!0,this.cosineThreshold}}]),D}(),xo=function(){function D(){var O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],ae=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],pe=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Fr(this,D),this.width=O,this.height=B,this.length=O*B,this.blurMask=E,this.homomorphicFilter=U,this.smoothBorder=ae,this.blurFactor=pe,this.smoothingFactor=G,this.useCosineSimilarity=r}return Gr(D,[{key:"computeMask",value:function(O,B){var E=B.frameBack;this.width=B.width,this.height=B.height,this.length=this.width*this.height,this.useCosineSimilarity||B.thresholdsAreComputed||B.computeThresholds(this.homomorphicFilter),this.useCosineSimilarity&&!B.cosineThresholdIsComputed&&B.computeCosineThreshold();var U=new Uint8ClampedArray(4*this.length);if(this.useCosineSimilarity)for(var ae=0;ae<this.length;ae++){var pe=void 0,G=void 0;this.homomorphicFilter?(pe=[Math.pow(O.data[4*ae+0],2)/255,Math.pow(O.data[4*ae+1],2)/255,Math.pow(O.data[4*ae+2],2)/255],G=[Math.pow(E.data[4*ae+0],2)/255,Math.pow(E.data[4*ae+1],2)/255,Math.pow(E.data[4*ae+2],2)/255]):(pe=[O.data[4*ae+0],O.data[4*ae+1],O.data[4*ae+2]],G=[E.data[4*ae+0],E.data[4*ae+1],E.data[4*ae+2]]),Hr(pe,G)<B.cosineThreshold?(U[4*ae+0]=255,U[4*ae+1]=255,U[4*ae+2]=255):(U[4*ae+0]=0,U[4*ae+1]=0,U[4*ae+2]=0),U[4*ae+3]=255}else for(var r=0;r<this.length;r++){var s=void 0,N=void 0,q=void 0;this.homomorphicFilter?(s=Math.abs(Math.pow(O.data[4*r+0],2)-Math.pow(E.data[4*r+0],2))/255,N=Math.abs(Math.pow(O.data[4*r+1],2)-Math.pow(E.data[4*r+1],2))/255,q=Math.abs(Math.pow(O.data[4*r+2],2)-Math.pow(E.data[4*r+2],2))/255):(s=Math.abs(O.data[4*r+0]-E.data[4*r+0]),N=Math.abs(O.data[4*r+1]-E.data[4*r+1]),q=Math.abs(O.data[4*r+2]-E.data[4*r+2])),s>B.thresholdR||N>B.thresholdG||q>B.thresholdB?(U[4*r+0]=255,U[4*r+1]=255,U[4*r+2]=255):(U[4*r+0]=0,U[4*r+1]=0,U[4*r+2]=0),U[4*r+3]=255}var ee=document.createElement("canvas"),te=ee.getContext("2d");ee.width=this.width,ee.height=this.height;var $=new ImageData(U,this.width,this.height);if(te.putImageData($,0,0),this.blurMask&&(te.filter="blur("+this.blurFactor+"px)"),te.drawImage(ee,0,0,this.width,this.height),this.maskImage=te.getImageData(0,0,this.width,this.height),this.blurMask)if(this.smoothBorder){if(-1!==this.smoothingFactor){var ue=new Pa.H(this.maskImage,this.width,this.height);this.maskImage=ue.sigmoidFilter(this.smoothingFactor)}}else{var Ie=new Pa.H(this.maskImage,this.width,this.height);this.maskImage=Ie.threshold(B.meanThreshold,B.meanThreshold,B.meanThreshold,255,!1)}return this.maskImage}},{key:"applyTransparency",value:function(O){var B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===B&&(B=this.maskImage);for(var E=new Uint8ClampedArray(4*this.length),U=0;U<this.length;U++)E[4*U+0]=O.data[4*U+0],E[4*U+1]=O.data[4*U+1],E[4*U+2]=O.data[4*U+2],E[4*U+3]=B.data[4*U];var ae=new ImageData(E,this.width,this.height);return ae}},{key:"superposeImages",value:function(O,B){var E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===E&&(E=this.maskImage);var U=new Pa.H(O,this.width,this.height),ae=U.weightedSumMask(B,E);return ae}},{key:"setBackground",value:function(O,B){var E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null===E&&(E=this.maskImage),this.superposeImages(O,B,E)}},{key:"blurBackground",value:function(O){var B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===E&&(E=this.maskImage);var U=new Pa.H(O,this.width,this.height),ae=U.blur(B);return this.setBackground(ae,E)}}]),D}();function Ir(D,O,B){return(Ir="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(E,U,ae){var pe=function(r,s){for(;!Object.prototype.hasOwnProperty.call(r,s)&&null!==(r=La(r)););return r}(E,U);if(pe){var G=Object.getOwnPropertyDescriptor(pe,U);return G.get?G.get.call(ae):G.value}})(D,O,B||D)}function sr(D){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function Ua(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return zr(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?zr(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function zr(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function Yr(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function Xr(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function Kr(D,O,B){return O&&Xr(D.prototype,O),B&&Xr(D,B),D}function Qr(D,O){if("function"!=typeof O&&null!==O)throw new TypeError("Super expression must either be null or a function");D.prototype=Object.create(O&&O.prototype,{constructor:{value:D,writable:!0,configurable:!0}}),O&&Rr(D,O)}function Rr(D,O){return(Rr=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function $r(D){var O=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}();return function(){var B,E=La(D);if(O){var U=La(this).constructor;B=Reflect.construct(E,arguments,U)}else B=E.apply(this,arguments);return Wo(this,B)}}function Wo(D,O){if(O&&("object"===sr(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Qi(D)}function Qi(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function La(D){return(La=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}var xt=R.Y.get("Stream"),wr=Rt.get(),jo=rn.get(),Vo=["stopped","trackStopped","audioAmplitude","audioAmplitudeInfo","muteStateChange","activeStateChange","backgroundSubstractionStopVisibilityChange","backgroundSubstractionStopComputeTime","AIESnapshot","AIELog","streamCapabilities","streamSettings","streamConstraints","remoteCapabilityRequest","remoteCapabilityRequestAccepted","remoteCapabilityRequestRefused"],Nn=new Map,lr=new WeakMap,Ya=new WeakMap,Xa=new WeakMap,Er=new WeakMap,xa={},wn=function(D){Qr(B,D);var O=$r(B);function B(E){var U,ae=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Yr(this,B),U=O.call(this,xt),!0!==ae.constructor)throw new Error("Stream constructor should not be used directly, please use a static method of class Stream such as : createStreamFromUserMedia, createStreamFromMediaStream, createScreensharingStream");if(delete ae.constructor,!ae.hasOwnProperty("type"))throw new Error("Cannot create Stream with no type");if(xt.debug("Create Stream with options",ae),U.data=E,U.audioInput=ae.hasOwnProperty("audioInput")?ae.audioInput:null,U.videoInput=ae.hasOwnProperty("videoInput")?ae.videoInput:null,ae.hasOwnProperty("userMediaStreamId")?(U.userMediaStreamId=ae.userMediaStreamId,U.isRemote=!1,Nn.set(U.userMediaStreamId,Qi(U))):(U.userMediaStreamId=null,U.isRemote=!0),U.streamId=W.g.isPropertyTypeof(ae,"streamId","number")?ae.streamId:null!==U.userMediaStreamId?Number(U.userMediaStreamId):void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER):Math.floor(1024*Math.random()*1024*1024),U.contact=ae.hasOwnProperty("contact")?ae.contact:null,ae.hasOwnProperty("callId")?(U.callId=ae.callId,U.callAudioAvailable=ae.callAudioAvailable,U.callAudioActive=ae.callAudioActive,U.callAudioMuted=ae.callAudioMuted,U.callVideoAvailable=ae.callVideoAvailable,U.callVideoActive=ae.callVideoActive,U.callVideoMuted=ae.callVideoMuted):U.callId=null,U.publishedInConversations=new Map,U.mediaRecorder=null,U.recordedBlobs=[],lr.set(Qi(U),!!ae.hasOwnProperty("screensharing")&&ae.screensharing),Ya.set(Qi(U),null),Xa.set(Qi(U),null),U.type=ae.type,U.authorizedRemoteCapabilityContacts=[],"IE"!==apiRTC.browser&&null!==U.data){var pe,G=function(ue){ue.addEventListener("ended",function(Ie){xa.hasOwnProperty(ue.id)||(ce.get(Qi(U)).emit("trackStopped",{type:ue.kind,id:ue.id}),xa[ue.id]=!0)})},r=Ua(U.data.getVideoTracks());try{for(r.s();!(pe=r.n()).done;){var s=pe.value;G(s)}}catch(ue){r.e(ue)}finally{r.f()}var N,q=Ua(U.data.getAudioTracks());try{for(q.s();!(N=q.n()).done;){var ee=N.value;G(ee)}}catch(ue){q.e(ue)}finally{q.f()}}var te={};if(W.g.isTypeof(U.userMediaStreamId,"string")?(te.userMediaStop=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId){var Ie={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};ce.get(Qi(U)).emit("stopped",Ie);var Ue=Er.get(Qi(U));if(Ue)for(var vt in Ue)apiRTC.removeEventListener(vt,Ue[vt])}},te.localStreamUpdated=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId&&null===ue.detail.callId){if(ue.detail.changeList.indexOf("audioIsMuted")>=0){var Ie={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId,type:"audio",muted:ue.detail.audioIsMuted};ce.get(Qi(U)).emit("muteStateChange",Ie)}if(ue.detail.changeList.indexOf("videoIsMuted")>=0){var Ue={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId,type:"video",muted:ue.detail.videoIsMuted};ce.get(Qi(U)).emit("muteStateChange",Ue)}}},te.backgroundSubstractionStopVisibilityChange=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId){var Ie={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};ce.get(Qi(U)).emit("backgroundSubstractionStopVisibilityChange",Ie)}},te.backgroundSubstractionStopComputeTime=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId){var Ie={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};ce.get(Qi(U)).emit("backgroundSubstractionStopComputeTime",Ie)}},te.AIESnapshot=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId){var Ie=ue.detail.image;ce.get(Qi(U)).emit("AIESnapshot",Ie)}},te.AIELog=function(ue){if(ue.detail.userMediaStreamId===U.userMediaStreamId){var Ie=ue.detail.log;ce.get(Qi(U)).emit("AIELog",Ie)}}):W.g.isTypeof(U.callId,"string")&&(te.hangup=function(ue){if("remote"===ue.detail.hangupType&&ue.detail.callId===U.callId){var Ie={streamId:U.streamId,callId:U.callId};ce.get(Qi(U)).emit("stopped",Ie);var Ue=Er.get(Qi(U));for(var vt in Ue)apiRTC.removeEventListener(vt,Ue[vt])}},te.remoteStreamUpdated=function(ue){if(ue.detail.callId===U.callId){if(ue.detail.changeList.indexOf("audioIsActive")>=0){U.callAudioActive=ue.detail.audioIsActive;var Ie={streamId:U.streamId,callId:U.callId,type:"audio",active:ue.detail.audioIsActive};ce.get(Qi(U)).emit("activeStateChange",Ie)}if(ue.detail.changeList.indexOf("audioIsMuted")>=0){U.callAudioMuted=ue.detail.audioIsMuted;var Ue={streamId:U.streamId,callId:U.callId,type:"audio",muted:ue.detail.audioIsMuted};ce.get(Qi(U)).emit("muteStateChange",Ue)}if(ue.detail.changeList.indexOf("videoIsActive")>=0){U.callVideoActive=ue.detail.videoIsActive;var vt={streamId:U.streamId,callId:U.callId,type:"video",active:ue.detail.videoIsActive};ce.get(Qi(U)).emit("activeStateChange",vt)}if(ue.detail.changeList.indexOf("videoIsMuted")>=0){U.callVideoMuted=ue.detail.videoIsMuted;var pt={streamId:U.streamId,callId:U.callId,type:"video",muted:ue.detail.videoIsMuted};ce.get(Qi(U)).emit("muteStateChange",pt)}}}),Object.keys(te).length>0)for(var $ in Er.set(Qi(U),te),te)apiRTC.addEventListener($,te[$]);return U}return Kr(B,[{key:"getContact",value:function(){return this.contact}},{key:"getData",value:function(){return this.data}},{key:"getConversations",value:function(){var E,U=[],ae=Ua(this.publishedInConversations.keys());try{for(ae.s();!(E=ae.n()).done;)U.push(jo.getConversations(E.value))}catch(G){ae.e(G)}finally{ae.f()}return U}},{key:"isScreensharing",value:function(){return lr.get(this)}},{key:"hasData",value:function(){return null!==this.data}},{key:"hasVideo",value:function(){return this.callId?this.callVideoAvailable&&this.callVideoActive:!!this.hasData()&&this.data.getVideoTracks().length>0}},{key:"hasAudio",value:function(){return this.callId?this.callAudioAvailable&&this.callAudioActive:!!this.hasData()&&this.data.getAudioTracks().length>0}},{key:"isVideoMuted",value:function(){if(this.callId)return this.callVideoMuted;if(this.hasData()){var E=this.data.getVideoTracks();return E&&E.length>0&&!E[0].enabled}return!1}},{key:"isAudioMuted",value:function(){if(this.callId)return this.callAudioMuted;if(this.hasData()){var E=this.data.getAudioTracks();return E&&E.length>0&&!E[0].enabled}return!1}},{key:"getType",value:function(){return this.type}},{key:"release",value:function(){this.hasData()&&(this.releaseAudio(),this.releaseVideo(),this.data=null,this.userMediaStreamId&&(apiCC.releaseUserMediaStream(this.userMediaStreamId),Nn.delete(this.userMediaStreamId)))}},{key:"releaseAudio",value:function(){var E=this;this.hasData()&&(this.disableAudioAnalysis(),this.data.getAudioTracks().forEach(function(U){U.stop(),xa.hasOwnProperty(U.id)||(ce.get(E).emit("trackStopped",{type:U.kind,id:U.id}),xa[U.id]=!0)}))}},{key:"releaseVideo",value:function(){var E=this;this.hasData()&&this.data.getVideoTracks().forEach(function(U){U.stop(),xa.hasOwnProperty(U.id)||(ce.get(E).emit("trackStopped",{type:U.kind,id:U.id}),xa[U.id]=!0)})}},{key:"muteAudio",value:function(){if(this.userMediaStreamId){var E=apiCC.getUserMediaStream(this.userMediaStreamId);E&&E.muteAudioOnStreams()}else this.callId&&this.hasData()&&this.data.getAudioTracks().forEach(function(U){U.enabled=!1})}},{key:"muteVideo",value:function(){if(this.userMediaStreamId){var E=apiCC.getUserMediaStream(this.userMediaStreamId);E&&E.muteVideoOnStreams()}else this.callId&&this.hasData()&&this.data.getVideoTracks().forEach(function(U){U.enabled=!1})}},{key:"unmuteAudio",value:function(){if(this.userMediaStreamId){var E=apiCC.getUserMediaStream(this.userMediaStreamId);E&&E.unMuteAudioOnStreams()}else this.callId&&this.hasData()&&this.data.getAudioTracks().forEach(function(U){U.enabled=!0})}},{key:"unmuteVideo",value:function(){if(this.userMediaStreamId){var E=apiCC.getUserMediaStream(this.userMediaStreamId);E&&E.unMuteVideoOnStreams()}else this.callId&&this.hasData()&&this.data.getVideoTracks().forEach(function(U){U.enabled=!0})}},{key:"attachToElement",value:function(E){xt.debug("attachToElement"),wr.attachMediaStream(E,this.data)}},{key:"addInDiv",value:function(E,U,ae,pe,G){xt.debug("addInDiv"),wr.addStreamInDiv(this.data,this.type,E,U,ae,pe,G)}},{key:"removeFromDiv",value:function(E,U){xt.debug("removeFromDiv"),wr.removeElementFromDiv(E,U)}},{key:"startRecord",value:function(E){return xt.info("startRecord :",E),apiCC.recordMgr.record(this.data,E)}},{key:"stopRecord",value:function(){return xt.info("stopRecord() - Stopping record"),apiCC.recordMgr.stop()}},{key:"pauseRecord",value:function(){return xt.info("pauseRecord() - Pausing record"),apiCC.recordMgr.pause()}},{key:"resumeRecord",value:function(){return xt.info("resumeRecord() - Resuming record"),apiCC.recordMgr.resume()}},{key:"enableAudioAnalysis",value:function(){var E=this,U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xt.info("enableAudioAnalysis()");var ae=W.g.getAudioContext(),pe=null,G=!1,r=Xa.get(this),s=Ya.get(this);ae?this.hasData()?null!==r||null!==s?xt.error("enableAudioAnalysis() - Audio analysis already enabled"):(r=ae.createMediaStreamSource(this.data),(s=ae.createScriptProcessor(2048,1,1)).connect(ae.destination),s.onaudioprocess=function(){var N,q=new Uint8Array(s.analyser.frequencyBinCount),ee=0;s.analyser.getByteFrequencyData(q);var te,$=Ua(q);try{for($.s();!(te=$.n()).done;)ee+=te.value}catch(vt){$.e(vt)}finally{$.f()}N=ee/q.length,ce.get(E).emit("audioAmplitude",N);var ue=0;q.sort(function(vt,pt){return pt-vt}),q=q.slice(0,50);for(var Ie=0;Ie<q.length;Ie++)ue+=q[Ie];(N=ue/q.length)>("number"==typeof U.threshold?U.threshold:i.g.STREAM_AUDIO_ANALYSIS_THRESHOLD)&&(G||(G=!0,ce.get(E).emit("audioAmplitudeInfo",{amplitude:N,isSpeaking:!0})),null!==pe&&clearTimeout(pe),pe=setTimeout(function(){ce.get(E).emit("audioAmplitudeInfo",{amplitude:N,isSpeaking:!1}),G=!1},1e3))},s.analyser=ae.createAnalyser(),s.analyser.smoothingTimeConstant=.5,s.analyser.fftSize=1024,r.connect(s.analyser),s.analyser.connect(s),Ya.set(this,s),Xa.set(this,r)):xt.error("enableAudioAnalysis() - Stream has no data, unable to enable audio analysis"):xt.error("enableAudioAnalysis() - AudioContext is not available, unable to enable audio analysis")}},{key:"disableAudioAnalysis",value:function(){xt.info("disableAudioAnalysis()");var E=Xa.get(this),U=Ya.get(this);null!==E&&E.disconnect(),null!==U&&(U.analyser.disconnect(),U.disconnect()),Ya.set(this,null),Xa.set(this,null)}},{key:"takeSnapshot",value:function(){var E=this,U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xt.info("takeSnapshot()");var ae=null,pe=null;return new Promise(function(G,r){if(E.hasData()){E.hasVideo()||xt.warn("takeSnapshot() - This stream does not have a video track"),ae=document.createElement("video"),pe=function(ee){if(s.width=ae.videoWidth,s.height=ae.videoHeight,U.hasOwnProperty("width")&&(s.width=U.width),U.hasOwnProperty("height")&&(s.height=U.height),U.hasOwnProperty("filters")){for(var te=[],$=0,ue=Object.keys(U.filters);$<ue.length;$++){var Ie=ue[$];te.push(Ie+"("+U.filters[Ie]+")")}N.filter=te.join(" ")}N.drawImage(ae,0,0,s.width,s.height),!0===ee&&ae.remove(),U.hasOwnProperty("output")&&"blob"===U.output?void 0!==U.outputMimeType?(xt.debug("options.outputMimeType is defined :",U.outputMimeType),s.toBlob(function(Ue){G(Ue)},U.outputMimeType,U.outputQualityArgument)):s.toBlob(function(Ue){G(Ue)},"image/png"):void 0!==U.outputMimeType?(xt.debug("options.outputMimeType is defined :",U.outputMimeType),G(s.toDataURL(U.outputMimeType,U.outputQualityArgument))):G(s.toDataURL("image/png"))};var s=document.createElement("canvas"),N=s.getContext("2d");null==U.divId?setTimeout(function(){E.attachToElement(ae),ae.addEventListener("canplay",function(){pe(!0)}),ae.muted=!0,ae.play()},1e3):null===(ae=document.getElementById(U.divId))?xt.error("divId not found for snapshot"):pe(!1)}else{var q="takeSnapshot() - Stream has no data, cannot get snapshot";xt.error(q),r(new Error(q))}})}},{key:"getId",value:function(){return String(this.streamId)}},{key:"getOwner",value:function(){return this.contact?this.contact:Ii.getActiveSession().getUserAgent()}},{key:"getLabels",value:function(){var E={};return this.hasData()&&this.data.getAudioTracks().length>0&&(E.audioSourceLabel="",this.data.getAudioTracks()[0].label&&(E.audioSourceLabel=this.data.getAudioTracks()[0].label)),this.hasData()&&this.data.getVideoTracks().length>0&&(E.videoSourceLabel="",this.data.getVideoTracks()[0].label&&(E.videoSourceLabel=this.data.getVideoTracks()[0].label)),xt.debug("getLabels:",E),E}},{key:"checkImageCaptureCompatibility",value:function(){return"undefined"==typeof ImageCapture}},{key:"getLocalMediaStreamTrack",value:function(){var E=null;return 1===this.data.getVideoTracks().length&&(E=this.data.getVideoTracks()[0]),E}},{key:"getCapabilities",value:function(){if(xt.debug("getCapabilities()"),this.isRemote){if(null!==this.contact){var E=Ii.getActiveSession().getUserAgent(),ae=[];this.publishedInConversations.forEach(function(r,s){ae.push(s)}),this.contact.sendCustomEvent(i.g.CONTACT_GET_CAPABILITIES_IDENTIFIER,{streamId:this.getId(),streamActiveConversations:ae,requesterId:E.userId})}}else{var pe=this.getLocalMediaStreamTrack();if(null!==pe){if("function"!=typeof pe.getCapabilities||void 0===pe.getCapabilities())return xt.error("Navigator not compatible with this function"),{error:!0,errorMessage:"Navigator not compatible with this function"};var G=pe.getCapabilities();return void 0!==G.deviceId&&delete G.deviceId,void 0!==G.groupId&&delete G.groupId,Object.keys(G).forEach(function(r){0===Object.keys(G[r]).length&&delete G[r]}),ce.get(this).emit("streamCapabilities",G),G}xt.error("No stream found")}}},{key:"isCapabilityAvailable",value:function(E){var U=this;return new Promise(function(ae,pe){xt.debug("isCapabilityAvailable :",E);var G=U.getLocalMediaStreamTrack();return null===G?pe("No stream found"):"getCapabilities"in MediaStreamTrack.prototype?G.getCapabilities().hasOwnProperty(E)?void ae():pe("The capability "+E+" is not available on this camera or does not exists"):pe("Your navigator is not compatible with this function")})}},{key:"getConstraints",value:function(){if(xt.debug("getConstraints()"),this.isRemote){if(null!==this.contact){var E=Ii.getActiveSession().getUserAgent(),ae=[];this.publishedInConversations.forEach(function(r,s){ae.push(s)}),this.contact.sendCustomEvent(i.g.CONTACT_GET_CONSTRAINTS_IDENTIFIER,{streamId:this.getId(),streamActiveConversations:ae,requesterId:E.userId})}}else{var pe=this.getLocalMediaStreamTrack();if(null!==pe){if("function"!=typeof pe.getConstraints||void 0===pe.getConstraints())return xt.error("Navigator not compatible with this function"),{error:!0,errorMessage:"Navigator not compatible with this function"};var G=pe.getConstraints();return ce.get(this).emit("streamConstraints",G),G}xt.error("No stream found")}}},{key:"setCapability",value:function(E,U){var ae=this;return xt.debug("setCapability()",E,U),new Promise(function(pe,G){if(ae.isRemote){if(null!==ae.contact){var r=Ii.getActiveSession().getUserAgent();if(-1===ae.authorizedRemoteCapabilityContacts.indexOf(r.userId))return G("Please ask authorization before with askRemoteCapabilityAuthorization function");ae.contact.sendCustomEvent(i.g.CONTACT_SET_CONSTRAINTS_IDENTIFIER,{streamId:ae.getId(),requestorId:r.userId,capability:E,value:U}),pe()}}else{var s=ae.getLocalMediaStreamTrack();if(null===s)return G("No local mediaStreamTrack found");ae.isCapabilityAvailable(E).then(function(){var N={};N[E]=U,"Safari"!==apiRTC.browser&&"Mobile Safari"!==apiRTC.browser&&(N={advanced:[N]}),s.applyConstraints(N).then(pe).catch(G)}).catch(function(N){G(N)})}})}},{key:"askRemoteCapabilityAuthorization",value:function(){if(xt.debug("askRemoteCapabilityAuthorization"),!this.isRemote)return xt.error("You need to call this function on a remote stream, not a local stream");if(null!==this.contact){var E=Ii.getActiveSession().getUserAgent(),ae=[];this.publishedInConversations.forEach(function(pe,G){ae.push(G)}),this.contact.sendCustomEvent(i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_IDENTIFIER,{streamId:this.getId(),streamActiveConversations:ae,requesterId:E.userId})}}},{key:"acceptRemoteCapabilityRequest",value:function(E,U,ae){var pe=Ii.getActiveSession().getOrCreateContact(E);this.authorizedRemoteCapabilityContacts.push(E),pe.sendCustomEvent(i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_ACCEPT_IDENTIFIER,{requestorId:E,roomName:U,streamId:ae})}},{key:"refuseRemoteCapabilityRequest",value:function(E,U,ae){var pe=Ii.getActiveSession().getOrCreateContact(E),G=this.authorizedRemoteCapabilityContacts.indexOf(E);G>-1&&this.authorizedRemoteCapabilityContacts.splice(G,1),pe.sendCustomEvent(i.g.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_REFUSE_IDENTIFIER,{requestorId:E,roomName:U,streamId:ae})}},{key:"getSettings",value:function(){if(!this.isRemote){xt.debug("getSettings()");var E=this.getLocalMediaStreamTrack(),U={};if(null!==E){if("function"!=typeof E.getSettings||void 0===E.getSettings())return xt.error("Navigator not compatible with this function"),{error:!0,errorMessage:"Navigator not compatible with this function"};(U=E.getSettings())?(void 0!==U.deviceId&&delete U.deviceId,void 0!==U.groupId&&delete U.groupId):xt.error("No settings on this camera")}else xt.error("No stream found");return ce.get(this).emit("streamSettings",U),U}if(null!==this.contact){var ae=Ii.getActiveSession().getUserAgent(),G=[];this.publishedInConversations.forEach(function(r,s){G.push(s)}),this.contact.sendCustomEvent(i.g.CONTACT_GET_SETTINGS_IDENTIFIER,{streamId:this.getId(),streamActiveConversations:G,requesterId:ae.userId})}}},{key:"takePhoto",value:function(){var E=this;return new Promise(function(U,ae){if(xt.debug("takePhoto()"),E.checkImageCaptureCompatibility())ae("Your navigator is not compatible with takePhoto()");else{var pe=E.getLocalMediaStreamTrack();null!==pe?new ImageCapture(pe).takePhoto().then(function(G){var r=new Image;r.src=URL.createObjectURL(G),U(r)}).catch(function(G){ae("takePhoto() error: ",G)}):ae("No local mediaStreamTrack found")}})}},{key:"activateAIAnnotations",value:function(){var E=this.getStreamAIE();null!==E&&E.activateAnnotations()}},{key:"stopAIAnnotations",value:function(){var E=this.getStreamAIE();null!==E&&E.stopAnnotations()}},{key:"activateAILogs",value:function(){var E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof E)return xt.error("minLogPeriod parameter must be an integer");var U=this.getStreamAIE();null!==U&&U.activateLogs(E)}},{key:"stopAILogs",value:function(){var E=this.getStreamAIE();null!==E&&E.stopLogs()}},{key:"activateAISnapshots",value:function(){var E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof E)return xt.error("minSnapshotPeriod parameter must be an integer");var U=this.getStreamAIE();null!==U&&U.activateSnapshots(E)}},{key:"stopAISnapshots",value:function(){var E=this.getStreamAIE();null!==E&&E.stopSnapshots()}},{key:"getStreamAIE",value:function(){var E=null;if(void 0!==apiCC){var U=apiCC.getUserMediaStream(this.userMediaStreamId);null!==U.mediaFilterManager?(Object.values(U.mediaFilterManager.filters).forEach(function(pe){null!==pe.streamAIE&&(E=pe.streamAIE)}),null===E&&xt.error("Applied filter is not an AI filter")):xt.error("No filter applied on stream")}return E}},{key:"addChildren",value:function(E,U){this.childrenTypeExists(U)?xt.error("This stream already has a sub instance running for this"):(void 0===this.childrens&&(this.childrens=[]),this.childrens.push(E))}},{key:"releaseChildren",value:function(E){void 0!==this.childrens&&this.childrens.forEach(function(U,ae){U.childType===E&&U.hasOwnProperty("release")&&U.release()})}},{key:"removeChildren",value:function(E){var U=this;void 0!==this.childrens&&this.childrens.forEach(function(ae,pe){if(ae.childType===E)return U.childrens.splice(pe,1)})}},{key:"childrenTypeExists",value:function(E){var U=!1;return void 0!==this.childrens&&this.childrens.forEach(function(ae){ae.childType===E&&(U=!0)}),U}},{key:"createChildStreamFromStream",value:function(E,U){var ae=this;return new Promise(function(pe,G){xt.debug("createChildStreamFromStream");var r={};r.type=i.g.STREAM_TYPE_NO_INPUT,E.getAudioTracks().length>0&&(r.type=i.g.STREAM_TYPE_AUDIO),E.getVideoTracks().length>0&&(r.type=i.g.STREAM_TYPE_VIDEO);var s=ae;apiRTC.createUserMediaStream({type:"media",stream:E,success:function(N){xt.debug("[createChildStreamFromStream] success; userMediaStreamId: "+N.userMediaStreamId),r.constructor=!0,r.userMediaStreamId=N.userMediaStreamId,pe(new Fo(N.stream,r,s,U))},failure:function(N,q){xt.debug("[createChildStreamFromStream] failure :",q),G()}})})}},{key:"loadBlurAPI",value:function(){return new Promise(function(E,U){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"],"blur-api",{async:!0,numRetries:20,reqdelay:200,success:function(){xt.debug("Blur API loaded"),E()},error:function(pe){U("Resources loading failed, depsNotFound: "+pe)},retrycb:function(pe,G){xt.warn("Blur API model loading retry :"+pe+" ,delay before retry :"+G)}})})}},{key:"processBlur",value:function(E,U){U.blurVariables.canvasSegmentedCtx.save(),U.blurVariables.canvasBlurredCtx.save(),U.blurVariables.finalCanvasCtx.save(),U.blurVariables.canvasSegmentedCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasBlurredCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasBlurredCtx.drawImage(E.image,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.drawImage(E.image,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.globalCompositeOperation="destination-atop",U.blurVariables.canvasSegmentedCtx.drawImage(E.segmentationMask,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.drawImage(U.blurVariables.canvasBlurred,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.drawImage(U.blurVariables.canvasSegmented,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.restore(),U.blurVariables.canvasBlurredCtx.restore(),U.blurVariables.finalCanvasCtx.restore()}},{key:"startBlur",value:function(){var E=this;return new Promise(function(U,ae){xt.debug("startBlur"),E.blurVariables={},E.blurVariables.stopBlur=!1;var pe=E.data.getVideoTracks();if(1===pe.length){var G=pe[0].getSettings();E.blurVariables.height=G.height,E.blurVariables.width=G.width}E.blurVariables.srcVideoElement=document.createElement("video"),E.blurVariables.srcVideoElement.srcObject=E.data,E.blurVariables.srcVideoElement.height=E.blurVariables.height,E.blurVariables.srcVideoElement.width=E.blurVariables.width,E.blurVariables.srcVideoElement.play(),E.blurVariables.canvasSegmented=document.createElement("canvas"),E.blurVariables.canvasSegmentedCtx=E.blurVariables.canvasSegmented.getContext("2d"),E.blurVariables.canvasSegmented.height=E.blurVariables.height,E.blurVariables.canvasSegmented.width=E.blurVariables.width,E.blurVariables.canvasBlurred=document.createElement("canvas"),E.blurVariables.canvasBlurredCtx=E.blurVariables.canvasBlurred.getContext("2d"),E.blurVariables.canvasBlurred.height=E.blurVariables.height,E.blurVariables.canvasBlurred.width=E.blurVariables.width,E.blurVariables.canvasBlurredCtx.filter="blur(15px)",E.blurVariables.finalCanvas=document.createElement("canvas"),E.blurVariables.finalCanvasCtx=E.blurVariables.finalCanvas.getContext("2d"),E.blurVariables.finalCanvas.height=E.blurVariables.height,E.blurVariables.finalCanvas.width=E.blurVariables.width;var r=E;E.loadBlurAPI().then(function(){r.blurVariables.selfieSegmentation=new SelfieSegmentation({locateFile:function(s){return"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(s)}}),r.blurVariables.selfieSegmentation.setOptions({selfieMode:!1,modelSelection:1,effect:"background"}),r.blurVariables.selfieSegmentation.onResults(function(s){r.processBlur(s,r)}),r.blurVariables.srcVideoElement.requestVideoFrameCallback(function s(){return new Promise(function(N,q){r.blurVariables.stopBlur||r.blurVariables.selfieSegmentation.send({image:r.blurVariables.srcVideoElement}).then(function(){r.blurVariables.srcVideoElement.requestVideoFrameCallback(s),N()}).catch(function(ee){q(ee)})})}),U(r.blurVariables.finalCanvas.captureStream())})})}},{key:"stopBlur",value:function(){xt.debug("stopBlur"),this.blurVariables.stopBlur=!0,this.blurVariables.selfieSegmentation.close()}},{key:"blur",value:function(){var E=this;return new Promise(function(U,ae){if(!("requestVideoFrameCallback"in HTMLVideoElement.prototype))return ae("Your navigator is not compatible with this function");if(E.childrenTypeExists("blur"))return ae("This stream already has a sub instance running for this");var pe=E;E.startBlur().then(function(G){var r,s=Ua(pe.data.getAudioTracks());try{for(s.s();!(r=s.n()).done;)G.addTrack(r.value)}catch(q){s.e(q)}finally{s.f()}pe.createChildStreamFromStream(G,"blur").then(function(q){E.addChildren(q,"blur"),U(q)})})})}},{key:"unblur",value:function(){this.childrenTypeExists("blur")?(this.stopBlur(),this.releaseChildren("blur"),this.removeChildren("blur")):xt.error("No blurred instance found for this stream")}},{key:"createMediaStreamTrackProcessor",value:function(){var E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(xt.debug("mediaStreamTrackProcessor kind: ".concat(E?"audio":"video"," created")),E){var U=this.data.getAudioTracks();if(U.length)return new MediaStreamTrackProcessor({track:U[0]});throw new Error("No audio tracks found")}var ae=this.data.getVideoTracks();if(ae.length)return new MediaStreamTrackProcessor({track:ae[0]});throw new Error("No video tracks found")}},{key:"createMediaStreamTrackGenerator",value:function(){var E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return xt.debug("mediaStreamTrackGenerator kind: ".concat(E?"audio":"video"," created")),E?new MediaStreamTrackGenerator({kind:"audio"}):new MediaStreamTrackGenerator({kind:"video"})}},{key:"startMergeReality",value:function(){var E=this;this.mergeRealityData={},this.mergeRealityData.stop=!1,this.mergeRealityData.WIDTH=this.getSettings().width,this.mergeRealityData.HEIGHT=this.getSettings().height,this.mergeRealityData.WEBCAM_CANVAS=new OffscreenCanvas(this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WEBCAM_CTX=this.mergeRealityData.WEBCAM_CANVAS.getContext("2d",{alpha:!1}),this.mergeRealityData.MASK_CANVAS=new OffscreenCanvas(this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.MASK_CTX=this.mergeRealityData.MASK_CANVAS.getContext("2d",{alpha:!0}),this.mergeRealityData.SCREEN_VIDEO=document.createElement("video"),this.mergeRealityData.BG_SUB=new xo(null,null,!0,!1,!1,1,3),this.mergeRealityData.background=new Jr(this.mergeRealityData.WEBCAM_CTX.getImageData(0,0,this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.MSTP=this.createMediaStreamTrackProcessor().readable,this.mergeRealityData.MSTG=this.createMediaStreamTrackGenerator(),this.mergeRealityData.SINK=this.mergeRealityData.MSTG.writable,this.mergeRealityData.MASK_TRANSFORMER=new TransformStream({transform:function(U,ae){E.mergeRealityData.stop||(E.mergeRealityData.MASK_CTX.save(),E.mergeRealityData.MASK_CTX.clearRect(0,0,E.mergeRealityData.WIDTH,E.mergeRealityData.HEIGHT),E.mergeRealityData.WEBCAM_CTX.clearRect(0,0,E.mergeRealityData.WIDTH,E.mergeRealityData.HEIGHT),E.mergeRealityData.WEBCAM_CTX.drawImage(U,0,0),E.mergeRealityData.MASK_DATA=E.mergeRealityData.BG_SUB.computeMask(E.mergeRealityData.WEBCAM_CTX.getImageData(0,0,E.mergeRealityData.WIDTH,E.mergeRealityData.HEIGHT),E.mergeRealityData.background),E.mergeRealityData.RES=E.mergeRealityData.BG_SUB.applyTransparency(E.mergeRealityData.WEBCAM_CTX.getImageData(0,0,E.mergeRealityData.WIDTH,E.mergeRealityData.HEIGHT),E.mergeRealityData.MASK_DATA),E.mergeRealityData.MASK_CTX.putImageData(E.mergeRealityData.RES,0,0),E.mergeRealityData.MASK_CTX.globalCompositeOperation="destination-atop",E.mergeRealityData.MASK_CTX.drawImage(E.mergeRealityData.SCREEN_VIDEO,0,0,E.mergeRealityData.WIDTH,E.mergeRealityData.HEIGHT),E.mergeRealityData.MASK_CTX.restore(),ae.enqueue(new VideoFrame(E.mergeRealityData.MASK_CANVAS))),U.close()}}),this.mergeRealityData.RES_MS=new MediaStream}},{key:"stopMergeReality",value:function(){this.mergeRealityData.stop=!0}},{key:"calibrateBackground",value:function(){this.childrenTypeExists("merge")?this.mergeRealityData.background=new Jr(this.mergeRealityData.WEBCAM_CTX.getImageData(0,0,this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT):xt.error("No merged instance found for this stream")}},{key:"mergeReality",value:function(E){var U=this;return new Promise(function(ae,pe){if(void 0===window.MediaStreamTrackGenerator||void 0===window.MediaStreamTrackProcessor||void 0===window.TransformStream)return pe("Your browser does not support InsertableStreams");if(U.childrenTypeExists("merge"))return pe("This stream already has a sub instance running for this");U.startMergeReality(),E.attachToElement(U.mergeRealityData.SCREEN_VIDEO),U.mergeRealityData.SCREEN_VIDEO.autoplay=!0,U.mergeRealityData.MSTP.pipeThrough(U.mergeRealityData.MASK_TRANSFORMER).pipeTo(U.mergeRealityData.SINK),U.mergeRealityData.RES_MS.addTrack(U.mergeRealityData.MSTG);var G,r=Ua(U.data.getAudioTracks());try{for(r.s();!(G=r.n()).done;)U.mergeRealityData.RES_MS.addTrack(G.value)}catch(q){r.e(q)}finally{r.f()}var N=U;U.createChildStreamFromStream(U.mergeRealityData.RES_MS,"merge").then(function(q){N.addChildren(q,"merge"),ae(q)})})}},{key:"unmergeReality",value:function(){this.childrenTypeExists("merge")?(this.stopMergeReality(),this.releaseChildren("merge"),this.removeChildren("merge")):xt.error("No merged instance found for this stream")}},{key:"sendRemoteStreamCapabilities",value:function(E){ce.get(this).emit("streamCapabilities",E)}},{key:"sendRemoteStreamSettings",value:function(E){ce.get(this).emit("streamSettings",E)}},{key:"sendRemoteStreamConstraints",value:function(E){ce.get(this).emit("streamConstraints",E)}},{key:"sendRemoteCapabilityRequest",value:function(E){ce.get(this).emit("remoteCapabilityRequest",E)}},{key:"sendRemoteCapabilityRequestAccepted",value:function(E){this.authorizedRemoteCapabilityContacts.push(E),ce.get(this).emit("remoteCapabilityRequestAccepted",{})}},{key:"sendRemoteCapabilityRequestRefused",value:function(E){var U=this.authorizedRemoteCapabilityContacts.indexOf(E);U>-1&&this.authorizedRemoteCapabilityContacts.splice(U,1),ce.get(this).emit("remoteCapabilityRequestRefused",{})}}],[{key:"getAvailableEvents",value:function(){return Vo}},{key:"createStreamFromUserMedia",value:function(E,U,ae){var pe=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return xt.debug("createStreamFromUserMedia"),xt.debug("audioInput :",E),xt.debug("videoInput :",U),xt.debug("constraints :",ae),xt.debug("options :",pe),new Promise(function(G,r){var s=!1!==E&&(null!==E||ae&&ae.hasOwnProperty("audio")),N=!1!==U&&(null!==U||ae&&ae.hasOwnProperty("video")),q={type:i.g.STREAM_TYPE_NO_INPUT,audioInput:E,videoInput:U},ee="media";N?q.type=i.g.STREAM_TYPE_VIDEO:s&&(q.type=i.g.STREAM_TYPE_AUDIO),s&&!N?ee="audio":!s&&N&&(ee="videoOnly"),s&&!0===pe.enhancedAudioActivated&&(xt.debug("Enhanced Audio is activated"),"Chrome"!==apiRTC.browser?xt.debug("enhancedAudioActivated option is only available for Chrome"):(void 0===ae&&(ae={}),ae.audio&&"object"===sr(ae.audio)||(ae.audio={}),void 0===ae.video&&(ae.video={}),ae.audio.echoCancellation=!1,ae.audio.autoGainControl=!1,ae.audio.noiseSuppression=!1)),apiRTC.createUserMediaStream({audioSourceId:E,videoSourceId:U,facingMode:pe.facingMode,gum_config:ae,filters:pe.filters,type:ee,success:function(te){xt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+te.userMediaStreamId),q.constructor=!0,q.userMediaStreamId=te.userMediaStreamId,G(new B(te.stream,q))},failure:function(te,$){xt.debug("[createStreamFromUserMedia] failure :",$),r($)}})})}},{key:"createStreamFromMediaStream",value:function(E){return xt.debug("createStreamFromMediaStream"),new Promise(function(U,ae){var pe={};pe.type=i.g.STREAM_TYPE_NO_INPUT,E.getAudioTracks().length>0&&(pe.type=i.g.STREAM_TYPE_AUDIO),E.getVideoTracks().length>0&&(pe.type=i.g.STREAM_TYPE_VIDEO),apiRTC.createUserMediaStream({type:"media",stream:E,success:function(G){xt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+G.userMediaStreamId),pe.constructor=!0,pe.userMediaStreamId=G.userMediaStreamId,U(new B(G.stream,pe))},failure:function(G,r){xt.debug("[createStreamFromUserMedia] failure :",r),ae()}})})}},{key:"createScreensharingStream",value:function(E){return new Promise(function(U,ae){apiRTC.createUserMediaStream({type:"screenSharing",captureSourceType:E,success:function(pe){xt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+pe.userMediaStreamId);var G=new B(pe.stream,{constructor:!0,type:i.g.STREAM_TYPE_VIDEO,userMediaStreamId:pe.userMediaStreamId});lr.set(G,!0),U(G)},failure:function(pe,G){xt.debug("[createStreamFromUserMedia] failure :",G),ae(G)}})})}},{key:"createDisplayMediaStream",value:function(E,U){return new Promise(function(ae,pe){apiRTC.createUserMediaStream({type:"screenSharing",captureSourceType:E,displayMediaStreamConstraints:E,forceExtensionOnChrome:U,success:function(G){xt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+G.userMediaStreamId);var r=new B(G.stream,{constructor:!0,type:i.g.STREAM_TYPE_VIDEO,userMediaStreamId:G.userMediaStreamId});lr.set(r,!0),ae(r)},failure:function(G,r){xt.debug("[createStreamFromUserMedia] failure :",r),pe(r)}})})}},{key:"getLocalStreams",value:function(){return Nn.values()}},{key:"getStream",value:function(E){return null!=E&&Nn.has(E.toString())?Nn.get(E.toString()):null}}]),B}(Ne),Fo=function(D){Qr(B,D);var O=$r(B);function B(E,U,ae,pe){var G;return Yr(this,B),(G=O.call(this,E,U)).parent=ae,G.childType=pe,G}return Kr(B,[{key:"release",value:function(){this.parent.stopBlur(),this.parent.removeChildren(this.childType);var E=this.data.getAudioTracks();E.length>0&&this.data.removeTrack(E[0]),Ir(La(B.prototype),"release",this).call(this)}}]),B}(wn);function cr(D,O){var B="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!B){if(Array.isArray(D)||(B=function(r,s){if(r){if("string"==typeof r)return Zr(r,s);var N=Object.prototype.toString.call(r).slice(8,-1);return"Object"===N&&r.constructor&&(N=r.constructor.name),"Map"===N||"Set"===N?Array.from(r):"Arguments"===N||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?Zr(r,s):void 0}}(D))||O&&D&&"number"==typeof D.length){B&&(D=B);var E=0,U=function(){};return{s:U,n:function(){return E>=D.length?{done:!0}:{done:!1,value:D[E++]}},e:function(r){throw r},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ae,pe=!0,G=!1;return{s:function(){B=B.call(D)},n:function(){var r=B.next();return pe=r.done,r},e:function(r){G=!0,ae=r},f:function(){try{pe||null==B.return||B.return()}finally{if(G)throw ae}}}}function Zr(D,O){(null==O||O>D.length)&&(O=D.length);for(var B=0,E=new Array(O);B<O;B++)E[B]=D[B];return E}function eo(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}var En=R.Y.get("Session"),Bo=Rt.get(),ra=new(fe()),Mr=Ji.get(),Ar=rn.get(),Go=Symbol("ENTERPRISE_NOT_LOADED"),Or=Symbol("ENTERPRISE_LOADED"),to=new WeakMap,no=new WeakMap,ao=new WeakMap,dr=function(){function D(U,ae,pe){if(function(G,r){if(!(G instanceof r))throw new TypeError("Cannot call a class as a function")}(this,D),En.info("Create Enterprise"),!(pe instanceof Ii))throw"Cannot create Enterprise without a session";to.set(this,pe),ao.set(this,ae),no.set(this,U),this.status=Go}var O,B,E;return O=D,B=[{key:"getSession",value:function(){return to.get(this)}},{key:"getId",value:function(){return no.get(this).toString()}},{key:"getApiKey",value:function(){return ao.get(this).toString()}},{key:"load",value:function(){var U=this;return new Promise(function(ae,pe){ra.getEnterpriseUserList(U.getId(),U.getSession().getToken()).then(function(G){En.info("Enterprise loaded!",G);var r,s=cr(G.users);try{for(s.s();!(r=s.n()).done;){var N=r.value;if(U.getSession().user.userId.toString()!==N.id.toString()){var q=Mr.getOrCreateContact(N.id);q.profile=N,q.enterprise=U,null===q.userData.get("username")&&q.userData.setProp("username",N.username),null===q.userData.get("photo_url")&&q.userData.setProp("photo_url",N.photo_url)}}}catch(ee){s.e(ee)}finally{s.f()}U.status=Or,ae()}).catch(function(G){var r="load() - Enterprise load error",s={error:new Error(r),code:i.g.ERROR_OTHER};G.hasOwnProperty("code")?s.code=G.code:G.hasOwnProperty("http_code")&&(s.code=G.http_code.toString().startsWith("4")?i.g.ERROR_INVALID_CREDENTIALS:i.g.ERROR_SERVER_UNAVAILABLE),En.error(r,G),pe(s)})})}},{key:"getContacts",value:function(){var U={};if(this.status!==Or)En.error("Enterprise is not loaded, unable to getContacts");else{var ae,pe=Mr.getContacts(),G=cr(pe.keys());try{for(G.s();!(ae=G.n()).done;){var s=pe.get(ae.value);null!==s.enterprise&&s.enterprise.id.toString()===this.getId()&&(U[s.getId()]=s)}}catch(N){G.e(N)}finally{G.f()}}return U}},{key:"getConfiguration",value:function(){return null}},{key:"uploadFile",value:function(U){var ae=this,pe=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(G,r){En.info("uploadFile()"),ae.status===Or?ra.uploadFile(U,ae.getSession().getToken(),pe).then(function(s){G(s.url)}).catch(function(s){En.error(s),r(s)}):(En.error("Enterprise is not loaded, cannot upload file"),r(new Error("Enterprise is not loaded, cannot upload file")))})}},{key:"getAvailableConferences",value:function(){var U=this;return En.info("getAvailableConferences()"),new Promise(function(ae,pe){var G={};ra.getConferenceList(U.getSession().getToken()).then(function(r){var s,N=cr(r);try{for(N.s();!(s=N.n()).done;){var q=s.value;G[q.hash]=Ar.getOrCreateConference(q.hash),G[q.hash].friendlyName=q.friendlyName}}catch(ee){N.e(ee)}finally{N.f()}ae(G)}).catch(function(r){En.error(r),pe(r)})})}},{key:"getConference",value:function(U){var ae=this;return new Promise(function(pe,G){var r={};r.token=ae.getSession().getToken(),ra.getWebconf(U,r).then(function(s){return pe(Ar.getOrCreateConference(s.hash))}).catch(function(s){return En.error("getConference",s),G(s)})})}},{key:"createPrivateConference",value:function(){var U=this,ae=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return En.info("createPrivateConference()"),new Promise(function(pe,G){var r=ae.hasOwnProperty("friendlyName")?ae.friendlyName:W.g.guid(),s=null,N=U.getSession().getToken();ra.createConference(N,r,ae).then(function(q){(s=Ar.getOrCreateConference(q.hash)).friendlyName=r;var ee=ae.hasOwnProperty("password")?ae.password:"";return s.join({password:ee,session:U.getSession()})}).then(function(){pe(s)}).catch(function(q){var ee="createPrivateConference() - Could not create conference";En.error(ee,q),G(new Error(ee))})})}},{key:"getTags",value:function(U){var ae=this;return new Promise(function(pe,G){var r={};U&&U.hasOwnProperty("webconfId")&&(r.webconfId=U.webconfId),ra.getEnterpriseTagList(ae.getId(),ae.getSession().getToken(),r).then(function(s){return s.hasOwnProperty("tags")&&Array.isArray(s.tags)?pe(s.tags):G(W.g.createError(i.g.ERROR_OTHER,"getTags() - unexpected response",En))}).catch(function(s){return G(W.g.createError(i.g.ERROR_OTHER,"getTags() - cannot get tags",En,{fromError:s}))})})}}],E=[{key:"fetchEnterpriseInformation",value:function(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U.hasOwnProperty("cloudUrl")&&ra.setCloudURL(U.cloudUrl),ra.getEnterpriseInformation(U)}},{key:"fetchSiteAgents",value:function(U){var ae=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(pe,G){ae.hasOwnProperty("cloudUrl")&&ra.setCloudURL(ae.cloudUrl);var r=[];ra.getSiteAgents(Bo.getActiveApiKey(),U,ae).then(function(s){var N,q=cr(s);try{for(q.s();!(N=q.n()).done;){var ee=N.value;r.push({contact:Mr.getOrCreateContact(ee.id),title:ee.title,nickname:ee.nickname,isPrefered:ee.isPrefered})}}catch(te){q.e(te)}finally{q.f()}pe(r)}).catch(function(s){G(W.g.createError(i.g.ERROR_OTHER,"fetchSiteAgents() - could not fetch site agents",En))})})}}],B&&eo(O.prototype,B),E&&eo(O,E),D}();function _r(D){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}function qo(D,O){if(!(D instanceof O))throw new TypeError("Cannot call a class as a function")}function ro(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}function Dr(D,O){return(Dr=Object.setPrototypeOf||function(B,E){return B.__proto__=E,B})(D,O)}function Ho(D,O){if(O&&("object"===_r(O)||"function"==typeof O))return O;if(void 0!==O)throw new TypeError("Derived constructors may only return object or undefined");return Ra(D)}function Ra(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function ur(D){return(ur=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)})(D)}e(3123);var zt=R.Y.get("UserAgent"),qt=Rt.get(),Pn=new(fe()),Jo="apizee:",Yo="apzkey:",Ka=new WeakMap,Xo=["mediaDeviceChanged","externalJsLoadingStatus","ccsConnectionStatus","userMediaError"],oo=function(D){!function(r,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&Dr(r,s)}(G,D);var O,B,E,U,ae,pe=(U=G,ae=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}(),function(){var r,s=ur(U);if(ae){var N=ur(this).constructor;r=Reflect.construct(s,arguments,N)}else r=s.apply(this,arguments);return Ho(this,r)});function G(){var r,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};qo(this,G),r=pe.call(this,zt),zt.debug("Create UserAgent"),r.uri=s.hasOwnProperty("uri")?s.uri:null,r.userId=null,r.username=null,r.profile=null,r.preRegisterUserData=new ot,r.callStatsMonitoringEnabled=null,r.callStatsMonitoringInterval=null,r.meshModeEnabled=null,r.apiRTCMediaDeviceDetectionEnabled=!!s.hasOwnProperty("apiRTCMediaDeviceDetectionEnabled")&&s.apiRTCMediaDeviceDetectionEnabled,r.apiRTCMediaDeviceDetectionDelay=s.hasOwnProperty("apiRTCMediaDeviceDetectionDelay")?s.apiRTCMediaDeviceDetectionDelay:i.g.APIRTC_MEDIA_DEVICE_DETECTION_DELAY,r.targetBandwidthUsage=0,r.videoBandwidthSettings={overallIncoming:3e3,overallOutgoing:3e3},r.currentSession=null,r.enterprise=null,r.capabilities={whiteboardCursor:"ON",mediaDeviceChanged:"ON",webRTCCompliant:"ON",screenSharingCompliant:"ON",qoSStatCompliant:"ON",backgroundRemoval:"ON",streamCapabilities:"ON"},r.browser=apiRTC.browser,r.browser_major_version=apiRTC.browser_major_version,r.browser_version=apiRTC.browser_version,r.osName=apiRTC.osName,r.osVersion=apiRTC.osVersion,r.browserInfo=apiRTC.browserInfo,r.browserDetails=apiRTC.browserDetails,Ka.set(Ra(r),null),qt.createWhiteBoard(),apiCC.activateScreenSharing();var N=function($){ce.get(Ra(r)).emit("mediaDeviceChanged",{added:$.detail.diff.added,removed:$.detail.diff.removed,updated:$.detail.diff.updated,updateReason:$.detail.updateReason,firstMediaDeviceListInitialization:$.detail.firstMediaDeviceListInitialization})};apiRTC.addEventListener("mediaDeviceChanged",N);var q=function($){ce.get(Ra(r)).emit("externalJsLoadingStatus",{extjs:$.detail.extjs,status:$.detail.status})};apiRTC.addEventListener("externalJsLoadingStatus",q);var ee=function($){var ue=null;"onChannelOpened"===$.detail.channelEvent?ue="connected":"onChannelDisconnect"===$.detail.channelEvent?ue="disconnected":"onChannelReconnecting"===$.detail.channelEvent?ue="retry":("onChannelConnectError"===$.detail.channelEvent||"onChannelError"===$.detail.channelEvent)&&(ue="error"),null!==ue&&ce.get(Ra(r)).emit("ccsConnectionStatus",{status:ue})};apiRTC.addEventListener("channelEvent",ee);var te=function($){var ue={error:$.detail.error};"media"===$.detail.callType?(ue.audio=!0,ue.video=!0,ue.screenSharing=!1):"audio"===$.detail.callType?(ue.audio=!0,ue.video=!1,ue.screenSharing=!1):"videoOnly"===$.detail.callType?(ue.audio=!1,ue.video=!0,ue.screenSharing=!1):"screenSharing"===$.detail.callType?(ue.audio=!1,ue.video=!0,ue.screenSharing=!0):"screenSharingWithAudio"===$.detail.callType&&(ue.audio=!0,ue.video=!0,ue.screenSharing=!0),ce.get(Ra(r)).emit("userMediaError",ue)};return apiRTC.addEventListener("userMediaError",te),r.checkUACapabilities(),"OFF"===r.capabilities.mediaDeviceChanged&&(zt.debug("mediaDeviceChanged is not supported"),!0===r.apiRTCMediaDeviceDetectionEnabled&&(zt.debug("apiRTCMediaDeviceDetectionEnabled is activated, starting process"),setInterval(function(){apiCC.mediaDeviceMgr.getMediaDevices()},r.apiRTCMediaDeviceDetectionDelay))),apiRTC.userAgentInstance=Ra(r),r}return O=G,B=[{key:"fetchUserMediaDevices",value:function(){return zt.warn("DEPRECATION WARNING : fetchUserMediaDevices() is now deprecated, use getUserMediaDevices() instead"),new Promise(function(r,s){"IE"===apiCC.browser&&apiCC.browser_version>8?(apiCC.getMediaDevicesWithCB(apiCC.mediaDeviceMgr.gotSources),r(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray)):apiCC.getMediaDevices().then(function(N){apiCC.mediaDeviceMgr.gotSources(N),r(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray)}).catch(function(){zt.log("Error on MediaDeviceManager::getMediaDevices"),apiCC.mediaDeviceMgr.gotSources(null),s(W.g.createError(i.g.ERROR_OTHER,"fetchUserMediaDevices() - Could not get media devices",zt))})})}},{key:"getUserMediaDevices",value:function(){return apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray}},{key:"createStream",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return zt.info("createStream() with option :",r),wn.createStreamFromUserMedia(r.audioInputId,r.videoInputId,r.constraints,r)}},{key:"createStreamFromMediaStream",value:function(r){return zt.info("createStreamFromMediaStream()"),wn.createStreamFromMediaStream(r)}},{key:"fetchNetworkInformation_v2",value:function(r,s){zt.debug("fetchNetworkInformation Version 2 :",r);var N=Pn.cloudUrl;null!=r&&(N=r);var q={testServer:N,httpPing:{},upload:{},download:{}};return null!=s&&Array.isArray(s)?(apiRTC.bandwidthRatingThresholds=s,zt.debug("New bandwidthRatingThresholds is defined :",apiRTC.bandwidthRatingThresholds)):zt.debug("Using default bandwidthRatingThresholds :",apiRTC.bandwidthRatingThresholds),apiRTC.bandwidthTestServer=N,zt.info("Start Network test"),new Promise(function(ee,te){apiRTC.testUserPing(function($,ue){null!==$?te($):(q.httpPing=ue,apiRTC.testUserUpload(25e4,function(Ie,Ue){null!==Ie?te(Ie):(q.upload.kbps=8*Ue.kBPerSec,q.upload.rating=Ue.rating,apiRTC.testUserUploadLoop(5e5,q.upload,function(vt,pt){null!==vt?te(vt):(q.upload.kbps=8*pt.kBPerSec,q.upload.rating=pt.rating,apiRTC.testUserDownload(256,function(kt,Ut){null!==kt?te(kt):(q.download.kbps=8*Ut.kBPerSec,q.download.rating=Ut.rating,apiRTC.testUserDownloadLoop(1e3,q.download,function(fi,$i){null!==fi?te(fi):(q.download.kbps=8*$i.kBPerSec,q.download.rating=$i.rating,ee(q))}))}))}))}))})})}},{key:"fetchNetworkInformation_v1",value:function(r,s){zt.debug("fetchNetworkInformation Version 1 :",r);var N=Pn.cloudUrl;null!=r&&(N=r);var q={testServer:N,httpPing:{},upload:{},download:{}};return null!=s&&Array.isArray(s)?(apiRTC.bandwidthRatingThresholds=s,zt.debug("New bandwidthRatingThresholds is defined :",apiRTC.bandwidthRatingThresholds)):zt.debug("Using default bandwidthRatingThresholds :",apiRTC.bandwidthRatingThresholds),apiRTC.bandwidthTestServer=N,zt.info("Start Network test"),new Promise(function(ee,te){apiRTC.testUserPing(function($,ue){null!==$?te($):(q.httpPing=ue,apiRTC.testUserUpload(25e4,function(Ie,Ue){null!==Ie?te(Ie):(q.upload.kbps=8*Ue.kBPerSec,q.upload.rating=Ue.rating,q.upload.kbps>=1e3&&apiRTC.testUserUpload(5e5,function(vt,pt){null!==vt?te(vt):(q.upload.kbps=8*pt.kBPerSec,q.upload.rating=pt.rating)}),apiRTC.testUserDownload(256,function(vt,pt){null!==vt?te(vt):(q.download.kbps=8*pt.kBPerSec,q.download.rating=pt.rating,q.download.kbps>=500&&q.download.kbps<1500?apiRTC.testUserDownload(500,function(kt,Ut){null!==kt?te(kt):(q.download.kbps=8*Ut.kBPerSec,q.download.rating=Ut.rating,ee(q))}):q.download.kbps>=1500?apiRTC.testUserDownload(768,function(kt,Ut){null!==kt?te(kt):(q.download.kbps=8*Ut.kBPerSec,q.download.rating=Ut.rating,ee(q))}):ee(q))}))}))})})}},{key:"fetchNetworkInformation",value:function(r,s){return this.fetchNetworkInformation_v1(r,s)}},{key:"fetchGeolocationInformation",value:function(r){return null==r&&(r={enableHighAccuracy:!1,timeout:1/0,maximumAge:0}),new Promise(function(s,N){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(q){s(q)},function(q){N(q)},r)})}},{key:"setUserData",value:function(r){this.currentSession&&this.currentSession.setUserData(r)}},{key:"setUsername",value:function(r){this.currentSession?this.currentSession.setUsername(r):this.preRegisterUserData.setProp("username",r)}},{key:"setPhotoUrl",value:function(r){this.currentSession?this.currentSession.setPhotoUrl(r):this.preRegisterUserData.setProp("photo_url",r)}},{key:"getUserData",value:function(){return this.currentSession?this.currentSession.getUserData():this.preRegisterUserData}},{key:"getUsername",value:function(){return this.currentSession?this.currentSession.getUsername():null!==this.preRegisterUserData.get("username")?this.preRegisterUserData.get("username"):null!==this.preRegisterUserData.get("nickname")?this.preRegisterUserData.get("nickname"):this.username}},{key:"getPhotoUrl",value:function(){return this.currentSession?this.currentSession.getPhotoUrl():null!==this.preRegisterUserData.get("photo_url")?this.preRegisterUserData.get("photo_url"):null!==this.preRegisterUserData.get("photoUrl")?this.preRegisterUserData.get("photoUrl"):this.userId?Pn.getUserPhotoUrl(this.userId):null}},{key:"fetchProfileInformation",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(N,q){var ee=null;null===r.profile||s?r.userId&&null!==(ee=qt.getActiveApiKey())?Pn.getUserProfile(ee,r.userId).then(function(te){r.profile=te,N(te)}).catch(q):q("fetchProfileInformation() - missing registration"):N(r.profile)})}},{key:"getEnterprise",value:function(){return Ka.get(this)}},{key:"getCurrentSession",value:function(){return this.currentSession}},{key:"getEventCenter",value:function(){return apiRTC.eventCenter}},{key:"startWhiteboard",value:function(r,s){zt.trace("startWhiteboard()"),qt.whiteBoardClient.start(),qt.whiteBoardClient.setCanvas(r),null!=s&&qt.whiteBoardClient.setUserCursorColor(s)}},{key:"stopWhiteboard",value:function(){zt.trace("stopWhiteboard()"),qt.whiteBoardClient.stop()}},{key:"getWhiteboardClient",value:function(){return zt.trace("getWhiteboardClient()"),qt.whiteBoardClient}},{key:"register",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(N,q){if(zt.info("Register "+r.uri),s.hasOwnProperty("uri")&&(r.uri=s.uri),s.hasOwnProperty("cloudUrl")&&Pn.setCloudURL(s.cloudUrl),s.hasOwnProperty("cloudFetchRetries")&&Pn.setFetchRetries(s.cloudFetchRetries),s.hasOwnProperty("cloudFetchRetryDelay")&&Pn.setFetchRetryDelay(s.cloudFetchRetryDelay),null!==r.uri)if(r.currentSession)q(W.g.createError(i.g.ERROR_APIRTC_SESSION_ALREADY_ON,"register() - Session already ON",zt));else if(r.uri.startsWith("token:"))Qo(r,s,N,q);else if(r.uri.startsWith(Jo))Ko(r,s,N,q);else if(r.uri.startsWith(Yo))$o(r,s,N,q);else{var ee=r.uri.split(":")[0];q(W.g.createError(i.g.ERROR_REGISTRATION_URI_INVALID,"register() - prefix invalid used for uri :"+ee,zt))}else q(W.g.createError(i.g.ERROR_REGISTRATION_URI_INVALID,"register() - Cannot register UserAgent, no uri was specified",zt))})}},{key:"unregister",value:function(){var r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{invalidateUserToken:!0};return new Promise(function(N,q){null!==r.currentSession?r.currentSession.disconnect(s).then(function(){r.currentSession=null,Ka.set(r,null),N()}).catch(function(ee){q(W.g.createError(i.g.ERROR_OTHER,"unregister() - unregistration error",zt))}):q(W.g.createError(i.g.ERROR_OTHER,"unregister() - no current session",zt))})}},{key:"isRegistered",value:function(){return null!==this.currentSession}},{key:"getDefaultDevices",value:function(){return{audioInput:apiCC.mediaDeviceMgr.defaultAudioInput,audioOutput:apiCC.mediaDeviceMgr.defaultAudioOuput,videoInput:apiCC.mediaDeviceMgr.defaultVideoInput}}},{key:"enableCallStatsMonitoring",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};["chrome","firefox"].indexOf(apiCC.browserDetails.type)<0?zt.warn("enableCallStatsMonitoring() is only supported on Chrome and Firefox, support on other browsers will be added soon"):!0===r?(this.callStatsMonitoringEnabled=!0,W.g.isPropertyTypeof(s,"interval","number")&&s.interval>=1e3&&(this.callStatsMonitoringInterval=s.interval),this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.enableCallStatsMonitoring(!0,this.callStatsMonitoringInterval)):(this.callStatsMonitoringEnabled=!1,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.enableCallStatsMonitoring(!1))}},{key:"enableActiveSpeakerDetecting",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!0===r?W.g.isPropertyTypeof(s,"threshold","number")&&s.threshold>0?apiRTC.enableActiveSpeakerDetecting(!0,s.threshold):apiRTC.enableActiveSpeakerDetecting(!0):apiRTC.enableActiveSpeakerDetecting(!1)}},{key:"enableMeshRoomMode",value:function(r){!1===r||!0===r?(this.meshModeEnabled=r,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.enableMeshRoomMode(r)):zt.error("Wrong value",r)}},{key:"setTargetBandwidthUsage",value:function(r){!isNaN(r)&&r>0?(this.targetBandwidthUsage=r,this.isRegistered&&qt.webRTCClient.setVideoBandwidth(r)):zt.error("Unvalid target bandwidth usage value",r)}},{key:"setOverallIncomingVideoBandwidth",value:function(r){r>0?(this.videoBandwidthSettings.overallIncoming=r,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setOverallIncomingVideoBandwidth(r)):(delete this.videoBandwidthSettings.overallIncoming,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setOverallIncomingVideoBandwidth(0))}},{key:"setOverallOutgoingVideoBandwidth",value:function(r){r>0?(this.videoBandwidthSettings.overallOutgoing=r,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setOverallOutgoingVideoBandwidth(r)):(delete this.videoBandwidthSettings.overallOutgoing,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setOverallOutgoingVideoBandwidth(0))}},{key:"setPerCallIncomingVideoBandwidth",value:function(r){r>0?(this.videoBandwidthSettings.perCallIncoming=r,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setPerCallIncomingVideoBandwidth(r)):(delete this.videoBandwidthSettings.perCallIncoming,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setPerCallIncomingVideoBandwidth(0))}},{key:"setPerCallOutgoingVideoBandwidth",value:function(r){r>0?(this.videoBandwidthSettings.perCallOutgoing=r,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setPerCallOutgoingVideoBandwidth(r)):(delete this.videoBandwidthSettings.perCallOutgoing,this.isRegistered&&qt.webRTCClient&&qt.webRTCClient.setPerCallOutgoingVideoBandwidth(0))}},{key:"updateMediaOnCall",value:function(r,s){qt.webRTCClient.updateMediaDeviceOnCall(r,s)}},{key:"getCapabilities",value:function(){return this.capabilities}},{key:"getBrowser",value:function(){return this.capabilities}},{key:"getBrowserMajorVersion",value:function(){return this.browser_major_version}},{key:"getBrowserVersion",value:function(){return this.browser_version}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getBrowserInfo",value:function(){return this.browserInfo}},{key:"getBrowserDetails",value:function(){return this.browserDetails}},{key:"checkUACapabilities",value:function(){zt.debug("checkUACapabilities"),"iOS"===apiRTC.osName&&(zt.debug("Deactivating whiteboardCursor for iOS"),this.capabilities.whiteboardCursor="OFF"),"Android"===apiRTC.osName&&"Chrome"===apiRTC.browser&&(zt.debug("mediaDeviceChanged not supported on Chrome/Android"),this.capabilities.mediaDeviceChanged="OFF"),"Safari"!==v.Xh&&"Mobile Safari"!==v.Xh||(zt.debug("mediaDeviceChanged not supported on Safari"),this.capabilities.mediaDeviceChanged="OFF"),!1===apiRTC.webRTCCompliant&&(zt.debug("WebRTC not compliant"),this.capabilities.webRTCCompliant="OFF"),!1===apiRTC.screenSharingCompliant&&(zt.debug("screenSharing not compliant"),this.capabilities.screenSharingCompliant="OFF"),!1===apiRTC.qoSStatCompliant&&(zt.debug("qoS Stat not compliant"),this.capabilities.qoSStatCompliant="OFF"),"requestVideoFrameCallback"in HTMLVideoElement.prototype||(zt.debug("background removal not compliant"),this.capabilities.backgroundRemoval="OFF"),"getCapabilities"in MediaStreamTrack.prototype||(zt.debug("Stream capabilities not compliant"),this.capabilities.streamCapabilities="OFF")}},{key:"startPrecallTest",value:function(r,s,N,q,ee){qt.webRTCClient.startPrecallTest(r,s,N,q,ee)}},{key:"sendLogToCloud",value:function(r,s,N,q){apiCC.sendLogToCloud(r,s,N,q)}}],E=[{key:"getAvailableEvents",value:function(){return Xo}}],B&&ro(O.prototype,B),E&&ro(O,E),G}(Ne),Ko=function(D,O,B,E){zt.debug("register() - Registration using prefix :apizee:");var U=D.uri.split(":")[1];null!==O.password&&"string"==typeof O.password?Pn.authentication(U,O.password).then(function(ae){return so(D,ae.token,O)}).then(function(ae){B(ae)}).catch(function(ae){var pe="register() - An error occured during cloud credentials registration :"+JSON.stringify(ae),G={error:new Error(pe),code:i.g.ERROR_OTHER};zt.error(pe,ae),ae.hasOwnProperty("code")?G.code=ae.code:ae.hasOwnProperty("http_code")&&(G.code=ae.http_code.toString().startsWith("4")?i.g.ERROR_INVALID_CREDENTIALS:i.g.ERROR_SERVER_UNAVAILABLE),E(G)}):E(W.g.createError(i.g.ERROR_INVALID_CREDENTIALS,"register() - No password was specified for apizee: UserAgent registration",zt))},Qo=function(D,O,B,E){zt.debug("register() - Registration using prefix :token:");var U=D.uri.split(":")[1];Pn.checkUserToken(U).then(function(ae){return so(D,U,O)}).then(B).catch(function(ae){E(W.g.createError(i.g.ERROR_OTHER,"register() - An error occured during cloud token registration",zt))})},$o=function(D,O,B,E){zt.debug("register() - Registration using prefix :apzkey:");var U=D.uri.split(":")[1];new Promise(function(ae,pe){O.ccs?ae(O.ccs):Pn.getPreferredCCS(U).then(function(G){ae(G.ccs)}).catch(function(){pe(W.g.createError(i.g.ERROR_OTHER,"register() - Could not get preferred CCS",zt))})}).then(function(ae){D.currentSession=new Ii(D),D.currentSession.user=D,D.currentSession.token=null,D.username=W.g.isPropertyTypeof(O,"nickname","string")?O.nickname:"guest-"+W.g.guid().substr(0,13),D.preRegisterUserData.setProp("username",D.username),D.preRegisterUserData.setProp("userConfId",D.username+Date.now()),O.userData&&D.preRegisterUserData.setProps(O.userData);var pe={apiKey:U,MCUActivated:!0,mcu:O.hasOwnProperty("mcu")?O.mcu:i.g.DEFAULT_MCU,nickname:D.username,ccsServer:ae,bandwidthTestServer:Pn.cloudUrl,webRTCPluginActivated:!0,userData:D.preRegisterUserData,tryAudioCallAfterUserMediaError:!0,extJsLoadingRetryNb:O.extJsLoadingRetryNb,extJsLoadingRetryDelay:O.extJsLoadingRetryDelay,ccsConnectionRetryNb:O.ccsConnectionRetryNb,ccsConnectionRetryDelay:O.ccsConnectionRetryDelay,turnServerAddress:O.turnServerAddress,userAcceptOnIncomingDataCall:O.userAcceptOnIncomingDataCall,userAcceptOnIncomingScreenSharingCall:O.userAcceptOnIncomingScreenSharingCall};return O.hasOwnProperty("id")&&(pe.apiCCId=O.id),W.g.isPropertyTypeof(O,"idPersistenceTimeout","number")&&O.idPersistenceTimeout>=0&&(pe.apiCCIdPersistenceTimeout=O.idPersistenceTimeout),O.hasOwnProperty("groups")&&(pe.presenceGroup=O.groups),O.hasOwnProperty("subscribeTo")&&(pe.subscribeToPresenceGroup=O.subscribeTo),O.hasOwnProperty("contactDisconnectionDelay")&&(zt.debug("Setting contactDisconnectionDelay :",O.contactDisconnectionDelay),qt.contactDisconnectionDelay=O.contactDisconnectionDelay),pe.idConversionActivated=!1,O.hasOwnProperty("idConversionActivated")&&(pe.idConversionActivated=O.idConversionActivated),O.hasOwnProperty("conversationSpace")&&(pe.conversationSpace=O.conversationSpace),O.hasOwnProperty("token")&&(pe.token=O.token,D.currentSession.ccsToken=O.token),qt.initializeApiRTC(pe)}).then(function(ae){!1!==D.callStatsMonitoringEnabled&&!0!==D.callStatsMonitoringEnabled||qt.webRTCClient.enableCallStatsMonitoring(D.callStatsMonitoringEnabled,D.callStatsMonitoringInterval),!1!==D.meshModeEnabled&&!0!==D.meshModeEnabled||qt.webRTCClient.enableMeshRoomMode(D.meshModeEnabled),D.targetBandwidthUsage>0&&qt.webRTCClient.setVideoBandwidth(D.targetBandwidthUsage),D.videoBandwidthSettings.overallIncoming>0&&qt.webRTCClient.setOverallIncomingVideoBandwidth(D.videoBandwidthSettings.overallIncoming),D.videoBandwidthSettings.overallOutgoing>0&&qt.webRTCClient.setOverallOutgoingVideoBandwidth(D.videoBandwidthSettings.overallOutgoing),D.videoBandwidthSettings.perCallIncoming>0&&qt.webRTCClient.setPerCallIncomingVideoBandwidth(D.videoBandwidthSettings.perCallIncoming),D.videoBandwidthSettings.perCallOutgoing>0&&qt.webRTCClient.setPerCallOutgoingVideoBandwidth(D.videoBandwidthSettings.perCallOutgoing),D.userId=ae,D.currentSession.init(ae),zt.log("register() - APIRTC init OK",ae),null!=qt.apiRTCSession.userData&&(D.currentSession.userData=new ot(qt.apiRTCSession.userData)),B(D.currentSession)}).catch(function(ae){E(W.g.createError(i.g.ERROR_APIRTC_INITIALISATION_FAILED,"register() - ApiRTC Initialization error : "+ae,zt)),delete D.currentSession,D.currentSession=null})},so=function(D,O){var B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},E=null,U=null;return zt.debug("initializeCloudUASession :",B),new Promise(function(ae,pe){Pn.getConnectedUserInformation(O).then(function(G){if(U=G,zt.debug("Connected user information : ",G),D.currentSession=new Ii(D),D.currentSession.user=D,D.currentSession.token=G.token,B.hasOwnProperty("idPersistenceTimeout")&&(D.currentSession.idPersistenceTimeout=B.idPersistenceTimeout),D.username=G.nickname,D.preRegisterUserData.setProp("username",D.username),D.preRegisterUserData.setProp("nickname",D.username),D.preRegisterUserData.setProp("photo_url",G.photo_url),G.mail&&D.preRegisterUserData.setProp("mail",G.mail),D.preRegisterUserData.setProp("userConfId",D.username+Date.now()),B.userData&&D.preRegisterUserData.setProps(B.userData),!B.hasOwnProperty("overLoadedApiRTCKey")||null==B.overLoadedApiRTCKey||G.apiKey===B.overLoadedApiRTCKey)return D.userId=G.userId,E=new dr(G.enterpriseId,G.apiKey,D.currentSession),Ka.set(D,E),E.load();zt.debug("overLoadedApiRTCKey is defined :",B.overLoadedApiRTCKey),E=new dr(G.enterpriseId,B.overLoadedApiRTCKey,D.currentSession),delete B.id,D.userId=null,Ka.set(D,E),zt.debug("... no enterprise users data loading")}).then(function(){var G={apiKey:E.getApiKey(),ccsServer:B.ccs||U.ccs,MCUActivated:!0,mcu:B.hasOwnProperty("mcu")?B.mcu:i.g.DEFAULT_MCU,nickname:D.username,bandwidthTestServer:Pn.cloudUrl,webRTCPluginActivated:!0,apiCCId:B.hasOwnProperty("id")?B.id:D.userId,userData:D.preRegisterUserData,tryAudioCallAfterUserMediaError:!0,presenceGroup:["agent"],subscribeToPresenceGroup:["agent","visitor"],extJsLoadingRetryNb:B.extJsLoadingRetryNb,extJsLoadingRetryDelay:B.extJsLoadingRetryDelay,ccsConnectionRetryNb:B.ccsConnectionRetryNb,ccsConnectionRetryDelay:B.ccsConnectionRetryDelay,turnServerAddress:B.turnServerAddress,userAcceptOnIncomingDataCall:B.userAcceptOnIncomingDataCall,userAcceptOnIncomingScreenSharingCall:B.userAcceptOnIncomingScreenSharingCall};return W.g.isPropertyTypeof(B,"idPersistenceTimeout","number")&&B.idPersistenceTimeout>=0&&(G.apiCCIdPersistenceTimeout=B.idPersistenceTimeout),B.hasOwnProperty("groups")&&(G.presenceGroup=B.groups),B.hasOwnProperty("subscribeTo")&&(G.subscribeToPresenceGroup=B.subscribeTo),B.hasOwnProperty("contactDisconnectionDelay")&&(zt.debug("Setting contactDisconnectionDelay :",B.contactDisconnectionDelay),qt.contactDisconnectionDelay=B.contactDisconnectionDelay),G.idConversionActivated=!1,B.hasOwnProperty("idConversionActivated")&&(G.idConversionActivated=B.idConversionActivated),B.hasOwnProperty("conversationSpace")&&(G.conversationSpace=B.conversationSpace),qt.initializeApiRTC(G)}).then(function(G){!1!==D.callStatsMonitoringEnabled&&!0!==D.callStatsMonitoringEnabled||qt.webRTCClient.enableCallStatsMonitoring(D.callStatsMonitoringEnabled,D.callStatsMonitoringInterval),!1!==D.meshModeEnabled&&!0!==D.meshModeEnabled||qt.webRTCClient.enableMeshRoomMode(D.meshModeEnabled),D.targetBandwidthUsage>0&&qt.webRTCClient.setVideoBandwidth(D.targetBandwidthUsage),D.videoBandwidthSettings.overallIncoming>0&&qt.webRTCClient.setOverallIncomingVideoBandwidth(D.videoBandwidthSettings.overallIncoming),D.videoBandwidthSettings.overallOutgoing>0&&qt.webRTCClient.setOverallOutgoingVideoBandwidth(D.videoBandwidthSettings.overallOutgoing),D.videoBandwidthSettings.perCallIncoming>0&&qt.webRTCClient.setPerCallIncomingVideoBandwidth(D.videoBandwidthSettings.perCallIncoming),D.videoBandwidthSettings.perCallOutgoing>0&&qt.webRTCClient.setPerCallOutgoingVideoBandwidth(D.videoBandwidthSettings.perCallOutgoing),D.currentSession.init(G),zt.info("APIRTC init OK",G),null!=qt.apiRTCSession.userData&&(D.currentSession.userData=new ot(qt.apiRTCSession.userData)),ae(D.currentSession)}).catch(function(G){zt.error(G),pe(G)})})},Wa=R.Y.get("ResourcesLoader"),es=function(){function D(){(function(E,U){if(!(E instanceof U))throw new TypeError("Cannot call a class as a function")})(this,D),this.loadedJsLinks=[]}var O,B;return O=D,B=[{key:"loadjs",value:function(E){function U(ae,pe,G){return E.apply(this,arguments)}return U.toString=function(){return E.toString()},U}(function(E,U,ae){var pe=this;Wa.info("Load js resources",E),Wa.debug("Already loaded js",this.loadedJsLinks);var G=ae.success;if(0===(E=E.filter(function(r){return!pe.loadedJsLinks.includes(r)})).length)return Wa.debug("Skip resources loading, all resources previously loaded"),void(G instanceof Function&&G());Wa.debug("Filtered resources to load",E),ae.success=function(){pe.loadedJsLinks.push.apply(pe.loadedJsLinks,E),G instanceof Function&&G()},loadjs(E,U,ae)})},{key:"unloadjs",value:function(E){var U=this;Wa.info("Unload js",E),E.forEach(function(ae){var pe=document.querySelector('script[src="'+ae+'"]');void 0!==pe&&(pe.remove(),U.loadedJsLinks=U.loadedJsLinks.filter(function(G){return G!==ae}))}),Wa.debug("Scripts unloaded, currently loaded js",this.loadedJsLinks)}},{key:"reset",value:function(){unloadjs(this.loadedJsLinks),this.loadedJsLinks=[]}}],B&&function(D,O){for(var B=0;B<O.length;B++){var E=O[B];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}(O.prototype,B),D}();!function(D){var O,B,E=null,U=null,ae=[];function pe(){return Math.random().toString(36).substr(2)}O=function(){if("undefined"!=typeof apiRTC_React)return"react-native";var G,r=navigator.appName,s=navigator.userAgent,N=s.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return N&&null!==(G=s.match(/version\/([\.\d]+)/i))&&(N[2]=G[1]),(N=N?[N[1],N[2]]:[r,navigator.appVersion,"-?"])[0]}(),B=function(){if("undefined"!=typeof apiRTC_React)return 1;var G,r=navigator.appName,s=navigator.userAgent,N=s.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return N&&null!==(G=s.match(/version\/([\.\d]+)/i))&&(N[2]=G[1]),(N=N?[N[1],N[2]]:[r,navigator.appVersion,"-?"])[1]}(),U=new function(){("MSIE"===O&&B>8||"Netscape"===O)&&function(){function G(r,s){s=s||{bubbles:!1,cancelable:!1,detail:void 0};var N=document.createEvent("CustomEvent");return N.initCustomEvent(r,s.bubbles,s.cancelable,s.detail),N}G.prototype=D.CustomEvent.prototype,D.CustomEvent=G}(),this.eventDispatchMgr=function(G,r){if("undefined"!=typeof apiRTC_React)eventManager.dispatchEvent({type:G,detail:r});else if("MSIE"===O&&B<=8)"undefined"!=typeof $jqApz?$jqApz.event.trigger({type:G,detail:r}):"undefined"!=typeof jQuery&&jQuery.event.trigger({type:G,detail:r});else{var N=new CustomEvent(G,{detail:r,bubbles:!0,cancelable:!0});document.dispatchEvent(N)}},this.createGetUserFromIdAnswerEvent=function(G){var r={eventType:"getUserFromIdAnswer",time:new Date,message:G};this.eventDispatchMgr("getUserFromIdAnswer",r)},this.createGetAllUsersAnswerEvent=function(G){var r={eventType:"getAllUsersAnswer",time:new Date,message:G};this.eventDispatchMgr("getAllUsersAnswer",r)},this.createErrorEvent=function(G){var r={eventType:"error :",time:new Date,errorInfo:G};this.eventDispatchMgr("error",r)},this.createSearchUserAnswerEvent=function(G,r,s){var N={eventType:"searchUserAnswer :",time:new Date,searchStr:G,searchAnswerList:r,group:s};this.eventDispatchMgr("searchUserAnswer",N)}},(E={version:"1.0.4",description:"Apizee DataBase Library"}).init=function(G){this.socket=G,this.socket.on("getUserFromIdAnswer",this.callback(this,"onGetUserFromIdAnswer")).on("getAllUsersAnswer",this.callback(this,"onGetAllUsersAnswer")).on("searchUserAnswer",this.callback(this,"onSearchUserAnswer"))},E.createUser=function(G){if(null!==G&&null!==G.mail&&null!==G.id){var r=JSON.stringify(G);this.socket.emit("createUser",r)}},E.searchUserInGroup=function(G,r,s,N){var q=null,ee=null,te=pe();(void 0===r||"all"!==r&&"connected"!==r&&"disconnected"!==r)&&(r="all"),null!==G&&(q={searchStr:G,presenceState:r,group:s},void 0!==N&&(q.callbackId=te,ae[te]=N),ee=JSON.stringify(q),this.socket.emit("searchUser",ee))},E.searchUser=function(G,r,s,N){"function"==typeof s?E.searchUserInGroup(G,r,void 0,s):E.searchUserInGroup(G,r,s,N)},E.onSearchUserAnswer=function(G){var r=JSON.parse(G);void 0!==r.callbackId&&r.callbackId in ae?(ae[r.callbackId](r.searchStr,r.searchAnswerList),ae.splice(r.callbackId,1)):U.createSearchUserAnswerEvent(r.searchStr,r.searchAnswerList,r.group)},E.getUserFromId=function(G,r){var s=null,N=null,q=pe();null!==G&&(s={id:G},void 0!==r&&(s.callbackId=q,ae[q]=r),N=JSON.stringify(s),this.socket.emit("getUserFromId",N))},E.onGetUserFromIdAnswer=function(G){null!==G&&void 0!==G.callbackId&&G.callbackId in ae?(ae[G.callbackId](G),ae.splice(G.callbackId,1)):U.createGetUserFromIdAnswerEvent(G)},E.getAllUsers=function(){var r;r=JSON.stringify({}),this.socket.emit("getAllUsers",r)},E.onGetAllUsersAnswer=function(G){U.createGetAllUsersAnswerEvent(G)},E.setPresenceStatus=function(G,r,s){var q;q=JSON.stringify({id:G,presenceStatus:r,commentStatus:s}),this.socket.emit("setPresenceStatus",q)},E.setUserStatus=function(G,r){var s;r.id=G,s=JSON.stringify(r),this.socket.emit("setUserStatus",s)},E.setUserInfos=function(G){var s;s=JSON.stringify(G),this.socket.emit("setUserInfos",s)},E.addEventListener=function(G,r){"undefined"!=typeof apiRTC_React?eventManager.addEventListener(G,r):"getUserFromIdAnswer"!==G||"error"!==G||"getAllUsersAnswer"!==G||"searchUserAnswer"!==G?document.addEventListener(G,r,!1):U.createErrorEvent("ERROR: Trying to add a listener on an unknow event")},E.callback=function(G,r){return this.closureHandler=function(s){return G[r](s)},this.closureHandler},D.apiDB=E}(window);var ri=R.Y.get("Init"),on=R.Y.get("MediaDeviceManager");function kr(D){return(kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(D)}F=e.hmd(F),null!=console&&console.info&&console.info("Loading APIRTC_MODULE"),window.Prototype&&delete Array.prototype.toJSON;var lo=new(fe());f.version="4.6.0",f.utils={},f.eventCenter=new b,f.resourcesLoader=new es;for(var Nr=0,co=Object.keys(i.g);Nr<co.length;Nr++){var uo=co[Nr];f[uo]=i.g[uo]}f.utils.EventEmitter=w,f.utils.EventCenter=b,f.MediaDevice=le,f.Stream=wn,f.Call=yi,f.Conversation=Gt,f.ConversationCall=Va,f.Conference=ar,f.Contact=Ei,f.Enterprise=dr,f.SentInvitation=St,f.ReceivedInvitation=m,f.ReceivedCallInvitation=Pi,f.ReceivedConversationJoinRequest=Vn,f.ReceivedConversationInvitation=ye,f.ReceivedFileTransferInvitation=Tn,f.ReceivedWhiteboardInvitation=Bt,f.ReceivedDataChannelInvitation=hn,f.ReceivedPointerSharingInvitation=Z,f.PointerSharingRoom=Sr,f.Session=Ii,f.UserAgent=oo,f.UserData=ot,f.CloudApi=lo,f.DataChannel=Jn,f.Observable=Ne,f.setLogLevel=function(D){R.Y.setLogLevel(D)};var ho=!1;if(void 0===window.apiRTC){if("object"===kr(F)&&F.exports)F.exports=f;else if("function"==typeof define&&e.amdO){var ts=f;define(function(){return window.apiRTC2=window.apiRTC=ts})}window.apiRTC2=window.apiRTC=window.apiCC=window.CC=f,ho=!0}else console.info("APIRTC_MODULE already loaded with version :",apiRTC.version);!0===ho&&(f.init=function(D){var O,B;if(ri.info("apiRTC initialization, version is :"+apiCC.version),ri.info("osName :"+apiCC.osName),ri.info("osVersion :"+apiCC.osVersion),ri.info("browser :"+apiCC.browser),ri.info("browser_version :"+apiCC.browser_version),B=!0,ri.info("apiKey :",O=D.apiKey),-1!==O.indexOf("[")&&(B=!1),!0===B)if(D.hasOwnProperty("apiCCId")&&null!==D.apiCCId&&""!==D.apiCCId&&!0!==function(ae){if(null!==ae){var pe=ae;if("number"==typeof pe&&(pe=String(pe)),"string"==typeof pe)return pe.length<=128}return!1}(D.apiCCId))ri.error("apiCCId format is not correct, leaving connection process");else{var E="";E=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol&&"https:"!=window.location.protocol?"http":"https","iOS"!==v.ag.name&&"Android"!==v.ag.name||(ri.log(v.ag.name+" detected forcing protocol to https"),E="https"),void 0===D.ccsServer?(ri.debug("Setting ccsServer"),D.ccsServer=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol?"https:"==window.location.protocol||"iOS"===v.ag.name||"Android"===v.ag.name?"ccs5.apizee.com:443":"ccs5.apizee.com:80":"ccs5.apizee.com:443"):ri.log("ccsServer is defined on init()"),null!=D.bandwidthTestServer?(ri.log("bandwidthTestServer is defined :",D.bandwidthTestServer),apiCC.bandwidthTestServer=D.bandwidthTestServer):ri.log("bandwidthTestServer is not defined"),void 0!==D.userData&&ri.log("userData :",D.userData),apiCC.extJsLoadingRetryNb=D.extJsLoadingRetryNb,apiCC.extJsLoadingRetryDelay=D.extJsLoadingRetryDelay,!1===apiCC.jsLoaded?(apiCC.initApiKey=D.apiKey,apiCC.initApiCCId=D.apiCCId,apiRTC_sioLoader.load(E,D,{success:function(){ri.log("sio loaded"),apiCC.jsLoaded=!0,apiCC.session=new apiCC.ApiCCSession(D),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","loaded")},error:function(){ri.error("sio loading error"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","error")},retrycb:function(){ri.warn("sio retry"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","retry")}})):(ri.log("apiRTC JS Librairies already loaded"),ri.log("initParameters have changed, need to reload session connection"),apiCC.addEventListener("sessionReady",D.onReady),ri.log("initParameters.userData :",D.userData),void 0!==D.apiCCId&&""!==D.apiCCId&&null!==D.apiCCId||(ri.log("keeping apiCCId defined by apiRTC :"+D.apiCCId),D.apiCCId=apiCC.session.apiCCId),ri.log("initParameters.apiCCId :"+D.apiCCId),null!=D.userData?(ri.log("userData is defined :",D.userData),apiCC.session.userData=D.userData):ri.log("userData is not defined"),ri.log("apiCC.session.userData :",apiCC.session.userData),null!=D.token?(ri.log("token is defined :"+D.token),apiCC.session.token=D.token):(ri.log("token is not defined"),apiCC.session.token=null),null!=D.conversationSpace?(ri.log("conversationSpace is defined :"+D.conversationSpace),apiCC.session.conversationSpace=D.conversationSpace):(ri.log("conversationSpace is not defined"),apiCC.session.conversationSpace=null),apiCC.session.reOpenChannel(D.apiCCId,D.apiKey),null!=D.nickname?(ri.log("Nickname is defined :"+D.nickname),apiCC.session.nickname=D.nickname):(ri.log("Nickname is not defined, setting to apiCCId value :"+apiCC.session.apiCCId),apiCC.session.nickname=apiCC.session.apiCCId),null!=D.photoURL?(ri.log("photoURL is defined :"+D.photoURL),apiCC.session.photoURL=D.photoURL):(ri.log("photoURL is not defined"),apiCC.session.photoURL=null),null!=D.presenceGroup?(ri.log("presenceGroup is defined :"+D.presenceGroup),JSON.stringify(apiCC.session.presenceGroup)!==JSON.stringify(D.presenceGroup)&&(ri.log("presenceGroup updated on initParameters"),apiCC.session.channel.updatePresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldPresenceGroup&&(apiCC.session.channel.oldPresenceGroup=apiCC.session.presenceGroup),apiCC.session.channel.newPresenceGroup=D.presenceGroup,apiCC.session.presenceGroup=D.presenceGroup)):(ri.log('presenceGroup is not defined, setting to ["default"]'),JSON.stringify(apiCC.session.presenceGroup)!==JSON.stringify(["default"])&&(ri.log("presenceGroup updated on initParameters"),apiCC.session.channel.updatePresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldPresenceGroup&&(apiCC.session.channel.oldPresenceGroup=apiCC.session.presenceGroup),apiCC.session.channel.newPresenceGroup=["default"],apiCC.session.presenceGroup=["default"])),null!=D.subscribeToPresenceGroup?(ri.log("subscribeToPresenceGroup is defined :"+D.subscribeToPresenceGroup),JSON.stringify(apiCC.session.subscribeToPresenceGroup)!==JSON.stringify(D.subscribeToPresenceGroup)&&(ri.log("subscribeToPresenceGroup updated on initParameters"),apiCC.session.channel.updateSubscribeToPresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldSubscribeToPresenceGroup&&(apiCC.session.channel.oldSubscribeToPresenceGroup=apiCC.session.subscribeToPresenceGroup),apiCC.session.channel.newSubscribeToPresenceGroup=D.subscribeToPresenceGroup,apiCC.session.subscribeToPresenceGroup=D.subscribeToPresenceGroup)):(ri.log('subscribeToPresenceGroup is not defined, setting to ["default"]'),JSON.stringify(apiCC.session.subscribeToPresenceGroup)!==JSON.stringify(["default"])&&(ri.log("subscribeToPresenceGroup updated on initParameters"),apiCC.session.channel.updateSubscribeToPresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldSubscribeToPresenceGroup&&(apiCC.session.channel.oldSubscribeToPresenceGroup=apiCC.session.subscribeToPresenceGroup),apiCC.session.channel.newSubscribeToPresenceGroup=["default"],apiCC.session.subscribeToPresenceGroup=["default"])),apiCC.initApiKey=D.apiKey,apiCC.initApiCCId=D.apiCCId)}else ri.error("Apikey format is not correct, leaving connection process")},e(2719),f.mediaDeviceMgr=new function(){this.audioDevicePresent=!0,this.videoDevicePresent=!0,this.audioOutputPresent=!0,this.mediaSourceInfos=null,this.mediaDeviceChangedDetected=!1,this.mediaDeviceSourceInfosArray={audioinput:{},audiooutput:{},videoinput:{}},this.mediaDeviceSourceInfosArrayBeforeGotSources=null,this.defaultVideoInput=null,this.defaultAudioInput=null,this.defaultAudioOuput=null,this.realMediaDevicesListInitialization=!1,this.realMediaDevicesListInitializationWasAlreadyDone=!1,on.debug("MediaDeviceManager"),null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=function(D){on.debug("Media device have changed"),apiCC.mediaDeviceMgr.getMediaDevices("updatedOnDeviceChange")}),this.gotSources=function(D,O){on.debug("gotSources : sourceInfos :",D),apiCC.mediaDeviceMgr.audioDevicePresent=!1,apiCC.mediaDeviceMgr.videoDevicePresent=!1,apiCC.mediaDeviceMgr.audioOutputPresent=!1;var B=!1;apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources=apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray;var E={},U=!1;(0,p.fS)(apiCC.mediaDeviceMgr.mediaSourceInfos,D)||(on.debug("MediaDevices change detected"),B=!0);var ae,pe=null,G=0,r=0,s=0,N=null;if(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray={audioinput:{},audiooutput:{},videoinput:{}},apiCC.mediaDeviceMgr.mediaSourceInfos=D,null!==D)for(ae=0;ae!==D.length;++ae)null!==(pe=D[ae]).deviceId&&""!==pe.deviceId?(N=new le(pe.deviceId,pe.kind),null!=pe.label&&(this.realMediaDevicesListInitialization=!0)):(on.debug("MediaDevices change but deviceId is not correct, using fakedeviceId :",ae),N=new le(ae,pe.kind)),"audio"===pe.kind||"audioinput"===pe.kind?(apiCC.mediaDeviceMgr.audioDevicePresent||(apiCC.mediaDeviceMgr.audioDevicePresent=!0),N.label=pe.label||"microphone "+ ++G,null===apiCC.mediaDeviceMgr.defaultAudioInput&&(apiCC.mediaDeviceMgr.defaultAudioInput=N),null!=pe.getCapabilities?N.capabilities=pe.getCapabilities():on.debug("getCapabilities not defined")):"video"===pe.kind||"videoinput"===pe.kind?(apiCC.mediaDeviceMgr.videoDevicePresent||(apiCC.mediaDeviceMgr.videoDevicePresent=!0),N.label=pe.label||"camera "+ ++r,null===apiCC.mediaDeviceMgr.defaultVideoInput&&(apiCC.mediaDeviceMgr.defaultVideoInput=N),null!=pe.getCapabilities?N.capabilities=pe.getCapabilities():on.debug("getCapabilities not defined")):"audiooutput"===pe.kind?(apiCC.mediaDeviceMgr.audioOutputPresent||(apiCC.mediaDeviceMgr.audioOutputPresent=!0),N.label=pe.label||"audio output "+ ++s,null===apiCC.mediaDeviceMgr.defaultAudioOuput&&(apiCC.mediaDeviceMgr.defaultAudioOuput=N)):(N.label=pe.label||"other source "+pe.deviceId,on.trace("Detected some other kind of source : "+pe.kind)),on.trace("Local device : "+N.label+" - "+N.id),void 0===apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[N.type]&&(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[N.type]={}),apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[N.type][N.id]=N;else on.warn("Media detection is not supported by browser, considering micro and camera present"),apiCC.mediaDeviceMgr.audioDevicePresent=!0,apiCC.mediaDeviceMgr.videoDevicePresent=!0,apiCC.mediaDeviceMgr.audioOutputPresent=!0;if(on.log("Audio device detected :"+apiCC.mediaDeviceMgr.audioDevicePresent),on.log("Video device detected :"+apiCC.mediaDeviceMgr.videoDevicePresent),on.log("audio Output device detected :"+apiCC.mediaDeviceMgr.audioOutputPresent),on.debug("mediaDeviceSourceInfosArray :",apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray),!1===apiCC.mediaDeviceMgr.audioDevicePresent?!1===apiCC.mediaDeviceMgr.videoDevicePresent?apiCC.myWebRTC_Event.createErrorEvent("Video device is not present","NO_AUDIO_NO_VIDEO_DEVICE"):apiCC.myWebRTC_Event.createErrorEvent("Audio device is not present","NO_AUDIO_DEVICE"):!1===apiCC.mediaDeviceMgr.videoDevicePresent&&apiCC.myWebRTC_Event.createErrorEvent("Video device is not present","NO_VIDEO_DEVICE"),(0,p.fS)(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources)||(on.debug("mediaDeviceSourceInfosArray change detected"),B=!0),!0===B){on.debug("fireMediaChangedEvent :",B);var q=this.getMediaDeviceListsDiff(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources);!0===this.realMediaDevicesListInitialization&&!1===this.realMediaDevicesListInitializationWasAlreadyDone&&(on.debug("This is the first real initialization of media device list"),U=!0),!0===this.realMediaDevicesListInitialization&&(this.realMediaDevicesListInitializationWasAlreadyDone=!0),this.mediaDeviceChangedDetected=!0,null!==apiCC.myWebRTC_Event&&apiCC.myWebRTC_Event.createMediaDeviceChangedEvent(q,O,U),on.debug("fireMediaChangedEvent :",apiCC.mediaDeviceMgr.mediaSourceInfos)}apiCC.session&&apiCC.session.apiCCWebRTCClient&&(apiCC.session.apiCCWebRTCClient.webRTCClient.setGumConfigWithDevicePresent(),E.audioDevicePresent=apiCC.mediaDeviceMgr.audioDevicePresent,E.videoDevicePresent=apiCC.mediaDeviceMgr.videoDevicePresent,apiCC.session.setUserData(E))},this.getMediaDevices=function(D){on.debug("MediaDeviceManager::getMediaDevices : updateReason :",D),"IE"===apiCC.browser&&apiCC.browser_version>8?apiCC.getMediaDevicesWithCB(apiCC.mediaDeviceMgr.gotSources):apiCC.getMediaDevices().then(function(O){apiCC.mediaDeviceMgr.gotSources(O,D)}).catch(function(){on.log("Error on MediaDeviceManager::getMediaDevices"),apiCC.mediaDeviceMgr.gotSources(null,D)})},this.getMediaDeviceListsDiff=function(D,O){void 0!==O&&O||(O={}),void 0!==D&&D||(D={});for(var B=[],E=[],U=[],ae=0,pe=Object.keys(O);ae<pe.length;ae++){var G=pe[ae];if(void 0===D[G])E[G]=O[G];else for(var r=0,s=Object.keys(O[G]);r<s.length;r++){var N=s[r];void 0===D[G][N]&&(void 0===E[G]&&(E[G]={}),E[G][N]=O[G][N])}}for(var q=0,ee=Object.keys(D);q<ee.length;q++)for(var te=ee[q],$=0,ue=Object.keys(D[te]);$<ue.length;$++){var Ie=ue[$];void 0!==O[te]&&void 0!==O[te][Ie]||(void 0===B[te]&&(B[te]={}),B[te][Ie]=D[te][Ie]),void 0!==O[te]&&void 0!==O[te][Ie]&&D[te][Ie].label!==O[te][Ie].label&&(void 0===U[te]&&(U[te]={}),U[te][Ie]=D[te][Ie])}return{added:Object.keys(B).length>0?B:null,removed:Object.keys(E).length>0?E:null,updated:Object.keys(U).length>0?U:null}}},f.mediaDeviceMgr.getMediaDevices(),f.webRTCCompliant=f.isWebRTCCompliant(),f.qoSStatCompliant=f.isQoSStatCompliant(),f.screenSharingCompliant=f.isScreenSharingCompliant());const is=apiRTC},1549:(F,Y,e)=>{"use strict";e.d(Y,{Y:()=>S}),e(6992),e(1532),e(1539),e(8783),e(3948),e(2772),e(4916),e(5306),e(2222),e(5268),e(3710),e(3161),e(9653),e(9070),e(9753),e(2526),e(1817),e(2165),e(1038),e(7042),e(8309);var i=e(3173);function c(n){return function(v){if(Array.isArray(v))return d(v)}(n)||function(v){if("undefined"!=typeof Symbol&&null!=v[Symbol.iterator]||null!=v["@@iterator"])return Array.from(v)}(n)||function(v,R){if(v){if("string"==typeof v)return d(v,R);var p=Object.prototype.toString.call(v).slice(8,-1);return"Object"===p&&v.constructor&&(p=v.constructor.name),"Map"===p||"Set"===p?Array.from(v):"Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?d(v,R):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(n,v){(null==v||v>n.length)&&(v=n.length);for(var R=0,p=new Array(v);R<v;R++)p[R]=n[R];return p}function L(n,v){for(var R=0;R<v.length;R++){var p=v[R];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(n,p.key,p)}}var w=new Map,A=i.g.LOG_LEVEL_WARN,C=function(n){var v,R=null,p=null;for(v=0;v<n.length;v++)"string"==typeof n[v]&&(-1!==n[v].indexOf('"type":"invite"')?n[v]=-1===n[v].indexOf("candidate")?-1===n[v].indexOf("S->C:")?"invite C->S: without candidate":"invite S->C: without candidate":-1===n[v].indexOf("S->C:")?"invite C->S: with candidate":"invite S->C: with candidate":-1!==n[v].indexOf('"type":"200OK"')?n[v]=-1===n[v].indexOf("candidate")?-1===n[v].indexOf("S->C:")?"200OK C->S: without candidate":"200OK S->C: without candidate":-1===n[v].indexOf("S->C:")?"200OK C->S: with candidate":"200OK S->C: with candidate":-1!==n[v].indexOf('"type":"candidate"')&&(-1===n[v].indexOf("S->C:")?(R=n[v].replace(/C->S: /g,""),p=JSON.parse(R),n[v]="candidate C->S:"+p.candidate):(R=n[v].replace(/onChannelMessage S->C: /g,""),p=JSON.parse(R),n[v]="candidate S->C:"+p.candidate)));return n},S=function(){function n(o){if(function(f,I){if(!(f instanceof I))throw new TypeError("Cannot call a class as a function")}(this,n),w.has(o))throw new Error("Cannot construct singleton Logger");this.category=o,w.set(o,this)}var v,R,p;return v=n,R=[{key:"trace",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_TRACE].concat(f))}},{key:"log",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_DEBUG].concat(f))}},{key:"debug",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_DEBUG].concat(f))}},{key:"info",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_INFO].concat(f))}},{key:"warn",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_WARN].concat(f))}},{key:"error",value:function(){for(var o=arguments.length,f=new Array(o),I=0;I<o;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_ERROR].concat(f))}},{key:"logMessage",value:function(o){for(var f=arguments.length,I=new Array(f>1?f-1:0),l=1;l<f;l++)I[l-1]=arguments[l];if(null!=console){if(o<=A){var V="[".concat((new Date).toISOString(),"]");switch(o in i.g.LOG_LEVEL_LABELS&&(V+="[".concat(i.g.LOG_LEVEL_LABELS[o],"]")),V+=i.g.LOG_PREFIX+"(".concat(this.category,")"),o){case i.g.LOG_LEVEL_ERROR:var T;console.error&&(T=console).error.apply(T,[V].concat(c(I)));break;case i.g.LOG_LEVEL_WARN:var b;console.warn&&(b=console).warn.apply(b,[V].concat(c(I)));break;case i.g.LOG_LEVEL_INFO:var H;console.info&&(H=console).info.apply(H,[V].concat(c(I)));break;default:var ne;console.log&&(ne=console).log.apply(ne,[V].concat(c(I)))}}"undefined"!=typeof apiCC&&apiCC.logStorageActivated&&o<=apiCC.logStorageLevel&&(I=C(I),apiCC.logStorage.push(JSON.stringify({name:"log",args:{0:"(".concat(this.category,")")+":"+I}})))}}}],p=[{key:"get",value:function(o){return w.has(o)?w.get(o):new n(o)}},{key:"setLogLevel",value:function(o){if(!Number.isInteger(o)||o<0)throw"Log level invalid";A=o}},{key:"getLogLevel",value:function(){return A}}],R&&L(v.prototype,R),p&&L(v,p),n}()},3173:(F,Y,e)=>{"use strict";e.d(Y,{g:()=>i}),e(2526),e(1817),e(1539);var i={LOG_PREFIX:"apiRTC",LOG_LEVEL_OFF:0,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL_TRACE:5,LOG_LEVEL_LABELS:{}};i.LOG_LEVEL_LABELS[i.LOG_LEVEL_ERROR]="ERROR",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_WARN]="WARN",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_INFO]="INFO",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_DEBUG]="DEBUG",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_TRACE]="TRACE",i.ERROR_OTHER=0,i.ERROR_INVALID_CREDENTIALS=1,i.ERROR_NETWORK_UNAVAILABLE=2,i.ERROR_SERVER_UNAVAILABLE=3,i.ERROR_UNAUTHORIZED=4,i.ERROR_APIRTC_INITIALISATION_FAILED=5,i.ERROR_APIRTC_SESSION_ALREADY_ON=6,i.ERROR_REGISTRATION_URI_INVALID=7,i.ERROR_NOT_FOUND=8,i.ERROR_BAD_PARAMETER=9,i.ERROR_INVITATION_STATE_INVALID=10,i.ERROR_TIMED_OUT=11,i.ERROR_STREAM_RECORD=12,i.ERROR_HTTP=13,i.ERROR_NOT_ALLOWED=14,i.ERROR_OPERATION_CANCELED=15,i.ERROR_WRONG_STATE=16,i.MEDIA_TYPE_PHOTO=0,i.MEDIA_TYPE_VIDEO=1,i.MEDIA_TYPE_AUDIO=2,i.MEDIA_TYPE_DOC=3,i.CONTACT_SEND_DATA_IDENTIFIER="contact_data",i.CONTACT_NEW_MEDIA_IDENTIFIER="contact_new_media",i.CONTACT_SEND_FILEINFO_IDENTIFIER="contact_file_info",i.CONTACT_DATACHANNEL_INVITATION="contact_datachannel_invitation",i.CONTACT_EVENTCENTER_DATA_REQUEST="contact_event_center_data_request",i.CONTACT_EVENTCENTER_DATA_ANSWER="contact_event_center_data_answer",i.CONTACT_GET_CAPABILITIES_IDENTIFIER="contact_get_capabilities",i.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER="contact_get_capabilities_result",i.CONTACT_GET_SETTINGS_IDENTIFIER="contact_get_settings",i.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER="contact_get_settings_result",i.CONTACT_GET_CONSTRAINTS_IDENTIFIER="contact_get_constraints",i.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER="contact_get_constraints_result",i.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_IDENTIFIER="contact_get_remote_capabilities_authorization",i.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_ACCEPT_IDENTIFIER="contact_get_remote_capabilities_authorization_accept",i.CONTACT_GET_REMOTE_CAPABILITIES_AUTHORIZATION_REFUSE_IDENTIFIER="contact_get_remote_capabilities_authorization_refuse",i.CONTACT_SET_CONSTRAINTS_IDENTIFIER="contact_set_remote_capability",i.CONVERSATION_ACCESS_GRANTED="GRANTED",i.CONVERSATION_NEED_MODERATOR_ACCEPTATION="NEED_MODERATOR_ACCEPTATION",i.CONVERSATION_ROLE_MODERATOR="moderator",i.CONVERSATION_ROLE_CONTRIBUTOR="contributor",i.CONVERSATION_ROLE_GUEST="guest",i.CONVERSATION_WAITING_ROOM_PREFIX="waiting-room-",i.CONVERSATION_SEND_DATA_IDENTIFIER="conv_data",i.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER="conv_persistent_data_update",i.CONVERSATION_JOIN_REQUEST_IDENTIFIER="conv_join_req",i.CONVERSATION_JOIN_ANSWER_IDENTIFIER="conv_join_ans",i.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER="conv_moderator_connected",i.CONVERSATION_NEW_MEDIA_IDENTIFIER="conv_new_media",i.CONVERSATION_CLOSED_IDENTIFIER="conv_closed",i.CONVERSATION_INVITATION_IDENTIFIER="conv_invite",i.INVITATION_ANSWER_IDENTIFIER="invite_ans",i.RECORD_BASE_URL="https://data2.apizee.com:10000/videoManager",i.RECORD_PLAY_URL=i.RECORD_BASE_URL+"?action=play&recordedFileName=",i.DEFAULT_MCU="mcu4.apizee.com",i.DEFAULT_TURNADDRESS="mp1.apizee.com",i.CALL_STATUS_WAITING_FOR_CALLEE=Symbol("CALL_STATUS_WAITING_FOR_CALLEE"),i.CALL_STATUS_ONGOING=Symbol("CALL_STATUS_ONGOING"),i.CALL_STATUS_ENDED=Symbol("CALL_STATUS_ENDED"),i.DATACHANNEL_STATUS_WAITING=Symbol("DATACHANNEL_STATUS_WAITING"),i.DATACHANNEL_STATUS_ONGOING=Symbol("DATACHANNEL_STATUS_ONGOING"),i.DATACHANNEL_STATUS_ENDED=Symbol("DATACHANNEL_STATUS_ENDED"),i.DATACHANNEL_TYPE_RECEIVE=Symbol("DATACHANNEL_TYPE_RECEIVE"),i.DATACHANNEL_TYPE_SEND=Symbol("DATACHANNEL_TYPE_SEND"),i.CONVERSATION_STATUS_JOINED=Symbol("CONVERSATION_STATUS_JOINED"),i.CONVERSATION_STATUS_NOT_JOINED=Symbol("CONVERSATION_STATUS_NOT_JOINED"),i.CONVERSATION_STATUS_WAITING=Symbol("CONVERSATION_STATUS_WAITING"),i.CONVERSATION_STATUS_JOINING=Symbol("CONVERSATION_STATUS_JOINING"),i.CONVERSATION_WHITEBOARD_STARTED=Symbol("CONVERSATION_WHITEBOARD_STARTED"),i.CONVERSATION_WHITEBOARD_NOT_STARTED=Symbol("CONVERSATION_WHITEBOARD_NOT_STARTED"),i.STATE_IDLE=Symbol("STATE_IDLE"),i.STATE_JOINING=Symbol("STATE_JOINING"),i.STATE_ACTIVE=Symbol("STATE_ACTIVE"),i.STATE_LEAVING=Symbol("STATE_LEAVING"),i.INVITATION_STATUS_ACCEPTED=Symbol("INVITATION_STATUS_ACCEPTED"),i.INVITATION_STATUS_DECLINED=Symbol("INVITATION_STATUS_DECLINED"),i.INVITATION_STATUS_STANDBY=Symbol("INVITATION_STATUS_STANDBY"),i.INVITATION_STATUS_EXPIRED=Symbol("INVITATION_STATUS_EXPIRED"),i.INVITATION_STATUS_CANCELLED=Symbol("INVITATION_STATUS_CANCELLED"),i.INVITATION_STATUS_ENDED=Symbol("INVITATION_STATUS_ENDED"),i.STREAM_TYPE_NO_INPUT="no_input",i.STREAM_TYPE_AUDIO="audio",i.STREAM_TYPE_VIDEO="video",i.STREAM_AUDIO_ANALYSIS_THRESHOLD=100,i.CONTACT_DISCONNECTION_DELAY=1e4,i.CONVERSATION_JOIN_REQUEST_INTERVAL=5e3,i.APIRTC_MEDIA_DEVICE_DETECTION_DELAY=1e4,i.CONVERSATION_GROUP_CHAT_MEMBER_UPDATE_DELAY=5e3,i.CONVERSATION_RECORDING_STARTED_DELAY=1e4,i.CONVERSATION_RECORDING_STOPPED_DELAY=5e3,i.CONVERSATION_STREAMING_STARTED_DELAY=1e4,i.CONVERSATION_STREAMING_STOPPED_DELAY=1e4,i.CONVERSATION_PARTICIPANT_EJECTION_DELAY=5e3,i.JOIN_WAITING_ROOM_PRESENCE_GROUP_TIMEOUT=3e3},1215:(F,Y,e)=>{"use strict";function i(w){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(w)}function c(w,A){return 3===arguments.length?d(arguments[0],arguments[1],arguments[2]):"null"===A?null===w:"array"===A?null!==w&&"object"===i(w)&&Array.isArray(w):null!==w&&i(w)===A}function d(w,A,C){if(null!==A&&"object"===i(A)&&Array.isArray(A)&&A.length>=1){var S=A[0];if(A.length>1)return c(w,"object")&&c(S,"string")&&w.hasOwnProperty(S)&&c(w[S],"object")&&d(w[S],A.slice(1),C);A=S}return"undefined"===C?c(w,"object")&&c(A,"string")&&!w.hasOwnProperty(A)&&c(w[A],C):c(w,"object")&&c(A,"string")&&w.hasOwnProperty(A)&&c(w[A],C)}e.d(Y,{g:()=>L}),e(4916),e(5306),e(3710),e(1539),e(9714),e(7941),e(9575),e(6716),e(9554),e(6992),e(1532),e(8783),e(3948),e(9753),e(7042),e(3843),e(2564),e(2526),e(1817),e(2165);var L={assignObject:function(w,A){var C,S,n;for(null==w&&(w={}),C=1;C<arguments.length;C+=1)for(S in n=arguments[C])n.hasOwnProperty(S)&&(w[S]=n[S]);return w},throttle:function(w,A){var C,S,n,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=null,p=0,o=function(){p=!1===v.leading?0:Date.now(),R=null,n=w.apply(C,S),R||(C=S=null)};return function(){var f=Date.now();p||!1!==v.leading||(p=f);var I=A-(f-p);return C=this,S=arguments,I<=0||I>A?(R&&(clearTimeout(R),R=null),p=f,n=w.apply(C,S),R||(C=S=null)):R||!1===v.trailing||(R=setTimeout(o,I)),n}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(w){var A=16*Math.random()|0;return("x"===w?A:3&A|8).toString(16)})},hashString:function(w){for(var A=0,C=0,S=w.length;C<S;)A=(A<<5)-A+w.charCodeAt(C++)<<0;return Math.abs(A)},arrayBuffertoString:function(w){var A=new DataView(w);return new TextDecoder("utf-8").decode(A)},getAudioContext:function(){return apiRTC.getAudioContext()},parseRecordingEvent:function(w,A){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return["roomName","callId","recordType","convId","mediaId","mediaURL","recordedFileName"].forEach(function(S){A.hasOwnProperty(S)&&(C[S]=String(A[S]))}),"AUDIO-ONLY"===A.mediaType?(C.audioOnly=!0,C.videoOnly=!1):"VIDEO-ONLY"===A.mediaType?(C.audioOnly=!1,C.videoOnly=!0):(C.audioOnly=!1,C.videoOnly=!1),"composite"===C.recordType&&(C.mode=A.hasOwnProperty("mode")?A.mode:"complete",A.hasOwnProperty("labelEnabled")?(C.labelEnabled=!0===A.labelEnabled,!0===C.labelEnabled&&A.hasOwnProperty("labels")&&(C.labels=A.labels)):C.labelEnabled=!1),C},paramsToQueryString:function(w){for(var A="",C=0,S=Object.keys(w);C<S.length;C++){var n=S[C];A+=""===A?"?":"&",null==w[n]?console.warn("apiRTC Utils - paramsToQueryString : "+n+" is undefined!"):A+=n+"="+w[n].toString()}return A},createError:function(w,A,C){var S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};C&&C.error(A);var n={code:w};return n.error=A instanceof String?new Error(A):A instanceof Error?A:new Error(String(A)),c(S,"object")&&(S.hasOwnProperty("fromError")&&(n.fromError=S.fromError),S.hasOwnProperty("httpCode")&&(n.httpCode=S.httpCode)),n},isSet:function(w){return null!=w},isTypeof:c,isPropertyTypeof:d,_private:{dataCallsOnHold:new Map,dataChannelInvitations:new Map,dataCallsFileInfo:new Map}}},9662:(F,Y,e)=>{var i=e(7854),c=e(614),d=e(6330),L=i.TypeError;F.exports=function(w){if(c(w))return w;throw L(d(w)+" is not a function")}},9483:(F,Y,e)=>{var i=e(7854),c=e(4411),d=e(6330),L=i.TypeError;F.exports=function(w){if(c(w))return w;throw L(d(w)+" is not a constructor")}},6077:(F,Y,e)=>{var i=e(7854),c=e(614),d=i.String,L=i.TypeError;F.exports=function(w){if("object"==typeof w||c(w))return w;throw L("Can't set "+d(w)+" as a prototype")}},1223:(F,Y,e)=>{var i=e(5112),c=e(30),d=e(3070),L=i("unscopables"),w=Array.prototype;null==w[L]&&d.f(w,L,{configurable:!0,value:c(null)}),F.exports=function(A){w[L][A]=!0}},1530:(F,Y,e)=>{"use strict";var i=e(8710).charAt;F.exports=function(c,d,L){return d+(L?i(c,d).length:1)}},5787:(F,Y,e)=>{var i=e(7854),c=e(7976),d=i.TypeError;F.exports=function(L,w){if(c(w,L))return L;throw d("Incorrect invocation")}},9670:(F,Y,e)=>{var i=e(7854),c=e(111),d=i.String,L=i.TypeError;F.exports=function(w){if(c(w))return w;throw L(d(w)+" is not an object")}},4019:F=>{F.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:(F,Y,e)=>{"use strict";var i,c,d,L=e(4019),w=e(9781),A=e(7854),C=e(614),S=e(111),n=e(2597),v=e(648),R=e(6330),p=e(8880),o=e(1320),f=e(3070).f,I=e(7976),l=e(9518),V=e(7674),T=e(5112),b=e(9711),H=A.Int8Array,ne=H&&H.prototype,le=A.Uint8ClampedArray,W=le&&le.prototype,be=H&&l(H),de=ne&&l(ne),ce=Object.prototype,Ee=A.TypeError,Ne=T("toStringTag"),Oe=b("TYPED_ARRAY_TAG"),He=b("TYPED_ARRAY_CONSTRUCTOR"),ke=L&&!!V&&"Opera"!==v(A.opera),ze=!1,we={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},gt={BigInt64Array:8,BigUint64Array:8},ft=function(at){if(!S(at))return!1;var Ze=v(at);return n(we,Ze)||n(gt,Ze)};for(i in we)(d=(c=A[i])&&c.prototype)?p(d,He,c):ke=!1;for(i in gt)(d=(c=A[i])&&c.prototype)&&p(d,He,c);if((!ke||!C(be)||be===Function.prototype)&&(be=function(){throw Ee("Incorrect invocation")},ke))for(i in we)A[i]&&V(A[i],be);if((!ke||!de||de===ce)&&(de=be.prototype,ke))for(i in we)A[i]&&V(A[i].prototype,de);if(ke&&l(W)!==de&&V(W,de),w&&!n(de,Ne))for(i in ze=!0,f(de,Ne,{get:function(){return S(this)?this[Oe]:void 0}}),we)A[i]&&p(A[i],Oe,i);F.exports={NATIVE_ARRAY_BUFFER_VIEWS:ke,TYPED_ARRAY_CONSTRUCTOR:He,TYPED_ARRAY_TAG:ze&&Oe,aTypedArray:function(at){if(ft(at))return at;throw Ee("Target is not a typed array")},aTypedArrayConstructor:function(at){if(C(at)&&(!V||I(be,at)))return at;throw Ee(R(at)+" is not a typed array constructor")},exportTypedArrayMethod:function(at,Ze,ie){if(w){if(ie)for(var bt in we){var Rt=A[bt];if(Rt&&n(Rt.prototype,at))try{delete Rt.prototype[at]}catch(Ct){}}de[at]&&!ie||o(de,at,ie?Ze:ke&&ne[at]||Ze)}},exportTypedArrayStaticMethod:function(at,Ze,ie){var bt,Rt;if(w){if(V){if(ie)for(bt in we)if((Rt=A[bt])&&n(Rt,at))try{delete Rt[at]}catch(Ct){}if(be[at]&&!ie)return;try{return o(be,at,ie?Ze:ke&&be[at]||Ze)}catch(Ct){}}for(bt in we)!(Rt=A[bt])||Rt[at]&&!ie||o(Rt,at,Ze)}},isView:function(at){if(!S(at))return!1;var Ze=v(at);return"DataView"===Ze||n(we,Ze)||n(gt,Ze)},isTypedArray:ft,TypedArray:be,TypedArrayPrototype:de}},3331:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=e(9781),L=e(4019),w=e(6530),A=e(8880),C=e(2248),S=e(7293),n=e(5787),v=e(9303),R=e(7466),p=e(7067),o=e(1179),f=e(9518),I=e(7674),l=e(8006).f,V=e(3070).f,T=e(1285),b=e(206),H=e(8003),ne=e(9909),le=w.PROPER,W=w.CONFIGURABLE,be=ne.get,de=ne.set,ce="ArrayBuffer",Ee="Wrong index",Ne=i.ArrayBuffer,Oe=Ne,He=Oe&&Oe.prototype,ke=i.DataView,ze=ke&&ke.prototype,we=Object.prototype,gt=i.Array,ft=i.RangeError,at=c(T),Ze=c([].reverse),ie=o.pack,bt=o.unpack,Rt=function(a){return[255&a]},Ct=function(a){return[255&a,a>>8&255]},et=function(a){return[255&a,a>>8&255,a>>16&255,a>>24&255]},wt=function(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]},Be=function(a){return ie(a,23,4)},Lt=function(a){return ie(a,52,8)},jt=function(a,m){V(a.prototype,m,{get:function(){return be(this)[m]}})},Ge=function(a,m,_,P){var x=p(_),oe=be(a);if(x+m>oe.byteLength)throw ft(Ee);var K=be(oe.buffer).bytes,X=x+oe.byteOffset,me=b(K,X,X+m);return P?me:Ze(me)},Pt=function(a,m,_,P,x,oe){var K=p(_),X=be(a);if(K+m>X.byteLength)throw ft(Ee);for(var me=be(X.buffer).bytes,Q=K+X.byteOffset,re=P(+x),ye=0;ye<m;ye++)me[Q+ye]=re[oe?ye:m-ye-1]};if(L){var z=le&&Ne.name!==ce;if(S(function(){Ne(1)})&&S(function(){new Ne(-1)})&&!S(function(){return new Ne,new Ne(1.5),new Ne(NaN),z&&!W}))z&&W&&A(Ne,"name",ce);else{(Oe=function(a){return n(this,He),new Ne(p(a))}).prototype=He;for(var M,t=l(Ne),u=0;t.length>u;)(M=t[u++])in Oe||A(Oe,M,Ne[M]);He.constructor=Oe}I&&f(ze)!==we&&I(ze,we);var h=new ke(new Oe(2)),y=c(ze.setInt8);h.setInt8(0,2147483648),h.setInt8(1,2147483649),!h.getInt8(0)&&h.getInt8(1)||C(ze,{setInt8:function(a,m){y(this,a,m<<24>>24)},setUint8:function(a,m){y(this,a,m<<24>>24)}},{unsafe:!0})}else He=(Oe=function(a){n(this,He);var m=p(a);de(this,{bytes:at(gt(m),0),byteLength:m}),d||(this.byteLength=m)}).prototype,ze=(ke=function(a,m,_){n(this,ze),n(a,He);var P=be(a).byteLength,x=v(m);if(x<0||x>P)throw ft("Wrong offset");if(x+(_=void 0===_?P-x:R(_))>P)throw ft("Wrong length");de(this,{buffer:a,byteLength:_,byteOffset:x}),d||(this.buffer=a,this.byteLength=_,this.byteOffset=x)}).prototype,d&&(jt(Oe,"byteLength"),jt(ke,"buffer"),jt(ke,"byteLength"),jt(ke,"byteOffset")),C(ze,{getInt8:function(a){return Ge(this,1,a)[0]<<24>>24},getUint8:function(a){return Ge(this,1,a)[0]},getInt16:function(a){var m=Ge(this,2,a,arguments.length>1?arguments[1]:void 0);return(m[1]<<8|m[0])<<16>>16},getUint16:function(a){var m=Ge(this,2,a,arguments.length>1?arguments[1]:void 0);return m[1]<<8|m[0]},getInt32:function(a){return wt(Ge(this,4,a,arguments.length>1?arguments[1]:void 0))},getUint32:function(a){return wt(Ge(this,4,a,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(a){return bt(Ge(this,4,a,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(a){return bt(Ge(this,8,a,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(a,m){Pt(this,1,a,Rt,m)},setUint8:function(a,m){Pt(this,1,a,Rt,m)},setInt16:function(a,m){Pt(this,2,a,Ct,m,arguments.length>2?arguments[2]:void 0)},setUint16:function(a,m){Pt(this,2,a,Ct,m,arguments.length>2?arguments[2]:void 0)},setInt32:function(a,m){Pt(this,4,a,et,m,arguments.length>2?arguments[2]:void 0)},setUint32:function(a,m){Pt(this,4,a,et,m,arguments.length>2?arguments[2]:void 0)},setFloat32:function(a,m){Pt(this,4,a,Be,m,arguments.length>2?arguments[2]:void 0)},setFloat64:function(a,m){Pt(this,8,a,Lt,m,arguments.length>2?arguments[2]:void 0)}});H(Oe,ce),H(ke,"DataView"),F.exports={ArrayBuffer:Oe,DataView:ke}},1048:(F,Y,e)=>{"use strict";var i=e(7908),c=e(1400),d=e(6244),L=Math.min;F.exports=[].copyWithin||function(w,A){var C=i(this),S=d(C),n=c(w,S),v=c(A,S),R=arguments.length>2?arguments[2]:void 0,p=L((void 0===R?S:c(R,S))-v,S-n),o=1;for(v<n&&n<v+p&&(o=-1,v+=p-1,n+=p-1);p-- >0;)v in C?C[n]=C[v]:delete C[n],n+=o,v+=o;return C}},1285:(F,Y,e)=>{"use strict";var i=e(7908),c=e(1400),d=e(6244);F.exports=function(L){for(var w=i(this),A=d(w),C=arguments.length,S=c(C>1?arguments[1]:void 0,A),n=C>2?arguments[2]:void 0,v=void 0===n?A:c(n,A);v>S;)w[S++]=L;return w}},8533:(F,Y,e)=>{"use strict";var i=e(2092).forEach,c=e(9341)("forEach");F.exports=c?[].forEach:function(d){return i(this,d,arguments.length>1?arguments[1]:void 0)}},7745:F=>{F.exports=function(Y,e){for(var i=0,c=e.length,d=new Y(c);c>i;)d[i]=e[i++];return d}},8457:(F,Y,e)=>{"use strict";var i=e(7854),c=e(9974),d=e(6916),L=e(7908),w=e(3411),A=e(7659),C=e(4411),S=e(6244),n=e(6135),v=e(8554),R=e(1246),p=i.Array;F.exports=function(o){var f=L(o),I=C(this),l=arguments.length,V=l>1?arguments[1]:void 0,T=void 0!==V;T&&(V=c(V,l>2?arguments[2]:void 0));var b,H,ne,le,W,be,de=R(f),ce=0;if(!de||this==p&&A(de))for(b=S(f),H=I?new this(b):p(b);b>ce;ce++)be=T?V(f[ce],ce):f[ce],n(H,ce,be);else for(W=(le=v(f,de)).next,H=I?new this:[];!(ne=d(W,le)).done;ce++)be=T?w(le,V,[ne.value,ce],!0):ne.value,n(H,ce,be);return H.length=ce,H}},1318:(F,Y,e)=>{var i=e(5656),c=e(1400),d=e(6244),L=function(w){return function(A,C,S){var n,v=i(A),R=d(v),p=c(S,R);if(w&&C!=C){for(;R>p;)if((n=v[p++])!=n)return!0}else for(;R>p;p++)if((w||p in v)&&v[p]===C)return w||p||0;return!w&&-1}};F.exports={includes:L(!0),indexOf:L(!1)}},2092:(F,Y,e)=>{var i=e(9974),c=e(1702),d=e(8361),L=e(7908),w=e(6244),A=e(5417),C=c([].push),S=function(n){var v=1==n,R=2==n,p=3==n,o=4==n,f=6==n,I=7==n,l=5==n||f;return function(V,T,b,H){for(var ne,le,W=L(V),be=d(W),de=i(T,b),ce=w(be),Ee=0,Ne=H||A,Oe=v?Ne(V,ce):R||I?Ne(V,0):void 0;ce>Ee;Ee++)if((l||Ee in be)&&(le=de(ne=be[Ee],Ee,W),n))if(v)Oe[Ee]=le;else if(le)switch(n){case 3:return!0;case 5:return ne;case 6:return Ee;case 2:C(Oe,ne)}else switch(n){case 4:return!1;case 7:C(Oe,ne)}return f?-1:p||o?o:Oe}};F.exports={forEach:S(0),map:S(1),filter:S(2),some:S(3),every:S(4),find:S(5),findIndex:S(6),filterReject:S(7)}},6583:(F,Y,e)=>{"use strict";var i=e(2104),c=e(5656),d=e(9303),L=e(6244),w=e(9341),A=Math.min,C=[].lastIndexOf,S=!!C&&1/[1].lastIndexOf(1,-0)<0,n=w("lastIndexOf");F.exports=S||!n?function(R){if(S)return i(C,this,arguments)||0;var p=c(this),o=L(p),f=o-1;for(arguments.length>1&&(f=A(f,d(arguments[1]))),f<0&&(f=o+f);f>=0;f--)if(f in p&&p[f]===R)return f||0;return-1}:C},1194:(F,Y,e)=>{var i=e(7293),c=e(5112),d=e(7392),L=c("species");F.exports=function(w){return d>=51||!i(function(){var A=[];return(A.constructor={})[L]=function(){return{foo:1}},1!==A[w](Boolean).foo})}},9341:(F,Y,e)=>{"use strict";var i=e(7293);F.exports=function(c,d){var L=[][c];return!!L&&i(function(){L.call(null,d||function(){throw 1},1)})}},3671:(F,Y,e)=>{var i=e(7854),c=e(9662),d=e(7908),L=e(8361),w=e(6244),A=i.TypeError,C=function(S){return function(n,v,R,p){c(v);var o=d(n),f=L(o),I=w(o),l=S?I-1:0,V=S?-1:1;if(R<2)for(;;){if(l in f){p=f[l],l+=V;break}if(l+=V,S?l<0:I<=l)throw A("Reduce of empty array with no initial value")}for(;S?l>=0:I>l;l+=V)l in f&&(p=v(p,f[l],l,o));return p}};F.exports={left:C(!1),right:C(!0)}},206:(F,Y,e)=>{var i=e(1702);F.exports=i([].slice)},4362:(F,Y,e)=>{var i=e(206),c=Math.floor,d=function(A,C){var S=A.length,n=c(S/2);return S<8?L(A,C):w(A,d(i(A,0,n),C),d(i(A,n),C),C)},L=function(A,C){for(var S,n,v=A.length,R=1;R<v;){for(n=R,S=A[R];n&&C(A[n-1],S)>0;)A[n]=A[--n];n!==R++&&(A[n]=S)}return A},w=function(A,C,S,n){for(var v=C.length,R=S.length,p=0,o=0;p<v||o<R;)A[p+o]=p<v&&o<R?n(C[p],S[o])<=0?C[p++]:S[o++]:p<v?C[p++]:S[o++];return A};F.exports=d},7475:(F,Y,e)=>{var i=e(7854),c=e(3157),d=e(4411),L=e(111),w=e(5112)("species"),A=i.Array;F.exports=function(C){var S;return c(C)&&(d(S=C.constructor)&&(S===A||c(S.prototype))||L(S)&&null===(S=S[w]))&&(S=void 0),void 0===S?A:S}},5417:(F,Y,e)=>{var i=e(7475);F.exports=function(c,d){return new(i(c))(0===d?0:d)}},3411:(F,Y,e)=>{var i=e(9670),c=e(9212);F.exports=function(d,L,w,A){try{return A?L(i(w)[0],w[1]):L(w)}catch(C){c(d,"throw",C)}}},7072:(F,Y,e)=>{var i=e(5112)("iterator"),c=!1;try{var d=0,L={next:function(){return{done:!!d++}},return:function(){c=!0}};L[i]=function(){return this},Array.from(L,function(){throw 2})}catch(w){}F.exports=function(w,A){if(!A&&!c)return!1;var C=!1;try{var S={};S[i]=function(){return{next:function(){return{done:C=!0}}}},w(S)}catch(n){}return C}},4326:(F,Y,e)=>{var i=e(1702),c=i({}.toString),d=i("".slice);F.exports=function(L){return d(c(L),8,-1)}},648:(F,Y,e)=>{var i=e(7854),c=e(1694),d=e(614),L=e(4326),w=e(5112)("toStringTag"),A=i.Object,C="Arguments"==L(function(){return arguments}());F.exports=c?L:function(S){var n,v,R;return void 0===S?"Undefined":null===S?"Null":"string"==typeof(v=function(p,o){try{return p[o]}catch(f){}}(n=A(S),w))?v:C?L(n):"Object"==(R=L(n))&&d(n.callee)?"Arguments":R}},5631:(F,Y,e)=>{"use strict";var i=e(3070).f,c=e(30),d=e(2248),L=e(9974),w=e(5787),A=e(408),C=e(654),S=e(6340),n=e(9781),v=e(2423).fastKey,R=e(9909),p=R.set,o=R.getterFor;F.exports={getConstructor:function(f,I,l,V){var T=f(function(W,be){w(W,b),p(W,{type:I,index:c(null),first:void 0,last:void 0,size:0}),n||(W.size=0),null!=be&&A(be,W[V],{that:W,AS_ENTRIES:l})}),b=T.prototype,H=o(I),ne=function(W,be,de){var ce,Ee,Ne=H(W),Oe=le(W,be);return Oe?Oe.value=de:(Ne.last=Oe={index:Ee=v(be,!0),key:be,value:de,previous:ce=Ne.last,next:void 0,removed:!1},Ne.first||(Ne.first=Oe),ce&&(ce.next=Oe),n?Ne.size++:W.size++,"F"!==Ee&&(Ne.index[Ee]=Oe)),W},le=function(W,be){var de,ce=H(W),Ee=v(be);if("F"!==Ee)return ce.index[Ee];for(de=ce.first;de;de=de.next)if(de.key==be)return de};return d(b,{clear:function(){for(var W=H(this),be=W.index,de=W.first;de;)de.removed=!0,de.previous&&(de.previous=de.previous.next=void 0),delete be[de.index],de=de.next;W.first=W.last=void 0,n?W.size=0:this.size=0},delete:function(W){var de=H(this),ce=le(this,W);if(ce){var Ee=ce.next,Ne=ce.previous;delete de.index[ce.index],ce.removed=!0,Ne&&(Ne.next=Ee),Ee&&(Ee.previous=Ne),de.first==ce&&(de.first=Ee),de.last==ce&&(de.last=Ne),n?de.size--:this.size--}return!!ce},forEach:function(W){for(var be,de=H(this),ce=L(W,arguments.length>1?arguments[1]:void 0);be=be?be.next:de.first;)for(ce(be.value,be.key,this);be&&be.removed;)be=be.previous},has:function(W){return!!le(this,W)}}),d(b,l?{get:function(W){var be=le(this,W);return be&&be.value},set:function(W,be){return ne(this,0===W?0:W,be)}}:{add:function(W){return ne(this,W=0===W?0:W,W)}}),n&&i(b,"size",{get:function(){return H(this).size}}),T},setStrong:function(f,I,l){var V=I+" Iterator",T=o(I),b=o(V);C(f,I,function(H,ne){p(this,{type:V,target:H,state:T(H),kind:ne,last:void 0})},function(){for(var H=b(this),ne=H.kind,le=H.last;le&&le.removed;)le=le.previous;return H.target&&(H.last=le=le?le.next:H.state.first)?"keys"==ne?{value:le.key,done:!1}:"values"==ne?{value:le.value,done:!1}:{value:[le.key,le.value],done:!1}:(H.target=void 0,{value:void 0,done:!0})},l?"entries":"values",!l,!0),S(I)}}},9320:(F,Y,e)=>{"use strict";var i=e(1702),c=e(2248),d=e(2423).getWeakData,L=e(9670),w=e(111),A=e(5787),C=e(408),S=e(2092),n=e(2597),v=e(9909),R=v.set,p=v.getterFor,o=S.find,f=S.findIndex,I=i([].splice),l=0,V=function(H){return H.frozen||(H.frozen=new T)},T=function(){this.entries=[]},b=function(H,ne){return o(H.entries,function(le){return le[0]===ne})};T.prototype={get:function(H){var ne=b(this,H);if(ne)return ne[1]},has:function(H){return!!b(this,H)},set:function(H,ne){var le=b(this,H);le?le[1]=ne:this.entries.push([H,ne])},delete:function(H){var ne=f(this.entries,function(le){return le[0]===H});return~ne&&I(this.entries,ne,1),!!~ne}},F.exports={getConstructor:function(H,ne,le,W){var be=H(function(Ne,Oe){A(Ne,de),R(Ne,{type:ne,id:l++,frozen:void 0}),null!=Oe&&C(Oe,Ne[W],{that:Ne,AS_ENTRIES:le})}),de=be.prototype,ce=p(ne),Ee=function(Ne,Oe,He){var ke=ce(Ne),ze=d(L(Oe),!0);return!0===ze?V(ke).set(Oe,He):ze[ke.id]=He,Ne};return c(de,{delete:function(Ne){var Oe=ce(this);if(!w(Ne))return!1;var He=d(Ne);return!0===He?V(Oe).delete(Ne):He&&n(He,Oe.id)&&delete He[Oe.id]},has:function(Ne){var Oe=ce(this);if(!w(Ne))return!1;var He=d(Ne);return!0===He?V(Oe).has(Ne):He&&n(He,Oe.id)}}),c(de,le?{get:function(Ne){var Oe=ce(this);if(w(Ne)){var He=d(Ne);return!0===He?V(Oe).get(Ne):He?He[Oe.id]:void 0}},set:function(Ne,Oe){return Ee(this,Ne,Oe)}}:{add:function(Ne){return Ee(this,Ne,!0)}}),be}}},7710:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(1702),L=e(4705),w=e(1320),A=e(2423),C=e(408),S=e(5787),n=e(614),v=e(111),R=e(7293),p=e(7072),o=e(8003),f=e(9587);F.exports=function(I,l,V){var T=-1!==I.indexOf("Map"),b=-1!==I.indexOf("Weak"),H=T?"set":"add",ne=c[I],le=ne&&ne.prototype,W=ne,be={},de=function(ke){var ze=d(le[ke]);w(le,ke,"add"==ke?function(we){return ze(this,0===we?0:we),this}:"delete"==ke?function(we){return!(b&&!v(we))&&ze(this,0===we?0:we)}:"get"==ke?function(we){return b&&!v(we)?void 0:ze(this,0===we?0:we)}:"has"==ke?function(we){return!(b&&!v(we))&&ze(this,0===we?0:we)}:function(we,gt){return ze(this,0===we?0:we,gt),this})};if(L(I,!n(ne)||!(b||le.forEach&&!R(function(){(new ne).entries().next()}))))W=V.getConstructor(l,I,T,H),A.enable();else if(L(I,!0)){var ce=new W,Ee=ce[H](b?{}:-0,1)!=ce,Ne=R(function(){ce.has(1)}),Oe=p(function(ke){new ne(ke)}),He=!b&&R(function(){for(var ke=new ne,ze=5;ze--;)ke[H](ze,ze);return!ke.has(-0)});Oe||((W=l(function(ke,ze){S(ke,le);var we=f(new ne,ke,W);return null!=ze&&C(ze,we[H],{that:we,AS_ENTRIES:T}),we})).prototype=le,le.constructor=W),(Ne||He)&&(de("delete"),de("has"),T&&de("get")),(He||Ee)&&de(H),b&&le.clear&&delete le.clear}return be[I]=W,i({global:!0,forced:W!=ne},be),o(W,I),b||V.setStrong(W,I,T),W}},9920:(F,Y,e)=>{var i=e(2597),c=e(3887),d=e(1236),L=e(3070);F.exports=function(w,A){for(var C=c(A),S=L.f,n=d.f,v=0;v<C.length;v++){var R=C[v];i(w,R)||S(w,R,n(A,R))}}},4964:(F,Y,e)=>{var i=e(5112)("match");F.exports=function(c){var d=/./;try{"/./"[c](d)}catch(L){try{return d[i]=!1,"/./"[c](d)}catch(w){}}return!1}},8544:(F,Y,e)=>{var i=e(7293);F.exports=!i(function(){function c(){}return c.prototype.constructor=null,Object.getPrototypeOf(new c)!==c.prototype})},4994:(F,Y,e)=>{"use strict";var i=e(3383).IteratorPrototype,c=e(30),d=e(9114),L=e(8003),w=e(7497),A=function(){return this};F.exports=function(C,S,n){var v=S+" Iterator";return C.prototype=c(i,{next:d(1,n)}),L(C,v,!1,!0),w[v]=A,C}},8880:(F,Y,e)=>{var i=e(9781),c=e(3070),d=e(9114);F.exports=i?function(L,w,A){return c.f(L,w,d(1,A))}:function(L,w,A){return L[w]=A,L}},9114:F=>{F.exports=function(Y,e){return{enumerable:!(1&Y),configurable:!(2&Y),writable:!(4&Y),value:e}}},6135:(F,Y,e)=>{"use strict";var i=e(4948),c=e(3070),d=e(9114);F.exports=function(L,w,A){var C=i(w);C in L?c.f(L,C,d(0,A)):L[C]=A}},5573:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=e(7293),L=e(6650).start,w=i.RangeError,A=Math.abs,C=Date.prototype,S=C.toISOString,n=c(C.getTime),v=c(C.getUTCDate),R=c(C.getUTCFullYear),p=c(C.getUTCHours),o=c(C.getUTCMilliseconds),f=c(C.getUTCMinutes),I=c(C.getUTCMonth),l=c(C.getUTCSeconds);F.exports=d(function(){return"0385-07-25T07:06:39.999Z"!=S.call(new Date(-50000000000001))})||!d(function(){S.call(new Date(NaN))})?function(){if(!isFinite(n(this)))throw w("Invalid time value");var V=this,T=R(V),b=o(V),H=T<0?"-":T>9999?"+":"";return H+L(A(T),H?6:4,0)+"-"+L(I(V)+1,2,0)+"-"+L(v(V),2,0)+"T"+L(p(V),2,0)+":"+L(f(V),2,0)+":"+L(l(V),2,0)+"."+L(b,3,0)+"Z"}:S},654:(F,Y,e)=>{"use strict";var i=e(2109),c=e(6916),d=e(1913),L=e(6530),w=e(614),A=e(4994),C=e(9518),S=e(7674),n=e(8003),v=e(8880),R=e(1320),p=e(5112),o=e(7497),f=e(3383),I=L.PROPER,l=L.CONFIGURABLE,V=f.IteratorPrototype,T=f.BUGGY_SAFARI_ITERATORS,b=p("iterator"),H="keys",ne="values",le="entries",W=function(){return this};F.exports=function(be,de,ce,Ee,Ne,Oe,He){A(ce,de,Ee);var ke,ze,we,gt=function(Ct){if(Ct===Ne&&bt)return bt;if(!T&&Ct in Ze)return Ze[Ct];switch(Ct){case H:case ne:case le:return function(){return new ce(this,Ct)}}return function(){return new ce(this)}},ft=de+" Iterator",at=!1,Ze=be.prototype,ie=Ze[b]||Ze["@@iterator"]||Ne&&Ze[Ne],bt=!T&&ie||gt(Ne),Rt="Array"==de&&Ze.entries||ie;if(Rt&&(ke=C(Rt.call(new be)))!==Object.prototype&&ke.next&&(d||C(ke)===V||(S?S(ke,V):w(ke[b])||R(ke,b,W)),n(ke,ft,!0,!0),d&&(o[ft]=W)),I&&Ne==ne&&ie&&ie.name!==ne&&(!d&&l?v(Ze,"name",ne):(at=!0,bt=function(){return c(ie,this)})),Ne)if(ze={values:gt(ne),keys:Oe?bt:gt(H),entries:gt(le)},He)for(we in ze)(T||at||!(we in Ze))&&R(Ze,we,ze[we]);else i({target:de,proto:!0,forced:T||at},ze);return d&&!He||Ze[b]===bt||R(Ze,b,bt,{name:Ne}),o[de]=bt,ze}},7235:(F,Y,e)=>{var i=e(857),c=e(2597),d=e(6061),L=e(3070).f;F.exports=function(w){var A=i.Symbol||(i.Symbol={});c(A,w)||L(A,w,{value:d.f(w)})}},9781:(F,Y,e)=>{var i=e(7293);F.exports=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},317:(F,Y,e)=>{var i=e(7854),c=e(111),d=i.document,L=c(d)&&c(d.createElement);F.exports=function(w){return L?d.createElement(w):{}}},8324:F=>{F.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(F,Y,e)=>{var i=e(317)("span").classList,c=i&&i.constructor&&i.constructor.prototype;F.exports=c===Object.prototype?void 0:c},8886:(F,Y,e)=>{var i=e(8113).match(/firefox\/(\d+)/i);F.exports=!!i&&+i[1]},7871:F=>{F.exports="object"==typeof window},256:(F,Y,e)=>{var i=e(8113);F.exports=/MSIE|Trident/.test(i)},1528:(F,Y,e)=>{var i=e(8113),c=e(7854);F.exports=/ipad|iphone|ipod/i.test(i)&&void 0!==c.Pebble},6833:(F,Y,e)=>{var i=e(8113);F.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},2805:(F,Y,e)=>{var i=e(4326),c=e(7854);F.exports="process"==i(c.process)},1036:(F,Y,e)=>{var i=e(8113);F.exports=/web0s(?!.*chrome)/i.test(i)},8113:(F,Y,e)=>{var i=e(5005);F.exports=i("navigator","userAgent")||""},7392:(F,Y,e)=>{var i,c,d=e(7854),L=e(8113),w=d.process,A=d.Deno,C=w&&w.versions||A&&A.version,S=C&&C.v8;S&&(c=(i=S.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!c&&L&&(!(i=L.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=L.match(/Chrome\/(\d+)/))&&(c=+i[1]),F.exports=c},8008:(F,Y,e)=>{var i=e(8113).match(/AppleWebKit\/(\d+)\./);F.exports=!!i&&+i[1]},748:F=>{F.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(F,Y,e)=>{var i=e(7854),c=e(1236).f,d=e(8880),L=e(1320),w=e(3505),A=e(9920),C=e(4705);F.exports=function(S,n){var v,R,p,o,f,I=S.target,l=S.global,V=S.stat;if(v=l?i:V?i[I]||w(I,{}):(i[I]||{}).prototype)for(R in n){if(o=n[R],p=S.noTargetGet?(f=c(v,R))&&f.value:v[R],!C(l?R:I+(V?".":"#")+R,S.forced)&&void 0!==p){if(typeof o==typeof p)continue;A(o,p)}(S.sham||p&&p.sham)&&d(o,"sham",!0),L(v,R,o,S)}}},7293:F=>{F.exports=function(Y){try{return!!Y()}catch(e){return!0}}},7007:(F,Y,e)=>{"use strict";e(4916);var i=e(1702),c=e(1320),d=e(2261),L=e(7293),w=e(5112),A=e(8880),C=w("species"),S=RegExp.prototype;F.exports=function(n,v,R,p){var o=w(n),f=!L(function(){var T={};return T[o]=function(){return 7},7!=""[n](T)}),I=f&&!L(function(){var T=!1,b=/a/;return"split"===n&&((b={}).constructor={},b.constructor[C]=function(){return b},b.flags="",b[o]=/./[o]),b.exec=function(){return T=!0,null},b[o](""),!T});if(!f||!I||R){var l=i(/./[o]),V=v(o,""[n],function(T,b,H,ne,le){var W=i(T),be=b.exec;return be===d||be===S.exec?f&&!le?{done:!0,value:l(b,H,ne)}:{done:!0,value:W(H,b,ne)}:{done:!1}});c(String.prototype,n,V[0]),c(S,o,V[1])}p&&A(S[o],"sham",!0)}},6677:(F,Y,e)=>{var i=e(7293);F.exports=!i(function(){return Object.isExtensible(Object.preventExtensions({}))})},2104:F=>{var Y=Function.prototype,e=Y.apply,c=Y.call;F.exports="object"==typeof Reflect&&Reflect.apply||(Y.bind?c.bind(e):function(){return c.apply(e,arguments)})},9974:(F,Y,e)=>{var i=e(1702),c=e(9662),d=i(i.bind);F.exports=function(L,w){return c(L),void 0===w?L:d?d(L,w):function(){return L.apply(w,arguments)}}},7065:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=e(9662),L=e(111),w=e(2597),A=e(206),C=i.Function,S=c([].concat),n=c([].join),v={},R=function(p,o,f){if(!w(v,o)){for(var I=[],l=0;l<o;l++)I[l]="a["+l+"]";v[o]=C("C,a","return new C("+n(I,",")+")")}return v[o](p,f)};F.exports=C.bind||function(p){var o=d(this),f=o.prototype,I=A(arguments,1),l=function(){var V=S(I,A(arguments));return this instanceof l?R(o,V.length,V):o.apply(p,V)};return L(f)&&(l.prototype=f),l}},6916:F=>{var Y=Function.prototype.call;F.exports=Y.bind?Y.bind(Y):function(){return Y.apply(Y,arguments)}},6530:(F,Y,e)=>{var i=e(9781),c=e(2597),d=Function.prototype,L=i&&Object.getOwnPropertyDescriptor,w=c(d,"name"),A=w&&"something"===function(){}.name,C=w&&(!i||i&&L(d,"name").configurable);F.exports={EXISTS:w,PROPER:A,CONFIGURABLE:C}},1702:F=>{var Y=Function.prototype,e=Y.bind,i=Y.call,c=e&&e.bind(i);F.exports=e?function(d){return d&&c(i,d)}:function(d){return d&&function(){return i.apply(d,arguments)}}},5005:(F,Y,e)=>{var i=e(7854),c=e(614),d=function(L){return c(L)?L:void 0};F.exports=function(L,w){return arguments.length<2?d(i[L]):i[L]&&i[L][w]}},1246:(F,Y,e)=>{var i=e(648),c=e(8173),d=e(7497),L=e(5112)("iterator");F.exports=function(w){if(null!=w)return c(w,L)||c(w,"@@iterator")||d[i(w)]}},8554:(F,Y,e)=>{var i=e(7854),c=e(6916),d=e(9662),L=e(9670),w=e(6330),A=e(1246),C=i.TypeError;F.exports=function(S,n){var v=arguments.length<2?A(S):n;if(d(v))return L(c(v,S));throw C(w(S)+" is not iterable")}},8173:(F,Y,e)=>{var i=e(9662);F.exports=function(c,d){var L=c[d];return null==L?void 0:i(L)}},647:(F,Y,e)=>{var i=e(1702),c=e(7908),d=Math.floor,L=i("".charAt),w=i("".replace),A=i("".slice),C=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,S=/\$([$&'`]|\d{1,2})/g;F.exports=function(n,v,R,p,o,f){var I=R+n.length,l=p.length,V=S;return void 0!==o&&(o=c(o),V=C),w(f,V,function(T,b){var H;switch(L(b,0)){case"$":return"$";case"&":return n;case"`":return A(v,0,R);case"'":return A(v,I);case"<":H=o[A(b,1,-1)];break;default:var ne=+b;if(0===ne)return T;if(ne>l){var le=d(ne/10);return 0===le?T:le<=l?void 0===p[le-1]?L(b,1):p[le-1]+L(b,1):T}H=p[ne-1]}return void 0===H?"":H})}},7854:(F,Y,e)=>{var i=function(c){return c&&c.Math==Math&&c};F.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof e.g&&e.g)||function(){return this}()||Function("return this")()},2597:(F,Y,e)=>{var i=e(1702),c=e(7908),d=i({}.hasOwnProperty);F.exports=Object.hasOwn||function(L,w){return d(c(L),w)}},3501:F=>{F.exports={}},842:(F,Y,e)=>{var i=e(7854);F.exports=function(c,d){var L=i.console;L&&L.error&&(1==arguments.length?L.error(c):L.error(c,d))}},490:(F,Y,e)=>{var i=e(5005);F.exports=i("document","documentElement")},4664:(F,Y,e)=>{var i=e(9781),c=e(7293),d=e(317);F.exports=!i&&!c(function(){return 7!=Object.defineProperty(d("div"),"a",{get:function(){return 7}}).a})},1179:(F,Y,e)=>{var i=e(7854).Array,c=Math.abs,d=Math.pow,L=Math.floor,w=Math.log,A=Math.LN2;F.exports={pack:function(C,S,n){var v,R,p,o=i(n),f=8*n-S-1,I=(1<<f)-1,l=I>>1,V=23===S?d(2,-24)-d(2,-77):0,T=C<0||0===C&&1/C<0?1:0,b=0;for((C=c(C))!=C||C===1/0?(R=C!=C?1:0,v=I):(v=L(w(C)/A),C*(p=d(2,-v))<1&&(v--,p*=2),(C+=v+l>=1?V/p:V*d(2,1-l))*p>=2&&(v++,p/=2),v+l>=I?(R=0,v=I):v+l>=1?(R=(C*p-1)*d(2,S),v+=l):(R=C*d(2,l-1)*d(2,S),v=0));S>=8;o[b++]=255&R,R/=256,S-=8);for(v=v<<S|R,f+=S;f>0;o[b++]=255&v,v/=256,f-=8);return o[--b]|=128*T,o},unpack:function(C,S){var n,v=C.length,R=8*v-S-1,p=(1<<R)-1,o=p>>1,f=R-7,I=v-1,l=C[I--],V=127&l;for(l>>=7;f>0;V=256*V+C[I],I--,f-=8);for(n=V&(1<<-f)-1,V>>=-f,f+=S;f>0;n=256*n+C[I],I--,f-=8);if(0===V)V=1-o;else{if(V===p)return n?NaN:l?-1/0:1/0;n+=d(2,S),V-=o}return(l?-1:1)*n*d(2,V-S)}}},8361:(F,Y,e)=>{var i=e(7854),c=e(1702),d=e(7293),L=e(4326),w=i.Object,A=c("".split);F.exports=d(function(){return!w("z").propertyIsEnumerable(0)})?function(C){return"String"==L(C)?A(C,""):w(C)}:w},9587:(F,Y,e)=>{var i=e(614),c=e(111),d=e(7674);F.exports=function(L,w,A){var C,S;return d&&i(C=w.constructor)&&C!==A&&c(S=C.prototype)&&S!==A.prototype&&d(L,S),L}},2788:(F,Y,e)=>{var i=e(1702),c=e(614),d=e(5465),L=i(Function.toString);c(d.inspectSource)||(d.inspectSource=function(w){return L(w)}),F.exports=d.inspectSource},2423:(F,Y,e)=>{var i=e(2109),c=e(1702),d=e(3501),L=e(111),w=e(2597),A=e(3070).f,C=e(8006),S=e(1156),n=e(9711),v=e(6677),R=!1,p=n("meta"),o=0,f=Object.isExtensible||function(){return!0},I=function(V){A(V,p,{value:{objectID:"O"+o++,weakData:{}}})},l=F.exports={enable:function(){l.enable=function(){},R=!0;var V=C.f,T=c([].splice),b={};b[p]=1,V(b).length&&(C.f=function(H){for(var ne=V(H),le=0,W=ne.length;le<W;le++)if(ne[le]===p){T(ne,le,1);break}return ne},i({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:S.f}))},fastKey:function(V,T){if(!L(V))return"symbol"==typeof V?V:("string"==typeof V?"S":"P")+V;if(!w(V,p)){if(!f(V))return"F";if(!T)return"E";I(V)}return V[p].objectID},getWeakData:function(V,T){if(!w(V,p)){if(!f(V))return!0;if(!T)return!1;I(V)}return V[p].weakData},onFreeze:function(V){return v&&R&&f(V)&&!w(V,p)&&I(V),V}};d[p]=!0},9909:(F,Y,e)=>{var i,c,d,L=e(8536),w=e(7854),A=e(1702),C=e(111),S=e(8880),n=e(2597),v=e(5465),R=e(6200),p=e(3501),o="Object already initialized",f=w.TypeError;if(L||v.state){var l=v.state||(v.state=new(0,w.WeakMap)),V=A(l.get),T=A(l.has),b=A(l.set);i=function(ne,le){if(T(l,ne))throw new f(o);return le.facade=ne,b(l,ne,le),le},c=function(ne){return V(l,ne)||{}},d=function(ne){return T(l,ne)}}else{var H=R("state");p[H]=!0,i=function(ne,le){if(n(ne,H))throw new f(o);return le.facade=ne,S(ne,H,le),le},c=function(ne){return n(ne,H)?ne[H]:{}},d=function(ne){return n(ne,H)}}F.exports={set:i,get:c,has:d,enforce:function(ne){return d(ne)?c(ne):i(ne,{})},getterFor:function(ne){return function(le){var W;if(!C(le)||(W=c(le)).type!==ne)throw f("Incompatible receiver, "+ne+" required");return W}}}},7659:(F,Y,e)=>{var i=e(5112),c=e(7497),d=i("iterator"),L=Array.prototype;F.exports=function(w){return void 0!==w&&(c.Array===w||L[d]===w)}},3157:(F,Y,e)=>{var i=e(4326);F.exports=Array.isArray||function(c){return"Array"==i(c)}},614:F=>{F.exports=function(Y){return"function"==typeof Y}},4411:(F,Y,e)=>{var i=e(1702),c=e(7293),d=e(614),L=e(648),w=e(5005),A=e(2788),C=function(){},S=[],n=w("Reflect","construct"),v=/^\s*(?:class|function)\b/,R=i(v.exec),p=!v.exec(C),o=function(f){if(!d(f))return!1;try{return n(C,S,f),!0}catch(I){return!1}};F.exports=!n||c(function(){var f;return o(o.call)||!o(Object)||!o(function(){f=!0})||f})?function(f){if(!d(f))return!1;switch(L(f)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return p||!!R(v,A(f))}:o},5032:(F,Y,e)=>{var i=e(2597);F.exports=function(c){return void 0!==c&&(i(c,"value")||i(c,"writable"))}},4705:(F,Y,e)=>{var i=e(7293),c=e(614),d=/#|\.prototype\./,L=function(n,v){var R=A[w(n)];return R==S||R!=C&&(c(v)?i(v):!!v)},w=L.normalize=function(n){return String(n).replace(d,".").toLowerCase()},A=L.data={},C=L.NATIVE="N",S=L.POLYFILL="P";F.exports=L},5988:(F,Y,e)=>{var i=e(111),c=Math.floor;F.exports=Number.isInteger||function(d){return!i(d)&&isFinite(d)&&c(d)===d}},111:(F,Y,e)=>{var i=e(614);F.exports=function(c){return"object"==typeof c?null!==c:i(c)}},1913:F=>{F.exports=!1},7850:(F,Y,e)=>{var i=e(111),c=e(4326),d=e(5112)("match");F.exports=function(L){var w;return i(L)&&(void 0!==(w=L[d])?!!w:"RegExp"==c(L))}},2190:(F,Y,e)=>{var i=e(7854),c=e(5005),d=e(614),L=e(7976),w=e(3307),A=i.Object;F.exports=w?function(C){return"symbol"==typeof C}:function(C){var S=c("Symbol");return d(S)&&L(S.prototype,A(C))}},408:(F,Y,e)=>{var i=e(7854),c=e(9974),d=e(6916),L=e(9670),w=e(6330),A=e(7659),C=e(6244),S=e(7976),n=e(8554),v=e(1246),R=e(9212),p=i.TypeError,o=function(I,l){this.stopped=I,this.result=l},f=o.prototype;F.exports=function(I,l,V){var T,b,H,ne,le,W,be,ce=!(!V||!V.AS_ENTRIES),Ee=!(!V||!V.IS_ITERATOR),Ne=!(!V||!V.INTERRUPTED),Oe=c(l,V&&V.that),He=function(ze){return T&&R(T,"normal",ze),new o(!0,ze)},ke=function(ze){return ce?(L(ze),Ne?Oe(ze[0],ze[1],He):Oe(ze[0],ze[1])):Ne?Oe(ze,He):Oe(ze)};if(Ee)T=I;else{if(!(b=v(I)))throw p(w(I)+" is not iterable");if(A(b)){for(H=0,ne=C(I);ne>H;H++)if((le=ke(I[H]))&&S(f,le))return le;return new o(!1)}T=n(I,b)}for(W=T.next;!(be=d(W,T)).done;){try{le=ke(be.value)}catch(ze){R(T,"throw",ze)}if("object"==typeof le&&le&&S(f,le))return le}return new o(!1)}},9212:(F,Y,e)=>{var i=e(6916),c=e(9670),d=e(8173);F.exports=function(L,w,A){var C,S;c(L);try{if(!(C=d(L,"return"))){if("throw"===w)throw A;return A}C=i(C,L)}catch(n){S=!0,C=n}if("throw"===w)throw A;if(S)throw C;return c(C),A}},3383:(F,Y,e)=>{"use strict";var i,c,d,L=e(7293),w=e(614),A=e(30),C=e(9518),S=e(1320),n=e(5112),v=e(1913),R=n("iterator"),p=!1;[].keys&&("next"in(d=[].keys())?(c=C(C(d)))!==Object.prototype&&(i=c):p=!0),null==i||L(function(){var o={};return i[R].call(o)!==o})?i={}:v&&(i=A(i)),w(i[R])||S(i,R,function(){return this}),F.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:p}},7497:F=>{F.exports={}},6244:(F,Y,e)=>{var i=e(7466);F.exports=function(c){return i(c.length)}},5948:(F,Y,e)=>{var i,c,d,L,w,A,C,S,n=e(7854),v=e(9974),R=e(1236).f,p=e(261).set,o=e(6833),f=e(1528),I=e(1036),l=e(2805),V=n.MutationObserver||n.WebKitMutationObserver,T=n.document,b=n.process,H=n.Promise,ne=R(n,"queueMicrotask"),le=ne&&ne.value;le||(i=function(){var W,be;for(l&&(W=b.domain)&&W.exit();c;){be=c.fn,c=c.next;try{be()}catch(de){throw c?L():d=void 0,de}}d=void 0,W&&W.enter()},o||l||I||!V||!T?!f&&H&&H.resolve?((C=H.resolve(void 0)).constructor=H,S=v(C.then,C),L=function(){S(i)}):l?L=function(){b.nextTick(i)}:(p=v(p,n),L=function(){p(i)}):(w=!0,A=T.createTextNode(""),new V(i).observe(A,{characterData:!0}),L=function(){A.data=w=!w})),F.exports=le||function(W){var be={fn:W,next:void 0};d&&(d.next=be),c||(c=be,L()),d=be}},3366:(F,Y,e)=>{var i=e(7854);F.exports=i.Promise},133:(F,Y,e)=>{var i=e(7392),c=e(7293);F.exports=!!Object.getOwnPropertySymbols&&!c(function(){var d=Symbol();return!String(d)||!(Object(d)instanceof Symbol)||!Symbol.sham&&i&&i<41})},590:(F,Y,e)=>{var i=e(7293),c=e(5112),d=e(1913),L=c("iterator");F.exports=!i(function(){var w=new URL("b?a=1&b=2&c=3","http://a"),A=w.searchParams,C="";return w.pathname="c%20d",A.forEach(function(S,n){A.delete("b"),C+=n+S}),d&&!w.toJSON||!A.sort||"http://a/c%20d?a=1&c=3"!==w.href||"3"!==A.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!A[L]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==C||"x"!==new URL("http://x",void 0).host})},8536:(F,Y,e)=>{var i=e(7854),c=e(614),d=e(2788),L=i.WeakMap;F.exports=c(L)&&/native code/.test(d(L))},8523:(F,Y,e)=>{"use strict";var i=e(9662),c=function(d){var L,w;this.promise=new d(function(A,C){if(void 0!==L||void 0!==w)throw TypeError("Bad Promise constructor");L=A,w=C}),this.resolve=i(L),this.reject=i(w)};F.exports.f=function(d){return new c(d)}},3929:(F,Y,e)=>{var i=e(7854),c=e(7850),d=i.TypeError;F.exports=function(L){if(c(L))throw d("The method doesn't accept regular expressions");return L}},3009:(F,Y,e)=>{var i=e(7854),c=e(7293),d=e(1702),L=e(1340),w=e(3111).trim,A=e(1361),C=i.parseInt,S=i.Symbol,n=S&&S.iterator,v=/^[+-]?0x/i,R=d(v.exec),p=8!==C(A+"08")||22!==C(A+"0x16")||n&&!c(function(){C(Object(n))});F.exports=p?function(o,f){var I=w(L(o));return C(I,f>>>0||(R(v,I)?16:10))}:C},1574:(F,Y,e)=>{"use strict";var i=e(9781),c=e(1702),d=e(6916),L=e(7293),w=e(1956),A=e(5181),C=e(5296),S=e(7908),n=e(8361),v=Object.assign,R=Object.defineProperty,p=c([].concat);F.exports=!v||L(function(){if(i&&1!==v({b:1},v(R({},"a",{enumerable:!0,get:function(){R(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var o={},f={},I=Symbol(),l="abcdefghijklmnopqrst";return o[I]=7,l.split("").forEach(function(V){f[V]=V}),7!=v({},o)[I]||w(v({},f)).join("")!=l})?function(o,f){for(var I=S(o),l=arguments.length,V=1,T=A.f,b=C.f;l>V;)for(var H,ne=n(arguments[V++]),le=T?p(w(ne),T(ne)):w(ne),W=le.length,be=0;W>be;)H=le[be++],i&&!d(b,ne,H)||(I[H]=ne[H]);return I}:v},30:(F,Y,e)=>{var i,c=e(9670),d=e(6048),L=e(748),w=e(3501),A=e(490),C=e(317),S=e(6200)("IE_PROTO"),n=function(){},v=function(o){return"<script>"+o+"<\/script>"},R=function(o){o.write(v("")),o.close();var f=o.parentWindow.Object;return o=null,f},p=function(){try{i=new ActiveXObject("htmlfile")}catch(l){}var o,f;p="undefined"!=typeof document?document.domain&&i?R(i):((f=C("iframe")).style.display="none",A.appendChild(f),f.src=String("javascript:"),(o=f.contentWindow.document).open(),o.write(v("document.F=Object")),o.close(),o.F):R(i);for(var I=L.length;I--;)delete p.prototype[L[I]];return p()};w[S]=!0,F.exports=Object.create||function(o,f){var I;return null!==o?(n.prototype=c(o),I=new n,n.prototype=null,I[S]=o):I=p(),void 0===f?I:d(I,f)}},6048:(F,Y,e)=>{var i=e(9781),c=e(3070),d=e(9670),L=e(5656),w=e(1956);F.exports=i?Object.defineProperties:function(A,C){d(A);for(var S,n=L(C),v=w(C),R=v.length,p=0;R>p;)c.f(A,S=v[p++],n[S]);return A}},3070:(F,Y,e)=>{var i=e(7854),c=e(9781),d=e(4664),L=e(9670),w=e(4948),A=i.TypeError,C=Object.defineProperty;Y.f=c?C:function(S,n,v){if(L(S),n=w(n),L(v),d)try{return C(S,n,v)}catch(R){}if("get"in v||"set"in v)throw A("Accessors not supported");return"value"in v&&(S[n]=v.value),S}},1236:(F,Y,e)=>{var i=e(9781),c=e(6916),d=e(5296),L=e(9114),w=e(5656),A=e(4948),C=e(2597),S=e(4664),n=Object.getOwnPropertyDescriptor;Y.f=i?n:function(v,R){if(v=w(v),R=A(R),S)try{return n(v,R)}catch(p){}if(C(v,R))return L(!c(d.f,v,R),v[R])}},1156:(F,Y,e)=>{var i=e(4326),c=e(5656),d=e(8006).f,L=e(206),w="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];F.exports.f=function(A){return w&&"Window"==i(A)?function(C){try{return d(C)}catch(S){return L(w)}}(A):d(c(A))}},8006:(F,Y,e)=>{var i=e(6324),c=e(748).concat("length","prototype");Y.f=Object.getOwnPropertyNames||function(d){return i(d,c)}},5181:(F,Y)=>{Y.f=Object.getOwnPropertySymbols},9518:(F,Y,e)=>{var i=e(7854),c=e(2597),d=e(614),L=e(7908),w=e(6200),A=e(8544),C=w("IE_PROTO"),S=i.Object,n=S.prototype;F.exports=A?S.getPrototypeOf:function(v){var R=L(v);if(c(R,C))return R[C];var p=R.constructor;return d(p)&&R instanceof p?p.prototype:R instanceof S?n:null}},7976:(F,Y,e)=>{var i=e(1702);F.exports=i({}.isPrototypeOf)},6324:(F,Y,e)=>{var i=e(1702),c=e(2597),d=e(5656),L=e(1318).indexOf,w=e(3501),A=i([].push);F.exports=function(C,S){var n,v=d(C),R=0,p=[];for(n in v)!c(w,n)&&c(v,n)&&A(p,n);for(;S.length>R;)c(v,n=S[R++])&&(~L(p,n)||A(p,n));return p}},1956:(F,Y,e)=>{var i=e(6324),c=e(748);F.exports=Object.keys||function(d){return i(d,c)}},5296:(F,Y)=>{"use strict";var e={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,c=i&&!e.call({1:2},1);Y.f=c?function(d){var L=i(this,d);return!!L&&L.enumerable}:e},7674:(F,Y,e)=>{var i=e(1702),c=e(9670),d=e(6077);F.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var L,w=!1,A={};try{(L=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(A,[]),w=A instanceof Array}catch(C){}return function(C,S){return c(C),d(S),w?L(C,S):C.__proto__=S,C}}():void 0)},4699:(F,Y,e)=>{var i=e(9781),c=e(1702),d=e(1956),L=e(5656),w=c(e(5296).f),A=c([].push),C=function(S){return function(n){for(var v,R=L(n),p=d(R),o=p.length,f=0,I=[];o>f;)v=p[f++],i&&!w(R,v)||A(I,S?[v,R[v]]:R[v]);return I}};F.exports={entries:C(!0),values:C(!1)}},288:(F,Y,e)=>{"use strict";var i=e(1694),c=e(648);F.exports=i?{}.toString:function(){return"[object "+c(this)+"]"}},2140:(F,Y,e)=>{var i=e(7854),c=e(6916),d=e(614),L=e(111),w=i.TypeError;F.exports=function(A,C){var S,n;if("string"===C&&d(S=A.toString)&&!L(n=c(S,A))||d(S=A.valueOf)&&!L(n=c(S,A))||"string"!==C&&d(S=A.toString)&&!L(n=c(S,A)))return n;throw w("Can't convert object to primitive value")}},3887:(F,Y,e)=>{var i=e(5005),c=e(1702),d=e(8006),L=e(5181),w=e(9670),A=c([].concat);F.exports=i("Reflect","ownKeys")||function(C){var S=d.f(w(C)),n=L.f;return n?A(S,n(C)):S}},857:(F,Y,e)=>{var i=e(7854);F.exports=i},2534:F=>{F.exports=function(Y){try{return{error:!1,value:Y()}}catch(e){return{error:!0,value:e}}}},9478:(F,Y,e)=>{var i=e(9670),c=e(111),d=e(8523);F.exports=function(L,w){if(i(L),c(w)&&w.constructor===L)return w;var A=d.f(L);return(0,A.resolve)(w),A.promise}},2248:(F,Y,e)=>{var i=e(1320);F.exports=function(c,d,L){for(var w in d)i(c,w,d[w],L);return c}},1320:(F,Y,e)=>{var i=e(7854),c=e(614),d=e(2597),L=e(8880),w=e(3505),A=e(2788),C=e(9909),S=e(6530).CONFIGURABLE,n=C.get,v=C.enforce,R=String(String).split("String");(F.exports=function(p,o,f,I){var l,V=!!I&&!!I.unsafe,T=!!I&&!!I.enumerable,b=!!I&&!!I.noTargetGet,H=I&&void 0!==I.name?I.name:o;c(f)&&("Symbol("===String(H).slice(0,7)&&(H="["+String(H).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!d(f,"name")||S&&f.name!==H)&&L(f,"name",H),(l=v(f)).source||(l.source=R.join("string"==typeof H?H:""))),p!==i?(V?!b&&p[o]&&(T=!0):delete p[o],T?p[o]=f:L(p,o,f)):T?p[o]=f:w(o,f)})(Function.prototype,"toString",function(){return c(this)&&n(this).source||A(this)})},7651:(F,Y,e)=>{var i=e(7854),c=e(6916),d=e(9670),L=e(614),w=e(4326),A=e(2261),C=i.TypeError;F.exports=function(S,n){var v=S.exec;if(L(v)){var R=c(v,S,n);return null!==R&&d(R),R}if("RegExp"===w(S))return c(A,S,n);throw C("RegExp#exec called on incompatible receiver")}},2261:(F,Y,e)=>{"use strict";var i,c,d=e(6916),L=e(1702),w=e(1340),A=e(7066),C=e(2999),S=e(2309),n=e(30),v=e(9909).get,R=e(9441),p=e(7168),o=S("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,I=f,l=L("".charAt),V=L("".indexOf),T=L("".replace),b=L("".slice),H=(c=/b*/g,d(f,i=/a/,"a"),d(f,c,"a"),0!==i.lastIndex||0!==c.lastIndex),ne=C.UNSUPPORTED_Y||C.BROKEN_CARET,le=void 0!==/()??/.exec("")[1];(H||le||ne||R||p)&&(I=function(W){var be,de,ce,Ee,Ne,Oe,He,ke=this,ze=v(ke),we=w(W),gt=ze.raw;if(gt)return gt.lastIndex=ke.lastIndex,be=d(I,gt,we),ke.lastIndex=gt.lastIndex,be;var ft=ze.groups,at=ne&&ke.sticky,Ze=d(A,ke),ie=ke.source,bt=0,Rt=we;if(at&&(Ze=T(Ze,"y",""),-1===V(Ze,"g")&&(Ze+="g"),Rt=b(we,ke.lastIndex),ke.lastIndex>0&&(!ke.multiline||ke.multiline&&"\n"!==l(we,ke.lastIndex-1))&&(ie="(?: "+ie+")",Rt=" "+Rt,bt++),de=new RegExp("^(?:"+ie+")",Ze)),le&&(de=new RegExp("^"+ie+"$(?!\\s)",Ze)),H&&(ce=ke.lastIndex),Ee=d(f,at?de:ke,Rt),at?Ee?(Ee.input=b(Ee.input,bt),Ee[0]=b(Ee[0],bt),Ee.index=ke.lastIndex,ke.lastIndex+=Ee[0].length):ke.lastIndex=0:H&&Ee&&(ke.lastIndex=ke.global?Ee.index+Ee[0].length:ce),le&&Ee&&Ee.length>1&&d(o,Ee[0],de,function(){for(Ne=1;Ne<arguments.length-2;Ne++)void 0===arguments[Ne]&&(Ee[Ne]=void 0)}),Ee&&ft)for(Ee.groups=Oe=n(null),Ne=0;Ne<ft.length;Ne++)Oe[(He=ft[Ne])[0]]=Ee[He[1]];return Ee}),F.exports=I},7066:(F,Y,e)=>{"use strict";var i=e(9670);F.exports=function(){var c=i(this),d="";return c.global&&(d+="g"),c.ignoreCase&&(d+="i"),c.multiline&&(d+="m"),c.dotAll&&(d+="s"),c.unicode&&(d+="u"),c.sticky&&(d+="y"),d}},2999:(F,Y,e)=>{var i=e(7293),c=e(7854).RegExp;Y.UNSUPPORTED_Y=i(function(){var d=c("a","y");return d.lastIndex=2,null!=d.exec("abcd")}),Y.BROKEN_CARET=i(function(){var d=c("^r","gy");return d.lastIndex=2,null!=d.exec("str")})},9441:(F,Y,e)=>{var i=e(7293),c=e(7854).RegExp;F.exports=i(function(){var d=c(".","s");return!(d.dotAll&&d.exec("\n")&&"s"===d.flags)})},7168:(F,Y,e)=>{var i=e(7293),c=e(7854).RegExp;F.exports=i(function(){var d=c("(?<a>b)","g");return"b"!==d.exec("b").groups.a||"bc"!=="b".replace(d,"$<a>c")})},4488:(F,Y,e)=>{var i=e(7854).TypeError;F.exports=function(c){if(null==c)throw i("Can't call method on "+c);return c}},1150:F=>{F.exports=Object.is||function(Y,e){return Y===e?0!==Y||1/Y==1/e:Y!=Y&&e!=e}},3505:(F,Y,e)=>{var i=e(7854),c=Object.defineProperty;F.exports=function(d,L){try{c(i,d,{value:L,configurable:!0,writable:!0})}catch(w){i[d]=L}return L}},6340:(F,Y,e)=>{"use strict";var i=e(5005),c=e(3070),d=e(5112),L=e(9781),w=d("species");F.exports=function(A){var C=i(A);L&&C&&!C[w]&&(0,c.f)(C,w,{configurable:!0,get:function(){return this}})}},8003:(F,Y,e)=>{var i=e(3070).f,c=e(2597),d=e(5112)("toStringTag");F.exports=function(L,w,A){L&&!c(L=A?L:L.prototype,d)&&i(L,d,{configurable:!0,value:w})}},6200:(F,Y,e)=>{var i=e(2309),c=e(9711),d=i("keys");F.exports=function(L){return d[L]||(d[L]=c(L))}},5465:(F,Y,e)=>{var i=e(7854),c=e(3505),d="__core-js_shared__",L=i[d]||c(d,{});F.exports=L},2309:(F,Y,e)=>{var i=e(1913),c=e(5465);(F.exports=function(d,L){return c[d]||(c[d]=void 0!==L?L:{})})("versions",[]).push({version:"3.19.0",mode:i?"pure":"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})},6707:(F,Y,e)=>{var i=e(9670),c=e(9483),d=e(5112)("species");F.exports=function(L,w){var A,C=i(L).constructor;return void 0===C||null==(A=i(C)[d])?w:c(A)}},8710:(F,Y,e)=>{var i=e(1702),c=e(9303),d=e(1340),L=e(4488),w=i("".charAt),A=i("".charCodeAt),C=i("".slice),S=function(n){return function(v,R){var p,o,f=d(L(v)),I=c(R),l=f.length;return I<0||I>=l?n?"":void 0:(p=A(f,I))<55296||p>56319||I+1===l||(o=A(f,I+1))<56320||o>57343?n?w(f,I):p:n?C(f,I,I+2):o-56320+(p-55296<<10)+65536}};F.exports={codeAt:S(!1),charAt:S(!0)}},6650:(F,Y,e)=>{var i=e(1702),c=e(7466),d=e(1340),L=e(8415),w=e(4488),A=i(L),C=i("".slice),S=Math.ceil,n=function(v){return function(R,p,o){var f,I,l=d(w(R)),V=c(p),T=l.length,b=void 0===o?" ":d(o);return V<=T||""==b?l:((I=A(b,S((f=V-T)/b.length))).length>f&&(I=C(I,0,f)),v?l+I:I+l)}};F.exports={start:n(!1),end:n(!0)}},3197:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=2147483647,L=/[^\0-\u007E]/,w=/[.\u3002\uFF0E\uFF61]/g,A="Overflow: input needs wider integers to process",C=i.RangeError,S=c(w.exec),n=Math.floor,v=String.fromCharCode,R=c("".charCodeAt),p=c([].join),o=c([].push),f=c("".replace),I=c("".split),l=c("".toLowerCase),V=function(H){return H+22+75*(H<26)},T=function(H,ne,le){var W=0;for(H=le?n(H/700):H>>1,H+=n(H/ne);H>455;W+=36)H=n(H/35);return n(W+36*H/(H+38))},b=function(H){var le,W,ne=[],be=(H=function(Ze){for(var ie=[],bt=0,Rt=Ze.length;bt<Rt;){var Ct=R(Ze,bt++);if(Ct>=55296&&Ct<=56319&&bt<Rt){var et=R(Ze,bt++);56320==(64512&et)?o(ie,((1023&Ct)<<10)+(1023&et)+65536):(o(ie,Ct),bt--)}else o(ie,Ct)}return ie}(H)).length,de=128,ce=0,Ee=72;for(le=0;le<H.length;le++)(W=H[le])<128&&o(ne,v(W));var Ne=ne.length,Oe=Ne;for(Ne&&o(ne,"-");Oe<be;){var He=d;for(le=0;le<H.length;le++)(W=H[le])>=de&&W<He&&(He=W);var ke=Oe+1;if(He-de>n((d-ce)/ke))throw C(A);for(ce+=(He-de)*ke,de=He,le=0;le<H.length;le++){if((W=H[le])<de&&++ce>d)throw C(A);if(W==de){for(var ze=ce,we=36;;we+=36){var gt=we<=Ee?1:we>=Ee+26?26:we-Ee;if(ze<gt)break;var ft=ze-gt,at=36-gt;o(ne,v(V(gt+ft%at))),ze=n(ft/at)}o(ne,v(V(ze))),Ee=T(ce,ke,Oe==Ne),ce=0,++Oe}}++ce,++de}return p(ne,"")};F.exports=function(H){var ne,le,W=[],be=I(f(l(H),w,"."),".");for(ne=0;ne<be.length;ne++)o(W,S(L,le=be[ne])?"xn--"+b(le):le);return p(W,".")}},8415:(F,Y,e)=>{"use strict";var i=e(7854),c=e(9303),d=e(1340),L=e(4488),w=i.RangeError;F.exports=function(A){var C=d(L(this)),S="",n=c(A);if(n<0||n==1/0)throw w("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(C+=C))1&n&&(S+=C);return S}},6091:(F,Y,e)=>{var i=e(6530).PROPER,c=e(7293),d=e(1361);F.exports=function(L){return c(function(){return!!d[L]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[L]()||i&&d[L].name!==L})}},3111:(F,Y,e)=>{var i=e(1702),c=e(4488),d=e(1340),L=e(1361),w=i("".replace),A="["+L+"]",C=RegExp("^"+A+A+"*"),S=RegExp(A+A+"*$"),n=function(v){return function(R){var p=d(c(R));return 1&v&&(p=w(p,C,"")),2&v&&(p=w(p,S,"")),p}};F.exports={start:n(1),end:n(2),trim:n(3)}},261:(F,Y,e)=>{var i,c,d,L,w=e(7854),A=e(2104),C=e(9974),S=e(614),n=e(2597),v=e(7293),R=e(490),p=e(206),o=e(317),f=e(6833),I=e(2805),l=w.setImmediate,V=w.clearImmediate,T=w.process,b=w.Dispatch,H=w.Function,ne=w.MessageChannel,le=w.String,W=0,be={};try{i=w.location}catch(Oe){}var de=function(Oe){if(n(be,Oe)){var He=be[Oe];delete be[Oe],He()}},ce=function(Oe){return function(){de(Oe)}},Ee=function(Oe){de(Oe.data)},Ne=function(Oe){w.postMessage(le(Oe),i.protocol+"//"+i.host)};l&&V||(l=function(Oe){var He=p(arguments,1);return be[++W]=function(){A(S(Oe)?Oe:H(Oe),void 0,He)},c(W),W},V=function(Oe){delete be[Oe]},I?c=function(Oe){T.nextTick(ce(Oe))}:b&&b.now?c=function(Oe){b.now(ce(Oe))}:ne&&!f?(L=(d=new ne).port2,d.port1.onmessage=Ee,c=C(L.postMessage,L)):w.addEventListener&&S(w.postMessage)&&!w.importScripts&&i&&"file:"!==i.protocol&&!v(Ne)?(c=Ne,w.addEventListener("message",Ee,!1)):c="onreadystatechange"in o("script")?function(Oe){R.appendChild(o("script")).onreadystatechange=function(){R.removeChild(this),de(Oe)}}:function(Oe){setTimeout(ce(Oe),0)}),F.exports={set:l,clear:V}},863:(F,Y,e)=>{var i=e(1702);F.exports=i(1..valueOf)},1400:(F,Y,e)=>{var i=e(9303),c=Math.max,d=Math.min;F.exports=function(L,w){var A=i(L);return A<0?c(A+w,0):d(A,w)}},7067:(F,Y,e)=>{var i=e(7854),c=e(9303),d=e(7466),L=i.RangeError;F.exports=function(w){if(void 0===w)return 0;var A=c(w),C=d(A);if(A!==C)throw L("Wrong length or index");return C}},5656:(F,Y,e)=>{var i=e(8361),c=e(4488);F.exports=function(d){return i(c(d))}},9303:F=>{var Y=Math.ceil,e=Math.floor;F.exports=function(i){var c=+i;return c!=c||0===c?0:(c>0?e:Y)(c)}},7466:(F,Y,e)=>{var i=e(9303),c=Math.min;F.exports=function(d){return d>0?c(i(d),9007199254740991):0}},7908:(F,Y,e)=>{var i=e(7854),c=e(4488),d=i.Object;F.exports=function(L){return d(c(L))}},4590:(F,Y,e)=>{var i=e(7854),c=e(3002),d=i.RangeError;F.exports=function(L,w){var A=c(L);if(A%w)throw d("Wrong offset");return A}},3002:(F,Y,e)=>{var i=e(7854),c=e(9303),d=i.RangeError;F.exports=function(L){var w=c(L);if(w<0)throw d("The argument can't be less than 0");return w}},7593:(F,Y,e)=>{var i=e(7854),c=e(6916),d=e(111),L=e(2190),w=e(8173),A=e(2140),C=e(5112),S=i.TypeError,n=C("toPrimitive");F.exports=function(v,R){if(!d(v)||L(v))return v;var p,o=w(v,n);if(o){if(void 0===R&&(R="default"),p=c(o,v,R),!d(p)||L(p))return p;throw S("Can't convert object to primitive value")}return void 0===R&&(R="number"),A(v,R)}},4948:(F,Y,e)=>{var i=e(7593),c=e(2190);F.exports=function(d){var L=i(d,"string");return c(L)?L:L+""}},1694:(F,Y,e)=>{var i={};i[e(5112)("toStringTag")]="z",F.exports="[object z]"===String(i)},1340:(F,Y,e)=>{var i=e(7854),c=e(648),d=i.String;F.exports=function(L){if("Symbol"===c(L))throw TypeError("Cannot convert a Symbol value to a string");return d(L)}},6330:(F,Y,e)=>{var i=e(7854).String;F.exports=function(c){try{return i(c)}catch(d){return"Object"}}},9843:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(6916),L=e(9781),w=e(3832),A=e(260),C=e(3331),S=e(5787),n=e(9114),v=e(8880),R=e(5988),p=e(7466),o=e(7067),f=e(4590),I=e(4948),l=e(2597),V=e(648),T=e(111),b=e(2190),H=e(30),ne=e(7976),le=e(7674),W=e(8006).f,be=e(7321),de=e(2092).forEach,ce=e(6340),Ee=e(3070),Ne=e(1236),Oe=e(9909),He=e(9587),ke=Oe.get,ze=Oe.set,we=Ee.f,gt=Ne.f,ft=Math.round,at=c.RangeError,Ze=C.ArrayBuffer,ie=Ze.prototype,bt=C.DataView,Rt=A.NATIVE_ARRAY_BUFFER_VIEWS,Ct=A.TYPED_ARRAY_CONSTRUCTOR,et=A.TYPED_ARRAY_TAG,wt=A.TypedArray,Be=A.TypedArrayPrototype,Lt=A.aTypedArrayConstructor,jt=A.isTypedArray,Ge="BYTES_PER_ELEMENT",Pt="Wrong length",z=function(a,m){Lt(a);for(var _=0,P=m.length,x=new a(P);P>_;)x[_]=m[_++];return x},M=function(a,m){we(a,m,{get:function(){return ke(this)[m]}})},t=function(a){var m;return ne(ie,a)||"ArrayBuffer"==(m=V(a))||"SharedArrayBuffer"==m},u=function(a,m){return jt(a)&&!b(m)&&m in a&&R(+m)&&m>=0},h=function(a,m){return m=I(m),u(a,m)?n(2,a[m]):gt(a,m)},y=function(a,m,_){return m=I(m),!(u(a,m)&&T(_)&&l(_,"value"))||l(_,"get")||l(_,"set")||_.configurable||l(_,"writable")&&!_.writable||l(_,"enumerable")&&!_.enumerable?we(a,m,_):(a[m]=_.value,a)};L?(Rt||(Ne.f=h,Ee.f=y,M(Be,"buffer"),M(Be,"byteOffset"),M(Be,"byteLength"),M(Be,"length")),i({target:"Object",stat:!0,forced:!Rt},{getOwnPropertyDescriptor:h,defineProperty:y}),F.exports=function(a,m,_){var P=a.match(/\d+$/)[0]/8,x=a+(_?"Clamped":"")+"Array",oe="get"+a,K="set"+a,X=c[x],me=X,Q=me&&me.prototype,re={},ye=function(Se,ge){we(Se,ge,{get:function(){return xe=ge,(We=ke(this)).view[oe](xe*P+We.byteOffset,!0);var xe,We},set:function(Pe){return We=ge,rt=Pe,Et=ke(this),_&&(rt=(rt=ft(rt))<0?0:rt>255?255:255&rt),void Et.view[K](We*P+Et.byteOffset,rt,!0);var We,rt,Et},enumerable:!0})};Rt?w&&(me=m(function(Se,ge,Pe,xe){return S(Se,Q),He(T(ge)?t(ge)?void 0!==xe?new X(ge,f(Pe,P),xe):void 0!==Pe?new X(ge,f(Pe,P)):new X(ge):jt(ge)?z(me,ge):d(be,me,ge):new X(o(ge)),Se,me)}),le&&le(me,wt),de(W(X),function(Se){Se in me||v(me,Se,X[Se])}),me.prototype=Q):(me=m(function(Se,ge,Pe,xe){S(Se,Q);var We,rt,Et,Qe=0,yt=0;if(T(ge)){if(!t(ge))return jt(ge)?z(me,ge):d(be,me,ge);We=ge,yt=f(Pe,P);var ct=ge.byteLength;if(void 0===xe){if(ct%P||(rt=ct-yt)<0)throw at(Pt)}else if((rt=p(xe)*P)+yt>ct)throw at(Pt);Et=rt/P}else Et=o(ge),We=new Ze(rt=Et*P);for(ze(Se,{buffer:We,byteOffset:yt,byteLength:rt,length:Et,view:new bt(We)});Qe<Et;)ye(Se,Qe++)}),le&&le(me,wt),Q=me.prototype=H(Be)),Q.constructor!==me&&v(Q,"constructor",me),v(Q,Ct,me),et&&v(Q,et,x),re[x]=me,i({global:!0,forced:me!=X,sham:!Rt},re),Ge in me||v(me,Ge,P),Ge in Q||v(Q,Ge,P),ce(x)}):F.exports=function(){}},3832:(F,Y,e)=>{var i=e(7854),c=e(7293),d=e(7072),L=e(260).NATIVE_ARRAY_BUFFER_VIEWS,w=i.ArrayBuffer,A=i.Int8Array;F.exports=!L||!c(function(){A(1)})||!c(function(){new A(-1)})||!d(function(C){new A,new A(null),new A(1.5),new A(C)},!0)||c(function(){return 1!==new A(new w(2),1,void 0).length})},3074:(F,Y,e)=>{var i=e(7745),c=e(6304);F.exports=function(d,L){return i(c(d),L)}},7321:(F,Y,e)=>{var i=e(9974),c=e(6916),d=e(9483),L=e(7908),w=e(6244),A=e(8554),C=e(1246),S=e(7659),n=e(260).aTypedArrayConstructor;F.exports=function(v){var R,p,o,f,I,l,V=d(this),T=L(v),b=arguments.length,H=b>1?arguments[1]:void 0,ne=void 0!==H,le=C(T);if(le&&!S(le))for(l=(I=A(T,le)).next,T=[];!(f=c(l,I)).done;)T.push(f.value);for(ne&&b>2&&(H=i(H,arguments[2])),p=w(T),o=new(n(V))(p),R=0;p>R;R++)o[R]=ne?H(T[R],R):T[R];return o}},6304:(F,Y,e)=>{var i=e(260),c=e(6707),d=i.TYPED_ARRAY_CONSTRUCTOR,L=i.aTypedArrayConstructor;F.exports=function(w){return L(c(w,w[d]))}},9711:(F,Y,e)=>{var i=e(1702),c=0,d=Math.random(),L=i(1..toString);F.exports=function(w){return"Symbol("+(void 0===w?"":w)+")_"+L(++c+d,36)}},3307:(F,Y,e)=>{var i=e(133);F.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},6061:(F,Y,e)=>{var i=e(5112);Y.f=i},5112:(F,Y,e)=>{var i=e(7854),c=e(2309),d=e(2597),L=e(9711),w=e(133),A=e(3307),C=c("wks"),S=i.Symbol,n=S&&S.for,v=A?S:S&&S.withoutSetter||L;F.exports=function(R){if(!d(C,R)||!w&&"string"!=typeof C[R]){var p="Symbol."+R;C[R]=w&&d(S,R)?S[R]:A&&n?n(p):v(p)}return C[R]}},1361:F=>{F.exports="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"},8264:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(3331),L=e(6340),w=d.ArrayBuffer;i({global:!0,forced:c.ArrayBuffer!==w},{ArrayBuffer:w}),L("ArrayBuffer")},9575:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1702),d=e(7293),L=e(3331),w=e(9670),A=e(1400),C=e(7466),S=e(6707),n=L.ArrayBuffer,v=L.DataView,R=v.prototype,p=c(n.prototype.slice),o=c(R.getUint8),f=c(R.setUint8);i({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:d(function(){return!new n(2).slice(1,void 0).byteLength})},{slice:function(I,l){if(p&&void 0===l)return p(w(this),I);for(var V=w(this).byteLength,T=A(I,V),b=A(void 0===l?V:l,V),H=new(S(this,n))(C(b-T)),ne=new v(this),le=new v(H),W=0;T<b;)f(le,W++,o(ne,T++));return H}})},2222:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(7293),L=e(3157),w=e(111),A=e(7908),C=e(6244),S=e(6135),n=e(5417),v=e(1194),R=e(5112),p=e(7392),o=R("isConcatSpreadable"),f=9007199254740991,I="Maximum allowed index exceeded",l=c.TypeError,V=p>=51||!d(function(){var H=[];return H[o]=!1,H.concat()[0]!==H}),T=v("concat"),b=function(H){if(!w(H))return!1;var ne=H[o];return void 0!==ne?!!ne:L(H)};i({target:"Array",proto:!0,forced:!V||!T},{concat:function(H){var ne,le,W,be,de,ce=A(this),Ee=n(ce,0),Ne=0;for(ne=-1,W=arguments.length;ne<W;ne++)if(b(de=-1===ne?ce:arguments[ne])){if(Ne+(be=C(de))>f)throw l(I);for(le=0;le<be;le++,Ne++)le in de&&S(Ee,Ne,de[le])}else{if(Ne>=f)throw l(I);S(Ee,Ne++,de)}return Ee.length=Ne,Ee}})},3290:(F,Y,e)=>{var i=e(2109),c=e(1285),d=e(1223);i({target:"Array",proto:!0},{fill:c}),d("fill")},7327:(F,Y,e)=>{"use strict";var i=e(2109),c=e(2092).filter;i({target:"Array",proto:!0,forced:!e(1194)("filter")},{filter:function(d){return c(this,d,arguments.length>1?arguments[1]:void 0)}})},9826:(F,Y,e)=>{"use strict";var i=e(2109),c=e(2092).find,d=e(1223),L="find",w=!0;L in[]&&Array(1).find(function(){w=!1}),i({target:"Array",proto:!0,forced:w},{find:function(A){return c(this,A,arguments.length>1?arguments[1]:void 0)}}),d(L)},9554:(F,Y,e)=>{"use strict";var i=e(2109),c=e(8533);i({target:"Array",proto:!0,forced:[].forEach!=c},{forEach:c})},1038:(F,Y,e)=>{var i=e(2109),c=e(8457);i({target:"Array",stat:!0,forced:!e(7072)(function(d){Array.from(d)})},{from:c})},6699:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1318).includes,d=e(1223);i({target:"Array",proto:!0},{includes:function(L){return c(this,L,arguments.length>1?arguments[1]:void 0)}}),d("includes")},2772:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1702),d=e(1318).indexOf,L=e(9341),w=c([].indexOf),A=!!w&&1/w([1],1,-0)<0,C=L("indexOf");i({target:"Array",proto:!0,forced:A||!C},{indexOf:function(S){var n=arguments.length>1?arguments[1]:void 0;return A?w(this,S,n)||0:d(this,S,n)}})},9753:(F,Y,e)=>{e(2109)({target:"Array",stat:!0},{isArray:e(3157)})},6992:(F,Y,e)=>{"use strict";var i=e(5656),c=e(1223),d=e(7497),L=e(9909),w=e(654),A="Array Iterator",C=L.set,S=L.getterFor(A);F.exports=w(Array,"Array",function(n,v){C(this,{type:A,target:i(n),index:0,kind:v})},function(){var n=S(this),v=n.target,R=n.kind,p=n.index++;return!v||p>=v.length?(n.target=void 0,{value:void 0,done:!0}):"keys"==R?{value:p,done:!1}:"values"==R?{value:v[p],done:!1}:{value:[p,v[p]],done:!1}},"values"),d.Arguments=d.Array,c("keys"),c("values"),c("entries")},9600:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1702),d=e(8361),L=e(5656),w=e(9341),A=c([].join),C=d!=Object,S=w("join",",");i({target:"Array",proto:!0,forced:C||!S},{join:function(n){return A(L(this),void 0===n?",":n)}})},1249:(F,Y,e)=>{"use strict";var i=e(2109),c=e(2092).map;i({target:"Array",proto:!0,forced:!e(1194)("map")},{map:function(d){return c(this,d,arguments.length>1?arguments[1]:void 0)}})},7042:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(3157),L=e(4411),w=e(111),A=e(1400),C=e(6244),S=e(5656),n=e(6135),v=e(5112),R=e(1194),p=e(206),o=R("slice"),f=v("species"),I=c.Array,l=Math.max;i({target:"Array",proto:!0,forced:!o},{slice:function(V,T){var b,H,ne,le=S(this),W=C(le),be=A(V,W),de=A(void 0===T?W:T,W);if(d(le)&&((L(b=le.constructor)&&(b===I||d(b.prototype))||w(b)&&null===(b=b[f]))&&(b=void 0),b===I||void 0===b))return p(le,be,de);for(H=new(void 0===b?I:b)(l(de-be,0)),ne=0;be<de;be++,ne++)be in le&&n(H,ne,le[be]);return H.length=ne,H}})},2707:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1702),d=e(9662),L=e(7908),w=e(6244),A=e(1340),C=e(7293),S=e(4362),n=e(9341),v=e(8886),R=e(256),p=e(7392),o=e(8008),f=[],I=c(f.sort),l=c(f.push),V=C(function(){f.sort(void 0)}),T=C(function(){f.sort(null)}),b=n("sort"),H=!C(function(){if(p)return p<70;if(!(v&&v>3)){if(R)return!0;if(o)return o<603;var ne,le,W,be,de="";for(ne=65;ne<76;ne++){switch(le=String.fromCharCode(ne),ne){case 66:case 69:case 70:case 72:W=3;break;case 68:case 71:W=4;break;default:W=2}for(be=0;be<47;be++)f.push({k:le+be,v:W})}for(f.sort(function(ce,Ee){return Ee.v-ce.v}),be=0;be<f.length;be++)le=f[be].k.charAt(0),de.charAt(de.length-1)!==le&&(de+=le);return"DGBEFHACIJK"!==de}});i({target:"Array",proto:!0,forced:V||!T||!b||!H},{sort:function(ne){void 0!==ne&&d(ne);var le=L(this);if(H)return void 0===ne?I(le):I(le,ne);var W,be,de=[],ce=w(le);for(be=0;be<ce;be++)be in le&&l(de,le[be]);for(S(de,function(Ee){return function(Ne,Oe){return void 0===Oe?-1:void 0===Ne?1:void 0!==Ee?+Ee(Ne,Oe)||0:A(Ne)>A(Oe)?1:-1}}(ne)),W=de.length,be=0;be<W;)le[be]=de[be++];for(;be<ce;)delete le[be++];return le}})},561:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(1400),L=e(9303),w=e(6244),A=e(7908),C=e(5417),S=e(6135),n=e(1194)("splice"),v=c.TypeError,R=Math.max,p=Math.min,o=9007199254740991,f="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!n},{splice:function(I,l){var V,T,b,H,ne,le,W=A(this),be=w(W),de=d(I,be),ce=arguments.length;if(0===ce?V=T=0:1===ce?(V=0,T=be-de):(V=ce-2,T=p(R(L(l),0),be-de)),be+V-T>o)throw v(f);for(b=C(W,T),H=0;H<T;H++)(ne=de+H)in W&&S(b,H,W[ne]);if(b.length=T,V<T){for(H=de;H<be-T;H++)le=H+V,(ne=H+T)in W?W[le]=W[ne]:delete W[le];for(H=be;H>be-T+V;H--)delete W[H-1]}else if(V>T)for(H=be-T;H>de;H--)le=H+V-1,(ne=H+T-1)in W?W[le]=W[ne]:delete W[le];for(H=0;H<V;H++)W[H+de]=arguments[H+2];return W.length=be-T+V,b}})},6716:(F,Y,e)=>{var i=e(2109),c=e(3331);i({global:!0,forced:!e(4019)},{DataView:c.DataView})},3843:(F,Y,e)=>{var i=e(2109),c=e(7854),d=e(1702),L=c.Date,w=d(L.prototype.getTime);i({target:"Date",stat:!0},{now:function(){return w(new L)}})},5268:(F,Y,e)=>{var i=e(2109),c=e(5573);i({target:"Date",proto:!0,forced:Date.prototype.toISOString!==c},{toISOString:c})},5735:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7293),d=e(7908),L=e(7593);i({target:"Date",proto:!0,forced:c(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})},{toJSON:function(w){var A=d(this),C=L(A,"number");return"number"!=typeof C||isFinite(C)?A.toISOString():null}})},3710:(F,Y,e)=>{var i=e(1702),c=e(1320),d=Date.prototype,L="Invalid Date",w=i(d.toString),A=i(d.getTime);String(new Date(NaN))!=L&&c(d,"toString",function(){var C=A(this);return C==C?w(this):L})},4812:(F,Y,e)=>{e(2109)({target:"Function",proto:!0},{bind:e(7065)})},8309:(F,Y,e)=>{var i=e(9781),c=e(6530).EXISTS,d=e(1702),L=e(3070).f,w=Function.prototype,A=d(w.toString),C=/^\s*function ([^ (]*)/,S=d(C.exec);i&&!c&&L(w,"name",{configurable:!0,get:function(){try{return S(C,A(this))[1]}catch(n){return""}}})},1532:(F,Y,e)=>{"use strict";e(7710)("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},e(5631))},658:(F,Y,e)=>{var i=e(2109),c=Math.log,d=Math.LOG10E;i({target:"Math",stat:!0},{log10:function(L){return c(L)*d}})},9653:(F,Y,e)=>{"use strict";var i=e(9781),c=e(7854),d=e(1702),L=e(4705),w=e(1320),A=e(2597),C=e(9587),S=e(7976),n=e(2190),v=e(7593),R=e(7293),p=e(8006).f,o=e(1236).f,f=e(3070).f,I=e(863),l=e(3111).trim,V="Number",T=c.Number,b=T.prototype,H=c.TypeError,ne=d("".slice),le=d("".charCodeAt),W=function(Oe){var He=v(Oe,"number");return"bigint"==typeof He?He:be(He)},be=function(Oe){var He,ke,ze,we,gt,ft,at,Ze,ie=v(Oe,"number");if(n(ie))throw H("Cannot convert a Symbol value to a number");if("string"==typeof ie&&ie.length>2)if(ie=l(ie),43===(He=le(ie,0))||45===He){if(88===(ke=le(ie,2))||120===ke)return NaN}else if(48===He){switch(le(ie,1)){case 66:case 98:ze=2,we=49;break;case 79:case 111:ze=8,we=55;break;default:return+ie}for(ft=(gt=ne(ie,2)).length,at=0;at<ft;at++)if((Ze=le(gt,at))<48||Ze>we)return NaN;return parseInt(gt,ze)}return+ie};if(L(V,!T(" 0o1")||!T("0b1")||T("+0x1"))){for(var de,ce=function(Oe){var He=arguments.length<1?0:T(W(Oe)),ke=this;return S(b,ke)&&R(function(){I(ke)})?C(Object(He),ke,ce):He},Ee=i?p(T):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Ne=0;Ee.length>Ne;Ne++)A(T,de=Ee[Ne])&&!A(ce,de)&&f(ce,de,o(T,de));ce.prototype=b,b.constructor=ce,w(c,V,ce)}},3161:(F,Y,e)=>{e(2109)({target:"Number",stat:!0},{isInteger:e(5988)})},4363:(F,Y,e)=>{e(2109)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},9601:(F,Y,e)=>{var i=e(2109),c=e(1574);i({target:"Object",stat:!0,forced:Object.assign!==c},{assign:c})},8011:(F,Y,e)=>{e(2109)({target:"Object",stat:!0,sham:!e(9781)},{create:e(30)})},9070:(F,Y,e)=>{var i=e(2109),c=e(9781);i({target:"Object",stat:!0,forced:!c,sham:!c},{defineProperty:e(3070).f})},9720:(F,Y,e)=>{var i=e(2109),c=e(4699).entries;i({target:"Object",stat:!0},{entries:function(d){return c(d)}})},5003:(F,Y,e)=>{var i=e(2109),c=e(7293),d=e(5656),L=e(1236).f,w=e(9781),A=c(function(){L(1)});i({target:"Object",stat:!0,forced:!w||A,sham:!w},{getOwnPropertyDescriptor:function(C,S){return L(d(C),S)}})},489:(F,Y,e)=>{var i=e(2109),c=e(7293),d=e(7908),L=e(9518),w=e(8544);i({target:"Object",stat:!0,forced:c(function(){L(1)}),sham:!w},{getPrototypeOf:function(A){return L(d(A))}})},7941:(F,Y,e)=>{var i=e(2109),c=e(7908),d=e(1956);i({target:"Object",stat:!0,forced:e(7293)(function(){d(1)})},{keys:function(L){return d(c(L))}})},8304:(F,Y,e)=>{e(2109)({target:"Object",stat:!0},{setPrototypeOf:e(7674)})},1539:(F,Y,e)=>{var i=e(1694),c=e(1320),d=e(288);i||c(Object.prototype,"toString",d,{unsafe:!0})},2479:(F,Y,e)=>{var i=e(2109),c=e(4699).values;i({target:"Object",stat:!0},{values:function(d){return c(d)}})},1058:(F,Y,e)=>{var i=e(2109),c=e(3009);i({global:!0,forced:parseInt!=c},{parseInt:c})},8674:(F,Y,e)=>{"use strict";var i,c,d,L,w=e(2109),A=e(1913),C=e(7854),S=e(5005),n=e(6916),v=e(3366),R=e(1320),p=e(2248),o=e(7674),f=e(8003),I=e(6340),l=e(9662),V=e(614),T=e(111),b=e(5787),H=e(2788),ne=e(408),le=e(7072),W=e(6707),be=e(261).set,de=e(5948),ce=e(9478),Ee=e(842),Ne=e(8523),Oe=e(2534),He=e(9909),ke=e(4705),ze=e(5112),we=e(7871),gt=e(2805),ft=e(7392),at=ze("species"),Ze="Promise",ie=He.get,bt=He.set,Rt=He.getterFor(Ze),Ct=v&&v.prototype,et=v,wt=Ct,Be=C.TypeError,Lt=C.document,jt=C.process,Ge=Ne.f,Pt=Ge,z=!!(Lt&&Lt.createEvent&&C.dispatchEvent),M=V(C.PromiseRejectionEvent),t="unhandledrejection",u=!1,h=ke(Ze,function(){var Q=H(et),re=Q!==String(et);if(!re&&66===ft||A&&!wt.finally)return!0;if(ft>=51&&/native code/.test(Q))return!1;var ye=new et(function(ge){ge(1)}),Se=function(ge){ge(function(){},function(){})};return(ye.constructor={})[at]=Se,!(u=ye.then(function(){})instanceof Se)||!re&&we&&!M}),y=h||!le(function(Q){et.all(Q).catch(function(){})}),a=function(Q){var re;return!(!T(Q)||!V(re=Q.then))&&re},m=function(Q,re){if(!Q.notified){Q.notified=!0;var ye=Q.reactions;de(function(){for(var Se=Q.value,ge=1==Q.state,Pe=0;ye.length>Pe;){var xe,We,rt,Et=ye[Pe++],Qe=ge?Et.ok:Et.fail,yt=Et.resolve,ct=Et.reject,ht=Et.domain;try{Qe?(ge||(2===Q.rejection&&oe(Q),Q.rejection=1),!0===Qe?xe=Se:(ht&&ht.enter(),xe=Qe(Se),ht&&(ht.exit(),rt=!0)),xe===Et.promise?ct(Be("Promise-chain cycle")):(We=a(xe))?n(We,xe,yt,ct):yt(xe)):ct(Se)}catch(mi){ht&&!rt&&ht.exit(),ct(mi)}}Q.reactions=[],Q.notified=!1,re&&!Q.rejection&&P(Q)})}},_=function(Q,re,ye){var Se,ge;z?((Se=Lt.createEvent("Event")).promise=re,Se.reason=ye,Se.initEvent(Q,!1,!0),C.dispatchEvent(Se)):Se={promise:re,reason:ye},!M&&(ge=C["on"+Q])?ge(Se):Q===t&&Ee("Unhandled promise rejection",ye)},P=function(Q){n(be,C,function(){var re,ye=Q.facade,Se=Q.value;if(x(Q)&&(re=Oe(function(){gt?jt.emit("unhandledRejection",Se,ye):_(t,ye,Se)}),Q.rejection=gt||x(Q)?2:1,re.error))throw re.value})},x=function(Q){return 1!==Q.rejection&&!Q.parent},oe=function(Q){n(be,C,function(){var re=Q.facade;gt?jt.emit("rejectionHandled",re):_("rejectionhandled",re,Q.value)})},K=function(Q,re,ye){return function(Se){Q(re,Se,ye)}},X=function(Q,re,ye){Q.done||(Q.done=!0,ye&&(Q=ye),Q.value=re,Q.state=2,m(Q,!0))},me=function(Q,re,ye){if(!Q.done){Q.done=!0,ye&&(Q=ye);try{if(Q.facade===re)throw Be("Promise can't be resolved itself");var Se=a(re);Se?de(function(){var ge={done:!1};try{n(Se,re,K(me,ge,Q),K(X,ge,Q))}catch(Pe){X(ge,Pe,Q)}}):(Q.value=re,Q.state=1,m(Q,!1))}catch(ge){X({done:!1},ge,Q)}}};if(h&&(wt=(et=function(Q){b(this,wt),l(Q),n(i,this);var re=ie(this);try{Q(K(me,re),K(X,re))}catch(ye){X(re,ye)}}).prototype,(i=function(Q){bt(this,{type:Ze,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(wt,{then:function(Q,re){var ye=Rt(this),Se=ye.reactions,ge=Ge(W(this,et));return ge.ok=!V(Q)||Q,ge.fail=V(re)&&re,ge.domain=gt?jt.domain:void 0,ye.parent=!0,Se[Se.length]=ge,0!=ye.state&&m(ye,!1),ge.promise},catch:function(Q){return this.then(void 0,Q)}}),c=function(){var Q=new i,re=ie(Q);this.promise=Q,this.resolve=K(me,re),this.reject=K(X,re)},Ne.f=Ge=function(Q){return Q===et||Q===d?new c(Q):Pt(Q)},!A&&V(v)&&Ct!==Object.prototype)){L=Ct.then,u||(R(Ct,"then",function(Q,re){var ye=this;return new et(function(Se,ge){n(L,ye,Se,ge)}).then(Q,re)},{unsafe:!0}),R(Ct,"catch",wt.catch,{unsafe:!0}));try{delete Ct.constructor}catch(Q){}o&&o(Ct,wt)}w({global:!0,wrap:!0,forced:h},{Promise:et}),f(et,Ze,!1,!0),I(Ze),d=S(Ze),w({target:Ze,stat:!0,forced:h},{reject:function(Q){var re=Ge(this);return n(re.reject,void 0,Q),re.promise}}),w({target:Ze,stat:!0,forced:A||h},{resolve:function(Q){return ce(A&&this===d?et:this,Q)}}),w({target:Ze,stat:!0,forced:y},{all:function(Q){var re=this,ye=Ge(re),Se=ye.resolve,ge=ye.reject,Pe=Oe(function(){var xe=l(re.resolve),We=[],rt=0,Et=1;ne(Q,function(Qe){var yt=rt++,ct=!1;Et++,n(xe,re,Qe).then(function(ht){ct||(ct=!0,We[yt]=ht,--Et||Se(We))},ge)}),--Et||Se(We)});return Pe.error&&ge(Pe.value),ye.promise},race:function(Q){var re=this,ye=Ge(re),Se=ye.reject,ge=Oe(function(){var Pe=l(re.resolve);ne(Q,function(xe){n(Pe,re,xe).then(ye.resolve,Se)})});return ge.error&&Se(ge.value),ye.promise}})},2419:(F,Y,e)=>{var i=e(2109),c=e(5005),d=e(2104),L=e(7065),w=e(9483),A=e(9670),C=e(111),S=e(30),n=e(7293),v=c("Reflect","construct"),R=Object.prototype,p=[].push,o=n(function(){function l(){}return!(v(function(){},[],l)instanceof l)}),f=!n(function(){v(function(){})}),I=o||f;i({target:"Reflect",stat:!0,forced:I,sham:I},{construct:function(l,V){w(l),A(V);var T=arguments.length<3?l:w(arguments[2]);if(f&&!o)return v(l,V,T);if(l==T){switch(V.length){case 0:return new l;case 1:return new l(V[0]);case 2:return new l(V[0],V[1]);case 3:return new l(V[0],V[1],V[2]);case 4:return new l(V[0],V[1],V[2],V[3])}var b=[null];return d(p,b,V),new(d(L,l,b))}var H=T.prototype,ne=S(C(H)?H:R),le=d(l,ne,V);return C(le)?le:ne}})},4819:(F,Y,e)=>{var i=e(2109),c=e(6916),d=e(111),L=e(9670),w=e(5032),A=e(1236),C=e(9518);i({target:"Reflect",stat:!0},{get:function S(n,v){var R,p,o=arguments.length<3?n:arguments[2];return L(n)===o?n[v]:(R=A.f(n,v))?w(R)?R.value:void 0===R.get?void 0:c(R.get,o):d(p=C(n))?S(p,v,o):void 0}})},4603:(F,Y,e)=>{var i=e(9781),c=e(7854),d=e(1702),L=e(4705),w=e(9587),A=e(8880),C=e(3070).f,S=e(8006).f,n=e(7976),v=e(7850),R=e(1340),p=e(7066),o=e(2999),f=e(1320),I=e(7293),l=e(2597),V=e(9909).enforce,T=e(6340),b=e(5112),H=e(9441),ne=e(7168),le=b("match"),W=c.RegExp,be=W.prototype,de=c.SyntaxError,ce=d(p),Ee=d(be.exec),Ne=d("".charAt),Oe=d("".replace),He=d("".indexOf),ke=d("".slice),ze=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,we=/a/g,gt=/a/g,ft=new W(we)!==we,at=o.UNSUPPORTED_Y;if(L("RegExp",i&&(!ft||at||H||ne||I(function(){return gt[le]=!1,W(we)!=we||W(gt)==gt||"/a/i"!=W(we,"i")})))){for(var Ze=function(Ct,et){var wt,Be,Lt,jt,Ge,Pt,z=n(be,this),M=v(Ct),t=void 0===et,u=[],h=Ct;if(!z&&M&&t&&Ct.constructor===Ze)return Ct;if((M||n(be,Ct))&&(Ct=Ct.source,t&&(et="flags"in h?h.flags:ce(h))),Ct=void 0===Ct?"":R(Ct),et=void 0===et?"":R(et),h=Ct,H&&"dotAll"in we&&(Be=!!et&&He(et,"s")>-1)&&(et=Oe(et,/s/g,"")),wt=et,at&&"sticky"in we&&(Lt=!!et&&He(et,"y")>-1)&&(et=Oe(et,/y/g,"")),ne&&(Ct=(jt=function(y){for(var a,m=y.length,_=0,P="",x=[],oe={},K=!1,X=!1,me=0,Q="";_<=m;_++){if("\\"===(a=Ne(y,_)))a+=Ne(y,++_);else if("]"===a)K=!1;else if(!K)switch(!0){case"["===a:K=!0;break;case"("===a:Ee(ze,ke(y,_+1))&&(_+=2,X=!0),P+=a,me++;continue;case">"===a&&X:if(""===Q||l(oe,Q))throw new de("Invalid capture group name");oe[Q]=!0,x[x.length]=[Q,me],X=!1,Q="";continue}X?Q+=a:P+=a}return[P,x]}(Ct))[0],u=jt[1]),Ge=w(W(Ct,et),z?this:be,Ze),(Be||Lt||u.length)&&(Pt=V(Ge),Be&&(Pt.dotAll=!0,Pt.raw=Ze(function(y){for(var a,m=y.length,_=0,P="",x=!1;_<=m;_++)"\\"!==(a=Ne(y,_))?x||"."!==a?("["===a?x=!0:"]"===a&&(x=!1),P+=a):P+="[\\s\\S]":P+=a+Ne(y,++_);return P}(Ct),wt)),Lt&&(Pt.sticky=!0),u.length&&(Pt.groups=u)),Ct!==h)try{A(Ge,"source",""===h?"(?:)":h)}catch(y){}return Ge},ie=function(Ct){Ct in Ze||C(Ze,Ct,{configurable:!0,get:function(){return W[Ct]},set:function(et){W[Ct]=et}})},bt=S(W),Rt=0;bt.length>Rt;)ie(bt[Rt++]);be.constructor=Ze,Ze.prototype=be,f(c,"RegExp",Ze)}T("RegExp")},4916:(F,Y,e)=>{"use strict";var i=e(2109),c=e(2261);i({target:"RegExp",proto:!0,forced:/./.exec!==c},{exec:c})},9714:(F,Y,e)=>{"use strict";var i=e(1702),c=e(6530).PROPER,d=e(1320),L=e(9670),w=e(7976),A=e(1340),C=e(7293),S=e(7066),n="toString",v=RegExp.prototype,R=v.toString,p=i(S);(C(function(){return"/a/b"!=R.call({source:"a",flags:"b"})})||c&&R.name!=n)&&d(RegExp.prototype,n,function(){var I=L(this),l=A(I.source),V=I.flags;return"/"+l+"/"+A(void 0===V&&w(v,I)&&!("flags"in v)?p(I):V)},{unsafe:!0})},189:(F,Y,e)=>{"use strict";e(7710)("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},e(5631))},2023:(F,Y,e)=>{"use strict";var i=e(2109),c=e(1702),d=e(3929),L=e(4488),w=e(1340),A=e(4964),C=c("".indexOf);i({target:"String",proto:!0,forced:!A("includes")},{includes:function(S){return!!~C(w(L(this)),w(d(S)),arguments.length>1?arguments[1]:void 0)}})},8783:(F,Y,e)=>{"use strict";var i=e(8710).charAt,c=e(1340),d=e(9909),L=e(654),w="String Iterator",A=d.set,C=d.getterFor(w);L(String,"String",function(S){A(this,{type:w,string:c(S),index:0})},function(){var S,n=C(this),v=n.string,R=n.index;return R>=v.length?{value:void 0,done:!0}:(S=i(v,R),n.index+=S.length,{value:S,done:!1})})},4723:(F,Y,e)=>{"use strict";var i=e(6916),c=e(7007),d=e(9670),L=e(7466),w=e(1340),A=e(4488),C=e(8173),S=e(1530),n=e(7651);c("match",function(v,R,p){return[function(o){var f=A(this),I=null==o?void 0:C(o,v);return I?i(I,o,f):new RegExp(o)[v](w(f))},function(o){var f=d(this),I=w(o),l=p(R,f,I);if(l.done)return l.value;if(!f.global)return n(f,I);var V=f.unicode;f.lastIndex=0;for(var T,b=[],H=0;null!==(T=n(f,I));){var ne=w(T[0]);b[H]=ne,""===ne&&(f.lastIndex=S(I,L(f.lastIndex),V)),H++}return 0===H?null:b}]})},5306:(F,Y,e)=>{"use strict";var i=e(2104),c=e(6916),d=e(1702),L=e(7007),w=e(7293),A=e(9670),C=e(614),S=e(9303),n=e(7466),v=e(1340),R=e(4488),p=e(1530),o=e(8173),f=e(647),I=e(7651),l=e(5112)("replace"),V=Math.max,T=Math.min,b=d([].concat),H=d([].push),ne=d("".indexOf),le=d("".slice),W="$0"==="a".replace(/./,"$0"),be=!!/./[l]&&""===/./[l]("a","$0");L("replace",function(de,ce,Ee){var Ne=be?"$":"$0";return[function(Oe,He){var ke=R(this),ze=null==Oe?void 0:o(Oe,l);return ze?c(ze,Oe,ke,He):c(ce,v(ke),Oe,He)},function(Oe,He){var ke=A(this),ze=v(Oe);if("string"==typeof He&&-1===ne(He,Ne)&&-1===ne(He,"$<")){var we=Ee(ce,ke,ze,He);if(we.done)return we.value}var gt=C(He);gt||(He=v(He));var ft=ke.global;if(ft){var at=ke.unicode;ke.lastIndex=0}for(var Ze=[];;){var ie=I(ke,ze);if(null===ie||(H(Ze,ie),!ft))break;""===v(ie[0])&&(ke.lastIndex=p(ze,n(ke.lastIndex),at))}for(var bt,Rt="",Ct=0,et=0;et<Ze.length;et++){for(var wt=v((ie=Ze[et])[0]),Be=V(T(S(ie.index),ze.length),0),Lt=[],jt=1;jt<ie.length;jt++)H(Lt,void 0===(bt=ie[jt])?bt:String(bt));var Ge=ie.groups;if(gt){var Pt=b([wt],Lt,Be,ze);void 0!==Ge&&H(Pt,Ge);var z=v(i(He,void 0,Pt))}else z=f(wt,ze,Be,Lt,Ge,He);Be>=Ct&&(Rt+=le(ze,Ct,Be)+z,Ct=Be+wt.length)}return Rt+le(ze,Ct)}]},!!w(function(){var de=/./;return de.exec=function(){var ce=[];return ce.groups={a:"7"},ce},"7"!=="".replace(de,"$<a>")})||!W||be)},4765:(F,Y,e)=>{"use strict";var i=e(6916),c=e(7007),d=e(9670),L=e(4488),w=e(1150),A=e(1340),C=e(8173),S=e(7651);c("search",function(n,v,R){return[function(p){var o=L(this),f=null==p?void 0:C(p,n);return f?i(f,p,o):new RegExp(p)[n](A(o))},function(p){var o=d(this),f=A(p),I=R(v,o,f);if(I.done)return I.value;var l=o.lastIndex;w(l,0)||(o.lastIndex=0);var V=S(o,f);return w(o.lastIndex,l)||(o.lastIndex=l),null===V?-1:V.index}]})},3123:(F,Y,e)=>{"use strict";var i=e(2104),c=e(6916),d=e(1702),L=e(7007),w=e(7850),A=e(9670),C=e(4488),S=e(6707),n=e(1530),v=e(7466),R=e(1340),p=e(8173),o=e(206),f=e(7651),I=e(2261),l=e(2999),V=e(7293),T=l.UNSUPPORTED_Y,b=4294967295,H=Math.min,ne=[].push,le=d(/./.exec),W=d(ne),be=d("".slice),de=!V(function(){var ce=/(?:)/,Ee=ce.exec;ce.exec=function(){return Ee.apply(this,arguments)};var Ne="ab".split(ce);return 2!==Ne.length||"a"!==Ne[0]||"b"!==Ne[1]});L("split",function(ce,Ee,Ne){var Oe;return Oe="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(He,ke){var ze=R(C(this)),we=void 0===ke?b:ke>>>0;if(0===we)return[];if(void 0===He)return[ze];if(!w(He))return c(Ee,ze,He,we);for(var gt,ft,at,Ze=[],bt=0,Rt=new RegExp(He.source,(He.ignoreCase?"i":"")+(He.multiline?"m":"")+(He.unicode?"u":"")+(He.sticky?"y":"")+"g");(gt=c(I,Rt,ze))&&!((ft=Rt.lastIndex)>bt&&(W(Ze,be(ze,bt,gt.index)),gt.length>1&&gt.index<ze.length&&i(ne,Ze,o(gt,1)),at=gt[0].length,bt=ft,Ze.length>=we));)Rt.lastIndex===gt.index&&Rt.lastIndex++;return bt===ze.length?!at&&le(Rt,"")||W(Ze,""):W(Ze,be(ze,bt)),Ze.length>we?o(Ze,0,we):Ze}:"0".split(void 0,0).length?function(He,ke){return void 0===He&&0===ke?[]:c(Ee,this,He,ke)}:Ee,[function(He,ke){var ze=C(this),we=null==He?void 0:p(He,ce);return we?c(we,He,ze,ke):c(Oe,R(ze),He,ke)},function(He,ke){var ze=A(this),we=R(He),gt=Ne(Oe,ze,we,ke,Oe!==Ee);if(gt.done)return gt.value;var ft=S(ze,RegExp),at=ze.unicode,ie=new ft(T?"^(?:"+ze.source+")":ze,(ze.ignoreCase?"i":"")+(ze.multiline?"m":"")+(ze.unicode?"u":"")+(T?"g":"y")),bt=void 0===ke?b:ke>>>0;if(0===bt)return[];if(0===we.length)return null===f(ie,we)?[we]:[];for(var Rt=0,Ct=0,et=[];Ct<we.length;){ie.lastIndex=T?0:Ct;var wt,Be=f(ie,T?be(we,Ct):we);if(null===Be||(wt=H(v(ie.lastIndex+(T?Ct:0)),we.length))===Rt)Ct=n(we,Ct,at);else{if(W(et,be(we,Rt,Ct)),et.length===bt)return et;for(var Lt=1;Lt<=Be.length-1;Lt++)if(W(et,Be[Lt]),et.length===bt)return et;Ct=Rt=wt}}return W(et,be(we,Rt)),et}]},!de,T)},6755:(F,Y,e)=>{"use strict";var i,c=e(2109),d=e(1702),L=e(1236).f,w=e(7466),A=e(1340),C=e(3929),S=e(4488),n=e(4964),v=e(1913),R=d("".startsWith),p=d("".slice),o=Math.min,f=n("startsWith");c({target:"String",proto:!0,forced:!(!v&&!f&&(i=L(String.prototype,"startsWith"),i&&!i.writable)||f)},{startsWith:function(I){var l=A(S(this));C(I);var V=w(o(arguments.length>1?arguments[1]:void 0,l.length)),T=A(I);return R?R(l,T,V):p(l,V,V+T.length)===T}})},3210:(F,Y,e)=>{"use strict";var i=e(2109),c=e(3111).trim;i({target:"String",proto:!0,forced:e(6091)("trim")},{trim:function(){return c(this)}})},1817:(F,Y,e)=>{"use strict";var i=e(2109),c=e(9781),d=e(7854),L=e(1702),w=e(2597),A=e(614),C=e(7976),S=e(1340),n=e(3070).f,v=e(9920),R=d.Symbol,p=R&&R.prototype;if(c&&A(R)&&(!("description"in p)||void 0!==R().description)){var o={},f=function(){var ne=arguments.length<1||void 0===arguments[0]?void 0:S(arguments[0]),le=C(p,this)?new R(ne):void 0===ne?R():R(ne);return""===ne&&(o[le]=!0),le};v(f,R),f.prototype=p,p.constructor=f;var I="Symbol(test)"==String(R("test")),l=L(p.toString),V=L(p.valueOf),T=/^Symbol\((.*)\)[^)]+$/,b=L("".replace),H=L("".slice);n(p,"description",{configurable:!0,get:function(){var ne=V(this),le=l(ne);if(w(o,ne))return"";var W=I?H(le,7,-1):b(le,T,"$1");return""===W?void 0:W}}),i({global:!0,forced:!0},{Symbol:f})}},2165:(F,Y,e)=>{e(7235)("iterator")},2526:(F,Y,e)=>{"use strict";var i=e(2109),c=e(7854),d=e(5005),L=e(2104),w=e(6916),A=e(1702),C=e(1913),S=e(9781),n=e(133),v=e(7293),R=e(2597),p=e(3157),o=e(614),f=e(111),I=e(7976),l=e(2190),V=e(9670),T=e(7908),b=e(5656),H=e(4948),ne=e(1340),le=e(9114),W=e(30),be=e(1956),de=e(8006),ce=e(1156),Ee=e(5181),Ne=e(1236),Oe=e(3070),He=e(5296),ke=e(206),ze=e(1320),we=e(2309),gt=e(6200),ft=e(3501),at=e(9711),Ze=e(5112),ie=e(6061),bt=e(7235),Rt=e(8003),Ct=e(9909),et=e(2092).forEach,wt=gt("hidden"),Be="Symbol",Lt=Ze("toPrimitive"),jt=Ct.set,Ge=Ct.getterFor(Be),Pt=Object.prototype,z=c.Symbol,M=z&&z.prototype,t=c.TypeError,u=c.QObject,h=d("JSON","stringify"),y=Ne.f,a=Oe.f,m=ce.f,_=He.f,P=A([].push),x=we("symbols"),oe=we("op-symbols"),K=we("string-to-symbol-registry"),X=we("symbol-to-string-registry"),me=we("wks"),Q=!u||!u.prototype||!u.prototype.findChild,re=S&&v(function(){return 7!=W(a({},"a",{get:function(){return a(this,"a",{value:7}).a}})).a})?function(Qe,yt,ct){var ht=y(Pt,yt);ht&&delete Pt[yt],a(Qe,yt,ct),ht&&Qe!==Pt&&a(Pt,yt,ht)}:a,ye=function(Qe,yt){var ct=x[Qe]=W(M);return jt(ct,{type:Be,tag:Qe,description:yt}),S||(ct.description=yt),ct},Se=function(Qe,yt,ct){Qe===Pt&&Se(oe,yt,ct),V(Qe);var ht=H(yt);return V(ct),R(x,ht)?(ct.enumerable?(R(Qe,wt)&&Qe[wt][ht]&&(Qe[wt][ht]=!1),ct=W(ct,{enumerable:le(0,!1)})):(R(Qe,wt)||a(Qe,wt,le(1,{})),Qe[wt][ht]=!0),re(Qe,ht,ct)):a(Qe,ht,ct)},ge=function(Qe,yt){V(Qe);var ct=b(yt),ht=be(ct).concat(rt(ct));return et(ht,function(mi){S&&!w(Pe,ct,mi)||Se(Qe,mi,ct[mi])}),Qe},Pe=function(Qe){var yt=H(Qe),ct=w(_,this,yt);return!(this===Pt&&R(x,yt)&&!R(oe,yt))&&(!(ct||!R(this,yt)||!R(x,yt)||R(this,wt)&&this[wt][yt])||ct)},xe=function(Qe,yt){var ct=b(Qe),ht=H(yt);if(ct!==Pt||!R(x,ht)||R(oe,ht)){var mi=y(ct,ht);return!mi||!R(x,ht)||R(ct,wt)&&ct[wt][ht]||(mi.enumerable=!0),mi}},We=function(Qe){var yt=m(b(Qe)),ct=[];return et(yt,function(ht){R(x,ht)||R(ft,ht)||P(ct,ht)}),ct},rt=function(Qe){var yt=Qe===Pt,ct=m(yt?oe:b(Qe)),ht=[];return et(ct,function(mi){!R(x,mi)||yt&&!R(Pt,mi)||P(ht,x[mi])}),ht};if(n||(z=function(){if(I(M,this))throw t("Symbol is not a constructor");var Qe=arguments.length&&void 0!==arguments[0]?ne(arguments[0]):void 0,yt=at(Qe),ct=function(ht){this===Pt&&w(ct,oe,ht),R(this,wt)&&R(this[wt],yt)&&(this[wt][yt]=!1),re(this,yt,le(1,ht))};return S&&Q&&re(Pt,yt,{configurable:!0,set:ct}),ye(yt,Qe)},ze(M=z.prototype,"toString",function(){return Ge(this).tag}),ze(z,"withoutSetter",function(Qe){return ye(at(Qe),Qe)}),He.f=Pe,Oe.f=Se,Ne.f=xe,de.f=ce.f=We,Ee.f=rt,ie.f=function(Qe){return ye(Ze(Qe),Qe)},S&&(a(M,"description",{configurable:!0,get:function(){return Ge(this).description}}),C||ze(Pt,"propertyIsEnumerable",Pe,{unsafe:!0}))),i({global:!0,wrap:!0,forced:!n,sham:!n},{Symbol:z}),et(be(me),function(Qe){bt(Qe)}),i({target:Be,stat:!0,forced:!n},{for:function(Qe){var yt=ne(Qe);if(R(K,yt))return K[yt];var ct=z(yt);return K[yt]=ct,X[ct]=yt,ct},keyFor:function(Qe){if(!l(Qe))throw t(Qe+" is not a symbol");if(R(X,Qe))return X[Qe]},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),i({target:"Object",stat:!0,forced:!n,sham:!S},{create:function(Qe,yt){return void 0===yt?W(Qe):ge(W(Qe),yt)},defineProperty:Se,defineProperties:ge,getOwnPropertyDescriptor:xe}),i({target:"Object",stat:!0,forced:!n},{getOwnPropertyNames:We,getOwnPropertySymbols:rt}),i({target:"Object",stat:!0,forced:v(function(){Ee.f(1)})},{getOwnPropertySymbols:function(Qe){return Ee.f(T(Qe))}}),h&&i({target:"JSON",stat:!0,forced:!n||v(function(){var Qe=z();return"[null]"!=h([Qe])||"{}"!=h({a:Qe})||"{}"!=h(Object(Qe))})},{stringify:function(Qe,yt,ct){var ht=ke(arguments),mi=yt;if((f(yt)||void 0!==Qe)&&!l(Qe))return p(yt)||(yt=function(Bi,Yt){if(o(mi)&&(Yt=w(mi,this,Bi,Yt)),!l(Yt))return Yt}),ht[1]=yt,L(h,null,ht)}}),!M[Lt]){var Et=M.valueOf;ze(M,Lt,function(Qe){return w(Et,this)})}Rt(z,Be),ft[wt]=!0},2990:(F,Y,e)=>{"use strict";var i=e(1702),c=e(260),d=i(e(1048)),L=c.aTypedArray;(0,c.exportTypedArrayMethod)("copyWithin",function(w,A){return d(L(this),w,A,arguments.length>2?arguments[2]:void 0)})},8927:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).every,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("every",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},3105:(F,Y,e)=>{"use strict";var i=e(260),c=e(6916),d=e(1285),L=i.aTypedArray;(0,i.exportTypedArrayMethod)("fill",function(w){var A=arguments.length;return c(d,L(this),w,A>1?arguments[1]:void 0,A>2?arguments[2]:void 0)})},5035:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).filter,d=e(3074),L=i.aTypedArray;(0,i.exportTypedArrayMethod)("filter",function(w){var A=c(L(this),w,arguments.length>1?arguments[1]:void 0);return d(this,A)})},7174:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).findIndex,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("findIndex",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},4345:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).find,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("find",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},2846:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).forEach,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("forEach",function(L){c(d(this),L,arguments.length>1?arguments[1]:void 0)})},4731:(F,Y,e)=>{"use strict";var i=e(260),c=e(1318).includes,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("includes",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},7209:(F,Y,e)=>{"use strict";var i=e(260),c=e(1318).indexOf,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("indexOf",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},6319:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=e(6530).PROPER,L=e(260),w=e(6992),A=e(5112)("iterator"),C=i.Uint8Array,S=c(w.values),n=c(w.keys),v=c(w.entries),R=L.aTypedArray,p=L.exportTypedArrayMethod,o=C&&C.prototype[A],f=!!o&&"values"===o.name,I=function(){return S(R(this))};p("entries",function(){return v(R(this))}),p("keys",function(){return n(R(this))}),p("values",I,d&&!f),p(A,I,d&&!f)},8867:(F,Y,e)=>{"use strict";var i=e(260),c=e(1702),d=i.aTypedArray,L=i.exportTypedArrayMethod,w=c([].join);L("join",function(A){return w(d(this),A)})},7789:(F,Y,e)=>{"use strict";var i=e(260),c=e(2104),d=e(6583),L=i.aTypedArray;(0,i.exportTypedArrayMethod)("lastIndexOf",function(w){var A=arguments.length;return c(d,L(this),A>1?[w,arguments[1]]:[w])})},3739:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).map,d=e(6304),L=i.aTypedArray;(0,i.exportTypedArrayMethod)("map",function(w){return c(L(this),w,arguments.length>1?arguments[1]:void 0,function(A,C){return new(d(A))(C)})})},4483:(F,Y,e)=>{"use strict";var i=e(260),c=e(3671).right,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduceRight",function(L){var w=arguments.length;return c(d(this),L,w,w>1?arguments[1]:void 0)})},9368:(F,Y,e)=>{"use strict";var i=e(260),c=e(3671).left,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduce",function(L){var w=arguments.length;return c(d(this),L,w,w>1?arguments[1]:void 0)})},2056:(F,Y,e)=>{"use strict";var i=e(260),c=i.aTypedArray,L=Math.floor;(0,i.exportTypedArrayMethod)("reverse",function(){for(var w,A=this,C=c(A).length,S=L(C/2),n=0;n<S;)w=A[n],A[n++]=A[--C],A[C]=w;return A})},3462:(F,Y,e)=>{"use strict";var i=e(7854),c=e(260),d=e(6244),L=e(4590),w=e(7908),A=e(7293),C=i.RangeError,S=c.aTypedArray;(0,c.exportTypedArrayMethod)("set",function(n){S(this);var v=L(arguments.length>1?arguments[1]:void 0,1),R=this.length,p=w(n),o=d(p),f=0;if(o+v>R)throw C("Wrong length");for(;f<o;)this[v+f]=p[f++]},A(function(){new Int8Array(1).set({})}))},678:(F,Y,e)=>{"use strict";var i=e(260),c=e(6304),d=e(7293),L=e(206),w=i.aTypedArray;(0,i.exportTypedArrayMethod)("slice",function(A,C){for(var S=L(w(this),A,C),n=c(this),v=0,R=S.length,p=new n(R);R>v;)p[v]=S[v++];return p},d(function(){new Int8Array(1).slice()}))},7462:(F,Y,e)=>{"use strict";var i=e(260),c=e(2092).some,d=i.aTypedArray;(0,i.exportTypedArrayMethod)("some",function(L){return c(d(this),L,arguments.length>1?arguments[1]:void 0)})},3824:(F,Y,e)=>{"use strict";var i=e(7854),c=e(1702),d=e(7293),L=e(9662),w=e(4362),A=e(260),C=e(8886),S=e(256),n=e(7392),v=e(8008),R=i.Array,p=A.aTypedArray,o=A.exportTypedArrayMethod,f=i.Uint16Array,I=f&&c(f.prototype.sort),l=!(!I||d(function(){I(new f(2),null)})&&d(function(){I(new f(2),{})})),V=!!I&&!d(function(){if(n)return n<74;if(C)return C<67;if(S)return!0;if(v)return v<602;var T,b,H=new f(516),ne=R(516);for(T=0;T<516;T++)b=T%4,H[T]=515-T,ne[T]=T-2*b+3;for(I(H,function(le,W){return(le/4|0)-(W/4|0)}),T=0;T<516;T++)if(H[T]!==ne[T])return!0});o("sort",function(T){return void 0!==T&&L(T),V?I(this,T):w(p(this),(b=T,function(H,ne){return void 0!==b?+b(H,ne)||0:ne!=ne?-1:H!=H?1:0===H&&0===ne?1/H>0&&1/ne<0?1:-1:H>ne}));var b},!V||l)},5021:(F,Y,e)=>{"use strict";var i=e(260),c=e(7466),d=e(1400),L=e(6304),w=i.aTypedArray;(0,i.exportTypedArrayMethod)("subarray",function(A,C){var S=w(this),n=S.length,v=d(A,n);return new(L(S))(S.buffer,S.byteOffset+v*S.BYTES_PER_ELEMENT,c((void 0===C?n:d(C,n))-v))})},2974:(F,Y,e)=>{"use strict";var i=e(7854),c=e(2104),d=e(260),L=e(7293),w=e(206),A=i.Int8Array,C=d.aTypedArray,S=d.exportTypedArrayMethod,n=[].toLocaleString,v=!!A&&L(function(){n.call(new A(1))});S("toLocaleString",function(){return c(n,v?w(C(this)):C(this),w(arguments))},L(function(){return[1,2].toLocaleString()!=new A([1,2]).toLocaleString()})||!L(function(){A.prototype.toLocaleString.call([1,2])}))},5016:(F,Y,e)=>{"use strict";var i=e(260).exportTypedArrayMethod,c=e(7293),d=e(7854),L=e(1702),w=d.Uint8Array,A=w&&w.prototype||{},C=[].toString,S=L([].join);c(function(){C.call({})})&&(C=function(){return S(this)}),i("toString",C,A.toString!=C)},2472:(F,Y,e)=>{e(9843)("Uint8",function(i){return function(c,d,L){return i(this,c,d,L)}})},9743:(F,Y,e)=>{e(9843)("Uint8",function(i){return function(c,d,L){return i(this,c,d,L)}},!0)},4129:(F,Y,e)=>{"use strict";var i,c=e(7854),d=e(1702),L=e(2248),w=e(2423),A=e(7710),C=e(9320),S=e(111),n=e(9909).enforce,v=e(8536),R=!c.ActiveXObject&&"ActiveXObject"in c,p=Object.isExtensible,o=function(H){return function(){return H(this,arguments.length?arguments[0]:void 0)}},f=A("WeakMap",o,C);if(v&&R){i=C.getConstructor(o,"WeakMap",!0),w.enable();var I=f.prototype,l=d(I.delete),V=d(I.has),T=d(I.get),b=d(I.set);L(I,{delete:function(H){if(S(H)&&!p(H)){var ne=n(this);return ne.frozen||(ne.frozen=new i),l(this,H)||ne.frozen.delete(H)}return l(this,H)},has:function(H){if(S(H)&&!p(H)){var ne=n(this);return ne.frozen||(ne.frozen=new i),V(this,H)||ne.frozen.has(H)}return V(this,H)},get:function(H){if(S(H)&&!p(H)){var ne=n(this);return ne.frozen||(ne.frozen=new i),V(this,H)?T(this,H):ne.frozen.get(H)}return T(this,H)},set:function(H,ne){if(S(H)&&!p(H)){var le=n(this);le.frozen||(le.frozen=new i),V(this,H)?b(this,H,ne):le.frozen.set(H,ne)}else b(this,H,ne);return this}})}},4747:(F,Y,e)=>{var i=e(7854),c=e(8324),d=e(8509),L=e(8533),w=e(8880),A=function(S){if(S&&S.forEach!==L)try{w(S,"forEach",L)}catch(n){S.forEach=L}};for(var C in c)c[C]&&A(i[C]&&i[C].prototype);A(d)},3948:(F,Y,e)=>{var i=e(7854),c=e(8324),d=e(8509),L=e(6992),w=e(8880),A=e(5112),C=A("iterator"),S=A("toStringTag"),n=L.values,v=function(p,o){if(p){if(p[C]!==n)try{w(p,C,n)}catch(I){p[C]=n}if(p[S]||w(p,S,o),c[o])for(var f in L)if(p[f]!==L[f])try{w(p,f,L[f])}catch(I){p[f]=L[f]}}};for(var R in c)v(i[R]&&i[R].prototype,R);v(d,"DOMTokenList")},2564:(F,Y,e)=>{var i=e(2109),c=e(7854),d=e(2104),L=e(614),w=e(8113),A=e(206),C=/MSIE .\./.test(w),S=c.Function,n=function(v){return function(R,p){var o=arguments.length>2,f=o?A(arguments,2):void 0;return v(o?function(){d(L(R)?R:S(R),this,f)}:R,p)}};i({global:!0,bind:!0,forced:C},{setTimeout:n(c.setTimeout),setInterval:n(c.setInterval)})},1637:(F,Y,e)=>{"use strict";e(6992);var i=e(2109),c=e(7854),d=e(5005),L=e(6916),w=e(1702),A=e(590),C=e(1320),S=e(2248),n=e(8003),v=e(4994),R=e(9909),p=e(5787),o=e(614),f=e(2597),I=e(9974),l=e(648),V=e(9670),T=e(111),b=e(1340),H=e(30),ne=e(9114),le=e(8554),W=e(1246),be=e(5112),de=e(4362),ce=be("iterator"),Ee="URLSearchParams",Ne="URLSearchParamsIterator",Oe=R.set,He=R.getterFor(Ee),ke=R.getterFor(Ne),ze=d("fetch"),we=d("Request"),gt=d("Headers"),ft=we&&we.prototype,at=gt&&gt.prototype,Ze=c.RegExp,ie=c.TypeError,bt=c.decodeURIComponent,Rt=c.encodeURIComponent,Ct=w("".charAt),et=w([].join),wt=w([].push),Be=w("".replace),Lt=w([].shift),jt=w([].splice),Ge=w("".split),Pt=w("".slice),z=/\+/g,M=Array(4),t=function(ge){return M[ge-1]||(M[ge-1]=Ze("((?:%[\\da-f]{2}){"+ge+"})","gi"))},u=function(ge){try{return bt(ge)}catch(Pe){return ge}},h=function(ge){var Pe=Be(ge,z," "),xe=4;try{return bt(Pe)}catch(We){for(;xe;)Pe=Be(Pe,t(xe--),u);return Pe}},y=/[!'()~]|%20/g,a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},m=function(ge){return a[ge]},_=function(ge){return Be(Rt(ge),y,m)},P=function(ge,Pe){if(Pe)for(var xe,We,rt=Ge(Pe,"&"),Et=0;Et<rt.length;)(xe=rt[Et++]).length&&(We=Ge(xe,"="),wt(ge,{key:h(Lt(We)),value:h(et(We,"="))}))},x=function(ge){this.entries.length=0,P(this.entries,ge)},oe=function(ge,Pe){if(ge<Pe)throw ie("Not enough arguments")},K=v(function(ge,Pe){Oe(this,{type:Ne,iterator:le(He(ge).entries),kind:Pe})},"Iterator",function(){var ge=ke(this),Pe=ge.kind,xe=ge.iterator.next(),We=xe.value;return xe.done||(xe.value="keys"===Pe?We.key:"values"===Pe?We.value:[We.key,We.value]),xe}),X=function(){p(this,me);var ge,Pe,xe,We,rt,Et,Qe,yt,ct,ht=arguments.length>0?arguments[0]:void 0,mi=this,Bi=[];if(Oe(mi,{type:Ee,entries:Bi,updateURL:function(){},updateSearchParams:x}),void 0!==ht)if(T(ht))if(ge=W(ht))for(xe=(Pe=le(ht,ge)).next;!(We=L(xe,Pe)).done;){if(Et=(rt=le(V(We.value))).next,(Qe=L(Et,rt)).done||(yt=L(Et,rt)).done||!L(Et,rt).done)throw ie("Expected sequence with length 2");wt(Bi,{key:b(Qe.value),value:b(yt.value)})}else for(ct in ht)f(ht,ct)&&wt(Bi,{key:ct,value:b(ht[ct])});else P(Bi,"string"==typeof ht?"?"===Ct(ht,0)?Pt(ht,1):ht:b(ht))},me=X.prototype;if(S(me,{append:function(ge,Pe){oe(arguments.length,2);var xe=He(this);wt(xe.entries,{key:b(ge),value:b(Pe)}),xe.updateURL()},delete:function(ge){oe(arguments.length,1);for(var Pe=He(this),xe=Pe.entries,We=b(ge),rt=0;rt<xe.length;)xe[rt].key===We?jt(xe,rt,1):rt++;Pe.updateURL()},get:function(ge){oe(arguments.length,1);for(var Pe=He(this).entries,xe=b(ge),We=0;We<Pe.length;We++)if(Pe[We].key===xe)return Pe[We].value;return null},getAll:function(ge){oe(arguments.length,1);for(var Pe=He(this).entries,xe=b(ge),We=[],rt=0;rt<Pe.length;rt++)Pe[rt].key===xe&&wt(We,Pe[rt].value);return We},has:function(ge){oe(arguments.length,1);for(var Pe=He(this).entries,xe=b(ge),We=0;We<Pe.length;)if(Pe[We++].key===xe)return!0;return!1},set:function(ge,Pe){oe(arguments.length,1);for(var xe,We=He(this),rt=We.entries,Et=!1,Qe=b(ge),yt=b(Pe),ct=0;ct<rt.length;ct++)(xe=rt[ct]).key===Qe&&(Et?jt(rt,ct--,1):(Et=!0,xe.value=yt));Et||wt(rt,{key:Qe,value:yt}),We.updateURL()},sort:function(){var ge=He(this);de(ge.entries,function(Pe,xe){return Pe.key>xe.key?1:-1}),ge.updateURL()},forEach:function(ge){for(var Pe,xe=He(this).entries,We=I(ge,arguments.length>1?arguments[1]:void 0),rt=0;rt<xe.length;)We((Pe=xe[rt++]).value,Pe.key,this)},keys:function(){return new K(this,"keys")},values:function(){return new K(this,"values")},entries:function(){return new K(this,"entries")}},{enumerable:!0}),C(me,ce,me.entries,{name:"entries"}),C(me,"toString",function(){for(var ge,Pe=He(this).entries,xe=[],We=0;We<Pe.length;)ge=Pe[We++],wt(xe,_(ge.key)+"="+_(ge.value));return et(xe,"&")},{enumerable:!0}),n(X,Ee),i({global:!0,forced:!A},{URLSearchParams:X}),!A&&o(gt)){var Q=w(at.has),re=w(at.set),ye=function(ge){if(T(ge)){var Pe,xe=ge.body;if(l(xe)===Ee)return Pe=ge.headers?new gt(ge.headers):new gt,Q(Pe,"content-type")||re(Pe,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),H(ge,{body:ne(0,b(xe)),headers:ne(0,Pe)})}return ge};if(o(ze)&&i({global:!0,enumerable:!0,forced:!0},{fetch:function(ge){return ze(ge,arguments.length>1?ye(arguments[1]):{})}}),o(we)){var Se=function(ge){return p(this,ft),new we(ge,arguments.length>1?ye(arguments[1]):{})};ft.constructor=Se,Se.prototype=ft,i({global:!0,forced:!0},{Request:Se})}}F.exports={URLSearchParams:X,getState:He}},285:(F,Y,e)=>{"use strict";e(8783);var i,c=e(2109),d=e(9781),L=e(590),w=e(7854),A=e(9974),C=e(6916),S=e(1702),n=e(6048),v=e(1320),R=e(5787),p=e(2597),o=e(1574),f=e(8457),I=e(206),l=e(8710).codeAt,V=e(3197),T=e(1340),b=e(8003),H=e(1637),ne=e(9909),le=ne.set,W=ne.getterFor("URL"),be=H.URLSearchParams,de=H.getState,ce=w.URL,Ee=w.TypeError,Ne=w.parseInt,Oe=Math.floor,He=Math.pow,ke=S("".charAt),ze=S(/./.exec),we=S([].join),gt=S(1..toString),ft=S([].pop),at=S([].push),Ze=S("".replace),ie=S([].shift),bt=S("".split),Rt=S("".slice),Ct=S("".toLowerCase),et=S([].unshift),wt="Invalid scheme",Be="Invalid host",Lt="Invalid port",jt=/[a-z]/i,Ge=/[\d+-.a-z]/i,Pt=/\d/,z=/^0x/i,M=/^[0-7]+$/,t=/^\d+$/,u=/^[\da-f]+$/i,h=/[\0\t\n\r #%/:<>?@[\\\]^|]/,y=/[\0\t\n\r #/:<>?@[\\\]^|]/,a=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,m=/[\t\n\r]/g,_=function(Re,lt){var It,it,Bt;if("["==ke(lt,0)){if("]"!=ke(lt,lt.length-1)||!(It=x(Rt(lt,1,-1))))return Be;Re.host=It}else if(Se(Re)){if(lt=V(lt),ze(h,lt)||null===(It=P(lt)))return Be;Re.host=It}else{if(ze(y,lt))return Be;for(It="",it=f(lt),Bt=0;Bt<it.length;Bt++)It+=re(it[Bt],K);Re.host=It}},P=function(Re){var lt,It,it,Bt,nt,vi,di,ai=bt(Re,".");if(ai.length&&""==ai[ai.length-1]&&ai.length--,(lt=ai.length)>4)return Re;for(It=[],it=0;it<lt;it++){if(""==(Bt=ai[it]))return Re;if(nt=10,Bt.length>1&&"0"==ke(Bt,0)&&(nt=ze(z,Bt)?16:8,Bt=Rt(Bt,8==nt?1:2)),""===Bt)vi=0;else{if(!ze(10==nt?t:8==nt?M:u,Bt))return Re;vi=Ne(Bt,nt)}at(It,vi)}for(it=0;it<lt;it++)if(vi=It[it],it==lt-1){if(vi>=He(256,5-lt))return null}else if(vi>255)return null;for(di=ft(It),it=0;it<It.length;it++)di+=It[it]*He(256,3-it);return di},x=function(Re){var lt,It,it,Bt,nt,vi,di,ai=[0,0,0,0,0,0,0,0],Mt=0,Vt=null,Ft=0,ui=function(){return ke(Re,Ft)};if(":"==ui()){if(":"!=ke(Re,1))return;Ft+=2,Vt=++Mt}for(;ui();){if(8==Mt)return;if(":"!=ui()){for(lt=It=0;It<4&&ze(u,ui());)lt=16*lt+Ne(ui(),16),Ft++,It++;if("."==ui()){if(0==It||(Ft-=It,Mt>6))return;for(it=0;ui();){if(Bt=null,it>0){if(!("."==ui()&&it<4))return;Ft++}if(!ze(Pt,ui()))return;for(;ze(Pt,ui());){if(nt=Ne(ui(),10),null===Bt)Bt=nt;else{if(0==Bt)return;Bt=10*Bt+nt}if(Bt>255)return;Ft++}ai[Mt]=256*ai[Mt]+Bt,2!=++it&&4!=it||Mt++}if(4!=it)return;break}if(":"==ui()){if(Ft++,!ui())return}else if(ui())return;ai[Mt++]=lt}else{if(null!==Vt)return;Ft++,Vt=++Mt}}if(null!==Vt)for(vi=Mt-Vt,Mt=7;0!=Mt&&vi>0;)di=ai[Mt],ai[Mt--]=ai[Vt+vi-1],ai[Vt+--vi]=di;else if(8!=Mt)return;return ai},oe=function(Re){var lt,It,it,Bt;if("number"==typeof Re){for(lt=[],It=0;It<4;It++)et(lt,Re%256),Re=Oe(Re/256);return we(lt,".")}if("object"==typeof Re){for(lt="",it=function(nt){for(var vi=null,di=1,ai=null,Mt=0,Vt=0;Vt<8;Vt++)0!==nt[Vt]?(Mt>di&&(vi=ai,di=Mt),ai=null,Mt=0):(null===ai&&(ai=Vt),++Mt);return Mt>di&&(vi=ai,di=Mt),vi}(Re),It=0;It<8;It++)Bt&&0===Re[It]||(Bt&&(Bt=!1),it===It?(lt+=It?":":"::",Bt=!0):(lt+=gt(Re[It],16),It<7&&(lt+=":")));return"["+lt+"]"}return Re},K={},X=o({},K,{" ":1,'"':1,"<":1,">":1,"`":1}),me=o({},X,{"#":1,"?":1,"{":1,"}":1}),Q=o({},me,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),re=function(Re,lt){var It=l(Re,0);return It>32&&It<127&&!p(lt,Re)?Re:encodeURIComponent(Re)},ye={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Se=function(Re){return p(ye,Re.scheme)},ge=function(Re){return""!=Re.username||""!=Re.password},Pe=function(Re){return!Re.host||Re.cannotBeABaseURL||"file"==Re.scheme},xe=function(Re,lt){var It;return 2==Re.length&&ze(jt,ke(Re,0))&&(":"==(It=ke(Re,1))||!lt&&"|"==It)},We=function(Re){var lt;return Re.length>1&&xe(Rt(Re,0,2))&&(2==Re.length||"/"===(lt=ke(Re,2))||"\\"===lt||"?"===lt||"#"===lt)},rt=function(Re){var lt=Re.path,It=lt.length;!It||"file"==Re.scheme&&1==It&&xe(lt[0],!0)||lt.length--},Et=function(Re){return"."===Re||"%2e"===Ct(Re)},Qe={},yt={},ct={},ht={},mi={},Bi={},Yt={},oi={},ei={},Ci={},Ai={},yi={},gi={},ki={},Gi={},_i={},Ni={},Oi={},cn={},Di={},ji={},Zi=function(Re,lt,It,it){var Bt,nt,vi,di,ai,Mt=It||Qe,Vt=0,Ft="",ui=!1,xn=!1,ea=!1;for(It||(Re.scheme="",Re.username="",Re.password="",Re.host=null,Re.port=null,Re.path=[],Re.query=null,Re.fragment=null,Re.cannotBeABaseURL=!1,lt=Ze(lt,a,"")),lt=Ze(lt,m,""),Bt=f(lt);Vt<=Bt.length;){switch(nt=Bt[Vt],Mt){case Qe:if(!nt||!ze(jt,nt)){if(It)return wt;Mt=ct;continue}Ft+=Ct(nt),Mt=yt;break;case yt:if(nt&&(ze(Ge,nt)||"+"==nt||"-"==nt||"."==nt))Ft+=Ct(nt);else{if(":"!=nt){if(It)return wt;Ft="",Mt=ct,Vt=0;continue}if(It&&(Se(Re)!=p(ye,Ft)||"file"==Ft&&(ge(Re)||null!==Re.port)||"file"==Re.scheme&&!Re.host))return;if(Re.scheme=Ft,It)return void(Se(Re)&&ye[Re.scheme]==Re.port&&(Re.port=null));Ft="","file"==Re.scheme?Mt=ki:Se(Re)&&it&&it.scheme==Re.scheme?Mt=ht:Se(Re)?Mt=oi:"/"==Bt[Vt+1]?(Mt=mi,Vt++):(Re.cannotBeABaseURL=!0,at(Re.path,""),Mt=cn)}break;case ct:if(!it||it.cannotBeABaseURL&&"#"!=nt)return wt;if(it.cannotBeABaseURL&&"#"==nt){Re.scheme=it.scheme,Re.path=I(it.path),Re.query=it.query,Re.fragment="",Re.cannotBeABaseURL=!0,Mt=ji;break}Mt="file"==it.scheme?ki:Bi;continue;case ht:if("/"!=nt||"/"!=Bt[Vt+1]){Mt=Bi;continue}Mt=ei,Vt++;break;case mi:if("/"==nt){Mt=Ci;break}Mt=Oi;continue;case Bi:if(Re.scheme=it.scheme,nt==i)Re.username=it.username,Re.password=it.password,Re.host=it.host,Re.port=it.port,Re.path=I(it.path),Re.query=it.query;else if("/"==nt||"\\"==nt&&Se(Re))Mt=Yt;else if("?"==nt)Re.username=it.username,Re.password=it.password,Re.host=it.host,Re.port=it.port,Re.path=I(it.path),Re.query="",Mt=Di;else{if("#"!=nt){Re.username=it.username,Re.password=it.password,Re.host=it.host,Re.port=it.port,Re.path=I(it.path),Re.path.length--,Mt=Oi;continue}Re.username=it.username,Re.password=it.password,Re.host=it.host,Re.port=it.port,Re.path=I(it.path),Re.query=it.query,Re.fragment="",Mt=ji}break;case Yt:if(!Se(Re)||"/"!=nt&&"\\"!=nt){if("/"!=nt){Re.username=it.username,Re.password=it.password,Re.host=it.host,Re.port=it.port,Mt=Oi;continue}Mt=Ci}else Mt=ei;break;case oi:if(Mt=ei,"/"!=nt||"/"!=ke(Ft,Vt+1))continue;Vt++;break;case ei:if("/"!=nt&&"\\"!=nt){Mt=Ci;continue}break;case Ci:if("@"==nt){ui&&(Ft="%40"+Ft),ui=!0,vi=f(Ft);for(var ta=0;ta<vi.length;ta++){var oa=vi[ta];if(":"!=oa||ea){var Mn=re(oa,Q);ea?Re.password+=Mn:Re.username+=Mn}else ea=!0}Ft=""}else if(nt==i||"/"==nt||"?"==nt||"#"==nt||"\\"==nt&&Se(Re)){if(ui&&""==Ft)return"Invalid authority";Vt-=f(Ft).length+1,Ft="",Mt=Ai}else Ft+=nt;break;case Ai:case yi:if(It&&"file"==Re.scheme){Mt=_i;continue}if(":"!=nt||xn){if(nt==i||"/"==nt||"?"==nt||"#"==nt||"\\"==nt&&Se(Re)){if(Se(Re)&&""==Ft)return Be;if(It&&""==Ft&&(ge(Re)||null!==Re.port))return;if(di=_(Re,Ft))return di;if(Ft="",Mt=Ni,It)return;continue}"["==nt?xn=!0:"]"==nt&&(xn=!1),Ft+=nt}else{if(""==Ft)return Be;if(di=_(Re,Ft))return di;if(Ft="",Mt=gi,It==yi)return}break;case gi:if(!ze(Pt,nt)){if(nt==i||"/"==nt||"?"==nt||"#"==nt||"\\"==nt&&Se(Re)||It){if(""!=Ft){var Wn=Ne(Ft,10);if(Wn>65535)return Lt;Re.port=Se(Re)&&Wn===ye[Re.scheme]?null:Wn,Ft=""}if(It)return;Mt=Ni;continue}return Lt}Ft+=nt;break;case ki:if(Re.scheme="file","/"==nt||"\\"==nt)Mt=Gi;else{if(!it||"file"!=it.scheme){Mt=Oi;continue}if(nt==i)Re.host=it.host,Re.path=I(it.path),Re.query=it.query;else if("?"==nt)Re.host=it.host,Re.path=I(it.path),Re.query="",Mt=Di;else{if("#"!=nt){We(we(I(Bt,Vt),""))||(Re.host=it.host,Re.path=I(it.path),rt(Re)),Mt=Oi;continue}Re.host=it.host,Re.path=I(it.path),Re.query=it.query,Re.fragment="",Mt=ji}}break;case Gi:if("/"==nt||"\\"==nt){Mt=_i;break}it&&"file"==it.scheme&&!We(we(I(Bt,Vt),""))&&(xe(it.path[0],!0)?at(Re.path,it.path[0]):Re.host=it.host),Mt=Oi;continue;case _i:if(nt==i||"/"==nt||"\\"==nt||"?"==nt||"#"==nt){if(!It&&xe(Ft))Mt=Oi;else if(""==Ft){if(Re.host="",It)return;Mt=Ni}else{if(di=_(Re,Ft))return di;if("localhost"==Re.host&&(Re.host=""),It)return;Ft="",Mt=Ni}continue}Ft+=nt;break;case Ni:if(Se(Re)){if(Mt=Oi,"/"!=nt&&"\\"!=nt)continue}else if(It||"?"!=nt)if(It||"#"!=nt){if(nt!=i&&(Mt=Oi,"/"!=nt))continue}else Re.fragment="",Mt=ji;else Re.query="",Mt=Di;break;case Oi:if(nt==i||"/"==nt||"\\"==nt&&Se(Re)||!It&&("?"==nt||"#"==nt)){if(".."===(ai=Ct(ai=Ft))||"%2e."===ai||".%2e"===ai||"%2e%2e"===ai?(rt(Re),"/"==nt||"\\"==nt&&Se(Re)||at(Re.path,"")):Et(Ft)?"/"==nt||"\\"==nt&&Se(Re)||at(Re.path,""):("file"==Re.scheme&&!Re.path.length&&xe(Ft)&&(Re.host&&(Re.host=""),Ft=ke(Ft,0)+":"),at(Re.path,Ft)),Ft="","file"==Re.scheme&&(nt==i||"?"==nt||"#"==nt))for(;Re.path.length>1&&""===Re.path[0];)ie(Re.path);"?"==nt?(Re.query="",Mt=Di):"#"==nt&&(Re.fragment="",Mt=ji)}else Ft+=re(nt,me);break;case cn:"?"==nt?(Re.query="",Mt=Di):"#"==nt?(Re.fragment="",Mt=ji):nt!=i&&(Re.path[0]+=re(nt,K));break;case Di:It||"#"!=nt?nt!=i&&("'"==nt&&Se(Re)?Re.query+="%27":Re.query+="#"==nt?"%23":re(nt,K)):(Re.fragment="",Mt=ji);break;case ji:nt!=i&&(Re.fragment+=re(nt,X))}Vt++}},bn=function(Re){var lt,It,it=R(this,qi),Bt=arguments.length>1?arguments[1]:void 0,nt=T(Re),vi=le(it,{type:"URL"});if(void 0!==Bt)try{lt=W(Bt)}catch(Mt){if(It=Zi(lt={},T(Bt)))throw Ee(It)}if(It=Zi(vi,nt,null,lt))throw Ee(It);var di=vi.searchParams=new be,ai=de(di);ai.updateSearchParams(vi.query),ai.updateURL=function(){vi.query=T(di)||null},d||(it.href=C(dn,it),it.origin=C(_n,it),it.protocol=C(Qn,it),it.username=C(Pi,it),it.password=C(un,it),it.host=C(Un,it),it.hostname=C(yn,it),it.port=C($n,it),it.pathname=C(Ln,it),it.search=C(Hi,it),it.searchParams=C(Hn,it),it.hash=C(Tn,it))},qi=bn.prototype,dn=function(){var Re=W(this),lt=Re.scheme,It=Re.username,it=Re.password,Bt=Re.host,nt=Re.port,vi=Re.path,di=Re.query,ai=Re.fragment,Mt=lt+":";return null!==Bt?(Mt+="//",ge(Re)&&(Mt+=It+(it?":"+it:"")+"@"),Mt+=oe(Bt),null!==nt&&(Mt+=":"+nt)):"file"==lt&&(Mt+="//"),Mt+=Re.cannotBeABaseURL?vi[0]:vi.length?"/"+we(vi,"/"):"",null!==di&&(Mt+="?"+di),null!==ai&&(Mt+="#"+ai),Mt},_n=function(){var Re=W(this),lt=Re.scheme,It=Re.port;if("blob"==lt)try{return new bn(lt.path[0]).origin}catch(it){return"null"}return"file"!=lt&&Se(Re)?lt+"://"+oe(Re.host)+(null!==It?":"+It:""):"null"},Qn=function(){return W(this).scheme+":"},Pi=function(){return W(this).username},un=function(){return W(this).password},Un=function(){var Re=W(this),lt=Re.host,It=Re.port;return null===lt?"":null===It?oe(lt):oe(lt)+":"+It},yn=function(){var Re=W(this).host;return null===Re?"":oe(Re)},$n=function(){var Re=W(this).port;return null===Re?"":T(Re)},Ln=function(){var Re=W(this),lt=Re.path;return Re.cannotBeABaseURL?lt[0]:lt.length?"/"+we(lt,"/"):""},Hi=function(){var Re=W(this).query;return Re?"?"+Re:""},Hn=function(){return W(this).searchParams},Tn=function(){var Re=W(this).fragment;return Re?"#"+Re:""},Ui=function(Re,lt){return{get:Re,set:lt,configurable:!0,enumerable:!0}};if(d&&n(qi,{href:Ui(dn,function(Re){var lt=W(this),It=T(Re),it=Zi(lt,It);if(it)throw Ee(it);de(lt.searchParams).updateSearchParams(lt.query)}),origin:Ui(_n),protocol:Ui(Qn,function(Re){var lt=W(this);Zi(lt,T(Re)+":",Qe)}),username:Ui(Pi,function(Re){var lt=W(this),It=f(T(Re));if(!Pe(lt)){lt.username="";for(var it=0;it<It.length;it++)lt.username+=re(It[it],Q)}}),password:Ui(un,function(Re){var lt=W(this),It=f(T(Re));if(!Pe(lt)){lt.password="";for(var it=0;it<It.length;it++)lt.password+=re(It[it],Q)}}),host:Ui(Un,function(Re){var lt=W(this);lt.cannotBeABaseURL||Zi(lt,T(Re),Ai)}),hostname:Ui(yn,function(Re){var lt=W(this);lt.cannotBeABaseURL||Zi(lt,T(Re),yi)}),port:Ui($n,function(Re){var lt=W(this);Pe(lt)||(""==(Re=T(Re))?lt.port=null:Zi(lt,Re,gi))}),pathname:Ui(Ln,function(Re){var lt=W(this);lt.cannotBeABaseURL||(lt.path=[],Zi(lt,T(Re),Ni))}),search:Ui(Hi,function(Re){var lt=W(this);""==(Re=T(Re))?lt.query=null:("?"==ke(Re,0)&&(Re=Rt(Re,1)),lt.query="",Zi(lt,Re,Di)),de(lt.searchParams).updateSearchParams(lt.query)}),searchParams:Ui(Hn),hash:Ui(Tn,function(Re){var lt=W(this);""!=(Re=T(Re))?("#"==ke(Re,0)&&(Re=Rt(Re,1)),lt.fragment="",Zi(lt,Re,ji)):lt.fragment=null})}),v(qi,"toJSON",function(){return C(dn,this)},{enumerable:!0}),v(qi,"toString",function(){return C(dn,this)},{enumerable:!0}),ce){var Zn=ce.createObjectURL,en=ce.revokeObjectURL;Zn&&v(bn,"createObjectURL",A(Zn,ce)),en&&v(bn,"revokeObjectURL",A(en,ce))}b(bn,"URL"),c({global:!0,forced:!L,sham:!d},{URL:bn})},3753:(F,Y,e)=>{"use strict";var i=e(2109),c=e(6916);i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return c(URL.prototype.toString,this)}})},7987:function(F,Y,e){var i,c;i=function(d){"use strict";var L,w,A={template:"[%t] %l:",levelFormatter:function(n){return n.toUpperCase()},nameFormatter:function(n){return n||"root"},timestampFormatter:function(n){return n.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},C={},S={reg:function(n){if(!n||!n.getLogger)throw new TypeError("Argument is not a root logger");L=n},apply:function(n,v){if(!n||!n.setLevel)throw new TypeError("Argument is not a logger");var R=n.methodFactory,p=n.name||"",o=C[p]||C[""]||A;return C[p]||(n.methodFactory=function(f,I,l){var V=R(f,I,l),T=C[l]||C[""],b=-1!==T.template.indexOf("%t"),H=-1!==T.template.indexOf("%l"),ne=-1!==T.template.indexOf("%n");return function(){for(var le="",W=arguments.length,be=Array(W),de=0;de<W;de++)be[de]=arguments[de];if(p||!C[l]){var ce=T.timestampFormatter(new Date),Ee=T.levelFormatter(f),Ne=T.nameFormatter(l);T.format?le+=T.format(Ee,Ne,ce):(le+=T.template,b&&(le=le.replace(/%t/,ce)),H&&(le=le.replace(/%l/,Ee)),ne&&(le=le.replace(/%n/,Ne))),be.length&&"string"==typeof be[0]?be[0]=le+" "+be[0]:be.unshift(le)}V.apply(void 0,be)}}),(v=v||{}).template&&(v.format=void 0),C[p]=function(f){for(var I,l=1,V=arguments.length;l<V;l++)for(I in arguments[l])Object.prototype.hasOwnProperty.call(arguments[l],I)&&(f[I]=arguments[l][I]);return f}({},o,v),n.setLevel(n.getLevel()),L||n.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),n}};return d&&(w=d.prefix,S.noConflict=function(){return d.prefix===S&&(d.prefix=w),S}),S},void 0===(c=i.call(Y,e,Y,F))||(F.exports=c)},2043:function(F,Y,e){var i,c;!function(d,L){"use strict";i=function(){var w=function(){},A="undefined",C=typeof window!==A&&typeof window.navigator!==A&&/Trident\/|MSIE /.test(window.navigator.userAgent),S=["trace","debug","info","warn","error"];function n(b,H){var ne=b[H];if("function"==typeof ne.bind)return ne.bind(b);try{return Function.prototype.bind.call(ne,b)}catch(le){return function(){return Function.prototype.apply.apply(ne,[b,arguments])}}}function v(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function R(b){return"debug"===b&&(b="log"),typeof console!==A&&("trace"===b&&C?v:void 0!==console[b]?n(console,b):void 0!==console.log?n(console,"log"):w)}function p(b,H){for(var ne=0;ne<S.length;ne++){var le=S[ne];this[le]=ne<b?w:this.methodFactory(le,b,H)}this.log=this.debug}function o(b,H,ne){return function(){typeof console!==A&&(p.call(this,H,ne),this[b].apply(this,arguments))}}function f(b,H,ne){return R(b)||o.apply(this,arguments)}function I(b,H,ne){var le,W=this,be="loglevel";function de(){var Ee;if(typeof window!==A&&be){try{Ee=window.localStorage[be]}catch(He){}if(typeof Ee===A)try{var Ne=window.document.cookie,Oe=Ne.indexOf(encodeURIComponent(be)+"=");-1!==Oe&&(Ee=/^([^;]+)/.exec(Ne.slice(Oe))[1])}catch(He){}return void 0===W.levels[Ee]&&(Ee=void 0),Ee}}"string"==typeof b?be+=":"+b:"symbol"==typeof b&&(be=void 0),W.name=b,W.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},W.methodFactory=ne||f,W.getLevel=function(){return le},W.setLevel=function(Ee,Ne){if("string"==typeof Ee&&void 0!==W.levels[Ee.toUpperCase()]&&(Ee=W.levels[Ee.toUpperCase()]),!("number"==typeof Ee&&Ee>=0&&Ee<=W.levels.SILENT))throw"log.setLevel() called with invalid level: "+Ee;if(le=Ee,!1!==Ne&&function(Oe){var He=(S[Oe]||"silent").toUpperCase();if(typeof window!==A&&be){try{return void(window.localStorage[be]=He)}catch(ke){}try{window.document.cookie=encodeURIComponent(be)+"="+He+";"}catch(ke){}}}(Ee),p.call(W,Ee,b),typeof console===A&&Ee<W.levels.SILENT)return"No console available for logging"},W.setDefaultLevel=function(Ee){de()||W.setLevel(Ee,!1)},W.enableAll=function(Ee){W.setLevel(W.levels.TRACE,Ee)},W.disableAll=function(Ee){W.setLevel(W.levels.SILENT,Ee)};var ce=de();null==ce&&(ce=null==H?"WARN":H),W.setLevel(ce,!1)}var l=new I,V={};l.getLogger=function(b){if("symbol"!=typeof b&&"string"!=typeof b||""===b)throw new TypeError("You must supply a name when creating a logger.");var H=V[b];return H||(H=V[b]=new I(b,l.getLevel(),l.methodFactory)),H};var T=typeof window!==A?window.log:void 0;return l.noConflict=function(){return typeof window!==A&&window.log===l&&(window.log=T),l},l.getLoggers=function(){return V},l.default=l,l},void 0===(c=i.call(Y,e,Y,F))||(F.exports=c)}()}},Wt={};function Ke(F){var Y=Wt[F];if(void 0!==Y)return Y.exports;var e=Wt[F]={id:F,loaded:!1,exports:{}};return tt[F].call(e.exports,e,e.exports,Ke),e.loaded=!0,e.exports}return Ke.amdO={},Ke.n=F=>{var Y=F&&F.__esModule?()=>F.default:()=>F;return Ke.d(Y,{a:Y}),Y},Ke.d=(F,Y)=>{for(var e in Y)Ke.o(Y,e)&&!Ke.o(F,e)&&Object.defineProperty(F,e,{enumerable:!0,get:Y[e]})},Ke.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(F){if("object"==typeof window)return window}}(),Ke.hmd=F=>((F=Object.create(F)).children||(F.children=[]),Object.defineProperty(F,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+F.id)}}),F),Ke.o=(F,Y)=>Object.prototype.hasOwnProperty.call(F,Y),Ke.r=F=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},Ke(4918)})()});
//# sourceMappingURL=scripts.f49bd47a2644718a.js.map