var xo=Object.defineProperty,Wo=Object.defineProperties,jo=Object.getOwnPropertyDescriptors,so=Object.getOwnPropertySymbols,Vo=Object.prototype.hasOwnProperty,Fo=Object.prototype.propertyIsEnumerable,lo=(nt,Lt,Ze)=>Lt in nt?xo(nt,Lt,{enumerable:!0,configurable:!0,writable:!0,value:Ze}):nt[Lt]=Ze,ui=(nt,Lt)=>{for(var Ze in Lt||(Lt={}))Vo.call(Lt,Ze)&&lo(nt,Ze,Lt[Ze]);if(so)for(var Ze of so(Lt))Fo.call(Lt,Ze)&&lo(nt,Ze,Lt[Ze]);return nt},hr=(nt,Lt)=>Wo(nt,jo(Lt));!function(nt,Lt){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=nt.document?Lt(nt,!0):function(Ze){if(!Ze.document)throw new Error("jQuery requires a window with a document");return Lt(Ze)}:Lt(nt)}("undefined"!=typeof window?window:this,function(nt,Lt){"use strict";var Ze=[],V=Object.getPrototypeOf,J=Ze.slice,e=Ze.flat?function(p){return Ze.flat.call(p)}:function(p){return Ze.concat.apply([],p)},i=Ze.push,d=Ze.indexOf,h={},P=h.toString,w=h.hasOwnProperty,M=w.toString,C=M.call(Object),S={},n=function(p){return"function"==typeof p&&"number"!=typeof p.nodeType&&"function"!=typeof p.item},y=function(p){return null!=p&&p===p.window},R=nt.document,m={type:!0,src:!0,nonce:!0,noModule:!0};function u(p,N,B){var Q,pe,ve=(B=B||R).createElement("script");if(ve.text=p,N)for(Q in m)(pe=N[Q]||N.getAttribute&&N.getAttribute(Q))&&ve.setAttribute(Q,pe);B.head.appendChild(ve).parentNode.removeChild(ve)}function f(p){return null==p?p+"":"object"==typeof p||"function"==typeof p?h[P.call(p)]||"object":typeof p}var I="3.6.0",c=function(p,N){return new c.fn.init(p,N)};function j(p){var N=!!p&&"length"in p&&p.length,B=f(p);return!n(p)&&!y(p)&&("array"===B||0===N||"number"==typeof N&&0<N&&N-1 in p)}c.fn=c.prototype={jquery:I,constructor:c,length:0,toArray:function(){return J.call(this)},get:function(p){return null==p?J.call(this):p<0?this[p+this.length]:this[p]},pushStack:function(p){var N=c.merge(this.constructor(),p);return N.prevObject=this,N},each:function(p){return c.each(this,p)},map:function(p){return this.pushStack(c.map(this,function(N,B){return p.call(N,B,N)}))},slice:function(){return this.pushStack(J.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(c.grep(this,function(p,N){return(N+1)%2}))},odd:function(){return this.pushStack(c.grep(this,function(p,N){return N%2}))},eq:function(p){var N=this.length,B=+p+(p<0?N:0);return this.pushStack(0<=B&&B<N?[this[B]]:[])},end:function(){return this.prevObject||this.constructor()},push:i,sort:Ze.sort,splice:Ze.splice},c.extend=c.fn.extend=function(){var p,N,B,Q,pe,ve,be=arguments[0]||{},Ue=1,xe=arguments.length,qe=!1;for("boolean"==typeof be&&(qe=be,be=arguments[Ue]||{},Ue++),"object"==typeof be||n(be)||(be={}),Ue===xe&&(be=this,Ue--);Ue<xe;Ue++)if(null!=(p=arguments[Ue]))for(N in p)Q=p[N],"__proto__"!==N&&be!==Q&&(qe&&Q&&(c.isPlainObject(Q)||(pe=Array.isArray(Q)))?(B=be[N],ve=pe&&!Array.isArray(B)?[]:pe||c.isPlainObject(B)?B:{},pe=!1,be[N]=c.extend(qe,ve,Q)):void 0!==Q&&(be[N]=Q));return be},c.extend({expando:"jQuery"+(I+Math.random()).replace(/\D/g,""),isReady:!0,error:function(p){throw new Error(p)},noop:function(){},isPlainObject:function(p){var N,B;return!(!p||"[object Object]"!==P.call(p)||(N=V(p))&&("function"!=typeof(B=w.call(N,"constructor")&&N.constructor)||M.call(B)!==C))},isEmptyObject:function(p){var N;for(N in p)return!1;return!0},globalEval:function(p,N,B){u(p,{nonce:N&&N.nonce},B)},each:function(p,N){var B,Q=0;if(j(p))for(B=p.length;Q<B&&!1!==N.call(p[Q],Q,p[Q]);Q++);else for(Q in p)if(!1===N.call(p[Q],Q,p[Q]))break;return p},makeArray:function(p,N){var B=N||[];return null!=p&&(j(Object(p))?c.merge(B,"string"==typeof p?[p]:p):i.call(B,p)),B},inArray:function(p,N,B){return null==N?-1:d.call(N,p,B)},merge:function(p,N){for(var B=+N.length,Q=0,pe=p.length;Q<B;Q++)p[pe++]=N[Q];return p.length=pe,p},grep:function(p,N,B){for(var Q=[],pe=0,ve=p.length,be=!B;pe<ve;pe++)!N(p[pe],pe)!==be&&Q.push(p[pe]);return Q},map:function(p,N,B){var Q,pe,ve=0,be=[];if(j(p))for(Q=p.length;ve<Q;ve++)null!=(pe=N(p[ve],ve,B))&&be.push(pe);else for(ve in p)null!=(pe=N(p[ve],ve,B))&&be.push(pe);return e(be)},guid:1,support:S}),"function"==typeof Symbol&&(c.fn[Symbol.iterator]=Ze[Symbol.iterator]),c.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(p,N){h["[object "+N+"]"]=N.toLowerCase()});var q=function(p){var N,B,Q,pe,ve,be,Ue,xe,qe,Ke,pt,Qe,$e,Ae,W,oe,De,Be,it,ft="sizzle"+1*new Date,Tt=p.document,Qt=0,Ht=0,ti=Aa(),li=Aa(),Li=Aa(),Si=Aa(),ei=function(ye,Le){return ye===Le&&(pt=!0),0},xi={}.hasOwnProperty,vt=[],di=vt.pop,Wi=vt.push,bi=vt.push,pn=vt.slice,gn=function(ye,Le){for(var Ge=0,st=ye.length;Ge<st;Ge++)if(ye[Ge]===Le)return Ge;return-1},Wn="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Zt="[\\x20\\t\\r\\n\\f]",ci="(?:\\\\[\\da-fA-F]{1,6}"+Zt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Gi="\\["+Zt+"*("+ci+")(?:"+Zt+"*([*^$|!~]?=)"+Zt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ci+"))|)"+Zt+"*\\]",wn=":("+ci+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Gi+")*)|.*)\\)|)",Bi=new RegExp(Zt+"+","g"),En=new RegExp("^"+Zt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Zt+"+$","g"),Zn=new RegExp("^"+Zt+"*,"+Zt+"*"),nn=new RegExp("^"+Zt+"*([>+~]|"+Zt+")"+Zt+"*"),Ri=new RegExp(Zt+"|>"),Va=new RegExp(wn),pa=new RegExp("^"+ci+"$"),Ta={ID:new RegExp("^#("+ci+")"),CLASS:new RegExp("^\\.("+ci+")"),TAG:new RegExp("^("+ci+"|[*])"),ATTR:new RegExp("^"+Gi),PSEUDO:new RegExp("^"+wn),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Zt+"*(even|odd|(([+-]|)(\\d*)n|)"+Zt+"*(?:([+-]|)"+Zt+"*(\\d+)|))"+Zt+"*\\)|)","i"),bool:new RegExp("^(?:"+Wn+")$","i"),needsContext:new RegExp("^"+Zt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Zt+"*((?:-\\d)?\\d*)"+Zt+"*\\)|)(?=[^-]|$)","i")},Za=/HTML$/i,an=/^(?:input|select|textarea|button)$/i,yn=/^h\d$/i,Sn=/^[^{]+\{\s*\[native \w/,An=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Mn=/[+~]/,ea=new RegExp("\\\\[\\da-fA-F]{1,6}"+Zt+"?|\\\\([^\\r\\n\\f])","g"),jn=function(ye,Le){var Ge="0x"+ye.slice(1)-65536;return Le||(Ge<0?String.fromCharCode(Ge+65536):String.fromCharCode(Ge>>10|55296,1023&Ge|56320))},er=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,tr=function(ye,Le){return Le?"\0"===ye?"\ufffd":ye.slice(0,-1)+"\\"+ye.charCodeAt(ye.length-1).toString(16)+" ":"\\"+ye},Ia=function(){Qe()},vn=Oa(function(ye){return!0===ye.disabled&&"fieldset"===ye.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{bi.apply(vt=pn.call(Tt.childNodes),Tt.childNodes)}catch(ye){bi={apply:vt.length?function(Le,Ge){Wi.apply(Le,pn.call(Ge))}:function(Le,Ge){for(var st=Le.length,He=0;Le[st++]=Ge[He++];);Le.length=st-1}}}function Mi(ye,Le,Ge,st){var He,Ct,St,_t,Nt,Xt,qt,Kt=Le&&Le.ownerDocument,mi=Le?Le.nodeType:9;if(Ge=Ge||[],"string"!=typeof ye||!ye||1!==mi&&9!==mi&&11!==mi)return Ge;if(!st&&(Qe(Le),Le=Le||$e,W)){if(11!==mi&&(Nt=An.exec(ye)))if(He=Nt[1]){if(9===mi){if(!(St=Le.getElementById(He)))return Ge;if(St.id===He)return Ge.push(St),Ge}else if(Kt&&(St=Kt.getElementById(He))&&it(Le,St)&&St.id===He)return Ge.push(St),Ge}else{if(Nt[2])return bi.apply(Ge,Le.getElementsByTagName(ye)),Ge;if((He=Nt[3])&&B.getElementsByClassName&&Le.getElementsByClassName)return bi.apply(Ge,Le.getElementsByClassName(He)),Ge}if(B.qsa&&!Si[ye+" "]&&(!oe||!oe.test(ye))&&(1!==mi||"object"!==Le.nodeName.toLowerCase())){if(qt=ye,Kt=Le,1===mi&&(Ri.test(ye)||nn.test(ye))){for((Kt=Mn.test(ye)&&zi(Le.parentNode)||Le)===Le&&B.scope||((_t=Le.getAttribute("id"))?_t=_t.replace(er,tr):Le.setAttribute("id",_t=ft)),Ct=(Xt=be(ye)).length;Ct--;)Xt[Ct]=(_t?"#"+_t:":scope")+" "+Ra(Xt[Ct]);qt=Xt.join(",")}try{return bi.apply(Ge,Kt.querySelectorAll(qt)),Ge}catch(qi){Si(ye,!0)}finally{_t===ft&&Le.removeAttribute("id")}}}return xe(ye.replace(En,"$1"),Le,Ge,st)}function Aa(){var ye=[];return function Le(Ge,st){return ye.push(Ge+" ")>Q.cacheLength&&delete Le[ye.shift()],Le[Ge+" "]=st}}function Un(ye){return ye[ft]=!0,ye}function On(ye){var Le=$e.createElement("fieldset");try{return!!ye(Le)}catch(Ge){return!1}finally{Le.parentNode&&Le.parentNode.removeChild(Le),Le=null}}function Fa(ye,Le){for(var Ge=ye.split("|"),st=Ge.length;st--;)Q.attrHandle[Ge[st]]=Le}function Ot(ye,Le){var Ge=Le&&ye,st=Ge&&1===ye.nodeType&&1===Le.nodeType&&ye.sourceIndex-Le.sourceIndex;if(st)return st;if(Ge)for(;Ge=Ge.nextSibling;)if(Ge===Le)return-1;return ye?1:-1}function Ma(ye){return function(Le){return"input"===Le.nodeName.toLowerCase()&&Le.type===ye}}function Ye(ye){return function(Le){var Ge=Le.nodeName.toLowerCase();return("input"===Ge||"button"===Ge)&&Le.type===ye}}function ut(ye){return function(Le){return"form"in Le?Le.parentNode&&!1===Le.disabled?"label"in Le?"label"in Le.parentNode?Le.parentNode.disabled===ye:Le.disabled===ye:Le.isDisabled===ye||Le.isDisabled!==!ye&&vn(Le)===ye:Le.disabled===ye:"label"in Le&&Le.disabled===ye}}function rn(ye){return Un(function(Le){return Le=+Le,Un(function(Ge,st){for(var He,Ct=ye([],Ge.length,Le),St=Ct.length;St--;)Ge[He=Ct[St]]&&(Ge[He]=!(st[He]=Ge[He]))})})}function zi(ye){return ye&&void 0!==ye.getElementsByTagName&&ye}for(N in B=Mi.support={},ve=Mi.isXML=function(ye){var Ge=ye&&(ye.ownerDocument||ye).documentElement;return!Za.test(ye&&ye.namespaceURI||Ge&&Ge.nodeName||"HTML")},Qe=Mi.setDocument=function(ye){var Le,Ge,st=ye?ye.ownerDocument||ye:Tt;return st!=$e&&9===st.nodeType&&st.documentElement&&(Ae=($e=st).documentElement,W=!ve($e),Tt!=$e&&(Ge=$e.defaultView)&&Ge.top!==Ge&&(Ge.addEventListener?Ge.addEventListener("unload",Ia,!1):Ge.attachEvent&&Ge.attachEvent("onunload",Ia)),B.scope=On(function(He){return Ae.appendChild(He).appendChild($e.createElement("div")),void 0!==He.querySelectorAll&&!He.querySelectorAll(":scope fieldset div").length}),B.attributes=On(function(He){return He.className="i",!He.getAttribute("className")}),B.getElementsByTagName=On(function(He){return He.appendChild($e.createComment("")),!He.getElementsByTagName("*").length}),B.getElementsByClassName=Sn.test($e.getElementsByClassName),B.getById=On(function(He){return Ae.appendChild(He).id=ft,!$e.getElementsByName||!$e.getElementsByName(ft).length}),B.getById?(Q.filter.ID=function(He){var Ct=He.replace(ea,jn);return function(St){return St.getAttribute("id")===Ct}},Q.find.ID=function(He,Ct){if(void 0!==Ct.getElementById&&W){var St=Ct.getElementById(He);return St?[St]:[]}}):(Q.filter.ID=function(He){var Ct=He.replace(ea,jn);return function(St){var _t=void 0!==St.getAttributeNode&&St.getAttributeNode("id");return _t&&_t.value===Ct}},Q.find.ID=function(He,Ct){if(void 0!==Ct.getElementById&&W){var St,_t,Nt,Xt=Ct.getElementById(He);if(Xt){if((St=Xt.getAttributeNode("id"))&&St.value===He)return[Xt];for(Nt=Ct.getElementsByName(He),_t=0;Xt=Nt[_t++];)if((St=Xt.getAttributeNode("id"))&&St.value===He)return[Xt]}return[]}}),Q.find.TAG=B.getElementsByTagName?function(He,Ct){return void 0!==Ct.getElementsByTagName?Ct.getElementsByTagName(He):B.qsa?Ct.querySelectorAll(He):void 0}:function(He,Ct){var St,_t=[],Nt=0,Xt=Ct.getElementsByTagName(He);if("*"===He){for(;St=Xt[Nt++];)1===St.nodeType&&_t.push(St);return _t}return Xt},Q.find.CLASS=B.getElementsByClassName&&function(He,Ct){if(void 0!==Ct.getElementsByClassName&&W)return Ct.getElementsByClassName(He)},De=[],oe=[],(B.qsa=Sn.test($e.querySelectorAll))&&(On(function(He){var Ct;Ae.appendChild(He).innerHTML="<a id='"+ft+"'></a><select id='"+ft+"-\r\\' msallowcapture=''><option selected=''></option></select>",He.querySelectorAll("[msallowcapture^='']").length&&oe.push("[*^$]="+Zt+"*(?:''|\"\")"),He.querySelectorAll("[selected]").length||oe.push("\\["+Zt+"*(?:value|"+Wn+")"),He.querySelectorAll("[id~="+ft+"-]").length||oe.push("~="),(Ct=$e.createElement("input")).setAttribute("name",""),He.appendChild(Ct),He.querySelectorAll("[name='']").length||oe.push("\\["+Zt+"*name"+Zt+"*="+Zt+"*(?:''|\"\")"),He.querySelectorAll(":checked").length||oe.push(":checked"),He.querySelectorAll("a#"+ft+"+*").length||oe.push(".#.+[+~]"),He.querySelectorAll("\\\f"),oe.push("[\\r\\n\\f]")}),On(function(He){He.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var Ct=$e.createElement("input");Ct.setAttribute("type","hidden"),He.appendChild(Ct).setAttribute("name","D"),He.querySelectorAll("[name=d]").length&&oe.push("name"+Zt+"*[*^$|!~]?="),2!==He.querySelectorAll(":enabled").length&&oe.push(":enabled",":disabled"),Ae.appendChild(He).disabled=!0,2!==He.querySelectorAll(":disabled").length&&oe.push(":enabled",":disabled"),He.querySelectorAll("*,:x"),oe.push(",.*:")})),(B.matchesSelector=Sn.test(Be=Ae.matches||Ae.webkitMatchesSelector||Ae.mozMatchesSelector||Ae.oMatchesSelector||Ae.msMatchesSelector))&&On(function(He){B.disconnectedMatch=Be.call(He,"*"),Be.call(He,"[s!='']:x"),De.push("!=",wn)}),oe=oe.length&&new RegExp(oe.join("|")),De=De.length&&new RegExp(De.join("|")),Le=Sn.test(Ae.compareDocumentPosition),it=Le||Sn.test(Ae.contains)?function(He,Ct){var St=9===He.nodeType?He.documentElement:He,_t=Ct&&Ct.parentNode;return He===_t||!(!_t||1!==_t.nodeType||!(St.contains?St.contains(_t):He.compareDocumentPosition&&16&He.compareDocumentPosition(_t)))}:function(He,Ct){if(Ct)for(;Ct=Ct.parentNode;)if(Ct===He)return!0;return!1},ei=Le?function(He,Ct){if(He===Ct)return pt=!0,0;var St=!He.compareDocumentPosition-!Ct.compareDocumentPosition;return St||(1&(St=(He.ownerDocument||He)==(Ct.ownerDocument||Ct)?He.compareDocumentPosition(Ct):1)||!B.sortDetached&&Ct.compareDocumentPosition(He)===St?He==$e||He.ownerDocument==Tt&&it(Tt,He)?-1:Ct==$e||Ct.ownerDocument==Tt&&it(Tt,Ct)?1:Ke?gn(Ke,He)-gn(Ke,Ct):0:4&St?-1:1)}:function(He,Ct){if(He===Ct)return pt=!0,0;var St,_t=0,Nt=He.parentNode,Xt=Ct.parentNode,qt=[He],Kt=[Ct];if(!Nt||!Xt)return He==$e?-1:Ct==$e?1:Nt?-1:Xt?1:Ke?gn(Ke,He)-gn(Ke,Ct):0;if(Nt===Xt)return Ot(He,Ct);for(St=He;St=St.parentNode;)qt.unshift(St);for(St=Ct;St=St.parentNode;)Kt.unshift(St);for(;qt[_t]===Kt[_t];)_t++;return _t?Ot(qt[_t],Kt[_t]):qt[_t]==Tt?-1:Kt[_t]==Tt?1:0}),$e},Mi.matches=function(ye,Le){return Mi(ye,null,null,Le)},Mi.matchesSelector=function(ye,Le){if(Qe(ye),B.matchesSelector&&W&&!Si[Le+" "]&&(!De||!De.test(Le))&&(!oe||!oe.test(Le)))try{var Ge=Be.call(ye,Le);if(Ge||B.disconnectedMatch||ye.document&&11!==ye.document.nodeType)return Ge}catch(st){Si(Le,!0)}return 0<Mi(Le,$e,null,[ye]).length},Mi.contains=function(ye,Le){return(ye.ownerDocument||ye)!=$e&&Qe(ye),it(ye,Le)},Mi.attr=function(ye,Le){(ye.ownerDocument||ye)!=$e&&Qe(ye);var Ge=Q.attrHandle[Le.toLowerCase()],st=Ge&&xi.call(Q.attrHandle,Le.toLowerCase())?Ge(ye,Le,!W):void 0;return void 0!==st?st:B.attributes||!W?ye.getAttribute(Le):(st=ye.getAttributeNode(Le))&&st.specified?st.value:null},Mi.escape=function(ye){return(ye+"").replace(er,tr)},Mi.error=function(ye){throw new Error("Syntax error, unrecognized expression: "+ye)},Mi.uniqueSort=function(ye){var Le,Ge=[],st=0,He=0;if(pt=!B.detectDuplicates,Ke=!B.sortStable&&ye.slice(0),ye.sort(ei),pt){for(;Le=ye[He++];)Le===ye[He]&&(st=Ge.push(He));for(;st--;)ye.splice(Ge[st],1)}return Ke=null,ye},pe=Mi.getText=function(ye){var Le,Ge="",st=0,He=ye.nodeType;if(He){if(1===He||9===He||11===He){if("string"==typeof ye.textContent)return ye.textContent;for(ye=ye.firstChild;ye;ye=ye.nextSibling)Ge+=pe(ye)}else if(3===He||4===He)return ye.nodeValue}else for(;Le=ye[st++];)Ge+=pe(Le);return Ge},(Q=Mi.selectors={cacheLength:50,createPseudo:Un,match:Ta,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(ye){return ye[1]=ye[1].replace(ea,jn),ye[3]=(ye[3]||ye[4]||ye[5]||"").replace(ea,jn),"~="===ye[2]&&(ye[3]=" "+ye[3]+" "),ye.slice(0,4)},CHILD:function(ye){return ye[1]=ye[1].toLowerCase(),"nth"===ye[1].slice(0,3)?(ye[3]||Mi.error(ye[0]),ye[4]=+(ye[4]?ye[5]+(ye[6]||1):2*("even"===ye[3]||"odd"===ye[3])),ye[5]=+(ye[7]+ye[8]||"odd"===ye[3])):ye[3]&&Mi.error(ye[0]),ye},PSEUDO:function(ye){var Le,Ge=!ye[6]&&ye[2];return Ta.CHILD.test(ye[0])?null:(ye[3]?ye[2]=ye[4]||ye[5]||"":Ge&&Va.test(Ge)&&(Le=be(Ge,!0))&&(Le=Ge.indexOf(")",Ge.length-Le)-Ge.length)&&(ye[0]=ye[0].slice(0,Le),ye[2]=Ge.slice(0,Le)),ye.slice(0,3))}},filter:{TAG:function(ye){var Le=ye.replace(ea,jn).toLowerCase();return"*"===ye?function(){return!0}:function(Ge){return Ge.nodeName&&Ge.nodeName.toLowerCase()===Le}},CLASS:function(ye){var Le=ti[ye+" "];return Le||(Le=new RegExp("(^|"+Zt+")"+ye+"("+Zt+"|$)"))&&ti(ye,function(Ge){return Le.test("string"==typeof Ge.className&&Ge.className||void 0!==Ge.getAttribute&&Ge.getAttribute("class")||"")})},ATTR:function(ye,Le,Ge){return function(st){var He=Mi.attr(st,ye);return null==He?"!="===Le:!Le||(He+="","="===Le?He===Ge:"!="===Le?He!==Ge:"^="===Le?Ge&&0===He.indexOf(Ge):"*="===Le?Ge&&-1<He.indexOf(Ge):"$="===Le?Ge&&He.slice(-Ge.length)===Ge:"~="===Le?-1<(" "+He.replace(Bi," ")+" ").indexOf(Ge):"|="===Le&&(He===Ge||He.slice(0,Ge.length+1)===Ge+"-"))}},CHILD:function(ye,Le,Ge,st,He){var Ct="nth"!==ye.slice(0,3),St="last"!==ye.slice(-4),_t="of-type"===Le;return 1===st&&0===He?function(Nt){return!!Nt.parentNode}:function(Nt,Xt,qt){var Kt,mi,qi,ii,Xi,on,fn=Ct!==St?"nextSibling":"previousSibling",Oi=Nt.parentNode,Vn=_t&&Nt.nodeName.toLowerCase(),sn=!qt&&!_t,ji=!1;if(Oi){if(Ct){for(;fn;){for(ii=Nt;ii=ii[fn];)if(_t?ii.nodeName.toLowerCase()===Vn:1===ii.nodeType)return!1;on=fn="only"===ye&&!on&&"nextSibling"}return!0}if(on=[St?Oi.firstChild:Oi.lastChild],St&&sn){for(ji=(Xi=(Kt=(mi=(qi=(ii=Oi)[ft]||(ii[ft]={}))[ii.uniqueID]||(qi[ii.uniqueID]={}))[ye]||[])[0]===Qt&&Kt[1])&&Kt[2],ii=Xi&&Oi.childNodes[Xi];ii=++Xi&&ii&&ii[fn]||(ji=Xi=0)||on.pop();)if(1===ii.nodeType&&++ji&&ii===Nt){mi[ye]=[Qt,Xi,ji];break}}else if(sn&&(ji=Xi=(Kt=(mi=(qi=(ii=Nt)[ft]||(ii[ft]={}))[ii.uniqueID]||(qi[ii.uniqueID]={}))[ye]||[])[0]===Qt&&Kt[1]),!1===ji)for(;(ii=++Xi&&ii&&ii[fn]||(ji=Xi=0)||on.pop())&&((_t?ii.nodeName.toLowerCase()!==Vn:1!==ii.nodeType)||!++ji||(sn&&((mi=(qi=ii[ft]||(ii[ft]={}))[ii.uniqueID]||(qi[ii.uniqueID]={}))[ye]=[Qt,ji]),ii!==Nt)););return(ji-=He)===st||ji%st==0&&0<=ji/st}}},PSEUDO:function(ye,Le){var Ge,st=Q.pseudos[ye]||Q.setFilters[ye.toLowerCase()]||Mi.error("unsupported pseudo: "+ye);return st[ft]?st(Le):1<st.length?(Ge=[ye,ye,"",Le],Q.setFilters.hasOwnProperty(ye.toLowerCase())?Un(function(He,Ct){for(var St,_t=st(He,Le),Nt=_t.length;Nt--;)He[St=gn(He,_t[Nt])]=!(Ct[St]=_t[Nt])}):function(He){return st(He,0,Ge)}):st}},pseudos:{not:Un(function(ye){var Le=[],Ge=[],st=Ue(ye.replace(En,"$1"));return st[ft]?Un(function(He,Ct,St,_t){for(var Nt,Xt=st(He,null,_t,[]),qt=He.length;qt--;)(Nt=Xt[qt])&&(He[qt]=!(Ct[qt]=Nt))}):function(He,Ct,St){return Le[0]=He,st(Le,null,St,Ge),Le[0]=null,!Ge.pop()}}),has:Un(function(ye){return function(Le){return 0<Mi(ye,Le).length}}),contains:Un(function(ye){return ye=ye.replace(ea,jn),function(Le){return-1<(Le.textContent||pe(Le)).indexOf(ye)}}),lang:Un(function(ye){return pa.test(ye||"")||Mi.error("unsupported lang: "+ye),ye=ye.replace(ea,jn).toLowerCase(),function(Le){var Ge;do{if(Ge=W?Le.lang:Le.getAttribute("xml:lang")||Le.getAttribute("lang"))return(Ge=Ge.toLowerCase())===ye||0===Ge.indexOf(ye+"-")}while((Le=Le.parentNode)&&1===Le.nodeType);return!1}}),target:function(ye){var Le=p.location&&p.location.hash;return Le&&Le.slice(1)===ye.id},root:function(ye){return ye===Ae},focus:function(ye){return ye===$e.activeElement&&(!$e.hasFocus||$e.hasFocus())&&!!(ye.type||ye.href||~ye.tabIndex)},enabled:ut(!1),disabled:ut(!0),checked:function(ye){var Le=ye.nodeName.toLowerCase();return"input"===Le&&!!ye.checked||"option"===Le&&!!ye.selected},selected:function(ye){return!0===ye.selected},empty:function(ye){for(ye=ye.firstChild;ye;ye=ye.nextSibling)if(ye.nodeType<6)return!1;return!0},parent:function(ye){return!Q.pseudos.empty(ye)},header:function(ye){return yn.test(ye.nodeName)},input:function(ye){return an.test(ye.nodeName)},button:function(ye){var Le=ye.nodeName.toLowerCase();return"input"===Le&&"button"===ye.type||"button"===Le},text:function(ye){var Le;return"input"===ye.nodeName.toLowerCase()&&"text"===ye.type&&(null==(Le=ye.getAttribute("type"))||"text"===Le.toLowerCase())},first:rn(function(){return[0]}),last:rn(function(ye,Le){return[Le-1]}),eq:rn(function(ye,Le,Ge){return[Ge<0?Ge+Le:Ge]}),even:rn(function(ye,Le){for(var Ge=0;Ge<Le;Ge+=2)ye.push(Ge);return ye}),odd:rn(function(ye,Le){for(var Ge=1;Ge<Le;Ge+=2)ye.push(Ge);return ye}),lt:rn(function(ye,Le,Ge){for(var st=Ge<0?Ge+Le:Le<Ge?Le:Ge;0<=--st;)ye.push(st);return ye}),gt:rn(function(ye,Le,Ge){for(var st=Ge<0?Ge+Le:Ge;++st<Le;)ye.push(st);return ye})}}).pseudos.nth=Q.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Q.pseudos[N]=Ma(N);for(N in{submit:!0,reset:!0})Q.pseudos[N]=Ye(N);function ir(){}function Ra(ye){for(var Le=0,Ge=ye.length,st="";Le<Ge;Le++)st+=ye[Le].value;return st}function Oa(ye,Le,Ge){var st=Le.dir,He=Le.next,Ct=He||st,St=Ge&&"parentNode"===Ct,_t=Ht++;return Le.first?function(Nt,Xt,qt){for(;Nt=Nt[st];)if(1===Nt.nodeType||St)return ye(Nt,Xt,qt);return!1}:function(Nt,Xt,qt){var Kt,mi,qi,ii=[Qt,_t];if(qt){for(;Nt=Nt[st];)if((1===Nt.nodeType||St)&&ye(Nt,Xt,qt))return!0}else for(;Nt=Nt[st];)if(1===Nt.nodeType||St)if(mi=(qi=Nt[ft]||(Nt[ft]={}))[Nt.uniqueID]||(qi[Nt.uniqueID]={}),He&&He===Nt.nodeName.toLowerCase())Nt=Nt[st]||Nt;else{if((Kt=mi[Ct])&&Kt[0]===Qt&&Kt[1]===_t)return ii[2]=Kt[2];if((mi[Ct]=ii)[2]=ye(Nt,Xt,qt))return!0}return!1}}function Ba(ye){return 1<ye.length?function(Le,Ge,st){for(var He=ye.length;He--;)if(!ye[He](Le,Ge,st))return!1;return!0}:ye[0]}function sa(ye,Le,Ge,st,He){for(var Ct,St=[],_t=0,Nt=ye.length,Xt=null!=Le;_t<Nt;_t++)(Ct=ye[_t])&&(Ge&&!Ge(Ct,st,He)||(St.push(Ct),Xt&&Le.push(_t)));return St}function fa(ye,Le,Ge,st,He,Ct){return st&&!st[ft]&&(st=fa(st)),He&&!He[ft]&&(He=fa(He,Ct)),Un(function(St,_t,Nt,Xt){var qt,Kt,mi,qi=[],ii=[],Xi=_t.length,on=St||function(Vn,sn,ji){for(var _n=0,_a=sn.length;_n<_a;_n++)Mi(Vn,sn[_n],ji);return ji}(Le||"*",Nt.nodeType?[Nt]:Nt,[]),fn=!ye||!St&&Le?on:sa(on,qi,ye,Nt,Xt),Oi=Ge?He||(St?ye:Xi||st)?[]:_t:fn;if(Ge&&Ge(fn,Oi,Nt,Xt),st)for(qt=sa(Oi,ii),st(qt,[],Nt,Xt),Kt=qt.length;Kt--;)(mi=qt[Kt])&&(Oi[ii[Kt]]=!(fn[ii[Kt]]=mi));if(St){if(He||ye){if(He){for(qt=[],Kt=Oi.length;Kt--;)(mi=Oi[Kt])&&qt.push(fn[Kt]=mi);He(null,Oi=[],qt,Xt)}for(Kt=Oi.length;Kt--;)(mi=Oi[Kt])&&-1<(qt=He?gn(St,mi):qi[Kt])&&(St[qt]=!(_t[qt]=mi))}}else Oi=sa(Oi===_t?Oi.splice(Xi,Oi.length):Oi),He?He(null,_t,Oi,Xt):bi.apply(_t,Oi)})}function la(ye){for(var Le,Ge,st,He=ye.length,Ct=Q.relative[ye[0].type],St=Ct||Q.relative[" "],_t=Ct?1:0,Nt=Oa(function(Kt){return Kt===Le},St,!0),Xt=Oa(function(Kt){return-1<gn(Le,Kt)},St,!0),qt=[function(Kt,mi,qi){var ii=!Ct&&(qi||mi!==qe)||((Le=mi).nodeType?Nt(Kt,mi,qi):Xt(Kt,mi,qi));return Le=null,ii}];_t<He;_t++)if(Ge=Q.relative[ye[_t].type])qt=[Oa(Ba(qt),Ge)];else{if((Ge=Q.filter[ye[_t].type].apply(null,ye[_t].matches))[ft]){for(st=++_t;st<He&&!Q.relative[ye[st].type];st++);return fa(1<_t&&Ba(qt),1<_t&&Ra(ye.slice(0,_t-1).concat({value:" "===ye[_t-2].type?"*":""})).replace(En,"$1"),Ge,_t<st&&la(ye.slice(_t,st)),st<He&&la(ye=ye.slice(st)),st<He&&Ra(ye))}qt.push(Ge)}return Ba(qt)}return ir.prototype=Q.filters=Q.pseudos,Q.setFilters=new ir,be=Mi.tokenize=function(ye,Le){var Ge,st,He,Ct,St,_t,Nt,Xt=li[ye+" "];if(Xt)return Le?0:Xt.slice(0);for(St=ye,_t=[],Nt=Q.preFilter;St;){for(Ct in Ge&&!(st=Zn.exec(St))||(st&&(St=St.slice(st[0].length)||St),_t.push(He=[])),Ge=!1,(st=nn.exec(St))&&(Ge=st.shift(),He.push({value:Ge,type:st[0].replace(En," ")}),St=St.slice(Ge.length)),Q.filter)!(st=Ta[Ct].exec(St))||Nt[Ct]&&!(st=Nt[Ct](st))||(Ge=st.shift(),He.push({value:Ge,type:Ct,matches:st}),St=St.slice(Ge.length));if(!Ge)break}return Le?St.length:St?Mi.error(ye):li(ye,_t).slice(0)},Ue=Mi.compile=function(ye,Le){var Ge,st,He,Ct,St,_t,Nt=[],Xt=[],qt=Li[ye+" "];if(!qt){for(Le||(Le=be(ye)),Ge=Le.length;Ge--;)(qt=la(Le[Ge]))[ft]?Nt.push(qt):Xt.push(qt);(qt=Li(ye,(st=Xt,Ct=0<(He=Nt).length,St=0<st.length,_t=function(Kt,mi,qi,ii,Xi){var on,fn,Oi,Vn=0,sn="0",ji=Kt&&[],_n=[],_a=qe,Ga=Kt||St&&Q.find.TAG("*",Xi),Da=Qt+=null==_a?1:Math.random()||.1,qa=Ga.length;for(Xi&&(qe=mi==$e||mi||Xi);sn!==qa&&null!=(on=Ga[sn]);sn++){if(St&&on){for(fn=0,mi||on.ownerDocument==$e||(Qe(on),qi=!W);Oi=st[fn++];)if(Oi(on,mi||$e,qi)){ii.push(on);break}Xi&&(Qt=Da)}Ct&&((on=!Oi&&on)&&Vn--,Kt&&ji.push(on))}if(Vn+=sn,Ct&&sn!==Vn){for(fn=0;Oi=He[fn++];)Oi(ji,_n,mi,qi);if(Kt){if(0<Vn)for(;sn--;)ji[sn]||_n[sn]||(_n[sn]=di.call(ii));_n=sa(_n)}bi.apply(ii,_n),Xi&&!Kt&&0<_n.length&&1<Vn+He.length&&Mi.uniqueSort(ii)}return Xi&&(Qt=Da,qe=_a),ji},Ct?Un(_t):_t))).selector=ye}return qt},xe=Mi.select=function(ye,Le,Ge,st){var He,Ct,St,_t,Nt,Xt="function"==typeof ye&&ye,qt=!st&&be(ye=Xt.selector||ye);if(Ge=Ge||[],1===qt.length){if(2<(Ct=qt[0]=qt[0].slice(0)).length&&"ID"===(St=Ct[0]).type&&9===Le.nodeType&&W&&Q.relative[Ct[1].type]){if(!(Le=(Q.find.ID(St.matches[0].replace(ea,jn),Le)||[])[0]))return Ge;Xt&&(Le=Le.parentNode),ye=ye.slice(Ct.shift().value.length)}for(He=Ta.needsContext.test(ye)?0:Ct.length;He--&&!Q.relative[_t=(St=Ct[He]).type];)if((Nt=Q.find[_t])&&(st=Nt(St.matches[0].replace(ea,jn),Mn.test(Ct[0].type)&&zi(Le.parentNode)||Le))){if(Ct.splice(He,1),!(ye=st.length&&Ra(Ct)))return bi.apply(Ge,st),Ge;break}}return(Xt||Ue(ye,qt))(st,Le,!W,Ge,!Le||Mn.test(ye)&&zi(Le.parentNode)||Le),Ge},B.sortStable=ft.split("").sort(ei).join("")===ft,B.detectDuplicates=!!pt,Qe(),B.sortDetached=On(function(ye){return 1&ye.compareDocumentPosition($e.createElement("fieldset"))}),On(function(ye){return ye.innerHTML="<a href='#'></a>","#"===ye.firstChild.getAttribute("href")})||Fa("type|href|height|width",function(ye,Le,Ge){if(!Ge)return ye.getAttribute(Le,"type"===Le.toLowerCase()?1:2)}),B.attributes&&On(function(ye){return ye.innerHTML="<input/>",ye.firstChild.setAttribute("value",""),""===ye.firstChild.getAttribute("value")})||Fa("value",function(ye,Le,Ge){if(!Ge&&"input"===ye.nodeName.toLowerCase())return ye.defaultValue}),On(function(ye){return null==ye.getAttribute("disabled")})||Fa(Wn,function(ye,Le,Ge){var st;if(!Ge)return!0===ye[Le]?Le.toLowerCase():(st=ye.getAttributeNode(Le))&&st.specified?st.value:null}),Mi}(nt);c.find=q,c.expr=q.selectors,c.expr[":"]=c.expr.pseudos,c.uniqueSort=c.unique=q.uniqueSort,c.text=q.getText,c.isXMLDoc=q.isXML,c.contains=q.contains,c.escapeSelector=q.escape;var b=function(p,N,B){for(var Q=[],pe=void 0!==B;(p=p[N])&&9!==p.nodeType;)if(1===p.nodeType){if(pe&&c(p).is(B))break;Q.push(p)}return Q},T=function(p,N){for(var B=[];p;p=p.nextSibling)1===p.nodeType&&p!==N&&B.push(p);return B},Z=c.expr.match.needsContext;function le(p,N){return p.nodeName&&p.nodeName.toLowerCase()===N.toLowerCase()}var x=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Se(p,N,B){return n(N)?c.grep(p,function(Q,pe){return!!N.call(Q,pe,Q)!==B}):N.nodeType?c.grep(p,function(Q){return Q===N!==B}):"string"!=typeof N?c.grep(p,function(Q){return-1<d.call(N,Q)!==B}):c.filter(N,p,B)}c.filter=function(p,N,B){var Q=N[0];return B&&(p=":not("+p+")"),1===N.length&&1===Q.nodeType?c.find.matchesSelector(Q,p)?[Q]:[]:c.find.matches(p,c.grep(N,function(pe){return 1===pe.nodeType}))},c.fn.extend({find:function(p){var N,B,Q=this.length,pe=this;if("string"!=typeof p)return this.pushStack(c(p).filter(function(){for(N=0;N<Q;N++)if(c.contains(pe[N],this))return!0}));for(B=this.pushStack([]),N=0;N<Q;N++)c.find(p,pe[N],B);return 1<Q?c.uniqueSort(B):B},filter:function(p){return this.pushStack(Se(this,p||[],!1))},not:function(p){return this.pushStack(Se(this,p||[],!0))},is:function(p){return!!Se(this,"string"==typeof p&&Z.test(p)?c(p):p||[],!1).length}});var Ee,he=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(c.fn.init=function(p,N,B){var Q,pe;if(!p)return this;if(B=B||Ee,"string"==typeof p){if(!(Q="<"===p[0]&&">"===p[p.length-1]&&3<=p.length?[null,p,null]:he.exec(p))||!Q[1]&&N)return!N||N.jquery?(N||B).find(p):this.constructor(N).find(p);if(Q[1]){if(c.merge(this,c.parseHTML(Q[1],(N=N instanceof c?N[0]:N)&&N.nodeType?N.ownerDocument||N:R,!0)),x.test(Q[1])&&c.isPlainObject(N))for(Q in N)n(this[Q])?this[Q](N[Q]):this.attr(Q,N[Q]);return this}return(pe=R.getElementById(Q[2]))&&(this[0]=pe,this.length=1),this}return p.nodeType?(this[0]=p,this.length=1,this):n(p)?void 0!==B.ready?B.ready(p):p(c):c.makeArray(p,this)}).prototype=c.fn,Ee=c(R);var ue=/^(?:parents|prev(?:Until|All))/,ke={children:!0,contents:!0,next:!0,prev:!0};function Ne(p,N){for(;(p=p[N])&&1!==p.nodeType;);return p}c.fn.extend({has:function(p){var N=c(p,this),B=N.length;return this.filter(function(){for(var Q=0;Q<B;Q++)if(c.contains(this,N[Q]))return!0})},closest:function(p,N){var B,Q=0,pe=this.length,ve=[],be="string"!=typeof p&&c(p);if(!Z.test(p))for(;Q<pe;Q++)for(B=this[Q];B&&B!==N;B=B.parentNode)if(B.nodeType<11&&(be?-1<be.index(B):1===B.nodeType&&c.find.matchesSelector(B,p))){ve.push(B);break}return this.pushStack(1<ve.length?c.uniqueSort(ve):ve)},index:function(p){return p?"string"==typeof p?d.call(c(p),this[0]):d.call(this,p.jquery?p[0]:p):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(p,N){return this.pushStack(c.uniqueSort(c.merge(this.get(),c(p,N))))},addBack:function(p){return this.add(null==p?this.prevObject:this.prevObject.filter(p))}}),c.each({parent:function(p){var N=p.parentNode;return N&&11!==N.nodeType?N:null},parents:function(p){return b(p,"parentNode")},parentsUntil:function(p,N,B){return b(p,"parentNode",B)},next:function(p){return Ne(p,"nextSibling")},prev:function(p){return Ne(p,"previousSibling")},nextAll:function(p){return b(p,"nextSibling")},prevAll:function(p){return b(p,"previousSibling")},nextUntil:function(p,N,B){return b(p,"nextSibling",B)},prevUntil:function(p,N,B){return b(p,"previousSibling",B)},siblings:function(p){return T((p.parentNode||{}).firstChild,p)},children:function(p){return T(p.firstChild)},contents:function(p){return null!=p.contentDocument&&V(p.contentDocument)?p.contentDocument:(le(p,"template")&&(p=p.content||p),c.merge([],p.childNodes))}},function(p,N){c.fn[p]=function(B,Q){var pe=c.map(this,N,B);return"Until"!==p.slice(-5)&&(Q=B),Q&&"string"==typeof Q&&(pe=c.filter(Q,pe)),1<this.length&&(ke[p]||c.uniqueSort(pe),ue.test(p)&&pe.reverse()),this.pushStack(pe)}});var ze=/[^\x20\t\r\n\f]+/g;function Ve(p){return p}function et(p){throw p}function _e(p,N,B,Q){var pe;try{p&&n(pe=p.promise)?pe.call(p).done(N).fail(B):p&&n(pe=p.then)?pe.call(p,N,B):N.apply(void 0,[p].slice(Q))}catch(ve){B.apply(void 0,[ve])}}c.Callbacks=function(p){var B;p="string"==typeof p?(B={},c.each(p.match(ze)||[],function(Qe,$e){B[$e]=!0}),B):c.extend({},p);var Q,pe,ve,be,Ue=[],xe=[],qe=-1,Ke=function(){for(be=be||p.once,ve=Q=!0;xe.length;qe=-1)for(pe=xe.shift();++qe<Ue.length;)!1===Ue[qe].apply(pe[0],pe[1])&&p.stopOnFalse&&(qe=Ue.length,pe=!1);p.memory||(pe=!1),Q=!1,be&&(Ue=pe?[]:"")},pt={add:function(){return Ue&&(pe&&!Q&&(qe=Ue.length-1,xe.push(pe)),function Qe($e){c.each($e,function(Ae,W){n(W)?p.unique&&pt.has(W)||Ue.push(W):W&&W.length&&"string"!==f(W)&&Qe(W)})}(arguments),pe&&!Q&&Ke()),this},remove:function(){return c.each(arguments,function(Qe,$e){for(var Ae;-1<(Ae=c.inArray($e,Ue,Ae));)Ue.splice(Ae,1),Ae<=qe&&qe--}),this},has:function(Qe){return Qe?-1<c.inArray(Qe,Ue):0<Ue.length},empty:function(){return Ue&&(Ue=[]),this},disable:function(){return be=xe=[],Ue=pe="",this},disabled:function(){return!Ue},lock:function(){return be=xe=[],pe||Q||(Ue=pe=""),this},locked:function(){return!!be},fireWith:function(Qe,$e){return be||($e=[Qe,($e=$e||[]).slice?$e.slice():$e],xe.push($e),Q||Ke()),this},fire:function(){return pt.fireWith(this,arguments),this},fired:function(){return!!ve}};return pt},c.extend({Deferred:function(p){var N=[["notify","progress",c.Callbacks("memory"),c.Callbacks("memory"),2],["resolve","done",c.Callbacks("once memory"),c.Callbacks("once memory"),0,"resolved"],["reject","fail",c.Callbacks("once memory"),c.Callbacks("once memory"),1,"rejected"]],B="pending",Q={state:function(){return B},always:function(){return pe.done(arguments).fail(arguments),this},catch:function(ve){return Q.then(null,ve)},pipe:function(){var ve=arguments;return c.Deferred(function(be){c.each(N,function(Ue,xe){var qe=n(ve[xe[4]])&&ve[xe[4]];pe[xe[1]](function(){var Ke=qe&&qe.apply(this,arguments);Ke&&n(Ke.promise)?Ke.promise().progress(be.notify).done(be.resolve).fail(be.reject):be[xe[0]+"With"](this,qe?[Ke]:arguments)})}),ve=null}).promise()},then:function(ve,be,Ue){var xe=0;function qe(Ke,pt,Qe,$e){return function(){var Ae=this,W=arguments,oe=function(){var Be,it;if(!(Ke<xe)){if((Be=Qe.apply(Ae,W))===pt.promise())throw new TypeError("Thenable self-resolution");n(it=Be&&("object"==typeof Be||"function"==typeof Be)&&Be.then)?$e?it.call(Be,qe(xe,pt,Ve,$e),qe(xe,pt,et,$e)):(xe++,it.call(Be,qe(xe,pt,Ve,$e),qe(xe,pt,et,$e),qe(xe,pt,Ve,pt.notifyWith))):(Qe!==Ve&&(Ae=void 0,W=[Be]),($e||pt.resolveWith)(Ae,W))}},De=$e?oe:function(){try{oe()}catch(Be){c.Deferred.exceptionHook&&c.Deferred.exceptionHook(Be,De.stackTrace),xe<=Ke+1&&(Qe!==et&&(Ae=void 0,W=[Be]),pt.rejectWith(Ae,W))}};Ke?De():(c.Deferred.getStackHook&&(De.stackTrace=c.Deferred.getStackHook()),nt.setTimeout(De))}}return c.Deferred(function(Ke){N[0][3].add(qe(0,Ke,n(Ue)?Ue:Ve,Ke.notifyWith)),N[1][3].add(qe(0,Ke,n(ve)?ve:Ve)),N[2][3].add(qe(0,Ke,n(be)?be:et))}).promise()},promise:function(ve){return null!=ve?c.extend(ve,Q):Q}},pe={};return c.each(N,function(ve,be){var Ue=be[2],xe=be[5];Q[be[1]]=Ue.add,xe&&Ue.add(function(){B=xe},N[3-ve][2].disable,N[3-ve][3].disable,N[0][2].lock,N[0][3].lock),Ue.add(be[3].fire),pe[be[0]]=function(){return pe[be[0]+"With"](this===pe?void 0:this,arguments),this},pe[be[0]+"With"]=Ue.fireWith}),Q.promise(pe),p&&p.call(pe,pe),pe},when:function(p){var N=arguments.length,B=N,Q=Array(B),pe=J.call(arguments),ve=c.Deferred(),be=function(Ue){return function(xe){Q[Ue]=this,pe[Ue]=1<arguments.length?J.call(arguments):xe,--N||ve.resolveWith(Q,pe)}};if(N<=1&&(_e(p,ve.done(be(B)).resolve,ve.reject,!N),"pending"===ve.state()||n(pe[B]&&pe[B].then)))return ve.then();for(;B--;)_e(pe[B],be(B),ve.reject);return ve.promise()}});var gt=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;c.Deferred.exceptionHook=function(p,N){nt.console&&nt.console.warn&&p&&gt.test(p.name)&&nt.console.warn("jQuery.Deferred exception: "+p.message,p.stack,N)},c.readyException=function(p){nt.setTimeout(function(){throw p})};var mt=c.Deferred();function ot(){R.removeEventListener("DOMContentLoaded",ot),nt.removeEventListener("load",ot),c.ready()}c.fn.ready=function(p){return mt.then(p).catch(function(N){c.readyException(N)}),this},c.extend({isReady:!1,readyWait:1,ready:function(p){(!0===p?--c.readyWait:c.isReady)||(c.isReady=!0)!==p&&0<--c.readyWait||mt.resolveWith(R,[c])}}),c.ready.then=mt.then,"complete"===R.readyState||"loading"!==R.readyState&&!R.documentElement.doScroll?nt.setTimeout(c.ready):(R.addEventListener("DOMContentLoaded",ot),nt.addEventListener("load",ot));var at=function(p,N,B,Q,pe,ve,be){var Ue=0,xe=p.length,qe=null==B;if("object"===f(B))for(Ue in pe=!0,B)at(p,N,Ue,B[Ue],!0,ve,be);else if(void 0!==Q&&(pe=!0,n(Q)||(be=!0),qe&&(be?(N.call(p,Q),N=null):(qe=N,N=function(Ke,pt,Qe){return qe.call(c(Ke),Qe)})),N))for(;Ue<xe;Ue++)N(p[Ue],B,be?Q:Q.call(p[Ue],Ue,N(p[Ue],B)));return pe?p:qe?N.call(p):xe?N(p[0],B):ve},yt=/^-ms-/,Et=/-([a-z])/g;function ie(p,N){return N.toUpperCase()}function dt(p){return p.replace(yt,"ms-").replace(Et,ie)}var Mt=function(p){return 1===p.nodeType||9===p.nodeType||!+p.nodeType};function Rt(){this.expando=c.expando+Rt.uid++}Rt.uid=1,Rt.prototype={cache:function(p){var N=p[this.expando];return N||(N={},Mt(p)&&(p.nodeType?p[this.expando]=N:Object.defineProperty(p,this.expando,{value:N,configurable:!0}))),N},set:function(p,N,B){var Q,pe=this.cache(p);if("string"==typeof N)pe[dt(N)]=B;else for(Q in N)pe[dt(Q)]=N[Q];return pe},get:function(p,N){return void 0===N?this.cache(p):p[this.expando]&&p[this.expando][dt(N)]},access:function(p,N,B){return void 0===N||N&&"string"==typeof N&&void 0===B?this.get(p,N):(this.set(p,N,B),void 0!==B?B:N)},remove:function(p,N){var B,Q=p[this.expando];if(void 0!==Q){if(void 0!==N)for((B=(N=Array.isArray(N)?N.map(dt):(N=dt(N))in Q?[N]:N.match(ze)||[]).length);B--;)delete Q[N[B]];(void 0===N||c.isEmptyObject(Q))&&(p.nodeType?p[this.expando]=void 0:delete p[this.expando])}},hasData:function(p){var N=p[this.expando];return void 0!==N&&!c.isEmptyObject(N)}};var je=new Rt,xt=new Rt,Wt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Gt=/[A-Z]/g;function kt(p,N,B){var Q,pe;if(void 0===B&&1===p.nodeType)if(Q="data-"+N.replace(Gt,"-$&").toLowerCase(),"string"==typeof(B=p.getAttribute(Q))){try{B="true"===(pe=B)||"false"!==pe&&("null"===pe?null:pe===+pe+""?+pe:Wt.test(pe)?JSON.parse(pe):pe)}catch(ve){}xt.set(p,N,B)}else B=void 0;return B}c.extend({hasData:function(p){return xt.hasData(p)||je.hasData(p)},data:function(p,N,B){return xt.access(p,N,B)},removeData:function(p,N){xt.remove(p,N)},_data:function(p,N,B){return je.access(p,N,B)},_removeData:function(p,N){je.remove(p,N)}}),c.fn.extend({data:function(p,N){var B,Q,pe,ve=this[0],be=ve&&ve.attributes;if(void 0===p){if(this.length&&(pe=xt.get(ve),1===ve.nodeType&&!je.get(ve,"hasDataAttrs"))){for(B=be.length;B--;)be[B]&&0===(Q=be[B].name).indexOf("data-")&&(Q=dt(Q.slice(5)),kt(ve,Q,pe[Q]));je.set(ve,"hasDataAttrs",!0)}return pe}return"object"==typeof p?this.each(function(){xt.set(this,p)}):at(this,function(Ue){var xe;if(ve&&void 0===Ue)return void 0!==(xe=xt.get(ve,p))||void 0!==(xe=kt(ve,p))?xe:void 0;this.each(function(){xt.set(this,p,Ue)})},null,N,1<arguments.length,null,!0)},removeData:function(p){return this.each(function(){xt.remove(this,p)})}}),c.extend({queue:function(p,N,B){var Q;if(p)return Q=je.get(p,N=(N||"fx")+"queue"),B&&(!Q||Array.isArray(B)?Q=je.access(p,N,c.makeArray(B)):Q.push(B)),Q||[]},dequeue:function(p,N){var B=c.queue(p,N=N||"fx"),Q=B.length,pe=B.shift(),ve=c._queueHooks(p,N);"inprogress"===pe&&(pe=B.shift(),Q--),pe&&("fx"===N&&B.unshift("inprogress"),delete ve.stop,pe.call(p,function(){c.dequeue(p,N)},ve)),!Q&&ve&&ve.empty.fire()},_queueHooks:function(p,N){var B=N+"queueHooks";return je.get(p,B)||je.access(p,B,{empty:c.Callbacks("once memory").add(function(){je.remove(p,[N+"queue",B])})})}}),c.fn.extend({queue:function(p,N){var B=2;return"string"!=typeof p&&(N=p,p="fx",B--),arguments.length<B?c.queue(this[0],p):void 0===N?this:this.each(function(){var Q=c.queue(this,p,N);c._queueHooks(this,p),"fx"===p&&"inprogress"!==Q[0]&&c.dequeue(this,p)})},dequeue:function(p){return this.each(function(){c.dequeue(this,p)})},clearQueue:function(p){return this.queue(p||"fx",[])},promise:function(p,N){var B,Q=1,pe=c.Deferred(),ve=this,be=this.length,Ue=function(){--Q||pe.resolveWith(ve,[ve])};for("string"!=typeof p&&(N=p,p=void 0),p=p||"fx";be--;)(B=je.get(ve[be],p+"queueHooks"))&&B.empty&&(Q++,B.empty.add(Ue));return Ue(),pe.promise(N)}});var Xe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,zt=new RegExp("^(?:([+-])=|)("+Xe+")([a-z%]*)$","i"),G=["Top","Right","Bottom","Left"],A=R.documentElement,t=function(p){return c.contains(p.ownerDocument,p)},l={composed:!0};A.getRootNode&&(t=function(p){return c.contains(p.ownerDocument,p)||p.getRootNode(l)===p.ownerDocument});var s=function(p,N){return"none"===(p=N||p).style.display||""===p.style.display&&t(p)&&"none"===c.css(p,"display")};function v(p,N,B,Q){var pe,ve,be=20,Ue=Q?function(){return Q.cur()}:function(){return c.css(p,N,"")},xe=Ue(),qe=B&&B[3]||(c.cssNumber[N]?"":"px"),Ke=p.nodeType&&(c.cssNumber[N]||"px"!==qe&&+xe)&&zt.exec(c.css(p,N));if(Ke&&Ke[3]!==qe){for(qe=qe||Ke[3],Ke=+(xe/=2)||1;be--;)c.style(p,N,Ke+qe),(1-ve)*(1-(ve=Ue()/xe||.5))<=0&&(be=0),Ke/=ve;c.style(p,N,(Ke*=2)+qe),B=B||[]}return B&&(Ke=+Ke||+xe||0,pe=B[1]?Ke+(B[1]+1)*B[2]:+B[2],Q&&(Q.unit=qe,Q.start=Ke,Q.end=pe)),pe}var r={};function g(p,N){for(var B,Q,pe,ve,be,Ue,xe,qe=[],Ke=0,pt=p.length;Ke<pt;Ke++)(Q=p[Ke]).style&&(B=Q.style.display,N?("none"===B&&(qe[Ke]=je.get(Q,"display")||null,qe[Ke]||(Q.style.display="")),""===Q.style.display&&s(Q)&&(qe[Ke]=(xe=be=ve=void 0,be=(pe=Q).ownerDocument,(xe=r[Ue=pe.nodeName])||(ve=be.body.appendChild(be.createElement(Ue)),xe=c.css(ve,"display"),ve.parentNode.removeChild(ve),"none"===xe&&(xe="block"),r[Ue]=xe)))):"none"!==B&&(qe[Ke]="none",je.set(Q,"display",B)));for(Ke=0;Ke<pt;Ke++)null!=qe[Ke]&&(p[Ke].style.display=qe[Ke]);return p}c.fn.extend({show:function(){return g(this,!0)},hide:function(){return g(this)},toggle:function(p){return"boolean"==typeof p?p?this.show():this.hide():this.each(function(){s(this)?c(this).show():c(this).hide()})}});var E,te,ae=/^(?:checkbox|radio)$/i,Re=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;E=R.createDocumentFragment().appendChild(R.createElement("div")),(te=R.createElement("input")).setAttribute("type","radio"),te.setAttribute("checked","checked"),te.setAttribute("name","t"),E.appendChild(te),S.checkClone=E.cloneNode(!0).cloneNode(!0).lastChild.checked,E.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!E.cloneNode(!0).lastChild.defaultValue,E.innerHTML="<option></option>",S.option=!!E.lastChild;var re={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function K(p,N){var B;return B=void 0!==p.getElementsByTagName?p.getElementsByTagName(N||"*"):void 0!==p.querySelectorAll?p.querySelectorAll(N||"*"):[],void 0===N||N&&le(p,N)?c.merge([p],B):B}function L(p,N){for(var B=0,Q=p.length;B<Q;B++)je.set(p[B],"globalEval",!N||je.get(N[B],"globalEval"))}re.tbody=re.tfoot=re.colgroup=re.caption=re.thead,re.th=re.td,S.option||(re.optgroup=re.option=[1,"<select multiple='multiple'>","</select>"]);var ne=/<|&#?\w+;/;function ee(p,N,B,Q,pe){for(var ve,be,Ue,xe,qe,Ke,pt=N.createDocumentFragment(),Qe=[],$e=0,Ae=p.length;$e<Ae;$e++)if((ve=p[$e])||0===ve)if("object"===f(ve))c.merge(Qe,ve.nodeType?[ve]:ve);else if(ne.test(ve)){for(be=be||pt.appendChild(N.createElement("div")),Ue=(Re.exec(ve)||["",""])[1].toLowerCase(),be.innerHTML=(xe=re[Ue]||re._default)[1]+c.htmlPrefilter(ve)+xe[2],Ke=xe[0];Ke--;)be=be.lastChild;c.merge(Qe,be.childNodes),(be=pt.firstChild).textContent=""}else Qe.push(N.createTextNode(ve));for(pt.textContent="",$e=0;ve=Qe[$e++];)if(Q&&-1<c.inArray(ve,Q))pe&&pe.push(ve);else if(qe=t(ve),be=K(pt.appendChild(ve),"script"),qe&&L(be),B)for(Ke=0;ve=be[Ke++];)Ce.test(ve.type||"")&&B.push(ve);return pt}var ce=/^([^.]*)(?:\.(.+)|)/;function me(){return!0}function Te(){return!1}function ge(p,N){return p===function(){try{return R.activeElement}catch(B){}}()==("focus"===N)}function Ie(p,N,B,Q,pe,ve){var be,Ue;if("object"==typeof N){for(Ue in"string"!=typeof B&&(Q=Q||B,B=void 0),N)Ie(p,Ue,B,Q,N[Ue],ve);return p}if(null==Q&&null==pe?(pe=B,Q=B=void 0):null==pe&&("string"==typeof B?(pe=Q,Q=void 0):(pe=Q,Q=B,B=void 0)),!1===pe)pe=Te;else if(!pe)return p;return 1===ve&&(be=pe,(pe=function(xe){return c().off(xe),be.apply(this,arguments)}).guid=be.guid||(be.guid=c.guid++)),p.each(function(){c.event.add(this,N,pe,Q,B)})}function we(p,N,B){B?(je.set(p,N,!1),c.event.add(p,N,{namespace:!1,handler:function(Q){var pe,ve,be=je.get(this,N);if(1&Q.isTrigger&&this[N]){if(be.length)(c.event.special[N]||{}).delegateType&&Q.stopPropagation();else if(be=J.call(arguments),je.set(this,N,be),pe=B(this,N),this[N](),be!==(ve=je.get(this,N))||pe?je.set(this,N,!1):ve={},be!==ve)return Q.stopImmediatePropagation(),Q.preventDefault(),ve&&ve.value}else be.length&&(je.set(this,N,{value:c.event.trigger(c.extend(be[0],c.Event.prototype),be.slice(1),this)}),Q.stopImmediatePropagation())}})):void 0===je.get(p,N)&&c.event.add(p,N,me)}c.event={global:{},add:function(p,N,B,Q,pe){var ve,be,Ue,xe,qe,Ke,pt,Qe,$e,Ae,W,oe=je.get(p);if(Mt(p))for(B.handler&&(B=(ve=B).handler,pe=ve.selector),pe&&c.find.matchesSelector(A,pe),B.guid||(B.guid=c.guid++),(xe=oe.events)||(xe=oe.events=Object.create(null)),(be=oe.handle)||(be=oe.handle=function(De){return void 0!==c&&c.event.triggered!==De.type?c.event.dispatch.apply(p,arguments):void 0}),qe=(N=(N||"").match(ze)||[""]).length;qe--;)$e=W=(Ue=ce.exec(N[qe])||[])[1],Ae=(Ue[2]||"").split(".").sort(),$e&&(pt=c.event.special[$e]||{},pt=c.event.special[$e=(pe?pt.delegateType:pt.bindType)||$e]||{},Ke=c.extend({type:$e,origType:W,data:Q,handler:B,guid:B.guid,selector:pe,needsContext:pe&&c.expr.match.needsContext.test(pe),namespace:Ae.join(".")},ve),(Qe=xe[$e])||((Qe=xe[$e]=[]).delegateCount=0,pt.setup&&!1!==pt.setup.call(p,Q,Ae,be)||p.addEventListener&&p.addEventListener($e,be)),pt.add&&(pt.add.call(p,Ke),Ke.handler.guid||(Ke.handler.guid=B.guid)),pe?Qe.splice(Qe.delegateCount++,0,Ke):Qe.push(Ke),c.event.global[$e]=!0)},remove:function(p,N,B,Q,pe){var ve,be,Ue,xe,qe,Ke,pt,Qe,$e,Ae,W,oe=je.hasData(p)&&je.get(p);if(oe&&(xe=oe.events)){for(qe=(N=(N||"").match(ze)||[""]).length;qe--;)if($e=W=(Ue=ce.exec(N[qe])||[])[1],Ae=(Ue[2]||"").split(".").sort(),$e){for(pt=c.event.special[$e]||{},Qe=xe[$e=(Q?pt.delegateType:pt.bindType)||$e]||[],Ue=Ue[2]&&new RegExp("(^|\\.)"+Ae.join("\\.(?:.*\\.|)")+"(\\.|$)"),be=ve=Qe.length;ve--;)Ke=Qe[ve],!pe&&W!==Ke.origType||B&&B.guid!==Ke.guid||Ue&&!Ue.test(Ke.namespace)||Q&&Q!==Ke.selector&&("**"!==Q||!Ke.selector)||(Qe.splice(ve,1),Ke.selector&&Qe.delegateCount--,pt.remove&&pt.remove.call(p,Ke));be&&!Qe.length&&(pt.teardown&&!1!==pt.teardown.call(p,Ae,oe.handle)||c.removeEvent(p,$e,oe.handle),delete xe[$e])}else for($e in xe)c.event.remove(p,$e+N[qe],B,Q,!0);c.isEmptyObject(xe)&&je.remove(p,"handle events")}},dispatch:function(p){var N,B,Q,pe,ve,be,Ue=new Array(arguments.length),xe=c.event.fix(p),qe=(je.get(this,"events")||Object.create(null))[xe.type]||[],Ke=c.event.special[xe.type]||{};for(Ue[0]=xe,N=1;N<arguments.length;N++)Ue[N]=arguments[N];if(xe.delegateTarget=this,!Ke.preDispatch||!1!==Ke.preDispatch.call(this,xe)){for(be=c.event.handlers.call(this,xe,qe),N=0;(pe=be[N++])&&!xe.isPropagationStopped();)for(xe.currentTarget=pe.elem,B=0;(ve=pe.handlers[B++])&&!xe.isImmediatePropagationStopped();)xe.rnamespace&&!1!==ve.namespace&&!xe.rnamespace.test(ve.namespace)||(xe.handleObj=ve,xe.data=ve.data,void 0!==(Q=((c.event.special[ve.origType]||{}).handle||ve.handler).apply(pe.elem,Ue))&&!1===(xe.result=Q)&&(xe.preventDefault(),xe.stopPropagation()));return Ke.postDispatch&&Ke.postDispatch.call(this,xe),xe.result}},handlers:function(p,N){var B,Q,pe,ve,be,Ue=[],xe=N.delegateCount,qe=p.target;if(xe&&qe.nodeType&&!("click"===p.type&&1<=p.button))for(;qe!==this;qe=qe.parentNode||this)if(1===qe.nodeType&&("click"!==p.type||!0!==qe.disabled)){for(ve=[],be={},B=0;B<xe;B++)void 0===be[pe=(Q=N[B]).selector+" "]&&(be[pe]=Q.needsContext?-1<c(pe,this).index(qe):c.find(pe,this,null,[qe]).length),be[pe]&&ve.push(Q);ve.length&&Ue.push({elem:qe,handlers:ve})}return qe=this,xe<N.length&&Ue.push({elem:qe,handlers:N.slice(xe)}),Ue},addProp:function(p,N){Object.defineProperty(c.Event.prototype,p,{enumerable:!0,configurable:!0,get:n(N)?function(){if(this.originalEvent)return N(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[p]},set:function(B){Object.defineProperty(this,p,{enumerable:!0,configurable:!0,writable:!0,value:B})}})},fix:function(p){return p[c.expando]?p:new c.Event(p)},special:{load:{noBubble:!0},click:{setup:function(p){var N=this||p;return ae.test(N.type)&&N.click&&le(N,"input")&&we(N,"click",me),!1},trigger:function(p){var N=this||p;return ae.test(N.type)&&N.click&&le(N,"input")&&we(N,"click"),!0},_default:function(p){var N=p.target;return ae.test(N.type)&&N.click&&le(N,"input")&&je.get(N,"click")||le(N,"a")}},beforeunload:{postDispatch:function(p){void 0!==p.result&&p.originalEvent&&(p.originalEvent.returnValue=p.result)}}}},c.removeEvent=function(p,N,B){p.removeEventListener&&p.removeEventListener(N,B)},c.Event=function(p,N){if(!(this instanceof c.Event))return new c.Event(p,N);p&&p.type?(this.originalEvent=p,this.type=p.type,this.isDefaultPrevented=p.defaultPrevented||void 0===p.defaultPrevented&&!1===p.returnValue?me:Te,this.target=p.target&&3===p.target.nodeType?p.target.parentNode:p.target,this.currentTarget=p.currentTarget,this.relatedTarget=p.relatedTarget):this.type=p,N&&c.extend(this,N),this.timeStamp=p&&p.timeStamp||Date.now(),this[c.expando]=!0},c.Event.prototype={constructor:c.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var p=this.originalEvent;this.isDefaultPrevented=me,p&&!this.isSimulated&&p.preventDefault()},stopPropagation:function(){var p=this.originalEvent;this.isPropagationStopped=me,p&&!this.isSimulated&&p.stopPropagation()},stopImmediatePropagation:function(){var p=this.originalEvent;this.isImmediatePropagationStopped=me,p&&!this.isSimulated&&p.stopImmediatePropagation(),this.stopPropagation()}},c.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},c.event.addProp),c.each({focus:"focusin",blur:"focusout"},function(p,N){c.event.special[p]={setup:function(){return we(this,p,ge),!1},trigger:function(){return we(this,p),!0},_default:function(){return!0},delegateType:N}}),c.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(p,N){c.event.special[p]={delegateType:N,bindType:N,handle:function(B){var Q,pe=B.relatedTarget,ve=B.handleObj;return pe&&(pe===this||c.contains(this,pe))||(B.type=ve.origType,Q=ve.handler.apply(this,arguments),B.type=N),Q}}}),c.fn.extend({on:function(p,N,B,Q){return Ie(this,p,N,B,Q)},one:function(p,N,B,Q){return Ie(this,p,N,B,Q,1)},off:function(p,N,B){var Q,pe;if(p&&p.preventDefault&&p.handleObj)return Q=p.handleObj,c(p.delegateTarget).off(Q.namespace?Q.origType+"."+Q.namespace:Q.origType,Q.selector,Q.handler),this;if("object"==typeof p){for(pe in p)this.off(pe,N,p[pe]);return this}return!1!==N&&"function"!=typeof N||(B=N,N=void 0),!1===B&&(B=Te),this.each(function(){c.event.remove(this,p,B,N)})}});var Pe=/<script|<style|<link/i,We=/checked\s*(?:[^=]|=\s*.checked.)/i,Je=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function tt(p,N){return le(p,"table")&&le(11!==N.nodeType?N:N.firstChild,"tr")&&c(p).children("tbody")[0]||p}function Ft(p){return p.type=(null!==p.getAttribute("type"))+"/"+p.type,p}function si(p){return"true/"===(p.type||"").slice(0,5)?p.type=p.type.slice(5):p.removeAttribute("type"),p}function Pi(p,N){var B,Q,pe,ve,be,Ue;if(1===N.nodeType){if(je.hasData(p)&&(Ue=je.get(p).events))for(pe in je.remove(N,"handle events"),Ue)for(B=0,Q=Ue[pe].length;B<Q;B++)c.event.add(N,pe,Ue[pe][B]);xt.hasData(p)&&(ve=xt.access(p),be=c.extend({},ve),xt.set(N,be))}}function yi(p,N,B,Q){N=e(N);var pe,ve,be,Ue,xe,qe,Ke=0,pt=p.length,Qe=pt-1,$e=N[0],Ae=n($e);if(Ae||1<pt&&"string"==typeof $e&&!S.checkClone&&We.test($e))return p.each(function(W){var oe=p.eq(W);Ae&&(N[0]=$e.call(this,W,oe.html())),yi(oe,N,B,Q)});if(pt&&(ve=(pe=ee(N,p[0].ownerDocument,!1,p,Q)).firstChild,1===pe.childNodes.length&&(pe=ve),ve||Q)){for(Ue=(be=c.map(K(pe,"script"),Ft)).length;Ke<pt;Ke++)xe=pe,Ke!==Qe&&(xe=c.clone(xe,!0,!0),Ue&&c.merge(be,K(xe,"script"))),B.call(p[Ke],xe,Ke);if(Ue)for(qe=be[be.length-1].ownerDocument,c.map(be,si),Ke=0;Ke<Ue;Ke++)Ce.test((xe=be[Ke]).type||"")&&!je.access(xe,"globalEval")&&c.contains(qe,xe)&&(xe.src&&"module"!==(xe.type||"").toLowerCase()?c._evalUrl&&!xe.noModule&&c._evalUrl(xe.src,{nonce:xe.nonce||xe.getAttribute("nonce")},qe):u(xe.textContent.replace(Je,""),xe,qe))}return p}function Ti(p,N,B){for(var Q,pe=N?c.filter(N,p):p,ve=0;null!=(Q=pe[ve]);ve++)B||1!==Q.nodeType||c.cleanData(K(Q)),Q.parentNode&&(B&&t(Q)&&L(K(Q,"script")),Q.parentNode.removeChild(Q));return p}c.extend({htmlPrefilter:function(p){return p},clone:function(p,N,B){var Q,pe,ve,be,Ue,xe,qe,Ke=p.cloneNode(!0),pt=t(p);if(!(S.noCloneChecked||1!==p.nodeType&&11!==p.nodeType||c.isXMLDoc(p)))for(be=K(Ke),Q=0,pe=(ve=K(p)).length;Q<pe;Q++)Ue=ve[Q],"input"===(qe=(xe=be[Q]).nodeName.toLowerCase())&&ae.test(Ue.type)?xe.checked=Ue.checked:"input"!==qe&&"textarea"!==qe||(xe.defaultValue=Ue.defaultValue);if(N)if(B)for(ve=ve||K(p),be=be||K(Ke),Q=0,pe=ve.length;Q<pe;Q++)Pi(ve[Q],be[Q]);else Pi(p,Ke);return 0<(be=K(Ke,"script")).length&&L(be,!pt&&K(p,"script")),Ke},cleanData:function(p){for(var N,B,Q,pe=c.event.special,ve=0;void 0!==(B=p[ve]);ve++)if(Mt(B)){if(N=B[je.expando]){if(N.events)for(Q in N.events)pe[Q]?c.event.remove(B,Q):c.removeEvent(B,Q,N.handle);B[je.expando]=void 0}B[xt.expando]&&(B[xt.expando]=void 0)}}}),c.fn.extend({detach:function(p){return Ti(this,p,!0)},remove:function(p){return Ti(this,p)},text:function(p){return at(this,function(N){return void 0===N?c.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=N)})},null,p,arguments.length)},append:function(){return yi(this,arguments,function(p){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||tt(this,p).appendChild(p)})},prepend:function(){return yi(this,arguments,function(p){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var N=tt(this,p);N.insertBefore(p,N.firstChild)}})},before:function(){return yi(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this)})},after:function(){return yi(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this.nextSibling)})},empty:function(){for(var p,N=0;null!=(p=this[N]);N++)1===p.nodeType&&(c.cleanData(K(p,!1)),p.textContent="");return this},clone:function(p,N){return p=null!=p&&p,N=null==N?p:N,this.map(function(){return c.clone(this,p,N)})},html:function(p){return at(this,function(N){var B=this[0]||{},Q=0,pe=this.length;if(void 0===N&&1===B.nodeType)return B.innerHTML;if("string"==typeof N&&!Pe.test(N)&&!re[(Re.exec(N)||["",""])[1].toLowerCase()]){N=c.htmlPrefilter(N);try{for(;Q<pe;Q++)1===(B=this[Q]||{}).nodeType&&(c.cleanData(K(B,!1)),B.innerHTML=N);B=0}catch(ve){}}B&&this.empty().append(N)},null,p,arguments.length)},replaceWith:function(){var p=[];return yi(this,arguments,function(N){var B=this.parentNode;c.inArray(this,p)<0&&(c.cleanData(K(this)),B&&B.replaceChild(N,this))},p)}}),c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(p,N){c.fn[p]=function(B){for(var Q,pe=[],ve=c(B),be=ve.length-1,Ue=0;Ue<=be;Ue++)Q=Ue===be?this:this.clone(!0),c(ve[Ue])[N](Q),i.apply(pe,Q.get());return this.pushStack(pe)}});var _i=new RegExp("^("+Xe+")(?!px)[a-z%]+$","i"),Zi=function(p){var N=p.ownerDocument.defaultView;return N&&N.opener||(N=nt),N.getComputedStyle(p)},ki=function(p,N,B){var Q,pe,ve={};for(pe in N)ve[pe]=p.style[pe],p.style[pe]=N[pe];for(pe in Q=B.call(p),N)p.style[pe]=ve[pe];return Q},$t=new RegExp(G.join("|"),"i");function ni(p,N,B){var Q,pe,ve,be,Ue=p.style;return(B=B||Zi(p))&&(""!==(be=B.getPropertyValue(N)||B[N])||t(p)||(be=c.style(p,N)),!S.pixelBoxStyles()&&_i.test(be)&&$t.test(N)&&(Q=Ue.width,pe=Ue.minWidth,ve=Ue.maxWidth,Ue.minWidth=Ue.maxWidth=Ue.width=be,be=B.width,Ue.width=Q,Ue.minWidth=pe,Ue.maxWidth=ve)),void 0!==be?be+"":be}function ai(p,N){return{get:function(){if(!p())return(this.get=N).apply(this,arguments);delete this.get}}}!function(){function p(){if(qe){xe.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",qe.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",A.appendChild(xe).appendChild(qe);var Ke=nt.getComputedStyle(qe);B="1%"!==Ke.top,Ue=12===N(Ke.marginLeft),qe.style.right="60%",ve=36===N(Ke.right),Q=36===N(Ke.width),qe.style.position="absolute",pe=12===N(qe.offsetWidth/3),A.removeChild(xe),qe=null}}function N(Ke){return Math.round(parseFloat(Ke))}var B,Q,pe,ve,be,Ue,xe=R.createElement("div"),qe=R.createElement("div");qe.style&&(qe.style.backgroundClip="content-box",qe.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle="content-box"===qe.style.backgroundClip,c.extend(S,{boxSizingReliable:function(){return p(),Q},pixelBoxStyles:function(){return p(),ve},pixelPosition:function(){return p(),B},reliableMarginLeft:function(){return p(),Ue},scrollboxSize:function(){return p(),pe},reliableTrDimensions:function(){var Ke,pt,Qe,$e;return null==be&&(Ke=R.createElement("table"),pt=R.createElement("tr"),Qe=R.createElement("div"),Ke.style.cssText="position:absolute;left:-11111px;border-collapse:separate",pt.style.cssText="border:1px solid",pt.style.height="1px",Qe.style.height="9px",Qe.style.display="block",A.appendChild(Ke).appendChild(pt).appendChild(Qe),$e=nt.getComputedStyle(pt),be=parseInt($e.height,10)+parseInt($e.borderTopWidth,10)+parseInt($e.borderBottomWidth,10)===pt.offsetHeight,A.removeChild(Ke)),be}}))}();var Ci=["Webkit","Moz","ms"],Ii=R.createElement("div").style,wi={};function Ei(p){return c.cssProps[p]||wi[p]||(p in Ii?p:wi[p]=function(B){for(var Q=B[0].toUpperCase()+B.slice(1),pe=Ci.length;pe--;)if((B=Ci[pe]+Q)in Ii)return B}(p)||p)}var Ai=/^(none|table(?!-c[ea]).+)/,Vi=/^--/,cn={position:"absolute",visibility:"hidden",display:"block"},Hi={letterSpacing:"0",fontWeight:"400"};function Ji(p,N,B){var Q=zt.exec(N);return Q?Math.max(0,Q[2]-(B||0))+(Q[3]||"px"):N}function un(p,N,B,Q,pe,ve){var be="width"===N?1:0,Ue=0,xe=0;if(B===(Q?"border":"content"))return 0;for(;be<4;be+=2)"margin"===B&&(xe+=c.css(p,B+G[be],!0,pe)),Q?("content"===B&&(xe-=c.css(p,"padding"+G[be],!0,pe)),"margin"!==B&&(xe-=c.css(p,"border"+G[be]+"Width",!0,pe))):(xe+=c.css(p,"padding"+G[be],!0,pe),"padding"!==B?xe+=c.css(p,"border"+G[be]+"Width",!0,pe):Ue+=c.css(p,"border"+G[be]+"Width",!0,pe));return!Q&&0<=ve&&(xe+=Math.max(0,Math.ceil(p["offset"+N[0].toUpperCase()+N.slice(1)]-ve-xe-Ue-.5))||0),xe}function hn(p,N,B){var Q=Zi(p),pe=(!S.boxSizingReliable()||B)&&"border-box"===c.css(p,"boxSizing",!1,Q),ve=pe,be=ni(p,N,Q),Ue="offset"+N[0].toUpperCase()+N.slice(1);if(_i.test(be)){if(!B)return be;be="auto"}return(!S.boxSizingReliable()&&pe||!S.reliableTrDimensions()&&le(p,"tr")||"auto"===be||!parseFloat(be)&&"inline"===c.css(p,"display",!1,Q))&&p.getClientRects().length&&(pe="border-box"===c.css(p,"boxSizing",!1,Q),(ve=Ue in p)&&(be=p[Ue])),(be=parseFloat(be)||0)+un(p,N,B||(pe?"border":"content"),ve,Q,be)+"px"}function Di(p,N,B,Q,pe){return new Di.prototype.init(p,N,B,Q,pe)}c.extend({cssHooks:{opacity:{get:function(p,N){if(N){var B=ni(p,"opacity");return""===B?"1":B}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(p,N,B,Q){if(p&&3!==p.nodeType&&8!==p.nodeType&&p.style){var pe,ve,be,Ue=dt(N),xe=Vi.test(N),qe=p.style;if(xe||(N=Ei(Ue)),be=c.cssHooks[N]||c.cssHooks[Ue],void 0===B)return be&&"get"in be&&void 0!==(pe=be.get(p,!1,Q))?pe:qe[N];"string"==(ve=typeof B)&&(pe=zt.exec(B))&&pe[1]&&(B=v(p,N,pe),ve="number"),null!=B&&B==B&&("number"!==ve||xe||(B+=pe&&pe[3]||(c.cssNumber[Ue]?"":"px")),S.clearCloneStyle||""!==B||0!==N.indexOf("background")||(qe[N]="inherit"),be&&"set"in be&&void 0===(B=be.set(p,B,Q))||(xe?qe.setProperty(N,B):qe[N]=B))}},css:function(p,N,B,Q){var pe,ve,be,Ue=dt(N);return Vi.test(N)||(N=Ei(Ue)),(be=c.cssHooks[N]||c.cssHooks[Ue])&&"get"in be&&(pe=be.get(p,!0,B)),void 0===pe&&(pe=ni(p,N,Q)),"normal"===pe&&N in Hi&&(pe=Hi[N]),""===B||B?(ve=parseFloat(pe),!0===B||isFinite(ve)?ve||0:pe):pe}}),c.each(["height","width"],function(p,N){c.cssHooks[N]={get:function(B,Q,pe){if(Q)return!Ai.test(c.css(B,"display"))||B.getClientRects().length&&B.getBoundingClientRect().width?hn(B,N,pe):ki(B,cn,function(){return hn(B,N,pe)})},set:function(B,Q,pe){var ve,be=Zi(B),Ue=!S.scrollboxSize()&&"absolute"===be.position,xe=(Ue||pe)&&"border-box"===c.css(B,"boxSizing",!1,be),qe=pe?un(B,N,pe,xe,be):0;return xe&&Ue&&(qe-=Math.ceil(B["offset"+N[0].toUpperCase()+N.slice(1)]-parseFloat(be[N])-un(B,N,"border",!1,be)-.5)),qe&&(ve=zt.exec(Q))&&"px"!==(ve[3]||"px")&&(B.style[N]=Q,Q=c.css(B,N)),Ji(0,Q,qe)}}}),c.cssHooks.marginLeft=ai(S.reliableMarginLeft,function(p,N){if(N)return(parseFloat(ni(p,"marginLeft"))||p.getBoundingClientRect().left-ki(p,{marginLeft:0},function(){return p.getBoundingClientRect().left}))+"px"}),c.each({margin:"",padding:"",border:"Width"},function(p,N){c.cssHooks[p+N]={expand:function(B){for(var Q=0,pe={},ve="string"==typeof B?B.split(" "):[B];Q<4;Q++)pe[p+G[Q]+N]=ve[Q]||ve[Q-2]||ve[0];return pe}},"margin"!==p&&(c.cssHooks[p+N].set=Ji)}),c.fn.extend({css:function(p,N){return at(this,function(B,Q,pe){var ve,be,Ue={},xe=0;if(Array.isArray(Q)){for(ve=Zi(B),be=Q.length;xe<be;xe++)Ue[Q[xe]]=c.css(B,Q[xe],!1,ve);return Ue}return void 0!==pe?c.style(B,Q,pe):c.css(B,Q)},p,N,1<arguments.length)}}),((c.Tween=Di).prototype={constructor:Di,init:function(p,N,B,Q,pe,ve){this.elem=p,this.prop=B,this.easing=pe||c.easing._default,this.options=N,this.start=this.now=this.cur(),this.end=Q,this.unit=ve||(c.cssNumber[B]?"":"px")},cur:function(){var p=Di.propHooks[this.prop];return p&&p.get?p.get(this):Di.propHooks._default.get(this)},run:function(p){var N,B=Di.propHooks[this.prop];return this.pos=N=this.options.duration?c.easing[this.easing](p,this.options.duration*p,0,1,this.options.duration):p,this.now=(this.end-this.start)*N+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),B&&B.set?B.set(this):Di.propHooks._default.set(this),this}}).init.prototype=Di.prototype,(Di.propHooks={_default:{get:function(p){var N;return 1!==p.elem.nodeType||null!=p.elem[p.prop]&&null==p.elem.style[p.prop]?p.elem[p.prop]:(N=c.css(p.elem,p.prop,""))&&"auto"!==N?N:0},set:function(p){c.fx.step[p.prop]?c.fx.step[p.prop](p):1!==p.elem.nodeType||!c.cssHooks[p.prop]&&null==p.elem.style[Ei(p.prop)]?p.elem[p.prop]=p.now:c.style(p.elem,p.prop,p.now+p.unit)}}}).scrollTop=Di.propHooks.scrollLeft={set:function(p){p.elem.nodeType&&p.elem.parentNode&&(p.elem[p.prop]=p.now)}},c.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},c.fx=Di.prototype.init,c.fx.step={};var en,In,Yi,xn,Nn=/^(?:toggle|show|hide)$/,Ki=/queueHooks$/;function Xn(){In&&(!1===R.hidden&&nt.requestAnimationFrame?nt.requestAnimationFrame(Xn):nt.setTimeout(Xn,c.fx.interval),c.fx.tick())}function Rn(){return nt.setTimeout(function(){en=void 0}),en=Date.now()}function Fi(p,N){var B,Q=0,pe={height:p};for(N=N?1:0;Q<4;Q+=2-N)pe["margin"+(B=G[Q])]=pe["padding"+B]=p;return N&&(pe.opacity=pe.width=p),pe}function ta(p,N,B){for(var Q,pe=(tn.tweeners[N]||[]).concat(tn.tweeners["*"]),ve=0,be=pe.length;ve<be;ve++)if(Q=pe[ve].call(B,N,p))return Q}function tn(p,N,B){var Q,pe,ve=0,be=tn.prefilters.length,Ue=c.Deferred().always(function(){delete xe.elem}),xe=function(){if(pe)return!1;for(var pt=en||Rn(),Qe=Math.max(0,qe.startTime+qe.duration-pt),$e=1-(Qe/qe.duration||0),Ae=0,W=qe.tweens.length;Ae<W;Ae++)qe.tweens[Ae].run($e);return Ue.notifyWith(p,[qe,$e,Qe]),$e<1&&W?Qe:(W||Ue.notifyWith(p,[qe,1,0]),Ue.resolveWith(p,[qe]),!1)},qe=Ue.promise({elem:p,props:c.extend({},N),opts:c.extend(!0,{specialEasing:{},easing:c.easing._default},B),originalProperties:N,originalOptions:B,startTime:en||Rn(),duration:B.duration,tweens:[],createTween:function(pt,Qe){var $e=c.Tween(p,qe.opts,pt,Qe,qe.opts.specialEasing[pt]||qe.opts.easing);return qe.tweens.push($e),$e},stop:function(pt){var Qe=0,$e=pt?qe.tweens.length:0;if(pe)return this;for(pe=!0;Qe<$e;Qe++)qe.tweens[Qe].run(1);return pt?(Ue.notifyWith(p,[qe,1,0]),Ue.resolveWith(p,[qe,pt])):Ue.rejectWith(p,[qe,pt]),this}}),Ke=qe.props;for(function(pt,Qe){var $e,Ae,W,oe,De;for($e in pt)if(W=Qe[Ae=dt($e)],oe=pt[$e],Array.isArray(oe)&&(W=oe[1],oe=pt[$e]=oe[0]),$e!==Ae&&(pt[Ae]=oe,delete pt[$e]),(De=c.cssHooks[Ae])&&"expand"in De)for($e in oe=De.expand(oe),delete pt[Ae],oe)$e in pt||(pt[$e]=oe[$e],Qe[$e]=W);else Qe[Ae]=W}(Ke,qe.opts.specialEasing);ve<be;ve++)if(Q=tn.prefilters[ve].call(qe,p,Ke,qe.opts))return n(Q.stop)&&(c._queueHooks(qe.elem,qe.opts.queue).stop=Q.stop.bind(Q)),Q;return c.map(Ke,ta,qe),n(qe.opts.start)&&qe.opts.start.call(p,qe),qe.progress(qe.opts.progress).done(qe.opts.done,qe.opts.complete).fail(qe.opts.fail).always(qe.opts.always),c.fx.timer(c.extend(xe,{elem:p,anim:qe,queue:qe.opts.queue})),qe}c.Animation=c.extend(tn,{tweeners:{"*":[function(p,N){var B=this.createTween(p,N);return v(B.elem,p,zt.exec(N),B),B}]},tweener:function(p,N){n(p)?(N=p,p=["*"]):p=p.match(ze);for(var B,Q=0,pe=p.length;Q<pe;Q++)(tn.tweeners[B=p[Q]]=tn.tweeners[B]||[]).unshift(N)},prefilters:[function(p,N,B){var Q,pe,ve,be,Ue,xe,qe,Ke,pt="width"in N||"height"in N,Qe=this,$e={},Ae=p.style,W=p.nodeType&&s(p),oe=je.get(p,"fxshow");for(Q in B.queue||(null==(be=c._queueHooks(p,"fx")).unqueued&&(be.unqueued=0,Ue=be.empty.fire,be.empty.fire=function(){be.unqueued||Ue()}),be.unqueued++,Qe.always(function(){Qe.always(function(){be.unqueued--,c.queue(p,"fx").length||be.empty.fire()})})),N)if(Nn.test(pe=N[Q])){if(delete N[Q],ve=ve||"toggle"===pe,pe===(W?"hide":"show")){if("show"!==pe||!oe||void 0===oe[Q])continue;W=!0}$e[Q]=oe&&oe[Q]||c.style(p,Q)}if((xe=!c.isEmptyObject(N))||!c.isEmptyObject($e))for(Q in pt&&1===p.nodeType&&(B.overflow=[Ae.overflow,Ae.overflowX,Ae.overflowY],null==(qe=oe&&oe.display)&&(qe=je.get(p,"display")),"none"===(Ke=c.css(p,"display"))&&(qe?Ke=qe:(g([p],!0),qe=p.style.display||qe,Ke=c.css(p,"display"),g([p]))),("inline"===Ke||"inline-block"===Ke&&null!=qe)&&"none"===c.css(p,"float")&&(xe||(Qe.done(function(){Ae.display=qe}),null==qe&&(qe="none"===(Ke=Ae.display)?"":Ke)),Ae.display="inline-block")),B.overflow&&(Ae.overflow="hidden",Qe.always(function(){Ae.overflow=B.overflow[0],Ae.overflowX=B.overflow[1],Ae.overflowY=B.overflow[2]})),xe=!1,$e)xe||(oe?"hidden"in oe&&(W=oe.hidden):oe=je.access(p,"fxshow",{display:qe}),ve&&(oe.hidden=!W),W&&g([p],!0),Qe.done(function(){for(Q in W||g([p]),je.remove(p,"fxshow"),$e)c.style(p,Q,$e[Q])})),xe=ta(W?oe[Q]:0,Q,Qe),Q in oe||(oe[Q]=xe.start,W&&(xe.end=xe.start,xe.start=0))}],prefilter:function(p,N){N?tn.prefilters.unshift(p):tn.prefilters.push(p)}}),c.speed=function(p,N,B){var Q=p&&"object"==typeof p?c.extend({},p):{complete:B||!B&&N||n(p)&&p,duration:p,easing:B&&N||N&&!n(N)&&N};return c.fx.off?Q.duration=0:"number"!=typeof Q.duration&&(Q.duration=Q.duration in c.fx.speeds?c.fx.speeds[Q.duration]:c.fx.speeds._default),null!=Q.queue&&!0!==Q.queue||(Q.queue="fx"),Q.old=Q.complete,Q.complete=function(){n(Q.old)&&Q.old.call(this),Q.queue&&c.dequeue(this,Q.queue)},Q},c.fn.extend({fadeTo:function(p,N,B,Q){return this.filter(s).css("opacity",0).show().end().animate({opacity:N},p,B,Q)},animate:function(p,N,B,Q){var pe=c.isEmptyObject(p),ve=c.speed(N,B,Q),be=function(){var Ue=tn(this,c.extend({},p),ve);(pe||je.get(this,"finish"))&&Ue.stop(!0)};return be.finish=be,pe||!1===ve.queue?this.each(be):this.queue(ve.queue,be)},stop:function(p,N,B){var Q=function(pe){var ve=pe.stop;delete pe.stop,ve(B)};return"string"!=typeof p&&(B=N,N=p,p=void 0),N&&this.queue(p||"fx",[]),this.each(function(){var pe=!0,ve=null!=p&&p+"queueHooks",be=c.timers,Ue=je.get(this);if(ve)Ue[ve]&&Ue[ve].stop&&Q(Ue[ve]);else for(ve in Ue)Ue[ve]&&Ue[ve].stop&&Ki.test(ve)&&Q(Ue[ve]);for(ve=be.length;ve--;)be[ve].elem!==this||null!=p&&be[ve].queue!==p||(be[ve].anim.stop(B),pe=!1,be.splice(ve,1));!pe&&B||c.dequeue(this,p)})},finish:function(p){return!1!==p&&(p=p||"fx"),this.each(function(){var N,B=je.get(this),Q=B[p+"queue"],pe=B[p+"queueHooks"],ve=c.timers,be=Q?Q.length:0;for(B.finish=!0,c.queue(this,p,[]),pe&&pe.stop&&pe.stop.call(this,!0),N=ve.length;N--;)ve[N].elem===this&&ve[N].queue===p&&(ve[N].anim.stop(!0),ve.splice(N,1));for(N=0;N<be;N++)Q[N]&&Q[N].finish&&Q[N].finish.call(this);delete B.finish})}}),c.each(["toggle","show","hide"],function(p,N){var B=c.fn[N];c.fn[N]=function(Q,pe,ve){return null==Q||"boolean"==typeof Q?B.apply(this,arguments):this.animate(Fi(N,!0),Q,pe,ve)}}),c.each({slideDown:Fi("show"),slideUp:Fi("hide"),slideToggle:Fi("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(p,N){c.fn[p]=function(B,Q,pe){return this.animate(N,B,Q,pe)}}),c.timers=[],c.fx.tick=function(){var p,N=0,B=c.timers;for(en=Date.now();N<B.length;N++)(p=B[N])()||B[N]!==p||B.splice(N--,1);B.length||c.fx.stop(),en=void 0},c.fx.timer=function(p){c.timers.push(p),c.fx.start()},c.fx.interval=13,c.fx.start=function(){In||(In=!0,Xn())},c.fx.stop=function(){In=null},c.fx.speeds={slow:600,fast:200,_default:400},c.fn.delay=function(p,N){return p=c.fx&&c.fx.speeds[p]||p,this.queue(N=N||"fx",function(B,Q){var pe=nt.setTimeout(B,p);Q.stop=function(){nt.clearTimeout(pe)}})},Yi=R.createElement("input"),xn=R.createElement("select").appendChild(R.createElement("option")),Yi.type="checkbox",S.checkOn=""!==Yi.value,S.optSelected=xn.selected,(Yi=R.createElement("input")).value="t",Yi.type="radio",S.radioValue="t"===Yi.value;var Oe,ct=c.expr.attrHandle;c.fn.extend({attr:function(p,N){return at(this,c.attr,p,N,1<arguments.length)},removeAttr:function(p){return this.each(function(){c.removeAttr(this,p)})}}),c.extend({attr:function(p,N,B){var Q,pe,ve=p.nodeType;if(3!==ve&&8!==ve&&2!==ve)return void 0===p.getAttribute?c.prop(p,N,B):(1===ve&&c.isXMLDoc(p)||(pe=c.attrHooks[N.toLowerCase()]||(c.expr.match.bool.test(N)?Oe:void 0)),void 0!==B?null===B?void c.removeAttr(p,N):pe&&"set"in pe&&void 0!==(Q=pe.set(p,B,N))?Q:(p.setAttribute(N,B+""),B):pe&&"get"in pe&&null!==(Q=pe.get(p,N))?Q:null==(Q=c.find.attr(p,N))?void 0:Q)},attrHooks:{type:{set:function(p,N){if(!S.radioValue&&"radio"===N&&le(p,"input")){var B=p.value;return p.setAttribute("type",N),B&&(p.value=B),N}}}},removeAttr:function(p,N){var B,Q=0,pe=N&&N.match(ze);if(pe&&1===p.nodeType)for(;B=pe[Q++];)p.removeAttribute(B)}}),Oe={set:function(p,N,B){return!1===N?c.removeAttr(p,B):p.setAttribute(B,B),B}},c.each(c.expr.match.bool.source.match(/\w+/g),function(p,N){var B=ct[N]||c.find.attr;ct[N]=function(Q,pe,ve){var be,Ue,xe=pe.toLowerCase();return ve||(Ue=ct[xe],ct[xe]=be,be=null!=B(Q,pe,ve)?xe:null,ct[xe]=Ue),be}});var It=/^(?:input|select|textarea|button)$/i,rt=/^(?:a|area)$/i;function Bt(p){return(p.match(ze)||[]).join(" ")}function lt(p){return p.getAttribute&&p.getAttribute("class")||""}function vi(p){return Array.isArray(p)?p:"string"==typeof p&&p.match(ze)||[]}c.fn.extend({prop:function(p,N){return at(this,c.prop,p,N,1<arguments.length)},removeProp:function(p){return this.each(function(){delete this[c.propFix[p]||p]})}}),c.extend({prop:function(p,N,B){var Q,pe,ve=p.nodeType;if(3!==ve&&8!==ve&&2!==ve)return 1===ve&&c.isXMLDoc(p)||(pe=c.propHooks[N=c.propFix[N]||N]),void 0!==B?pe&&"set"in pe&&void 0!==(Q=pe.set(p,B,N))?Q:p[N]=B:pe&&"get"in pe&&null!==(Q=pe.get(p,N))?Q:p[N]},propHooks:{tabIndex:{get:function(p){var N=c.find.attr(p,"tabindex");return N?parseInt(N,10):It.test(p.nodeName)||rt.test(p.nodeName)&&p.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(c.propHooks.selected={get:function(p){return null},set:function(p){}}),c.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){c.propFix[this.toLowerCase()]=this}),c.fn.extend({addClass:function(p){var N,B,Q,pe,ve,be,Ue,xe=0;if(n(p))return this.each(function(qe){c(this).addClass(p.call(this,qe,lt(this)))});if((N=vi(p)).length)for(;B=this[xe++];)if(pe=lt(B),Q=1===B.nodeType&&" "+Bt(pe)+" "){for(be=0;ve=N[be++];)Q.indexOf(" "+ve+" ")<0&&(Q+=ve+" ");pe!==(Ue=Bt(Q))&&B.setAttribute("class",Ue)}return this},removeClass:function(p){var N,B,Q,pe,ve,be,Ue,xe=0;if(n(p))return this.each(function(qe){c(this).removeClass(p.call(this,qe,lt(this)))});if(!arguments.length)return this.attr("class","");if((N=vi(p)).length)for(;B=this[xe++];)if(pe=lt(B),Q=1===B.nodeType&&" "+Bt(pe)+" "){for(be=0;ve=N[be++];)for(;-1<Q.indexOf(" "+ve+" ");)Q=Q.replace(" "+ve+" "," ");pe!==(Ue=Bt(Q))&&B.setAttribute("class",Ue)}return this},toggleClass:function(p,N){var B=typeof p,Q="string"===B||Array.isArray(p);return"boolean"==typeof N&&Q?N?this.addClass(p):this.removeClass(p):n(p)?this.each(function(pe){c(this).toggleClass(p.call(this,pe,lt(this),N),N)}):this.each(function(){var pe,ve,be,Ue;if(Q)for(ve=0,be=c(this),Ue=vi(p);pe=Ue[ve++];)be.hasClass(pe)?be.removeClass(pe):be.addClass(pe);else void 0!==p&&"boolean"!==B||((pe=lt(this))&&je.set(this,"__className__",pe),this.setAttribute&&this.setAttribute("class",pe||!1===p?"":je.get(this,"__className__")||""))})},hasClass:function(p){var N,B,Q=0;for(N=" "+p+" ";B=this[Q++];)if(1===B.nodeType&&-1<(" "+Bt(lt(B))+" ").indexOf(N))return!0;return!1}});var pi=/\r/g;c.fn.extend({val:function(p){var N,B,Q,pe=this[0];return arguments.length?(Q=n(p),this.each(function(ve){var be;1===this.nodeType&&(null==(be=Q?p.call(this,ve,c(this).val()):p)?be="":"number"==typeof be?be+="":Array.isArray(be)&&(be=c.map(be,function(Ue){return null==Ue?"":Ue+""})),(N=c.valHooks[this.type]||c.valHooks[this.nodeName.toLowerCase()])&&"set"in N&&void 0!==N.set(this,be,"value")||(this.value=be))})):pe?(N=c.valHooks[pe.type]||c.valHooks[pe.nodeName.toLowerCase()])&&"get"in N&&void 0!==(B=N.get(pe,"value"))?B:"string"==typeof(B=pe.value)?B.replace(pi,""):null==B?"":B:void 0}}),c.extend({valHooks:{option:{get:function(p){var N=c.find.attr(p,"value");return null!=N?N:Bt(c.text(p))}},select:{get:function(p){var N,B,Q,pe=p.options,ve=p.selectedIndex,be="select-one"===p.type,Ue=be?null:[],xe=be?ve+1:pe.length;for(Q=ve<0?xe:be?ve:0;Q<xe;Q++)if(((B=pe[Q]).selected||Q===ve)&&!B.disabled&&(!B.parentNode.disabled||!le(B.parentNode,"optgroup"))){if(N=c(B).val(),be)return N;Ue.push(N)}return Ue},set:function(p,N){for(var B,Q,pe=p.options,ve=c.makeArray(N),be=pe.length;be--;)((Q=pe[be]).selected=-1<c.inArray(c.valHooks.option.get(Q),ve))&&(B=!0);return B||(p.selectedIndex=-1),ve}}}}),c.each(["radio","checkbox"],function(){c.valHooks[this]={set:function(p,N){if(Array.isArray(N))return p.checked=-1<c.inArray(c(p).val(),N)}},S.checkOn||(c.valHooks[this].get=function(p){return null===p.getAttribute("value")?"on":p.value})}),S.focusin="onfocusin"in nt;var ri=/^(?:focusinfocus|focusoutblur)$/,wt=function(p){p.stopPropagation()};c.extend(c.event,{trigger:function(p,N,B,Q){var pe,ve,be,Ue,xe,qe,Ke,pt,Qe=[B||R],$e=w.call(p,"type")?p.type:p,Ae=w.call(p,"namespace")?p.namespace.split("."):[];if(ve=pt=be=B=B||R,3!==B.nodeType&&8!==B.nodeType&&!ri.test($e+c.event.triggered)&&(-1<$e.indexOf(".")&&($e=(Ae=$e.split(".")).shift(),Ae.sort()),xe=$e.indexOf(":")<0&&"on"+$e,(p=p[c.expando]?p:new c.Event($e,"object"==typeof p&&p)).isTrigger=Q?2:3,p.namespace=Ae.join("."),p.rnamespace=p.namespace?new RegExp("(^|\\.)"+Ae.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p.result=void 0,p.target||(p.target=B),N=null==N?[p]:c.makeArray(N,[p]),Ke=c.event.special[$e]||{},Q||!Ke.trigger||!1!==Ke.trigger.apply(B,N))){if(!Q&&!Ke.noBubble&&!y(B)){for(ri.test((Ue=Ke.delegateType||$e)+$e)||(ve=ve.parentNode);ve;ve=ve.parentNode)Qe.push(ve),be=ve;be===(B.ownerDocument||R)&&Qe.push(be.defaultView||be.parentWindow||nt)}for(pe=0;(ve=Qe[pe++])&&!p.isPropagationStopped();)pt=ve,p.type=1<pe?Ue:Ke.bindType||$e,(qe=(je.get(ve,"events")||Object.create(null))[p.type]&&je.get(ve,"handle"))&&qe.apply(ve,N),(qe=xe&&ve[xe])&&qe.apply&&Mt(ve)&&(p.result=qe.apply(ve,N),!1===p.result&&p.preventDefault());return p.type=$e,Q||p.isDefaultPrevented()||Ke._default&&!1!==Ke._default.apply(Qe.pop(),N)||!Mt(B)||xe&&n(B[$e])&&!y(B)&&((be=B[xe])&&(B[xe]=null),c.event.triggered=$e,p.isPropagationStopped()&&pt.addEventListener($e,wt),B[$e](),p.isPropagationStopped()&&pt.removeEventListener($e,wt),c.event.triggered=void 0,be&&(B[xe]=be)),p.result}},simulate:function(p,N,B){var Q=c.extend(new c.Event,B,{type:p,isSimulated:!0});c.event.trigger(Q,null,N)}}),c.fn.extend({trigger:function(p,N){return this.each(function(){c.event.trigger(p,N,this)})},triggerHandler:function(p,N){var B=this[0];if(B)return c.event.trigger(p,N,B,!0)}}),S.focusin||c.each({focus:"focusin",blur:"focusout"},function(p,N){var B=function(Q){c.event.simulate(N,Q.target,c.event.fix(Q))};c.event.special[N]={setup:function(){var Q=this.ownerDocument||this.document||this,pe=je.access(Q,N);pe||Q.addEventListener(p,B,!0),je.access(Q,N,(pe||0)+1)},teardown:function(){var Q=this.ownerDocument||this.document||this,pe=je.access(Q,N)-1;pe?je.access(Q,N,pe):(Q.removeEventListener(p,B,!0),je.remove(Q,N))}}});var jt=nt.location,Vt={guid:Date.now()},fi=/\?/;c.parseXML=function(p){var N,B;if(!p||"string"!=typeof p)return null;try{N=(new nt.DOMParser).parseFromString(p,"text/xml")}catch(Q){}return B=N&&N.getElementsByTagName("parsererror")[0],N&&!B||c.error("Invalid XML: "+(B?c.map(B.childNodes,function(Q){return Q.textContent}).join("\n"):p)),N};var qn=/\[\]$/,ia=/\r?\n/g,na=/^(?:submit|button|image|reset|file)$/i,ca=/^(?:input|select|textarea|keygen)/i;function Pn(p,N,B,Q){var pe;if(Array.isArray(N))c.each(N,function(ve,be){B||qn.test(p)?Q(p,be):Pn(p+"["+("object"==typeof be&&null!=be?ve:"")+"]",be,B,Q)});else if(B||"object"!==f(N))Q(p,N);else for(pe in N)Pn(p+"["+pe+"]",N[pe],B,Q)}c.param=function(p,N){var B,Q=[],pe=function(ve,be){var Ue=n(be)?be():be;Q[Q.length]=encodeURIComponent(ve)+"="+encodeURIComponent(null==Ue?"":Ue)};if(null==p)return"";if(Array.isArray(p)||p.jquery&&!c.isPlainObject(p))c.each(p,function(){pe(this.name,this.value)});else for(B in p)Pn(B,p[B],N,pe);return Q.join("&")},c.fn.extend({serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var p=c.prop(this,"elements");return p?c.makeArray(p):this}).filter(function(){var p=this.type;return this.name&&!c(this).is(":disabled")&&ca.test(this.nodeName)&&!na.test(p)&&(this.checked||!ae.test(p))}).map(function(p,N){var B=c(this).val();return null==B?null:Array.isArray(B)?c.map(B,function(Q){return{name:N.name,value:Q.replace(ia,"\r\n")}}):{name:N.name,value:B.replace(ia,"\r\n")}}).get()}});var Hn=/%20/g,Kn=/#.*$/,Qn=/([?&])_=[^&]*/,aa=/^(.*?):[ \t]*([^\r\n]*)$/gm,ua=/^(?:GET|HEAD)$/,Ea=/^\/\//,ma={},$n={},ra="*/".concat("*"),ga=R.createElement("a");function mn(p){return function(N,B){"string"!=typeof N&&(B=N,N="*");var Q,pe=0,ve=N.toLowerCase().match(ze)||[];if(n(B))for(;Q=ve[pe++];)"+"===Q[0]?(Q=Q.slice(1)||"*",(p[Q]=p[Q]||[]).unshift(B)):(p[Q]=p[Q]||[]).push(B)}}function va(p,N,B,Q){var pe={},ve=p===$n;function be(Ue){var xe;return pe[Ue]=!0,c.each(p[Ue]||[],function(qe,Ke){var pt=Ke(N,B,Q);return"string"!=typeof pt||ve||pe[pt]?ve?!(xe=pt):void 0:(N.dataTypes.unshift(pt),be(pt),!1)}),xe}return be(N.dataTypes[0])||!pe["*"]&&be("*")}function ba(p,N){var B,Q,pe=c.ajaxSettings.flatOptions||{};for(B in N)void 0!==N[B]&&((pe[B]?p:Q||(Q={}))[B]=N[B]);return Q&&c.extend(!0,p,Q),p}ga.href=jt.href,c.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:jt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(jt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ra,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":c.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(p,N){return N?ba(ba(p,c.ajaxSettings),N):ba(c.ajaxSettings,p)},ajaxPrefilter:mn(ma),ajaxTransport:mn($n),ajax:function(p,N){"object"==typeof p&&(N=p,p=void 0);var B,Q,pe,ve,be,Ue,xe,qe,Ke,pt,Qe=c.ajaxSetup({},N=N||{}),$e=Qe.context||Qe,Ae=Qe.context&&($e.nodeType||$e.jquery)?c($e):c.event,W=c.Deferred(),oe=c.Callbacks("once memory"),De=Qe.statusCode||{},Be={},it={},ft="canceled",Tt={readyState:0,getResponseHeader:function(Ht){var ti;if(xe){if(!ve)for(ve={};ti=aa.exec(pe);)ve[ti[1].toLowerCase()+" "]=(ve[ti[1].toLowerCase()+" "]||[]).concat(ti[2]);ti=ve[Ht.toLowerCase()+" "]}return null==ti?null:ti.join(", ")},getAllResponseHeaders:function(){return xe?pe:null},setRequestHeader:function(Ht,ti){return null==xe&&(Ht=it[Ht.toLowerCase()]=it[Ht.toLowerCase()]||Ht,Be[Ht]=ti),this},overrideMimeType:function(Ht){return null==xe&&(Qe.mimeType=Ht),this},statusCode:function(Ht){var ti;if(Ht)if(xe)Tt.always(Ht[Tt.status]);else for(ti in Ht)De[ti]=[De[ti],Ht[ti]];return this},abort:function(Ht){var ti=Ht||ft;return B&&B.abort(ti),Qt(0,ti),this}};if(W.promise(Tt),Qe.url=((p||Qe.url||jt.href)+"").replace(Ea,jt.protocol+"//"),Qe.type=N.method||N.type||Qe.method||Qe.type,Qe.dataTypes=(Qe.dataType||"*").toLowerCase().match(ze)||[""],null==Qe.crossDomain){Ue=R.createElement("a");try{Ue.href=Qe.url,Ue.href=Ue.href,Qe.crossDomain=ga.protocol+"//"+ga.host!=Ue.protocol+"//"+Ue.host}catch(Ht){Qe.crossDomain=!0}}if(Qe.data&&Qe.processData&&"string"!=typeof Qe.data&&(Qe.data=c.param(Qe.data,Qe.traditional)),va(ma,Qe,N,Tt),xe)return Tt;for(Ke in(qe=c.event&&Qe.global)&&0==c.active++&&c.event.trigger("ajaxStart"),Qe.type=Qe.type.toUpperCase(),Qe.hasContent=!ua.test(Qe.type),Q=Qe.url.replace(Kn,""),Qe.hasContent?Qe.data&&Qe.processData&&0===(Qe.contentType||"").indexOf("application/x-www-form-urlencoded")&&(Qe.data=Qe.data.replace(Hn,"+")):(pt=Qe.url.slice(Q.length),Qe.data&&(Qe.processData||"string"==typeof Qe.data)&&(Q+=(fi.test(Q)?"&":"?")+Qe.data,delete Qe.data),!1===Qe.cache&&(Q=Q.replace(Qn,"$1"),pt=(fi.test(Q)?"&":"?")+"_="+Vt.guid+++pt),Qe.url=Q+pt),Qe.ifModified&&(c.lastModified[Q]&&Tt.setRequestHeader("If-Modified-Since",c.lastModified[Q]),c.etag[Q]&&Tt.setRequestHeader("If-None-Match",c.etag[Q])),(Qe.data&&Qe.hasContent&&!1!==Qe.contentType||N.contentType)&&Tt.setRequestHeader("Content-Type",Qe.contentType),Tt.setRequestHeader("Accept",Qe.dataTypes[0]&&Qe.accepts[Qe.dataTypes[0]]?Qe.accepts[Qe.dataTypes[0]]+("*"!==Qe.dataTypes[0]?", "+ra+"; q=0.01":""):Qe.accepts["*"]),Qe.headers)Tt.setRequestHeader(Ke,Qe.headers[Ke]);if(Qe.beforeSend&&(!1===Qe.beforeSend.call($e,Tt,Qe)||xe))return Tt.abort();if(ft="abort",oe.add(Qe.complete),Tt.done(Qe.success),Tt.fail(Qe.error),B=va($n,Qe,N,Tt)){if(Tt.readyState=1,qe&&Ae.trigger("ajaxSend",[Tt,Qe]),xe)return Tt;Qe.async&&0<Qe.timeout&&(be=nt.setTimeout(function(){Tt.abort("timeout")},Qe.timeout));try{xe=!1,B.send(Be,Qt)}catch(Ht){if(xe)throw Ht;Qt(-1,Ht)}}else Qt(-1,"No Transport");function Qt(Ht,ti,li,Li){var Si,ei,xi,vt,di,Wi=ti;xe||(xe=!0,be&&nt.clearTimeout(be),B=void 0,pe=Li||"",Tt.readyState=0<Ht?4:0,Si=200<=Ht&&Ht<300||304===Ht,li&&(vt=function(bi,pn,gn){for(var Wn,Zt,ci,Gi,wn=bi.contents,Bi=bi.dataTypes;"*"===Bi[0];)Bi.shift(),void 0===Wn&&(Wn=bi.mimeType||pn.getResponseHeader("Content-Type"));if(Wn)for(Zt in wn)if(wn[Zt]&&wn[Zt].test(Wn)){Bi.unshift(Zt);break}if(Bi[0]in gn)ci=Bi[0];else{for(Zt in gn){if(!Bi[0]||bi.converters[Zt+" "+Bi[0]]){ci=Zt;break}Gi||(Gi=Zt)}ci=ci||Gi}if(ci)return ci!==Bi[0]&&Bi.unshift(ci),gn[ci]}(Qe,Tt,li)),!Si&&-1<c.inArray("script",Qe.dataTypes)&&c.inArray("json",Qe.dataTypes)<0&&(Qe.converters["text script"]=function(){}),vt=function(bi,pn,gn,Wn){var Zt,ci,Gi,wn,Bi,En={},Zn=bi.dataTypes.slice();if(Zn[1])for(Gi in bi.converters)En[Gi.toLowerCase()]=bi.converters[Gi];for(ci=Zn.shift();ci;)if(bi.responseFields[ci]&&(gn[bi.responseFields[ci]]=pn),!Bi&&Wn&&bi.dataFilter&&(pn=bi.dataFilter(pn,bi.dataType)),Bi=ci,ci=Zn.shift())if("*"===ci)ci=Bi;else if("*"!==Bi&&Bi!==ci){if(!(Gi=En[Bi+" "+ci]||En["* "+ci]))for(Zt in En)if((wn=Zt.split(" "))[1]===ci&&(Gi=En[Bi+" "+wn[0]]||En["* "+wn[0]])){!0===Gi?Gi=En[Zt]:!0!==En[Zt]&&(ci=wn[0],Zn.unshift(wn[1]));break}if(!0!==Gi)if(Gi&&bi.throws)pn=Gi(pn);else try{pn=Gi(pn)}catch(nn){return{state:"parsererror",error:Gi?nn:"No conversion from "+Bi+" to "+ci}}}return{state:"success",data:pn}}(Qe,vt,Tt,Si),Si?(Qe.ifModified&&((di=Tt.getResponseHeader("Last-Modified"))&&(c.lastModified[Q]=di),(di=Tt.getResponseHeader("etag"))&&(c.etag[Q]=di)),204===Ht||"HEAD"===Qe.type?Wi="nocontent":304===Ht?Wi="notmodified":(Wi=vt.state,ei=vt.data,Si=!(xi=vt.error))):(xi=Wi,!Ht&&Wi||(Wi="error",Ht<0&&(Ht=0))),Tt.status=Ht,Tt.statusText=(ti||Wi)+"",Si?W.resolveWith($e,[ei,Wi,Tt]):W.rejectWith($e,[Tt,Wi,xi]),Tt.statusCode(De),De=void 0,qe&&Ae.trigger(Si?"ajaxSuccess":"ajaxError",[Tt,Qe,Si?ei:xi]),oe.fireWith($e,[Tt,Wi]),qe&&(Ae.trigger("ajaxComplete",[Tt,Qe]),--c.active||c.event.trigger("ajaxStop")))}return Tt},getJSON:function(p,N,B){return c.get(p,N,B,"json")},getScript:function(p,N){return c.get(p,void 0,N,"script")}}),c.each(["get","post"],function(p,N){c[N]=function(B,Q,pe,ve){return n(Q)&&(ve=ve||pe,pe=Q,Q=void 0),c.ajax(c.extend({url:B,type:N,dataType:ve,data:Q,success:pe},c.isPlainObject(B)&&B))}}),c.ajaxPrefilter(function(p){var N;for(N in p.headers)"content-type"===N.toLowerCase()&&(p.contentType=p.headers[N]||"")}),c._evalUrl=function(p,N,B){return c.ajax({url:p,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(Q){c.globalEval(Q,N,B)}})},c.fn.extend({wrapAll:function(p){var N;return this[0]&&(n(p)&&(p=p.call(this[0])),N=c(p,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&N.insertBefore(this[0]),N.map(function(){for(var B=this;B.firstElementChild;)B=B.firstElementChild;return B}).append(this)),this},wrapInner:function(p){return n(p)?this.each(function(N){c(this).wrapInner(p.call(this,N))}):this.each(function(){var N=c(this),B=N.contents();B.length?B.wrapAll(p):N.append(p)})},wrap:function(p){var N=n(p);return this.each(function(B){c(this).wrapAll(N?p.call(this,B):p)})},unwrap:function(p){return this.parent(p).not("body").each(function(){c(this).replaceWith(this.childNodes)}),this}}),c.expr.pseudos.hidden=function(p){return!c.expr.pseudos.visible(p)},c.expr.pseudos.visible=function(p){return!!(p.offsetWidth||p.offsetHeight||p.getClientRects().length)},c.ajaxSettings.xhr=function(){try{return new nt.XMLHttpRequest}catch(p){}};var ya={0:200,1223:204},Jn=c.ajaxSettings.xhr();S.cors=!!Jn&&"withCredentials"in Jn,S.ajax=Jn=!!Jn,c.ajaxTransport(function(p){var N,B;if(S.cors||Jn&&!p.crossDomain)return{send:function(Q,pe){var ve,be=p.xhr();if(be.open(p.type,p.url,p.async,p.username,p.password),p.xhrFields)for(ve in p.xhrFields)be[ve]=p.xhrFields[ve];for(ve in p.mimeType&&be.overrideMimeType&&be.overrideMimeType(p.mimeType),p.crossDomain||Q["X-Requested-With"]||(Q["X-Requested-With"]="XMLHttpRequest"),Q)be.setRequestHeader(ve,Q[ve]);N=function(Ue){return function(){N&&(N=B=be.onload=be.onerror=be.onabort=be.ontimeout=be.onreadystatechange=null,"abort"===Ue?be.abort():"error"===Ue?"number"!=typeof be.status?pe(0,"error"):pe(be.status,be.statusText):pe(ya[be.status]||be.status,be.statusText,"text"!==(be.responseType||"text")||"string"!=typeof be.responseText?{binary:be.response}:{text:be.responseText},be.getAllResponseHeaders()))}},be.onload=N(),B=be.onerror=be.ontimeout=N("error"),void 0!==be.onabort?be.onabort=B:be.onreadystatechange=function(){4===be.readyState&&nt.setTimeout(function(){N&&B()})},N=N("abort");try{be.send(p.hasContent&&p.data||null)}catch(Ue){if(N)throw Ue}},abort:function(){N&&N()}}}),c.ajaxPrefilter(function(p){p.crossDomain&&(p.contents.script=!1)}),c.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(p){return c.globalEval(p),p}}}),c.ajaxPrefilter("script",function(p){void 0===p.cache&&(p.cache=!1),p.crossDomain&&(p.type="GET")}),c.ajaxTransport("script",function(p){var N,B;if(p.crossDomain||p.scriptAttrs)return{send:function(Q,pe){N=c("<script>").attr(p.scriptAttrs||{}).prop({charset:p.scriptCharset,src:p.url}).on("load error",B=function(ve){N.remove(),B=null,ve&&pe("error"===ve.type?404:200,ve.type)}),R.head.appendChild(N[0])},abort:function(){B&&B()}}});var oa,ha=[],Yn=/(=)\?(?=&|$)|\?\?/;c.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var p=ha.pop()||c.expando+"_"+Vt.guid++;return this[p]=!0,p}}),c.ajaxPrefilter("json jsonp",function(p,N,B){var Q,pe,ve,be=!1!==p.jsonp&&(Yn.test(p.url)?"url":"string"==typeof p.data&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yn.test(p.data)&&"data");if(be||"jsonp"===p.dataTypes[0])return Q=p.jsonpCallback=n(p.jsonpCallback)?p.jsonpCallback():p.jsonpCallback,be?p[be]=p[be].replace(Yn,"$1"+Q):!1!==p.jsonp&&(p.url+=(fi.test(p.url)?"&":"?")+p.jsonp+"="+Q),p.converters["script json"]=function(){return ve||c.error(Q+" was not called"),ve[0]},p.dataTypes[0]="json",pe=nt[Q],nt[Q]=function(){ve=arguments},B.always(function(){void 0===pe?c(nt).removeProp(Q):nt[Q]=pe,p[Q]&&(p.jsonpCallback=N.jsonpCallback,ha.push(Q)),ve&&n(pe)&&pe(ve[0]),ve=pe=void 0}),"script"}),S.createHTMLDocument=((oa=R.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===oa.childNodes.length),c.parseHTML=function(p,N,B){return"string"!=typeof p?[]:("boolean"==typeof N&&(B=N,N=!1),N||(S.createHTMLDocument?((Q=(N=R.implementation.createHTMLDocument("")).createElement("base")).href=R.location.href,N.head.appendChild(Q)):N=R),ve=!B&&[],(pe=x.exec(p))?[N.createElement(pe[1])]:(pe=ee([p],N,ve),ve&&ve.length&&c(ve).remove(),c.merge([],pe.childNodes)));var Q,pe,ve},c.fn.load=function(p,N,B){var Q,pe,ve,be=this,Ue=p.indexOf(" ");return-1<Ue&&(Q=Bt(p.slice(Ue)),p=p.slice(0,Ue)),n(N)?(B=N,N=void 0):N&&"object"==typeof N&&(pe="POST"),0<be.length&&c.ajax({url:p,type:pe||"GET",dataType:"html",data:N}).done(function(xe){ve=arguments,be.html(Q?c("<div>").append(c.parseHTML(xe)).find(Q):xe)}).always(B&&function(xe,qe){be.each(function(){B.apply(this,ve||[xe.responseText,qe,xe])})}),this},c.expr.pseudos.animated=function(p){return c.grep(c.timers,function(N){return p===N.elem}).length},c.offset={setOffset:function(p,N,B){var Q,pe,ve,be,Ue,xe,qe=c.css(p,"position"),Ke=c(p),pt={};"static"===qe&&(p.style.position="relative"),Ue=Ke.offset(),ve=c.css(p,"top"),xe=c.css(p,"left"),("absolute"===qe||"fixed"===qe)&&-1<(ve+xe).indexOf("auto")?(be=(Q=Ke.position()).top,pe=Q.left):(be=parseFloat(ve)||0,pe=parseFloat(xe)||0),n(N)&&(N=N.call(p,B,c.extend({},Ue))),null!=N.top&&(pt.top=N.top-Ue.top+be),null!=N.left&&(pt.left=N.left-Ue.left+pe),"using"in N?N.using.call(p,pt):Ke.css(pt)}},c.fn.extend({offset:function(p){if(arguments.length)return void 0===p?this:this.each(function(pe){c.offset.setOffset(this,p,pe)});var N,B,Q=this[0];return Q?Q.getClientRects().length?{top:(N=Q.getBoundingClientRect()).top+(B=Q.ownerDocument.defaultView).pageYOffset,left:N.left+B.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var p,N,B,Q=this[0],pe={top:0,left:0};if("fixed"===c.css(Q,"position"))N=Q.getBoundingClientRect();else{for(N=this.offset(),B=Q.ownerDocument,p=Q.offsetParent||B.documentElement;p&&(p===B.body||p===B.documentElement)&&"static"===c.css(p,"position");)p=p.parentNode;p&&p!==Q&&1===p.nodeType&&((pe=c(p).offset()).top+=c.css(p,"borderTopWidth",!0),pe.left+=c.css(p,"borderLeftWidth",!0))}return{top:N.top-pe.top-c.css(Q,"marginTop",!0),left:N.left-pe.left-c.css(Q,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var p=this.offsetParent;p&&"static"===c.css(p,"position");)p=p.offsetParent;return p||A})}}),c.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(p,N){var B="pageYOffset"===N;c.fn[p]=function(Q){return at(this,function(pe,ve,be){var Ue;if(y(pe)?Ue=pe:9===pe.nodeType&&(Ue=pe.defaultView),void 0===be)return Ue?Ue[N]:pe[ve];Ue?Ue.scrollTo(B?Ue.pageXOffset:be,B?be:Ue.pageYOffset):pe[ve]=be},p,Q,arguments.length)}}),c.each(["top","left"],function(p,N){c.cssHooks[N]=ai(S.pixelPosition,function(B,Q){if(Q)return Q=ni(B,N),_i.test(Q)?c(B).position()[N]+"px":Q})}),c.each({Height:"height",Width:"width"},function(p,N){c.each({padding:"inner"+p,content:N,"":"outer"+p},function(B,Q){c.fn[Q]=function(pe,ve){var be=arguments.length&&(B||"boolean"!=typeof pe),Ue=B||(!0===pe||!0===ve?"margin":"border");return at(this,function(xe,qe,Ke){var pt;return y(xe)?0===Q.indexOf("outer")?xe["inner"+p]:xe.document.documentElement["client"+p]:9===xe.nodeType?(pt=xe.documentElement,Math.max(xe.body["scroll"+p],pt["scroll"+p],xe.body["offset"+p],pt["offset"+p],pt["client"+p])):void 0===Ke?c.css(xe,qe,Ue):c.style(xe,qe,Ke,Ue)},N,be?pe:void 0,be)}})}),c.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(p,N){c.fn[N]=function(B){return this.on(N,B)}}),c.fn.extend({bind:function(p,N,B){return this.on(p,null,N,B)},unbind:function(p,N){return this.off(p,null,N)},delegate:function(p,N,B,Q){return this.on(N,p,B,Q)},undelegate:function(p,N,B){return 1===arguments.length?this.off(p,"**"):this.off(N,p||"**",B)},hover:function(p,N){return this.mouseenter(p).mouseleave(N||p)}}),c.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(p,N){c.fn[N]=function(B,Q){return 0<arguments.length?this.on(N,null,B,Q):this.trigger(N)}});var zn=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;c.proxy=function(p,N){var B,Q,pe;if("string"==typeof N&&(B=p[N],N=p,p=B),n(p))return Q=J.call(arguments,2),(pe=function(){return p.apply(N||this,Q.concat(J.call(arguments)))}).guid=p.guid=p.guid||c.guid++,pe},c.holdReady=function(p){p?c.readyWait++:c.ready(!0)},c.isArray=Array.isArray,c.parseJSON=JSON.parse,c.nodeName=le,c.isFunction=n,c.isWindow=y,c.camelCase=dt,c.type=f,c.now=Date.now,c.isNumeric=function(p){var N=c.type(p);return("number"===N||"string"===N)&&!isNaN(p-parseFloat(p))},c.trim=function(p){return null==p?"":(p+"").replace(zn,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return c});var Sa=nt.jQuery,Ca=nt.$;return c.noConflict=function(p){return nt.$===c&&(nt.$=Ca),p&&nt.jQuery===c&&(nt.jQuery=Sa),c},void 0===Lt&&(nt.jQuery=nt.$=c),c}),function(nt,Lt){"object"==typeof exports&&"undefined"!=typeof module?module.exports=Lt(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],Lt):(nt="undefined"!=typeof globalThis?globalThis:nt||self).bootstrap=Lt(nt.Popper)}(this,function(nt){"use strict";const Ze=function(Ae){if(Ae&&Ae.__esModule)return Ae;const W=Object.create(null);if(Ae)for(const oe in Ae)if("default"!==oe){const De=Object.getOwnPropertyDescriptor(Ae,oe);Object.defineProperty(W,oe,De.get?De:{enumerable:!0,get:()=>Ae[oe]})}return W.default=Ae,Object.freeze(W)}(nt),V="transitionend",J=Ae=>{let W=Ae.getAttribute("data-bs-target");if(!W||"#"===W){let oe=Ae.getAttribute("href");if(!oe||!oe.includes("#")&&!oe.startsWith("."))return null;oe.includes("#")&&!oe.startsWith("#")&&(oe=`#${oe.split("#")[1]}`),W=oe&&"#"!==oe?oe.trim():null}return W},e=Ae=>{const W=J(Ae);return W&&document.querySelector(W)?W:null},i=Ae=>{const W=J(Ae);return W?document.querySelector(W):null},d=Ae=>{Ae.dispatchEvent(new Event(V))},h=Ae=>!(!Ae||"object"!=typeof Ae)&&(void 0!==Ae.jquery&&(Ae=Ae[0]),void 0!==Ae.nodeType),P=Ae=>h(Ae)?Ae.jquery?Ae[0]:Ae:"string"==typeof Ae&&Ae.length>0?document.querySelector(Ae):null,w=(Ae,W,oe)=>{Object.keys(oe).forEach(De=>{const Be=oe[De],it=W[De],ft=it&&h(it)?"element":null==(Tt=it)?`${Tt}`:{}.toString.call(Tt).match(/\s([a-z]+)/i)[1].toLowerCase();var Tt;if(!new RegExp(Be).test(ft))throw new TypeError(`${Ae.toUpperCase()}: Option "${De}" provided type "${ft}" but expected type "${Be}".`)})},M=Ae=>!(!h(Ae)||0===Ae.getClientRects().length)&&"visible"===getComputedStyle(Ae).getPropertyValue("visibility"),C=Ae=>!Ae||Ae.nodeType!==Node.ELEMENT_NODE||!!Ae.classList.contains("disabled")||(void 0!==Ae.disabled?Ae.disabled:Ae.hasAttribute("disabled")&&"false"!==Ae.getAttribute("disabled")),S=Ae=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof Ae.getRootNode){const W=Ae.getRootNode();return W instanceof ShadowRoot?W:null}return Ae instanceof ShadowRoot?Ae:Ae.parentNode?S(Ae.parentNode):null},n=()=>{},R=()=>{const{jQuery:Ae}=window;return Ae&&!document.body.hasAttribute("data-bs-no-jquery")?Ae:null},m=[],u=()=>"rtl"===document.documentElement.dir,f=Ae=>{var W;W=()=>{const oe=R();if(oe){const De=Ae.NAME,Be=oe.fn[De];oe.fn[De]=Ae.jQueryInterface,oe.fn[De].Constructor=Ae,oe.fn[De].noConflict=()=>(oe.fn[De]=Be,Ae.jQueryInterface)}},"loading"===document.readyState?(m.length||document.addEventListener("DOMContentLoaded",()=>{m.forEach(oe=>oe())}),m.push(W)):W()},I=Ae=>{"function"==typeof Ae&&Ae()},c=(Ae,W,oe=!0)=>{if(!oe)return void I(Ae);const De=(ft=>{if(!ft)return 0;let{transitionDuration:Tt,transitionDelay:Qt}=window.getComputedStyle(ft);const Ht=Number.parseFloat(Tt),ti=Number.parseFloat(Qt);return Ht||ti?(Tt=Tt.split(",")[0],Qt=Qt.split(",")[0],1e3*(Number.parseFloat(Tt)+Number.parseFloat(Qt))):0})(W)+5;let Be=!1;const it=({target:ft})=>{ft===W&&(Be=!0,W.removeEventListener(V,it),I(Ae))};W.addEventListener(V,it),setTimeout(()=>{Be||d(W)},De)},j=(Ae,W,oe,De)=>{let Be=Ae.indexOf(W);if(-1===Be)return Ae[!oe&&De?Ae.length-1:0];const it=Ae.length;return Be+=oe?1:-1,De&&(Be=(Be+it)%it),Ae[Math.max(0,Math.min(Be,it-1))]},q=/[^.]*(?=\..*)\.|.*/,b=/\..*/,T=/::\d+$/,Z={};let le=1;const x={mouseenter:"mouseover",mouseleave:"mouseout"},Se=/^(mouseenter|mouseleave)/i,Ee=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function he(Ae,W){return W&&`${W}::${le++}`||Ae.uidEvent||le++}function ue(Ae){const W=he(Ae);return Ae.uidEvent=W,Z[W]=Z[W]||{},Z[W]}function ke(Ae,W,oe=null){const De=Object.keys(Ae);for(let Be=0,it=De.length;Be<it;Be++){const ft=Ae[De[Be]];if(ft.originalHandler===W&&ft.delegationSelector===oe)return ft}return null}function Ne(Ae,W,oe){const De="string"==typeof W,Be=De?oe:W;let it=et(Ae);return Ee.has(it)||(it=Ae),[De,Be,it]}function ze(Ae,W,oe,De,Be){if("string"!=typeof W||!Ae)return;if(oe||(oe=De,De=null),Se.test(W)){const Si=ei=>function(xi){if(!xi.relatedTarget||xi.relatedTarget!==xi.delegateTarget&&!xi.delegateTarget.contains(xi.relatedTarget))return ei.call(this,xi)};De?De=Si(De):oe=Si(oe)}const[it,ft,Tt]=Ne(W,oe,De),Qt=ue(Ae),Ht=Qt[Tt]||(Qt[Tt]={}),ti=ke(Ht,ft,it?oe:null);if(ti)return void(ti.oneOff=ti.oneOff&&Be);const li=he(ft,W.replace(q,"")),Li=it?(Si=Ae,ei=oe,xi=De,function vt(di){const Wi=Si.querySelectorAll(ei);for(let{target:bi}=di;bi&&bi!==this;bi=bi.parentNode)for(let pn=Wi.length;pn--;)if(Wi[pn]===bi)return di.delegateTarget=bi,vt.oneOff&&_e.off(Si,di.type,ei,xi),xi.apply(bi,[di]);return null}):function(Si,ei){return function xi(vt){return vt.delegateTarget=Si,xi.oneOff&&_e.off(Si,vt.type,ei),ei.apply(Si,[vt])}}(Ae,oe);var Si,ei,xi;Li.delegationSelector=it?oe:null,Li.originalHandler=ft,Li.oneOff=Be,Li.uidEvent=li,Ht[li]=Li,Ae.addEventListener(Tt,Li,it)}function Ve(Ae,W,oe,De,Be){const it=ke(W[oe],De,Be);it&&(Ae.removeEventListener(oe,it,Boolean(Be)),delete W[oe][it.uidEvent])}function et(Ae){return Ae=Ae.replace(b,""),x[Ae]||Ae}const _e={on(Ae,W,oe,De){ze(Ae,W,oe,De,!1)},one(Ae,W,oe,De){ze(Ae,W,oe,De,!0)},off(Ae,W,oe,De){if("string"!=typeof W||!Ae)return;const[Be,it,ft]=Ne(W,oe,De),Tt=ft!==W,Qt=ue(Ae),Ht=W.startsWith(".");if(void 0!==it)return Qt&&Qt[ft]?void Ve(Ae,Qt,ft,it,Be?oe:null):void 0;Ht&&Object.keys(Qt).forEach(li=>{!function(Li,Si,ei,xi){const vt=Si[ei]||{};Object.keys(vt).forEach(di=>{if(di.includes(xi)){const Wi=vt[di];Ve(Li,Si,ei,Wi.originalHandler,Wi.delegationSelector)}})}(Ae,Qt,li,W.slice(1))});const ti=Qt[ft]||{};Object.keys(ti).forEach(li=>{const Li=li.replace(T,"");if(!Tt||W.includes(Li)){const Si=ti[li];Ve(Ae,Qt,ft,Si.originalHandler,Si.delegationSelector)}})},trigger(Ae,W,oe){if("string"!=typeof W||!Ae)return null;const De=R(),Be=et(W),it=W!==Be,ft=Ee.has(Be);let Tt,Qt=!0,Ht=!0,ti=!1,li=null;return it&&De&&(Tt=De.Event(W,oe),De(Ae).trigger(Tt),Qt=!Tt.isPropagationStopped(),Ht=!Tt.isImmediatePropagationStopped(),ti=Tt.isDefaultPrevented()),ft?(li=document.createEvent("HTMLEvents"),li.initEvent(Be,Qt,!0)):li=new CustomEvent(W,{bubbles:Qt,cancelable:!0}),void 0!==oe&&Object.keys(oe).forEach(Li=>{Object.defineProperty(li,Li,{get:()=>oe[Li]})}),ti&&li.preventDefault(),Ht&&Ae.dispatchEvent(li),li.defaultPrevented&&void 0!==Tt&&Tt.preventDefault(),li}},gt=new Map,mt={set(Ae,W,oe){gt.has(Ae)||gt.set(Ae,new Map);const De=gt.get(Ae);De.has(W)||0===De.size?De.set(W,oe):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(De.keys())[0]}.`)},get:(Ae,W)=>gt.has(Ae)&&gt.get(Ae).get(W)||null,remove(Ae,W){if(!gt.has(Ae))return;const oe=gt.get(Ae);oe.delete(W),0===oe.size&&gt.delete(Ae)}};class ot{constructor(W){(W=P(W))&&(this._element=W,mt.set(this._element,this.constructor.DATA_KEY,this))}dispose(){mt.remove(this._element,this.constructor.DATA_KEY),_e.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this).forEach(W=>{this[W]=null})}_queueCallback(W,oe,De=!0){c(W,oe,De)}static getInstance(W){return mt.get(P(W),this.DATA_KEY)}static getOrCreateInstance(W,oe={}){return this.getInstance(W)||new this(W,"object"==typeof oe?oe:null)}static get VERSION(){return"5.1.3"}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}}const at=(Ae,W="hide")=>{const De=Ae.NAME;_e.on(document,`click.dismiss${Ae.EVENT_KEY}`,`[data-bs-dismiss="${De}"]`,function(Be){if(["A","AREA"].includes(this.tagName)&&Be.preventDefault(),C(this))return;const it=i(this)||this.closest(`.${De}`);Ae.getOrCreateInstance(it)[W]()})};class yt extends ot{static get NAME(){return"alert"}close(){if(_e.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const W=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,W)}_destroyElement(){this._element.remove(),_e.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(W){return this.each(function(){const oe=yt.getOrCreateInstance(this);if("string"==typeof W){if(void 0===oe[W]||W.startsWith("_")||"constructor"===W)throw new TypeError(`No method named "${W}"`);oe[W](this)}})}}at(yt,"close"),f(yt);const Et='[data-bs-toggle="button"]';class ie extends ot{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(W){return this.each(function(){const oe=ie.getOrCreateInstance(this);"toggle"===W&&oe[W]()})}}function dt(Ae){return"true"===Ae||"false"!==Ae&&(Ae===Number(Ae).toString()?Number(Ae):""===Ae||"null"===Ae?null:Ae)}function Mt(Ae){return Ae.replace(/[A-Z]/g,W=>`-${W.toLowerCase()}`)}_e.on(document,"click.bs.button.data-api",Et,Ae=>{Ae.preventDefault();const W=Ae.target.closest(Et);ie.getOrCreateInstance(W).toggle()}),f(ie);const Rt={setDataAttribute(Ae,W,oe){Ae.setAttribute(`data-bs-${Mt(W)}`,oe)},removeDataAttribute(Ae,W){Ae.removeAttribute(`data-bs-${Mt(W)}`)},getDataAttributes(Ae){if(!Ae)return{};const W={};return Object.keys(Ae.dataset).filter(oe=>oe.startsWith("bs")).forEach(oe=>{let De=oe.replace(/^bs/,"");De=De.charAt(0).toLowerCase()+De.slice(1,De.length),W[De]=dt(Ae.dataset[oe])}),W},getDataAttribute:(Ae,W)=>dt(Ae.getAttribute(`data-bs-${Mt(W)}`)),offset(Ae){const W=Ae.getBoundingClientRect();return{top:W.top+window.pageYOffset,left:W.left+window.pageXOffset}},position:Ae=>({top:Ae.offsetTop,left:Ae.offsetLeft})},je={find:(Ae,W=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(W,Ae)),findOne:(Ae,W=document.documentElement)=>Element.prototype.querySelector.call(W,Ae),children:(Ae,W)=>[].concat(...Ae.children).filter(oe=>oe.matches(W)),parents(Ae,W){const oe=[];let De=Ae.parentNode;for(;De&&De.nodeType===Node.ELEMENT_NODE&&3!==De.nodeType;)De.matches(W)&&oe.push(De),De=De.parentNode;return oe},prev(Ae,W){let oe=Ae.previousElementSibling;for(;oe;){if(oe.matches(W))return[oe];oe=oe.previousElementSibling}return[]},next(Ae,W){let oe=Ae.nextElementSibling;for(;oe;){if(oe.matches(W))return[oe];oe=oe.nextElementSibling}return[]},focusableChildren(Ae){const W=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(oe=>`${oe}:not([tabindex^="-"])`).join(", ");return this.find(W,Ae).filter(oe=>!C(oe)&&M(oe))}},xt="carousel",Wt={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},Gt={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},kt="next",Xe="prev",zt="left",G="right",A={ArrowLeft:G,ArrowRight:zt},t="slid.bs.carousel",l="active",s=".active.carousel-item";class v extends ot{constructor(W,oe){super(W),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(oe),this._indicatorsElement=je.findOne(".carousel-indicators",this._element),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent),this._addEventListeners()}static get Default(){return Wt}static get NAME(){return xt}next(){this._slide(kt)}nextWhenVisible(){!document.hidden&&M(this._element)&&this.next()}prev(){this._slide(Xe)}pause(W){W||(this._isPaused=!0),je.findOne(".carousel-item-next, .carousel-item-prev",this._element)&&(d(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}cycle(W){W||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config&&this._config.interval&&!this._isPaused&&(this._updateInterval(),this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}to(W){this._activeElement=je.findOne(s,this._element);const oe=this._getItemIndex(this._activeElement);if(!(W>this._items.length-1||W<0)){if(!this._isSliding)return oe===W?(this.pause(),void this.cycle()):void this._slide(W>oe?kt:Xe,this._items[W]);_e.one(this._element,t,()=>this.to(W))}}_getConfig(W){return W=ui(ui(ui({},Wt),Rt.getDataAttributes(this._element)),"object"==typeof W?W:{}),w(xt,W,Gt),W}_handleSwipe(){const W=Math.abs(this.touchDeltaX);if(W<=40)return;const oe=W/this.touchDeltaX;this.touchDeltaX=0,oe&&this._slide(oe>0?G:zt)}_addEventListeners(){this._config.keyboard&&_e.on(this._element,"keydown.bs.carousel",W=>this._keydown(W)),"hover"===this._config.pause&&(_e.on(this._element,"mouseenter.bs.carousel",W=>this.pause(W)),_e.on(this._element,"mouseleave.bs.carousel",W=>this.cycle(W))),this._config.touch&&this._touchSupported&&this._addTouchEventListeners()}_addTouchEventListeners(){const W=it=>this._pointerEvent&&("pen"===it.pointerType||"touch"===it.pointerType),oe=it=>{W(it)?this.touchStartX=it.clientX:this._pointerEvent||(this.touchStartX=it.touches[0].clientX)},De=it=>{this.touchDeltaX=it.touches&&it.touches.length>1?0:it.touches[0].clientX-this.touchStartX},Be=it=>{W(it)&&(this.touchDeltaX=it.clientX-this.touchStartX),this._handleSwipe(),"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(ft=>this.cycle(ft),500+this._config.interval))};je.find(".carousel-item img",this._element).forEach(it=>{_e.on(it,"dragstart.bs.carousel",ft=>ft.preventDefault())}),this._pointerEvent?(_e.on(this._element,"pointerdown.bs.carousel",it=>oe(it)),_e.on(this._element,"pointerup.bs.carousel",it=>Be(it)),this._element.classList.add("pointer-event")):(_e.on(this._element,"touchstart.bs.carousel",it=>oe(it)),_e.on(this._element,"touchmove.bs.carousel",it=>De(it)),_e.on(this._element,"touchend.bs.carousel",it=>Be(it)))}_keydown(W){if(/input|textarea/i.test(W.target.tagName))return;const oe=A[W.key];oe&&(W.preventDefault(),this._slide(oe))}_getItemIndex(W){return this._items=W&&W.parentNode?je.find(".carousel-item",W.parentNode):[],this._items.indexOf(W)}_getItemByOrder(W,oe){return j(this._items,oe,W===kt,this._config.wrap)}_triggerSlideEvent(W,oe){const De=this._getItemIndex(W),Be=this._getItemIndex(je.findOne(s,this._element));return _e.trigger(this._element,"slide.bs.carousel",{relatedTarget:W,direction:oe,from:Be,to:De})}_setActiveIndicatorElement(W){if(this._indicatorsElement){const oe=je.findOne(".active",this._indicatorsElement);oe.classList.remove(l),oe.removeAttribute("aria-current");const De=je.find("[data-bs-target]",this._indicatorsElement);for(let Be=0;Be<De.length;Be++)if(Number.parseInt(De[Be].getAttribute("data-bs-slide-to"),10)===this._getItemIndex(W)){De[Be].classList.add(l),De[Be].setAttribute("aria-current","true");break}}}_updateInterval(){const W=this._activeElement||je.findOne(s,this._element);if(!W)return;const oe=Number.parseInt(W.getAttribute("data-bs-interval"),10);oe?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=oe):this._config.interval=this._config.defaultInterval||this._config.interval}_slide(W,oe){const De=this._directionToOrder(W),Be=je.findOne(s,this._element),it=this._getItemIndex(Be),ft=oe||this._getItemByOrder(De,Be),Tt=this._getItemIndex(ft),Qt=Boolean(this._interval),Ht=De===kt,ti=Ht?"carousel-item-start":"carousel-item-end",li=Ht?"carousel-item-next":"carousel-item-prev",Li=this._orderToDirection(De);if(ft&&ft.classList.contains(l))return void(this._isSliding=!1);if(this._isSliding||this._triggerSlideEvent(ft,Li).defaultPrevented||!Be||!ft)return;this._isSliding=!0,Qt&&this.pause(),this._setActiveIndicatorElement(ft),this._activeElement=ft;const Si=()=>{_e.trigger(this._element,t,{relatedTarget:ft,direction:Li,from:it,to:Tt})};this._element.classList.contains("slide")?(ft.classList.add(li),Be.classList.add(ti),ft.classList.add(ti),this._queueCallback(()=>{ft.classList.remove(ti,li),ft.classList.add(l),Be.classList.remove(l,li,ti),this._isSliding=!1,setTimeout(Si,0)},Be,!0)):(Be.classList.remove(l),ft.classList.add(l),this._isSliding=!1,Si()),Qt&&this.cycle()}_directionToOrder(W){return[G,zt].includes(W)?u()?W===zt?Xe:kt:W===zt?kt:Xe:W}_orderToDirection(W){return[kt,Xe].includes(W)?u()?W===Xe?zt:G:W===Xe?G:zt:W}static carouselInterface(W,oe){const De=v.getOrCreateInstance(W,oe);let{_config:Be}=De;"object"==typeof oe&&(Be=ui(ui({},Be),oe));const it="string"==typeof oe?oe:Be.slide;if("number"==typeof oe)De.to(oe);else if("string"==typeof it){if(void 0===De[it])throw new TypeError(`No method named "${it}"`);De[it]()}else Be.interval&&Be.ride&&(De.pause(),De.cycle())}static jQueryInterface(W){return this.each(function(){v.carouselInterface(this,W)})}static dataApiClickHandler(W){const oe=i(this);if(!oe||!oe.classList.contains("carousel"))return;const De=ui(ui({},Rt.getDataAttributes(oe)),Rt.getDataAttributes(this)),Be=this.getAttribute("data-bs-slide-to");Be&&(De.interval=!1),v.carouselInterface(oe,De),Be&&v.getInstance(oe).to(Be),W.preventDefault()}}_e.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",v.dataApiClickHandler),_e.on(window,"load.bs.carousel.data-api",()=>{const Ae=je.find('[data-bs-ride="carousel"]');for(let W=0,oe=Ae.length;W<oe;W++)v.carouselInterface(Ae[W],v.getInstance(Ae[W]))}),f(v);const r="collapse",g={toggle:!0,parent:null},E={toggle:"boolean",parent:"(null|element)"},te="show",ae="collapse",Re="collapsing",Ce="collapsed",re=":scope .collapse .collapse",K='[data-bs-toggle="collapse"]';class L extends ot{constructor(W,oe){super(W),this._isTransitioning=!1,this._config=this._getConfig(oe),this._triggerArray=[];const De=je.find(K);for(let Be=0,it=De.length;Be<it;Be++){const ft=De[Be],Tt=e(ft),Qt=je.find(Tt).filter(Ht=>Ht===this._element);null!==Tt&&Qt.length&&(this._selector=Tt,this._triggerArray.push(ft))}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return g}static get NAME(){return r}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let W,oe=[];if(this._config.parent){const ft=je.find(re,this._config.parent);oe=je.find(".collapse.show, .collapse.collapsing",this._config.parent).filter(Tt=>!ft.includes(Tt))}const De=je.findOne(this._selector);if(oe.length){const ft=oe.find(Tt=>De!==Tt);if(W=ft?L.getInstance(ft):null,W&&W._isTransitioning)return}if(_e.trigger(this._element,"show.bs.collapse").defaultPrevented)return;oe.forEach(ft=>{De!==ft&&L.getOrCreateInstance(ft,{toggle:!1}).hide(),W||mt.set(ft,"bs.collapse",null)});const Be=this._getDimension();this._element.classList.remove(ae),this._element.classList.add(Re),this._element.style[Be]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const it=`scroll${Be[0].toUpperCase()+Be.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Re),this._element.classList.add(ae,te),this._element.style[Be]="",_e.trigger(this._element,"shown.bs.collapse")},this._element,!0),this._element.style[Be]=`${this._element[it]}px`}hide(){if(this._isTransitioning||!this._isShown()||_e.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const W=this._getDimension();this._element.style[W]=`${this._element.getBoundingClientRect()[W]}px`,this._element.classList.add(Re),this._element.classList.remove(ae,te);const oe=this._triggerArray.length;for(let De=0;De<oe;De++){const Be=this._triggerArray[De],it=i(Be);it&&!this._isShown(it)&&this._addAriaAndCollapsedClass([Be],!1)}this._isTransitioning=!0,this._element.style[W]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Re),this._element.classList.add(ae),_e.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}_isShown(W=this._element){return W.classList.contains(te)}_getConfig(W){return(W=ui(ui(ui({},g),Rt.getDataAttributes(this._element)),W)).toggle=Boolean(W.toggle),W.parent=P(W.parent),w(r,W,E),W}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const W=je.find(re,this._config.parent);je.find(K,this._config.parent).filter(oe=>!W.includes(oe)).forEach(oe=>{const De=i(oe);De&&this._addAriaAndCollapsedClass([oe],this._isShown(De))})}_addAriaAndCollapsedClass(W,oe){W.length&&W.forEach(De=>{oe?De.classList.remove(Ce):De.classList.add(Ce),De.setAttribute("aria-expanded",oe)})}static jQueryInterface(W){return this.each(function(){const oe={};"string"==typeof W&&/show|hide/.test(W)&&(oe.toggle=!1);const De=L.getOrCreateInstance(this,oe);if("string"==typeof W){if(void 0===De[W])throw new TypeError(`No method named "${W}"`);De[W]()}})}}_e.on(document,"click.bs.collapse.data-api",K,function(Ae){("A"===Ae.target.tagName||Ae.delegateTarget&&"A"===Ae.delegateTarget.tagName)&&Ae.preventDefault();const W=e(this);je.find(W).forEach(oe=>{L.getOrCreateInstance(oe,{toggle:!1}).toggle()})}),f(L);const ne="dropdown",ee="Escape",me="ArrowUp",Te="ArrowDown",ge=new RegExp("ArrowUp|ArrowDown|Escape"),Ie="click.bs.dropdown.data-api",we="keydown.bs.dropdown.data-api",Pe="show",We='[data-bs-toggle="dropdown"]',Je=".dropdown-menu",tt=u()?"top-end":"top-start",Ft=u()?"top-start":"top-end",si=u()?"bottom-end":"bottom-start",Pi=u()?"bottom-start":"bottom-end",yi=u()?"left-start":"right-start",Ti=u()?"right-start":"left-start",_i={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},Zi={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class ki extends ot{constructor(W,oe){super(W),this._popper=null,this._config=this._getConfig(oe),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar()}static get Default(){return _i}static get DefaultType(){return Zi}static get NAME(){return ne}toggle(){return this._isShown()?this.hide():this.show()}show(){if(C(this._element)||this._isShown(this._menu))return;const W={relatedTarget:this._element};if(_e.trigger(this._element,"show.bs.dropdown",W).defaultPrevented)return;const oe=ki.getParentFromElement(this._element);this._inNavbar?Rt.setDataAttribute(this._menu,"popper","none"):this._createPopper(oe),"ontouchstart"in document.documentElement&&!oe.closest(".navbar-nav")&&[].concat(...document.body.children).forEach(De=>_e.on(De,"mouseover",n)),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Pe),this._element.classList.add(Pe),_e.trigger(this._element,"shown.bs.dropdown",W)}hide(){!C(this._element)&&this._isShown(this._menu)&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(W){_e.trigger(this._element,"hide.bs.dropdown",W).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(oe=>_e.off(oe,"mouseover",n)),this._popper&&this._popper.destroy(),this._menu.classList.remove(Pe),this._element.classList.remove(Pe),this._element.setAttribute("aria-expanded","false"),Rt.removeDataAttribute(this._menu,"popper"),_e.trigger(this._element,"hidden.bs.dropdown",W))}_getConfig(W){if(W=ui(ui(ui({},this.constructor.Default),Rt.getDataAttributes(this._element)),W),w(ne,W,this.constructor.DefaultType),"object"==typeof W.reference&&!h(W.reference)&&"function"!=typeof W.reference.getBoundingClientRect)throw new TypeError(`${ne.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return W}_createPopper(W){if(void 0===Ze)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let oe=this._element;"parent"===this._config.reference?oe=W:h(this._config.reference)?oe=P(this._config.reference):"object"==typeof this._config.reference&&(oe=this._config.reference);const De=this._getPopperConfig(),Be=De.modifiers.find(it=>"applyStyles"===it.name&&!1===it.enabled);this._popper=Ze.createPopper(oe,this._menu,De),Be&&Rt.setDataAttribute(this._menu,"popper","static")}_isShown(W=this._element){return W.classList.contains(Pe)}_getMenuElement(){return je.next(this._element,Je)[0]}_getPlacement(){const W=this._element.parentNode;if(W.classList.contains("dropend"))return yi;if(W.classList.contains("dropstart"))return Ti;const oe="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return W.classList.contains("dropup")?oe?Ft:tt:oe?Pi:si}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:W}=this._config;return"string"==typeof W?W.split(",").map(oe=>Number.parseInt(oe,10)):"function"==typeof W?oe=>W(oe,this._element):W}_getPopperConfig(){const W={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return"static"===this._config.display&&(W.modifiers=[{name:"applyStyles",enabled:!1}]),ui(ui({},W),"function"==typeof this._config.popperConfig?this._config.popperConfig(W):this._config.popperConfig)}_selectMenuItem({key:W,target:oe}){const De=je.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(M);De.length&&j(De,oe,W===Te,!De.includes(oe)).focus()}static jQueryInterface(W){return this.each(function(){const oe=ki.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W]()}})}static clearMenus(W){if(W&&(2===W.button||"keyup"===W.type&&"Tab"!==W.key))return;const oe=je.find(We);for(let De=0,Be=oe.length;De<Be;De++){const it=ki.getInstance(oe[De]);if(!it||!1===it._config.autoClose||!it._isShown())continue;const ft={relatedTarget:it._element};if(W){const Tt=W.composedPath(),Qt=Tt.includes(it._menu);if(Tt.includes(it._element)||"inside"===it._config.autoClose&&!Qt||"outside"===it._config.autoClose&&Qt||it._menu.contains(W.target)&&("keyup"===W.type&&"Tab"===W.key||/input|select|option|textarea|form/i.test(W.target.tagName)))continue;"click"===W.type&&(ft.clickEvent=W)}it._completeHide(ft)}}static getParentFromElement(W){return i(W)||W.parentNode}static dataApiKeydownHandler(W){if(/input|textarea/i.test(W.target.tagName)?"Space"===W.key||W.key!==ee&&(W.key!==Te&&W.key!==me||W.target.closest(Je)):!ge.test(W.key))return;const oe=this.classList.contains(Pe);if(!oe&&W.key===ee||(W.preventDefault(),W.stopPropagation(),C(this)))return;const De=this.matches(We)?this:je.prev(this,We)[0],Be=ki.getOrCreateInstance(De);if(W.key!==ee)return W.key===me||W.key===Te?(oe||Be.show(),void Be._selectMenuItem(W)):void(oe&&"Space"!==W.key||ki.clearMenus());Be.hide()}}_e.on(document,we,We,ki.dataApiKeydownHandler),_e.on(document,we,Je,ki.dataApiKeydownHandler),_e.on(document,Ie,ki.clearMenus),_e.on(document,"keyup.bs.dropdown.data-api",ki.clearMenus),_e.on(document,Ie,We,function(Ae){Ae.preventDefault(),ki.getOrCreateInstance(this).toggle()}),f(ki);const $t=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",ni=".sticky-top";class ai{constructor(){this._element=document.body}getWidth(){const W=document.documentElement.clientWidth;return Math.abs(window.innerWidth-W)}hide(){const W=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,"paddingRight",oe=>oe+W),this._setElementAttributes($t,"paddingRight",oe=>oe+W),this._setElementAttributes(ni,"marginRight",oe=>oe-W)}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(W,oe,De){const Be=this.getWidth();this._applyManipulationCallback(W,it=>{if(it!==this._element&&window.innerWidth>it.clientWidth+Be)return;this._saveInitialAttribute(it,oe);const ft=window.getComputedStyle(it)[oe];it.style[oe]=`${De(Number.parseFloat(ft))}px`})}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,"paddingRight"),this._resetElementAttributes($t,"paddingRight"),this._resetElementAttributes(ni,"marginRight")}_saveInitialAttribute(W,oe){const De=W.style[oe];De&&Rt.setDataAttribute(W,oe,De)}_resetElementAttributes(W,oe){this._applyManipulationCallback(W,De=>{const Be=Rt.getDataAttribute(De,oe);void 0===Be?De.style.removeProperty(oe):(Rt.removeDataAttribute(De,oe),De.style[oe]=Be)})}_applyManipulationCallback(W,oe){h(W)?oe(W):je.find(W,this._element).forEach(oe)}isOverflowing(){return this.getWidth()>0}}const Ci={className:"modal-backdrop",isVisible:!0,isAnimated:!1,rootElement:"body",clickCallback:null},Ii={className:"string",isVisible:"boolean",isAnimated:"boolean",rootElement:"(element|string)",clickCallback:"(function|null)"},Ei="mousedown.bs.backdrop";class Ai{constructor(W){this._config=this._getConfig(W),this._isAppended=!1,this._element=null}show(W){this._config.isVisible?(this._append(),this._config.isAnimated&&this._getElement(),this._getElement().classList.add("show"),this._emulateAnimation(()=>{I(W)})):I(W)}hide(W){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation(()=>{this.dispose(),I(W)})):I(W)}_getElement(){if(!this._element){const W=document.createElement("div");W.className=this._config.className,this._config.isAnimated&&W.classList.add("fade"),this._element=W}return this._element}_getConfig(W){return(W=ui(ui({},Ci),"object"==typeof W?W:{})).rootElement=P(W.rootElement),w("backdrop",W,Ii),W}_append(){this._isAppended||(this._config.rootElement.append(this._getElement()),_e.on(this._getElement(),Ei,()=>{I(this._config.clickCallback)}),this._isAppended=!0)}dispose(){this._isAppended&&(_e.off(this._element,Ei),this._element.remove(),this._isAppended=!1)}_emulateAnimation(W){c(W,this._getElement(),this._config.isAnimated)}}const Vi={trapElement:null,autofocus:!0},cn={trapElement:"element",autofocus:"boolean"},Hi=".bs.focustrap",Ji="backward";class un{constructor(W){this._config=this._getConfig(W),this._isActive=!1,this._lastTabNavDirection=null}activate(){const{trapElement:W,autofocus:oe}=this._config;this._isActive||(oe&&W.focus(),_e.off(document,Hi),_e.on(document,"focusin.bs.focustrap",De=>this._handleFocusin(De)),_e.on(document,"keydown.tab.bs.focustrap",De=>this._handleKeydown(De)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,_e.off(document,Hi))}_handleFocusin(W){const{target:oe}=W,{trapElement:De}=this._config;if(oe===document||oe===De||De.contains(oe))return;const Be=je.focusableChildren(De);0===Be.length?De.focus():this._lastTabNavDirection===Ji?Be[Be.length-1].focus():Be[0].focus()}_handleKeydown(W){"Tab"===W.key&&(this._lastTabNavDirection=W.shiftKey?Ji:"forward")}_getConfig(W){return W=ui(ui({},Vi),"object"==typeof W?W:{}),w("focustrap",W,cn),W}}const en={backdrop:!0,keyboard:!0,focus:!0},In={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},Yi="hidden.bs.modal",xn="show.bs.modal",Nn="resize.bs.modal",Ki="click.dismiss.bs.modal",Xn="keydown.dismiss.bs.modal",Rn="mousedown.dismiss.bs.modal",Fi="modal-open",tn="modal-static";class Oe extends ot{constructor(W,oe){super(W),this._config=this._getConfig(oe),this._dialog=je.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollBar=new ai}static get Default(){return en}static get NAME(){return"modal"}toggle(W){return this._isShown?this.hide():this.show(W)}show(W){this._isShown||this._isTransitioning||_e.trigger(this._element,xn,{relatedTarget:W}).defaultPrevented||(this._isShown=!0,this._isAnimated()&&(this._isTransitioning=!0),this._scrollBar.hide(),document.body.classList.add(Fi),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),_e.on(this._dialog,Rn,()=>{_e.one(this._element,"mouseup.dismiss.bs.modal",oe=>{oe.target===this._element&&(this._ignoreBackdropClick=!0)})}),this._showBackdrop(()=>this._showElement(W)))}hide(){if(!this._isShown||this._isTransitioning||_e.trigger(this._element,"hide.bs.modal").defaultPrevented)return;this._isShown=!1;const W=this._isAnimated();W&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),this._focustrap.deactivate(),this._element.classList.remove("show"),_e.off(this._element,Ki),_e.off(this._dialog,Rn),this._queueCallback(()=>this._hideModal(),this._element,W)}dispose(){[window,this._dialog].forEach(W=>_e.off(W,".bs.modal")),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Ai({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new un({trapElement:this._element})}_getConfig(W){return W=ui(ui(ui({},en),Rt.getDataAttributes(this._element)),"object"==typeof W?W:{}),w("modal",W,In),W}_showElement(W){const oe=this._isAnimated(),De=je.findOne(".modal-body",this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,De&&(De.scrollTop=0),this._element.classList.add("show"),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,_e.trigger(this._element,"shown.bs.modal",{relatedTarget:W})},this._dialog,oe)}_setEscapeEvent(){this._isShown?_e.on(this._element,Xn,W=>{this._config.keyboard&&"Escape"===W.key?(W.preventDefault(),this.hide()):this._config.keyboard||"Escape"!==W.key||this._triggerBackdropTransition()}):_e.off(this._element,Xn)}_setResizeEvent(){this._isShown?_e.on(window,Nn,()=>this._adjustDialog()):_e.off(window,Nn)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Fi),this._resetAdjustments(),this._scrollBar.reset(),_e.trigger(this._element,Yi)})}_showBackdrop(W){_e.on(this._element,Ki,oe=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:oe.target===oe.currentTarget&&(!0===this._config.backdrop?this.hide():"static"===this._config.backdrop&&this._triggerBackdropTransition())}),this._backdrop.show(W)}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(_e.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const{classList:W,scrollHeight:oe,style:De}=this._element,Be=oe>document.documentElement.clientHeight;!Be&&"hidden"===De.overflowY||W.contains(tn)||(Be||(De.overflowY="hidden"),W.add(tn),this._queueCallback(()=>{W.remove(tn),Be||this._queueCallback(()=>{De.overflowY=""},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const W=this._element.scrollHeight>document.documentElement.clientHeight,oe=this._scrollBar.getWidth(),De=oe>0;(!De&&W&&!u()||De&&!W&&u())&&(this._element.style.paddingLeft=`${oe}px`),(De&&!W&&!u()||!De&&W&&u())&&(this._element.style.paddingRight=`${oe}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(W,oe){return this.each(function(){const De=Oe.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===De[W])throw new TypeError(`No method named "${W}"`);De[W](oe)}})}}_e.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(Ae){const W=i(this);["A","AREA"].includes(this.tagName)&&Ae.preventDefault(),_e.one(W,xn,De=>{De.defaultPrevented||_e.one(W,Yi,()=>{M(this)&&this.focus()})});const oe=je.findOne(".modal.show");oe&&Oe.getInstance(oe).hide(),Oe.getOrCreateInstance(W).toggle(this)}),at(Oe),f(Oe);const ct="offcanvas",It={backdrop:!0,keyboard:!0,scroll:!1},rt={backdrop:"boolean",keyboard:"boolean",scroll:"boolean"},lt=".offcanvas.show",vi="hidden.bs.offcanvas";class pi extends ot{constructor(W,oe){super(W),this._config=this._getConfig(oe),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get NAME(){return ct}static get Default(){return It}toggle(W){return this._isShown?this.hide():this.show(W)}show(W){this._isShown||_e.trigger(this._element,"show.bs.offcanvas",{relatedTarget:W}).defaultPrevented||(this._isShown=!0,this._element.style.visibility="visible",this._backdrop.show(),this._config.scroll||(new ai).hide(),this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add("show"),this._queueCallback(()=>{this._config.scroll||this._focustrap.activate(),_e.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:W})},this._element,!0))}hide(){this._isShown&&(_e.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.remove("show"),this._backdrop.hide(),this._queueCallback(()=>{this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._element.style.visibility="hidden",this._config.scroll||(new ai).reset(),_e.trigger(this._element,vi)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_getConfig(W){return W=ui(ui(ui({},It),Rt.getDataAttributes(this._element)),"object"==typeof W?W:{}),w(ct,W,rt),W}_initializeBackDrop(){return new Ai({className:"offcanvas-backdrop",isVisible:this._config.backdrop,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:()=>this.hide()})}_initializeFocusTrap(){return new un({trapElement:this._element})}_addEventListeners(){_e.on(this._element,"keydown.dismiss.bs.offcanvas",W=>{this._config.keyboard&&"Escape"===W.key&&this.hide()})}static jQueryInterface(W){return this.each(function(){const oe=pi.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W]||W.startsWith("_")||"constructor"===W)throw new TypeError(`No method named "${W}"`);oe[W](this)}})}}_e.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(Ae){const W=i(this);if(["A","AREA"].includes(this.tagName)&&Ae.preventDefault(),C(this))return;_e.one(W,vi,()=>{M(this)&&this.focus()});const oe=je.findOne(lt);oe&&oe!==W&&pi.getInstance(oe).hide(),pi.getOrCreateInstance(W).toggle(this)}),_e.on(window,"load.bs.offcanvas.data-api",()=>je.find(lt).forEach(Ae=>pi.getOrCreateInstance(Ae).show())),at(pi),f(pi);const ri=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),wt=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,jt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,Vt=(Ae,W)=>{const oe=Ae.nodeName.toLowerCase();if(W.includes(oe))return!ri.has(oe)||Boolean(wt.test(Ae.nodeValue)||jt.test(Ae.nodeValue));const De=W.filter(Be=>Be instanceof RegExp);for(let Be=0,it=De.length;Be<it;Be++)if(De[Be].test(oe))return!0;return!1};function fi(Ae,W,oe){if(!Ae.length)return Ae;if(oe&&"function"==typeof oe)return oe(Ae);const De=(new window.DOMParser).parseFromString(Ae,"text/html"),Be=[].concat(...De.body.querySelectorAll("*"));for(let it=0,ft=Be.length;it<ft;it++){const Tt=Be[it],Qt=Tt.nodeName.toLowerCase();if(!Object.keys(W).includes(Qt)){Tt.remove();continue}const Ht=[].concat(...Tt.attributes),ti=[].concat(W["*"]||[],W[Qt]||[]);Ht.forEach(li=>{Vt(li,ti)||Tt.removeAttribute(li.nodeName)})}return De.body.innerHTML}const qn="tooltip",ia=new Set(["sanitize","allowList","sanitizeFn"]),na={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(array|string|function)",container:"(string|element|boolean)",fallbackPlacements:"array",boundary:"(string|element)",customClass:"(string|function)",sanitize:"boolean",sanitizeFn:"(null|function)",allowList:"object",popperConfig:"(null|object|function)"},ca={AUTO:"auto",TOP:"top",RIGHT:u()?"left":"right",BOTTOM:"bottom",LEFT:u()?"right":"left"},Pn={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:[0,0],container:!1,fallbackPlacements:["top","right","bottom","left"],boundary:"clippingParents",customClass:"",sanitize:!0,sanitizeFn:null,allowList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},popperConfig:null},Hn={HIDE:"hide.bs.tooltip",HIDDEN:"hidden.bs.tooltip",SHOW:"show.bs.tooltip",SHOWN:"shown.bs.tooltip",INSERTED:"inserted.bs.tooltip",CLICK:"click.bs.tooltip",FOCUSIN:"focusin.bs.tooltip",FOCUSOUT:"focusout.bs.tooltip",MOUSEENTER:"mouseenter.bs.tooltip",MOUSELEAVE:"mouseleave.bs.tooltip"},Kn="fade",Qn="show",aa="show",Ea=".tooltip-inner",$n="hide.bs.modal",ra="hover";class mn extends ot{constructor(W,oe){if(void 0===Ze)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(W),this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this._config=this._getConfig(oe),this.tip=null,this._setListeners()}static get Default(){return Pn}static get NAME(){return qn}static get Event(){return Hn}static get DefaultType(){return na}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(W){if(this._isEnabled)if(W){const oe=this._initializeOnDelegatedTarget(W);oe._activeTrigger.click=!oe._activeTrigger.click,oe._isWithActiveTrigger()?oe._enter(null,oe):oe._leave(null,oe)}else{if(this.getTipElement().classList.contains(Qn))return void this._leave(null,this);this._enter(null,this)}}dispose(){clearTimeout(this._timeout),_e.off(this._element.closest(".modal"),$n,this._hideModalHandler),this.tip&&this.tip.remove(),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this.isWithContent()||!this._isEnabled)return;const W=_e.trigger(this._element,this.constructor.Event.SHOW),oe=S(this._element),De=null===oe?this._element.ownerDocument.documentElement.contains(this._element):oe.contains(this._element);if(W.defaultPrevented||!De)return;"tooltip"===this.constructor.NAME&&this.tip&&this.getTitle()!==this.tip.querySelector(Ea).innerHTML&&(this._disposePopper(),this.tip.remove(),this.tip=null);const Be=this.getTipElement(),it=(li=>{do{li+=Math.floor(1e6*Math.random())}while(document.getElementById(li));return li})(this.constructor.NAME);Be.setAttribute("id",it),this._element.setAttribute("aria-describedby",it),this._config.animation&&Be.classList.add(Kn);const ft="function"==typeof this._config.placement?this._config.placement.call(this,Be,this._element):this._config.placement,Tt=this._getAttachment(ft);this._addAttachmentClass(Tt);const{container:Qt}=this._config;mt.set(Be,this.constructor.DATA_KEY,this),this._element.ownerDocument.documentElement.contains(this.tip)||(Qt.append(Be),_e.trigger(this._element,this.constructor.Event.INSERTED)),this._popper?this._popper.update():this._popper=Ze.createPopper(this._element,Be,this._getPopperConfig(Tt)),Be.classList.add(Qn);const Ht=this._resolvePossibleFunction(this._config.customClass);Ht&&Be.classList.add(...Ht.split(" ")),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(li=>{_e.on(li,"mouseover",n)});const ti=this.tip.classList.contains(Kn);this._queueCallback(()=>{const li=this._hoverState;this._hoverState=null,_e.trigger(this._element,this.constructor.Event.SHOWN),"out"===li&&this._leave(null,this)},this.tip,ti)}hide(){if(!this._popper)return;const W=this.getTipElement();if(_e.trigger(this._element,this.constructor.Event.HIDE).defaultPrevented)return;W.classList.remove(Qn),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(De=>_e.off(De,"mouseover",n)),this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1;const oe=this.tip.classList.contains(Kn);this._queueCallback(()=>{this._isWithActiveTrigger()||(this._hoverState!==aa&&W.remove(),this._cleanTipClass(),this._element.removeAttribute("aria-describedby"),_e.trigger(this._element,this.constructor.Event.HIDDEN),this._disposePopper())},this.tip,oe),this._hoverState=""}update(){null!==this._popper&&this._popper.update()}isWithContent(){return Boolean(this.getTitle())}getTipElement(){if(this.tip)return this.tip;const W=document.createElement("div");W.innerHTML=this._config.template;const oe=W.children[0];return this.setContent(oe),oe.classList.remove(Kn,Qn),this.tip=oe,this.tip}setContent(W){this._sanitizeAndSetContent(W,this.getTitle(),Ea)}_sanitizeAndSetContent(W,oe,De){const Be=je.findOne(De,W);oe||!Be?this.setElementContent(Be,oe):Be.remove()}setElementContent(W,oe){if(null!==W)return h(oe)?(oe=P(oe),void(this._config.html?oe.parentNode!==W&&(W.innerHTML="",W.append(oe)):W.textContent=oe.textContent)):void(this._config.html?(this._config.sanitize&&(oe=fi(oe,this._config.allowList,this._config.sanitizeFn)),W.innerHTML=oe):W.textContent=oe)}getTitle(){const W=this._element.getAttribute("data-bs-original-title")||this._config.title;return this._resolvePossibleFunction(W)}updateAttachment(W){return"right"===W?"end":"left"===W?"start":W}_initializeOnDelegatedTarget(W,oe){return oe||this.constructor.getOrCreateInstance(W.delegateTarget,this._getDelegateConfig())}_getOffset(){const{offset:W}=this._config;return"string"==typeof W?W.split(",").map(oe=>Number.parseInt(oe,10)):"function"==typeof W?oe=>W(oe,this._element):W}_resolvePossibleFunction(W){return"function"==typeof W?W.call(this._element):W}_getPopperConfig(W){const oe={placement:W,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"onChange",enabled:!0,phase:"afterWrite",fn:De=>this._handlePopperPlacementChange(De)}],onFirstUpdate:De=>{De.options.placement!==De.placement&&this._handlePopperPlacementChange(De)}};return ui(ui({},oe),"function"==typeof this._config.popperConfig?this._config.popperConfig(oe):this._config.popperConfig)}_addAttachmentClass(W){this.getTipElement().classList.add(`${this._getBasicClassPrefix()}-${this.updateAttachment(W)}`)}_getAttachment(W){return ca[W.toUpperCase()]}_setListeners(){this._config.trigger.split(" ").forEach(W=>{if("click"===W)_e.on(this._element,this.constructor.Event.CLICK,this._config.selector,oe=>this.toggle(oe));else if("manual"!==W){const De=W===ra?this.constructor.Event.MOUSELEAVE:this.constructor.Event.FOCUSOUT;_e.on(this._element,W===ra?this.constructor.Event.MOUSEENTER:this.constructor.Event.FOCUSIN,this._config.selector,Be=>this._enter(Be)),_e.on(this._element,De,this._config.selector,Be=>this._leave(Be))}}),this._hideModalHandler=()=>{this._element&&this.hide()},_e.on(this._element.closest(".modal"),$n,this._hideModalHandler),this._config.selector?this._config=hr(ui({},this._config),{trigger:"manual",selector:""}):this._fixTitle()}_fixTitle(){const W=this._element.getAttribute("title"),oe=typeof this._element.getAttribute("data-bs-original-title");(W||"string"!==oe)&&(this._element.setAttribute("data-bs-original-title",W||""),!W||this._element.getAttribute("aria-label")||this._element.textContent||this._element.setAttribute("aria-label",W),this._element.setAttribute("title",""))}_enter(W,oe){oe=this._initializeOnDelegatedTarget(W,oe),W&&(oe._activeTrigger["focusin"===W.type?"focus":ra]=!0),oe.getTipElement().classList.contains(Qn)||oe._hoverState===aa?oe._hoverState=aa:(clearTimeout(oe._timeout),oe._hoverState=aa,oe._config.delay&&oe._config.delay.show?oe._timeout=setTimeout(()=>{oe._hoverState===aa&&oe.show()},oe._config.delay.show):oe.show())}_leave(W,oe){oe=this._initializeOnDelegatedTarget(W,oe),W&&(oe._activeTrigger["focusout"===W.type?"focus":ra]=oe._element.contains(W.relatedTarget)),oe._isWithActiveTrigger()||(clearTimeout(oe._timeout),oe._hoverState="out",oe._config.delay&&oe._config.delay.hide?oe._timeout=setTimeout(()=>{"out"===oe._hoverState&&oe.hide()},oe._config.delay.hide):oe.hide())}_isWithActiveTrigger(){for(const W in this._activeTrigger)if(this._activeTrigger[W])return!0;return!1}_getConfig(W){const oe=Rt.getDataAttributes(this._element);return Object.keys(oe).forEach(De=>{ia.has(De)&&delete oe[De]}),(W=ui(ui(ui({},this.constructor.Default),oe),"object"==typeof W&&W?W:{})).container=!1===W.container?document.body:P(W.container),"number"==typeof W.delay&&(W.delay={show:W.delay,hide:W.delay}),"number"==typeof W.title&&(W.title=W.title.toString()),"number"==typeof W.content&&(W.content=W.content.toString()),w(qn,W,this.constructor.DefaultType),W.sanitize&&(W.template=fi(W.template,W.allowList,W.sanitizeFn)),W}_getDelegateConfig(){const W={};for(const oe in this._config)this.constructor.Default[oe]!==this._config[oe]&&(W[oe]=this._config[oe]);return W}_cleanTipClass(){const W=this.getTipElement(),oe=new RegExp(`(^|\\s)${this._getBasicClassPrefix()}\\S+`,"g"),De=W.getAttribute("class").match(oe);null!==De&&De.length>0&&De.map(Be=>Be.trim()).forEach(Be=>W.classList.remove(Be))}_getBasicClassPrefix(){return"bs-tooltip"}_handlePopperPlacementChange(W){const{state:oe}=W;oe&&(this.tip=oe.elements.popper,this._cleanTipClass(),this._addAttachmentClass(this._getAttachment(oe.placement)))}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(W){return this.each(function(){const oe=mn.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W]()}})}}f(mn);const va=hr(ui({},mn.Default),{placement:"right",offset:[0,8],trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),ba=hr(ui({},mn.DefaultType),{content:"(string|element|function)"}),ya={HIDE:"hide.bs.popover",HIDDEN:"hidden.bs.popover",SHOW:"show.bs.popover",SHOWN:"shown.bs.popover",INSERTED:"inserted.bs.popover",CLICK:"click.bs.popover",FOCUSIN:"focusin.bs.popover",FOCUSOUT:"focusout.bs.popover",MOUSEENTER:"mouseenter.bs.popover",MOUSELEAVE:"mouseleave.bs.popover"};class Jn extends mn{static get Default(){return va}static get NAME(){return"popover"}static get Event(){return ya}static get DefaultType(){return ba}isWithContent(){return this.getTitle()||this._getContent()}setContent(W){this._sanitizeAndSetContent(W,this.getTitle(),".popover-header"),this._sanitizeAndSetContent(W,this._getContent(),".popover-body")}_getContent(){return this._resolvePossibleFunction(this._config.content)}_getBasicClassPrefix(){return"bs-popover"}static jQueryInterface(W){return this.each(function(){const oe=Jn.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W]()}})}}f(Jn);const oa="scrollspy",ha={offset:10,method:"auto",target:""},Yn={offset:"number",method:"string",target:"(string|element)"},zn="active",Sa=".nav-link, .list-group-item, .dropdown-item",Ca="position";class p extends ot{constructor(W,oe){super(W),this._scrollElement="BODY"===this._element.tagName?window:this._element,this._config=this._getConfig(oe),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,_e.on(this._scrollElement,"scroll.bs.scrollspy",()=>this._process()),this.refresh(),this._process()}static get Default(){return ha}static get NAME(){return oa}refresh(){const oe="auto"===this._config.method?this._scrollElement===this._scrollElement.window?"offset":Ca:this._config.method,De=oe===Ca?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),je.find(Sa,this._config.target).map(Be=>{const it=e(Be),ft=it?je.findOne(it):null;if(ft){const Tt=ft.getBoundingClientRect();if(Tt.width||Tt.height)return[Rt[oe](ft).top+De,it]}return null}).filter(Be=>Be).sort((Be,it)=>Be[0]-it[0]).forEach(Be=>{this._offsets.push(Be[0]),this._targets.push(Be[1])})}dispose(){_e.off(this._scrollElement,".bs.scrollspy"),super.dispose()}_getConfig(W){return(W=ui(ui(ui({},ha),Rt.getDataAttributes(this._element)),"object"==typeof W&&W?W:{})).target=P(W.target)||document.documentElement,w(oa,W,Yn),W}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){const W=this._getScrollTop()+this._config.offset,oe=this._getScrollHeight(),De=this._config.offset+oe-this._getOffsetHeight();if(this._scrollHeight!==oe&&this.refresh(),W>=De){const Be=this._targets[this._targets.length-1];this._activeTarget!==Be&&this._activate(Be)}else{if(this._activeTarget&&W<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(let Be=this._offsets.length;Be--;)this._activeTarget!==this._targets[Be]&&W>=this._offsets[Be]&&(void 0===this._offsets[Be+1]||W<this._offsets[Be+1])&&this._activate(this._targets[Be])}}_activate(W){this._activeTarget=W,this._clear();const oe=Sa.split(",").map(Be=>`${Be}[data-bs-target="${W}"],${Be}[href="${W}"]`),De=je.findOne(oe.join(","),this._config.target);De.classList.add(zn),De.classList.contains("dropdown-item")?je.findOne(".dropdown-toggle",De.closest(".dropdown")).classList.add(zn):je.parents(De,".nav, .list-group").forEach(Be=>{je.prev(Be,".nav-link, .list-group-item").forEach(it=>it.classList.add(zn)),je.prev(Be,".nav-item").forEach(it=>{je.children(it,".nav-link").forEach(ft=>ft.classList.add(zn))})}),_e.trigger(this._scrollElement,"activate.bs.scrollspy",{relatedTarget:W})}_clear(){je.find(Sa,this._config.target).filter(W=>W.classList.contains(zn)).forEach(W=>W.classList.remove(zn))}static jQueryInterface(W){return this.each(function(){const oe=p.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W]()}})}}_e.on(window,"load.bs.scrollspy.data-api",()=>{je.find('[data-bs-spy="scroll"]').forEach(Ae=>new p(Ae))}),f(p);const N="active",B="fade",Q="show",pe=".active",ve=":scope > li > .active";class be extends ot{static get NAME(){return"tab"}show(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&this._element.classList.contains(N))return;let W;const oe=i(this._element),De=this._element.closest(".nav, .list-group");De&&(W=je.find("UL"===De.nodeName||"OL"===De.nodeName?ve:pe,De),W=W[W.length-1]);const Be=W?_e.trigger(W,"hide.bs.tab",{relatedTarget:this._element}):null;if(_e.trigger(this._element,"show.bs.tab",{relatedTarget:W}).defaultPrevented||null!==Be&&Be.defaultPrevented)return;this._activate(this._element,De);const it=()=>{_e.trigger(W,"hidden.bs.tab",{relatedTarget:this._element}),_e.trigger(this._element,"shown.bs.tab",{relatedTarget:W})};oe?this._activate(oe,oe.parentNode,it):it()}_activate(W,oe,De){const Be=(!oe||"UL"!==oe.nodeName&&"OL"!==oe.nodeName?je.children(oe,pe):je.find(ve,oe))[0],it=De&&Be&&Be.classList.contains(B),ft=()=>this._transitionComplete(W,Be,De);Be&&it?(Be.classList.remove(Q),this._queueCallback(ft,W,!0)):ft()}_transitionComplete(W,oe,De){if(oe){oe.classList.remove(N);const it=je.findOne(":scope > .dropdown-menu .active",oe.parentNode);it&&it.classList.remove(N),"tab"===oe.getAttribute("role")&&oe.setAttribute("aria-selected",!1)}W.classList.add(N),"tab"===W.getAttribute("role")&&W.setAttribute("aria-selected",!0),W.classList.contains(B)&&W.classList.add(Q);let Be=W.parentNode;if(Be&&"LI"===Be.nodeName&&(Be=Be.parentNode),Be&&Be.classList.contains("dropdown-menu")){const it=W.closest(".dropdown");it&&je.find(".dropdown-toggle",it).forEach(ft=>ft.classList.add(N)),W.setAttribute("aria-expanded",!0)}De&&De()}static jQueryInterface(W){return this.each(function(){const oe=be.getOrCreateInstance(this);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W]()}})}}_e.on(document,"click.bs.tab.data-api",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',function(Ae){["A","AREA"].includes(this.tagName)&&Ae.preventDefault(),C(this)||be.getOrCreateInstance(this).show()}),f(be);const qe="show",Ke="showing",pt={animation:"boolean",autohide:"boolean",delay:"number"},Qe={animation:!0,autohide:!0,delay:5e3};class $e extends ot{constructor(W,oe){super(W),this._config=this._getConfig(oe),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get DefaultType(){return pt}static get Default(){return Qe}static get NAME(){return"toast"}show(){_e.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.classList.add(qe),this._element.classList.add(Ke),this._queueCallback(()=>{this._element.classList.remove(Ke),_e.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this._element.classList.contains(qe)&&(_e.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(Ke),this._queueCallback(()=>{this._element.classList.add("hide"),this._element.classList.remove(Ke),this._element.classList.remove(qe),_e.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this._element.classList.contains(qe)&&this._element.classList.remove(qe),super.dispose()}_getConfig(W){return W=ui(ui(ui({},Qe),Rt.getDataAttributes(this._element)),"object"==typeof W&&W?W:{}),w("toast",W,this.constructor.DefaultType),W}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(W,oe){switch(W.type){case"mouseover":case"mouseout":this._hasMouseInteraction=oe;break;case"focusin":case"focusout":this._hasKeyboardInteraction=oe}if(oe)return void this._clearTimeout();const De=W.relatedTarget;this._element===De||this._element.contains(De)||this._maybeScheduleHide()}_setListeners(){_e.on(this._element,"mouseover.bs.toast",W=>this._onInteraction(W,!0)),_e.on(this._element,"mouseout.bs.toast",W=>this._onInteraction(W,!1)),_e.on(this._element,"focusin.bs.toast",W=>this._onInteraction(W,!0)),_e.on(this._element,"focusout.bs.toast",W=>this._onInteraction(W,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(W){return this.each(function(){const oe=$e.getOrCreateInstance(this,W);if("string"==typeof W){if(void 0===oe[W])throw new TypeError(`No method named "${W}"`);oe[W](this)}})}}return at($e),f($e),{Alert:yt,Button:ie,Carousel:v,Collapse:L,Dropdown:ki,Modal:Oe,Offcanvas:pi,Popover:Jn,ScrollSpy:p,Tab:be,Toast:$e,Tooltip:mn}}),function(nt){"object"==typeof exports&&"undefined"!=typeof module?module.exports=nt():"function"==typeof define&&define.amd?define([],nt):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=nt()}(function(){return function nt(Lt,Ze,V){function J(d,h){if(!Ze[d]){if(!Lt[d]){var P="function"==typeof require&&require;if(!h&&P)return P(d,!0);if(e)return e(d,!0);var w=new Error("Cannot find module '"+d+"'");throw w.code="MODULE_NOT_FOUND",w}var M=Ze[d]={exports:{}};Lt[d][0].call(M.exports,function(C){return J(Lt[d][1][C]||C)},M,M.exports,nt,Lt,Ze,V)}return Ze[d].exports}for(var e="function"==typeof require&&require,i=0;i<V.length;i++)J(V[i]);return J}({1:[function(nt,Lt,Ze){"use strict";var V=(0,nt("./adapter_factory.js").adapterFactory)({window});Lt.exports=V},{"./adapter_factory.js":2}],2:[function(nt,Lt,Ze){"use strict";function V(w){if(w&&w.__esModule)return w;var M={};if(null!=w)for(var C in w)Object.prototype.hasOwnProperty.call(w,C)&&(M[C]=w[C]);return M.default=w,M}Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.adapterFactory=function(){var w=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},C=J.log,S=J.detectBrowser(w),n={browserDetails:S,commonShim:P,extractVersion:J.extractVersion,disableLog:J.disableLog,disableWarnings:J.disableWarnings};switch(S.browser){case"chrome":if(!e||!e.shimPeerConnection||!M.shimChrome)return C("Chrome shim is not included in this adapter release."),n;C("adapter.js shimming chrome."),n.browserShim=e,e.shimGetUserMedia(w),e.shimMediaStream(w),e.shimPeerConnection(w),e.shimOnTrack(w),e.shimAddTrackRemoveTrack(w),e.shimGetSendersWithDtmf(w),e.shimGetStats(w),e.shimSenderReceiverGetStats(w),e.fixNegotiationNeeded(w),P.shimRTCIceCandidate(w),P.shimConnectionState(w),P.shimMaxMessageSize(w),P.shimSendThrowTypeError(w),P.removeAllowExtmapMixed(w);break;case"firefox":if(!d||!d.shimPeerConnection||!M.shimFirefox)return C("Firefox shim is not included in this adapter release."),n;C("adapter.js shimming firefox."),n.browserShim=d,d.shimGetUserMedia(w),d.shimPeerConnection(w),d.shimOnTrack(w),d.shimRemoveStream(w),d.shimSenderGetStats(w),d.shimReceiverGetStats(w),d.shimRTCDataChannel(w),P.shimRTCIceCandidate(w),P.shimConnectionState(w),P.shimMaxMessageSize(w),P.shimSendThrowTypeError(w);break;case"edge":if(!i||!i.shimPeerConnection||!M.shimEdge)return C("MS edge shim is not included in this adapter release."),n;C("adapter.js shimming edge."),n.browserShim=i,i.shimGetUserMedia(w),i.shimGetDisplayMedia(w),i.shimPeerConnection(w),i.shimReplaceTrack(w),P.shimMaxMessageSize(w),P.shimSendThrowTypeError(w);break;case"safari":if(!h||!M.shimSafari)return C("Safari shim is not included in this adapter release."),n;C("adapter.js shimming safari."),n.browserShim=h,h.shimRTCIceServerUrls(w),h.shimCreateOfferLegacy(w),h.shimCallbacksAPI(w),h.shimLocalStreamsAPI(w),h.shimRemoteStreamsAPI(w),h.shimTrackEventTransceiver(w),h.shimGetUserMedia(w),P.shimRTCIceCandidate(w),P.shimMaxMessageSize(w),P.shimSendThrowTypeError(w),P.removeAllowExtmapMixed(w);break;default:C("Unsupported browser!")}return n};var J=V(nt("./utils")),e=V(nt("./chrome/chrome_shim")),i=V(nt("./edge/edge_shim")),d=V(nt("./firefox/firefox_shim")),h=V(nt("./safari/safari_shim")),P=V(nt("./common_shim"))},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(nt,Lt,Ze){"use strict";function V(h){h.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(n){return S._shimmedLocalStreams[n][0]})};var P=h.RTCPeerConnection.prototype.addTrack;h.RTCPeerConnection.prototype.addTrack=function(S,n){if(!n)return P.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var y=P.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(y)&&this._shimmedLocalStreams[n.id].push(y):this._shimmedLocalStreams[n.id]=[n,y],y};var w=h.RTCPeerConnection.prototype.addStream;h.RTCPeerConnection.prototype.addStream=function(S){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(function(m){if(n.getSenders().find(function(u){return u.track===m}))throw new DOMException("Track already exists.","InvalidAccessError")});var y=this.getSenders();w.apply(this,arguments);var R=this.getSenders().filter(function(m){return-1===y.indexOf(m)});this._shimmedLocalStreams[S.id]=[S].concat(R)};var M=h.RTCPeerConnection.prototype.removeStream;h.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],M.apply(this,arguments)};var C=h.RTCPeerConnection.prototype.removeTrack;h.RTCPeerConnection.prototype.removeTrack=function(S){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(function(y){var R=n._shimmedLocalStreams[y].indexOf(S);-1!==R&&n._shimmedLocalStreams[y].splice(R,1),1===n._shimmedLocalStreams[y].length&&delete n._shimmedLocalStreams[y]}),C.apply(this,arguments)}}Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=Ze.shimGetUserMedia=void 0;var J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(h){return typeof h}:function(h){return h&&"function"==typeof Symbol&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},e=nt("./getusermedia");Object.defineProperty(Ze,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}});var i=nt("./getdisplaymedia");Object.defineProperty(Ze,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),Ze.shimMediaStream=function(h){h.MediaStream=h.MediaStream||h.webkitMediaStream},Ze.shimOnTrack=function(h){if("object"!==(void 0===h?"undefined":J(h))||!h.RTCPeerConnection||"ontrack"in h.RTCPeerConnection.prototype)d.wrapPeerConnectionEvent(h,"track",function(w){return w.transceiver||Object.defineProperty(w,"transceiver",{value:{receiver:w.receiver}}),w});else{Object.defineProperty(h.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(w){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=w)},enumerable:!0,configurable:!0});var P=h.RTCPeerConnection.prototype.setRemoteDescription;h.RTCPeerConnection.prototype.setRemoteDescription=function(){var w=this;return this._ontrackpoly||(this._ontrackpoly=function(M){M.stream.addEventListener("addtrack",function(C){var S;S=h.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(y){return y.track&&y.track.id===C.track.id}):{track:C.track};var n=new Event("track");n.track=C.track,n.receiver=S,n.transceiver={receiver:S},n.streams=[M.stream],w.dispatchEvent(n)}),M.stream.getTracks().forEach(function(C){var S;S=h.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(y){return y.track&&y.track.id===C.id}):{track:C};var n=new Event("track");n.track=C,n.receiver=S,n.transceiver={receiver:S},n.streams=[M.stream],w.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),P.apply(this,arguments)}}},Ze.shimGetSendersWithDtmf=function(h){if("object"===(void 0===h?"undefined":J(h))&&h.RTCPeerConnection&&!("getSenders"in h.RTCPeerConnection.prototype)&&"createDTMFSender"in h.RTCPeerConnection.prototype){var P=function(y,R){return{track:R,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===R.kind?y.createDTMFSender(R):null),this._dtmf},_pc:y}};if(!h.RTCPeerConnection.prototype.getSenders){h.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var w=h.RTCPeerConnection.prototype.addTrack;h.RTCPeerConnection.prototype.addTrack=function(y,R){var m=w.apply(this,arguments);return m||(m=P(this,y),this._senders.push(m)),m};var M=h.RTCPeerConnection.prototype.removeTrack;h.RTCPeerConnection.prototype.removeTrack=function(y){M.apply(this,arguments);var R=this._senders.indexOf(y);-1!==R&&this._senders.splice(R,1)}}var C=h.RTCPeerConnection.prototype.addStream;h.RTCPeerConnection.prototype.addStream=function(y){var R=this;this._senders=this._senders||[],C.apply(this,[y]),y.getTracks().forEach(function(m){R._senders.push(P(R,m))})};var S=h.RTCPeerConnection.prototype.removeStream;h.RTCPeerConnection.prototype.removeStream=function(y){var R=this;this._senders=this._senders||[],S.apply(this,[y]),y.getTracks().forEach(function(m){var u=R._senders.find(function(f){return f.track===m});u&&R._senders.splice(R._senders.indexOf(u),1)})}}else if("object"===(void 0===h?"undefined":J(h))&&h.RTCPeerConnection&&"getSenders"in h.RTCPeerConnection.prototype&&"createDTMFSender"in h.RTCPeerConnection.prototype&&h.RTCRtpSender&&!("dtmf"in h.RTCRtpSender.prototype)){var n=h.RTCPeerConnection.prototype.getSenders;h.RTCPeerConnection.prototype.getSenders=function(){var y=this,R=n.apply(this,[]);return R.forEach(function(m){return m._pc=y}),R},Object.defineProperty(h.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},Ze.shimGetStats=function(h){if(h.RTCPeerConnection){var P=h.RTCPeerConnection.prototype.getStats;h.RTCPeerConnection.prototype.getStats=function(w,M,C){var S=this,n=arguments;if(arguments.length>0&&"function"==typeof w)return P.apply(this,arguments);if(0===P.length&&(0===arguments.length||"function"!=typeof arguments[0]))return P.apply(this,[]);var y=function(u){var f={};return u.result().forEach(function(I){var c={id:I.id,timestamp:I.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[I.type]||I.type};I.names().forEach(function(j){c[j]=I.stat(j)}),f[c.id]=c}),f},R=function(u){return new Map(Object.keys(u).map(function(f){return[f,u[f]]}))};if(arguments.length>=2){var m=function(u){n[1](R(y(u)))};return P.apply(this,[m,arguments[0]])}return new Promise(function(u,f){P.apply(S,[function(I){u(R(y(I)))},f])}).then(M,C)}}},Ze.shimSenderReceiverGetStats=function(h){if("object"===(void 0===h?"undefined":J(h))&&h.RTCPeerConnection&&h.RTCRtpSender&&h.RTCRtpReceiver){if(!("getStats"in h.RTCRtpSender.prototype)){var P=h.RTCPeerConnection.prototype.getSenders;P&&(h.RTCPeerConnection.prototype.getSenders=function(){var S=this,n=P.apply(this,[]);return n.forEach(function(y){return y._pc=S}),n});var w=h.RTCPeerConnection.prototype.addTrack;w&&(h.RTCPeerConnection.prototype.addTrack=function(){var S=w.apply(this,arguments);return S._pc=this,S}),h.RTCRtpSender.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(n){return d.filterStats(n,S.track,!0)})}}if(!("getStats"in h.RTCRtpReceiver.prototype)){var M=h.RTCPeerConnection.prototype.getReceivers;M&&(h.RTCPeerConnection.prototype.getReceivers=function(){var S=this,n=M.apply(this,[]);return n.forEach(function(y){return y._pc=S}),n}),d.wrapPeerConnectionEvent(h,"track",function(S){return S.receiver._pc=S.srcElement,S}),h.RTCRtpReceiver.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(n){return d.filterStats(n,S.track,!1)})}}if("getStats"in h.RTCRtpSender.prototype&&"getStats"in h.RTCRtpReceiver.prototype){var C=h.RTCPeerConnection.prototype.getStats;h.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof h.MediaStreamTrack){var S=arguments[0],n=void 0,y=void 0,R=void 0;return this.getSenders().forEach(function(m){m.track===S&&(n?R=!0:n=m)}),this.getReceivers().forEach(function(m){return m.track===S&&(y?R=!0:y=m),m.track===S}),R||n&&y?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():y?y.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return C.apply(this,arguments)}}}},Ze.shimAddTrackRemoveTrackWithNative=V,Ze.shimAddTrackRemoveTrack=function(h){function P(m,u){var f=u.sdp;return Object.keys(m._reverseStreams||[]).forEach(function(I){var c=m._reverseStreams[I];f=f.replace(new RegExp(m._streams[c.id].id,"g"),c.id)}),new RTCSessionDescription({type:u.type,sdp:f})}function w(m,u){var f=u.sdp;return Object.keys(m._reverseStreams||[]).forEach(function(I){var c=m._reverseStreams[I],j=m._streams[c.id];f=f.replace(new RegExp(c.id,"g"),j.id)}),new RTCSessionDescription({type:u.type,sdp:f})}if(h.RTCPeerConnection){var M=d.detectBrowser(h);if(h.RTCPeerConnection.prototype.addTrack&&M.version>=65)return V(h);var C=h.RTCPeerConnection.prototype.getLocalStreams;h.RTCPeerConnection.prototype.getLocalStreams=function(){var m=this,u=C.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(function(f){return m._reverseStreams[f.id]})};var S=h.RTCPeerConnection.prototype.addStream;h.RTCPeerConnection.prototype.addStream=function(m){var u=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(function(I){if(u.getSenders().find(function(c){return c.track===I}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){var f=new h.MediaStream(m.getTracks());this._streams[m.id]=f,this._reverseStreams[f.id]=m,m=f}S.apply(this,[m])};var n=h.RTCPeerConnection.prototype.removeStream;h.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},h.RTCPeerConnection.prototype.addTrack=function(m,u){var f=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var I=[].slice.call(arguments,1);if(1!==I.length||!I[0].getTracks().find(function(q){return q===m}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(q){return q.track===m}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var c=this._streams[u.id];if(c)c.addTrack(m),Promise.resolve().then(function(){f.dispatchEvent(new Event("negotiationneeded"))});else{var j=new h.MediaStream([m]);this._streams[u.id]=j,this._reverseStreams[j.id]=u,this.addStream(j)}return this.getSenders().find(function(q){return q.track===m})},["createOffer","createAnswer"].forEach(function(m){var u=h.RTCPeerConnection.prototype[m];h.RTCPeerConnection.prototype[m]=function(){var f=this,I=arguments;return arguments.length&&"function"==typeof arguments[0]?u.apply(this,[function(c){var j=P(f,c);I[0].apply(null,[j])},function(c){I[1]&&I[1].apply(null,c)},arguments[2]]):u.apply(this,arguments).then(function(c){return P(f,c)})}});var y=h.RTCPeerConnection.prototype.setLocalDescription;h.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=w(this,arguments[0]),y.apply(this,arguments)):y.apply(this,arguments)};var R=Object.getOwnPropertyDescriptor(h.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(h.RTCPeerConnection.prototype,"localDescription",{get:function(){var m=R.get.apply(this);return""===m.type?m:P(this,m)}}),h.RTCPeerConnection.prototype.removeTrack=function(m){var u=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var f=void 0;Object.keys(this._streams).forEach(function(I){u._streams[I].getTracks().find(function(c){return m.track===c})&&(f=u._streams[I])}),f&&(1===f.getTracks().length?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}},Ze.shimPeerConnection=function(h){if(!h.RTCPeerConnection&&h.webkitRTCPeerConnection&&(h.RTCPeerConnection=h.webkitRTCPeerConnection),h.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(w){var M=h.RTCPeerConnection.prototype[w];h.RTCPeerConnection.prototype[w]=function(){return arguments[0]=new("addIceCandidate"===w?h.RTCIceCandidate:h.RTCSessionDescription)(arguments[0]),M.apply(this,arguments)}});var P=h.RTCPeerConnection.prototype.addIceCandidate;h.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?P.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},Ze.fixNegotiationNeeded=function(h){d.wrapPeerConnectionEvent(h,"negotiationneeded",function(P){if("stable"===P.target.signalingState)return P})};var d=function(h){if(h&&h.__esModule)return h;var P={};if(null!=h)for(var w in h)Object.prototype.hasOwnProperty.call(h,w)&&(P[w]=h[w]);return P.default=h,P}(nt("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=function(V,J){V.navigator.mediaDevices&&"getDisplayMedia"in V.navigator.mediaDevices||V.navigator.mediaDevices&&("function"==typeof J?V.navigator.mediaDevices.getDisplayMedia=function(e){return J(e).then(function(i){var d=e.video&&e.video.width,h=e.video&&e.video.height;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:e.video&&e.video.frameRate||3}},d&&(e.video.mandatory.maxWidth=d),h&&(e.video.mandatory.maxHeight=h),V.navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});var V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ze.shimGetUserMedia=function(i){var d=i&&i.navigator;if(d.mediaDevices){var h=J.detectBrowser(i),P=function(S){if("object"!==(void 0===S?"undefined":V(S))||S.mandatory||S.optional)return S;var n={};return Object.keys(S).forEach(function(y){if("require"!==y&&"advanced"!==y&&"mediaSource"!==y){var R="object"===V(S[y])?S[y]:{ideal:S[y]};void 0!==R.exact&&"number"==typeof R.exact&&(R.min=R.max=R.exact);var m=function(f,I){return f?f+I.charAt(0).toUpperCase()+I.slice(1):"deviceId"===I?"sourceId":I};if(void 0!==R.ideal){n.optional=n.optional||[];var u={};"number"==typeof R.ideal?(u[m("min",y)]=R.ideal,n.optional.push(u),(u={})[m("max",y)]=R.ideal,n.optional.push(u)):(u[m("",y)]=R.ideal,n.optional.push(u))}void 0!==R.exact&&"number"!=typeof R.exact?(n.mandatory=n.mandatory||{},n.mandatory[m("",y)]=R.exact):["min","max"].forEach(function(f){void 0!==R[f]&&(n.mandatory=n.mandatory||{},n.mandatory[m(f,y)]=R[f])})}}),S.advanced&&(n.optional=(n.optional||[]).concat(S.advanced)),n},w=function(S,n){if(h.version>=61)return n(S);if((S=JSON.parse(JSON.stringify(S)))&&"object"===V(S.audio)){var y=function(f,I,c){I in f&&!(c in f)&&(f[c]=f[I],delete f[I])};y((S=JSON.parse(JSON.stringify(S))).audio,"autoGainControl","googAutoGainControl"),y(S.audio,"noiseSuppression","googNoiseSuppression"),S.audio=P(S.audio)}if(S&&"object"===V(S.video)){var R=S.video.facingMode;R=R&&("object"===(void 0===R?"undefined":V(R))?R:{ideal:R});var m=h.version<66;if(R&&("user"===R.exact||"environment"===R.exact||"user"===R.ideal||"environment"===R.ideal)&&(!d.mediaDevices.getSupportedConstraints||!d.mediaDevices.getSupportedConstraints().facingMode||m)){delete S.video.facingMode;var u=void 0;if("environment"===R.exact||"environment"===R.ideal?u=["back","rear"]:"user"!==R.exact&&"user"!==R.ideal||(u=["front"]),u)return d.mediaDevices.enumerateDevices().then(function(f){var I=(f=f.filter(function(c){return"videoinput"===c.kind})).find(function(c){return u.some(function(j){return c.label.toLowerCase().includes(j)})});return!I&&f.length&&u.includes("back")&&(I=f[f.length-1]),I&&(S.video.deviceId=R.exact?{exact:I.deviceId}:{ideal:I.deviceId}),S.video=P(S.video),e("chrome: "+JSON.stringify(S)),n(S)})}S.video=P(S.video)}return e("chrome: "+JSON.stringify(S)),n(S)},M=function(S){return h.version>=64?S:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[S.name]||S.name,message:S.message,constraint:S.constraint||S.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(d.getUserMedia=function(S,n,y){w(S,function(R){d.webkitGetUserMedia(R,n,function(m){y&&y(M(m))})})}.bind(d),d.mediaDevices.getUserMedia){var C=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(S){return w(S,function(n){return C(n).then(function(y){if(n.audio&&!y.getAudioTracks().length||n.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(function(R){R.stop()}),new DOMException("","NotFoundError");return y},function(y){return Promise.reject(M(y))})})}}}};var J=function(i){if(i&&i.__esModule)return i;var d={};if(null!=i)for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(d[h]=i[h]);return d.default=i,d}(nt("../utils.js")),e=J.log},{"../utils.js":15}],6:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});var V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ze.shimRTCIceCandidate=function(i){if(i.RTCIceCandidate&&(!i.RTCIceCandidate||!("foundation"in i.RTCIceCandidate.prototype))){var d=i.RTCIceCandidate;i.RTCIceCandidate=function(h){if("object"===(void 0===h?"undefined":V(h))&&h.candidate&&0===h.candidate.indexOf("a=")&&((h=JSON.parse(JSON.stringify(h))).candidate=h.candidate.substr(2)),h.candidate&&h.candidate.length){var P=new d(h),w=J.default.parseCandidate(h.candidate),M=Object.assign(P,w);return M.toJSON=function(){return{candidate:M.candidate,sdpMid:M.sdpMid,sdpMLineIndex:M.sdpMLineIndex,usernameFragment:M.usernameFragment}},M}return new d(h)},i.RTCIceCandidate.prototype=d.prototype,e.wrapPeerConnectionEvent(i,"icecandidate",function(h){return h.candidate&&Object.defineProperty(h,"candidate",{value:new i.RTCIceCandidate(h.candidate),writable:"false"}),h})}},Ze.shimMaxMessageSize=function(i){if(!i.RTCSctpTransport&&i.RTCPeerConnection){var d=e.detectBrowser(i);"sctp"in i.RTCPeerConnection.prototype||Object.defineProperty(i.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var h=function(S){if(!S||!S.sdp)return!1;var n=J.default.splitSections(S.sdp);return n.shift(),n.some(function(y){var R=J.default.parseMLine(y);return R&&"application"===R.kind&&-1!==R.protocol.indexOf("SCTP")})},P=function(S){var n=S.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===n||n.length<2)return-1;var y=parseInt(n[1],10);return y!=y?-1:y},w=function(S){var n=65536;return"firefox"===d.browser&&(n=d.version<57?-1===S?16384:2147483637:d.version<60?57===d.version?65535:65536:2147483637),n},M=function(S,n){var y=65536;"firefox"===d.browser&&57===d.version&&(y=65535);var R=J.default.matchPrefix(S.sdp,"a=max-message-size:");return R.length>0?y=parseInt(R[0].substr(19),10):"firefox"===d.browser&&-1!==n&&(y=2147483637),y},C=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,h(arguments[0])){var S=P(arguments[0]),n=w(S),y=M(arguments[0],S),R=void 0;R=0===n&&0===y?Number.POSITIVE_INFINITY:0===n||0===y?Math.max(n,y):Math.min(n,y);var m={};Object.defineProperty(m,"maxMessageSize",{get:function(){return R}}),this._sctp=m}return C.apply(this,arguments)}}},Ze.shimSendThrowTypeError=function(i){function d(P,w){var M=P.send;P.send=function(){var C=arguments[0],S=C.length||C.size||C.byteLength;if("open"===P.readyState&&w.sctp&&S>w.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+w.sctp.maxMessageSize+" bytes)");return M.apply(P,arguments)}}if(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype){var h=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){var P=h.apply(this,arguments);return d(P,this),P},e.wrapPeerConnectionEvent(i,"datachannel",function(P){return d(P.channel,P.target),P})}},Ze.shimConnectionState=function(i){if(i.RTCPeerConnection&&!("connectionState"in i.RTCPeerConnection.prototype)){var d=i.RTCPeerConnection.prototype;Object.defineProperty(d,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(d,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(h){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),h&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=h)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(h){var P=d[h];d[h]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(w){var M=w.target;if(M._lastConnectionState!==M.connectionState){M._lastConnectionState=M.connectionState;var C=new Event("connectionstatechange",w);M.dispatchEvent(C)}return w},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),P.apply(this,arguments)}})}},Ze.removeAllowExtmapMixed=function(i){if(i.RTCPeerConnection){var d=e.detectBrowser(i);if(!("chrome"===d.browser&&d.version>=71||"safari"===d.browser&&d.version>=605)){var h=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(P){return P&&P.sdp&&-1!==P.sdp.indexOf("\na=extmap-allow-mixed")&&(P.sdp=P.sdp.split("\n").filter(function(w){return"a=extmap-allow-mixed"!==w.trim()}).join("\n")),h.apply(this,arguments)}}}};var i,J=(i=nt("sdp"))&&i.__esModule?i:{default:i},e=function(i){if(i&&i.__esModule)return i;var d={};if(null!=i)for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(d[h]=i[h]);return d.default=i,d}(nt("./utils"))},{"./utils":15,sdp:17}],7:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=Ze.shimGetUserMedia=void 0;var V=nt("./getusermedia");Object.defineProperty(Ze,"shimGetUserMedia",{enumerable:!0,get:function(){return V.shimGetUserMedia}});var J=nt("./getdisplaymedia");Object.defineProperty(Ze,"shimGetDisplayMedia",{enumerable:!0,get:function(){return J.shimGetDisplayMedia}}),Ze.shimPeerConnection=function(h){var P=e.detectBrowser(h);if(h.RTCIceGatherer&&(h.RTCIceCandidate||(h.RTCIceCandidate=function(C){return C}),h.RTCSessionDescription||(h.RTCSessionDescription=function(C){return C}),P.version<15025)){var w=Object.getOwnPropertyDescriptor(h.MediaStreamTrack.prototype,"enabled");Object.defineProperty(h.MediaStreamTrack.prototype,"enabled",{set:function(C){w.set.call(this,C);var S=new Event("enabled");S.enabled=C,this.dispatchEvent(S)}})}!h.RTCRtpSender||"dtmf"in h.RTCRtpSender.prototype||Object.defineProperty(h.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new h.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),h.RTCDtmfSender&&!h.RTCDTMFSender&&(h.RTCDTMFSender=h.RTCDtmfSender);var M=(0,d.default)(h,P.version);h.RTCPeerConnection=function(C){return C&&C.iceServers&&(C.iceServers=(0,i.filterIceServers)(C.iceServers,P.version),e.log("ICE servers after filtering:",C.iceServers)),new M(C)},h.RTCPeerConnection.prototype=M.prototype},Ze.shimReplaceTrack=function(h){!h.RTCRtpSender||"replaceTrack"in h.RTCRtpSender.prototype||(h.RTCRtpSender.prototype.replaceTrack=h.RTCRtpSender.prototype.setTrack)};var h,e=function(h){if(h&&h.__esModule)return h;var P={};if(null!=h)for(var w in h)Object.prototype.hasOwnProperty.call(h,w)&&(P[w]=h[w]);return P.default=h,P}(nt("../utils")),i=nt("./filtericeservers"),d=(h=nt("rtcpeerconnection-shim"))&&h.__esModule?h:{default:h}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.filterIceServers=function(J,e){var i=!1;return(J=JSON.parse(JSON.stringify(J))).filter(function(d){if(d&&(d.urls||d.url)){var h=d.urls||d.url;d.url&&!d.urls&&V.deprecated("RTCIceServer.url","RTCIceServer.urls");var P="string"==typeof h;return P&&(h=[h]),h=h.filter(function(w){if(0===w.indexOf("stun:"))return!1;var M=w.startsWith("turn")&&!w.startsWith("turn:[")&&w.includes("transport=udp");return M&&!i?(i=!0,!0):M&&!i}),delete d.url,d.urls=P?h[0]:h,!!h.length}})};var V=function(J){if(J&&J.__esModule)return J;var e={};if(null!=J)for(var i in J)Object.prototype.hasOwnProperty.call(J,i)&&(e[i]=J[i]);return e.default=J,e}(nt("../utils"))},{"../utils":15}],9:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=function(V){"getDisplayMedia"in V.navigator&&V.navigator.mediaDevices&&(V.navigator.mediaDevices&&"getDisplayMedia"in V.navigator.mediaDevices||(V.navigator.mediaDevices.getDisplayMedia=V.navigator.getDisplayMedia.bind(V.navigator)))}},{}],10:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetUserMedia=function(V){var J=V&&V.navigator,i=J.mediaDevices.getUserMedia.bind(J.mediaDevices);J.mediaDevices.getUserMedia=function(d){return i(d).catch(function(h){return Promise.reject(function(d){return{name:{PermissionDeniedError:"NotAllowedError"}[d.name]||d.name,message:d.message,constraint:d.constraint,toString:function(){return this.name}}}(h))})}}},{}],11:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=Ze.shimGetUserMedia=void 0;var V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&"function"==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},J=nt("./getusermedia");Object.defineProperty(Ze,"shimGetUserMedia",{enumerable:!0,get:function(){return J.shimGetUserMedia}});var e=nt("./getdisplaymedia");Object.defineProperty(Ze,"shimGetDisplayMedia",{enumerable:!0,get:function(){return e.shimGetDisplayMedia}}),Ze.shimOnTrack=function(d){"object"===(void 0===d?"undefined":V(d))&&d.RTCTrackEvent&&"receiver"in d.RTCTrackEvent.prototype&&!("transceiver"in d.RTCTrackEvent.prototype)&&Object.defineProperty(d.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},Ze.shimPeerConnection=function(d){var h=i.detectBrowser(d);if("object"===(void 0===d?"undefined":V(d))&&(d.RTCPeerConnection||d.mozRTCPeerConnection)){!d.RTCPeerConnection&&d.mozRTCPeerConnection&&(d.RTCPeerConnection=d.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(C){var S=d.RTCPeerConnection.prototype[C];d.RTCPeerConnection.prototype[C]=function(){return arguments[0]=new("addIceCandidate"===C?d.RTCIceCandidate:d.RTCSessionDescription)(arguments[0]),S.apply(this,arguments)}});var P=d.RTCPeerConnection.prototype.addIceCandidate;d.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?P.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var w={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},M=d.RTCPeerConnection.prototype.getStats;d.RTCPeerConnection.prototype.getStats=function(C,S,n){return M.apply(this,[C||null]).then(function(y){if(h.version<53&&!S)try{y.forEach(function(R){R.type=w[R.type]||R.type})}catch(R){if("TypeError"!==R.name)throw R;y.forEach(function(m,u){y.set(u,Object.assign({},m,{type:w[m.type]||m.type}))})}return y}).then(S,n)}}},Ze.shimSenderGetStats=function(d){if("object"===(void 0===d?"undefined":V(d))&&d.RTCPeerConnection&&d.RTCRtpSender&&(!d.RTCRtpSender||!("getStats"in d.RTCRtpSender.prototype))){var h=d.RTCPeerConnection.prototype.getSenders;h&&(d.RTCPeerConnection.prototype.getSenders=function(){var w=this,M=h.apply(this,[]);return M.forEach(function(C){return C._pc=w}),M});var P=d.RTCPeerConnection.prototype.addTrack;P&&(d.RTCPeerConnection.prototype.addTrack=function(){var w=P.apply(this,arguments);return w._pc=this,w}),d.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},Ze.shimReceiverGetStats=function(d){if("object"===(void 0===d?"undefined":V(d))&&d.RTCPeerConnection&&d.RTCRtpSender&&(!d.RTCRtpSender||!("getStats"in d.RTCRtpReceiver.prototype))){var h=d.RTCPeerConnection.prototype.getReceivers;h&&(d.RTCPeerConnection.prototype.getReceivers=function(){var P=this,w=h.apply(this,[]);return w.forEach(function(M){return M._pc=P}),w}),i.wrapPeerConnectionEvent(d,"track",function(P){return P.receiver._pc=P.srcElement,P}),d.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},Ze.shimRemoveStream=function(d){!d.RTCPeerConnection||"removeStream"in d.RTCPeerConnection.prototype||(d.RTCPeerConnection.prototype.removeStream=function(h){var P=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(w){w.track&&h.getTracks().includes(w.track)&&P.removeTrack(w)})})},Ze.shimRTCDataChannel=function(d){d.DataChannel&&!d.RTCDataChannel&&(d.RTCDataChannel=d.DataChannel)};var i=function(d){if(d&&d.__esModule)return d;var h={};if(null!=d)for(var P in d)Object.prototype.hasOwnProperty.call(d,P)&&(h[P]=d[P]);return h.default=d,h}(nt("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.shimGetDisplayMedia=function(V,J){V.navigator.mediaDevices&&"getDisplayMedia"in V.navigator.mediaDevices||V.navigator.mediaDevices&&(V.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===e.video?e.video={mediaSource:J}:e.video.mediaSource=J,V.navigator.mediaDevices.getUserMedia(e)})}},{}],13:[function(nt,Lt,Ze){"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});var V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Ze.shimGetUserMedia=function(e){var i=J.detectBrowser(e),d=e&&e.navigator,h=e&&e.MediaStreamTrack;if(d.getUserMedia=function(S,n,y){J.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),d.mediaDevices.getUserMedia(S).then(n,y)},!(i.version>55&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){var P=function(S,n,y){n in S&&!(y in S)&&(S[y]=S[n],delete S[n])},w=d.mediaDevices.getUserMedia.bind(d.mediaDevices);if(d.mediaDevices.getUserMedia=function(S){return"object"===(void 0===S?"undefined":V(S))&&"object"===V(S.audio)&&(S=JSON.parse(JSON.stringify(S)),P(S.audio,"autoGainControl","mozAutoGainControl"),P(S.audio,"noiseSuppression","mozNoiseSuppression")),w(S)},h&&h.prototype.getSettings){var M=h.prototype.getSettings;h.prototype.getSettings=function(){var S=M.apply(this,arguments);return P(S,"mozAutoGainControl","autoGainControl"),P(S,"mozNoiseSuppression","noiseSuppression"),S}}if(h&&h.prototype.applyConstraints){var C=h.prototype.applyConstraints;h.prototype.applyConstraints=function(S){return"audio"===this.kind&&"object"===(void 0===S?"undefined":V(S))&&(S=JSON.parse(JSON.stringify(S)),P(S,"autoGainControl","mozAutoGainControl"),P(S,"noiseSuppression","mozNoiseSuppression")),C.apply(this,[S])}}}};var J=function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&(i[d]=e[d]);return i.default=e,i}(nt("../utils"))},{"../utils":15}],14:[function(nt,Lt,Ze){"use strict";function V(i){return i&&void 0!==i.video?Object.assign({},i,{video:e.compactObject(i.video)}):i}Object.defineProperty(Ze,"__esModule",{value:!0});var J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};Ze.shimLocalStreamsAPI=function(i){if("object"===(void 0===i?"undefined":J(i))&&i.RTCPeerConnection){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){var d=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(h){var P=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(h)||this._localStreams.push(h),h.getTracks().forEach(function(w){return d.call(P,w,h)})},i.RTCPeerConnection.prototype.addTrack=function(h,P){return P&&(this._localStreams?this._localStreams.includes(P)||this._localStreams.push(P):this._localStreams=[P]),d.call(this,h,P)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(h){var P=this;this._localStreams||(this._localStreams=[]);var w=this._localStreams.indexOf(h);if(-1!==w){this._localStreams.splice(w,1);var M=h.getTracks();this.getSenders().forEach(function(C){M.includes(C.track)&&P.removeTrack(C)})}})}},Ze.shimRemoteStreamsAPI=function(i){if("object"===(void 0===i?"undefined":J(i))&&i.RTCPeerConnection&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){Object.defineProperty(i.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(h){var P=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=h),this.addEventListener("track",this._onaddstreampoly=function(w){w.streams.forEach(function(M){if(P._remoteStreams||(P._remoteStreams=[]),!P._remoteStreams.includes(M)){P._remoteStreams.push(M);var C=new Event("addstream");C.stream=M,P.dispatchEvent(C)}})})}});var d=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){var h=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(P){P.streams.forEach(function(w){if(h._remoteStreams||(h._remoteStreams=[]),!(h._remoteStreams.indexOf(w)>=0)){h._remoteStreams.push(w);var M=new Event("addstream");M.stream=w,h.dispatchEvent(M)}})}),d.apply(h,arguments)}}},Ze.shimCallbacksAPI=function(i){if("object"===(void 0===i?"undefined":J(i))&&i.RTCPeerConnection){var d=i.RTCPeerConnection.prototype,h=d.createOffer,P=d.createAnswer,w=d.setLocalDescription,M=d.setRemoteDescription,C=d.addIceCandidate;d.createOffer=function(n,y){var R=arguments.length>=2?arguments[2]:arguments[0],m=h.apply(this,[R]);return y?(m.then(n,y),Promise.resolve()):m},d.createAnswer=function(n,y){var R=arguments.length>=2?arguments[2]:arguments[0],m=P.apply(this,[R]);return y?(m.then(n,y),Promise.resolve()):m};var S=function(n,y,R){var m=w.apply(this,[n]);return R?(m.then(y,R),Promise.resolve()):m};d.setLocalDescription=S,d.setRemoteDescription=S=function(n,y,R){var m=M.apply(this,[n]);return R?(m.then(y,R),Promise.resolve()):m},d.addIceCandidate=S=function(n,y,R){var m=C.apply(this,[n]);return R?(m.then(y,R),Promise.resolve()):m}}},Ze.shimGetUserMedia=function(i){var d=i&&i.navigator;if(d.mediaDevices&&d.mediaDevices.getUserMedia){var h=d.mediaDevices,P=h.getUserMedia.bind(h);d.mediaDevices.getUserMedia=function(w){return P(V(w))}}!d.getUserMedia&&d.mediaDevices&&d.mediaDevices.getUserMedia&&(d.getUserMedia=function(w,M,C){d.mediaDevices.getUserMedia(w).then(M,C)}.bind(d))},Ze.shimConstraints=V,Ze.shimRTCIceServerUrls=function(i){var d=i.RTCPeerConnection;i.RTCPeerConnection=function(h,P){if(h&&h.iceServers){for(var w=[],M=0;M<h.iceServers.length;M++){var C=h.iceServers[M];!C.hasOwnProperty("urls")&&C.hasOwnProperty("url")?(e.deprecated("RTCIceServer.url","RTCIceServer.urls"),(C=JSON.parse(JSON.stringify(C))).urls=C.url,delete C.url,w.push(C)):w.push(h.iceServers[M])}h.iceServers=w}return new d(h,P)},i.RTCPeerConnection.prototype=d.prototype,"generateCertificate"in i.RTCPeerConnection&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return d.generateCertificate}})},Ze.shimTrackEventTransceiver=function(i){"object"===(void 0===i?"undefined":J(i))&&i.RTCPeerConnection&&"receiver"in i.RTCTrackEvent.prototype&&!i.RTCTransceiver&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},Ze.shimCreateOfferLegacy=function(i){var d=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(h){if(h){void 0!==h.offerToReceiveAudio&&(h.offerToReceiveAudio=!!h.offerToReceiveAudio);var P=this.getTransceivers().find(function(M){return"audio"===M.receiver.track.kind});!1===h.offerToReceiveAudio&&P?"sendrecv"===P.direction?P.setDirection?P.setDirection("sendonly"):P.direction="sendonly":"recvonly"===P.direction&&(P.setDirection?P.setDirection("inactive"):P.direction="inactive"):!0!==h.offerToReceiveAudio||P||this.addTransceiver("audio"),void 0!==h.offerToReceiveVideo&&(h.offerToReceiveVideo=!!h.offerToReceiveVideo);var w=this.getTransceivers().find(function(M){return"video"===M.receiver.track.kind});!1===h.offerToReceiveVideo&&w?"sendrecv"===w.direction?w.setDirection?w.setDirection("sendonly"):w.direction="sendonly":"recvonly"===w.direction&&(w.setDirection?w.setDirection("inactive"):w.direction="inactive"):!0!==h.offerToReceiveVideo||w||this.addTransceiver("video")}return d.apply(this,arguments)}};var e=function(i){if(i&&i.__esModule)return i;var d={};if(null!=i)for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(d[h]=i[h]);return d.default=i,d}(nt("../utils"))},{"../utils":15}],15:[function(nt,Lt,Ze){"use strict";function J(w,M,C){var S=w.match(M);return S&&S.length>=C&&parseInt(S[C],10)}function i(w,M,C){M&&!C.has(M.id)&&(C.set(M.id,M),Object.keys(M).forEach(function(S){S.endsWith("Id")?i(w,w.get(M[S]),C):S.endsWith("Ids")&&M[S].forEach(function(n){i(w,w.get(n),C)})}))}Object.defineProperty(Ze,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(w){return typeof w}:function(w){return w&&"function"==typeof Symbol&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w};Ze.extractVersion=J,Ze.wrapPeerConnectionEvent=function(w,M,C){if(w.RTCPeerConnection){var S=w.RTCPeerConnection.prototype,n=S.addEventListener;S.addEventListener=function(R,m){if(R!==M)return n.apply(this,arguments);var u=function(f){var I=C(f);I&&m(I)};return this._eventMap=this._eventMap||{},this._eventMap[m]=u,n.apply(this,[R,u])};var y=S.removeEventListener;S.removeEventListener=function(R,m){if(R!==M||!this._eventMap||!this._eventMap[m])return y.apply(this,arguments);var u=this._eventMap[m];return delete this._eventMap[m],y.apply(this,[R,u])},Object.defineProperty(S,"on"+M,{get:function(){return this["_on"+M]},set:function(R){this["_on"+M]&&(this.removeEventListener(M,this["_on"+M]),delete this["_on"+M]),R&&this.addEventListener(M,this["_on"+M]=R)},enumerable:!0,configurable:!0})}},Ze.disableLog=function(w){return"boolean"!=typeof w?new Error("Argument type: "+(void 0===w?"undefined":d(w))+". Please use a boolean."):(h=w,w?"adapter.js logging disabled":"adapter.js logging enabled")},Ze.disableWarnings=function(w){return"boolean"!=typeof w?new Error("Argument type: "+(void 0===w?"undefined":d(w))+". Please use a boolean."):(P=!w,"adapter.js deprecation warnings "+(w?"disabled":"enabled"))},Ze.log=function(){if("object"===("undefined"==typeof window?"undefined":d(window))){if(h)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},Ze.deprecated=function(w,M){P&&console.warn(w+" is deprecated, please use "+M+" instead.")},Ze.detectBrowser=function(w){var M=w.navigator,C={browser:null,version:null};if(void 0===w||!w.navigator)return C.browser="Not a browser.",C;if(M.mozGetUserMedia)C.browser="firefox",C.version=J(M.userAgent,/Firefox\/(\d+)\./,1);else if(M.webkitGetUserMedia||!1===w.isSecureContext&&w.webkitRTCPeerConnection&&!w.RTCIceGatherer)C.browser="chrome",C.version=J(M.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(M.mediaDevices&&M.userAgent.match(/Edge\/(\d+).(\d+)$/))C.browser="edge",C.version=J(M.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!w.RTCPeerConnection||!M.userAgent.match(/AppleWebKit\/(\d+)\./))return C.browser="Not a supported browser.",C;C.browser="safari",C.version=J(M.userAgent,/AppleWebKit\/(\d+)\./,1)}return C},Ze.compactObject=function e(w){return"object"!==(void 0===w?"undefined":d(w))?w:Object.keys(w).reduce(function(M,C){var S="object"===d(w[C]),n=S?e(w[C]):w[C],y=S&&!Object.keys(n).length;return void 0===n||y?M:Object.assign(M,function(w,M,C){return M in w?Object.defineProperty(w,M,{value:C,enumerable:!0,configurable:!0,writable:!0}):w[M]=C,w}({},C,n))},{})},Ze.walkStats=i,Ze.filterStats=function(w,M,C){var S=C?"outbound-rtp":"inbound-rtp",n=new Map;if(null===M)return n;var y=[];return w.forEach(function(R){"track"===R.type&&R.trackIdentifier===M.id&&y.push(R)}),y.forEach(function(R){w.forEach(function(m){m.type===S&&m.trackId===R.id&&i(w,m,n)})}),n};var h=!0,P=!0},{}],16:[function(nt,Lt,Ze){"use strict";function J(M,C,S,n,y){var R=w.writeRtpDescription(M.kind,C);if(R+=w.writeIceParameters(M.iceGatherer.getLocalParameters()),R+=w.writeDtlsParameters(M.dtlsTransport.getLocalParameters(),"offer"===S?"actpass":y||"active"),R+="a=mid:"+M.mid+"\r\n",R+=M.rtpSender&&M.rtpReceiver?"a=sendrecv\r\n":M.rtpSender?"a=sendonly\r\n":M.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",M.rtpSender){var m=M.rtpSender._initialTrackId||M.rtpSender.track.id;M.rtpSender._initialTrackId=m;var u="msid:"+(n?n.id:"-")+" "+m+"\r\n";R+="a="+u,R+="a=ssrc:"+M.sendEncodingParameters[0].ssrc+" "+u,M.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+M.sendEncodingParameters[0].rtx.ssrc+" "+u,R+="a=ssrc-group:FID "+M.sendEncodingParameters[0].ssrc+" "+M.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return R+="a=ssrc:"+M.sendEncodingParameters[0].ssrc+" cname:"+w.localCName+"\r\n",M.rtpSender&&M.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+M.sendEncodingParameters[0].rtx.ssrc+" cname:"+w.localCName+"\r\n"),R}function i(M,C){var S={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(R,m){R=parseInt(R,10);for(var u=0;u<m.length;u++)if(m[u].payloadType===R||m[u].preferredPayloadType===R)return m[u]},y=function(R,m,u,f){var I=n(R.parameters.apt,u),c=n(m.parameters.apt,f);return I&&c&&I.name.toLowerCase()===c.name.toLowerCase()};return M.codecs.forEach(function(R){for(var m=0;m<C.codecs.length;m++){var u=C.codecs[m];if(R.name.toLowerCase()===u.name.toLowerCase()&&R.clockRate===u.clockRate){if("rtx"===R.name.toLowerCase()&&R.parameters&&u.parameters.apt&&!y(R,u,M.codecs,C.codecs))continue;(u=JSON.parse(JSON.stringify(u))).numChannels=Math.min(R.numChannels,u.numChannels),S.codecs.push(u),u.rtcpFeedback=u.rtcpFeedback.filter(function(f){for(var I=0;I<R.rtcpFeedback.length;I++)if(R.rtcpFeedback[I].type===f.type&&R.rtcpFeedback[I].parameter===f.parameter)return!0;return!1});break}}}),M.headerExtensions.forEach(function(R){for(var m=0;m<C.headerExtensions.length;m++){var u=C.headerExtensions[m];if(R.uri===u.uri){S.headerExtensions.push(u);break}}}),S}function d(M,C,S){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[C][M].indexOf(S)}function h(M,C){var S=M.getRemoteCandidates().find(function(n){return C.foundation===n.foundation&&C.ip===n.ip&&C.port===n.port&&C.priority===n.priority&&C.protocol===n.protocol&&C.type===n.type});return S||M.addRemoteCandidate(C),!S}function P(M,C){var S=new Error(C);return S.name=M,S.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[M],S}var w=nt("sdp");Lt.exports=function(M,C){function S(u,f){f.addTrack(u),f.dispatchEvent(new M.MediaStreamTrackEvent("addtrack",{track:u}))}function y(u,f,I,c){var j=new Event("track");j.track=f,j.receiver=I,j.transceiver={receiver:I},j.streams=c,M.setTimeout(function(){u._dispatchEvent("track",j)})}var R=function(u){var f=this,I=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(j){f[j]=I[j].bind(I)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",u=JSON.parse(JSON.stringify(u||{})),this.usingBundle="max-bundle"===u.bundlePolicy,"negotiate"===u.rtcpMuxPolicy)throw P("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(u.rtcpMuxPolicy||(u.rtcpMuxPolicy="require"),u.iceTransportPolicy){case"all":case"relay":break;default:u.iceTransportPolicy="all"}switch(u.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:u.bundlePolicy="balanced"}if(u.iceServers=function(M,C){var S=!1;return(M=JSON.parse(JSON.stringify(M))).filter(function(n){if(n&&(n.urls||n.url)){var y=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var R="string"==typeof y;return R&&(y=[y]),y=y.filter(function(m){return 0!==m.indexOf("turn:")||-1===m.indexOf("transport=udp")||-1!==m.indexOf("turn:[")||S?0===m.indexOf("stun:")&&C>=14393&&-1===m.indexOf("?transport=udp"):(S=!0,!0)}),delete n.url,n.urls=R?y[0]:y,!!y.length}})}(u.iceServers||[],C),this._iceGatherers=[],u.iceCandidatePoolSize)for(var c=u.iceCandidatePoolSize;c>0;c--)this._iceGatherers.push(new M.RTCIceGatherer({iceServers:u.iceServers,gatherPolicy:u.iceTransportPolicy}));else u.iceCandidatePoolSize=0;this._config=u,this.transceivers=[],this._sdpSessionId=w.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(R.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(R.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),R.prototype.onicecandidate=null,R.prototype.onaddstream=null,R.prototype.ontrack=null,R.prototype.onremovestream=null,R.prototype.onsignalingstatechange=null,R.prototype.oniceconnectionstatechange=null,R.prototype.onconnectionstatechange=null,R.prototype.onicegatheringstatechange=null,R.prototype.onnegotiationneeded=null,R.prototype.ondatachannel=null,R.prototype._dispatchEvent=function(u,f){this._isClosed||(this.dispatchEvent(f),"function"==typeof this["on"+u]&&this["on"+u](f))},R.prototype._emitGatheringStateChange=function(){var u=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",u)},R.prototype.getConfiguration=function(){return this._config},R.prototype.getLocalStreams=function(){return this.localStreams},R.prototype.getRemoteStreams=function(){return this.remoteStreams},R.prototype._createTransceiver=function(u,f){var c={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:u,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)c.iceTransport=this.transceivers[0].iceTransport,c.dtlsTransport=this.transceivers[0].dtlsTransport;else{var j=this._createIceAndDtlsTransports();c.iceTransport=j.iceTransport,c.dtlsTransport=j.dtlsTransport}return f||this.transceivers.push(c),c},R.prototype.addTrack=function(u,f){if(this._isClosed)throw P("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(j){return j.track===u}))throw P("InvalidAccessError","Track already exists.");for(var I,c=0;c<this.transceivers.length;c++)this.transceivers[c].track||this.transceivers[c].kind!==u.kind||(I=this.transceivers[c]);return I||(I=this._createTransceiver(u.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(f)&&this.localStreams.push(f),I.track=u,I.stream=f,I.rtpSender=new M.RTCRtpSender(u,I.dtlsTransport),I.rtpSender},R.prototype.addStream=function(u){var f=this;if(C>=15025)u.getTracks().forEach(function(c){f.addTrack(c,u)});else{var I=u.clone();u.getTracks().forEach(function(c,j){var q=I.getTracks()[j];c.addEventListener("enabled",function(b){q.enabled=b.enabled})}),I.getTracks().forEach(function(c){f.addTrack(c,I)})}},R.prototype.removeTrack=function(u){if(this._isClosed)throw P("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(u instanceof M.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(c){return c.rtpSender===u});if(!f)throw P("InvalidAccessError","Sender was not created by this connection.");var I=f.stream;f.rtpSender.stop(),f.rtpSender=null,f.track=null,f.stream=null,-1===this.transceivers.map(function(c){return c.stream}).indexOf(I)&&this.localStreams.indexOf(I)>-1&&this.localStreams.splice(this.localStreams.indexOf(I),1),this._maybeFireNegotiationNeeded()},R.prototype.removeStream=function(u){var f=this;u.getTracks().forEach(function(I){var c=f.getSenders().find(function(j){return j.track===I});c&&f.removeTrack(c)})},R.prototype.getSenders=function(){return this.transceivers.filter(function(u){return!!u.rtpSender}).map(function(u){return u.rtpSender})},R.prototype.getReceivers=function(){return this.transceivers.filter(function(u){return!!u.rtpReceiver}).map(function(u){return u.rtpReceiver})},R.prototype._createIceGatherer=function(u,f){var I=this;if(f&&u>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var c=new M.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(c,"state",{value:"new",writable:!0}),this.transceivers[u].bufferedCandidateEvents=[],this.transceivers[u].bufferCandidates=function(j){var q=!j.candidate||0===Object.keys(j.candidate).length;c.state=q?"completed":"gathering",null!==I.transceivers[u].bufferedCandidateEvents&&I.transceivers[u].bufferedCandidateEvents.push(j)},c.addEventListener("localcandidate",this.transceivers[u].bufferCandidates),c},R.prototype._gather=function(u,f){var I=this,c=this.transceivers[f].iceGatherer;if(!c.onlocalcandidate){var j=this.transceivers[f].bufferedCandidateEvents;this.transceivers[f].bufferedCandidateEvents=null,c.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates),c.onlocalcandidate=function(q){if(!(I.usingBundle&&f>0)){var b=new Event("icecandidate");b.candidate={sdpMid:u,sdpMLineIndex:f};var T=q.candidate,Z=!T||0===Object.keys(T).length;if(Z)"new"!==c.state&&"gathering"!==c.state||(c.state="completed");else{"new"===c.state&&(c.state="gathering"),T.component=1,T.ufrag=c.getLocalParameters().usernameFragment;var le=w.writeCandidate(T);b.candidate=Object.assign(b.candidate,w.parseCandidate(le)),b.candidate.candidate=le,b.candidate.toJSON=function(){return{candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex,usernameFragment:b.candidate.usernameFragment}}}var x=w.getMediaSections(I._localDescription.sdp);x[b.candidate.sdpMLineIndex]+=Z?"a=end-of-candidates\r\n":"a="+b.candidate.candidate+"\r\n",I._localDescription.sdp=w.getDescription(I._localDescription.sdp)+x.join("");var Se=I.transceivers.every(function(Ee){return Ee.iceGatherer&&"completed"===Ee.iceGatherer.state});"gathering"!==I.iceGatheringState&&(I.iceGatheringState="gathering",I._emitGatheringStateChange()),Z||I._dispatchEvent("icecandidate",b),Se&&(I._dispatchEvent("icecandidate",new Event("icecandidate")),I.iceGatheringState="complete",I._emitGatheringStateChange())}},M.setTimeout(function(){j.forEach(function(q){c.onlocalcandidate(q)})},0)}},R.prototype._createIceAndDtlsTransports=function(){var u=this,f=new M.RTCIceTransport(null);f.onicestatechange=function(){u._updateIceConnectionState(),u._updateConnectionState()};var I=new M.RTCDtlsTransport(f);return I.ondtlsstatechange=function(){u._updateConnectionState()},I.onerror=function(){Object.defineProperty(I,"state",{value:"failed",writable:!0}),u._updateConnectionState()},{iceTransport:f,dtlsTransport:I}},R.prototype._disposeIceAndDtlsTransports=function(u){var f=this.transceivers[u].iceGatherer;f&&(delete f.onlocalcandidate,delete this.transceivers[u].iceGatherer);var I=this.transceivers[u].iceTransport;I&&(delete I.onicestatechange,delete this.transceivers[u].iceTransport);var c=this.transceivers[u].dtlsTransport;c&&(delete c.ondtlsstatechange,delete c.onerror,delete this.transceivers[u].dtlsTransport)},R.prototype._transceive=function(u,f,I){var c=i(u.localCapabilities,u.remoteCapabilities);f&&u.rtpSender&&(c.encodings=u.sendEncodingParameters,c.rtcp={cname:w.localCName,compound:u.rtcpParameters.compound},u.recvEncodingParameters.length&&(c.rtcp.ssrc=u.recvEncodingParameters[0].ssrc),u.rtpSender.send(c)),I&&u.rtpReceiver&&c.codecs.length>0&&("video"===u.kind&&u.recvEncodingParameters&&C<15019&&u.recvEncodingParameters.forEach(function(j){delete j.rtx}),c.encodings=u.recvEncodingParameters.length?u.recvEncodingParameters:[{}],c.rtcp={compound:u.rtcpParameters.compound},u.rtcpParameters.cname&&(c.rtcp.cname=u.rtcpParameters.cname),u.sendEncodingParameters.length&&(c.rtcp.ssrc=u.sendEncodingParameters[0].ssrc),u.rtpReceiver.receive(c))},R.prototype.setLocalDescription=function(u){var I,c,f=this;if(-1===["offer","answer"].indexOf(u.type))return Promise.reject(P("TypeError",'Unsupported type "'+u.type+'"'));if(!d("setLocalDescription",u.type,f.signalingState)||f._isClosed)return Promise.reject(P("InvalidStateError","Can not set local "+u.type+" in state "+f.signalingState));if("offer"===u.type)I=w.splitSections(u.sdp),c=I.shift(),I.forEach(function(q,b){var T=w.parseRtpParameters(q);f.transceivers[b].localCapabilities=T}),f.transceivers.forEach(function(q,b){f._gather(q.mid,b)});else if("answer"===u.type){I=w.splitSections(f._remoteDescription.sdp),c=I.shift();var j=w.matchPrefix(c,"a=ice-lite").length>0;I.forEach(function(q,b){var T=f.transceivers[b],Z=T.iceGatherer,le=T.iceTransport,x=T.dtlsTransport,Se=T.localCapabilities,Ee=T.remoteCapabilities;if(!(w.isRejected(q)&&0===w.matchPrefix(q,"a=bundle-only").length||T.rejected)){var he=w.getIceParameters(q,c),ue=w.getDtlsParameters(q,c);j&&(ue.role="server"),f.usingBundle&&0!==b||(f._gather(T.mid,b),"new"===le.state&&le.start(Z,he,j?"controlling":"controlled"),"new"===x.state&&x.start(ue));var ke=i(Se,Ee);f._transceive(T,ke.codecs.length>0,!1)}})}return f._localDescription={type:u.type,sdp:u.sdp},f._updateSignalingState("offer"===u.type?"have-local-offer":"stable"),Promise.resolve()},R.prototype.setRemoteDescription=function(u){var f=this;if(-1===["offer","answer"].indexOf(u.type))return Promise.reject(P("TypeError",'Unsupported type "'+u.type+'"'));if(!d("setRemoteDescription",u.type,f.signalingState)||f._isClosed)return Promise.reject(P("InvalidStateError","Can not set remote "+u.type+" in state "+f.signalingState));var I={};f.remoteStreams.forEach(function(le){I[le.id]=le});var c=[],j=w.splitSections(u.sdp),q=j.shift(),b=w.matchPrefix(q,"a=ice-lite").length>0,T=w.matchPrefix(q,"a=group:BUNDLE ").length>0;f.usingBundle=T;var Z=w.matchPrefix(q,"a=ice-options:")[0];return f.canTrickleIceCandidates=!!Z&&Z.substr(14).split(" ").indexOf("trickle")>=0,j.forEach(function(le,x){var Se=w.splitLines(le),Ee=w.getKind(le),he=w.isRejected(le)&&0===w.matchPrefix(le,"a=bundle-only").length,ue=Se[0].substr(2).split(" ")[2],ke=w.getDirection(le,q),Ne=w.parseMsid(le),ze=w.getMid(le)||w.generateIdentifier();if(he||"application"===Ee&&("DTLS/SCTP"===ue||"UDP/DTLS/SCTP"===ue))f.transceivers[x]={mid:ze,kind:Ee,protocol:ue,rejected:!0};else{!he&&f.transceivers[x]&&f.transceivers[x].rejected&&(f.transceivers[x]=f._createTransceiver(Ee,!0));var Ve,et,_e,gt,mt,ot,at,yt,Et,ie,dt,Mt=w.parseRtpParameters(le);he||(ie=w.getIceParameters(le,q),(dt=w.getDtlsParameters(le,q)).role="client"),at=w.parseRtpEncodingParameters(le);var Rt=w.parseRtcpParameters(le),je=w.matchPrefix(le,"a=end-of-candidates",q).length>0,xt=w.matchPrefix(le,"a=candidate:").map(function(kt){return w.parseCandidate(kt)}).filter(function(kt){return 1===kt.component});if(("offer"===u.type||"answer"===u.type)&&!he&&T&&x>0&&f.transceivers[x]&&(f._disposeIceAndDtlsTransports(x),f.transceivers[x].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[x].iceTransport=f.transceivers[0].iceTransport,f.transceivers[x].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[x].rtpSender&&f.transceivers[x].rtpSender.setTransport(f.transceivers[0].dtlsTransport),f.transceivers[x].rtpReceiver&&f.transceivers[x].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport)),"offer"!==u.type||he)"answer"!==u.type||he||(et=(Ve=f.transceivers[x]).iceGatherer,_e=Ve.iceTransport,gt=Ve.dtlsTransport,mt=Ve.rtpReceiver,ot=Ve.sendEncodingParameters,yt=Ve.localCapabilities,f.transceivers[x].recvEncodingParameters=at,f.transceivers[x].remoteCapabilities=Mt,f.transceivers[x].rtcpParameters=Rt,xt.length&&"new"===_e.state&&(!b&&!je||T&&0!==x?xt.forEach(function(kt){h(Ve.iceTransport,kt)}):_e.setRemoteCandidates(xt)),T&&0!==x||("new"===_e.state&&_e.start(et,ie,"controlling"),"new"===gt.state&&gt.start(dt)),!i(Ve.localCapabilities,Ve.remoteCapabilities).codecs.filter(function(kt){return"rtx"===kt.name.toLowerCase()}).length&&Ve.sendEncodingParameters[0].rtx&&delete Ve.sendEncodingParameters[0].rtx,f._transceive(Ve,"sendrecv"===ke||"recvonly"===ke,"sendrecv"===ke||"sendonly"===ke),!mt||"sendrecv"!==ke&&"sendonly"!==ke?delete Ve.rtpReceiver:(Et=mt.track,Ne?(I[Ne.stream]||(I[Ne.stream]=new M.MediaStream),S(Et,I[Ne.stream]),c.push([Et,mt,I[Ne.stream]])):(I.default||(I.default=new M.MediaStream),S(Et,I.default),c.push([Et,mt,I.default]))));else{(Ve=f.transceivers[x]||f._createTransceiver(Ee)).mid=ze,Ve.iceGatherer||(Ve.iceGatherer=f._createIceGatherer(x,T)),xt.length&&"new"===Ve.iceTransport.state&&(!je||T&&0!==x?xt.forEach(function(kt){h(Ve.iceTransport,kt)}):Ve.iceTransport.setRemoteCandidates(xt)),yt=M.RTCRtpReceiver.getCapabilities(Ee),C<15019&&(yt.codecs=yt.codecs.filter(function(kt){return"rtx"!==kt.name})),ot=Ve.sendEncodingParameters||[{ssrc:1001*(2*x+2)}];var Gt,Wt=!1;"sendrecv"===ke||"sendonly"===ke?(Wt=!Ve.rtpReceiver,mt=Ve.rtpReceiver||new M.RTCRtpReceiver(Ve.dtlsTransport,Ee),Wt&&(Et=mt.track,Ne&&"-"===Ne.stream||(Ne?(I[Ne.stream]||(I[Ne.stream]=new M.MediaStream,Object.defineProperty(I[Ne.stream],"id",{get:function(){return Ne.stream}})),Object.defineProperty(Et,"id",{get:function(){return Ne.track}}),Gt=I[Ne.stream]):(I.default||(I.default=new M.MediaStream),Gt=I.default)),Gt&&(S(Et,Gt),Ve.associatedRemoteMediaStreams.push(Gt)),c.push([Et,mt,Gt]))):Ve.rtpReceiver&&Ve.rtpReceiver.track&&(Ve.associatedRemoteMediaStreams.forEach(function(kt){var Xe=kt.getTracks().find(function(zt){return zt.id===Ve.rtpReceiver.track.id});Xe&&function(u,f){f.removeTrack(u),f.dispatchEvent(new M.MediaStreamTrackEvent("removetrack",{track:u}))}(Xe,kt)}),Ve.associatedRemoteMediaStreams=[]),Ve.localCapabilities=yt,Ve.remoteCapabilities=Mt,Ve.rtpReceiver=mt,Ve.rtcpParameters=Rt,Ve.sendEncodingParameters=ot,Ve.recvEncodingParameters=at,f._transceive(f.transceivers[x],!1,Wt)}}}),void 0===f._dtlsRole&&(f._dtlsRole="offer"===u.type?"active":"passive"),f._remoteDescription={type:u.type,sdp:u.sdp},f._updateSignalingState("offer"===u.type?"have-remote-offer":"stable"),Object.keys(I).forEach(function(le){var x=I[le];if(x.getTracks().length){if(-1===f.remoteStreams.indexOf(x)){f.remoteStreams.push(x);var Se=new Event("addstream");Se.stream=x,M.setTimeout(function(){f._dispatchEvent("addstream",Se)})}c.forEach(function(Ee){x.id===Ee[2].id&&y(f,Ee[0],Ee[1],[x])})}}),c.forEach(function(le){le[2]||y(f,le[0],le[1],[])}),M.setTimeout(function(){f&&f.transceivers&&f.transceivers.forEach(function(le){le.iceTransport&&"new"===le.iceTransport.state&&le.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),le.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},R.prototype.close=function(){this.transceivers.forEach(function(u){u.iceTransport&&u.iceTransport.stop(),u.dtlsTransport&&u.dtlsTransport.stop(),u.rtpSender&&u.rtpSender.stop(),u.rtpReceiver&&u.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},R.prototype._updateSignalingState=function(u){this.signalingState=u;var f=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",f)},R.prototype._maybeFireNegotiationNeeded=function(){var u=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,M.setTimeout(function(){if(u.needNegotiation){u.needNegotiation=!1;var f=new Event("negotiationneeded");u._dispatchEvent("negotiationneeded",f)}},0))},R.prototype._updateIceConnectionState=function(){var u,f={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(c){c.iceTransport&&!c.rejected&&f[c.iceTransport.state]++}),u="new",f.failed>0?u="failed":f.checking>0?u="checking":f.disconnected>0?u="disconnected":f.new>0?u="new":f.connected>0?u="connected":f.completed>0&&(u="completed"),u!==this.iceConnectionState){this.iceConnectionState=u;var I=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",I)}},R.prototype._updateConnectionState=function(){var u,f={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(c){c.iceTransport&&c.dtlsTransport&&!c.rejected&&(f[c.iceTransport.state]++,f[c.dtlsTransport.state]++)}),f.connected+=f.completed,u="new",f.failed>0?u="failed":f.connecting>0?u="connecting":f.disconnected>0?u="disconnected":f.new>0?u="new":f.connected>0&&(u="connected"),u!==this.connectionState){this.connectionState=u;var I=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",I)}},R.prototype.createOffer=function(){var u=this;if(u._isClosed)return Promise.reject(P("InvalidStateError","Can not call createOffer after close"));var f=u.transceivers.filter(function(b){return"audio"===b.kind}).length,I=u.transceivers.filter(function(b){return"video"===b.kind}).length,c=arguments[0];if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(f=!0===c.offerToReceiveAudio?1:!1===c.offerToReceiveAudio?0:c.offerToReceiveAudio),void 0!==c.offerToReceiveVideo&&(I=!0===c.offerToReceiveVideo?1:!1===c.offerToReceiveVideo?0:c.offerToReceiveVideo)}for(u.transceivers.forEach(function(b){"audio"===b.kind?--f<0&&(b.wantReceive=!1):"video"===b.kind&&--I<0&&(b.wantReceive=!1)});f>0||I>0;)f>0&&(u._createTransceiver("audio"),f--),I>0&&(u._createTransceiver("video"),I--);var j=w.writeSessionBoilerplate(u._sdpSessionId,u._sdpSessionVersion++);u.transceivers.forEach(function(b,T){var Z=b.track,le=b.kind,x=b.mid||w.generateIdentifier();b.mid=x,b.iceGatherer||(b.iceGatherer=u._createIceGatherer(T,u.usingBundle));var Se=M.RTCRtpSender.getCapabilities(le);C<15019&&(Se.codecs=Se.codecs.filter(function(he){return"rtx"!==he.name})),Se.codecs.forEach(function(he){"H264"===he.name&&void 0===he.parameters["level-asymmetry-allowed"]&&(he.parameters["level-asymmetry-allowed"]="1"),b.remoteCapabilities&&b.remoteCapabilities.codecs&&b.remoteCapabilities.codecs.forEach(function(ue){he.name.toLowerCase()===ue.name.toLowerCase()&&he.clockRate===ue.clockRate&&(he.preferredPayloadType=ue.payloadType)})}),Se.headerExtensions.forEach(function(he){(b.remoteCapabilities&&b.remoteCapabilities.headerExtensions||[]).forEach(function(ue){he.uri===ue.uri&&(he.id=ue.id)})});var Ee=b.sendEncodingParameters||[{ssrc:1001*(2*T+1)}];Z&&C>=15019&&"video"===le&&!Ee[0].rtx&&(Ee[0].rtx={ssrc:Ee[0].ssrc+1}),b.wantReceive&&(b.rtpReceiver=new M.RTCRtpReceiver(b.dtlsTransport,le)),b.localCapabilities=Se,b.sendEncodingParameters=Ee}),"max-compat"!==u._config.bundlePolicy&&(j+="a=group:BUNDLE "+u.transceivers.map(function(b){return b.mid}).join(" ")+"\r\n"),j+="a=ice-options:trickle\r\n",u.transceivers.forEach(function(b,T){j+=J(b,b.localCapabilities,"offer",b.stream,u._dtlsRole),j+="a=rtcp-rsize\r\n",!b.iceGatherer||"new"===u.iceGatheringState||0!==T&&u.usingBundle||(b.iceGatherer.getLocalCandidates().forEach(function(Z){Z.component=1,j+="a="+w.writeCandidate(Z)+"\r\n"}),"completed"===b.iceGatherer.state&&(j+="a=end-of-candidates\r\n"))});var q=new M.RTCSessionDescription({type:"offer",sdp:j});return Promise.resolve(q)},R.prototype.createAnswer=function(){var u=this;if(u._isClosed)return Promise.reject(P("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==u.signalingState&&"have-local-pranswer"!==u.signalingState)return Promise.reject(P("InvalidStateError","Can not call createAnswer in signalingState "+u.signalingState));var f=w.writeSessionBoilerplate(u._sdpSessionId,u._sdpSessionVersion++);u.usingBundle&&(f+="a=group:BUNDLE "+u.transceivers.map(function(j){return j.mid}).join(" ")+"\r\n"),f+="a=ice-options:trickle\r\n";var I=w.getMediaSections(u._remoteDescription.sdp).length;u.transceivers.forEach(function(j,q){if(!(q+1>I)){if(j.rejected)return"application"===j.kind?f+="DTLS/SCTP"===j.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+j.protocol+" webrtc-datachannel\r\n":"audio"===j.kind?f+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===j.kind&&(f+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(f+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+j.mid+"\r\n");var b;j.stream&&("audio"===j.kind?b=j.stream.getAudioTracks()[0]:"video"===j.kind&&(b=j.stream.getVideoTracks()[0]),b&&C>=15019&&"video"===j.kind&&!j.sendEncodingParameters[0].rtx&&(j.sendEncodingParameters[0].rtx={ssrc:j.sendEncodingParameters[0].ssrc+1}));var T=i(j.localCapabilities,j.remoteCapabilities);!T.codecs.filter(function(Z){return"rtx"===Z.name.toLowerCase()}).length&&j.sendEncodingParameters[0].rtx&&delete j.sendEncodingParameters[0].rtx,f+=J(j,T,"answer",j.stream,u._dtlsRole),j.rtcpParameters&&j.rtcpParameters.reducedSize&&(f+="a=rtcp-rsize\r\n")}});var c=new M.RTCSessionDescription({type:"answer",sdp:f});return Promise.resolve(c)},R.prototype.addIceCandidate=function(u){var f,I=this;return u&&void 0===u.sdpMLineIndex&&!u.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(c,j){if(!I._remoteDescription)return j(P("InvalidStateError","Can not add ICE candidate without a remote description"));if(u&&""!==u.candidate){var q=u.sdpMLineIndex;if(u.sdpMid)for(var b=0;b<I.transceivers.length;b++)if(I.transceivers[b].mid===u.sdpMid){q=b;break}var T=I.transceivers[q];if(!T)return j(P("OperationError","Can not add ICE candidate"));if(T.rejected)return c();var Z=Object.keys(u.candidate).length>0?w.parseCandidate(u.candidate):{};if("tcp"===Z.protocol&&(0===Z.port||9===Z.port)||Z.component&&1!==Z.component)return c();if((0===q||q>0&&T.iceTransport!==I.transceivers[0].iceTransport)&&!h(T.iceTransport,Z))return j(P("OperationError","Can not add ICE candidate"));var le=u.candidate.trim();0===le.indexOf("a=")&&(le=le.substr(2)),(f=w.getMediaSections(I._remoteDescription.sdp))[q]+="a="+(Z.type?le:"end-of-candidates")+"\r\n",I._remoteDescription.sdp=w.getDescription(I._remoteDescription.sdp)+f.join("")}else for(var x=0;x<I.transceivers.length&&(I.transceivers[x].rejected||(I.transceivers[x].iceTransport.addRemoteCandidate({}),(f=w.getMediaSections(I._remoteDescription.sdp))[x]+="a=end-of-candidates\r\n",I._remoteDescription.sdp=w.getDescription(I._remoteDescription.sdp)+f.join(""),!I.usingBundle));x++);c()})},R.prototype.getStats=function(u){if(u&&u instanceof M.MediaStreamTrack){var f=null;if(this.transceivers.forEach(function(c){c.rtpSender&&c.rtpSender.track===u?f=c.rtpSender:c.rtpReceiver&&c.rtpReceiver.track===u&&(f=c.rtpReceiver)}),!f)throw P("InvalidAccessError","Invalid selector.");return f.getStats()}var I=[];return this.transceivers.forEach(function(c){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(j){c[j]&&I.push(c[j].getStats())})}),Promise.all(I).then(function(c){var j=new Map;return c.forEach(function(q){q.forEach(function(b){j.set(b.id,b)})}),j})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(u){var f=M[u];if(f&&f.prototype&&f.prototype.getStats){var I=f.prototype.getStats;f.prototype.getStats=function(){return I.apply(this).then(function(c){var j=new Map;return Object.keys(c).forEach(function(q){c[q].type=function(M){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[M.type]||M.type}(c[q]),j.set(q,c[q])}),j})}}});var m=["createOffer","createAnswer"];return m.forEach(function(u){var f=R.prototype[u];R.prototype[u]=function(){var I=arguments;return"function"==typeof I[0]||"function"==typeof I[1]?f.apply(this,[arguments[2]]).then(function(c){"function"==typeof I[0]&&I[0].apply(null,[c])},function(c){"function"==typeof I[1]&&I[1].apply(null,[c])}):f.apply(this,arguments)}}),(m=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(u){var f=R.prototype[u];R.prototype[u]=function(){var I=arguments;return"function"==typeof I[1]||"function"==typeof I[2]?f.apply(this,arguments).then(function(){"function"==typeof I[1]&&I[1].apply(null)},function(c){"function"==typeof I[2]&&I[2].apply(null,[c])}):f.apply(this,arguments)}}),["getStats"].forEach(function(u){var f=R.prototype[u];R.prototype[u]=function(){var I=arguments;return"function"==typeof I[1]?f.apply(this,arguments).then(function(){"function"==typeof I[1]&&I[1].apply(null)}):f.apply(this,arguments)}}),R}},{sdp:17}],17:[function(nt,Lt,Ze){"use strict";var V={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};V.localCName=V.generateIdentifier(),V.splitLines=function(J){return J.trim().split("\n").map(function(e){return e.trim()})},V.splitSections=function(J){return J.split("\nm=").map(function(e,i){return(i>0?"m="+e:e).trim()+"\r\n"})},V.getDescription=function(J){var e=V.splitSections(J);return e&&e[0]},V.getMediaSections=function(J){var e=V.splitSections(J);return e.shift(),e},V.matchPrefix=function(J,e){return V.splitLines(J).filter(function(i){return 0===i.indexOf(e)})},V.parseCandidate=function(J){for(var e,i={foundation:(e=0===J.indexOf("a=candidate:")?J.substring(12).split(" "):J.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},d=8;d<e.length;d+=2)switch(e[d]){case"raddr":i.relatedAddress=e[d+1];break;case"rport":i.relatedPort=parseInt(e[d+1],10);break;case"tcptype":i.tcpType=e[d+1];break;case"ufrag":i.ufrag=e[d+1],i.usernameFragment=e[d+1];break;default:i[e[d]]=e[d+1]}return i},V.writeCandidate=function(J){var e=[];e.push(J.foundation),e.push(J.component),e.push(J.protocol.toUpperCase()),e.push(J.priority),e.push(J.address||J.ip),e.push(J.port);var i=J.type;return e.push("typ"),e.push(i),"host"!==i&&J.relatedAddress&&J.relatedPort&&(e.push("raddr"),e.push(J.relatedAddress),e.push("rport"),e.push(J.relatedPort)),J.tcpType&&"tcp"===J.protocol.toLowerCase()&&(e.push("tcptype"),e.push(J.tcpType)),(J.usernameFragment||J.ufrag)&&(e.push("ufrag"),e.push(J.usernameFragment||J.ufrag)),"candidate:"+e.join(" ")},V.parseIceOptions=function(J){return J.substr(14).split(" ")},V.parseRtpMap=function(J){var e=J.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.channels=3===e.length?parseInt(e[2],10):1,i.numChannels=i.channels,i},V.writeRtpMap=function(J){var e=J.payloadType;void 0!==J.preferredPayloadType&&(e=J.preferredPayloadType);var i=J.channels||J.numChannels||1;return"a=rtpmap:"+e+" "+J.name+"/"+J.clockRate+(1!==i?"/"+i:"")+"\r\n"},V.parseExtmap=function(J){var e=J.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},V.writeExtmap=function(J){return"a=extmap:"+(J.id||J.preferredId)+(J.direction&&"sendrecv"!==J.direction?"/"+J.direction:"")+" "+J.uri+"\r\n"},V.parseFmtp=function(J){for(var e,i={},d=J.substr(J.indexOf(" ")+1).split(";"),h=0;h<d.length;h++)i[(e=d[h].trim().split("="))[0].trim()]=e[1];return i},V.writeFmtp=function(J){var e="",i=J.payloadType;if(void 0!==J.preferredPayloadType&&(i=J.preferredPayloadType),J.parameters&&Object.keys(J.parameters).length){var d=[];Object.keys(J.parameters).forEach(function(h){d.push(J.parameters[h]?h+"="+J.parameters[h]:h)}),e+="a=fmtp:"+i+" "+d.join(";")+"\r\n"}return e},V.parseRtcpFb=function(J){var e=J.substr(J.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},V.writeRtcpFb=function(J){var e="",i=J.payloadType;return void 0!==J.preferredPayloadType&&(i=J.preferredPayloadType),J.rtcpFeedback&&J.rtcpFeedback.length&&J.rtcpFeedback.forEach(function(d){e+="a=rtcp-fb:"+i+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),e},V.parseSsrcMedia=function(J){var e=J.indexOf(" "),i={ssrc:parseInt(J.substr(7,e-7),10)},d=J.indexOf(":",e);return d>-1?(i.attribute=J.substr(e+1,d-e-1),i.value=J.substr(d+1)):i.attribute=J.substr(e+1),i},V.parseSsrcGroup=function(J){var e=J.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(i){return parseInt(i,10)})}},V.getMid=function(J){var e=V.matchPrefix(J,"a=mid:")[0];if(e)return e.substr(6)},V.parseFingerprint=function(J){var e=J.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},V.getDtlsParameters=function(J,e){return{role:"auto",fingerprints:V.matchPrefix(J+e,"a=fingerprint:").map(V.parseFingerprint)}},V.writeDtlsParameters=function(J,e){var i="a=setup:"+e+"\r\n";return J.fingerprints.forEach(function(d){i+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),i},V.getIceParameters=function(J,e){var i=V.splitLines(J);return{usernameFragment:(i=i.concat(V.splitLines(e))).filter(function(d){return 0===d.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(d){return 0===d.indexOf("a=ice-pwd:")})[0].substr(10)}},V.writeIceParameters=function(J){return"a=ice-ufrag:"+J.usernameFragment+"\r\na=ice-pwd:"+J.password+"\r\n"},V.parseRtpParameters=function(J){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=V.splitLines(J)[0].split(" "),d=3;d<i.length;d++){var h=i[d],P=V.matchPrefix(J,"a=rtpmap:"+h+" ")[0];if(P){var w=V.parseRtpMap(P),M=V.matchPrefix(J,"a=fmtp:"+h+" ");switch(w.parameters=M.length?V.parseFmtp(M[0]):{},w.rtcpFeedback=V.matchPrefix(J,"a=rtcp-fb:"+h+" ").map(V.parseRtcpFb),e.codecs.push(w),w.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(w.name.toUpperCase())}}}return V.matchPrefix(J,"a=extmap:").forEach(function(C){e.headerExtensions.push(V.parseExtmap(C))}),e},V.writeRtpDescription=function(J,e){var i="";i+="m="+J+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(h){return void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(h){i+=V.writeRtpMap(h),i+=V.writeFmtp(h),i+=V.writeRtcpFb(h)});var d=0;return e.codecs.forEach(function(h){h.maxptime>d&&(d=h.maxptime)}),d>0&&(i+="a=maxptime:"+d+"\r\n"),i+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(h){i+=V.writeExtmap(h)}),i},V.parseRtpEncodingParameters=function(J){var e,i=[],d=V.parseRtpParameters(J),h=-1!==d.fecMechanisms.indexOf("RED"),P=-1!==d.fecMechanisms.indexOf("ULPFEC"),w=V.matchPrefix(J,"a=ssrc:").map(function(n){return V.parseSsrcMedia(n)}).filter(function(n){return"cname"===n.attribute}),M=w.length>0&&w[0].ssrc,C=V.matchPrefix(J,"a=ssrc-group:FID").map(function(n){return n.substr(17).split(" ").map(function(y){return parseInt(y,10)})});C.length>0&&C[0].length>1&&C[0][0]===M&&(e=C[0][1]),d.codecs.forEach(function(n){if("RTX"===n.name.toUpperCase()&&n.parameters.apt){var y={ssrc:M,codecPayloadType:parseInt(n.parameters.apt,10)};M&&e&&(y.rtx={ssrc:e}),i.push(y),h&&((y=JSON.parse(JSON.stringify(y))).fec={ssrc:M,mechanism:P?"red+ulpfec":"red"},i.push(y))}}),0===i.length&&M&&i.push({ssrc:M});var S=V.matchPrefix(J,"b=");return S.length&&(S=0===S[0].indexOf("b=TIAS:")?parseInt(S[0].substr(7),10):0===S[0].indexOf("b=AS:")?1e3*parseInt(S[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(n){n.maxBitrate=S})),i},V.parseRtcpParameters=function(J){var e={},i=V.matchPrefix(J,"a=ssrc:").map(function(P){return V.parseSsrcMedia(P)}).filter(function(P){return"cname"===P.attribute})[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);var d=V.matchPrefix(J,"a=rtcp-rsize");e.reducedSize=d.length>0,e.compound=0===d.length;var h=V.matchPrefix(J,"a=rtcp-mux");return e.mux=h.length>0,e},V.parseMsid=function(J){var e,i=V.matchPrefix(J,"a=msid:");if(1===i.length)return{stream:(e=i[0].substr(7).split(" "))[0],track:e[1]};var d=V.matchPrefix(J,"a=ssrc:").map(function(h){return V.parseSsrcMedia(h)}).filter(function(h){return"msid"===h.attribute});return d.length>0?{stream:(e=d[0].value.split(" "))[0],track:e[1]}:void 0},V.generateSessionId=function(){return Math.random().toString().substr(2,21)},V.writeSessionBoilerplate=function(J,e,i){var h=void 0!==e?e:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(J||V.generateSessionId())+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},V.writeMediaSection=function(J,e,i,d){var h=V.writeRtpDescription(J.kind,e);if(h+=V.writeIceParameters(J.iceGatherer.getLocalParameters()),h+=V.writeDtlsParameters(J.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),h+="a=mid:"+J.mid+"\r\n",h+=J.direction?"a="+J.direction+"\r\n":J.rtpSender&&J.rtpReceiver?"a=sendrecv\r\n":J.rtpSender?"a=sendonly\r\n":J.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",J.rtpSender){var P="msid:"+d.id+" "+J.rtpSender.track.id+"\r\n";h+="a="+P,h+="a=ssrc:"+J.sendEncodingParameters[0].ssrc+" "+P,J.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+J.sendEncodingParameters[0].rtx.ssrc+" "+P,h+="a=ssrc-group:FID "+J.sendEncodingParameters[0].ssrc+" "+J.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return h+="a=ssrc:"+J.sendEncodingParameters[0].ssrc+" cname:"+V.localCName+"\r\n",J.rtpSender&&J.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+J.sendEncodingParameters[0].rtx.ssrc+" cname:"+V.localCName+"\r\n"),h},V.getDirection=function(J,e){for(var i=V.splitLines(J),d=0;d<i.length;d++)switch(i[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[d].substr(2)}return e?V.getDirection(e):"sendrecv"},V.getKind=function(J){return V.splitLines(J)[0].split(" ")[0].substr(2)},V.isRejected=function(J){return"0"===J.split(" ",2)[1]},V.parseMLine=function(J){var e=V.splitLines(J)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},V.parseOLine=function(J){var e=V.matchPrefix(J,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},V.isValidSDP=function(J){if("string"!=typeof J||0===J.length)return!1;for(var e=V.splitLines(J),i=0;i<e.length;i++)if(e[i].length<2||"="!==e[i].charAt(1))return!1;return!0},"object"==typeof Lt&&(Lt.exports=V)},{}]},{},[1])(1)}),function(nt){"use strict";function Lt(q){if("string"!=typeof q&&(q=String(q)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(q))throw new TypeError("Invalid character in header field name");return q.toLowerCase()}function Ze(q){return"string"!=typeof q&&(q=String(q)),q}function V(q){var b={next:function(){var T=q.shift();return{done:void 0===T,value:T}}};return m.iterable&&(b[Symbol.iterator]=function(){return b}),b}function J(q){this.map={},q instanceof J?q.forEach(function(b,T){this.append(T,b)},this):Array.isArray(q)?q.forEach(function(b){this.append(b[0],b[1])},this):q&&Object.getOwnPropertyNames(q).forEach(function(b){this.append(b,q[b])},this)}function e(q){if(q.bodyUsed)return Promise.reject(new TypeError("Already read"));q.bodyUsed=!0}function i(q){return new Promise(function(b,T){q.onload=function(){b(q.result)},q.onerror=function(){T(q.error)}})}function d(q){var b=new FileReader,T=i(b);return b.readAsArrayBuffer(q),T}function w(q){if(q.slice)return q.slice(0);var b=new Uint8Array(q.byteLength);return b.set(new Uint8Array(q)),b.buffer}function M(){return this.bodyUsed=!1,this._initBody=function(q){if(this._bodyInit=q,q)if("string"==typeof q)this._bodyText=q;else if(m.blob&&Blob.prototype.isPrototypeOf(q))this._bodyBlob=q;else if(m.formData&&FormData.prototype.isPrototypeOf(q))this._bodyFormData=q;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(q))this._bodyText=q.toString();else if(m.arrayBuffer&&m.blob&&f(q))this._bodyArrayBuffer=w(q.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(q)&&!I(q))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=w(q)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof q?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(q)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var q=e(this);if(q)return q;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?e(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(d)}),this.text=function(){var q=e(this);if(q)return q;if(this._bodyBlob)return function(q){var b=new FileReader,T=i(b);return b.readAsText(q),T}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(q){for(var b=new Uint8Array(q),T=new Array(b.length),Z=0;Z<b.length;Z++)T[Z]=String.fromCharCode(b[Z]);return T.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(n)}),this.json=function(){return this.text().then(JSON.parse)},this}function S(q,b){var T=(b=b||{}).body;if(q instanceof S){if(q.bodyUsed)throw new TypeError("Already read");this.url=q.url,this.credentials=q.credentials,b.headers||(this.headers=new J(q.headers)),this.method=q.method,this.mode=q.mode,T||null==q._bodyInit||(T=q._bodyInit,q.bodyUsed=!0)}else this.url=String(q);if(this.credentials=b.credentials||this.credentials||"omit",!b.headers&&this.headers||(this.headers=new J(b.headers)),this.method=function(q){var b=q.toUpperCase();return c.indexOf(b)>-1?b:q}(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&T)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(T)}function n(q){var b=new FormData;return q.trim().split("&").forEach(function(T){if(T){var Z=T.split("="),le=Z.shift().replace(/\+/g," "),x=Z.join("=").replace(/\+/g," ");b.append(decodeURIComponent(le),decodeURIComponent(x))}}),b}function y(q){var b=new J;return q.split(/\r?\n/).forEach(function(T){var Z=T.split(":"),le=Z.shift().trim();if(le){var x=Z.join(":").trim();b.append(le,x)}}),b}function R(q,b){b||(b={}),this.type="default",this.status="status"in b?b.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new J(b.headers),this.url=b.url||"",this._initBody(q)}if(!nt.fetch){var m={searchParams:"URLSearchParams"in nt,iterable:"Symbol"in nt&&"iterator"in Symbol,blob:"FileReader"in nt&&"Blob"in nt&&function(){try{return new Blob,!0}catch(q){return!1}}(),formData:"FormData"in nt,arrayBuffer:"ArrayBuffer"in nt};if(m.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=function(q){return q&&DataView.prototype.isPrototypeOf(q)},I=ArrayBuffer.isView||function(q){return q&&u.indexOf(Object.prototype.toString.call(q))>-1};J.prototype.append=function(q,b){q=Lt(q),b=Ze(b);var T=this.map[q];this.map[q]=T?T+","+b:b},J.prototype.delete=function(q){delete this.map[Lt(q)]},J.prototype.get=function(q){return q=Lt(q),this.has(q)?this.map[q]:null},J.prototype.has=function(q){return this.map.hasOwnProperty(Lt(q))},J.prototype.set=function(q,b){this.map[Lt(q)]=Ze(b)},J.prototype.forEach=function(q,b){for(var T in this.map)this.map.hasOwnProperty(T)&&q.call(b,this.map[T],T,this)},J.prototype.keys=function(){var q=[];return this.forEach(function(b,T){q.push(T)}),V(q)},J.prototype.values=function(){var q=[];return this.forEach(function(b){q.push(b)}),V(q)},J.prototype.entries=function(){var q=[];return this.forEach(function(b,T){q.push([T,b])}),V(q)},m.iterable&&(J.prototype[Symbol.iterator]=J.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},M.call(S.prototype),M.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new J(this.headers),url:this.url})},R.error=function(){var q=new R(null,{status:0,statusText:""});return q.type="error",q};var j=[301,302,303,307,308];R.redirect=function(q,b){if(-1===j.indexOf(b))throw new RangeError("Invalid status code");return new R(null,{status:b,headers:{location:q}})},nt.Headers=J,nt.Request=S,nt.Response=R,nt.fetch=function(q,b){return new Promise(function(T,Z){var le=new S(q,b),x=new XMLHttpRequest;x.onload=function(){var Se={status:x.status,statusText:x.statusText,headers:y(x.getAllResponseHeaders()||"")};Se.url="responseURL"in x?x.responseURL:Se.headers.get("X-Request-URL"),T(new R("response"in x?x.response:x.responseText,Se))},x.onerror=function(){Z(new TypeError("Network request failed"))},x.ontimeout=function(){Z(new TypeError("Network request failed"))},x.open(le.method,le.url,!0),"include"===le.credentials&&(x.withCredentials=!0),"responseType"in x&&m.blob&&(x.responseType="blob"),le.headers.forEach(function(Se,Ee){x.setRequestHeader(Ee,Se)}),x.send(void 0===le._bodyInit?null:le._bodyInit)})},nt.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);var loadjs={};loadjs=function(){function Lt(M,C){if(M){var S=P[M];if(h[M]=C,S)for(;S.length;)S[0](M,C),S.splice(0,1)}}function Ze(M,C){M.call&&(M={success:M}),C.length?(M.error||i)(C):(M.success||i)(M)}function V(M,C,S,n){var y,R,m=document,u=S.async,f=(S.numRetries||0)+1,I=S.before||i,c=M.replace(/^(css|img)!/,""),j=S.reqdelay||0;n=n||0,/(^css!|\.css$)/.test(M)?(y=!0,(R=m.createElement("link")).rel="stylesheet",R.href=c):/(^img!|\.(png|gif|jpg|svg)$)/.test(M)?(R=m.createElement("img")).src=c:((R=m.createElement("script")).src=M,R.async=void 0===u||u),R.onload=R.onerror=R.onbeforeload=function(q){var b=q.type[0];if(y&&"hideFocus"in R)try{R.sheet.cssText.length||(b="e")}catch(T){b="e"}if("e"==b&&(n+=1)<f)return w=j*n,setTimeout(function(){V(M,C,S,n)},w),void(S.retrycb&&S.retrycb(n,w));C(M,b,q.defaultPrevented)},!1!==I(M,R)&&m.head.appendChild(R)}function e(M,C,S){var n,y;C&&C.trim&&(n=C),function(M,C,S){var n,y,R=(M=M.push?M:[M]).length,m=R,u=[];for(n=function(f,I,c){if("e"==I&&u.push(f),"b"==I){if(!c)return;u.push(f)}--R||C(u)},y=0;y<m;y++)V(M[y],n,S)}(M,function(R){Ze(y,R),Lt(n,R)},y=(n?S:C)||{})}var i=function(){},d={},h={},P={},w=0;return e.ready=function(M,C){return function(M,C){var S,n,y,R=[],m=(M=M.push?M:[M]).length,u=m;for(S=function(f,I){I.length&&R.push(f),--u||C(R)};m--;)(y=h[n=M[m]])?S(n,y):(P[n]=P[n]||[]).push(S)}(M,function(S){Ze(C,S)}),e},e.done=function(M){Lt(M,[])},e.reset=function(){d={},h={},P={}},e.isDefined=function(M){return M in d},e}(),function(nt,Lt){"use strict";var Ze={load:function(V,J,e){if("function"==typeof define&&define.amd&&"undefined"!=typeof requirejs){var i=[],d=V+"://"+J.ccsServer+"/socket.io/v3/socket.io.js";i.push("sio"),requirejs.config({shim:{sio:{exports:"io"}},wrap:!1,paths:{sio:d}}),requirejs(i,function(w){nt.rtcio=w,e.success()})}else if(void 0!==typeof loadjs&&"undefined"==typeof apiRTC_React){loadjs(void 0!==J.socketioUrl?[J.socketioUrl]:[V+"://"+J.ccsServer+"/socket.io/v3/socket.io.js"],"socketio",{async:!0,numRetries:J.extJsLoadingRetryNb||100,reqdelay:J.extJsLoadingRetryDelay||200,success:function(){nt.rtcio=io,e.success()},error:function(w){console.error("socket.io loading error"),e.error()},retrycb:function(w,M){console.warn("socket.io loading retry :"+w+" ,delay before retry :"+M),e.retrycb()}})}else console.log("Else loadjs io"),nt.rtcio=io,e.success()}};nt.apiRTC_sioLoader=Ze}(window),function(nt,Lt){if("object"==typeof exports&&"object"==typeof module)module.exports=Lt();else if("function"==typeof define&&define.amd)define([],Lt);else{var Ze=Lt();for(var V in Ze)("object"==typeof exports?exports:nt)[V]=Ze[V]}}(self,function(){return(()=>{var nt={8364:(V,J,e)=>{"use strict";var i=e(2043),d=e(7987),h=i.getLogger("CloudAPI");d.reg(i),d.apply(h,{format:function(R,m,u){return u+" - ["+R+"] "+m+" : "}}),h.setDefaultLevel("error"),h.setLevel("error");var P="/api/v2/media/upload",w="/api/v2/conversation/{convId}/media",M="/api/v2/conferences",C={updateWebconfTags:{fetchRetryCount:3,fetchRetryDelay:500}},S=null,n=function(){function R(){if(this.cloudUrl="https://cloud.apizee.com",this.fetchRetries=100,this.fetchRetryDelay=200,null!==S)return h.debug("Cannot construct multiple CloudAPI, this is a singleton."),S;S=this}return R.get=function(){return S=null===S?new R:S},R.prototype.setLogLevel=function(m){h.setLevel(m)},R.prototype.getLogLevel=function(){var m="";switch(h.getLevel()){case 0:m="trace";break;case 1:m="debug";break;case 2:m="info";break;case 3:m="warn";break;case 4:m="error";break;case 5:m="silent"}return m},R.prototype.setCloudURL=function(m){h.debug("setCloudURL :",m),this.cloudUrl=m},R.prototype.setFetchRetries=function(m){h.debug("setFetchRetries :",m),null!=m&&(this.fetchRetries=m)},R.prototype.setFetchRetryDelay=function(m){h.log("setFetchRetryDelay :",m),null!=m&&(this.fetchRetryDelay=m)},R.prototype.request=function(m,u,f,I,c){var j=-1===m.indexOf(this.cloudUrl)?this.cloudUrl+m:m,q=null;return new Promise(function(b,T){var Z,le=new XMLHttpRequest;if(le.onreadystatechange=function(ke){if(le.readyState===XMLHttpRequest.DONE)if(h.debug("request onreadystatechange status :",le.status),200<=le.status&&le.status<300){if(le.responseText){var Ne=null;try{Ne=JSON.parse(le.responseText)}catch(ze){Ne=le.responseText}b(Ne)}}else{if(Ne={status:le.status,text:le.statusText},le.responseText)try{Ne.response=JSON.parse(le.responseText)}catch(ze){Ne.responseText=le.responseText}T(Ne)}},le.onprogress=function(ke){"function"==typeof I&&I(ke)},le.onerror=function(ke){T(ke)},"GET"===f)0<Object.keys(u).length&&(Z=new URLSearchParams(u),h.debug("johann",Z,Z.toString,u),j+="?"+Z.toString());else{q=new FormData;for(var x=0,Se=Object.keys(u);x<Se.length;x++){var Ee=Se[x];q.append(Ee,u[Ee])}}if(le.open(f,j,!0),null!=c)for(var he=0,ue=Object.keys(c);he<ue.length;he++)le.setRequestHeader(Ee=ue[he],c[Ee]);le.send(q)})},R.prototype.get=function(m,u,f){return h.log("Send HTTP request : GET "+m),this.request(m,u,"GET",null,f)},R.prototype.post=function(m,u,f,I){return h.log("Send HTTP request : POST "+m),this.request(m,u,"POST",f,I)},R.prototype.put=function(m,u,f,I){return h.log("Send HTTP request : PUT "+m),(u=null===u||"object"!=typeof u?{}:u)._method="PUT",this.request(m,u,"POST",f,I)},R.prototype.delete=function(m,u,f){return h.log("Send HTTP request : DELETE "+m),(u=null===u||"object"!=typeof u?{}:u)._method="DELETE",this.request(m,u,"POST",null,f)},R.prototype.cloudRequest=function(m,u,f,I){var c=this;return void 0===I&&(I={}),new Promise(function(j,q){h.trace(f+" cloudRequest to "+S.cloudUrl,u);var b={method:f.toUpperCase()},T=S.cloudUrl+m;if("GET"===b.method)0<Object.keys(u).length&&(T+="?"+new URLSearchParams(u).toString());else{for(var Z=new FormData,le=0,x=Object.keys(u);le<x.length;le++){var Se=x[le];Z.append(Se,u[Se])}b.body=Z}I.hasOwnProperty("bearerToken")&&(b.headers={Authorization:"Bearer "+I.bearerToken}),b.retries=I.hasOwnProperty("fetchRetryCount")?I.fetchRetryCount:c.fetchRetries,b.retryDelay=I.hasOwnProperty("fetchRetryDelay")?I.fetchRetryDelay:c.fetchRetryDelay,function(Ee,he){h.log("fetchRetry");var ue=3,ke=1e3,Ne=[];if(he&&he.retries&&(ue=he.retries),he&&he.retryDelay&&(ke=he.retryDelay),he&&he.retryOn){if(!(he.retryOn instanceof Array))throw{name:"ArgumentError",message:"retryOn property expects an array"};Ne=he.retryOn}return new Promise(function(ze,Ve){function et(gt){var mt,ot;h.log("wrappedFetch n:",gt),void 0!==window.fetch?fetch(Ee,he).then(function(at){-1===Ne.indexOf(at.status)?ze(at):0<gt?_e(gt):Ve(at)}).catch(function(at){0<gt?_e(gt):Ve(at)}):(h.debug("Cannot use fetch in this browser, using XHR"),mt=n.get(),ot={},he.body&&he.body.forEach(function(at,yt){return ot[yt]=at}),mt.request(Ee,ot,he.method,null,he.headers).then(function(at){ze({gettype:"cloudApiNoFetch",response:at})}).catch(function(at){h.error("error :",at),Ve(at)}))}function _e(gt){h.error("retry n:",gt);var mt=ue-gt+1;h.error("retry number is :",mt),setTimeout(function(){et(--gt)},ke*mt)}et(ue)})}(T,b).then(function(Ee){var he=null;if(Ee.status<200||299<Ee.status){var ue="cloudRequest - response status Code: "+Ee.status;return h.warn(ue),q(y(13,ue,h,{httpCode:Ee.status}))}return"cloudApiNoFetch"===Ee.gettype?Ee.response:(he=Ee.headers?Ee.headers.get("content-type"):he)&&-1!==he.indexOf("application/json")?Ee.json():q(y(3,"cloudRequest - response is not JSON",h))}).then(j).catch(function(Ee){h.error("err :",Ee),q(y(2,"cloudRequest - Fetch Error",h))})})},R.prototype.authentication=function(m,u){return h.debug("authentication to "+S.cloudUrl),this.cloudRequest("/api/v2/authenticate",{username:m,password:u},"POST")},R.prototype.getConnectedUserInformation=function(m){return h.debug("getConnectedUserInformation to "+S.cloudUrl),this.cloudRequest("/api/v2/users/me",{token:m},"GET")},R.prototype.getUserProfile=function(m,u){return h.debug("getUserProfile to "+S.cloudUrl),"string"!=typeof m||"string"!=typeof u?Promise.reject("wrongArguments"):(m={apiKey:m},this.cloudRequest("/api/v2/users/{userId}/profile".replace("{userId}",u),m,"GET"))},R.prototype.getSiteAgents=function(m,u,f){return void 0===f&&(f={}),h.debug("getSiteAgents to "+S.cloudUrl),"string"!=typeof m||"string"!=typeof u?Promise.reject("wrongArguments"):(m={apiKey:m},f.useAcd&&(m.useAcd=1),f.usePresence&&(m.usePresence=1),f.convId&&(m.convId=f.convId),this.cloudRequest("/api/v2/sites/{siteKey}/agents".replace("{siteKey}",u),m,"GET"))},R.prototype.getEnterpriseInformation=function(m){return void 0===m&&(m={}),h.debug("getEnterpriseInformation to "+S.cloudUrl),this.cloudRequest("/api/v2/enterpriseInformation",m,"GET")},R.prototype.getPreferredCCS=function(m){return h.debug("getPreferredCCS to "+S.cloudUrl),this.cloudRequest("/api/v2/preferredCCS",{apiKey:m},"GET")},R.prototype.checkUserToken=function(m){return h.debug("checkUserToken to "+S.cloudUrl),this.cloudRequest("/api/v2/checkToken",{token:m},"GET")},R.prototype.invalidateUserToken=function(m){return h.debug("invalidateUserToken to "+S.cloudUrl),this.cloudRequest("/api/v2/invalidateToken",{token:m},"POST")},R.prototype.uploadFile=function(m,u,f){h.debug("uploadMedia to "+S.cloudUrl);var I={token:u,file:m};if(null!=f)for(var c=0,j=Object.keys(f);c<j.length;c++){var q=j[c];I[q]=f[q]}return this.cloudRequest(P,I,"POST")},R.prototype.uploadSnapshot=function(m,u,f){void 0===f&&(f={}),h.debug("uploadSnapshot to "+S.cloudUrl);for(var I={token:u,dataUri:1,file:m},c=0,j=Object.keys(f);c<j.length;c++){var q=j[c];I[q]=f[q]}return this.cloudRequest(P,I,"POST")},R.prototype.getUserPhotoUrl=function(m){return S.cloudUrl+"/profile/getImage?userId="+m},R.prototype.getEnterpriseUserList=function(m,u){return h.debug("getEnterpriseUserList to "+S.cloudUrl),this.cloudRequest("/api/v2/enterprises/{enterpriseId}/users".replace("{enterpriseId}",m),{token:u,json:!0},"GET")},R.prototype.getEnterpriseTagList=function(m,u,f){return void 0===f&&(f={}),h.debug("getEnterpriseTagList to "+S.cloudUrl),u={token:u},f.hasOwnProperty("webconfId")&&(u.conferenceId=f.webconfId),this.cloudRequest("/api/v2/enterprises/{enterpriseId}/tags".replace("{enterpriseId}",m),u,"GET")},R.prototype.updateWebconfTags=function(m,u,f,I){return h.debug("updateWebconfTags to "+S.cloudUrl),f={_method:"PUT",tags:f.join(",")},function(c,j){if(null!==c&&"object"==typeof c||(c={}),C.hasOwnProperty(j))for(var q=C[j],b=0,T=["fetchRetryCount","fetchRetryDelay"];b<T.length;b++){var Z=T[b];q.hasOwnProperty(Z)&&(c[Z]=q[Z])}}(I={bearerToken:I},"updateWebconfTags"),this.cloudRequest("/api/enterprises/{enterpriseId}/conferences/{conferenceId}".replace("{enterpriseId}",m).replace("{conferenceId}",u),f,"POST",I)},R.prototype.getConferenceList=function(m){return h.debug("getConferenceList to "+S.cloudUrl),this.cloudRequest(M,{token:m},"GET")},R.prototype.getOrCreateConversation=function(m,u,f){return void 0===f&&(f={}),h.debug("getOrCreateConversation to "+S.cloudUrl),null===m||"object"!=typeof m||"string"!=typeof u?Promise.reject("wrongArguments"):(u={name:m._getTechnicalName(),type:m.getType(),apiKey:u},f.hasOwnProperty("token")&&f.token&&(u.token=f.token),f.hasOwnProperty("active")&&"boolean"==typeof f.active&&(u.active=1),this.cloudRequest("/api/v2/conversation",u,"POST"))},R.prototype.createConference=function(m,u,f){return void 0===f&&(f={}),h.debug("createConference to "+S.cloudUrl),u={token:m,name:u},f.hasOwnProperty("password")&&(u.password=f.password),this.cloudRequest(M,u,"POST")},R.prototype.checkConferenceAccess=function(m,u,f){return void 0===f&&(f={}),h.debug("checkConferenceAccess for "+m+" to "+S.cloudUrl),"string"!=typeof u?Promise.reject("wrongArguments"):(u={apiKey:u},f.convId&&(u.conv_id=f.convId),f.hasOwnProperty("password")&&(u.password=f.password),f.hasOwnProperty("session")&&"function"==typeof f.session.getToken&&null!==f.session.getToken()&&(u.token=f.session.getToken()),this.cloudRequest("/api/v2/conferences/{roomname}/checkAccess".replace("{roomname}",m),u,"POST"))},R.prototype.getWebconf=function(m,u){void 0===u&&(u={}),h.debug("getWebconf for "+m+" to "+S.cloudUrl);var f={};return u.hasOwnProperty("token")&&u.token&&(f.bearerToken=u.token),this.cloudRequest("/api/v2/conferences/{roomname}".replace("{roomname}",m),{},"GET",f)},R.prototype.getWebconfConversation=function(m,u,f){if(void 0===f&&(f={}),h.debug("getWebconfConversation for "+m+" to "+S.cloudUrl),"string"!=typeof u)return Promise.reject("wrongArguments");var I={};return I.apiKey=u,f.hasOwnProperty("token")&&f.token&&(I.token=f.token),this.cloudRequest("/api/v2/conferences/{roomname}/conversation".replace("{roomname}",m),I,"GET")},R.prototype.updateConferencePresence=function(m,u,f){return h.trace("updateConferencePresence for "+m.getName()+" to "+S.cloudUrl),f={ccid:u.getId(),name:u.getUserAgent().getUsername(),instanceId:m.getInstanceId(),apiKey:f},null!==u.getToken()&&(f.token=u.getToken()),this.cloudRequest("/api/v2/conferences/{roomname}/updatePresence".replace("{roomname}",m._getTechnicalName()),f,"POST")},R.prototype.closeConferenceInstance=function(m,u){return h.debug("closeConferenceInstance for "+m.getName()+" to "+S.cloudUrl),u={token:u.getToken(),instanceId:m.getInstanceId()},this.cloudRequest("/api/v2/conferences/{roomname}/closeInstance".replace("{roomname}",m._getTechnicalName()),u,"POST")},R.prototype.getConversationMediaList=function(m,u,f){return void 0===f&&(f={}),h.debug("getConversationMediaList for "+m+" to "+S.cloudUrl),m&&"string"==typeof u?(u={apiKey:u},f.hasOwnProperty("token")&&f.token&&(u.token=f.token),f.hasOwnProperty("offset")&&(u.offset=f.offset),f.hasOwnProperty("limit")&&(u.limit=f.limit),this.cloudRequest(w.replace("{convId}",m.toString()),u,"GET")):Promise.reject("wrongArguments")},R.prototype.pushConversationMedia=function(m,u,f,I){return void 0===I&&(I={}),h.debug("pushConversationMedia for "+m+" to "+S.cloudUrl),m&&u&&"string"==typeof f?(f={media:u,apiKey:f},I.hasOwnProperty("token")&&I.token&&(f.token=I.token),I.hasOwnProperty("metadata")&&I.metadata&&(f.metadata=I.metadata),I.hasOwnProperty("asFile")&&I.asFile&&(f.asFile=I.asFile),I.hasOwnProperty("filename")&&I.filename&&(f.filename=I.filename),!0===I.overwrite&&(f.overwrite=1),"number"==typeof I.ttl&&0<I.ttl&&(f.ttl=I.ttl),this.cloudRequest(w.replace("{convId}",m.toString()),f,"POST")):Promise.reject("wrongArguments")},R.prototype.setConversationData=function(m,u,f,I){return void 0===I&&(I={}),h.debug("setConversationData for "+m+" to "+S.cloudUrl),m&&"string"==typeof u&&"string"==typeof f?(f={data:u,apiKey:f},I.hasOwnProperty("token")&&I.token&&(f.token=I.token),this.cloudRequest("/api/v2/conversation/{convId}/data".replace("{convId}",m.toString()),f,"POST")):Promise.reject("wrongArguments")},R.prototype.getSessionHistory=function(m,u,f){void 0===f&&(f={}),h.debug("getSessionHistory to "+S.cloudUrl);var I={token:u,sessionId:m};if(null!=f)for(var c=0,j=Object.keys(f);c<j.length;c++){var q=j[c];I[q]=f[q]}return this.cloudRequest("/api/v2/messages",I,"GET")},R.prototype.getWebSession=function(m,u,f){return h.debug("getSessionHistory to "+S.cloudUrl),"string"!=typeof f?Promise.reject("wrongArguments"):(f={destId:u.getId(),apiKey:f},null!==m.getToken()?f.token=m.getToken():f.userId=m.getId(),this.cloudRequest("/api/v2/webSession",f,"GET"))},R.prototype.saveNewMessage=function(m,u,f,I,c,j){return h.debug("saveNewMessage to "+S.cloudUrl),m={uuid:c,destId:f,message:I,sessionId:m},null!==u.getToken()?m.token=u.getToken():(m.userId=u.getId(),m.apiKey=j),this.cloudRequest("/api/v2/messages",m,"POST")},R.prototype.saveGroupChatMessage=function(m,u,f,I,c,j){return void 0===j&&(j={}),h.debug("saveGroupChatMessage to "+S.cloudUrl),c={apiKey:f,message:I,ccid:u.getId(),name:u.getUserAgent().getUsername(),parent_conv_id:m.getCloudConversationId(),uuid:c,htmlEnable:j.metadata&&j.metadata.htmlEnable||!1},j={},null!==u.getToken()?j.bearerToken=u.getToken():c.userId=u.getId(),this.cloudRequest("/api/v2/groupChatMessages",c,"POST",j)},R.prototype.loadGroupChatMessages=function(m,u,f){void 0===f&&(f=""),h.debug("loadGroupChatMessages to "+S.cloudUrl);var I={parent_conv_id:m.getCloudConversationId()};return(m={}).bearerToken=""!==f?f:u.getToken(),this.cloudRequest("/api/v2/groupChatMessages",I,"GET",m)},R}();function y(R,m,u,f){return void 0===f&&(f={}),u&&u.error(m),m={code:R,error:m instanceof String?new Error(m):m instanceof Error?m:new Error(String(m))},f.hasOwnProperty("httpCode")&&(m.httpCode=f.httpCode),m}J.Z=n},1254:(V,J,e)=>{"use strict";e.d(J,{W:()=>d});var i=e(1549).Y.get("ApiCCCoBrowsingClient"),d=function(h){i.debug("apiCC.ApiCCCoBrowsingClient"),this.createRoom=function(){i.debug("createRoom()"),h.roomMgr.createRoom("coBrowsing")},this.inviteInRoom=function(P,w){i.debug("inviteInRoom()"),h.roomMgr.inviteInRoom(P,w,"coBrowsing")},this.answerToRoomInvitation=function(P,w){i.debug("answerToRoomInvitation()"),h.roomMgr.answerToRoomInvitation(P,w,"coBrowsing")},this.leaveRoom=function(P){i.debug("leaveRoom()"),h.roomMgr.leaveRoom(P,"coBrowsing")}}},128:(V,J,e)=>{"use strict";e.d(J,{_:()=>h}),e(2564);var i=e(1549).Y.get("ApiCCDataClient"),d=apiCC.myWebRTC_Event,h=function(P){this.sendData=function(w,M,C){i.info("Call sending data function .... to :"+w+" message :"+M);var n,y=P.channel.getNewCSeq(),R=null;return n=JSON.stringify({type:"dataMessage",senderId:P.apiCCId,dstRoomId:w,data:M,cSeq:y}),i.log("C->S: "+n),void 0!==C?(i.log("Ack management activated"),R=setTimeout(function(){C({reason:"timeoutReached",cSeq:y}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[y]},P.messageTimeOutTimer),i.log("timeOutId: "+R),P.messageTimeOutTable[y]=R,P.channel.socket.emit("dataMessage",n,function(m){i.log("callback on dataMessage"),i.log("callback reason :"+m.reason),i.log("cSeq :"+m.cSeq),C(m),void 0!==apiCC.session.messageTimeOutTable[y]?(i.log("clearing timeOutId: "+apiCC.session.messageTimeOutTable[y]),clearTimeout(apiCC.session.messageTimeOutTable[y]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[y]):i.warn("messageTimeOutTable was already deleted : timeout may have been reached before Ack")})):(i.log("Ack management not activated"),P.channel.socket.emit("dataMessage",n)),y},this.sendDataToGroup=function(w,M){i.info("[ApiCCDataClient] sendDataToGroup - "+w);var C,S=P.getConnectedUsersList(w);for(C=0;C<S.length;C++)P.apiCCId!=S[C].userId&&this.sendData(S[C].userId,M)},this.receiveData=function(w){i.info("receiveData :"+w.data),d.createReceiveDataEvent(w.senderId,w.dstRoomId,w.data)}}},6844:(V,J,e)=>{"use strict";e.d(J,{U:()=>M}),e(9554),e(4747),e(2564),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(1549),d=e(4708),h=e(940);function P(C){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(S){return typeof S}:function(S){return S&&"function"==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(C)}var w=i.Y.get("ApiCCIMClient"),M=function(C,S){this.convTable=[],this.myWebRTC_Event=apiCC.myWebRTC_Event,this.nickname=C.nickname,this.photoURL=null,this.userDataSetted=!1,this.myWebRTC_Stack=new h.S(C.channel.socket),this.findIMIdWithDestID=function(n){var y,R=this.convTable.length;for(w.log("findIMIdWithDestID = "+n),y=0;y<R;y+=1)if(w.log("this.convTable[i].dest_roomId = "+this.convTable[y].dest_roomId),this.convTable[y].dest_roomId==n)return this.convTable[y].IMId;return w.log("Conversation IMId not found"),0},this.addInConvTable=function(n){w.debug("addInConvTable");var y,R=this.convTable.length;for(y=0;y<R;y+=1)if(w.log("this.convTable[i].dest_roomId = "+this.convTable[y].dest_roomId),this.convTable[y].dest_roomId==n.dest_roomId)return void(this.convTable[y].IMId=n.IMId);w.log("Conversation not found in the table, adding .."),this.convTable.push(n)},this.sendMessage=function(n,y,R,m){w.info("Call sending message function .... from :"+this.nickname+" message :"+y);var u,f=this.findIMIdWithDestID(n),I=null,c=null,j=null,q=C.channel.getNewCSeq();return w.log(0===f?"Creation of a new IM conversation":"Message is for existing conversation with ID : "+f),w.log("IMConvId :"+f),I={type:"IMMessage",IMId:f,senderId:C.apiCCId,nickname:this.nickname,photoURL:this.photoURL,dstRoomId:n,data:y,cSeq:q,convData:m},C.getConnectedUserIdsList().forEach(function(b){b.userId==n&&b.hasOwnProperty("userData")&&null!==b.userData&&P(b.userData.hasOwnProperty("isChatbot"))&&b.userData.isChatbot&&(I.pubSub="BotConnector")}),u=JSON.stringify(I),c=document.createElement("message"),w.log("C->S: "+u),void 0!==R?(w.log("Ack management activated"),j=setTimeout(function(){R({reason:"timeoutReached",cSeq:q}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[q]},C.messageTimeOutTimer),w.log("timeOutId: "+j),C.messageTimeOutTable[q]=j,C.channel.socket.emit("IMMessage",u,function(b){w.log("callback on IMMessage"),w.log("data :",b),w.log("callback reason :"+b.reason),w.log("callback convId :"+b.convId),w.log("cSeq :"+b.cSeq),R(b),void 0!==apiCC.session.messageTimeOutTable[q]?(w.log("clearing timeOutId: "+apiCC.session.messageTimeOutTable[q]),clearTimeout(apiCC.session.messageTimeOutTable[q]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[q]):w.warn("messageTimeOutTable was already deleted : timeout may have been reached before Ack")})):(w.log("Ack management not activated"),C.channel.socket.emit("IMMessage",u)),null!==this.conversation&&(c.innerHTML="<b>me :</b> "+m+"<br>",this.conversation.appendChild(c),this.conversation.scrollTop=this.conversation.scrollHeight),q},this.newConversationCreated=function(n){w.debug("newConversationCreated :"+n),w.log("msg.dstRoomId :"+n.dstRoomId),w.log("msg.IMId :"+n.IMId),this.addInConvTable({dest_roomId:n.dstRoomId,IMId:n.IMId})},this.receiveMessage=function(n){w.info("Call receiveMessage message :"+n);var R=null;this.addInConvTable({dest_roomId:n.senderId,IMId:n.IMId}),null!==this.conversation&&((R=document.createElement("message")).innerHTML="<b>"+n.nickname+":</b> "+n.data+"<br>",this.conversation.appendChild(R),this.conversation.scrollTop=this.conversation.scrollHeight),this.myWebRTC_Event.createReceiveIMMessageEvent(n.senderId,n.nickname,n.photoURL,n.data,n.UUCSeq,n.IMId)},this.createGroupChat=function(n,y){var m;w.info("createGroupChat with contacts : "+n+","+y),m=JSON.stringify({type:"createGroupChat",nickname:this.nickname,photoURL:this.photoURL,contactId1:n,contactId2:y}),w.log("C->S: "+m),C.channel.socket.emit("createGroupChat",m)},this.groupChatCreation=function(n){w.debug("groupChatCreation"),this.myWebRTC_Event.createGroupChatCreationEvent(n.status,n.groupChatId,n.contactId1,n.invitationSendedToInitialDestId,n.contactId2,n.invitationSendedToNewContactId)},this.joinGroupChat=function(n){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w.debug("joinGroupChat : "+n);var R=null,m=null;R={type:"joinGroupChat",groupChatId:n},y.convId&&(R.data={},R.data.cloudConvId=y.convId),m=JSON.stringify(R),w.log("C->S: "+m),C.channel.socket.emit("joinGroupChat",m)},this.groupChatInvitation=function(n){w.debug("groupChatInvitation"),this.myWebRTC_Event.createGroupChatInvitationEvent(n.groupChatId,n.senderId,n.senderNickname,n.senderPhotoURL,n.contactList)},this.answerToGroupChatInvitation=function(n,y){var m;w.debug("answerToGroupChatInvitation: "+n+" : "+y),!0===y||!1===y?(m=JSON.stringify({type:"groupChatInvitationAnswer",groupChatId:n,senderId:C.apiCCId,nickname:this.nickname,photoURL:this.photoURL,accept:y}),w.log("C->S: "+m),C.channel.socket.emit("groupChatInvitationAnswer",m)):w.log("accept value is not correct")},this.groupChatMemberUpdate=function(n){w.info("groupChatMemberUpdate"),this.myWebRTC_Event.createGroupChatMemberUpdateEvent(n.groupChatId,n.contactList,n.status)},this.addUserInGroupChat=function(n,y){var m;w.debug("addUser : "+y+"in Group Chat with Id :"+n),m=JSON.stringify({type:"addUserInGroupChat",groupChatId:n,nickname:this.nickname,photoURL:this.photoURL,contactId:y}),w.log("C->S: "+m),C.channel.socket.emit("addUserInGroupChat",m)},this.addUserInGroupChatAnswer=function(n){w.info("addUserInGroupChatAnswer"),this.myWebRTC_Event.createAddUserInGroupChatEvent(n.invitationSended,n.groupChatId,n.contactId)},this.leaveGroupChat=function(n){var R;w.info("Leave Group Chat with Id :"+n),R=JSON.stringify({type:"leaveGroupChat",groupChatId:n,nickname:this.nickname,photoURL:this.photoURL}),w.log("C->S: "+R),C.channel.socket.emit("leaveGroupChat",R)},this.sendMessageToGroupChat=function(n,y,R){var m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};w.info("Call sending message to Group Chat .... from :"+this.nickname+" message :"+y);var u=null,f=null,I=apiCC.session.channel.getNewCSeq();u={type:"groupChatMessage",groupChatId:n,senderId:C.apiCCId,nickname:this.nickname,cSeq:I,data:y},(0,d.Ym)(m,"metadata","object")&&(u.metadata=m.metadata),f=JSON.stringify(u),null!==R&&"function"==typeof R?(apiCC.session.messageTimeOutTable[I]=setTimeout(function(){R({reason:"timeoutReached",cSeq:I}),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[I]},apiCC.session.messageTimeOutTimer),w.log("C->S: "+f),C.channel.socket.emit("groupChatMessage",f,function(c){clearTimeout(apiCC.session.messageTimeOutTable[c.cSeq]),null!==apiCC.session&&void 0!==apiCC.session&&delete apiCC.session.messageTimeOutTable[c.cSeq],R(c)})):(w.log("C->S: "+f),C.channel.socket.emit("groupChatMessage",f))},this.receiveGroupChatMessage=function(n){w.info("receiveGroupChatMessage"),this.myWebRTC_Event.createReceiveGroupChatMessageEvent(n.groupChatId,n.senderId,n.nickname,n.data,n.metadata)},this.getConversationHistory=function(n){var R;w.debug("getConversationHistory"),R=JSON.stringify({type:"getConversationHistory",convId:n}),w.log("C->S: "+R),C.channel.socket.emit("getConversationHistory",R)},this.receiveConversationHistory=function(n){w.debug("receiveConversationHistory"),w.log("msg.convId :"+n.convId);var y,R=0,m=[],u=null;if(null!==n.convHistory)for(w.log("msg.convHistory.length :"+n.convHistory.length),R=n.convHistory.length,m=[],y=0;y<R;y+=1)u=JSON.parse(n.convHistory[y]),m.push(u);this.myWebRTC_Event.createReceiveConversationHistoryEvent(n.convId,m,n.status)},this.setUserData=function(n){var R;w.info("setUserData"),this.photoURL=n.photoURL,C.photoURL=n.photoURL,w.log("photoURL :"+this.photoURL),R=JSON.stringify({type:"setUserData",nickname:this.nickname,photoURL:this.photoURL}),w.log("C->S: "+R),C.channel.socket.emit("setUserData",R),this.userDataSetted=!0},this.getUserData=function(n){var R;w.info("getUserData"),R=JSON.stringify({type:"getUserData",contactId:n}),w.log("C->S: "+R),C.channel.socket.emit("getUserData",R)},this.receiveUserDataAnswer=function(n){w.info("receiveUserDataAnswer"),this.myWebRTC_Event.createUserDataAnswerEvent(n.userFound,n.contactId,n.nickname,n.photoURL)},this.receiveFetchUserDataAnswer=function(n){w.info("receiveFetchUserDataAnswer"),this.myWebRTC_Event.createFetchUserDataAnswerEvent(n)},this.initialize=function(n){var R;this.conversation=document.getElementById(n),null===this.conversation&&(w.log("conversationElementId Div Name is not correct : INCORRECT_DIV_NAME_CONVERSATION"),w.log("conversationElementId is null")),R=JSON.stringify({type:"registerIM",username:this.nickname}),w.log("C->S: "+R),C.channel.socket.emit("registerIM",R)},this.initialize(S)}},9213:(V,J,e)=>{"use strict";e.d(J,{X:()=>P}),e(2564),e(2526),e(1817),e(1539);var i=e(1549),d=e(4708),h=i.Y.get("ApiCCPointerSharingClient"),P=function w(M){this.roomTable={},this.getRoomIds=function(){var C=[],S=null;for(S in this.roomTable)C.push(S);return C},this.roomExists=function(C){return this.roomTable.hasOwnProperty(C)},this.roomActive=function(C){return this.roomTable.hasOwnProperty(C)&&this.roomTable[C].state===w.STATE_ACTIVE},this.joinRoom=function(C,S){var n=this;h.info("ApiCCPointerSharingClient::joinRoom()"),(0,d.Ym)(S,"object")||(S={}),(0,d.ki)(S,"success","function")||(S.success=function(){}),(0,d.ki)(S,"failure","function")||(S.failure=function(){}),this.roomTable.hasOwnProperty(C)?S.failure("room already joined",C):(this.roomTable[C]={roomId:C,state:w.STATE_JOINING,joinRoomCallbacks:S},this.roomTable[C].joinRoomTimeoutId=setTimeout(function(){delete n.roomTable[C],S.failure("timeout",C)},15e3),apiCC.session.roomMgr.joinRoom(C,"pointerSharing"))},this.leaveRoom=function(C){this.roomTable.hasOwnProperty(C)&&delete this.roomTable[C],apiCC.session.roomMgr.leaveRoom(C,"pointerSharing")},this.inviteInRoom=function(C,S,n){h.info("ApiCCPointerSharingClient::inviteInRoom()"),apiCC.session.roomMgr.inviteInRoom(C,S,"pointerSharing",n)},this.sendPointerLocation=function(C,S,n,y,R){var m;return!(!this.roomTable.hasOwnProperty(C)||this.roomTable[C].state!==w.STATE_ACTIVE||(m={type:"pointerLocation",source:S,x:n,y},(0,d.Ym)(R,"object")&&(m.data=R),apiCC.session.roomMgr.sendMessageToRoom(C,"pointerSharing",m),0))},this.processMessageRoomJoin=function(C){this.roomTable.hasOwnProperty(C.roomId)&&this.roomTable[C.roomId].state===w.STATE_JOINING&&(clearTimeout(this.roomTable[C.roomId].joinRoomTimeoutId),delete this.roomTable[C.roomId].joinRoomTimeoutId,this.roomTable[C.roomId].state=w.STATE_ACTIVE,this.roomTable[C.roomId].joinRoomCallbacks.success(C.roomId),delete this.roomTable[C.roomId].joinRoomCallbacks)},this.stop=function(){for(var C=this.getRoomIds(),S=C.length;--S>=0;)this.leaveRoom(C[S])}};P.STATE_IDLE=Symbol("idle"),P.STATE_JOINING=Symbol("joining"),P.STATE_ACTIVE=Symbol("active"),P.STATE_ERROR=Symbol("error")},3720:(V,J,e)=>{"use strict";e.d(J,{K:()=>f}),e(1058),e(8309),e(3710),e(1539),e(9714),e(2564),e(9554),e(4747),e(2772),e(561),e(6699),e(2479),e(2707),e(9601),e(2526),e(1817),e(2165),e(6992),e(8783),e(3948);var i=e(1549),d=i.Y.get("RoomManager"),h=function(I,c){d.debug("RoomManager"),this.myWebRTC_Event=apiCC.myWebRTC_Event,this.createRoom=function(j){var q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.info("RoomManager:createRoom with roomType : "+j);var b={type:"createRoom",roomType:j,nickname:I.nickname,photoURL:I.photoURL};q.convId&&(b.data||(b.data={}),b.data.cloudConvId=q.convId),!0===q.webconf&&(b.data||(b.data={}),b.data.webconf=!0);var T=JSON.stringify(b);d.log("C->S: "+T),I.channel.socket.emit("createRoom",T)},this.roomCreation=function(j){d.info("RoomManager:roomCreation"),this.myWebRTC_Event.createRoomCreationEvent(j.status,j.roomId,j.roomType),c(j)},this.roomJoin=function(j){d.info("RoomManager:roomJoin"),this.myWebRTC_Event.createRoomJoinedEvent(j.status,j.roomId,j.roomType),c(j)},this.inviteInRoom=function(j,q,b,T){var Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};d.info("RoomManager:inviteInRoom with roomType:",b);var le={type:"inviteInRoom",roomId:j,contactId:q,roomType:b,nickname:I.nickname,photoURL:I.photoURL,context:T};Z.convId&&(le.data||(le.data={}),le.data.cloudConvId=Z.convId),!0===Z.webconf&&(le.data||(le.data={}),le.data.webconf=!0);var x=JSON.stringify(le);d.log("C->S: "+x),I.channel.socket.emit("inviteInRoom",x)},this.inviteInRoomStatus=function(j){d.info("inviteInRoomStatus"),c(j)},this.roomInvitation=function(j){d.info("roomInvitation",j);var q={};j.data&&(j.data.cloudConvId&&(q.cloudConvId=j.data.cloudConvId),!0===j.data.webconf&&(q.webconf=!0)),this.myWebRTC_Event.createRoomInvitationEvent(j.roomId,j.senderId,j.senderNickname,j.senderPhotoURL,j.contactList,j.roomType,q),c(j)},this.requestContactListInRoom=function(j){d.info("requestContactListInRoom :"+j);var b=JSON.stringify({type:"requestContactListInRoom",roomId:j});I.channel.socket.emit("requestContactListInRoom",b)},this.onContactListInRoom=function(j){d.info("onContactListInRoom :"+j),this.myWebRTC_Event.createContactListInRoomEvent(j.roomId,j.contactList,j.roomType),c(j)},this.answerToRoomInvitation=function(j,q,b){if(d.info("answerToRoomInvitation:",j,q),!0===q||!1===q){var Z=JSON.stringify({type:"roomInvitationAnswer",roomId:j,senderId:I.apiCCId,nickname:I.nickname,photoURL:I.photoURL,accept:q,roomType:b});d.log("C->S: "+Z),I.channel.socket.emit("roomInvitationAnswer",Z)}else d.log("accept value is not correct")},this.roomMemberUpdate=function(j){d.info("roomMemberUpdate"),this.myWebRTC_Event.createRoomMemberUpdateEvent(j.roomId,j.contactList,j.status,j.roomType),c(j)},this.sendMessageToRoom=function(j,q,b){d.info("Call sending message to Room .... from :"+I.apiCCId+" message :"+b);var Z=JSON.stringify({type:"roomMessage",roomId:j,senderId:I.apiCCId,nickname:I.nickname,roomType:q,data:b});d.log("C->S: "+Z),I.channel.socket.emit("roomMessage",Z)},this.receiveRoomMessage=function(j){d.info("receiveRoomMessage"),this.myWebRTC_Event.createReceiveRoomMessageEvent(j.roomId,j.senderId,j.nickname,j.data,j.roomType),c(j)},this.joinRoom=function(j,q){var b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};d.info("Join Room with Id:",j);var T={type:"joinRoom",roomId:j,nickname:I.nickname,photoURL:I.photoURL,roomType:q};b.convId&&(T.data||(T.data={}),T.data.cloudConvId=b.convId),!0===b.webconf&&(T.data||(T.data={}),T.data.webconf=!0);var Z=JSON.stringify(T);d.log("C->S: "+Z),I.channel.socket.emit("joinRoom",Z)},this.leaveRoom=function(j,q){d.info("Leave Room with Id:",j);var T=JSON.stringify({type:"leaveRoom",roomId:j,nickname:I.nickname,photoURL:I.photoURL,roomType:q});d.log("C->S: "+T),I.channel.socket.emit("leaveRoom",T)}},P=(e(7042),e(1038),e(9753),e(8765)),w=e(5945);function M(I,c){(null==c||c>I.length)&&(c=I.length);for(var j=0,q=new Array(c);j<c;j++)q[j]=I[j];return q}var C=i.Y.get("ApiCC_Channel"),S=function(I){C.debug("ApiCC_Channel"),this.channelReady=!1,this.socket=null,this.channelId=I.apiCCId,this.callURLDestRoom=0,this.myWebRTC_Event=new P.K,this.channelHasBeenDisconnected=!1,this.cSeq=0,this.updatePresenceGroupIsNeeded=!1,this.oldPresenceGroup=null,this.newPresenceGroup=null,this.updateSubscribeToPresenceGroupIsNeeded=!1,this.oldSubscribeToPresenceGroup=null,this.newSubscribeToPresenceGroup=null,this.initialize=function(){C.info("ApiCC_Channel::initialize()"),this.openChannel()},this.getNewCSeq=function(){return this.cSeq=this.cSeq+1,this.cSeq},this.openChannel=function(){var c,j,q,b="",T=null,Z=null,le=null,x=null;C.debug("openChannel channelId :"+this.channelId),C.debug("session.apiKey :"+I.apiKey),C.log("session.sessionId :"+I.sessionId),I.xhrPolling=!0,C.log("CCSserver used : "+I.ccsServer),j=void 0!==I.appId?"&appId="+I.appId:"",q=void 0!==I.siteId?"&siteId="+I.siteId:"",void 0!==I.userData&&(C.log("Defined userData : ",I.userData),T=JSON.stringify(I.userData),C.log("stringUserData.length :"+T.length),T.length<=1e3?b="&userData="+encodeURIComponent(T):C.warn("userData length is too long :"+T.length+" .Need to be <= 500")),void 0!==I.presenceGroup&&(C.log("Defined presenceGroup : "+I.presenceGroup),Z=JSON.stringify(I.presenceGroup),C.log("stringPresenceGroup.length :"+Z.length),Z.length<=750?b+="&presenceGroup="+encodeURIComponent(Z):C.warn("presenceGroup length is too long :"+Z.length+" .Need to be <= 750")),void 0!==I.subscribeToPresenceGroup&&(C.log("Defined subscribeToPresenceGroup : "+I.subscribeToPresenceGroup),le=JSON.stringify(I.subscribeToPresenceGroup),C.log("stringsubscribeToPresenceGroup.length :"+le.length),le.length<=750?b+="&subscribeToPresenceGroup="+encodeURIComponent(le):C.warn("subscribeToPresenceGroup length is too long :"+le.length+" .Need to be <= 750")),void 0!==I.token&&(C.log("Defined token : "+I.token),b+="&token="+I.token),null!=I.conversationSpace&&(C.log("Defined conversationSpace : "+I.conversationSpace),b+="&conversationSpace="+I.conversationSpace),C.log("requestOptions on connect :"+(b+="&apiLibType=apiRTC_JS")),C.log("session.ccsServer :"+I.ccsServer),c="?channelId="+this.channelId+"&apiKey="+I.apiKey+"&apiVersion="+apiCC.version+"&apiCCSessionId="+I.apiCCSessionId+"&sessionId="+I.sessionId+j+q+b,x="undefined"!=typeof apiRTC_React?"https":"http:"===window.location.protocol?"http":"https","iOS"!==w.ag.name&&"Android"!==w.ag.name||(C.log(w.ag.name+" detected forcing protocol to https"),x="https"),C.info("CCS Connect, socket url is : "+x+"://"+I.ccsServer+"/"+c),this.ccsConnectionRetryNb=I.ccsConnectionRetryNb,this.ccsConnectionRetryDelay=I.ccsConnectionRetryDelay,this.socket=window.rtcio.connect(x+"://"+I.ccsServer+"/"+c,{forceNew:!0,multiplex:!1,withCredentials:!0,reconnectionAttempts:this.ccsConnectionRetryNb,reconnectionDelay:this.ccsConnectionRetryDelay}),this.socket.on("connect",this.callback(this,"onChannelOpened")).on("connect_error",this.callback(this,"onChannelConnectError")).on("message",this.callbackWithParams(this,"onChannelMessage")).on("disconnect",this.callback(this,"onChannelDisconnect")),this.socket.io.on("error",this.callback(this,"onChannelError")).on("reconnect",this.callback(this,"onChannelReconnect")).on("reconnect_attempt",this.callback(this,"onChannelReconnectAttempt")).on("reconnect_error",this.callback(this,"onChannelReconnectError")).on("reconnect_failed",this.callback(this,"onChannelReconnect_failed"))},this.onWhiteBoardDisconnection=function(){C.info("onWhiteBoardDisconnection"),apiCC.session.closeWhiteBoardClient("NETWORK_DISCONNECTION")},this.onChannelDisconnect=function(c){C.info("onChannelDisconnect");var j=Date();C.debug("date :"+j),apiCC.session.connectedUsersList.splice(0,apiCC.session.connectedUsersList.length),this.myWebRTC_Event.createChannelEvent("onChannelDisconnect",c),this.channelHasBeenDisconnected=!0,null!==apiCC.myApiCCWhiteBoardClient&&(C.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId?(C.log("Disconnection with an ongoing whiteboard"),C.error("Whiteboard disconnectionTimer is set to:",apiCC.myApiCCWhiteBoardClient.disconnectionTimer),apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId=setTimeout(this.callback(this,"onWhiteBoardDisconnection"),apiCC.myApiCCWhiteBoardClient.disconnectionTimer)):C.log("Disconnection without an ongoing whiteboard"))},this.onChannelReconnect_failed=function(){C.info("onChannelReconnect_failed"),this.myWebRTC_Event.createChannelEvent("onChannelReconnect_failed")},this.onChannelReconnect=function(c){C.error("onChannelReconnect",c);var j,q=null,b=0,T=[],Z=null,le=null,x=null,Se=!1,Ee=0,he=null,ue=null;if(null!=I.conversationSpace?(C.debug("conversationSpace is set :",I.conversationSpace),I.joinConversationSpace(I.conversationSpace)):C.debug("no conversationSpace defined"),null!=I.userData&&(C.debug("sending userData :",I.userData),I.setUserData(I.userData,!0)),null!==I.presenceGroup?(C.debug("presenceGroup is set :",I.presenceGroup),I.sendPresenceGroupManagementCommand("join",I.presenceGroup)):C.debug("no presenceGroup defined"),null!==I.subscribeToPresenceGroup?(C.debug("subscribeToPresenceGroup is set :",I.subscribeToPresenceGroup),I.sendPresenceGroupManagementCommand("subscribe",I.subscribeToPresenceGroup)):C.debug("no subscribeToPresenceGroup defined"),null!==apiCC.session.apiCCIMClient?!0===apiCC.session.apiCCIMClient.userDataSetted?(q={photoURL:apiCC.session.apiCCIMClient.photoURL},apiCC.session.apiCCIMClient.setUserData(q)):C.log("apiCC.session.apiCCIMClient.userDataSetted !== true"):C.log("apiCC.session.apiCCIMClient === null"),null!==apiCC.session.apiCCWebRTCClient){if(apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.length>0)for(Se=!0,j=0;j<apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.length;j+=1)Z={destId:(ue=apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable[j]).remoteId,convId:ue.userMediaId,callType:ue.callType,roomId:ue.roomId,data:ue.data,meshPublish:!0},T.push(Z);if(0!==(b=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length)){for(C.log("Reconnecting with calls ongoing"),j=0;j<b;j+=1)null!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[j]&&void 0!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[j]?(ue=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[j],C.debug("call.iceState =",ue.iceState),null!==ue.data?"publish"!==ue.data.type&&"subscribe"!==ue.data.type?(C.log("Call is P2P, updating media"),ue.updateMediaWithRetryManagement(!0),T.push(Z={destId:ue.remoteId,convId:ue.callId,callType:ue.callType,roomId:ue.dest_roomId,data:ue.data})):(C.log("Call is in an MCU session"),T.push(Z={destId:ue.remoteId,convId:ue.callId,callType:ue.callType,roomId:ue.dest_roomId,data:ue.data})):(C.log("Call is P2P, updating media - no data"),ue.updateMediaWithRetryManagement(!0),T.push(Z={destId:ue.remoteId,convId:ue.callId,callType:ue.callType,roomId:ue.dest_roomId,data:ue.data}))):C.log("call no more exist");Se=!0}else C.log("Reconnecting without calls ongoing");for(var ke=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs,Ne=0;Ne<ke.length;Ne+=1){C.log("Reconnecting with an ongoing sessionMCU");var ze=[];ze.push(ke[Ne].roomName),apiCC.session.sendPresenceGroupManagementCommand("join",ze),apiCC.session.sendPresenceGroupManagementCommand("subscribe",ze)}}if(null!==apiCC.myApiCCWhiteBoardClient&&(0!==apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId&&(C.debug("clearing whiteBoardDisconnectionTimeoutId"),clearTimeout(apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId),apiCC.myApiCCWhiteBoardClient.whiteBoardDisconnectionTimeoutId=0),C.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId?(C.log("Reconnection with an ongoing whiteboard"),Ee=apiCC.myApiCCWhiteBoardClient.roomId,Se=!0,C.debug("Reconnection , sending request to get most recent whiteboard data"),apiCC.myApiCCWhiteBoardClient.paperSheetId=0,apiCC.myApiCCWhiteBoardClient.drawingId=0,apiCC.myApiCCWhiteBoardClient.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})):C.log("Reconnecting without an ongoing whiteboard")),null!==apiCC.session.apiCCPointerSharingClient&&(he=apiCC.session.apiCCPointerSharingClient.getRoomIds()).length>0&&(Se=!0),!0===Se){C.log("Sending reconnectContext to CCS"),le={type:"reconnectContext",callList:T,whiteBoardRoomId:Ee},null!==he&&he.length>0&&(le.pointerSharingRoomIds=he);var Ve=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs;if(Ve.length>0){le.updateSession=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.createJoinSessionMessage(null),le.updateSession.type="updateSession",le.updateSessions=[];var et,_e=function(ot,at){var yt="undefined"!=typeof Symbol&&ot[Symbol.iterator]||ot["@@iterator"];if(!yt){if(Array.isArray(ot)||(yt=function(je,xt){if(je){if("string"==typeof je)return M(je,void 0);var Wt=Object.prototype.toString.call(je).slice(8,-1);return"Object"===Wt&&je.constructor&&(Wt=je.constructor.name),"Map"===Wt||"Set"===Wt?Array.from(je):"Arguments"===Wt||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Wt)?M(je,void 0):void 0}}(ot))){yt&&(ot=yt);var Et=0,ie=function(){};return{s:ie,n:function(){return Et>=ot.length?{done:!0}:{done:!1,value:ot[Et++]}},e:function(je){throw je},f:ie}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var dt,Mt=!0,Rt=!1;return{s:function(){yt=yt.call(ot)},n:function(){var je=yt.next();return Mt=je.done,je},e:function(je){Rt=!0,dt=je},f:function(){try{Mt||null==yt.return||yt.return()}finally{if(Rt)throw dt}}}}(Ve);try{for(_e.s();!(et=_e.n()).done;){var mt=apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.createJoinSessionMessage(null,{sessionMCU:et.value});mt.type="updateSession",le.updateSessions.push(mt)}}catch(ot){_e.e(ot)}finally{_e.f()}}x=JSON.stringify(le),C.log("C->S: "+x),apiCC.session.channel.socket.emit("reconnectContext",x)}T.splice(0,T.length),this.myWebRTC_Event.createChannelEvent("onChannelReconnect",c)},this.onChannelReconnecting=function(c){C.info("onChannelReconnecting",c);var j=Date();C.debug("date :"+j),this.myWebRTC_Event.createChannelEvent("onChannelReconnecting",c)},this.onChannelOpened=function(){C.info("Channel opened"),C.log("this.channelId :"+this.channelId),this.channelReady=!0,!1===this.channelHasBeenDisconnected?I.onChannelOpened():(C.log("onChannelOpened after a disconnection, no change on session"),this.channelHasBeenDisconnected=!1,!1!==I.ApiDBActivated&&null!=I.ApiDBActivated&&(C.log("apiDB initialisation"),apiDB.init(I.channel.socket))),!0===this.updatePresenceGroupIsNeeded&&(C.log("Updating presence group"),I.leavePresenceGroup(this.oldPresenceGroup),I.joinPresenceGroup(this.newPresenceGroup)),!0===this.updateSubscribeToPresenceGroupIsNeeded&&(C.log("Updating subscribe to presence group"),I.unsubscribePresenceGroup(this.oldSubscribeToPresenceGroup),I.subscribePresenceGroup(this.newSubscribeToPresenceGroup)),this.myWebRTC_Event.createChannelEvent("onChannelOpened")},this.onChannelMessage=function(c,j){var q,b=null,T=null;try{b=JSON.parse(c)}catch(Z){return}(q="checkCallStatus"===b.type||"apiRTCDataMessage"===b.type&&b.data&&["activeSpeaker","stopSpeaking"].indexOf(b.data.type)>=0)||C.info("onChannelMessage S->C: "+c),"IMMessage"===b.type&&(C.log("IMMessage convId :"+b.IMId),T=b.IMId),void 0!==j&&(C.trace("ack on message reception"),C.trace("convId :"+T),j({reason:"ack",convId:T})),I.processSignalingMessage(b,{quiet:q})},this.onChannelConnectError=function(c){C.log("onChannelConnectError :",c),this.myWebRTC_Event.createChannelEvent("onChannelConnectError",c)},this.onChannelReconnectError=function(c){C.log("onChannelReconnectError :",c),this.myWebRTC_Event.createChannelEvent("onChannelReconnectError",c)},this.onChannelReconnectAttempt=function(c){C.log("onChannelReconnectAttempt :",c),this.myWebRTC_Event.createChannelEvent("onChannelReconnectAttempt",c),this.onChannelReconnecting(c)},this.onChannelError=function(c){C.error("Channel error :",c),"not authorized"===c&&this.socket.disconnect(),this.myWebRTC_Event.createChannelEvent("onChannelError",c)},this.callback=function(c,j){return this.closureHandler=function(q){return c[j](q)},this.closureHandler},this.callbackWithParams=function(c,j){return this.closureHandler=function(q,b,T){return c[j](q,b,T)},this.closureHandler}},n=e(4708),y=e(940);function R(I){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(I)}var m=i.Y.get("ApiCCSession"),u=apiCC.myWebRTC_Event,f=function(I){var c=this;if(this.apiCCId=null,this.apiCCSessionId=apiCC.randomString(22),this.apiKey=null,this.nickname=null,this.photoURL=null,this.apiCCWebRTCClient=null,this.apiCCIMClient=null,this.apiCCDataClient=null,this.apiCCIDSessionStorage=null,this.apiKeySessionStorage=null,this.apiCCIdPersistenceTimeout=5e3,this.channel=null,this.recordActivated=I.recordActivated,this.sessionId=null,this.apiCCPointerSharingClient=null,this.apiCCWhiteBoardClient=null,this.apiCCCoBrowsingClient=null,this.ccsServer=I.ccsServer,this.userData=I.userData,this.apiDBActivated=!0,I.ApiDBActivated=!0,this.webRTCPluginActivated=I.webRTCPluginActivated,this.token=I.token,this.conversationSpace=I.conversationSpace,this.tryAudioCallAfterUserMediaError=I.tryAudioCallAfterUserMediaError,this.deactivateReloadOnCancel=I.deactivateReloadOnCancel,this.connectedUsersList=[],this.messageTimeOutTable=[],this.ccsConnectionRetryNb=I.ccsConnectionRetryNb,this.ccsConnectionRetryDelay=I.ccsConnectionRetryDelay,this.sequentialMessagesStorage={},this.messageTimeOutTimer=void 0!==I.messageTimeOutTimer?I.messageTimeOutTimer:1e4,m.log("messageTimeOutTimer set to : "+this.messageTimeOutTimer),this.presenceGroup=void 0!==I.presenceGroup?I.presenceGroup:["default"],this.subscribeToPresenceGroup=void 0!==I.subscribeToPresenceGroup?I.subscribeToPresenceGroup:["default"],this.isDeviceWebRTCCompliant=function(){return apiCC.isWebRTCCompliant()},this.isDeviceDTLSCompliant=function(){var b=w.E2.getBrowser(),T=parseInt(b.version,10);return!("Chrome"===b.name&&T<44&&(m.log("isDeviceDTLSCompliant FALSE : Chrome V < 44"),1))},null==this.userData?(this.userData={},this.userData.webRtcCompliant=apiCC.webRTCCompliant,this.userData.dtlsCompliant=this.isDeviceDTLSCompliant()):null==this.userData.webRtcCompliant?(this.userData.webRtcCompliant=apiCC.webRTCCompliant,this.userData.dtlsCompliant=this.isDeviceDTLSCompliant()):m.log("userData webRtcCompliant set to :",this.userData.webRtcCompliant),this.userData.osName=w.BF,this.userData.osVersion=w.MM,this.userData.browser=w.Xh,this.userData.deviceType=w.vO,this.userData.browser_version=w.dc,this.userData.browser_major_version=w.PR,this.userData.apiRTCVersion=apiCC.version,"Android"===w.BF&&"undefined"!=typeof cordova&&(this.userData.platform="Android"),"undefined"!=typeof apiRTC_React&&(this.userData.react=!0),this.roomManagerEventHandler=function(b){if(m.debug("roomManagerEventHandler, roomId :"+b.roomId+", type :"+b.type+", roomType :"+b.roomType),"whiteBoard"===b.roomType){if(null===apiCC.myApiCCWhiteBoardClient||void 0===apiCC.myApiCCWhiteBoardClient)return void m.log("No whiteBoard created, leaving msg processing");"roomCreation"===b.type&&(m.log("whiteBoard : roomCreation"),apiCC.myApiCCWhiteBoardClient.roomId=b.roomId,apiCC.myApiCCWhiteBoardClient.paperSheetId++,apiCC.myApiCCWhiteBoardClient.drawingId=0,apiCC.myApiCCWhiteBoardClient.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})),"roomInvitation"===b.type&&(m.log("whiteBoard : roomInvitation"),apiCC.myApiCCWhiteBoardClient.roomId=b.roomId),"roomMessage"===b.type&&apiCC.myApiCCWhiteBoardClient.messageProcessing(b.data),"roomJoin"===b.type&&(m.log("whiteBoard : roomJoin"),apiCC.myApiCCWhiteBoardClient.roomJoined=!0,apiCC.myApiCCWhiteBoardClient.roomId=b.roomId)}else"pointerSharing"===b.roomType?apiCC.session.apiCCPointerSharingClient&&"roomJoin"===b.type&&apiCC.session.apiCCPointerSharingClient.processMessageRoomJoin(b):"coBrowsing"===b.roomType?"roomMessage"===b.type&&m.log("coBrowsing : roomMessage :"+b):m.log("roomManagerEventHandler for msg.roomType :"+b.roomType)},this.callback=function(b,T){return this.closureHandler=function(Z){return b[T](Z)},this.closureHandler},this.roomMgr=new h(this,this.callback(this,"roomManagerEventHandler")),this.xhrPolling=!0===I.xhrPolling,this.getSessionStorage=function(b){var T=sessionStorage.getItem(b);if(null===T)return null;try{var Z=JSON.parse(T),le=new Date(Z.expiresAt);return new Date>=le?(sessionStorage.removeItem(b),null):Z.value}catch(x){m.error("Something went wrong when parsing JSON from session storage values")}},this.generateApiCCID=function(){m.debug("apiCCId is not defined by user, checking if apiCCId exist in sessionStorage"),"undefined"==typeof apiRTC_React&&(this.apiCCIDSessionStorage=this.getSessionStorage("apiCCId"),this.apiKeySessionStorage=this.getSessionStorage("apiKey")),null!==this.apiCCIDSessionStorage?(m.log("apiCCId exist in sessionStorage : "+this.apiCCIDSessionStorage),null!==this.apiKeySessionStorage?(m.log("apiKey exist in sessionStorage : "+this.apiKeySessionStorage),this.apiKeySessionStorage===this.apiKey?(m.log("apiKey is the same, keeping apiCCId"),this.apiCCId=this.apiCCIDSessionStorage):(m.log("apiKey is not the same, generating an  apiCCId"),this.apiCCId=Math.floor(1000001*Math.random()).toString(),m.log("Creation of new ApiRTC session with Id : "+this.apiCCId))):this.apiCCId=this.apiCCIDSessionStorage):(m.log(" No apiCCId found on sessionStorage : generating an apiCCId"),this.apiCCId=String(1e5+Math.floor(9e5*Math.random())),m.log("Creation of new ApiRTC session with Id : "+this.apiCCId))},this.getNumericIdFromAlpha=function(b){m.log("getNumericIdFromAlpha new : "+b);var T,Z=0;if(0===b.length)return Z;for(T=0;T<b.length;T++)Z=(Z<<5)-Z+b.charCodeAt(T),Z&=Z;return m.log("getNumericIdFromAlpha returned value: "+(Z>>>0)),Z>>>0},void 0!==I.appId&&(this.appId=I.appId),void 0!==I.siteId&&(this.siteId=I.siteId),void 0===I.apiKey)return m.error('Error : Initialisation parameters: "apikey" for session creation is not defined'),null;if(m.log("Session creation with apiKey : "+I.apiKey),m.log("Session creation with apiCCId : "+I.apiCCId),this.apiKey=I.apiKey,void 0===I.onReady&&"undefined"==typeof apiRTC_React)return m.error('Error : Initialisation parameters: "onReady" for session creation is not defined'),null;if(apiCC.addEventListener("sessionReady",I.onReady),"undefined"==typeof apiRTC_React&&(this.sessionId=this.getSessionStorage("sessionId")),void 0===I.apiCCId||""===I.apiCCId||null===I.apiCCId)this.generateApiCCID();else if(m.log("Session creation with apiCCId defined by user : "+I.apiCCId),m.debug("params.idConversionActivated : "+I.idConversionActivated),void 0===I.idConversionActivated||!0===I.idConversionActivated)if((0,n._C)(I.apiCCId))this.apiCCId=I.apiCCId.toString();else{m.log("Converting this Id in a numeric one");var j=this.getNumericIdFromAlpha(I.apiCCId);m.log("Numeric Id is : "+(j+="")),(0,n._C)(j)?(m.warn("Id has been converted to a numeric one"),this.apiCCId=j.toString()):(m.warn("Error : Defined apiCCId :"+I.apiCCId+" is not numeric. ApiCCID is generated"),this.generateApiCCID())}else m.log("String id convertion is deactivated"),this.apiCCId=I.apiCCId.toString();function q(b){return b instanceof Array?(m.log("data instanceof Array"),!0):(m.log("data not instanceof Array"),!1)}null!==I.apiCCIdPersistenceTimeout&&"number"==typeof I.apiCCIdPersistenceTimeout&&I.apiCCIdPersistenceTimeout>=0&&(this.apiCCIdPersistenceTimeout=I.apiCCIdPersistenceTimeout),null!==this.channel&&(m.log("this.channel is defined"),delete this.channel),this.channel=new S(this),this.channel.initialize(),null!=I.nickname?(m.log("Nickname is defined :"+I.nickname),this.nickname=I.nickname):(m.log("Nickname is not defined, setting to apiCCId value :"+this.apiCCId),this.nickname=this.apiCCId),null!=I.photoURL?(m.log("photoURL is defined :"+I.photoURL),this.photoURL=I.photoURL):(m.log("photoURL is not defined"),this.photoURL=null),this.reOpenChannel=function(b,T){m.info("reOpenChannel"),this.apiCCId=b.toString(),this.apiKey=T,null!=this.channel.socket&&this.channel.socket.disconnect(),this.channel.channelReady=!1,this.channel.socket=null,this.channel.channelId=this.apiCCId,this.channel.initialize(),null!==this.apiCCWebRTCClient&&null!==this.apiCCWebRTCClient.webRTCClient&&(this.apiCCWebRTCClient.webRTCClient.socket=this.channel.socket)},this.onChannelOpened=function(){m.debug("ApiCCSession onChannelOpened"),!1!==I.ApiDBActivated&&null!=I.ApiDBActivated&&(m.log("apiDB initialisation"),apiDB.init(this.channel.socket)),u.createSessionReadyEvent(apiCC.session.apiCCId)},this.createWebRTCClient=function(b){m.debug("createWebRTCClient");var T={};if(null!=b){this.apiCCWebRTCClient=new apiCC.ApiCCWebRTCClient(this,b.localVideo,b.minilocalVideo,b.remoteVideo,b.status,b.command),apiCC.session.apiCCWebRTCClient.webRTCClient.setGumConfigWithDevicePresent(),T.audioDevicePresent=apiCC.mediaDeviceMgr.audioDevicePresent,T.videoDevicePresent=apiCC.mediaDeviceMgr.videoDevicePresent,apiCC.session.setUserData(T),setTimeout(function(){u.createWebRTCClientCreatedEvent()});var Z=apiCC.getUserMediaStreamIds(),le=Z.length;for(m.debug("listing accessToLocalMedia "+le);--le>=0;)if(apiCC.getUserMediaStream(Z[le]).accessToLocalMedia()){m.debug("setting accessToLocalMedia to true"),this.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0;break}return this.apiCCWebRTCClient}return m.log("Error : Initialisation parameters is null or not defined on WebRTCClient creation"),null},this.createPointerSharingClient=function(){return null===this.apiCCPointerSharingClient&&(this.apiCCPointerSharingClient=new apiCC.ApiCCPointerSharingClient(this)),this.apiCCPointerSharingClient},this.closePointerSharingClient=function(){null!==this.apiCCPointerSharingClient&&this.apiCCPointerSharingClient instanceof apiCC.ApiCCPointerSharingClient&&(this.apiCCPointerSharingClient.stop(),this.apiCCPointerSharingClient=null)},this.createWhiteBoard=function(b,T,Z,le){return m.info("createWhiteBoard"),this.apiCCWhiteBoardClient=apiCC.createWhiteBoard(b,T,Z,le),this.apiCCWhiteBoardClient},this.closeWhiteBoardClient=function(b){m.info("closeWhiteBoardClient"),apiCC.closeWhiteBoardClient(b)},this.createCoBrowsing=function(){return m.info("createCoBrowsing"),this.apiCCCoBrowsingClient=new apiCC.ApiCCCoBrowsingClient(this),this.apiCCCoBrowsingClient},this.createIMClient=function(b){return m.debug("createIMClient"),this.apiCCIMClient=new apiCC.ApiCCIMClient(this,b),this.apiCCIMClient},this.createDataClient=function(){return m.info("createDataClient"),this.apiCCDataClient=new apiCC.ApiCCDataClient(this),this.apiCCDataClient},this.updatingQuery=function(b){m.debug("updatingQuery");var T=null,Z=null,le=null;return T=(0,n.dD)(b),void 0!==this.userData?(Z=JSON.stringify(this.userData),le=encodeURIComponent(Z),T.userData=le,(0,n.Wc)(T)):b},this.setUserData=function(b,T){m.debug("setUserData in session :",b);var le,x,Se=[],Ee=this.userData;if(void 0!==this.userData){if(this.userData=(0,n.S6)(this.userData,b),m.debug("this.userData :",this.userData),m.debug("actualUserData :",Ee),m.debug("forceSendData :",T),!0!==T&&JSON.stringify(this.userData)===JSON.stringify(Ee))return void m.debug("userData is not changed, leaving userData processing")}else this.userData=b;for(le=JSON.stringify({type:"setUserData",userData:b}),m.log("C->S: "+le),this.channel.socket.emit("setUserData",le),m.log("socket.io 1.X : socket.io.opts.query :"+this.channel.socket.io.opts.query),this.channel.socket.io.opts.query=this.updatingQuery(this.channel.socket.io.opts.query),m.log("socket.io 1.X : after update : socket.io.opts.query :"+this.channel.socket.io.opts.query),x=0;x<this.connectedUsersList.length;x+=1)this.apiCCId===this.connectedUsersList[x].userId&&(this.connectedUsersList[x].userData=this.userData,Se[0]=this.apiCCId,u.createConnectedUsersListUpdateEvent(this.connectedUsersList[x].group,Se,"userDataUpdate","userDataUpdate"))},this.sendPresenceGroupManagementCommand=function(b,T){m.debug("sendPresenceGroupManagementCommand :"+b+" for group : "+T);var le,x,Se=T.length;if("unsubscribe"===b)for(x=0;x<Se;x+=1)this.removeGroupDataFromConnectedUsersList(T[x]);1!==Se||"deactivated"!==T[0]?(le=JSON.stringify({type:"presenceGroupManagement",command:b,group:T}),m.log("C->S: "+le),this.channel.socket.emit("presenceGroupManagement",le)):m.debug("leaving sendPresenceGroupManagementCommand for group deactivated")},this.sendConversationSpaceCommand=function(b,T){var le;m.debug("sendConversationSpaceCommand :"+b+" for conversationSpace : "+T),le=JSON.stringify({type:"conversationSpaceManagement",command:b,conversationSpace:T}),m.log("C->S: "+le),this.channel.socket.emit("conversationSpaceManagement",le)},this.joinPresenceGroup=function(b){var T=this;m.info("joinPresenceGroup :"+b),!0===q(b)?(this.sendPresenceGroupManagementCommand("join",b),b.forEach(function(Z){-1===T.presenceGroup.indexOf(Z)&&T.presenceGroup.push(Z)})):m.log("group parameter value is not correct, need to be a JSON array"),m.debug("this.presenceGroup :"+this.presenceGroup)},this.leavePresenceGroup=function(b){var T=this;m.info("leavePresenceGroup :"+b),!0===q(b)?(b.forEach(function(Z){var le=T.presenceGroup.indexOf(Z);-1!==le&&T.presenceGroup.splice(le,1)}),this.sendPresenceGroupManagementCommand("leave",b)):m.log("group parameter value is not correct, need to be a JSON array"),m.debug("this.presenceGroup :"+this.presenceGroup)},this.subscribePresenceGroup=function(b){var T=this;m.info("subscribePresenceGroup :"+b),!0===q(b)?(this.sendPresenceGroupManagementCommand("subscribe",b),b.forEach(function(Z){-1===T.subscribeToPresenceGroup.indexOf(Z)&&T.subscribeToPresenceGroup.push(Z)})):m.log("group parameter value is not correct, need to be a JSON array"),m.debug("this.subscribeToPresenceGroup :"+this.subscribeToPresenceGroup)},this.unsubscribePresenceGroup=function(b){var T=this;m.info("unsubscribePresenceGroup :"+b),!0===q(b)?(b.forEach(function(Z){var le=T.subscribeToPresenceGroup.indexOf(Z);-1!==le&&T.subscribeToPresenceGroup.splice(le,1)}),this.sendPresenceGroupManagementCommand("unsubscribe",b)):m.log("group parameter value is not correct, need to be a JSON array"),m.debug("this.subscribeToPresenceGroup :"+this.subscribeToPresenceGroup)},this.joinConversationSpace=function(b){m.info("joinConversationSpace :"+b),this.sendConversationSpaceCommand("join",b),this.conversationSpace=b},this.leaveConversationSpace=function(b){m.info("leaveConversationSpace :"+b),null!=b&&this.conversationSpace===b?(this.sendConversationSpaceCommand("leave",b),this.conversationSpace=null):m.debug("socket is not in the conversationSpace, we request to leave")},this.subscribeToCloudEvent=function(b,T){this.sendCloudEventsCommand("subscribe",b,T)},this.unsubscribeToCloudEvent=function(b,T){this.sendCloudEventsCommand("unsubscribe",b,T)},this.sendCloudEventsCommand=function(b,T,Z){if(["subscribe","unsubscribe"].includes(b))if(T&&"string"==typeof T){if(Z){if("object"!==R(Z))return void m.error("wrong headers format");for(var le=0,x=Object.values(Z);le<x.length;le++){var Se=x[le];if(!Se||"string"!=typeof Se)return void m.error("wrong headers format")}}var Ee={type:"cloudEvents",command:b,topic:T};Z&&(Ee.headers=Z);var he=JSON.stringify(Ee);m.log("C->S:",he),this.channel.socket.emit("cloudEvents",he)}else m.error("wrong topic format");else m.error("wrong command")},this.getConversationList=function(b){var T;m.info("getConversationList request"),T=JSON.stringify(void 0!==b?{type:"getConversationList",lastConversationNb:b}:{type:"getConversationList",lastConversationNb:50}),m.log("C->S: "+T),this.channel.socket.emit("getConversationList",T)},this.receiveConversationListAnswer=function(b){m.info("receiveConversationListAnswer"),m.log("msg.convList.length :"+b.convList.length);var T,Z=b.convList.length,le=[],x=null;for(T=0;T<Z;T+=1)m.log("i ="+T),x=JSON.parse(b.convList[T]),le.push(x);u.createReceiveConversationListAnswerEvent(le)},this.getContactOccurrencesFromConversationList=function(b){var T;m.info("getContactOccurrencesFromConversationList request"),T=JSON.stringify(void 0!==b?{type:"getContactOccurrencesFromConversationList",lastConversationNb:b}:{type:"getContactOccurrencesFromConversationList",lastConversationNb:50}),m.log("C->S: "+T),this.channel.socket.emit("getContactOccurrencesFromConversationList",T)},this.receiveContactOccurrencesFromConversationListAnswer=function(b){m.info("receiveContactOccurrencesFromConversationListAnswer"),m.log("msg.contactOccurrencesTable.length :"+b.contactOccurrencesTable.length),u.createReceiveContactOccurrencesFromConversationListAnswerEvent(b.contactOccurrencesTable)},this.getConversationDetailReport=function(b){var Z;m.info("getConversationDetailReport for convId :"+b),Z=JSON.stringify({type:"getConversationDetailReport",convId:b}),m.log("C->S: "+Z),this.channel.socket.emit("getConversationDetailReport",Z)},this.receiveConversationDetailReportAnswer=function(b){m.info("receiveConversationDetailReportAnswer"),m.log("msg.CDR :"+b.CDR),u.createReceiveConversationDetailReportAnswerEvent(b.CDR)},this.manageConnectedUsersList=function(b,T,Z,le){m.debug("manageConnectedUsersList");var x,Se,Ee,he=!1,ue=0,ke=!1,Ne="unset";for(m.trace("manageConnectedUsersList.length :"+b.length),m.trace("this.connectedUsersList.length :"+this.connectedUsersList.length),m.log("state :"+T),m.log("group :"+Z),Ee=0;Ee<b.length;Ee+=1)b[Ee].group=Z;if("online"===T)for(m.log("state : online"),x=0;x<b.length;x+=1){if(m.log("msgConnectedUsersListWithStatus  :"+x),he=!1,0===this.connectedUsersList.length){m.log("this.connectedUsersList is empty"),this.connectedUsersList=b,m.log("this.connectedUsersList[0].group :"+this.connectedUsersList[0].group),u.createConnectedUsersListUpdateEvent(Z,le,T,"newConnectionState");break}for(Se=0;Se<this.connectedUsersList.length;Se+=1)if(ke=!1,b[x].userId===this.connectedUsersList[Se].userId&&b[x].group===this.connectedUsersList[Se].group){he=!0,JSON.stringify(this.connectedUsersList[Se].userData)!==JSON.stringify(b[x].userData)&&(m.log("userData is updated"),this.connectedUsersList[Se].userData=b[x].userData,ke=!0,Ne="userDataUpdate"),this.connectedUsersList[Se].callState!==b[x].callState&&(m.log("callState is updated"),this.connectedUsersList[Se].callState=b[x].callState,ke=!0,Ne="callState"),!0===ke&&u.createConnectedUsersListUpdateEvent(Z,le,T,Ne);break}if(!1===he){m.log("Adding user in connectedUsersList :"+b[x].userId),this.connectedUsersList.push(b[x]);var ze=[];ze[0]=b[x].userId,u.createConnectedUsersListUpdateEvent(Z,ze,T,"newConnectionState")}}else for(m.log("state : offline"),x=0;x<b.length;x+=1)for(m.log("msgConnectedUsersListWithStatus  :"+x),ue=this.connectedUsersList.length,Se=0;Se<ue;Se+=1)if(b[x].userId===this.connectedUsersList[Se].userId&&b[x].group===this.connectedUsersList[Se].group){m.log("Removing user in connectedUsersList :"+b[x].userId),m.log("... in group :"+b[x].group),this.connectedUsersList.splice(Se,1),u.createConnectedUsersListUpdateEvent(Z,le,T,"newConnectionState");break}},this.removeGroupDataFromConnectedUsersList=function(b){m.debug("removeGroupDataFromConnectedUsersList for group :",b);var T,Z=this.connectedUsersList.length,le=[],x=0;for(m.debug("this.connectedUsersList.length :",this.connectedUsersList.length),T=0;T<Z;T+=1)m.debug("this.connectedUsersList[j].group :",this.connectedUsersList[T-x].group),m.debug("group :",b),this.connectedUsersList[T-x].group===b&&(m.log("Removing user in connectedUsersList :"+this.connectedUsersList[T-x].userId),le[0]=this.connectedUsersList[T-x].userId,this.connectedUsersList.splice(T-x,1),x+=1,u.createConnectedUsersListUpdateEvent(b,le,"offline","newConnectionState"))},this.getConnectedUsersList=function(b){m.log(void 0!==b?"getConnectedUsersList for group : "+b:"getConnectedUsersList : complete users list");var T,Z=[];if(null==b)return this.connectedUsersList;for(m.log("filtering list for group : "+b),T=0;T<this.connectedUsersList.length;T+=1)this.connectedUsersList[T].group===b&&Z.push(this.connectedUsersList[T]);return Z},this.isClientWebRtcCompliant=function(b){var T,Z,le=null,x=null;if(void 0!==b)for(T=this.getConnectedUsersList(),Z=0;Z<T.length;Z++)T[Z].userId===b&&null!=(x=T[Z].userData)&&void 0!==x.webRtcCompliant&&(le=x.webRtcCompliant);return le},this.isClientDTLSCompliant=function(b){var T,Z,le=!0,x=null;if(void 0!==b)for(T=this.getConnectedUsersList(),Z=0;Z<T.length;Z++)T[Z].userId===b&&(m.log("userData :",x=T[Z].userData),null!=x&&void 0!==x.dtlsCompliant&&(le=x.dtlsCompliant));return le},this.getConnectedUserIdsList=function(b){m.info("getConnectedUserIdsList, group :",b);var T,Z,le=[],x=!1,Se={},Ee=[];if(m.log(void 0!==b?"getConnectedUserIdsList for group : "+b:"getConnectedUserIdsList : complete users list"),null==b)Ee=JSON.parse(JSON.stringify(this.connectedUsersList));else for(T=0;T<this.connectedUsersList.length;T+=1)this.connectedUsersList[T].group===b&&Ee.push(this.connectedUsersList[T]);for(T=0;T<Ee.length;T+=1){for(x=!1,Z=0;Z<le.length;Z++)if(le[Z].userId===Ee[T].userId){x=!0;break}!1===x&&((Se={}).userId=Ee[T].userId,Se.callState=Ee[T].callState,Se.userData=Ee[T].userData,le.push(Se))}return le},this.getGroupsFromConnectedUsersList=function(b){m.info("getGroupsFroConnectedUsersList");var T,Z=[],le=!1;for(T=0;T<this.connectedUsersList.length;T+=1)this.connectedUsersList[T].userId===b&&(m.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[T].group)),le=!0,Z.push(this.connectedUsersList[T].group));return!0===le?JSON.stringify(Z):"User_Not_Found"},this.getConnectedUserInfo=function(b,T){m.info("getConnectedUserInfo"),m.log("getConnectedUserInfo userId :",b),m.log("getConnectedUserInfo infoType :",T);var Z,le=null,x=null;switch(T){case"all":for(m.log("all"),Z=0;Z<this.connectedUsersList.length;Z+=1)if(this.connectedUsersList[Z].userId===b)return m.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[Z])),le=this.getGroupsFromConnectedUsersList(b),(x=JSON.parse(JSON.stringify(this.connectedUsersList[Z]))).groups=le,delete x.group,JSON.stringify(x);break;case"callState":for(m.log("callState"),Z=0;Z<this.connectedUsersList.length;Z+=1)if(this.connectedUsersList[Z].userId===b)return m.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[Z].callState)),this.connectedUsersList[Z].callState;break;case"userData":for(m.log("userData"),Z=0;Z<this.connectedUsersList.length;Z+=1)if(this.connectedUsersList[Z].userId===b)return m.log("Matching Entry found :"+JSON.stringify(this.connectedUsersList[Z].userData)),JSON.stringify(this.connectedUsersList[Z].userData);break;case"groups":return m.log("groups"),this.getGroupsFromConnectedUsersList(b);default:m.log("infoType not defined switch case : "+T)}return"User_Not_Found"},this.isConnectedUser=function(b){m.info("isConnectedUser");var T,Z=!1;for(T=0;T<this.connectedUsersList.length;T+=1)if(m.log(JSON.stringify(this.connectedUsersList[T])),this.connectedUsersList[T].userId===b)return m.log("isConnected :"+(Z=!0)),Z;return m.log("isConnected :"+Z),Z},this.displayConnectedUsersList=function(){var b;for(m.debug("displayConnectedUsersList"),b=0;b<this.connectedUsersList.length;b+=1)m.log("User :"+this.connectedUsersList[b].userId+" on group :"+this.connectedUsersList[b].group)},this.updatePresence=function(b){try{m.debug("updatePresence : ",JSON.stringify(b))}catch(T){m.debug(T)}m.log("updatePresence for group :"+b.group),this.manageConnectedUsersList(b.connectedUsersListWithStatus,b.state,b.group,b.connectedUsersList),u.createUpdatePresenceEvent(b.connectedUsersList,b.state,b.connectedUsersListWithStatus)},this.processCloudEventOccurred=function(b){m.debug("processCloudEventOccurred",b),u.createCloudEventOccurredEvent(b.event.type,b.event.target)},this.updateUserStatus=function(b){m.info("updateUserStatus"+b),u.createUpdateUserStatusEvent(b)},this.sendDebugCommand=function(b,T,Z){m.info("sendDebugCommand :"+b),new y.S(this.channel.socket).sendDebugCommand("getClientSocketsInfo",T,Z)},this.processSignalingMessage=function(b){var T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=null,le=null,x=!1,Se=null,Ee=null,he=!1,ue=null;if("invite"===b.type)this.apiCCWebRTCClient?(m.log("this.webRTCPluginActivated =",this.webRTCPluginActivated),("IE"===w.Xh||"Safari"===w.Xh&&w.PR<11)&&!0===this.webRTCPluginActivated?(m.log("managing call with WebRTC Plugin"),apiCC.manageWebRTCPlugin(function(){m.log("manageWebRTCPlugin cb on Invite"),apiCC.session.apiCCWebRTCClient.webRTCClient.processInvite(b)},function(){m.log("actionOnInstallationNeeded"),m.log("sending bye to be done"),new y.S(apiCC.session.channel.socket).sendBye(b.callId,b.calleeId,b.roomId,b.callerId,"WebRTC_Plugin_Installation_needed",b.data)})):(m.log("managing call with browser"),this.apiCCWebRTCClient.webRTCClient.processInvite(b))):m.warn("WebRTCClient is not created");else if("200OK"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200OK(b):m.warn("WebRTCClient is not created");else if("candidate"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processCandidate(b):m.warn("WebRTCClient is not created");else if("bye"===b.type)this.apiCCWebRTCClient?(m.log("bye message from:"+b.clientId+" for callId : "+b.callId),this.apiCCWebRTCClient.webRTCClient.onRemoteHangup(b.callId,b.clientId,b.roomId,b.reason,b.confId,b.data)):m.warn("WebRTCClient is not created");else if("update"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processUpdate(b):m.warn("WebRTCClient is not created");else if("200update"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200Update(b):m.warn("WebRTCClient is not created");else if("newConversationCreated"===b.type)this.apiCCIMClient?this.apiCCIMClient.newConversationCreated(b):m.warn("IMClient is not created");else if("IMMessage"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveMessage(b):m.warn("IMClient is not created");else if("groupChatCreation"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatCreation(b):m.warn("IMClient is not created");else if("groupChatInvitation"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatInvitation(b):m.warn("IMClient is not created");else if("groupChatMemberUpdate"===b.type)this.apiCCIMClient?this.apiCCIMClient.groupChatMemberUpdate(b):m.warn("IMClient is not created");else if("addUserInGroupChatAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.addUserInGroupChatAnswer(b):m.warn("IMClient is not created");else if("groupChatMessage"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveGroupChatMessage(b):m.warn("IMClient is not created");else if("conversationHistoryAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveConversationHistory(b):m.warn("IMClient is not created");else if("getUserDataAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveUserDataAnswer(b):m.warn("IMClient is not created");else if("fetchUserDataAnswer"===b.type)this.apiCCIMClient?this.apiCCIMClient.receiveFetchUserDataAnswer(b):m.warn("IMClient is not created");else if("dataMessage"===b.type)this.apiCCDataClient?this.apiCCDataClient.receiveData(b):m.warn("DataClient is not created");else if("dataAck"===b.type)this.apiCCWebRTCClient.webRTCClient.processDataAck(b);else if("dataEndAck"===b.type)this.apiCCWebRTCClient.webRTCClient.processDataEndAck(b);else if("updateVideoQuality"===b.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processUpdateVideoQuality(b.callId,b.profile);else if("apiRTCDataMessage"===b.type)if(T.quiet||m.debug("apiRTCDataMessage:",b),(0,n.Ym)(b.data,"object"))if("joinSessionAnswer"===b.data.type)if(this.apiCCWebRTCClient){var ke={roomName:b.data.roomId};(0,n.ki)(b.data,"convId","string")&&(ke.convId=b.data.convId),(0,n.ki)(b.data,["data","mode"],"string")&&(ke.data={mode:b.data.data.mode}),(0,n.ki)(b.data,["data","transition"],"string")&&"mesh2janus"===b.data.data.transition?this.apiCCWebRTCClient.webRTCClient.MCUClient.changeSessionMode(ke,"mesh2janus"):this.apiCCWebRTCClient.webRTCClient.MCUClient.updateSessionAnswer(ke,{createSession:!0})}else m.warn("WebRTCClient is not created");else if("slowLink"===b.data.type){if(this.apiCCWebRTCClient){var Ne={};b.data.advice&&(Ne.advice=b.data.advice),this.apiCCWebRTCClient.webRTCClient.processSlowLink(b.data.callId,Ne)}}else if("videoQualityChanged"===b.data.type)u.createVideoQualityChangedEvent(b.data.callId,b.data.roomId,b.data.hint,b.data.profile);else if("distantIceError"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processDistantIceError(b.data);else if("streamTrackChanged"===b.data.type)this.apiCCWebRTCClient&&b.data.hasOwnProperty("mline")&&b.data.hasOwnProperty("muted")&&this.apiCCWebRTCClient.webRTCClient.processStreamTrackMuteChanged(b.data.callId,b.data.mline,b.data.muted);else if("streamTrackStatusChanged"===b.data.type)this.apiCCWebRTCClient&&b.data.hasOwnProperty("mline")&&b.data.hasOwnProperty("change")&&b.data.hasOwnProperty(b.data.change)&&this.apiCCWebRTCClient.webRTCClient.processStreamTrackStatusChanged(b.data.callId,b.data.mline,b.data[b.data.change]);else if("configureEncodings"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processConfigureEncodings(b.data);else if("activeSpeaker"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processAudioAmplitude(b.data,!0);else if("stopSpeaking"===b.data.type)this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processAudioAmplitude(b.data,!1);else if("updateStream"===b.data.type)this.apiCCWebRTCClient&&b.data.callId&&b.data.mline&&b.data.direction&&this.apiCCWebRTCClient.webRTCClient.processUpdateStream(b.data.callId,b.data.mline,b.data.direction);else if("startRecording"===b.data.type){if(this.apiCCWebRTCClient)if("COMPOSITE"===b.data.callId)this.apiCCWebRTCClient.webRTCClient.MCUClient.startCompositeRecording(b.data.mediaType,b.data.customIdInFilename,b.data.convId,b.data.data);else{for(ue=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--ue>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[ue].callId===b.data.callId){he=!0;break}he?this.apiCCWebRTCClient.webRTCClient.MCUClient.startRecording(b.data.mediaType,b.data.customIdInFilename,b.data.convId,b.data.callId,b.data.data):m.info("cannot start recording (call not found)")}}else if("startStreaming"===b.data.type){if(this.apiCCWebRTCClient){for(ue=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--ue>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[ue].callId===b.data.callId){he=!0;break}he?this.apiCCWebRTCClient.webRTCClient.MCUClient.startStreaming(b.data.service,b.data.server,b.data.streamKey,b.data.callId):m.info("cannot start streaming (call not found)")}}else if("startCallStatsMonitoring"===b.data.type){if(this.apiCCWebRTCClient){for(m.debug("startCallStatsMonitoring",b.data.callId),ue=this.apiCCWebRTCClient.webRTCClient.callsTable.length;--ue>=0;)if(this.apiCCWebRTCClient.webRTCClient.callsTable[ue].callId===b.data.callId){le=this.apiCCWebRTCClient.webRTCClient.callsTable[ue];break}le?["chrome","firefox"].indexOf(n.wL.type)>=0?le.csmIntervalId?m.debug("call stats monitoring already started"):le.csmIntervalId=setInterval(le.callback(le,"csmHandler"),le.csmIntervalMs):m.debug("call stats are only supported on chrome and firefox"):m.debug("no such call")}}else"callOrder"===b.data.type?(m.log("callOrder received"),this.apiCCWebRTCClient?(this.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector=b.senderId,Z=this.apiCCWebRTCClient.webRTCClient.callWithNumber(b.data.caller,!0,{MCUType:"MCU-Callee",confId:b.data.confId,convId:b.data.convId},Se),this.apiCCWebRTCClient.webRTCClient.myWebRTC_Event.createIncomingCallEvent(this.clientId,b.data.caller,b.data.caller,Z,!1,1,!1,"video",!0,"web","media")):m.warn("WebRTCClient is not created")):"subscribeOrder"===b.data.type?(m.log("subscribeOrder received"),this.apiCCWebRTCClient?(this.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector=b.senderId,b.data.data.subscribeOrder=!0,(Ee=[]).push(b.data.stream),this.apiCCWebRTCClient.webRTCClient.MCUClient.subscribeToStreams(Ee,"VIDEO",b.data.data,Se,{noStreamCheck:!0})):m.warn("WebRTCClient is not created")):"distantCallEstablished"===b.data.type?this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processDistantCallEstablished(b.data):"simulcastFeedChanged"===b.data.type?this.apiCCWebRTCClient&&this.apiCCWebRTCClient.webRTCClient.processSimulcastFeedChanged(b.data):m.log("msg.data.type is not managed :"+b.data.type);else m.log("msg.data === undefined");else if("conversationListAnswer"===b.type)this.receiveConversationListAnswer(b);else if("contactOccurrencesFromConversationListAnswer"===b.type)this.receiveContactOccurrencesFromConversationListAnswer(b);else if("conversationDetailReport"===b.type)this.receiveConversationDetailReportAnswer(b);else if("updatePresence"===b.type)m.log("updatePresence"),this.updatePresence(b);else if("updateUserStatus"===b.type)m.log("updateUserStatus"),this.updateUserStatus(b);else if("receiveMCUSessionId"===b.type)m.log("receiveMCUSessionId"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionId(b):m.warn("WebRTCClient is not created");else if("joinSessionAnswer"===b.type)m.log("joinSessionAnswer"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionAnswer(b):m.warn("WebRTCClient is not created");else if("updateSessionAnswer"===b.type)m.log("updateSessionAnswer"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.updateSessionAnswer(b,{updateCalls:!0}):m.warn("WebRTCClient is not created");else if("availableStreams"===b.type)this.apiCCWebRTCClient?(m.log("message availableStreams received"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableStream(b.msg,"regular",function(Ve,et,_e){u.createMCUAvailableStreamEvent([et],Ve)}):m.warn("WebRTCClient is not created")):m.warn("WebRTCClient is not created");else if("availableReplay"===b.type)this.apiCCWebRTCClient?(m.log("message availableReplay received"),this.apiCCWebRTCClient?(x=this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableReplay(b.msg),u.createMCUAvailableReplayEvent(b.msg,x)):m.warn("WebRTCClient is not created")):m.warn("WebRTCClient is not created");else if("availableComposite"===b.type)this.apiCCWebRTCClient?(m.log("message availableComposite received"),this.apiCCWebRTCClient?(x=this.apiCCWebRTCClient.webRTCClient.MCUClient.newAvailableStream(b.msg,"composite"),u.createMCUAvailableCompositeEvent(b.msg,x)):m.warn("WebRTCClient is not created")):m.warn("WebRTCClient is not created");else if("onRemoveStream"===b.type)this.apiCCWebRTCClient?(m.log("message onRemoveStream received:",b),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.removeMCUStream(b.callId,b.msg.id,b.msg.reason):m.warn("WebRTCClient is not created")):m.warn("WebRTCClient is not created");else if("availableStreamsUpdate"===b.type)this.apiCCWebRTCClient?(m.log("message availableStreamsUpdate received"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.updateAvailableStream(b.msg,"regular",function(Ve,et,_e,gt){u.createMCUAvailableStreamUpdateEvent([et],Ve)}):m.warn("WebRTCClient is not created")):m.warn("WebRTCClient is not created");else if("checkCallStatus"===b.type)this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processCheckCallStatus(b):m.warn("WebRTCClient is not created");else if("MCUSessionInvitation"===b.type)m.log("MCUSessionInvitation"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(b):m.warn("WebRTCClient is not created");else if("MCUSessionInvitationToGroupChat"===b.type)m.log("MCUSessionInvitationToGroupChat"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(b):m.warn("WebRTCClient is not created");else if("participantEjected"===b.type)m.log("participantEjected"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.participantEjected(b):m.warn("WebRTCClient is not created");else if("recordingStarted"===b.type)m.log("recordingStarted"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStarted(b):m.warn("WebRTCClient is not created");else if("recordingStopped"===b.type)m.log("recordingStopped"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStopped(b):m.warn("WebRTCClient is not created");else if("recordingStreamAvailable"===b.type)m.log("recordingStreamAvailable"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.recordingStreamAvailable(b):m.warn("WebRTCClient is not created");else if("streamingStarted"===b.type)m.log("streamingStarted"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.streamingStarted(b):m.warn("WebRTCClient is not created");else if("streamingStopped"===b.type)m.log("streamingStopped"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.streamingStopped(b):m.warn("WebRTCClient is not created");else if("sessionId"===b.type)m.log("sessionId :"+b.sessionId),this.sessionId=b.sessionId;else if("roomCreation"===b.type)m.log("roomCreation"),this.roomMgr.roomCreation(b);else if("roomJoin"===b.type)m.log("roomJoined"),this.roomMgr.roomJoin(b);else if("inviteInRoomStatus"===b.type)m.log("inviteInRoomStatus"),this.roomMgr.inviteInRoomStatus(b);else if("contactListInRoom"===b.type)m.log("contactListInRoom"),this.roomMgr.onContactListInRoom(b);else if("roomInvitation"===b.type)m.log("roomInvitation"),this.roomMgr.roomInvitation(b);else if("roomMessage"===b.type)m.log("roomMessage"),this.roomMgr.receiveRoomMessage(b);else if("roomMemberUpdate"===b.type)m.log("roomMemberUpdate"),this.roomMgr.roomMemberUpdate(b);else if("agentReconnect"===b.type){var ze=this.apiCCWebRTCClient.webRTCClient.findCallWithCallId(b.callId);null!=ze&&ze.getUserMediaOnCall()}else"sequence"===b.type?(m.log("Sequential message"),this.handleSequentialMessage(b)):"Ack"===b.type?m.log("Ack received"):"error"===b.type?(m.log("error received"),u.createErrorEvent(b.errorInfo,b.errorCode,b.callId,b.roomId,null,null,b.convId)):"enterpriseConfig"===b.type?(m.log("enterpriseConfig received"),this.handleEnterpriseConfigMessage(b)):"AIEMessage"===b.type?(m.log("AIEMessage received"),this.handleAIEMessage(b)):"cloudEventOccurred"===b.type?this.processCloudEventOccurred(b):m.log("Error : No type for this message")},this.handleSequentialMessage=function(b){if(void 0!==b.id&&void 0!==b.packetNum&&void 0!==b.totalPacketsNum&&void 0!==b.data){m.debug("Handle sequential message packet "+b.packetNum+"/"+b.totalPacketsNum,b);var T=[];if(void 0!==c.sequentialMessagesStorage[b.id]&&(T=c.sequentialMessagesStorage[b.id]),T.push(b),c.sequentialMessagesStorage[b.id]=T,T.length===b.totalPacketsNum){T.sort(function(x,Se){return x.packetNum-Se.packetNum});var Z="";T.forEach(function(x){Z+=x.data}),delete c.sequentialMessagesStorage[b.id];var le=null;try{le=JSON.parse(Z)}catch(x){return void m.error("Error : can't parse sequential message JSON :",x)}if(!le)return void m.error("Error : can't restore sequential message, it's null");m.debug("Restored sequential message :",Z),c.processSignalingMessage(le)}}else m.error("Error : sequential message is inconsistent :",b)},this.handleEnterpriseConfigMessage=function(b){var T;if(m.debug("handleEnterpriseConfigMessage :",b),(0,n.ki)(b,"sentry","boolean")&&!0===b.sentry&&(T=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol&&"https:"!==window.location.protocol?"http":"https",apiCC.loadSentry(apiCC.initApiKey,T)),(0,n.ki)(b,"customJson","string")&&""!==b.customJson)try{m.debug("customJson :",b.customJson),b.customJson=JSON.parse(b.customJson)}catch(Z){m.error(Z)}if((0,n.ki)(b,"iceServers","string")&&""!==b.iceServers)try{m.debug("iceServers :",b.iceServers),b.iceServers=JSON.parse(b.iceServers),c.apiCCWebRTCClient.setPcConfig(b.iceServers)}catch(Z){m.error(Z)}(0,n.ki)(b,"logLevel","string")&&""!==b.logLevel&&!isNaN(parseInt(b.logLevel))&&apiRTC.setLogLevel(parseInt(b.logLevel)),(0,n.ki)(b,"ccs","object")&&(c.ccsInfo=Object.assign({},b.ccs))},this.handleAIEMessage=function(b){switch(m.debug("handleAIEMessage :",b),b.detail){case"modelLoaded":if(void 0!==apiCC&&void 0!==b.userMediaStreamId){var T=apiCC.getUserMediaStream(b.userMediaStreamId).mediaFilterManager;for(var Z in T.filters)void 0!==T.filters[Z]&&null!==T.filters[Z].streamAIE&&T.filters[Z].streamAIE.modelLoaded(b)}break;case"unknownModelName":m.error("Unknown model name :",b.modelName);break;case"loadModelError":m.error("Error while loading model :",b.info);break;default:m.debug("Unknown detail :",b.detail)}},this.fetchUserData=function(b){var Z;m.debug("fetchUserData"),Z=JSON.stringify({type:"fetchUserData",id:b.id,apiKey:b.apiKey,timeout:b.timeout}),m.log("C->S: "+Z),this.channel.socket.emit("fetchUserData",Z)}}},7323:(V,J,e)=>{"use strict";e.d(J,{q:()=>re}),e(4363),e(9653),e(3710),e(1539),e(9714),e(561),e(2564),e(4812),e(6992),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2707),e(7042),e(8309),e(9753),e(9554),e(4747),e(8674),e(1038),e(8783),e(2526),e(1817),e(2165),e(3948);var i=e(1549),d=e(5945),h=e(4708);e(2479),e(9070),e(8304),e(489),e(2419),e(8011);var w=function(){function K(){!function(ee,ce){if(!(ee instanceof ce))throw new TypeError("Cannot call a class as a function")}(this,K)}var ne;return(ne=[{key:"applyFilter",value:function(ee,ce){}},{key:"release",value:function(){}}])&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function M(K,L){return function(ne){if(Array.isArray(ne))return ne}(K)||function(ne,ee){var ce=null==ne?null:"undefined"!=typeof Symbol&&ne[Symbol.iterator]||ne["@@iterator"];if(null!=ce){var me,Te,ge=[],Ie=!0,we=!1;try{for(ce=ce.call(ne);!(Ie=(me=ce.next()).done)&&(ge.push(me.value),!ee||ge.length!==ee);Ie=!0);}catch(Pe){we=!0,Te=Pe}finally{try{Ie||null==ce.return||ce.return()}finally{if(we)throw Te}}return ge}}(K,L)||function(ne,ee){if(ne){if("string"==typeof ne)return C(ne,ee);var ce=Object.prototype.toString.call(ne).slice(8,-1);return"Object"===ce&&ne.constructor&&(ce=ne.constructor.name),"Map"===ce||"Set"===ce?Array.from(ne):"Arguments"===ce||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ce)?C(ne,ee):void 0}}(K,L)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(K,L){(null==L||L>K.length)&&(L=K.length);for(var ne=0,ee=new Array(L);ne<L;ne++)ee[ne]=K[ne];return ee}function n(K,L){var ne;return ne=(K/=255)<.09804?.001857/.09804*K:K<.2?.05807/.10196*(K-.09804)+.001857:K<.298?.1267/.09804*(K-.2)+.05993:K<.4?.1564/.10196*(K-.298)+.1866:K<.498?.1539/.09804*(K-.4)+.343:K<.6?.1601/.10196*(K-.498)+.4969:K<.698?.1506/.09804*(K-.6)+.657:K<.8?.1325/.10196*(K-.698)+.8076:K<.898?.05753/.09804*(K-.8)+.9401:.002403/.10196*(K-.898)+.9976,255*Math.pow(ne,L)}function y(K,L){return 255*Math.pow(K/255,L)}e(9743),e(7327);var R=function(){function K(ee,ce,me){(function(Te,ge){if(!(Te instanceof ge))throw new TypeError("Cannot call a class as a function")})(this,K),this.image=ee,this.width=ce,this.height=me,this.length=this.width*this.height}var ne;return ne=[{key:"mean",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]&&arguments[0],ce=0,me=0,Te=0;if(ee)for(var ge=0;ge<this.length;ge++)ce+=Math.pow(this.image.data[4*ge+0],2)/(255*this.length),me+=Math.pow(this.image.data[4*ge+1],2)/(255*this.length),Te+=Math.pow(this.image.data[4*ge+2],2)/(255*this.length);else for(var Ie=0;Ie<this.length;Ie++)ce+=this.image.data[4*Ie+0]/this.length,me+=this.image.data[4*Ie+1]/this.length,Te+=this.image.data[4*Ie+2]/this.length;return[ce,me,Te]}},{key:"mad",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]&&arguments[0],ce=this.mean(ee),me=M(ce,3),Te=me[0],ge=me[1],Ie=me[2],we=0,Pe=0,We=0;if(ee)for(var Je=0;Je<this.length;Je++)we+=Math.abs(Math.pow(this.image.data[4*Je+0],2)/255-Te)/this.length,Pe+=Math.abs(Math.pow(this.image.data[4*Je+1],2)/255-ge)/this.length,We+=Math.abs(Math.pow(this.image.data[4*Je+2],2)/255-Ie)/this.length;else for(var tt=0;tt<this.length;tt++)we+=Math.abs(this.image.data[4*tt+0]-Te)/this.length,Pe+=Math.abs(this.image.data[4*tt+1]-ge)/this.length,We+=Math.abs(this.image.data[4*tt+2]-Ie)/this.length;return[we,Pe,We]}},{key:"std",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]&&arguments[0],ce=this.mean(ee),me=M(ce,3),Te=me[0],ge=me[1],Ie=me[2],we=0,Pe=0,We=0;if(ee)for(var Je=0;Je<this.length;Je++)we+=Math.pow(Math.pow(this.image.data[4*Je+0],2)/255-Te,2)/this.length,Pe+=Math.pow(Math.pow(this.image.data[4*Je+1],2)/255-ge,2)/this.length,We+=Math.pow(Math.pow(this.image.data[4*Je+2],2)/255-Ie,2)/this.length;else for(var tt=0;tt<this.length;tt++)we+=Math.pow(this.image.data[4*tt+0]-Te,2)/this.length,Pe+=Math.pow(this.image.data[4*tt+1]-ge,2)/this.length,We+=Math.pow(this.image.data[4*tt+2]-Ie,2)/this.length;return[we=Math.sqrt(we),Pe=Math.sqrt(Pe),We=Math.sqrt(We)]}},{key:"blur",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,ce=new OffscreenCanvas(this.width,this.height),me=ce.getContext("2d");ce.width=this.width,ce.height=this.height,me.putImageData(this.image,0,0),me.filter="blur("+ee+"px)",me.drawImage(ce,0,0);var Te=me.getImageData(0,0,this.width,this.height);return Te}},{key:"threshold",value:function(ee,ce,me){var Te=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,ge=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Ie=new ImageData(this.image.data,this.width,this.height),we=0;if(ge){var Pe=we;we=Te,Te=Pe}for(var We=0;We<this.length;We++)Ie.data[4*We+0]=this.image.data[4*We+0]<ee?we:Te,Ie.data[4*We+1]=this.image.data[4*We+1]<ce?we:Te,Ie.data[4*We+2]=this.image.data[4*We+2]<me?we:Te;return Ie}},{key:"powerFilter",value:function(ee){var ce=new Uint8ClampedArray(4*this.length);if(1===ee)return this.image;for(var me=0;me<this.length;me++)ce[4*me+0]=y(this.image.data[4*me+0],ee),ce[4*me+1]=y(this.image.data[4*me+1],ee),ce[4*me+2]=y(this.image.data[4*me+2],ee),ce[4*me+3]=255;return new ImageData(ce,this.width,this.height)}},{key:"sigmoidFilter",value:function(ee){for(var ce=new Uint8ClampedArray(4*this.length),me=0;me<this.length;me++)ce[4*me+0]=n(this.image.data[4*me+0],ee),ce[4*me+1]=n(this.image.data[4*me+1],ee),ce[4*me+2]=n(this.image.data[4*me+2],ee),ce[4*me+3]=255;return new ImageData(ce,this.width,this.height)}},{key:"weightedSum",value:function(ee,ce){for(var me=new Uint8ClampedArray(4*this.length),Te=0;Te<this.length;Te++)me[4*Te+0]=ce*this.image.data[4*Te+0]+(1-ce)*ee.data[4*Te+0],me[4*Te+1]=ce*this.image.data[4*Te+1]+(1-ce)*ee.data[4*Te+1],me[4*Te+2]=ce*this.image.data[4*Te+2]+(1-ce)*ee.data[4*Te+2],me[4*Te+3]=255;return new ImageData(me,this.width,this.height)}},{key:"weightedSumMask",value:function(ee,ce){for(var me=new Uint8ClampedArray(4*this.length),Te=0;Te<this.length;Te++){var ge=ce.data[4*Te]/255;me[4*Te+0]=ge*this.image.data[4*Te+0]+(1-ge)*ee.data[4*Te+0],me[4*Te+1]=ge*this.image.data[4*Te+1]+(1-ge)*ee.data[4*Te+1],me[4*Te+2]=ge*this.image.data[4*Te+2]+(1-ge)*ee.data[4*Te+2],me[4*Te+3]=255}return new ImageData(me,this.width,this.height)}}],ne&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function m(K,L){if(!(K instanceof L))throw new TypeError("Cannot call a class as a function")}var f=function(){function K(){var ee=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],ce=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Te=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;m(this,K),this.blurMask=ee,this.smoothBorder=ce,this.blurFactor=me,this.smoothingFactor=Te,this.maskImage=null,this.net=null}var ne;return ne=[{key:"loadModel",value:function(){var ee=this;return new Promise(function(ce,me){bodyPix.load({architecture:"MobileNetV1",outputStride:16,multiplier:.75,quantBytes:2}).then(function(Te){ee.net=Te,ce()})})}},{key:"computeMask",value:function(ee){var ce=this;return new Promise(function(me,Te){ce.net.segmentPerson(ee).then(function(ge){ce.width=ge.width,ce.height=ge.height,ce.length=ce.width*ce.height;for(var Ie=new Uint8ClampedArray(4*ce.length),we=0;we<ce.length;we++){var Pe=255*ge.data[we];Ie[4*we+0]=Pe,Ie[4*we+1]=Pe,Ie[4*we+2]=Pe,Ie[4*we+3]=255}var We=document.createElement("canvas"),Je=We.getContext("2d");We.width=ce.width,We.height=ce.height;var tt=new ImageData(Ie,ce.width,ce.height);if(Je.putImageData(tt,0,0),ce.blurMask&&(Je.filter="blur("+ce.blurFactor+"px)"),Je.drawImage(We,0,0,ce.width,ce.height),ce.maskImage=Je.getImageData(0,0,ce.width,ce.height),ce.blurMask)if(ce.smoothBorder){if(-1!==ce.smoothingFactor){var Ft=new R(ce.maskImage,ce.width,ce.height);ce.maskImage=Ft.sigmoidFilter(ce.smoothingFactor)}}else{var si=new R(ce.maskImage,ce.width,ce.height);ce.maskImage=si.threshold(40,40,40,255,!1)}me(ce.maskImage)})})}},{key:"applyTransparency",value:function(ee){var ce=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===ce&&(ce=this.maskImage);for(var me=new Uint8ClampedArray(ee.width*ee.height*4),Te=0;Te<ee.width*ee.height;Te++)me[4*Te+0]=ee.data[4*Te+0],me[4*Te+1]=ee.data[4*Te+1],me[4*Te+2]=ee.data[4*Te+2],me[4*Te+3]=ce.data[4*Te];var ge=new ImageData(me,ee.width,ee.height);return ge}},{key:"superposeImages",value:function(ee,ce,me){var Te=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null===Te&&(Te=this.maskImage);var ge=new R(ce,ee.width,ee.height),Ie=ge.weightedSumMask(me,Te);return Ie}},{key:"setBackground",value:function(ee,ce){var me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.superposeImages(ee,ee,ce,me)}},{key:"blurBackground",value:function(ee){var ce=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Te=new R(ee,ee.width,ee.height),ge=Te.blur(ce);return this.setBackground(ee,ge,me)}}],ne&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function I(K,L){if(!(K instanceof L))throw new TypeError("Cannot call a class as a function")}var j=i.Y.get("StreamSegmentation"),q=apiCC.myWebRTC_Event,b=function(){function K(ee){var ce=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:360,Te=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;I(this,K),this.mediaStream=ee,this.backgroundMode="none",this.backgroundBlurFactor=10,this.canvasWidth=ce,this.canvasHeight=me,this.length=this.canvasWidth*this.canvasHeight,this.userMediaStreamId=Te;for(var ge=new Uint8ClampedArray(4*this.length),Ie=0;Ie<4*this.length;Ie++)ge[Ie]=255;this.backgroundImage=new ImageData(ge,this.canvasWidth,this.canvasHeight);var we=!0,Pe=!0,We=5,Je=-1;this.backSub=new f(we,Pe,We,Je),this.modelLoaded=!1,this.maskStreamLaunched=!1,this.backgroundSubtractionActivated=!1}var ne;return ne=[{key:"setBackgroundMode",value:function(ee){this.backgroundMode=ee}},{key:"setBackgroundImage",value:function(ee){this.backgroundImage=ee}},{key:"setBackgroundBlurFactor",value:function(ee){this.backgroundBlurFactor=ee}},{key:"loadModel",value:function(){j.debug("Loading model");var ee=this;return new Promise(function(ce,me){ee.backSub.loadModel().then(function(Te){ee.modelLoaded=!0,j.debug("Model loaded"),ce()})})}},{key:"getMaskStream",value:function(){var ee=document.createElement("video");ee.srcObject=this.mediaStream;var ce=document.createElement("canvas"),me=ce.getContext("2d");ce.width=this.canvasWidth,ce.height=this.canvasHeight;var Te=document.createElement("canvas"),ge=Te.getContext("2d");Te.width=this.canvasWidth,Te.height=this.canvasHeight;var Ie=this;ee.addEventListener("loadeddata",function(){ee.play(),requestAnimationFrame(Pi),Ie.modelLoaded?tt=!0:Ie.loadModel().then(function(yi){tt=!0})});for(var we=!0,Pe=new Uint8ClampedArray(4*this.length),We=0;We<4*this.length;We++)Pe[We]=255;var Je=new ImageData(Pe,this.canvasWidth,this.canvasHeight);ge.putImageData(Je,0,0);var tt=!1,Ft=0,si=!0;function Pi(){me.drawImage(ee,0,0,ce.width,ce.height);var yi=me.getImageData(0,0,ce.width,ce.height);if(Ie.modelLoaded&&we&&tt&&(si||"none"!==Ie.backgroundMode)){si&&(si=!1);var Ti=new Date;we=!1,Ie.backSub.computeMask(yi).then(function(_i){we=!0,1/((new Date-Ti)/1e3)<1&&++Ft>=10&&(tt=!1,j.error("The segmentation process cannot be handled"),q.createBackgroundSubstractionStopComputeTimeEvent(Ie.userMediaStreamId))})}ge.putImageData(Ie.modelLoaded&&null!==Ie.backSub.maskImage&&tt?Ie.backSub.maskImage:Je,0,0),Ie.continueMaskComputation?requestAnimationFrame(Pi):(j.debug("Mask computation stoped"),Ie.continueMaskComputation=!0)}return this.continueMaskComputation=!0,this.maskMediaStream=Te.captureStream(),this.maskStreamLaunched=!0,this.maskMediaStream}},{key:"activateBackgroundSubtraction",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==ee&&this.setBackgroundMode(ee),this.backgroundSubtractionActivated)return this.processedMediaStream;this.maskStreamLaunched||this.getMaskStream();var ce=document.createElement("video");ce.srcObject=this.mediaStream;var me=document.createElement("video");me.srcObject=this.maskMediaStream;var Te=document.createElement("canvas"),ge=Te.getContext("2d");Te.width=this.canvasWidth,Te.height=this.canvasHeight;var Ie=document.createElement("canvas"),we=Ie.getContext("2d");Ie.width=this.canvasWidth,Ie.height=this.canvasHeight,this.continueBackgroundSubtraction=!0;var Pe=this;function We(){ge.drawImage(ce,0,0,Te.width,Te.height);var Je=ge.getImageData(0,0,Te.width,Te.height);if("none"===Pe.backgroundMode)we.putImageData(Je,0,0);else{ge.drawImage(me,0,0,Te.width,Te.height);var tt=ge.getImageData(0,0,Te.width,Te.height),Ft=null;switch(Pe.backgroundMode){case"image":Ft=Pe.backSub.setBackground(Je,Pe.backgroundImage,tt);break;default:Ft=Pe.backSub.blurBackground(Je,Pe.backgroundBlurFactor,tt);break;case"transparent":Ft=Pe.backSub.applyTransparency(Je,tt)}we.putImageData(Ft,0,0)}Pe.continueBackgroundSubtraction?requestAnimationFrame(We):(j.debug("Mask application stoped"),Pe.continueBackgroundSubtraction=!0)}return ce.addEventListener("loadeddata",function(){ce.play(),me.play(),requestAnimationFrame(We)}),this.processedMediaStream=Ie.captureStream(30),this.backgroundSubtractionActivated=!0,this.processedMediaStream}},{key:"deactivateBackgroundSubtraction",value:function(){this.setBackgroundMode("none"),this.processedMediaStream=this.mediaStream,this.backgroundSubtractionActivated=!1,this.continueBackgroundSubtraction=!1,this.maskMediaStream=null,this.maskStreamLaunched=!1,this.continueMaskComputation=!1}}],ne&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function T(K){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(K)}function le(K,L){return(le=Object.setPrototypeOf||function(ne,ee){return ne.__proto__=ee,ne})(K,L)}function x(K,L){if(L&&("object"===T(L)||"function"==typeof L))return L;if(void 0!==L)throw new TypeError("Derived constructors may only return object or undefined");return function(ne){if(void 0===ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne}(K)}function Se(K){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(L){return L.__proto__||Object.getPrototypeOf(L)})(K)}var Ee=i.Y.get("OldMediaFilterBackgroundSubtraction"),he=function(K){!function(ge,Ie){if("function"!=typeof Ie&&null!==Ie)throw new TypeError("Super expression must either be null or a function");ge.prototype=Object.create(Ie&&Ie.prototype,{constructor:{value:ge,writable:!0,configurable:!0}}),Ie&&le(ge,Ie)}(Te,K);var ne,ee,ce,me=(ee=Te,ce=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ge){return!1}}(),function(){var ge,Ie=Se(ee);if(ce){var we=Se(this).constructor;ge=Reflect.construct(Ie,arguments,we)}else ge=Ie.apply(this,arguments);return x(this,ge)});function Te(){var ge;return function(Ie,we){if(!(Ie instanceof we))throw new TypeError("Cannot call a class as a function")}(this,Te),(ge=me.call(this)).streamSegmentation=null,ge.userMediaStreamId=null,ge}return(ne=[{key:"applyFilter",value:function(ge,Ie){var we=this;Ee.debug("Apply filter with descriptor:",Ie);var Pe=ge.getAudioTracks();Pe.length>0&&Pe.forEach(function(tt){ge.removeTrack(tt)});var We=ge.getVideoTracks();if(0===We.length)return Promise.reject("MediaStream has no video tracks");var Je=We[0].getSettings();return void 0!==Ie.options&&void 0!==Ie.options.userMediaStreamId&&(this.userMediaStreamId=Ie.options.userMediaStreamId),this.streamSegmentation=new b(ge,Je.width,Je.height,this.userMediaStreamId),this.loadTensorflow().then(function(tt){return we.loadTensorflowModel()}).then(function(tt){return new Promise(function(Ft,si){Ee.debug("Model loading..."),we.streamSegmentation.loadModel().then(function(Pi){Ee.debug("Model loaded");var yi=null;void 0!==Ie.options&&void 0!==Ie.options.backgroundMode&&("image"===Ie.options.backgroundMode&&Ie.options.image instanceof ImageData&&we.streamSegmentation.setBackgroundImage(Ie.options.image),yi=Ie.options.backgroundMode);var Ti=we.streamSegmentation.activateBackgroundSubtraction(yi);Pe.forEach(function(_i){Ti.addTrack(_i)}),Ft(Ti)})})}).catch(function(tt){return Promise.reject(tt)})}},{key:"release",value:function(){this.streamSegmentation.deactivateBackgroundSubtraction(),this.streamSegmentation=null}},{key:"loadTensorflow",value:function(){return Ee.debug("Tensorflow script loading..."),new Promise(function(ge,Ie){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"],"tensorflow",{async:!0,numRetries:20,reqdelay:200,success:function(){Ee.debug("Tensorflow script loaded"),ge()},error:function(Pe){Ie("Resources loading failed, depsNotFound: "+Pe)},retrycb:function(Pe,We){Ee.warn("Tensorflow loading retry :"+Pe+" ,delay before retry :"+We)}})})}},{key:"loadTensorflowModel",value:function(){return Ee.debug("Tensorflow model script loading..."),new Promise(function(ge,Ie){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"],"tensorflow-model",{async:!0,numRetries:20,reqdelay:200,success:function(){Ee.debug("Tensorflow model script loaded"),ge()},error:function(Pe){Ie("Resources loading failed, depsNotFound: "+Pe)},retrycb:function(Pe,We){Ee.warn("Tensorflow model loading retry :"+Pe+" ,delay before retry :"+We)}})})}}])&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(Te.prototype,ne),Te}(w);function ue(K,L){var ne="undefined"!=typeof Symbol&&K[Symbol.iterator]||K["@@iterator"];if(!ne){if(Array.isArray(K)||(ne=function(Ie,we){if(Ie){if("string"==typeof Ie)return ke(Ie,void 0);var Pe=Object.prototype.toString.call(Ie).slice(8,-1);return"Object"===Pe&&Ie.constructor&&(Pe=Ie.constructor.name),"Map"===Pe||"Set"===Pe?Array.from(Ie):"Arguments"===Pe||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Pe)?ke(Ie,void 0):void 0}}(K))||L&&K&&"number"==typeof K.length){ne&&(K=ne);var ee=0,ce=function(){};return{s:ce,n:function(){return ee>=K.length?{done:!0}:{done:!1,value:K[ee++]}},e:function(Ie){throw Ie},f:ce}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var me,Te=!0,ge=!1;return{s:function(){ne=ne.call(K)},n:function(){var Ie=ne.next();return Te=Ie.done,Ie},e:function(Ie){ge=!0,me=Ie},f:function(){try{Te||null==ne.return||ne.return()}finally{if(ge)throw me}}}}function ke(K,L){(null==L||L>K.length)&&(L=K.length);for(var ne=0,ee=new Array(L);ne<L;ne++)ee[ne]=K[ne];return ee}function Ne(K){return(K[2]-K[0])*(K[3]-K[1])}function ze(K,L){var ee=K[1],ce=K[2],me=K[3],ge=L[1],Ie=L[2],we=L[3],Pe=Ne([Math.max(K[0],L[0]),Math.max(ee,ge),Math.min(ce,Ie),Math.min(me,we)]);return Pe/(Ne(K)+Ne(L)-Pe)}function Ve(K){var L,ne=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,ee=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,ce=K.yolo,me={yolo:[]},Te=ue(ce);try{for(Te.s();!(L=Te.n()).done;){var ge=L.value,Ie=ge.objectness;if(Ie>ne)if(null!==ee){var we,Pe=ge.bounding_box,We=Ne(Pe),Je=0,tt=null,Ft=0,si=ue(ce);try{for(si.s();!(we=si.n()).done;){var Pi=we.value,yi=Pi.bounding_box,Ti=ze(Pe,yi);1!==Ti&&Ti>Je&&(Je=Ti,tt=Pi,Ft=Ne(Pi.bounding_box))}}catch(_i){si.e(_i)}finally{si.f()}(null===tt||Je<ee||Ft<We)&&me.yolo.push(ge)}else me.yolo.push(ge)}}catch(_i){Te.e(_i)}finally{Te.f()}return me}function et(K,L){var ne,ee=K.yolo,ce={yolo:[]},me=ue(L.yolo);try{for(me.s();!(ne=me.n()).done;){var Te,ge=ne.value,Ie=ge.class,we=ge.bounding_box,Pe=ge.objectness,We=Pe,Je=ue(ee);try{for(Je.s();!(Te=Je.n()).done;){var tt=Te.value;if(tt.class===Ie){var Ft=ze(tt.bounding_box,we);Ft>0&&(We=Pe+.75*(1-Pe)*Ft*tt.objectness)}}}catch(Pi){Je.e(Pi)}finally{Je.f()}ce.yolo.push({class:Ie,objectness:We,bounding_box:we})}}catch(Pi){me.e(Pi)}finally{me.f()}return ce}function _e(K,L){return function(ne){if(Array.isArray(ne))return ne}(K)||function(ne,ee){var ce=null==ne?null:"undefined"!=typeof Symbol&&ne[Symbol.iterator]||ne["@@iterator"];if(null!=ce){var me,Te,ge=[],Ie=!0,we=!1;try{for(ce=ce.call(ne);!(Ie=(me=ce.next()).done)&&(ge.push(me.value),!ee||ge.length!==ee);Ie=!0);}catch(Pe){we=!0,Te=Pe}finally{try{Ie||null==ce.return||ce.return()}finally{if(we)throw Te}}return ge}}(K,L)||function(ne,ee){if(ne){if("string"==typeof ne)return gt(ne,ee);var ce=Object.prototype.toString.call(ne).slice(8,-1);return"Object"===ce&&ne.constructor&&(ce=ne.constructor.name),"Map"===ce||"Set"===ce?Array.from(ne):"Arguments"===ce||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ce)?gt(ne,ee):void 0}}(K,L)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(K,L){(null==L||L>K.length)&&(L=K.length);for(var ne=0,ee=new Array(L);ne<L;ne++)ee[ne]=K[ne];return ee}e(4916),e(3123),e(4723),e(6699),e(2023),e(9720),e(9600),e(1058);var ot=i.Y.get("StreamAIE"),at=apiCC.myWebRTC_Event,yt=function(){function K(ee,ce){(function(Te,ge){if(!(Te instanceof ge))throw new TypeError("Cannot call a class as a function")})(this,K),this.mediaStream=ee,this.descriptorOptions=ce,this.modelName=ce.modelName,this.maxBoxes=ce.maxBoxes||null,this.scoreThresh=ce.scoreThresh||null,this.forceReload=ce.forceReload||!1,this.classFilter=this.descriptorOptions.classFilter||"all",this.drawingConfig=this.descriptorOptions.drawingConfig||{},this.userMediaStreamId=ce.userMediaStreamId,this.clientId=ce.clientId;var me=this.mediaStream.getVideoTracks();0===me.length&&(this.mediaSettings=null),this.mediaSettings=me[0].getSettings(),this.canvasWidth=this.mediaSettings.width||480,this.canvasHeight=this.mediaSettings.height||480,this.length=this.canvasWidth*this.canvasHeight,this.snapshot=!1,this.log=!1,this.minSnapshotPeriod=0,this.memoryTime=0,this.lastAnnotations={yolo:[]},this.lastRawAnnotations={yolo:[]},this.objectDetectionActivated=!1,this.drawAnnotationsBool=!1,this.aieUrl=null,this.token=null,this.loadedModel=null,this.promises=[],this.isReleased=!1,this.resinzingSize=416,this.callId=null}var ne;return ne=[{key:"activateLogs",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.memoryTime=ee,this.log=!0}},{key:"stopLogs",value:function(){this.log=!1,this.memoryTime=0}},{key:"activateSnapshots",value:function(){var ee=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.snapshot=!0,this.minSnapshotPeriod=ee}},{key:"stopSnapshots",value:function(){this.snapshot=!1,this.minSnapshotPeriod=0}},{key:"activateAnnotations",value:function(){this.lastAnnotations={yolo:[]},this.drawAnnotationsBool=!0,this.getAnnotations()}},{key:"stopAnnotations",value:function(){this.drawAnnotationsBool=!1}},{key:"getAnnotations",value:function(){var ee=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],ce=document.createElement("video");ce.srcObject=this.mediaStream;var me=document.createElement("canvas"),Te=me.getContext("2d");me.width=this.canvasWidth,me.height=this.canvasHeight;var ge=document.createElement("canvas"),Ie=ge.getContext("2d");ge.width=this.canvasWidth,ge.height=this.canvasHeight;var we=this;function Pe($t,ni){for(var ai=$t.split(","),Ci=ai[0].match(/:(.*?);/)[1],Ii=atob(ai[1]),wi=Ii.length,Ei=new Uint8Array(wi);wi--;)Ei[wi]=Ii.charCodeAt(wi);return new File([Ei],ni,{type:Ci})}ce.addEventListener("loadeddata",function(){ce.play(),requestAnimationFrame(function(){ki(we.aieUrl,we.token,we.loadedModel)})});var We=!0,Je={},tt=null,Ft=new Date;function si($t,ni,ai){var Ci=Pe(me.toDataURL("image/jpeg")),Ii={pipelineCallId:we.getOrCreatePipeline(),file:Ci,transferType:"plugin",pluginName:"httpPost",pluginData:{url:$t,headers:{Authorization:"Token "+ni},formData:{file:"$DATA",angled:1,model:ai,size:we.resinzingSize}}};apiCC.session.apiCCWebRTCClient.webRTCClient.pushData(null,Ii,null,{success:function(wi){var Ei=(new Date-tt)/1e3;return ot.debug("Computation time:",Ei,"s ,FPS:",1/Ei),ki($t,ni,ai),void 0!==wi.data.error?ot.error("http post error :",wi.data.error):void 0===wi.data.result?ot.error("An error occured when trying to annotate a snapshot"):void Pi(wi.data)},failure:function(wi,Ei,Ai){ot.error("## pushData:failure",Ei,Ai,wi)}})}function Pi($t){var ni=$t.result;we.isReleased||(we.lastRawAnnotations=ni,void 0!==ni.yolo&&Ti(ni),void 0===ni.ocr&&void 0===ni.codes||yi(ni))}function yi($t){we.lastAnnotations={ocr:$t.ocr,codes:$t.codes};var ni="";if($t.ocr.length>1){ni+="Words found : ";for(var ai=0;ai<$t.ocr.length;ai++)ni=ni+$t.ocr[ai].text+", "}if($t.codes.length>1){ni+="Codes found : ";for(var Ci=0;Ci<$t.codes.length;Ci++)ni=ni+$t.codes[Ci].code+", "}_i(ni),Zi()}function Ti($t){$t.yolo.length>0&&(ee&&($t=et(we.lastRawAnnotations,$t)),null!==we.scoreThresh&&($t=Ve($t,we.scoreThresh)));for(var ni={yolo:[]},ai={},Ci=we.classFilter.split(", "),Ii=0;Ii<$t.yolo.length;Ii++){var wi=$t.yolo[Ii];("all"===we.classFilter||Ci.includes(wi.class))&&(wi.class in ai||(ai[wi.class]=0),ai[wi.class]+=1,ni.yolo.push(wi))}if(we.lastAnnotations=$t=ni,we.log||we.snapshot){for(var Ei=new Date,Ai=[],Vi=0,cn=Object.entries(ai);Vi<cn.length;Vi++){var Hi=_e(cn[Vi],2),Ji=Hi[0];Ai.push(Hi[1]+" "+Ji+"(s) detected."),(!(Ji in Je)||Ei-Je[Ji]>1e3*we.memoryTime)&&(Je[Ji]=Ei)}var hn=Ai.sort().join(" ");""!==hn&&(_i(hn),Zi())}}function _i($t){we.log&&at.createAIELogEvent(we.userMediaStreamId,$t)}function Zi(){if(we.snapshot){var $t=new Date,ni=Te.getImageData(0,0,me.width,me.height);if($t-Ft>1e3*we.minSnapshotPeriod){Ie.putImageData(ni,0,0),we.drawAnnotations(we.lastAnnotations,Ie,we.drawingConfig);var ai=ge.toDataURL("image/png"),Ci=new Image;Ci.src=ai,at.createAIESnapshotEvent(we.userMediaStreamId,Ci),Ft=$t}}}function ki($t,ni,ai){Te.drawImage(ce,0,0,me.width,me.height),(We||we.drawAnnotationsBool)&&(We&&(We=!1),tt=new Date,si($t,ni,ai))}}},{key:"getOrCreatePipeline",value:function(){if(null!==this.callId)return this.callId;var ee=this;return this.callId=apiCC.session.apiCCWebRTCClient.webRTCClient.pushData(null,{transferType:"pipeline"},null,{failure:function(ce){"dataChannelClosed"===ce?(ot.debug("dataChannelClosed : no activity on dataChannel timeout"),ee.callId=null):ot.error("dataChannel failure",ce)}}),this.callId}},{key:"drawAnnotations",value:function(ee,ce){var me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Te=me.color||"#ED5131",ge=me.textColor||"#FFFFFF",Ie=me.colorMap||null,we=me.lineWidth||3,Pe=me.font||"15px Arial";if(void 0!==ee.yolo&&ee.yolo.length>0){null===me&&(me={});for(var We=0;We<ee.yolo.length;We++){var Je=ee.yolo[We],tt=Je.bounding_box,Ft=tt[0],si=tt[1],Pi=tt[2],yi=tt[3];"mask_augmented_refined"===this.modelName&&(Pi-=Ft,yi-=si);var Ti=Te;null!==Ie&&Je.class in Ie&&(Ti=Ie[Je.class]),ce.lineWidth=we,ce.strokeStyle=Ti,ce.strokeRect(Ft,si,Pi,yi),ce.font=Pe;var _i=parseInt(Pe,10),Zi=Je.class,ki=ce.measureText(Zi).width;ce.fillStyle=Ti,ce.fillRect(Ft-we/2,si-Math.round(4*_i/3),ki+_i+we,Math.round(4*_i/3)),ce.fillStyle=ge,ce.fillText(Zi,Ft+Math.round(_i/2)-we/2,si-Math.round(_i/2))}}if(void 0!==ee.ocr&&ee.ocr.length>0){null===me&&(me={}),Pe=me.font||"25px Arial";for(var $t=0;$t<ee.ocr.length;$t++){var ni=ee.ocr[$t],ai=ni.bounding_box,Ci=ai[0],Ii=ai[1],wi=ai[2],Ei=ai[3];"mask_augmented_refined"===this.modelName&&(wi-=Ci,Ei-=Ii),ce.lineWidth=we,ce.strokeStyle=Te,ce.strokeRect(Ci,Ii,wi,Ei),ce.font=Pe;var Ai=parseInt(Pe,10),Vi=ni.text,cn=ce.measureText(Vi).width;ce.fillStyle=Te,ce.fillRect(Ci-we/2,Ii-Math.round(4*Ai/3),cn+Ai+we,Math.round(4*Ai/3)),ce.fillStyle=ge,ce.fillText(Vi,Ci+Math.round(Ai/2)-we/2,Ii-Math.round(Ai/2))}}if(void 0!==ee.codes&&ee.codes.length>0){null===me&&(me={}),Pe=me.font||"25px Arial";for(var Hi=0;Hi<ee.codes.length;Hi++){var Ji=ee.codes[Hi],un=Ji.bounding_box,hn=un[0],Di=un[1],en=un[2],In=un[3];"mask_augmented_refined"===this.modelName&&(en-=hn,In-=Di),ce.lineWidth=we,ce.strokeStyle=Te,ce.strokeRect(hn,Di,en,In),ce.font=Pe;var Yi=parseInt(Pe,10),xn=Ji.code,Nn=ce.measureText(xn).width;ce.fillStyle=Te,ce.fillRect(hn-we/2,Di-Math.round(4*Yi/3),Nn+Yi+we,Math.round(4*Yi/3)),ce.fillStyle=ge,ce.fillText(xn,hn+Math.round(Yi/2)-we/2,Di-Math.round(Yi/2))}}}},{key:"activateObjectDetection",value:function(){if(this.objectDetectionActivated)return this.processedMediaStream;var ee=document.createElement("video");ee.srcObject=this.mediaStream;var ce=document.createElement("canvas"),me=ce.getContext("2d");ce.width=this.canvasWidth,ce.height=this.canvasHeight;var Te=document.createElement("canvas"),ge=Te.getContext("2d");Te.width=this.canvasWidth,Te.height=this.canvasHeight;var Ie=this;function we(){me.drawImage(ee,0,0,ce.width,ce.height);var Pe=me.getImageData(0,0,ce.width,ce.height);ge.putImageData(Pe,0,0),Ie.drawAnnotationsBool&&Ie.drawAnnotations(Ie.lastAnnotations,ge,Ie.drawingConfig),requestAnimationFrame(we)}return ee.addEventListener("loadeddata",function(){ee.play(),requestAnimationFrame(we)}),this.processedMediaStream=Te.captureStream(),this.objectDetectionActivated=!0,this.processedMediaStream}},{key:"loadModel",value:function(){var ee=this;return new Promise(function(ce,me){ot.debug("loading model"),ee.sendMessage({modelName:ee.modelName,maxBoxes:ee.maxBoxes,scoreThresh:ee.scoreThresh,forceReload:ee.forceReload},"AIELoadModel",ce,me)})}},{key:"sendMessage",value:function(ee,ce,me,Te){var ge=setTimeout(Te,5e3);this.promises.push({timeout:ge,resolve:me}),ee.timeout=ge,this.sendMessageToCCS(ee,ce)}},{key:"sendMessageToCCS",value:function(ee,ce){if(ee.userMediaStreamId=this.userMediaStreamId,ee.clientId=this.clientId,ee.data={pubSub:"AieConnector"},ee.type=ce,void 0!==apiCC){var me=apiCC.session.apiCCWebRTCClient.webRTCClient.socket;try{var Te=JSON.stringify(ee);me.emit(ce,Te)}catch(ge){ot.error("JSON Stringify error : ",ge)}}}},{key:"modelLoaded",value:function(ee){ot.debug("Loaded model name :",ee.modelName),this.aieUrl=ee.url,this.loadedModel=ee.modelName,this.token=ee.token;var ce=this.activateObjectDetection();this.promises.forEach(function(me){ee.timeout===me.timeout&&(clearTimeout(me.timeout),me.resolve(ce))})}},{key:"release",value:function(){this.isReleased=!0,this.stopLogs(),this.stopSnapshots(),this.stopAnnotations(),this.sendMessageToCCS({},"AIELogout")}}],ne&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function Et(K){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(K)}function dt(K,L){return(dt=Object.setPrototypeOf||function(ne,ee){return ne.__proto__=ee,ne})(K,L)}function Mt(K,L){if(L&&("object"===Et(L)||"function"==typeof L))return L;if(void 0!==L)throw new TypeError("Derived constructors may only return object or undefined");return function(ne){if(void 0===ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne}(K)}function Rt(K){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(L){return L.__proto__||Object.getPrototypeOf(L)})(K)}var je=i.Y.get("MediaFilterAIE"),xt=function(K){!function(ge,Ie){if("function"!=typeof Ie&&null!==Ie)throw new TypeError("Super expression must either be null or a function");ge.prototype=Object.create(Ie&&Ie.prototype,{constructor:{value:ge,writable:!0,configurable:!0}}),Ie&&dt(ge,Ie)}(Te,K);var ne,ee,ce,me=(ee=Te,ce=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ge){return!1}}(),function(){var ge,Ie=Rt(ee);if(ce){var we=Rt(this).constructor;ge=Reflect.construct(Ie,arguments,we)}else ge=Ie.apply(this,arguments);return Mt(this,ge)});function Te(){var ge;return function(Ie,we){if(!(Ie instanceof we))throw new TypeError("Cannot call a class as a function")}(this,Te),(ge=me.call(this)).userMediaStreamId=null,ge.streamAIE=null,ge}return(ne=[{key:"applyFilter",value:function(ge,Ie){var we=this;return new Promise(function(Pe,We){if(je.debug("Apply filter with descriptor :",Ie),void 0===Ie.options&&We("Filter options object required"),void 0===Ie.options.modelName)We("modelName options required");else{var Je=ge.getAudioTracks();Je.length>0&&Je.forEach(function(tt){ge.removeTrack(tt)}),we.streamAIE=new yt(ge,Ie.options),we.streamAIE.loadModel().then(function(tt){Je.forEach(function(Ft){tt.addTrack(Ft)}),Pe(tt)}).catch(function(tt){We(tt)})}})}},{key:"release",value:function(){this.streamAIE.release()}}])&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(Te.prototype,ne),Te}(w);function Wt(K){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(K)}function kt(K,L){return(kt=Object.setPrototypeOf||function(ne,ee){return ne.__proto__=ee,ne})(K,L)}function Xe(K,L){if(L&&("object"===Wt(L)||"function"==typeof L))return L;if(void 0!==L)throw new TypeError("Derived constructors may only return object or undefined");return function(ne){if(void 0===ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne}(K)}function zt(K){return(zt=Object.setPrototypeOf?Object.getPrototypeOf:function(L){return L.__proto__||Object.getPrototypeOf(L)})(K)}var G=i.Y.get("MediaFilterBackgroundSubstraction"),A=function(K){!function(ge,Ie){if("function"!=typeof Ie&&null!==Ie)throw new TypeError("Super expression must either be null or a function");ge.prototype=Object.create(Ie&&Ie.prototype,{constructor:{value:ge,writable:!0,configurable:!0}}),Ie&&kt(ge,Ie)}(Te,K);var ne,ee,ce,me=(ee=Te,ce=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ge){return!1}}(),function(){var ge,Ie=zt(ee);if(ce){var we=zt(this).constructor;ge=Reflect.construct(Ie,arguments,we)}else ge=Ie.apply(this,arguments);return Xe(this,ge)});function Te(){var ge;return function(Ie,we){if(!(Ie instanceof we))throw new TypeError("Cannot call a class as a function")}(this,Te),(ge=me.call(this)).mediaStream=null,ge.mediaStreamSettings=null,ge.processedMediaStream=null,ge.net=null,ge.lossRatio=null,ge.processBackground=!1,ge.bgImageData=null,ge.videoElement=document.createElement("video"),ge.canvas=document.createElement("canvas"),ge.canvasContext=ge.canvas.getContext("2d"),ge}return(ne=[{key:"applyFilter",value:function(ge,Ie){var we=this;return new Promise(function(Pe,We){var Je=ge.getAudioTracks();Je.length>0&&Je.forEach(function(tt){ge.removeTrack(tt)}),we.loadTensorflow().then(function(){we.loadTensorflowModel().then(function(){we.videoElement.srcObject=ge;var tt=we;we.videoElement.addEventListener("loadeddata",function(){tt.videoElement.play(),tt.mediaStream=ge,tt.descriptors=Ie,tt.processedMediaStream=tt.canvas.captureStream(),tt.mediaStreamSettings=tt.mediaStream.getVideoTracks()[0].getSettings(),tt.videoElement.height=240,tt.lossRatio=tt.mediaStreamSettings.height/tt.videoElement.height,tt.videoElement.width=tt.videoElement.height*tt.mediaStreamSettings.aspectRatio,tt.videoElement.onplaying=function(){tt.canvas.height=tt.videoElement.videoHeight,tt.canvas.width=tt.videoElement.videoWidth},tt.loadBodyPix().then(function(){Je.forEach(function(Ft){tt.processedMediaStream.addTrack(Ft)}),Pe(tt.processedMediaStream)}).catch(function(Ft){G.error(Ft)})})}).catch(function(tt){G.error(tt)})}).catch(function(tt){G.error(tt)})})}},{key:"loadTensorflow",value:function(){return G.debug("Tensorflow script loading..."),new Promise(function(ge,Ie){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"],"tensorflow",{async:!0,numRetries:20,reqdelay:200,success:function(){G.debug("Tensorflow script loaded"),ge()},error:function(Pe){Ie("Resources loading failed, depsNotFound: "+Pe)},retrycb:function(Pe,We){G.warn("Tensorflow loading retry :"+Pe+" ,delay before retry :"+We)}})})}},{key:"loadTensorflowModel",value:function(){return G.debug("Tensorflow model script loading..."),new Promise(function(ge,Ie){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"],"tensorflow-model",{async:!0,numRetries:20,reqdelay:200,success:function(){G.debug("Tensorflow model script loaded"),ge()},error:function(Pe){Ie("Resources loading failed, depsNotFound: "+Pe)},retrycb:function(Pe,We){G.warn("Tensorflow model loading retry :"+Pe+" ,delay before retry :"+We)}})})}},{key:"loadBodyPix",value:function(){var ge=this;return new Promise(function(Ie,we){bodyPix.load({multiplier:.75,stride:32,quantBytes:4}).then(function(Pe){ge.net=Pe,ge.perform(),Ie()}).catch(function(Pe){return we(Pe)})})}},{key:"perform",value:function(){if(void 0!==this.descriptors.options&&void 0!==this.descriptors.options.backgroundMode)switch(this.processBackground=!0,this.descriptors.options.backgroundMode){case"blur":G.warn("This method is deprecated, please use Stream#blur method now."),this.videoElement.height=this.mediaStreamSettings.height,this.videoElement.width=this.mediaStreamSettings.width,this.canvas.height=this.videoElement.height,this.canvas.width=this.videoElement.width,this.blurBackground();break;case"transparent":this.noBackground();break;case"image":void 0!==this.descriptors.options.image?(this.resizeImageData(this.descriptors.options.image),this.imageBackground()):G.error("image option is required when creating the filter");break;default:G.debug("The backgroundMode : ",this.descriptors.options.backgroundMode," is not implemented. Refer to documentation for accepted values."),this.blurBackground()}else G.error("backgroundMode option is required")}},{key:"blurBackground",value:function(){var ge=this;this.net.segmentPerson(this.videoElement).then(function(Ie){ge.blurBackground(),bodyPix.drawBokehEffect(ge.canvas,ge.videoElement,Ie,9,2,!1)})}},{key:"noBackground",value:function(){var ge=this;this.net.segmentPerson(this.videoElement).then(function(Ie){ge.canvasContext.drawImage(ge.videoElement,0,0,ge.videoElement.width,ge.videoElement.height);for(var we=ge.canvasContext.getImageData(0,0,ge.videoElement.width,ge.videoElement.height),Pe=we.data,We=0;We<Pe.length;We+=4)0===Ie.data[We/4]&&(Pe[We+3]=0);var Je=ge.scaleImageData(we,ge.lossRatio);ge.canvasContext.imageSmoothingEnabled=!0,ge.canvasContext.putImageData(Je,0,0),ge.processBackground&&ge.noBackground()})}},{key:"imageBackground",value:function(){var ge=this;this.net.segmentPerson(this.videoElement).then(function(Ie){ge.canvasContext.putImageData(ge.bgImageData,0,0,0,0,ge.videoElement.width,ge.videoElement.height);var we=ge.canvasContext.getImageData(0,0,ge.videoElement.width,ge.videoElement.height);ge.canvasContext.drawImage(ge.videoElement,0,0,ge.videoElement.width,ge.videoElement.height);for(var Pe=ge.canvasContext.getImageData(0,0,ge.videoElement.width,ge.videoElement.height),We=Pe.data,Je=0;Je<We.length;Je+=4)0===Ie.data[Je/4]&&(We[Je]=we.data[Je],We[Je+1]=we.data[Je+1],We[Je+2]=we.data[Je+2],We[Je+3]=we.data[Je+3]);var tt=ge.scaleImageData(Pe,ge.lossRatio);ge.canvasContext.imageSmoothingEnabled=!0,ge.canvasContext.putImageData(tt,0,0),ge.processBackground&&ge.imageBackground()})}},{key:"resizeImageData",value:function(ge){var Ie=this.videoElement.width/ge.width,we=this.videoElement.height/ge.height;this.bgImageData=this.scaleImageData(ge,Ie>=we?Ie:we)}},{key:"noBackgroundWithFullResolution",value:function(){var ge=this;this.net.segmentPerson(this.videoElement).then(function(Ie){ge.canvasContext.drawImage(ge.videoElement,0,0,ge.canvas.width,ge.canvas.height);for(var we=ge.canvasContext.getImageData(0,0,ge.canvas.width,ge.canvas.height),Pe=new Uint8ClampedArray(4*Ie.width*Ie.height),We=0;We<Pe.length;We+=4)0!==Ie.data[We/4]&&(Pe[We+3]=255);var Je=new ImageData(Pe,Ie.width,Ie.height);Je=ge.scaleImageData(Je,ge.lossRatio);for(var tt=0;tt<we.data.length;tt+=4)0===Je.data[tt+3]&&(we.data[tt+3]=0);ge.canvasContext.imageSmoothingEnabled=!0,ge.canvasContext.putImageData(we,0,0),ge.processBackground&&ge.noBackgroundWithFullResolution()})}},{key:"scaleImageData",value:function(ge,Ie){var we=document.createElement("canvas");we.width=ge.width,we.height=ge.height,we.getContext("2d").putImageData(ge,0,0);var Pe=document.createElement("canvas");Pe.width=this.canvas.width,Pe.height=this.canvas.height;var We=Pe.getContext("2d");return We.scale(Ie,Ie),We.drawImage(we,0,0),We.getImageData(0,0,Pe.width,Pe.height)}},{key:"release",value:function(){this.processedMediaStream=this.mediaStream,this.processBackground=!1}}])&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(Te.prototype,ne),Te}(w),l=i.Y.get("MediaFilterManager"),s=apiCC.myWebRTC_Event,v={oldBackgroundSubtraction:he,AIEFilter:xt,backgroundSubtraction:A},r=function(){function K(ee,ce,me){(function(Te,ge){if(!(Te instanceof ge))throw new TypeError("Cannot call a class as a function")})(this,K),this.mediaStream=ee,this.descriptors=ce,this.userMediaStreamId=me,this.filters={}}var ne;return(ne=[{key:"getOrCreateFilter",value:function(ee){if(void 0!==this.filters[ee.type])return this.filters[ee.type];var ce=v[ee.type];if(void 0===ce)return l.error("Unknown filter type: "+ee.type),null;var me=new ce;return this.filters[me]=me,me}},{key:"applyFilters",value:function(){var ee=this;if(l.info("Apply filters",this.descriptors),!Array.isArray(this.descriptors)||0===this.descriptors.length)return l.error("No filter can be applied, filter descriptors have wrong format, it should be an array and contain at least one element",this.descriptors),Promise.reject(this.mediaStream);var ce=Promise.resolve(this.mediaStream);return this.descriptors.forEach(function(me){var Te=ee.getOrCreateFilter(me);null!==Te?(void 0!==me.options&&(me.options.userMediaStreamId=ee.userMediaStreamId,me.options.clientId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId),ce=ce.then(function(ge){return Te.applyFilter(ge,me)})):l.error("Filter "+me.type+" will be skipped. No implemented filter has this type")}),l.info("Filters attached"),document.addEventListener("visibilitychange",function(){ee.createBackgroundSubstractionStopVisibilityChangeEvent(ee.userMediaStreamId)}),ce.catch(function(me){return l.error(me)}),ce}},{key:"createBackgroundSubstractionStopVisibilityChangeEvent",value:function(ee){document.hidden&&s.createBackgroundSubstractionStopVisibilityChangeEvent(ee)}},{key:"release",value:function(){Object.values(this.filters).forEach(function(ee){ee.release()}),document.removeEventListener("visibilitychange",this.createBackgroundSubstractionStopVisibilityChangeEvent),this.filters=null,this.mediaStream=null}}])&&function(K,L){for(var ne=0;ne<L.length;ne++){var ee=L[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}}(K.prototype,ne),K}();function g(K){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(K)}function E(K,L){var ne="undefined"!=typeof Symbol&&K[Symbol.iterator]||K["@@iterator"];if(!ne){if(Array.isArray(K)||(ne=function(Ie,we){if(Ie){if("string"==typeof Ie)return te(Ie,void 0);var Pe=Object.prototype.toString.call(Ie).slice(8,-1);return"Object"===Pe&&Ie.constructor&&(Pe=Ie.constructor.name),"Map"===Pe||"Set"===Pe?Array.from(Ie):"Arguments"===Pe||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Pe)?te(Ie,void 0):void 0}}(K))||L&&K&&"number"==typeof K.length){ne&&(K=ne);var ee=0,ce=function(){};return{s:ce,n:function(){return ee>=K.length?{done:!0}:{done:!1,value:K[ee++]}},e:function(Ie){throw Ie},f:ce}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var me,Te=!0,ge=!1;return{s:function(){ne=ne.call(K)},n:function(){var Ie=ne.next();return Te=Ie.done,Ie},e:function(Ie){ge=!0,me=Ie},f:function(){try{Te||null==ne.return||ne.return()}finally{if(ge)throw me}}}}function te(K,L){(null==L||L>K.length)&&(L=K.length);for(var ne=0,ee=new Array(L);ne<L;ne++)ee[ne]=K[ne];return ee}var ae=i.Y.get("ApiCCUserMediaStream"),Re=apiCC.myWebRTC_Event,Ce="getUserMediaAccessAllowed",re=function(){this.userMediaStreamId=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),this.gum_config="Edge"===d.Xh&&d.PR>=15?{audio:!0,video:!0}:"Chrome"===d.Xh&&d.PR<49||"Firefox"===d.Xh&&d.PR<50?{audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}}:{audio:{},video:{}},this.inputs={},this.callbacks={},this.callType=null,this.audio=!1,this.audioDeviceLabel=null,this.audioMuted=!1,this.audioSilent=!1,this.video=!1,this.videoDeviceLabel=null,this.videoMuted=!1,this.videoSilent=!1,this.stream=null,this.streamStolen=!1,this.notifyUserMediaSuccess=!0,this.notifyUserMediaStop=!0,this.tryAudioCallAfterUserMediaError=null!==apiCC.session&&void 0!==apiCC.session&&apiCC.session.tryAudioCallAfterUserMediaError,this.callInfoList=[],this.iOSMediaSelectionWorkAroundApplied=!1,this.getUserMediaTimeoutId=null,this.displayMediaStreamConstraints="chrome"===h.wL.type&&h.wL.version>=72&&h.wL.version<=73?{video:!0,audio:!1}:{video:!0,audio:!0},this.forceExtensionOnChrome=!1,this.filters=null,this.mediaFilterManager=null,this.videoSettings=!1,this.getVideoTrack=function(){if(!this.stream||"function"!=typeof this.stream.getVideoTracks)return null;var K=this.stream.getVideoTracks();return K&&1===K.length?K[0]:null},this.release=function(){var K=0,L=null,ne=null,ee=null;if(ae.debug("[ApiCCUserMediaStream] release; userMediaStreamId: "+this.userMediaStreamId),null!==this.mediaFilterManager&&(this.mediaFilterManager.release(),this.mediaFilterManager=null),null!==this.stream){if(this.sourceNode&&this.sourceNode.disconnect(),this.javascriptNode&&(this.javascriptNode.analyser&&this.javascriptNode.analyser.disconnect(),this.javascriptNode.disconnect()),!0!==this.streamStolen)if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)void 0!==cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc&&(ae.debug("[ApiCCUserMediaStream] release on iosrtc cordova"),this.stream.onended=null);else if("Chrome"===d.Xh&&d.PR<45||"Firefox"===d.Xh&&d.PR<44||"Opera"===d.Xh&&d.PR<34||"Chromium"===d.Xh&&d.PR<44||"Chrome WebView"===d.Xh&&d.PR<45)this.stream.onended=null,this.stream.stop();else for(this.stream.onended=null,K=(L=this.stream.getTracks()).length;--K>=0;)L[K].onended=null,L[K].stop();this.stream=null,this.streamStolen=!1,!0===this.notifyUserMediaStop&&(null!==(ee=this.getOwnerCallInfo())&&(ne=ee.callId),Re.createUserMediaStopEvent(ne,this.callType,this.userMediaStreamId)),this.callbacks.release(this)}},this.getUserMedia=function(){var K=this;if(ae.debug("[ApiCCUserMediaStream] getUserMedia; userMediaStreamId: "+this.userMediaStreamId),null===this.stream)try{if("media"===this.callType)this.gum_config=apiCC.setAudioSourceIdInConstraint(this.inputs.audioSourceId,this.gum_config),this.gum_config=apiCC.setVideoSourceIdInConstraint(this.inputs.videoSourceId,this.gum_config),this.gum_config=apiCC.setVideoFacingModeInConstraint(this.inputs.facingMode,this.gum_config);else if("audio"===this.callType)this.gum_config=apiCC.setAudioSourceIdInConstraint(this.inputs.audioSourceId,this.gum_config),this.gum_config.video=!1;else{if("videoOnly"!==this.callType)return function(L){for(var ne=apiCC.userMediaStreamTable.length;--ne>=0;)if(apiCC.userMediaStreamTable[ne].userMediaStreamId===L){apiCC.userMediaStreamTable.splice(ne,1);break}}(this.userMediaStreamId),void setTimeout(this.callbacks.failure.bind(this,this,"wrong type"));this.gum_config.audio=!1,this.gum_config=apiCC.setVideoSourceIdInConstraint(this.inputs.videoSourceId,this.gum_config),this.gum_config=apiCC.setVideoFacingModeInConstraint(this.inputs.facingMode,this.gum_config)}apiCC.checkConstraintDependingOnDevice(this.gum_config),"IE"===d.Xh&&d.dc>8?apiCC.getUserMediaWithCB(this.gum_config,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):("Chrome"===d.Xh&&!0===this.isUserMediaAccessAllowed()&&(this.getUserMediaTimeoutId=setTimeout(function(){K.onUserMediaError("timeout")},1e4)),apiCC.getUserMedia(this.gum_config).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError")))}catch(L){ae.error("getUserMedia() failed. Is this a WebRTC capable browser?"),ae.log("getUserMedia failed with exception: "+L.message)}},this.onUserMediaSuccess=function(K){var L=this;this.applyFiltersIfNeeded(K).then(function(ne){var ee=null,ce=null,me=!1,Te=L.getOwnerCallInfo(),ge=L.getCall(Te);ae.info("[ApiCCUserMediaStream] onUserMediaSuccess; userMediaStreamId: "+L.userMediaStreamId),null!==L.getUserMediaTimeoutId&&(clearTimeout(L.getUserMediaTimeoutId),L.getUserMediaTimeoutId=null),ge&&(ae.debug("call exist"),ce=ge.callee?ge.callerId:ge.calleeId,me=ge.restarted),"screenSharing"!==L.callType&&"screenSharingWithAudio"!==L.callType||(ne.onended=L.callback(L,"stopScreenSharing"),ne.getVideoTracks().length>0&&(ne.getVideoTracks()[0].onended=L.callback(L,"stopScreenSharing"))),L.updateMediaProperties(ne),L.stream=ne,"Chrome"===d.Xh&&L.setUserMediaAccessAllowed(!0),!0===L.notifyUserMediaSuccess&&(Te&&(ee=Te.callId),Re.createUserMediaSuccessEvent(null!==ee,L.audio,L.audioDeviceLabel,L.video,L.videoDeviceLabel,L.callType,ee,ne,ce,me,L.userMediaStreamId));var Ie,we=function(tt){tt.onmute=function(Ft){ae.debug(tt.kind+" mute event"),"audio"===tt.kind?L.audioSilent=!0:"video"===tt.kind&&(L.videoSilent=!0),L.notifyMLineMuted(tt.kind,!0,"muted")},tt.onunmute=function(Ft){ae.debug(tt.kind+" unmute event"),"audio"===tt.kind?L.audioSilent=!1:"video"===tt.kind&&(L.videoSilent=!1),L.notifyMLineMuted(tt.kind,!1,"muted")}},Pe=E(ne.getVideoTracks());try{for(Pe.s();!(Ie=Pe.n()).done;)we(Ie.value)}catch(tt){Pe.e(tt)}finally{Pe.f()}var We,Je=E(ne.getAudioTracks());try{for(Je.s();!(We=Je.n()).done;)we(We.value)}catch(tt){Je.e(tt)}finally{Je.f()}ae.debug("Starting a new getMediaDevices after userMediaSuccess"),apiCC.mediaDeviceMgr.getMediaDevices("updatedAfterGetUserMediaSuccess"),L.callbacks.success(L)})},this.updateMediaProperties=function(K){var L=!1,ne="Unknown",ee="Unknown",ce=!1,me="Unknown";K.getAudioTracks().length>0&&(L=!0,K.getAudioTracks()[0].label&&(ne=K.getAudioTracks()[0].label,ee=K.getAudioTracks()[0].id,this.listenToAudio2(K))),K.getVideoTracks().length>0&&(ce=!0,K.getVideoTracks()[0].label&&(me=K.getVideoTracks()[0].label)),this.audio=L,this.audioDeviceLabel=ne,this.audioDeviceId=ee,this.video=ce,this.videoDeviceLabel=me},this.listenToAudio=function(K){ae.debug("listenToAudio()");for(var L=apiCC.getAudioContext(),ne=this,ee=!1,ce=[],me=0;me<10;me++)ce.push(0);null!=L?(this.javascriptNode=L.createScriptProcessor(2048,1,1),this.sourceNode=L.createMediaStreamSource(K),!0===apiCC.activeSpeakerDetect&&(ae.debug("activespeakerDetecting"),this.javascriptNode.connect(L.destination),this.javascriptNode.onaudioprocess=function(){var Te,ge,Ie,we=new Uint8Array(this.analyser.frequencyBinCount),Pe=0;for(this.analyser.getByteFrequencyData(we),ge=0;ge<we.length;ge++)Pe+=we[ge];var We=0;if((Ie={amplitude:Pe/we.length,active:K.active}).amplitude>apiCC.activeSpeakerThreshold&&!ee){for(Te=ce.length-3;Te<ce.length;Te++)We+=ce[Te];We>=2&&(ee=!0,ne.notifyActiveSpeaker(Ie.amplitude))}else if(Ie.amplitude<apiCC.activeSpeakerThreshold&&ee){for(Te=ce.length-3;Te<ce.length;Te++)We+=ce[Te];0===We&&(ee=!1,ne.notifyNotActiveSpeaker(Ie.amplitude))}ce.push(0+(Ie.amplitude>apiCC.activeSpeakerThreshold))},this.javascriptNode.analyser=L.createAnalyser(),this.javascriptNode.analyser.smoothingTimeConstant=.3,this.javascriptNode.analyser.fftSize=1024,this.sourceNode.connect(this.javascriptNode.analyser),this.javascriptNode.analyser.connect(this.javascriptNode))):ae.debug("listenToAudioSources() - Unable to create audio context")},this.listenToAudio2=function(K){ae.debug("listenToAudio2()");var L=apiCC.getAudioContext(),ne=this,ee=null,ce=!1;null!=L?(this.javascriptNode=L.createScriptProcessor(2048,1,1),this.sourceNode=L.createMediaStreamSource(K),!0===apiCC.activeSpeakerDetect&&(ae.debug("activeSpeakerDetecting"),this.javascriptNode.connect(L.destination),this.javascriptNode.onaudioprocess=function(){var me,Te,ge=new Uint8Array(this.analyser.frequencyBinCount),Ie=0;for(this.analyser.getByteFrequencyData(ge),ge.sort(function(we,Pe){return Pe-we}),ge=ge.slice(0,50),Te=0;Te<ge.length;Te++)Ie+=ge[Te];(me=Ie/ge.length)>apiCC.activeSpeakerThreshold&&(ce||(ce=!0,ne.notifyActiveSpeaker(me)),null!==ee&&clearTimeout(ee),ee=setTimeout(function(){ne.notifyNotActiveSpeaker(me),ce=!1},1e3))},this.javascriptNode.analyser=L.createAnalyser(),this.javascriptNode.analyser.smoothingTimeConstant=.5,this.javascriptNode.analyser.fftSize=1024,this.sourceNode.connect(this.javascriptNode.analyser),this.javascriptNode.analyser.connect(this.javascriptNode))):ae.debug("listenToAudioSources() - Unable to create audio context")},this.manageFailure=function(K){var L={};"object"===g(K)?(L.message=K.message,L.code=K.code,L.name=K.name):L=K,this.callbacks.failure(this,L)},this.onUserMediaError=function(K){var L=function(me){for(var Te=apiCC.userMediaStreamTable.length;--Te>=0;)if(apiCC.userMediaStreamTable[Te].userMediaStreamId===me){apiCC.userMediaStreamTable.splice(Te,1);break}},ne=null,ee=this.getOwnerCallInfo();if(ae.info("[ApiCCUserMediaStream] onUserMediaError; userMediaStreamId: "+this.userMediaStreamId+", error: "+K),null!==this.getUserMediaTimeoutId&&("timeout"!==K&&clearTimeout(this.getUserMediaTimeoutId),this.getUserMediaTimeoutId=null),"electron"!==d.$6&&"Chrome"===d.Xh&&d.PR>47&&"https:"!==window.location.protocol&&ae.error("HTTPS is now mandatory to use getUserMedia()"),null!==ee&&(ne=ee.callId),"media"===this.callType&&"iOS"===d.ag.name&&"Mobile Safari"===d.Xh&&!1===this.iOSMediaSelectionWorkAroundApplied||Re.createUserMediaErrorEvent(null!==ne,this.callType,K,this.userMediaStreamId,ne,this.tryAudioCallAfterUserMediaError,this.gum_config),"timeout"!==K&&"media"===this.callType)if("iOS"===d.ag.name&&"Mobile Safari"===d.Xh&&!1===this.iOSMediaSelectionWorkAroundApplied){ae.warn("try mediaDevice selection workaround on iOS / Mobile Safari - after MediaError"),this.iOSMediaSelectionWorkAroundApplied=!0,this.gum_config.video={};var ce=apiCC.getMediaDeviceLabelFromDeviceid(this.inputs.videoSourceId);ae.log("getMediaDeviceLabelFromDeviceid :",ce),"Cam\xe9ra arri\xe8re"===ce||"Back Camera"===ce?(ae.log("Setting FacingMode to environment :",ce),this.gum_config=apiCC.setVideoFacingModeInConstraint("environment",this.gum_config)):(ae.log("Setting FacingMode to user :",ce),this.gum_config=apiCC.setVideoFacingModeInConstraint("user",this.gum_config)),this.inputs.videoSourceId=null,this.getUserMedia()}else!0===this.tryAudioCallAfterUserMediaError?(ae.warn("try AudioCall after UserMediaError is activated"),this.tryAudioCallAfterUserMediaError=!1,!1!==this.gum_config.video?(ae.debug("[ApiCCUserMediaStream] Trying to getUserMedia with audioOnly"),this.inputs.videoSourceId=null,this.gum_config.video=!1,this.getUserMedia()):(L(this.userMediaStreamId),this.manageFailure(K))):(L(this.userMediaStreamId),this.manageFailure(K));else L(this.userMediaStreamId),this.manageFailure(K)},this.getDisplayMediaProcess=function(){var K=this;ae.debug("using getDisplayMedia with browser :",d.Xh),ae.debug("displayMediaStreamConstraints :",this.displayMediaStreamConstraints),"object"===g(this.displayMediaStreamConstraints)&&!0!==Array.isArray(this.displayMediaStreamConstraints)||(ae.warn("Defined displayMediaStreamConstraints format is not correct, reinitialization ..."),this.displayMediaStreamConstraints="chrome"===h.wL.type&&h.wL.version>=72&&h.wL.version<=73?{video:!0,audio:!1}:{video:!0,audio:!0},ae.debug("displayMediaStreamConstraints :",this.displayMediaStreamConstraints)),navigator.getDisplayMedia?(ae.debug("navigator.getDisplayMedia defined"),navigator.getDisplayMedia(this.displayMediaStreamConstraints).then(function(L){ae.debug("getDisplayMedia stream available"),K.onUserMediaSuccess(L)}).catch(function(L){ae.debug("getDisplayMedia error :",L),K.onUserMediaError(L)})):navigator.mediaDevices.getDisplayMedia?(ae.debug("navigator.mediaDevices.getDisplayMedia defined"),navigator.mediaDevices.getDisplayMedia(this.displayMediaStreamConstraints).then(function(L){ae.debug("getDisplayMedia stream available"),K.onUserMediaSuccess(L)}).catch(function(L){ae.debug("getDisplayMedia error :",L),K.onUserMediaError(L)})):(ae.debug("getDisplayMedia not available"),Re.createDesktopCaptureEvent("Browser_Not_Compatible"))},this.getScreenMedia=function(){if(ae.debug("[ApiCCUserMediaStream] getScreenMedia; userMediaStreamId: "+this.userMediaStreamId),null===this.stream)if("Chrome"===d.Xh||"Firefox"===d.Xh&&d.PR>=52)if("Chrome"===d.Xh)if(ae.log("shareScreen on Chrome"),d.PR>=72&&!1===this.forceExtensionOnChrome)this.getDisplayMediaProcess();else{if(ae.debug("this.captureSourceType :",this.captureSourceType),!1===apiCC.apiRTCExtensionInstalled)return apiCC.waitingShareScreenUserMediaStreamId=this.userMediaStreamId,function(K){ae.debug("[ApiCCUserMediaStream] moveUserMediaEntryInWaitingScreen: "+K);for(var L=apiCC.userMediaStreamTable.length;--L>=0;)if(apiCC.userMediaStreamTable[L].userMediaStreamId===K){apiCC.waitingShareScreenUserMediaStream=apiCC.userMediaStreamTable.splice(L,1);break}}(this.userMediaStreamId),void apiCC.manageNotInstalledExtension("getScreenMedia","getScreenMedia",this.captureSourceType);null!=this.captureSourceType||(this.captureSourceType=["screen","window","tab"]),!1===Array.isArray(this.captureSourceType)&&(ae.warn("Defined captureSourceType format is not correct, reinitialization ..."),this.captureSourceType=["screen","window","tab"],ae.debug("this.captureSourceType :",this.captureSourceType)),window.postMessage({command:"getDesktopId",callNumber:this.userMediaStreamId,remoteId:"getScreenMedia",captureSourceType:this.captureSourceType,browser_major_version:d.PR},"*")}else ae.log("shareScreen on Firefox"),d.PR>=67?this.getDisplayMediaProcess():(null!=this.captureSourceType||(this.captureSourceType="screen"),"string"==typeof this.captureSourceType&&(ae.warn("Defined captureSourceType format is not correct, reinitialization ..."),this.captureSourceType="screen",ae.debug("this.captureSourceType :",this.captureSourceType)),this.registerScreenMedia(this.captureSourceType));else this.getDisplayMediaProcess()},this.registerScreenMedia=function(K,L){var ne=null,ee=this.getOwnerCallInfo(),ce=this.getCall(ee),me=null;if(ae.debug("[ApiCCUserMediaStream] registerScreenMedia; userMediaStreamId: "+this.userMediaStreamId),"mediaError"===L)null!==ce?(me=!0===ce.callee?ce.callerId:ce.calleeId,"screenSharing"===ce.callType||"screenSharingWithAudio"===ce.callType?apiCC.session.apiCCWebRTCClient.webRTCClient.removeCallFromTableWithCallIdandRemoteId(ce.callId,me,"Media_Error"):ae.log("switch video / screen : call is not removed"),"https:"!==window.location.protocol&&ae.log("Please connect to your web page using 'HTTPS'. This is mandatory for desktop capture"),Re.createDesktopCaptureEvent("UserMediaError",ce.callId,me)):(ae.log("Call not found on message EventListener"),Re.createDesktopCaptureEvent("UserMediaError")),function(Te){for(var ge=apiCC.userMediaStreamTable.length;--ge>=0;)if(apiCC.userMediaStreamTable[ge].userMediaStreamId===Te){apiCC.userMediaStreamTable.splice(ge,1);break}}(this.userMediaStreamId),this.callbacks.failure(this,"UserMediaError");else try{if("Chrome"===d.Xh)ae.log("desktopId: "+L),ne={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:L}}};else{if(ae.log("captureSourceType: "+K),"screen"!==K&&"window"!==K&&"application"!==K)return void ae.error("captureSourceType value is not correct");ne={video:{mediaSource:K}}}"IE"===d.Xh&&d.dc>8?apiCC.getUserMediaWithCB(ne,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):apiCC.getUserMedia(ne).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError"))}catch(Te){ae.error("getUserMedia() failed. Is this a WebRTC capable browser?"),ae.log("getUserMedia failed with exception: "+Te.message)}},this.stopScreenSharing=function(){ae.debug("[ApiCCUserMediaStream] stopScreenSharing; userMediaStreamId: "+this.userMediaStreamId);var K=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var L=this.callInfoList.length;--L>=0;)!0===this.callInfoList[L].owner&&(K=!1),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(this.callInfoList[L].callId);!0===K&&this.release()},this.getCall=function(K){var L=null;return K&&apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient&&("call"===K.flavor?L=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(K.callId):"userMedia"===K.flavor&&(L=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(K.callId))),L},this.getOwnerCallInfo=function(){for(var K=this.callInfoList.length;--K>=0;)if(!0===this.callInfoList[K].owner)return this.callInfoList[K];return null},this.getCallInfo=function(K){for(var L=this.callInfoList.length;--L>=0;)if(this.callInfoList[L].callId===K)return this.callInfoList[L];return null},this.containsCallInfo=function(K){for(var L=!1,ne=this.callInfoList.length;--ne>=0;)if(this.callInfoList[ne].callId===K){L=!0;break}return L},this.addCallInfo=function(K,L,ne){return null!==K&&"string"==typeof K&&("call"!==L&&"userMedia"!==L&&(L="call"),null!==ne&&"boolean"==typeof ne||(ne=!1),!this.containsCallInfo(K))&&(this.callInfoList.push({callId:K,flavor:L,owner:ne}),!0)},this.removeCallInfo=function(K){for(var L=!1,ne=this.callInfoList.length;--ne>=0;)if(this.callInfoList[ne].callId===K){this.callInfoList.splice(ne,1),L=!0;break}return L},this.accessToLocalMedia=function(){return"screenSharing"!==this.callType&&"screenSharingWithAudio"!==this.callType&&"data"!==this.callType&&null!==this.stream},this.muteAudioOnStreams=function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enabled";return ae.debug("[ApiCCUserMediaStream] muteAudioOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getAudioTracks().forEach(function(L){L.enabled=!1}),"enabled"===K?this.audioMuted=!0:"muted"===K&&(this.audioSilent=!0),this.notifyMLineMuted("audio",!0,K),{type:"audio",muted:!0}},this.unMuteAudioOnStreams=function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enabled";return ae.debug("[ApiCCUserMediaStream] unMuteAudioOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getAudioTracks().forEach(function(L){L.enabled=!0}),"enabled"===K?this.audioMuted=!1:"muted"===K&&(this.audioSilent=!1),this.notifyMLineMuted("audio",!1,K),{type:"audio",muted:!1}},this.muteVideoOnStreams=function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enabled";return ae.debug("[ApiCCUserMediaStream] muteVideoOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getVideoTracks().forEach(function(L){L.enabled=!1}),"enabled"===K?this.videoMuted=!0:"muted"===K&&(this.videoSilent=!0),this.notifyMLineMuted("video",!0,K),{type:"video",muted:!0}},this.unMuteVideoOnStreams=function(){var K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"enabled";return ae.debug("[ApiCCUserMediaStream] unMuteVideoOnStreams; userMediaStreamId: "+this.userMediaStreamId),this.stream.getVideoTracks().forEach(function(L){L.enabled=!0}),"enabled"===K?this.videoMuted=!1:"muted"===K&&(this.videoSilent=!1),this.notifyMLineMuted("video",!1,K),{type:"video",muted:!1}},this.removeVideoTrackOnStreams=function(){var K;return ae.debug("[ApiCCUserMediaStream] removeVideoTrackOnStreams; userMediaStreamId: "+this.userMediaStreamId),(K=this.stream.getVideoTracks()).length>0&&this.stream.removeTrack(K[0]),this.video=!1,{type:"video",present:!1}},this.notifyMLineMuted=function(K,L,ne){var ee,ce,me=!0,Te={eventType:"muteUnmuteEvent",source:"local",mLine:K},ge=function(){ae.debug("getCallIdAndUsername");var we="",Pe="";apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.forEach(function(Ft){Pe=Ft.callId});var We=apiCC.Session.getActiveSession();if(null!==We){var Je=We.getUserAgent();null!=Je&&(we=Je.username)}var tt={callId:Pe,username:we};return ae.debug("getCallIdAndUsername result:",tt),tt}();if(Te.callId=ge.callId,Te.username=ge.username,Te.state=L?"mute":"unmute",Te.muteType="muted"===ne?"hardware":"applicatif",apiCC.sendSentryEvent(Te),apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var Ie=this.callInfoList.length;--Ie>=0;)"call"===this.callInfoList[Ie].flavor?(ee=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[Ie].callId),this.notifyMLineMutedCall(K,L,ne,ee,null)):"userMedia"===this.callInfoList[Ie].flavor&&(ce=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[Ie].callId),this.notifyMLineMutedCall(K,L,ne,null,ce)),!0===this.callInfoList[Ie].owner&&(me=!1);!0===me&&this.notifyMLineMutedCall(K,L,ne,null,null)},this.notifyMLineMutedCall=function(K,L,ne,ee,ce){ae.debug("notifyMLineMutedCall; mline: "+K+", muted: "+L);var me=[];"enabled"===ne?me=[K+"IsMuted"]:"muted"===ne&&(me=[K+"IsSilent"]);var Te={available:this.audio,deviceLabel:this.audioDeviceLabel,active:!0,muted:this.audioMuted,silent:this.audioSilent},ge={available:this.video,deviceLabel:this.videoDeviceLabel,active:!0,muted:this.videoMuted,silent:this.videoSilent},Ie=null;ee?("audio"===K?ee.isLocalAudioMuted=L:"video"===K&&(ee.isLocalVideoMuted=L),ee.belongsToRoom()?(Ie={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:ee.callId,roomId:ee.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,mline:K},ee.data.mesh&&(Ie.mesh=ee.data.mesh),"muted"===ne?(Ie.change="silent",Ie.silent=L,ee.myWebRTC_Stack.sendInfo("streamTrackStatusChanged",Ie)):"enabled"===ne&&(Ie.muted=L,ee.myWebRTC_Stack.sendInfo("streamTrackChanged",Ie))):(Ie={callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:ee.callee?ee.callerId:ee.calleeId,callId:ee.callId,mline:K},"muted"===ne?(Ie.type="streamTrackStatusChanged",Ie.change="silent",Ie.silent=L):"enabled"===ne&&(Ie.type="streamTrackChanged",Ie.muted=L),ee.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,Ie)),Te.active=ee.localCallProfile.audioActive,ge.active=ee.localCallProfile.videoActive,Re.createLocalStreamUpdatedEvent(me,Te,ge,!0,ee.callType,ee.callId,this.stream,this.userMediaStreamId,"userAction")):ce?(Ie={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:ce.userMediaId,roomId:ce.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,mline:K},"muted"===ne?(Ie.change="silent",Ie.silent=L,ce.myWebRTC_Stack.sendInfo("streamTrackStatusChanged",Ie)):"enabled"===ne&&(Ie.muted=L,ce.myWebRTC_Stack.sendInfo("streamTrackChanged",Ie)),"inactive"===ce.audioSdpDirection&&(Te.active=!1),"inactive"===ce.videoSdpDirection&&(ge.active=!1),Re.createLocalStreamUpdatedEvent(me,Te,ge,!0,ce.callType,ce.userMediaId,this.stream,this.userMediaStreamId,"userAction")):Re.createLocalStreamUpdatedEvent(me,Te,ge,!1,null,null,this.stream,this.userMediaStreamId,"userAction")},this.notifyActiveSpeaker=function(K){var L,ne,ee=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var ce=this.callInfoList.length;--ce>=0;)"call"===this.callInfoList[ce].flavor?(L=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[ce].callId),this.notifyActiveSpeakerCall(K,L,null)):"userMedia"===this.callInfoList[ce].flavor&&(ne=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[ce].callId),this.notifyActiveSpeakerCall(K,null,ne)),!0===this.callInfoList[ce].owner&&(ee=!1);!0===ee&&this.notifyActiveSpeakerCall(K,null,null)},this.notifyActiveSpeakerCall=function(K,L,ne){var ee=null;L?(L.belongsToRoom()?(ee={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:L.callId,roomId:L.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},L.data.mesh&&(ee.mesh=L.data.mesh),L.myWebRTC_Stack.sendInfo("activeSpeaker",ee)):(ee={type:"activeSpeaker",callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:L.callee?L.callerId:L.calleeId,callId:L.callId,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},L.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,ee)),Re.createAudioAmplitudeEvent(K,!0,L.callId,this.userMediaStreamId)):ne?(ee={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:ne.userMediaId,roomId:ne.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},ne.myWebRTC_Stack.sendInfo("activeSpeaker",ee),Re.createAudioAmplitudeEvent(K,!0,ne.userMediaId,this.userMediaStreamId)):Re.createAudioAmplitudeEvent(K,!0,null,this.userMediaStreamId)},this.notifyNotActiveSpeaker=function(K){var L,ne,ee=!0;if(apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient)for(var ce=this.callInfoList.length;--ce>=0;)"call"===this.callInfoList[ce].flavor?(L=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(this.callInfoList[ce].callId),this.notifyNotActiveSpeakerCall(K,L,null)):"userMedia"===this.callInfoList[ce].flavor&&(ne=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(this.callInfoList[ce].callId),this.notifyNotActiveSpeakerCall(K,null,ne)),!0===this.callInfoList[ce].owner&&(ee=!1);!0===ee&&this.notifyNotActiveSpeakerCall(K,null,null)},this.notifyNotActiveSpeakerCall=function(K,L,ne){var ee=null;L?(L.belongsToRoom()?(ee={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:L.callId,roomId:L.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},L.data.mesh&&(ee.mesh=L.data.mesh),L.myWebRTC_Stack.sendInfo("stopSpeaking",ee)):(ee={type:"stopSpeaking",callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,calleeId:L.callee?L.callerId:L.calleeId,callId:L.callId,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},L.myWebRTC_Stack.sendDataMessage(apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,ee)),Re.createAudioAmplitudeEvent(K,!1,L.callId,this.userMediaStreamId)):ne?(ee={clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:ne.userMediaId,roomId:ne.sessionMCU.roomName,pubSub:apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector,resolve:!0,descriptor:{audioAmplitude:K,streamID:this.userMediaStreamId}},ne.myWebRTC_Stack.sendInfo("stopSpeaking",ee),Re.createAudioAmplitudeEvent(K,!1,ne.userMediaId,this.userMediaStreamId)):Re.createAudioAmplitudeEvent(K,!1,null,this.userMediaStreamId)},this.callback=function(K,L){return this.closureHandler=function(ne,ee){return K[L](ne,ee)},this.closureHandler},this.isUserMediaAccessAllowed=function(){return null!==localStorage&&"object"===("undefined"==typeof localStorage?"undefined":g(localStorage))&&"function"==typeof localStorage.getItem?"true"===localStorage.getItem(Ce):null},this.setUserMediaAccessAllowed=function(K){return null!==localStorage&&"object"===("undefined"==typeof localStorage?"undefined":g(localStorage))&&"function"==typeof localStorage.setItem?(localStorage.setItem(Ce,K?"true":"false"),!!K):null},this.applyFiltersIfNeeded=function(K){return null===this.filters?Promise.resolve(K):(this.mediaFilterManager=new r(K,this.filters,this.userMediaStreamId),this.mediaFilterManager.applyFilters())},this.getVideoSettings=function(){if(!1!==this.videoSettings)return this.videoSettings;var K=this.getVideoTrack();if(!K||"function"!=typeof K.getSettings)return this.videoSettings=null,this.videoSettings;var L=K.getSettings();return L?(this.videoSettings={},Object.prototype.hasOwnProperty.call(L,"width")&&(this.videoSettings.width=L.width),Object.prototype.hasOwnProperty.call(L,"height")&&(this.videoSettings.height=L.height),Object.prototype.hasOwnProperty.call(L,"frameRate")&&(this.videoSettings.frameRate=L.frameRate),this.videoSettings):(this.videoSettings=null,this.videoSettings)},this.isSimulcastCompliant=function(){return!!this.getVideoSettings()},this.getSimulcastProfile=function(){var K=this.getVideoSettings();if(!K)return null;var L={substream:{high:{active:!0,selectable:!0},medium:{active:!0,selectable:!0},low:{active:!0,selectable:!0}},temporal:{high:{active:!0,selectable:!0},medium:{active:!0,selectable:!0},low:{active:!0,selectable:!0}}};return"chrome"===h.wL.type&&((K.width<1280||K.height<720)&&(L.substream.low.selectable=!1),L.temporal.high.active=!1,L.temporal.high.selectable=!1),L}}},5882:(V,J,e)=>{"use strict";e.d(J,{D:()=>zt}),e(3710),e(1539),e(9714),e(2772),e(8674);var i=e(1549),d=(e(4916),e(5306),e(2564),e(4812),e(561),e(9554),e(4747),e(5735),e(3753),e(4603),e(6755),e(6992),e(8783),e(3948),e(4765),e(9601),e(8309),e(8264),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(7042),e(7941),e(2526),e(1817),e(2165),e(5945)),h=e(4708),P=e(940);function w(G){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(G)}function M(){this.sdp={original:null,global:[],mlines:[]},this.mlines=[]}function C(G){var A=new M,t=G.split("\r\n"),l=0,s=null,v=null,r=null,g=null;for(A.sdp.original=G;l<t.length;)if(0!==(s=t[l]).length)if(null!==r)if(s.match(/^m=/))v=null,r=null;else if(s.match(/^a=/)){if(v.push(s),!(g=s.match(/^a=([\w-]+):(\d+) (.+)$/))||"rtpmap"!==g[1]&&"rtcp-fb"!==g[1]&&"fmtp"!==g[1]){if(g=s.match(/^a=mid:(\w+)$/))r.mid=g[1];else if("a=sendrecv"===s)r.direction="sendrecv";else if("a=recvonly"===s)r.direction="recvonly";else if("a=sendonly"===s)r.direction="sendonly";else if("a=inactive"===s)r.direction="inactive";else if(g=s.match(/^a=ssrc-group:SIM (.+)$/)){var E=g[1].split(" ");r.ssrc_groups.sim.push(E.slice())}else if(g=s.match(/^a=ssrc-group:FID (.+)$/)){var te=g[1].split(" ");r.ssrc_groups.fid.push(te.slice())}else if(g=s.match(/^a=ssrc:(\d+) (.+)$/)){var ae=r.ssrcs.find(function(ee){return ee.original===g[1]});ae||r.ssrcs.push(ae={original:g[1],ssrc:g[1],content:{}});var Re=g[2].match(/^(\w+):(.+)$/);if(!Re)throw new Error("cannot parse ssrc parameters (regex failure): "+g[2]);if("cname"===Re[1])ae.content.cname=Re[2];else if("msid"===Re[1])ae.content.msid=Re[2];else if("mslabel"===Re[1])ae.content.mslabel=Re[2];else{if("label"!==Re[1])throw new Error("cannot parse ssrc parameters (wrong attribute): "+Re[1]);ae.content.label=Re[2]}}}else if("rtpmap"===g[1])r.codecs[g[2]].codec=g[3].split("/")[0].toLowerCase(),r.codecs[g[2]].rtpmap=g[3];else if("rtcp-fb"===g[1])r.codecs[g[2]]["rtcp-fb"]||(r.codecs[g[2]]["rtcp-fb"]=[]),r.codecs[g[2]]["rtcp-fb"].push(g[3]);else if("fmtp"===g[1]){r.codecs[g[2]].fmtp=[];for(var Ce=g[3].split(";"),re=0;re<Ce.length;re+=1){var K=Ce[re].split("=");2===K.length&&r.codecs[g[2]].fmtp.push(K)}}l+=1}else if(s.match(/^b=/)){if(v.push(s),g=s.match(/^b=AS:(\d+)$/)){r.bandwidth=parseInt(g[1],10),l+=1;continue}l+=1}else v.push(s),l+=1;else{if(g=s.match(/^m=([a-z]+) (\d+) ([A-Z/]+) ([0-9 ]+)$/)){A.sdp.mlines.push(v=[]),v.push(s),r={type:g[1],port:parseInt(g[2],10),proto:g[3],payload_types:[],direction:"sendrecv",mid:g[1],bandwidth:0,codecs:{},ssrc_groups:{sim:[],fid:[]},ssrcs:[]};for(var L=g[4].split(" "),ne=0;ne<L.length;ne+=1)r.payload_types.push(L[ne]),r.codecs[L[ne]]={};A.mlines.push(r),l+=1;continue}A.sdp.global.push(s),l+=1}else l+=1;for(A.unifiedPlan=!0,l=A.mlines.length;--l>=0;)"audio"!==A.mlines[l].type||A.audio?"video"!==A.mlines[l].type||A.video||(A.video=A.mlines[l]):A.audio=A.mlines[l],!0===A.unifiedPlan&&A.mlines[l].mid!==String(l)&&(A.unifiedPlan=!1);return A.isAudioActive=S.bind(null,A,"audio"),A.isVideoActive=S.bind(null,A,"video"),A}function S(G,A){return!("audio"!==A&&"video"!==A||null===G||"object"!==w(G)||!Object.prototype.hasOwnProperty.call(G,A)||null===G[A]||"object"!==w(G[A])||"sendrecv"!==G[A].direction&&"sendonly"!==G[A].direction&&"recvonly"!==G[A].direction)}e(3123),e(4723),e(9600),e(1058),e(9826),M.prototype.mungeForSimulcasting=function(){if(!0!==this.simulcasting){this.simulcasting=!0;for(var G=0;G<this.mlines.length;G+=1){var A=this.mlines[G];if("video"===A.type){var t=A.ssrcs[0].content.cname,l=A.ssrcs[0].content.msid,s=A.ssrcs[0].content.mslabel,v=A.ssrcs[0].content.label,r=[];r.push(A.ssrcs[0].ssrc);for(var g=2;--g>=0;){var E=Math.floor(4294967295*Math.random());A.ssrcs.push({original:E,ssrc:E,content:{cname:t,msid:l,mslabel:s,label:v}});var te=Math.floor(4294967295*Math.random());A.ssrcs.push({original:te,ssrc:te,content:{cname:t,msid:l,mslabel:s,label:v}}),A.ssrc_groups.fid.push([E,te]),r.push(E)}A.ssrc_groups.sim.push(r)}}}},M.prototype.generate=function(){for(var G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=[],t=0;t<this.sdp.global.length;t+=1){var l=this.sdp.global[t],s=l.match(/^a=group:BUNDLE([\w ]+)$/);if(s){A.push("a=group:BUNDLE");for(var v=0;v<this.mlines.length;v+=1)"inactive"===this.mlines[v].direction&&!0===G.stripInactiveMLines||(A.push(" "),A.push(this.mlines[v].mid));A.push("\r\n")}else A.push(l),A.push("\r\n")}for(var r=0;r<this.sdp.mlines.length;r+=1){var g=this.mlines[r];if("inactive"!==g.direction||!0!==G.stripInactiveMLines)for(var E=!1,te=this.sdp.mlines[r],ae=0;ae<te.length;ae+=1){var Re=te[ae];if(Re.match(/^m=/))A.push("m="),A.push(g.type),A.push(" "),A.push(g.port),A.push(" "),A.push(g.proto),A.push(" "),A.push(g.payload_types.join(" ")),A.push("\r\n");else if(Re.match(/^a=/)){var Ce=Re.match(/^a=([\w-]+):(\d+) (.+)$/);if(Ce&&("rtpmap"===Ce[1]||"rtcp-fb"===Ce[1]||"fmtp"===Ce[1])){if("rtpmap"===Ce[1]){var re=Ce[2];if(g.codecs[re]){A.push("a=rtpmap:"),A.push(re),A.push(" "),A.push(g.codecs[re].rtpmap),A.push("\r\n");var K=g.codecs[re]["rtcp-fb"];if(K)for(var L=0;L<K.length;L+=1)A.push("a=rtcp-fb:"),A.push(re),A.push(" "),A.push(K[L]),A.push("\r\n");var ne=g.codecs[re].fmtp;if(ne){for(var ee=[],ce=0;ce<ne.length;ce+=1)ee.push(ne[ce].join("="));ee.length>0&&(A.push("a=fmtp:"),A.push(re),A.push(" "),A.push(ee.join(";")),A.push("\r\n"))}continue}continue}if("rtcp-fb"===Ce[1]||"fmtp"===Ce[1])continue;throw new Error("internal error")}if(Re.match(/^a=mid:(\w+)$/))A.push("a=mid:"),A.push(g.mid),A.push("\r\n"),g.bandwidth>0&&(A.push("b=AS:"),A.push(g.bandwidth),A.push("\r\n"),A.push("b=TIAS:"),A.push(g.bandwidth),A.push("000"),A.push("\r\n"));else if("a=sendrecv"!==Re&&"a=recvonly"!==Re&&"a=sendonly"!==Re&&"a=inactive"!==Re){if(!Re.match(/^a=ssrc-group:SIM (.+)$/)&&!Re.match(/^a=ssrc-group:FID (.+)$/)){if(Re.match(/^a=ssrc:(\d+) (.+)$/)){if(E)continue;E=!0;for(var me=0;me<g.ssrc_groups.sim.length;me+=1)A.push("a=ssrc-group:SIM "),A.push(g.ssrc_groups.sim[me].join(" ")),A.push("\r\n");for(var Te=0;Te<g.ssrc_groups.fid.length;Te+=1)A.push("a=ssrc-group:FID "),A.push(g.ssrc_groups.fid[Te].join(" ")),A.push("\r\n");for(var ge=function(we){var Pe=g.ssrcs[we];["cname","msid","mslabel","label"].forEach(function(We){Object.prototype.hasOwnProperty.call(Pe.content,We)&&(A.push("a=ssrc:"),A.push(Pe.ssrc),A.push(" "),A.push(We),A.push(":"),A.push(Pe.content[We]),A.push("\r\n"))})},Ie=0;Ie<g.ssrcs.length;Ie+=1)ge(Ie);continue}A.push(Re),A.push("\r\n");continue}}else A.push("a="),A.push(g.direction),A.push("\r\n")}else{if(Re.match(/^b=/))continue;A.push(Re),A.push("\r\n")}}}return A.join("")};var n=i.Y.get("SDPManager"),y=function(){n.debug("SDPManager"),this.getSDPLines=function(G){n.debug("SDPManager::getSDPLines");var A,t=G.split("\r\n");for(A=0;A<t.length;A+=1)n.log("sdpLines[i] : "+t[A]);return t},this.getAudioMediaDescriptionPart=function(G){n.debug("SDPManager::getAudioMediaDescriptionPart");var A=G.split("m=audio"),t=null;return null!=A[1]?(t=A[1].split("m=video"),n.log("SDP audio part : "+t[0]),t[0]):null},this.getVideoMediaDescriptionPart=function(G){n.debug("SDPManager::getVideoMediaDescriptionPart");var A,t=G.split("m=video");for(A=0;A<t.length;A+=1)n.log("sdpMediaPart[i] : "+t[A]);return t[1]},this.searchMediaDescriptionForRecvOnly=function(G){return n.debug("searchMediaDescriptionForRecvOnly"),-1!==G.search("a=recvonly")?(n.log("recvonly found in media description"),!0):(n.log("recvonly not found in media description"),!1)},this.searchSDPForRecvOnly=function(G){return void 0!==G?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForRecvOnly(G)):(n.log("recvonly not found in SDP"),!1)},this.searchMediaDescriptionForSendOnly=function(G){return n.debug("searchMediaDescriptionForSendOnly"),-1!==G.search("a=sendonly")?(n.log("sendonly found in media description"),!0):(n.log("sendonly not found in media description"),!1)},this.searchSDPForSendOnly=function(G){return void 0!==G?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForSendOnly(G)):(n.log("sendonly not found in SDP"),!1)},this.searchMediaDescriptionForInactive=function(G){return n.debug("searchMediaDescriptionForInactive"),-1!==G.search("a=inactive")?(n.log("inactive found in media description"),!0):(n.log("inactive not found in media description"),!1)},this.searchSDPForInactive=function(G){return void 0!==G?(n.log("sdpPart !== undefined"),this.searchMediaDescriptionForInactive(G)):(n.log("inactive not found in SDP"),!1)},this.stripAudioMediaDescriptionFromSDP=function(G){n.debug("SDPManager::stripAudioMediaDescriptionFromSDP");var A=this.createGuideline(G);return A.audio?(A.audio.direction="inactive",A.generate({stripInactiveMLines:!0})):G},this.stripVideoMediaDescriptionFromSDP=function(G){n.debug("SDPManager::stripVideoMediaDescriptionFromSDP");var A=this.createGuideline(G);return A.video?(A.video.direction="inactive",A.generate({stripInactiveMLines:!0})):G},this.setAudioBandwidth=function(G,A){return n.info("SDPManager::setAudioBandwidth",A),A?G=G.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+A+"\r\n"):(n.warn("No maxAudioBW !"),G)},this.setVideoBandwidth=function(G,A){if(n.info("SDPManager::setVideoBandwidth",A),!A)return n.warn("No maxVideoBW !"),G;for(var t=[],l=G.split("\r\n"),s=0,v=null,r=null;s<l.length;)if(0!==(v=l[s]).length)if(null!==r)v.match(/^m=/)?r=null:v.match(/^a=mid:(\w+)$/)?(t.push(v),t.push("\r\n"),t.push("b=AS:"),t.push(A),t.push("\r\n"),t.push("b=TIAS:"),t.push(A),t.push("000"),t.push("\r\n"),s+=1):(v.match(/^b=([A-Z]+):(\w+)$/)||(t.push(v),t.push("\r\n")),s+=1);else{var g=v.match(/^m=([a-z]+)(.+)$/);if(g&&"video"===g[1]){r="video",t.push(v),t.push("\r\n"),s+=1;continue}t.push(v),t.push("\r\n"),s+=1}else s+=1;return t.join("")},this.setDataBandwidth=function(G,A){return n.info("SDPManager::setDataBandwidth",A),A?G=G.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+A+"\r\n"):(n.warn("No maxDataBW !"),G)},this.setSendOnlyForAudio=function(G){n.debug("SDPManager::setSendOnlyForAudio");var A=this.createGuideline(G);return(0,h.ki)(A,"audio","object")&&(A.audio.direction="sendonly"),A.generate()},this.setSendOnlyForVideo=function(G){n.debug("SDPManager::setSendOnlyForVideo");var A=this.createGuideline(G);return(0,h.ki)(A,"video","object")&&(A.video.direction="sendonly"),A.generate()},this.setSendOnly=function(G){n.debug("SDPManager::setSendOnly : global");var A=this.createGuideline(G);return(0,h.ki)(A,"audio","object")&&(A.audio.direction="sendonly"),(0,h.ki)(A,"video","object")&&(A.video.direction="sendonly"),A.generate()},this.setRecvOnlyForAudio=function(G){n.debug("SDPManager::setRecvOnlyForAudio");var A=this.createGuideline(G);return A.audio&&"inactive"!==A.audio.direction&&(A.audio.direction="recvonly"),A.generate()},this.setRecvOnlyForVideo=function(G){n.debug("SDPManager::setRecvOnlyForVideo");var A=this.createGuideline(G);return A.video&&"inactive"!==A.video.direction&&(A.video.direction="recvonly"),A.generate()},this.setRecvOnly=function(G){n.debug("SDPManager::setRecvOnly : global");var A=this.createGuideline(G);return A.audio&&"inactive"!==A.audio.direction&&(A.audio.direction="recvonly"),A.video&&"inactive"!==A.video.direction&&(A.video.direction="recvonly"),A.generate()},this.updateSDPcodecs=function(G,A,t,l){var s,v,r,g,E,te,ae,Re,Ce=!1,re=new RegExp("\r\n$"),K=!1,L=null,ne="",ee="",me="",Te="",ge="",Ie="";if(n.log("updateSDPcodecs():\n\tsdpType = "+A+"\n\tmediaType = "+t+"\n\tavailableCodecSet = "+l+"\n"),""==l)return G;for(r=(r=RTCSessionDescription&&G instanceof RTCSessionDescription?G.sdp:window.SessionDescription&&G instanceof SessionDescription?G.toSdp():G).split("\r\nm="),!1===re.test(r[r.length-2])&&(r[r.length-2]=r[r.length-2]+"\r\n",K=!0),s=0;s<r.length;s++)if(0===r[s].indexOf(t)){for(L=r[s].split("\r\n")[0].split(" "),v=3;v<L.length;v++)if(g=!0,!1===isNaN(L[v])){switch(-1!==(E=r[s].indexOf(ee="a=rtpmap:"+L[v]+" "))&&(te=r[s].indexOf("\r\n",E)),L[v]){case 0:ne="PCMU/8000";break;case 8:ne="PCMA/8000";break;case 9:ne="G722/8000";break;case 13:ne="CN/8000";break;case 18:ne="G729/8000";break;default:-1!==E&&(ne=r[s].substring(E+ee.length,te))}""!=ne&&-1!==l.indexOf(ne)?n.log("PT("+L[v]+"): "+ne+" FOUND in availableCodecSet.\n"):(g=!1,n.log("PT("+L[v]+"): "+ne+" NOT FOUND in availableCodecSet.\n")),g||(me="a=fmtp:"+L[v]+" .*\r\n",Ie="a=rtcp-fb:"+L[v]+" .*\r\n",Te=" "+L[v]+" ",ge=" "+L[v]+"\r",r[s]=r[s].replace(new RegExp(ee+".*\r\n","g"),""),r[s]=r[s].replace(new RegExp(me,"g"),""),r[s]=r[s].replace(new RegExp(Ie,"g"),""),(Re=(ae=r[s].split("\n"))[0].split("RTP"))[1]=Re[1].replace(Te," "),Re[1]=Re[1].replace(ge,"\r"),ae[0]=Re.join("RTP"),r[s]=ae.join("\n"),"video"===t&&(Ie="a=rtcp-fb:"+L[v]+" .*\r\n",r[s]=r[s].replace(new RegExp(Ie,"g"),""),""!=ne&&"rtx/"===ne.substr(0,4)&&(r[s]=r[s].replace(new RegExp("a=ssrc-group:FID .*\r\n","g"),""),(ae=r[s].split("\r\na=")).splice(ae.length-8,4),r[s]=ae.join("\r\na="))),Ce=!0)}break}return K&&(r[r.length-2]=r[r.length-2].substr(0,r[r.length-2].length-2)),r=r.join("\r\nm="),!0===Ce?(n.log("updateSDPcodecs(), SDP has been updated."),RTCSessionDescription&&G instanceof RTCSessionDescription?new RTCSessionDescription({type:A,sdp:r}):window.SessionDescription&&G instanceof SessionDescription?new SessionDescription(r):r):(n.log("updateSDPcodecs(), SDP has not been updated."),G)},this.preferOpus=function(G){var A,t=G.split("\r\n"),l=0,s=null;for(A=0;A<t.length;A+=1)if(-1!==t[A].search("m=audio")){l=A;break}if(0===l)return G;for(A=0;A<t.length;A+=1)if(-1!==t[A].search("opus/48000")){(s=this.extractSdp(t[A],/:(\d+) opus\/48000/i))&&(t[l]=this.setDefaultCodec(t[l],s));break}return(t=this.removeCN(t,l)).join("\r\n")},this.removeCN=function(G,A){var t=0,l=G[A].split(" "),s=null,v=0;for(t=G.length-1;t>=0;t--)(s=this.extractSdp(G[t],/a=rtpmap:(\d+) CN\/\d+/i))&&(-1!==(v=l.indexOf(s))&&l.splice(v,1),G.splice(t,1));return G[A]=l.join(" "),G},this.extractSdp=function(G,A){var t=G.match(A);return t&&2==t.length?t[1]:null},this.setDefaultCodec=function(G,A){var t=0,l=G.split(" "),s=l.slice(0,3);for(s.push(A),t=3;t<l.length;t++)l[t]!==A&&s.push(l[t]);return s.join(" ")},this.findLineInRange=function(G,A,t,l,s){var v,r=-1!==t?t:G.length;for(v=A;v<r;++v)if(0===G[v].indexOf(l)&&(!s||-1!==G[v].toLowerCase().indexOf(s.toLowerCase())))return v;return null},this.findLine=function(G,A,t){return this.findLineInRange(G,0,-1,A,t)},this.getCodecPayloadType=function(G,A){var t=this.findLine(G,"a=rtpmap",A);return t?this.getCodecPayloadTypeFromLine(G[t]):null},this.getCodecPayloadTypeFromLine=function(G){var A=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=G.match(A);return t&&2===t.length?t[1]:null},this.findFmtpLine=function(G,A){var t=this.getCodecPayloadType(G,A);return t?this.findLine(G,"a=fmtp:"+t.toString()):null},this.writeFmtpLine=function(G){if(!G.hasOwnProperty("pt")||!G.hasOwnProperty("params"))return null;var A=G.pt,t=G.params,l=[],s=0,v=null;for(v in t)l[s]=v+"="+t[v],++s;return 0===s?null:"a=fmtp:"+A.toString()+" "+l.join("; ")},this.setCodecParam=function(G,A,t,l){var s=G.split("\r\n"),v=this.findFmtpLine(s,A),r={},g=null,E=null;if(null===v){if(null===(E=this.findLine(s,"a=rtpmap",A)))return G;g=this.getCodecPayloadTypeFromLine(s[E]),r.pt=g.toString(),r.params={},r.params[t]=l,s.splice(E+1,0,this.writeFmtpLine(r))}else(r=function(te){var ae,Re={},Ce=te.indexOf(" "),re=te.substring(Ce+1).split("; "),K=new RegExp("a=fmtp:(\\d+)"),L=te.match(K),ne={},ee=null;if(!L||2!==L.length)return null;for(Re.pt=L[1],ae=0;ae<re.length;++ae)2===(ee=re[ae].split("=")).length&&(ne[ee[0]]=ee[1]);return Re.params=ne,Re}(s[v])).params[t]=l,s[v]=this.writeFmtpLine(r);return s.join("\r\n")},this.maybePreferCodec=function(G,A,t){var l,s,v=A+" codec",r=null;return t?(n.log("Prefer "+v+": "+t),r=G.split("\r\n"),null===(l=this.findLine(r,"m=",A))?(n.log("mLineIndex === null"),G):((s=this.getCodecPayloadType(r,t))&&(r[l]=this.setDefaultCodec(r[l],s)),G=r.join("\r\n"))):(n.log("No preference on "+v+"."),G)},this.createGuideline=C},R=(e(9753),e(1038),e(1249),e(7327),e(3843),function(G,A,t,l,s,v,r,g){this.rawStats={},this.rawStats.connectedPair=[],this.rawStats.audio_send=[],this.rawStats.audio_recv=[],this.rawStats.video_send=[],this.rawStats.video_recv=[],this.instantRTT=0,this.moyRttCP=[0,0,0,0,0,0,0,0,0,0],this.moyRttAS=[0,0,0,0,0,0,0,0,0,0],this.moyRttVS=[0,0,0,0,0,0,0,0,0,0],this.tauxPacketLossAS=[0],this.oldLostAS=this.oldSentAS=0,this.oldLostVS=this.oldLostVS=0,this.cptTaux=0,this.tauxPacketLossVS=[0],this.oldBandwidthAS=0,this.oldBandwidthVS=0,this.oldBandwidthAR=0,this.oldBandwidthVR=0,this.bandwidthAS=[0,0,0,0,0,0,0,0,0,0],this.bandwidthAR=[0,0,0,0,0,0,0,0,0,0],this.bandwidthVS=[0,0,0,0,0,0,0,0,0,0],this.bandwidthVR=[0,0,0,0,0,0,0,0,0,0],this.qosIn=0,this.qosInAverage=0,this.qosInAverageCount=0,this.qosAudioIn=0,this.qosAudioInAverage=0,this.qosAudioInAverageCount=0,this.qosVideoIn=0,this.qosVideoInAverage=0,this.qosVideoInAverageCount=0,this.qosOut=0,this.qosOutAverage=0,this.qosOutAverageCount=0,this.qosAudioOut=0,this.qosAudioOutAverage=0,this.qosAudioOutAverageCount=0,this.qosVideoOut=0,this.qosVideoOutAverage=0,this.qosVideoOutAverageCount=0,this.onQosChange=A,this.onQosAudioChange=t,this.onQosVideoChange=l,this.cpt=0,this.cptRes=5,this.cptDb=60,this.saveStatsFlag=!0,this.tabQosIn=[],this.tabQosAudioIn=[],this.tabQosVideoIn=[],this.tabQosOut=[],this.tabQosAudioOut=[],this.tabQosVideoOut=[],this.tabTimestamp=[],this.tabDelay=[],this.tabJitterBufferAudio=[],this.tabJitterBufferVideo=[],this.tabAudioRtt=[],this.tabVideoRtt=[],this.tabAudioBW=[],this.tabVideoBW=[],this.clientId=r,this.callId=s,this.apiKey=v,this.socket=g,this.interval=G,this.insertStats=function(E,te,ae,Re){var Ce,re,K,L=null;for(this.cpt=this.cpt+this.interval,Ce=0;Ce<E.length;++Ce){var ne=E[Ce];switch(ne.type){case"googCandidatePair":for(L=ne.names(),K=0;K<L.length;++K)if("googActiveConnection"==L[K]&&"true"==ne.stat(L[K]))for(re=0;re<L.length;++re)"bytesSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.connectedPair.bytesSent=ne.stat(L[re])),"bytesReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.connectedPair.bytesReceived=ne.stat(L[re])),"googRtt"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.connectedPair.googRtt=ne.stat(L[re]));break;case"ssrc":for(L=ne.names(),K=0;K<L.length;++K){if("audioOutputLevel"==L[K])for(re=0;re<L.length;++re)"packetsLost"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.packetsLost=ne.stat(L[re])),"googDecodingPLC"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.googDecodingPLC=ne.stat(L[re])),"googJitterReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.googJitterReceived=ne.stat(L[re])),"googJitterBufferMs"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.googJitterBufferMs=ne.stat(L[re])),"googCurrentDelayMs"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.googCurrentDelayMs=ne.stat(L[re])),"bytesReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_recv.bytesReceived=ne.stat(L[re]));if("audioInputLevel"==L[K])for(re=0;re<L.length;++re)"googRtt"==L[re]&&void 0!==ne.stat(L[re])&&-1!=ne.stat(L[re])&&(this.rawStats.audio_send.googRtt=ne.stat(L[re])),"packetsLost"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_send.packetsLost=ne.stat(L[re])),"packetsSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_send.packetsSent=ne.stat(L[re])),"bytesSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_send.bytesSent=ne.stat(L[re])),"googJitterReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.audio_send.googJitterReceived=ne.stat(L[re]));if("googFrameHeightReceived"==L[K])for(re=0;re<L.length;++re)"googFrameHeightReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.FrameHeight=ne.stat(L[re])),"googFrameWidthReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.FrameWidth=ne.stat(L[re])),"googCurrentDelayMs"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.delay=ne.stat(L[re])),"packetsLost"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.packetsLost=ne.stat(L[re])),"googNacksSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.googNacksSent=ne.stat(L[re])),"googJitterBufferMs"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.googJitterBufferMs=ne.stat(L[re])),"bytesReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.bytesReceived=ne.stat(L[re])),"googFrameRateReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_recv.googFrameRateReceived=ne.stat(L[re]));if("googFrameHeightSent"==L[K])for(re=0;re<L.length;++re)"googFrameHeightSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.FrameHeight=ne.stat(L[re])),"googFrameWidthSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.FrameWidth=ne.stat(L[re])),"packetsLost"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.packetsLost=ne.stat(L[re])),"googNacksReceived"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.googNacksReceived=ne.stat(L[re])),"googRtt"==L[re]&&void 0!==ne.stat(L[re])&&-1!=ne.stat(L[re])&&(this.rawStats.video_send.googRtt=ne.stat(L[re])),"packetsSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.packetsSent=ne.stat(L[re])),"bytesSent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.bytesSent=ne.stat(L[re])),"googEncodeUsagePercent"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.googEncodeUsagePercent=ne.stat(L[re])),"googCpuLimitedResolution"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.googCpuLimitedResolution=ne.stat(L[re])),"googBandwidthLimitedResolution"==L[re]&&void 0!==ne.stat(L[re])&&(this.rawStats.video_send.googBandwidthLimitedResolution=ne.stat(L[re]))}}}this.computeStats(te,ae,Re),this.cpt%this.cptRes==0&&this.saveStatsLocal(),this.cpt%this.cptDb==0&&this.saveStatsToDb(!1)},this.saveStatsLocal=function(){if(this.saveStatsFlag){var E=Date.now();this.tabTimestamp.push(E),this.tabQosIn.push(this.qosIn),this.tabQosAudioIn.push(this.qosAudioIn),0!==this.qosVideoIn&&this.tabQosVideoIn.push(this.qosVideoIn),this.tabQosOut.push(this.qosOut),this.tabQosAudioOut.push(this.qosAudioOut),0!==this.qosVideoOut&&this.tabQosVideoOut.push(this.qosVideoOut),this.tabJitterBufferAudio.push(this.rawStats.audio_recv.googJitterBufferMs),void 0!==this.rawStats.video_recv.googJitterBufferMs&&this.tabJitterBufferVideo.push(this.rawStats.video_recv.googJitterBufferMs),void 0!==this.rawStats.video_send.googRtt&&this.tabVideoRtt.push(this.rawStats.video_send.googRtt),this.tabAudioRtt.push(this.rawStats.audio_send.googRtt),void 0!==this.bandwidthAS&&this.tabVideoBW.push(8*this.Average(this.bandwidthAS)/1024),void 0!==this.bandwidthVS&&this.tabVideoBW.push(8*this.Average(this.bandwidthVS)/1024),void 0!==this.bandwidthAR&&this.tabVideoBW.push(8*this.Average(this.bandwidthAR)/1024),void 0!==this.bandwidthVR&&this.tabVideoBW.push(8*this.Average(this.bandwidthVR)/1024)}},this.saveStatsToDb=function(E){},this.saveStatsToDb=function(E){this.saveStatsFlag=E},this.computeStats=function(E,te,ae){var Re=0;-1!==this.rawStats.connectedPair.googRtt&&0!==this.rawStats.connectedPair.googRtt&&void 0!==this.rawStats.connectedPair.googRtt&&this.add(this.rawStats.connectedPair.googRtt,this.moyRttCP),-1!==this.rawStats.video_send.googRtt&&0!==this.rawStats.video_send.googRtt&&void 0!==this.rawStats.video_send.googRtt&&(this.add(this.rawStats.video_send.googRtt,this.moyRttVS),this.instantRTT=this.rawStats.video_send.googRtt),-1!==this.rawStats.audio_send.googRtt&&0!==this.rawStats.audio_send.googRtt&&void 0!==this.rawStats.audio_send.googRtt&&this.add(this.rawStats.audio_send.googRtt,this.moyRttAS),-1!==this.rawStats.audio_send.packetsLost&&void 0!==this.rawStats.audio_send.packetsLost&&-1!==this.rawStats.audio_send.packetsSent&&0!==this.rawStats.audio_send.packetsSent&&void 0!==this.rawStats.audio_send.packetsSent&&(Re=100*(this.rawStats.audio_send.packetsLost-this.oldLostAS)/(this.rawStats.audio_send.packetsSent-this.oldSentAS),this.oldLostAS=this.rawStats.audio_send.packetsLost,this.oldSentAS=this.rawStats.audio_send.packetsSent,this.add(Re,this.tauxPacketLossAS)),-1!==this.rawStats.video_send.packetsLost&&void 0!==this.rawStats.video_send.packetsLost&&-1!==this.rawStats.video_send.packetsSent&&0!==this.rawStats.video_send.packetsSent&&void 0!==this.rawStats.video_send.packetsSent&&(Re=100*(this.rawStats.video_send.packetsLost-this.oldLostVS)/(this.rawStats.video_send.packetsSent-this.oldSentVS),this.oldLostVS=this.rawStats.video_send.packetsLost,this.oldSentVS=this.rawStats.video_send.packetsSent,this.add(Re,this.tauxPacketLossVS)),-1!==this.rawStats.audio_recv.bytesReceived&&void 0!==this.rawStats.audio_recv.bytesReceived&&(void 0===this.oldBandwidthAR&&(this.oldBandwidthAR=0),this.add((this.rawStats.audio_recv.bytesReceived-this.oldBandwidthAR)/this.interval,this.bandwidthAR),this.oldBandwidthAR=this.rawStats.audio_recv.bytesReceived),-1!==this.rawStats.video_recv.bytesReceived&&void 0!==this.rawStats.video_recv.bytesReceived&&(void 0===this.oldBandwidthVR&&(this.oldBandwidthVR=0),this.add((this.rawStats.video_recv.bytesReceived-this.oldBandwidthVR)/this.interval,this.bandwidthVR),this.oldBandwidthVR=this.rawStats.video_recv.bytesReceived),-1!==this.rawStats.audio_send.bytesSent&&void 0!==this.rawStats.audio_send.bytesSent&&(void 0===this.oldBandwidthAS&&(this.oldBandwidthAS=0),this.add((this.rawStats.audio_send.bytesSent-this.oldBandwidthAS)/this.interval,this.bandwidthAS),this.oldBandwidthAS=this.rawStats.audio_send.bytesSent),-1!==this.rawStats.video_send.bytesSent&&void 0!==this.rawStats.video_send.bytesSent&&(void 0===this.oldBandwidthVS&&(this.oldBandwidthVS=0),this.add((this.rawStats.video_send.bytesSent-this.oldBandwidthVS)/this.interval,this.bandwidthVS),this.oldBandwidthVS=this.rawStats.video_send.bytesSent);var Ce=0,re=0,K=0,L=0,ne=0,ee=0,ce=0,me=0,Te=0,ge=0,Ie=this.getCodecs(te),we=8*this.Average(this.bandwidthAS)/1024;if(we<5?Ce=1:we>=5&&we<10?Ce=2:we>=10&&(Ce=3),null!==Ie&&Ie[1]){var Pe=8*this.Average(this.bandwidthVS)/1024;Pe<240?L=1:Pe>=240&&Pe<330?L=2:Pe>=330&&(L=3)}this.rawStats.audio_recv.googJitterBufferMs<60?re=3:this.rawStats.audio_recv.googJitterBufferMs>=60&&this.rawStats.audio_recv.googJitterBufferMs<100?re=2:this.rawStats.audio_recv.googJitterBufferMs>=100&&(re=1),this.rawStats.audio_recv.googCurrentDelayMs<100?K=3:this.rawStats.audio_recv.googCurrentDelayMs>=100&&this.rawStats.audio_recv.googCurrentDelayMs<200?K=2:this.rawStats.audio_recv.googCurrentDelayMs>=200&&(K=1),null!==Ie&&Ie[1]&&(this.rawStats.video_recv.googJitterBufferMs<100?ne=3:this.rawStats.video_recv.googJitterBufferMs>=100&&this.rawStats.video_recv.googJitterBufferMs<200?ne=2:this.rawStats.video_recv.googJitterBufferMs>=200&&(ne=1));var We=!1,Je=!1,tt=!1;null!==Ie&&Ie[1]?(Math.ceil((Ce+2*L+ne+re+K)/6)!=this.qosIn&&(We=!0),this.qosIn=Math.ceil((Ce+2*L+ne+re+K)/6),this.qosInAverage=(this.qosInAverage*this.qosInAverageCount+this.qosIn)/(this.qosInAverageCount+1),this.qosInAverageCount++,Math.ceil((Ce+re+K)/3)!=this.qosAudioIn&&(Je=!0),this.qosAudioIn=Math.ceil((Ce+re+K)/3),this.qosAudioInAverage=(this.qosAudioInAverage*this.qosAudioInAverageCount+this.qosAudioIn)/(this.qosAudioInAverageCount+1),this.qosAudioInAverageCount++,Math.ceil((2*L+ne)/3)!=this.qosVideoIn&&(tt=!0),this.qosVideoIn=Math.ceil((2*L+ne)/3),this.qosVideoInAverage=(this.qosVideoInAverage*this.qosVideoInAverageCount+this.qosVideoIn)/(this.qosVideoInAverageCount+1),this.qosVideoInAverageCount++):(Math.ceil((Ce+re+K)/3)!=this.qosOut&&(We=!0),this.qosIn=Math.ceil((Ce+re+K)/3),this.qosInAverage=(this.qosInAverage*this.qosInAverageCount+this.qosIn)/(this.qosInAverageCount+1),this.qosInAverageCount++,Math.ceil((Ce+re+K)/3)!=this.qosAudioIn&&(Je=!0),this.qosAudioIn=Math.ceil((Ce+re+K)/3),this.qosAudioInAverage=(this.qosAudioInAverage*this.qosAudioInAverageCount+this.qosAudioIn)/(this.qosAudioInAverageCount+1),this.qosAudioInAverageCount++),this.RttAverage(this.moyRttAS)<80?ce=3:this.RttAverage(this.moyRttAS)>=80&&this.RttAverage(this.moyRttAS)<150?ce=2:this.RttAverage(this.moyRttAS)>=150&&(ce=1),this.tauxPacketLossAS<=5?ee=3:this.tauxPacketLossAS>5&&this.tauxPacketLossAS<10?ee=2:this.tauxPacketLossAS>=10&&(ee=1),this.rawStats.audio_recv.googJitterReceived<80?me=3:this.rawStats.audio_recv.googJitterReceived>=80&&this.rawStats.audio_recv.googJitterReceived<150?me=2:this.rawStats.audio_recv.googJitterReceived>=150&&(me=1),null!==Ie&&Ie[1]&&(this.tauxPacketLossVS<=5?Te=3:this.tauxPacketLossVS>5&&this.tauxPacketLossVS<10?Te=2:this.tauxPacketLossVS>=10&&(Te=1),this.RttAverage(this.moyRttVS)<80?ge=3:this.RttAverage(this.moyRttVS)>=80&&this.RttAverage(this.moyRttVS)<150?ge=2:this.RttAverage(this.moyRttVS)>=150&&(ge=1)),null!==Ie&&Ie[1]?(Math.ceil((ce+2*ee+me+2*Te+ge)/7)!=this.qosOut&&(We=!0),this.qosOut=Math.ceil((ce+2*ee+me+2*Te+ge)/7),this.qosOutAverage=(this.qosOutAverage*this.qosOutAverageCount+this.qosOut)/(this.qosOutAverageCount+1),this.qosOutAverageCount++,Math.ceil((ce+2*ee+me)/4)!=this.qosAudioOut&&(Je=!0),this.qosAudioOut=Math.ceil((ce+2*ee+me)/4),this.qosAudioOutAverage=(this.qosAudioOutAverage*this.qosAudioOutAverageCount+this.qosAudioOut)/(this.qosAudioOutAverageCount+1),this.qosAudioOutAverageCount++,Math.ceil((2*Te+ge)/3)!=this.qosVideoOut&&(tt=!0),this.qosVideoOut=Math.ceil((2*Te+ge)/3),this.qosVideoOutAverage=(this.qosVideoOutAverage*this.qosVideoOutAverageCount+this.qosVideoOut)/(this.qosVideoOutAverageCount+1),this.qosVideoOutAverageCount++):(Math.ceil((ce+2*ee+me)/4)!=this.qosOut&&(We=!0),this.qosOut=Math.ceil((ce+2*ee+me)/4),this.qosOutAverage=(this.qosOutAverage*this.qosOutAverageCount+this.qosOut)/(this.qosOutAverageCount+1),this.qosOutAverageCount++,Math.ceil((ce+2*ee+me)/4)!=this.qosAudioOut&&(Je=!0),this.qosAudioOut=Math.ceil((ce+2*ee+me)/4),this.qosAudioOutAverage=(this.qosAudioOutAverage*this.qosAudioOutAverageCount+this.qosAudioOut)/(this.qosAudioOutAverageCount+1),this.qosAudioOutAverageCount++),We&&this.onQosChange(this.qosIn,this.qosOut),Je&&this.onQosAudioChange(this.qosAudioIn,this.qosAudioOut),tt&&this.onQosVideoChange(this.qosVideoIn,this.qosVideoOut)},this.getCodecs=function(E){var te=!1,ae=!1,Re=null,Ce=null;if(null!=E&&void 0!==E.sdp){for(var re=E.sdp.split("\n"),K=0;K<re.length;K++)-1!=re[K].indexOf("a=mid:audio")&&(te=!0),-1!=re[K].indexOf("a=mid:video")&&(ae=!0),te&&-1!=re[K].indexOf("a=rtpmap:")&&(Re=re[K],te=!1),ae&&-1!=re[K].indexOf("a=rtpmap:")&&(Ce=re[K],ae=!1);return[Re,Ce]}return null},this.getQosScore=function(){return[this.qosIn,this.qosOut,this.qosAudioIn,this.qosAudioOut,this.qosVideoIn,this.qosVideoOut]},this.getStat=function(E){switch(E){case"AudioOutBandwidth":return 8*this.Average(this.bandwidthAS)/1024;case"VideoOutBandwidth":return 8*this.Average(this.bandwidthVS)/1024;case"AudioInBandwidth":return 8*this.Average(this.bandwidthAR)/1024;case"VideoInBandwidth":return 8*this.Average(this.bandwidthVR)/1024;case"AudioInJitterReceived":return this.rawStats.audio_recv.googJitterReceived;case"AudioInJitterBufferMs":return this.rawStats.audio_recv.googJitterBufferMs;case"AudioInDelay":return this.rawStats.audio_recv.googCurrentDelayMs;case"AudioOutLossRate":return this.tauxPacketLossAS;case"AudioOutRtt":return this.RttAverage(this.moyRttAS);case"AudioOutJitterReceived":return this.rawStats.audio_send.googJitterReceived;case"VideoInJitterBufferMs":return this.rawStats.video_recv.googJitterBufferMs;case"VideoOutLossRate":return this.tauxPacketLossVS;case"VideoOutRtt":return this.RttAverage(this.moyRttVS)}},this.getAllStats=function(){for(var E={AudioRecv:{},AudioSend:{},VideoRecv:{},VideoSend:{}},te={AudioRecv:"audio_recv",VideoRecv:"video_recv",AudioSend:"audio_send",VideoSend:"video_send"},ae=Object.keys(te),Re=0;Re<ae.length;Re++)for(var Ce=Object.keys(this.rawStats[te[ae[Re]]]),re=0;re<Ce.length;re++)E[ae[Re]][Ce[re]]=this.rawStats[te[ae[Re]]][Ce[re]];return E.AudioRecv.bandwidth=8*this.Average(this.bandwidthAR)/1024,E.VideoRecv.bandwidth=8*this.Average(this.bandwidthVR)/1024,E.AudioSend.bandwidth=8*this.Average(this.bandwidthAS)/1024,E.VideoSend.bandwidth=8*this.Average(this.bandwidthVS)/1024,E.AudioRecv.jitterReceived=this.rawStats.audio_recv.googJitterReceived,E.AudioRecv.jitterBufferMs=this.rawStats.audio_recv.googJitterBufferMs,E.VideoRecv.jitterBufferMs=this.rawStats.video_recv.googJitterBufferMs,E.AudioRecv.delay=this.rawStats.audio_recv.googCurrentDelayMs,E.AudioSend.rtt=this.RttAverage(this.moyRttAS),E.VideoSend.moyRtt=this.RttAverage(this.moyRttVS),E.VideoSend.rtt=this.instantRTT,E.VideoSend.FrameHeight=this.rawStats.video_send.FrameHeight,E.VideoSend.FrameWidth=this.rawStats.video_send.FrameWidth,E.AudioSend.packetLostRatio=this.tauxPacketLossAS[this.tauxPacketLossAS.length-1],E.VideoSend.packetLostRatio=this.tauxPacketLossVS[this.tauxPacketLossVS.length-1],E.VideoSend.googEncodeUsagePercent=this.rawStats.video_send.googEncodeUsagePercent,E.VideoSend.googCpuLimitedResolution=this.rawStats.video_send.googCpuLimitedResolution,E.VideoSend.googBandwidthLimitedResolution=this.rawStats.video_send.googBandwidthLimitedResolution,delete E.AudioRecv.googCurrentDelayMs,delete E.AudioRecv.googJitterReceived,delete E.AudioRecv.googJitterBufferMs,delete E.VideoRecv.googJitterBufferMs,delete E.AudioSend.googRtt,delete E.VideoSend.googRtt,E},this.displayComputedStats=function(){console.log("Audio IN JitterReceived:"+this.rawStats.audio_recv.googJitterReceived+" jitterbufferMs:"+this.rawStats.audio_recv.googJitterBufferMs+" delay:"+this.rawStats.audio_recv.googCurrentDelayMs+" bandwidth :"+8*this.Average(this.bandwidthAS)/1024+" kBits/s"),console.log("Audio OUT  lossRate:"+this.tauxPacketLossAS+" rtt:"+this.RttAverage(this.moyRttAS)+" googJitterReceived:"+this.rawStats.audio_recv.googJitterReceived),console.log("Video IN jitter buffer ms:"+this.rawStats.video_recv.googJitterBufferMs+" bandwidth:"+8*this.Average(this.bandwidthVS)/1024+" kBits/s"),console.log("Video OUT loss rate:"+this.tauxPacketLossVS+" rtt:"+this.RttAverage(this.moyRttVS))},this.RttAverage=function(E){for(var te=0,ae=0,Re=0;Re<E.length;++Re)0!==E[Re]&&-1!==E[Re]&&void 0!==E[Re]&&(te+=parseInt(E[Re],10),ae++);return parseInt(te/ae,10)},this.Average=function(E){for(var te=0,ae=0,Re=0;Re<E.length;++Re)-1!=E[Re]&&void 0!==E[Re]&&(te+=parseInt(E[Re],10),ae++);return parseInt(te/ae,10)},this.add=function(E,te){te.pop(),te.unshift(E)},this.displayTab=function(E){for(var te in E)console.log(te+" = "+E[te])}}),m=i.Y.get("DataChannelFileSender"),u=apiCC.myWebRTC_Event,f=1<<17,I=function(G){this.call=G,this.sendChunkNb=0,this.send=function(A,t,l){var s=12e3,v={},r=null,g={},E=!1,te={};if(m.info("DataChannelFileSender send"),m.log("data.name :"+A.name),A.file instanceof Blob?(m.log("Blob"),this.blob=A.file,this.contentType=A.file.type,this.size=A.file.size,this.originalDataType="Blob"):A.file instanceof ArrayBuffer?(m.log("ArrayBuffer"),this.blob=A.file,this.contentType="application/octet-stream",this.size=A.file.byteLength,this.originalDataType="ArrayBuffer"):A.file instanceof String||"string"==typeof A.file?(m.log("string"),this.blob=A.file,this.size=A.file.length,this.contentType="application/octet-stream",this.originalDataType="String"):(m.log("unknown type"),this.blob=A.file,this.contentType="application/octet-stream",this.size=A.file.length||A.file.byteLength||A.file.size,this.originalDataType="Unknown"),this.contentType||(this.contentType="application/octet-stream"),0===this.size)return m.log("sending done"),void 0!==l&&(m.log("onProgress"),this.transferDuration=new Date-this.startingDate,l({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,lastPacket:E,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!0})),u.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,lastPacket:E,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!0}),void u.createEvent({eventType:"onFileSended",callId:G.callId,remoteId:G.remoteId,name:A.name,uuid:A.uuid});if(t)if("open"===t.readyState){if(0===this.sendChunkNb&&m.log("first packet"),0===this.sendChunkNb){A.uuid=(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"-"),m.log("first packet",g={name:A.name,type:A.type,size:this.size,contentType:this.contentType,uuid:A.uuid}),this.fileSize=this.size,void 0!==l&&(m.log("onProgress"),this.startingDate=new Date,this.transferDuration=0,l({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,lastPacket:E,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}),u.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,lastPacket:E,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}));try{t.send(JSON.stringify(g))}catch(ae){m.warn("error detected when sending on datachannel :",t),m.warn("error is :",ae)}u.createEvent({eventType:"onFileSending",callId:G.callId,remoteId:G.remoteId,name:A.name,uuid:A.uuid})}else{s<this.size?(m.log("sending chunk"),v=this.blob.slice(0,s)):(m.log("sending last chunk"),v=this.blob.slice(0),E=!0),m.log("dataToSend.byteLength ="+v.byteLength),te.message="ArrayBuffer"===this.originalDataType?h.cw.encode(v):v,te.messageSize=v.byteLength,te.uuid=A.uuid,te.originalDataType=this.originalDataType,void 0!==l&&(m.log("onProgress"),this.transferDuration=new Date-this.startingDate,l({sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,startingDate:this.startingDate,lastPacket:E,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}),u.createEvent({eventType:"onFileProgress",sendChunkNb:this.sendChunkNb,fileSize:this.fileSize,remainingSize:this.size,callId:G.callId,uuid:A.uuid,remoteId:G.remoteId,startingDate:this.startingDate,lastPacket:E,transferDuration:this.transferDuration,percentage:parseInt(100*(this.fileSize-this.size)/this.fileSize,10),transferEnded:!1}));try{t.send(JSON.stringify(te))}catch(ae){m.warn("error detected when sending on datachannel :",t),m.warn("error is :",ae)}}r=0===this.sendChunkNb?this.blob:this.blob.slice(s),!1===E?this.sendChunkNb++:this.sendChunkNb=0,A.file=r,setTimeout(function(){this.send(A,t,l)}.bind(this))}else m.log("Trying to send on a closed channel");else m.log("No data channel to send data")},this.terminateTransfer=function(){var A=this;m.debug("terminateTransfer; terminated: "+this.terminated),null!==this.channel?!0===this.useBufferedAmount&&this.channel.bufferedAmount>0&&!0!==this.canceled?setTimeout(this.terminateTransfer.bind(this)):!0!==this.terminated&&(this.terminated=!0,this.recvDataEndAckTimeoutId&&(clearTimeout(this.recvDataEndAckTimeoutId),delete this.recvDataEndAckTimeoutId),delete this.call.dcfs,m.debug("terminateTransfer; terminating"),this.call.pipelineCallId?(this.call.pipelineCall&&(delete this.call.pipelineCall.clientCall,delete this.call.pipelineCall,this.call.sendDataChannel=null),this.channel=null):setTimeout(function(){A.channel.close(),A.channel=null}),setTimeout(function(){if(!0===A.canceled)u.createEvent({eventType:"onFileSended",callId:A.call.callId,remoteId:A.call.remoteId,name:A.call.data.filename,error:"canceled"}),A.call.callbacks.failure("canceled");else if(A.call.failure)u.createEvent({eventType:"onFileSended",callId:A.call.callId,remoteId:A.call.remoteId,name:A.call.data.filename,error:A.call.failure}),A.call.callbacks.failure(A.call.failure);else{var t={eventType:"onFileSended",callId:A.call.callId,remoteId:A.call.remoteId,name:A.call.data.filename};A.call.success.data&&(t.data=A.call.success.data),u.createEvent(t),A.call.callbacks.success(A.call.success)}apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(A.call.callId)})):m.warn("No data channel to send data, leaving terminateTransfer")},this.recvDataEndAckTimeout=function(){m.error("recvDataEndAckTimeout"),this.call.failure="ackNotReceived",setTimeout(this.terminateTransfer.bind(this))},this.subsequentTransfer=function(){var A,t=!1;if(m.debug("subsequentTransfer; remByteCount: "+this.remByteCount),!0!==this.canceled)if(null!==this.channel)if(!0===this.useBufferedAmount&&this.channel.bufferedAmount>f)setTimeout(this.subsequentTransfer.bind(this));else try{for(;;){if(!(this.remByteCount>=this.chunkLength)){A=this.data.slice(this.offset,this.offset+this.remByteCount),this.channel.send(A),this.packetsSent+=1,m.debug("packetSent "+this.packetsSent+" "+this.remByteCount),this.offset+=this.remByteCount,this.remByteCount-=this.remByteCount,t=!0;break}if(A=this.data.slice(this.offset,this.offset+this.chunkLength),this.channel.send(A),this.packetsSent+=1,m.debug("packetSent "+this.packetsSent+" "+this.chunkLength),this.offset+=this.chunkLength,this.remByteCount-=this.chunkLength,this.remByteCount<=0){t=!0;break}if(!0!==this.useBufferedAmount||this.channel.bufferedAmount>f)break}!0===t?(u.createEvent({eventType:"onFileProgress",name:this.call.data.filename,sendChunkNb:this.packetsSent,fileSize:this.call.data.size,remainingSize:this.remByteCount,callId:this.call.callId,remoteId:this.call.remoteId,percentage:100}),this.call.callbacks.progress({state:"complete",filename:this.call.data.filename,size:this.call.data.size,remBytes:0,progress:100}),this.call.success={state:"complete",filename:this.call.data.filename,size:this.call.data.size,mediaURL:this.call.mediaURL,mediaId:this.call.mediaId},this.recvDataEndAckTimeoutId=setTimeout(this.recvDataEndAckTimeout.bind(this),3e4)):(u.createEvent({eventType:"onFileProgress",name:this.call.data.filename,sendChunkNb:this.packetsSent,fileSize:this.call.data.size,remainingSize:this.remByteCount,callId:this.call.callId,remoteId:this.call.remoteId,percentage:Math.floor(100*this.offset/this.call.data.size)}),this.call.callbacks.progress({state:"incomplete",filename:this.call.data.filename,size:this.call.data.size,remBytes:this.remByteCount,progress:Math.floor(100*this.offset/this.call.data.size)}),setTimeout(this.subsequentTransfer.bind(this)))}catch(l){return m.error("transfer: "+l),this.call.failure="dataChannelFailed",void setTimeout(this.terminateTransfer.bind(this))}else m.warn("No data channel to send data, leaving subsequentTransfer");else setTimeout(this.terminateTransfer.bind(this))},this.transfer=function(A,t,l){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},v=s.hasOwnProperty("delay")?s.delay:100;if(m.info("transfer",t,v),this.call.beginTimeoutId&&(clearTimeout(this.call.beginTimeoutId),delete this.call.beginTimeoutId),this.data=A,this.channel=l,null!==this.channel){"number"==typeof this.channel.bufferedAmount&&this.channel.bufferedAmount>=0&&(m.debug("browserDetails",h.wL),"chrome"===h.wL.type?h.wL.version>=37&&(this.useBufferedAmount=!0,m.debug("useBufferedAmount enabled")):(this.useBufferedAmount=!0,m.debug("useBufferedAmount enabled"))),this.chunkLength=8192,t>0?(this.offset=Math.floor(t/this.chunkLength)*this.chunkLength,this.remByteCount=this.data.byteLength-this.offset):(this.offset=0,this.remByteCount=this.data.byteLength),this.packetsSent=0;try{var r={chunkLength:this.chunkLength,offset:this.offset,remBytes:this.remByteCount};this.call.pipelineCallId&&(r.pluginName=G.data.pluginName,r.pluginData=G.data.pluginData,G.data.context&&(r.context=G.data.context)),this.channel.send(JSON.stringify(r))}catch(g){return m.error("transfer:",g),this.call.failure="dataChannelFailed",void setTimeout(this.terminateTransfer.bind(this))}u.createEvent({eventType:"onFileSending",callId:this.call.callId,remoteId:this.call.remoteId,name:this.call.data.filename}),setTimeout(this.subsequentTransfer.bind(this),v)}else m.warn("No data channel to send data, leaving transfer")}},c=(i.Y.get("CallStatsMonitor"),function(G,A,t,l){this.interval=G,this.browserType=A,this.browserVersion=t,this.flavor=l,this.prevData={},this.prevDataThreshold=10/G,this.prevDataThreshold<2&&(this.prevDataThreshold=2),this.STANDARD_STAT_KEYS={audioReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},videoReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteAudioSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteVideoSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},audioSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},videoSent:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteAudioReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1},remoteVideoReceived:{codecId:!1,id:!1,ssrc:!1,trackId:!1,transportId:!1}},this.refineStats_chrome_proprietary=function(s,v){var r,g;for(r=0;r<v.length;r+=1){var E=v[r],te=null,ae=null;if("ssrc"===E.type)if(E.id.indexOf("recv")>=0){if("audio"===E.stat("mediaType"))for(s.audioReceived={timestamp:Math.floor(Date.parse(E.timestamp))/1e3,type:"inbound-rtp",isRemote:!1,mediaType:"audio",packetsReceived:0,bytesReceived:0},te=E.names(),g=0;g<te.length;g+=1)"packetsReceived"===(ae=te[g])?s.audioReceived.packetsReceived=parseInt(E.stat("packetsReceived"),10):"bytesReceived"===ae&&(s.audioReceived.bytesReceived=parseInt(E.stat("bytesReceived"),10));else if("video"===E.stat("mediaType"))for(s.videoReceived={timestamp:Math.floor(Date.parse(E.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"video",framesDecoded:0,packetsReceived:0,bytesReceived:0},te=E.names(),g=0;g<te.length;g+=1)"framesDecoded"===(ae=te[g])?s.videoReceived.framesDecoded=parseInt(E.stat("framesDecoded"),10):"packetsReceived"===ae?s.videoReceived.packetsReceived=parseInt(E.stat("packetsReceived"),10):"bytesReceived"===ae&&(s.videoReceived.bytesReceived=parseInt(E.stat("bytesReceived"),10))}else if(E.id.indexOf("send")>=0)if("audio"===E.stat("mediaType"))for(s.audioSent={timestamp:Math.floor(Date.parse(E.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"audio",packetsSent:0,bytesSent:0},te=E.names(),g=0;g<te.length;g+=1)"packetsSent"===(ae=te[g])?s.audioSent.packetsSent=parseInt(E.stat("packetsSent"),10):"bytesSent"===ae&&(s.audioSent.bytesSent=parseInt(E.stat("bytesSent"),10));else if("video"===E.stat("mediaType"))for(s.videoSent={timestamp:Math.floor(Date.parse(E.timestamp))/1e3,type:"outbound-rtp",isRemote:!1,mediaType:"video",framesEncoded:0,packetsSent:0,bytesSent:0},te=E.names(),g=0;g<te.length;g+=1)"framesEncoded"===(ae=te[g])?s.videoSent.framesEncoded=parseInt(E.stat("framesEncoded"),10):"packetsSent"===ae?s.videoSent.packetsSent=parseInt(E.stat("packetsSent"),10):"bytesSent"===ae&&(s.videoSent.bytesSent=parseInt(E.stat("bytesSent"),10))}return!1},this.refineStats_chrome_legacy=function(s,v){var r=!1;return v.forEach(function(g){var E=null,te=null;if("ssrc"===g.type&&g.id.indexOf("recv")>=0){if("audio"===g.mediaType){for(te in s.audioReceived={},E=Math.floor(Date.parse(g.timestamp)/1e3),g)"timestamp"===te?s.audioReceived.timestamp=E:s.audioReceived[te]=g[te];r=!0}else if("video"===g.mediaType){for(te in s.videoReceived={},E=Math.floor(Date.parse(g.timestamp)/1e3),g)"timestamp"===te?s.videoReceived.timestamp=E:s.videoReceived[te]=g[te];r=!0}}else if("ssrc"===g.type&&g.id.indexOf("send")>=0)if("audio"===g.mediaType){for(te in s.audioSent={},E=Math.floor(Date.parse(g.timestamp)/1e3),g)"timestamp"===te?s.audioSent.timestamp=E:s.audioSent[te]=g[te];r=!0}else if("video"===g.mediaType){for(te in s.videoSent={},E=Math.floor(Date.parse(g.timestamp)/1e3),g)"timestamp"===te?s.videoSent.timestamp=E:s.videoSent[te]=g[te];r=!0}}),r},this.refineStats_chrome_58=function(s,v){var r=this,g=!1;return v.forEach(function(E){if("inbound-rtp"!==E.type||E.isRemote){if("outbound-rtp"===E.type&&!E.isRemote)if("audio"===E.mediaType){s.audioSent={};var te=Math.floor(E.timestamp/1e3);for(var ae in E)!1!==r.STANDARD_STAT_KEYS.audioSent[ae]&&("timestamp"===ae?s.audioSent.timestamp=te:s.audioSent[ae]=E[ae]);g=!0}else if("video"===E.mediaType){s.videoSent={};var Re=Math.floor(E.timestamp/1e3);for(var Ce in E)!1!==r.STANDARD_STAT_KEYS.videoSent[Ce]&&("timestamp"===Ce?s.videoSent.timestamp=Re:s.videoSent[Ce]=E[Ce]);g=!0}}else if("audio"===E.mediaType||E.id.indexOf("Audio")>=0){s.audioReceived={};var re=Math.floor(E.timestamp/1e3);for(var K in E)!1!==r.STANDARD_STAT_KEYS.audioReceived[K]&&("timestamp"===K?s.audioReceived.timestamp=re:s.audioReceived[K]=E[K]);g=!0}else if("video"===E.mediaType||E.id.indexOf("Video")>=0){s.videoReceived={};var L=Math.floor(E.timestamp/1e3);for(var ne in E)!1!==r.STANDARD_STAT_KEYS.videoReceived[ne]&&("timestamp"===ne?s.videoReceived.timestamp=L:s.videoReceived[ne]=E[ne]);g=!0}}),g},this.refineStats_firefox_legacy=function(s,v){var r=!1,g=this;return v.forEach(function(E){var te=null,ae=null;if("inbound-rtp"===E.type&&!1===E.isRemote){if("audio"===E.mediaType){for(te in s.audioReceived={packetsReceived:0,bytesReceived:0},ae=Math.floor(E.timestamp/1e3),E)!1!==g.STANDARD_STAT_KEYS.audioReceived[te]&&("timestamp"===te?s.audioReceived.timestamp=ae:s.audioReceived[te]=E[te]);r=!0}else if("video"===E.mediaType){for(te in s.videoReceived={packetsReceived:0,bytesReceived:0,framesDecoded:0},ae=Math.floor(E.timestamp/1e3),E)!1!==g.STANDARD_STAT_KEYS.videoReceived[te]&&("timestamp"===te?s.videoReceived.timestamp=ae:s.videoReceived[te]=E[te]);r=!0}}else if("outbound-rtp"===E.type&&!1===E.isRemote)if("audio"===E.mediaType){for(te in s.audioSent={packetsSent:0,bytesSent:0},ae=Math.floor(E.timestamp/1e3),E)!1!==g.STANDARD_STAT_KEYS.audioSent[te]&&("timestamp"===te?s.audioSent.timestamp=ae:s.audioSent[te]=E[te]);r=!0}else if("video"===E.mediaType){for(te in s.videoSent={packetsSent:0,bytesSent:0,framesEncoded:0},ae=Math.floor(E.timestamp/1e3),E)!1!==g.STANDARD_STAT_KEYS.videoSent[te]&&("timestamp"===te?s.videoSent.timestamp=ae:s.videoSent[te]=E[te]);r=!0}}),r},this.refineStats_firefox_63=function(s,v){var r=!1,g=this;return v.forEach(function(E){if("inbound-rtp"!==E.type||E.isRemote){if("outbound-rtp"===E.type&&!E.isRemote)if("audio"===E.kind){s.audioSent={packetsSent:0,bytesSent:0};var te=Math.floor(E.timestamp/1e3);for(var ae in E)!1!==g.STANDARD_STAT_KEYS.audioSent[ae]&&("timestamp"===ae?s.audioSent.timestamp=te:s.audioSent[ae]=E[ae]);r=!0}else if("video"===E.kind){s.videoSent={packetsSent:0,bytesSent:0,framesEncoded:0};var Re=Math.floor(E.timestamp/1e3);for(var Ce in E)!1!==g.STANDARD_STAT_KEYS.videoSent[Ce]&&("timestamp"===Ce?s.videoSent.timestamp=Re:s.videoSent[Ce]=E[Ce]);r=!0}}else if("audio"===E.kind){s.audioReceived={packetsReceived:0,bytesReceived:0};var re=Math.floor(E.timestamp/1e3);for(var K in E)!1!==g.STANDARD_STAT_KEYS.audioReceived[K]&&("timestamp"===K?s.audioReceived.timestamp=re:s.audioReceived[K]=E[K]);r=!0}else if("video"===E.kind){s.videoReceived={packetsReceived:0,bytesReceived:0,framesDecoded:0};var L=Math.floor(E.timestamp/1e3);for(var ne in E)!1!==g.STANDARD_STAT_KEYS.videoReceived[ne]&&("timestamp"===ne?s.videoReceived.timestamp=L:s.videoReceived[ne]=E[ne]);r=!0}}),r},this.addCallStats=function(s){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};if(void 0!==this.refineStats){if(this.refineStats(r,s),void 0!==r.audioReceived){if(void 0!==this.prevData.audioReceived){var g=r.audioReceived.timestamp-this.prevData.audioReceived[0].timestamp;g>0?(void 0===r.audioReceived.packetsReceivedPerSecond&&(r.audioReceived.packetsReceivedPerSecond=Math.floor((r.audioReceived.packetsReceived-this.prevData.audioReceived[0].packetsReceived)/g)),void 0===r.audioReceived.bitsReceivedPerSecond&&(r.audioReceived.bitsReceivedPerSecond=Math.floor(8*(r.audioReceived.bytesReceived-this.prevData.audioReceived[0].bytesReceived)/g)),void 0===r.audioReceived.packetsLostPerSecond&&(r.audioReceived.packetsLostPerSecond=Math.floor((r.audioReceived.packetsLost-this.prevData.audioReceived[0].packetsLost)/g)),void 0===r.audioReceived.packetLossRatio&&(r.audioReceived.packetLossRatio=100*(r.audioReceived.packetsLost-this.prevData.audioReceived[0].packetsLost)/(r.audioReceived.packetsReceived-this.prevData.audioReceived[0].packetsReceived)),r.audioReceived.samplingInterval=g):(void 0===r.audioReceived.packetsReceivedPerSecond&&(r.audioReceived.packetsReceivedPerSecond=0),void 0===r.audioReceived.bitsReceivedPerSecond&&(r.audioReceived.bitsReceivedPerSecond=0),void 0===r.audioReceived.packetsLostPerSecond&&(r.audioReceived.packetsLostPerSecond=0),void 0===r.audioReceived.packetLossRatio&&(r.audioReceived.packetLossRatio=0),r.audioReceived.samplingInterval=0)}else void 0===r.audioReceived.packetsReceivedPerSecond&&(r.audioReceived.packetsReceivedPerSecond=0),void 0===r.audioReceived.bitsReceivedPerSecond&&(r.audioReceived.bitsReceivedPerSecond=0),void 0===r.audioReceived.packetsLostPerSecond&&(r.audioReceived.packetsLostPerSecond=0),void 0===r.audioReceived.packetLossRatio&&(r.audioReceived.packetLossRatio=0),r.audioReceived.samplingInterval=0,this.prevData.audioReceived=[];for(this.prevData.audioReceived.push(r.audioReceived);this.prevData.audioReceived.length>this.prevDataThreshold;)this.prevData.audioReceived.shift()}if(void 0!==r.videoReceived){if(void 0!==this.prevData.videoReceived){var E=r.videoReceived.timestamp-this.prevData.videoReceived[0].timestamp;E>0?(void 0===r.videoReceived.packetsReceivedPerSecond&&(r.videoReceived.packetsReceivedPerSecond=Math.floor((r.videoReceived.packetsReceived-this.prevData.videoReceived[0].packetsReceived)/E)),void 0===r.videoReceived.bitsReceivedPerSecond&&(r.videoReceived.bitsReceivedPerSecond=Math.floor(8*(r.videoReceived.bytesReceived-this.prevData.videoReceived[0].bytesReceived)/E)),void 0===r.videoReceived.packetsLostPerSecond&&(r.videoReceived.packetsLostPerSecond=Math.floor((r.videoReceived.packetsLost-this.prevData.videoReceived[0].packetsLost)/E)),void 0===r.videoReceived.framesDecodedPerSecond&&(r.videoReceived.framesDecodedPerSecond=Math.floor((r.videoReceived.framesDecoded-this.prevData.videoReceived[0].framesDecoded)/E)),void 0===r.videoReceived.packetLossRatio&&(r.videoReceived.packetLossRatio=100*(r.videoReceived.packetsLost-this.prevData.videoReceived[0].packetsLost)/(r.videoReceived.packetsReceived-this.prevData.videoReceived[0].packetsReceived)),r.videoReceived.samplingInterval=E):(void 0===r.videoReceived.packetsReceivedPerSecond&&(r.videoReceived.packetsReceivedPerSecond=0),void 0===r.videoReceived.bitsReceivedPerSecond&&(r.videoReceived.bitsReceivedPerSecond=0),void 0===r.videoReceived.packetsLostPerSecond&&(r.videoReceived.packetsLostPerSecond=0),void 0===r.videoReceived.framesDecodedPerSecond&&(r.videoReceived.framesDecodedPerSecond=0),void 0===r.videoReceived.packetLossRatio&&(r.videoReceived.packetLossRatio=0),r.videoReceived.samplingInterval=0)}else void 0===r.videoReceived.packetsReceivedPerSecond&&(r.videoReceived.packetsReceivedPerSecond=0),void 0===r.videoReceived.bitsReceivedPerSecond&&(r.videoReceived.bitsReceivedPerSecond=0),void 0===r.videoReceived.packetsLostPerSecond&&(r.videoReceived.packetsLostPerSecond=0),void 0===r.videoReceived.framesDecodedPerSecond&&(r.videoReceived.framesDecodedPerSecond=0),void 0===r.videoReceived.packetLossRatio&&(r.videoReceived.packetLossRatio=0),r.videoReceived.samplingInterval=0,this.prevData.videoReceived=[];for(this.prevData.videoReceived.push(r.videoReceived);this.prevData.videoReceived.length>this.prevDataThreshold;)this.prevData.videoReceived.shift()}if(void 0!==r.audioSent){if(void 0!==this.prevData.audioSent){var te=r.audioSent.timestamp-this.prevData.audioSent[0].timestamp;te>0?(void 0===r.audioSent.packetsSentPerSecond&&(r.audioSent.packetsSentPerSecond=Math.floor((r.audioSent.packetsSent-this.prevData.audioSent[0].packetsSent)/te)),void 0===r.audioSent.bitsSentPerSecond&&(r.audioSent.bitsSentPerSecond=Math.floor(8*(r.audioSent.bytesSent-this.prevData.audioSent[0].bytesSent)/te)),r.audioSent.samplingInterval=te):(void 0===r.audioSent.packetsSentPerSecond&&(r.audioSent.packetsSentPerSecond=0),void 0===r.audioSent.bitsSentPerSecond&&(r.audioSent.bitsSentPerSecond=0),r.audioSent.samplingInterval=0)}else void 0===r.audioSent.packetsSentPerSecond&&(r.audioSent.packetsSentPerSecond=0),void 0===r.audioSent.bitsSentPerSecond&&(r.audioSent.bitsSentPerSecond=0),r.audioSent.samplingInterval=0,this.prevData.audioSent=[];for(this.prevData.audioSent.push(r.audioSent);this.prevData.audioSent.length>this.prevDataThreshold;)this.prevData.audioSent.shift()}if(void 0!==r.videoSent){if(void 0!==this.prevData.videoSent){var ae=r.videoSent.timestamp-this.prevData.videoSent[0].timestamp;ae>0?(void 0===r.videoSent.packetsSentPerSecond&&(r.videoSent.packetsSentPerSecond=Math.floor((r.videoSent.packetsSent-this.prevData.videoSent[0].packetsSent)/ae)),void 0===r.videoSent.bitsSentPerSecond&&(r.videoSent.bitsSentPerSecond=Math.floor(8*(r.videoSent.bytesSent-this.prevData.videoSent[0].bytesSent)/ae)),void 0===r.videoSent.framesEncodedPerSecond&&(r.videoSent.framesEncodedPerSecond=Math.floor((r.videoSent.framesEncoded-this.prevData.videoSent[0].framesEncoded)/ae)),r.videoSent.samplingInterval=ae):(void 0===r.videoSent.packetsSentPerSecond&&(r.videoSent.packetsSentPerSecond=0),void 0===r.videoSent.bitsSentPerSecond&&(r.videoSent.bitsSentPerSecond=0),void 0===r.videoSent.framesEncodedPerSecond&&(r.videoSent.framesEncodedPerSecond=0),r.videoSent.samplingInterval=0)}else void 0===r.videoSent.packetsSentPerSecond&&(r.videoSent.packetsSentPerSecond=0),void 0===r.videoSent.bitsSentPerSecond&&(r.videoSent.bitsSentPerSecond=0),void 0===r.videoSent.framesEncodedPerSecond&&(r.videoSent.framesEncodedPerSecond=0),r.videoSent.samplingInterval=0,this.prevData.videoSent=[];for(this.prevData.videoSent.push(r.videoSent);this.prevData.videoSent.length>this.prevDataThreshold;)this.prevData.videoSent.shift()}}return Object.keys(r).length>0&&"function"==typeof v.post&&v.post(r),r},"chrome"===this.browserType?this.refineStats="proprietary"===l?this.refineStats_chrome_proprietary:this.browserVersion>=58?this.refineStats_chrome_58:this.refineStats_chrome_legacy:"firefox"===this.browserType?this.refineStats=this.browserVersion>=63?this.refineStats_firefox_63:this.refineStats_firefox_legacy:"safari"===this.browserType&&(this.refineStats=this.refineStats_chrome_58)}),j=(e(658),function(){this.NarrowBandSpeechQuality=function(G,A){var t,l,s=1,g=(94.769-(t=80+2.5*(65-40*Math.log10((1+G/10)/(1+G/150))+6*Math.exp(G*G*-.3)-14)))*(94.769-t)/4+100;return(l=93.193-((94.769-t)/2+Math.sqrt(g)-1)*(1-Math.exp(-G))-(0+A/(A+4.3)*95))<0&&(s=1),l<100&l>0&&(s=1+.035*l+l*(l-60)*(100-l)*7*1e-6),l>100&&(s=4.5),s},this.WideBandspeechQuality=function(G,A){var t,l,s,v=0,r=1;G<100&&(v=.08-G+10),G>=100&&(v=18);var te=(129-(t=80+3*(65+v-40*Math.log10((1+G/10)/(1+G/150))+6*Math.exp(G*G*-.3)-14)))*(129-t)/4+100;return(s=(l=129-((129-t)/2+Math.sqrt(te)-1)*(1-Math.exp(-G))-(0+A/(A+4.3)*95))/1.29)<=0&&(r=1),s<100&s>0&&(r=1+.035*l+l*(l-60)*(100-l)*7*1e-6),s>=100&&(r=4.5),r},this.videoQuality=function(G,A,t,l,s){var v,r,g,E,te,ae,Re,Ce,re;return re=A>720?[0,2.77,.009,3.95,460,1.28,2.12,32e-5,1.28,262,1.98,22.84,7.999]:A>576?[0,6.31,.008,3.68,262,1.28,1.97,33e-5,1.24,343,2.76,6.25,6.013]:A>480?[0,6.96,.007,3.58,214,1.2,1.75,63e-5,1.13,171,4.25,7.98,12.001]:A>288?[0,5.61,.01,3.38,182,1.31,2.23,75e-5,1.51,136,4.05,20.16,22.332]:[0,3.988,.013,3.625,89.25,1.125,.713,0,1.542,245.5,3.011,39.31,16.67],ae=1+Math.pow(l/re[4],re[5]),v=re[3]-re[3]/ae,r=re[1]+re[2]*l,g=re[6]+re[7]*l,Re=Math.pow(Math.log(s)-Math.log(r),2),Ce=2*Math.pow(g,2),E=v*Math.exp(-Re/Ce),te=re[10]+re[11]*Math.exp(-s/re[8])+re[12]*Math.exp(-l/re[9]),1+E*Math.exp(-t/te)},this.audiovisualQuality=function(G,A,t,l){var s,v,r,g,E;return G>0&&A>0?(s=(E=[0,-.6966,-.8127,.4562,3.003,-.1638,.3626,.1291,.5457,-1251e-7,3.763,-.001065,.01465,-.001002,0])[9]*(t+l)+E[10],t>=l&&(v=Math.min(E[11]*(t-l)+E[12],0)),t<l&&(v=Math.min(E[13]*(l-t)+E[14],0)),r=Math.max(s+v,1),E[1]*(g=E[5]*G+E[6]*A+E[7]*G*A+E[8])+E[2]*r+E[3]*g*r+E[4]):"NoAudiovisualStream"}});function q(G,A){var t="undefined"!=typeof Symbol&&G[Symbol.iterator]||G["@@iterator"];if(!t){if(Array.isArray(G)||(t=function(E,te){if(E){if("string"==typeof E)return b(E,void 0);var ae=Object.prototype.toString.call(E).slice(8,-1);return"Object"===ae&&E.constructor&&(ae=E.constructor.name),"Map"===ae||"Set"===ae?Array.from(E):"Arguments"===ae||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ae)?b(E,void 0):void 0}}(G))||A&&G&&"number"==typeof G.length){t&&(G=t);var l=0,s=function(){};return{s,n:function(){return l>=G.length?{done:!0}:{done:!1,value:G[l++]}},e:function(E){throw E},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var v,r=!0,g=!1;return{s:function(){t=t.call(G)},n:function(){var E=t.next();return r=E.done,E},e:function(E){g=!0,v=E},f:function(){try{r||null==t.return||t.return()}finally{if(g)throw v}}}}function b(G,A){(null==A||A>G.length)&&(A=G.length);for(var t=0,l=new Array(A);t<A;t++)l[t]=G[t];return l}var T=i.Y.get("WebRTC_Call"),Z=apiCC.myWebRTC_Event,le=function(G){this.dest_roomId="",this.pc=null,this.callId=0,this.callee=!1,this.callerId=0,this.calleeId=0,this.started=!1,this.localDescriptionSetted=!1,this.remoteDescriptionSetted=!1,this.sendedSdpOfferMessage=null,this.receivedSdpOfferMessage=null,this.myWebRTC_Stack=new P.S(G.socket),this.remoteMediaStreams=[],this.rtpSenders={audio:[],video:[]},this.addingUserMedia=!1,this.myWebRTC_Event=apiCC.myWebRTC_Event,this.dtmfSender=null,this.incomingcandidatesQueue=[],"Firefox"===d.Xh?d.PR>43?(this.mediaConstraintsAudioOnly={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):(this.mediaConstraintsAudioOnly={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!1}},this.mediaConstraints={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0}}):"Chrome"===d.Xh?d.PR<55?(this.mediaConstraintsAudioOnly={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}):(this.mediaConstraintsAudioOnly={offerToReceiveAudio:1,offerToReceiveVideo:1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):"Edge"===d.Xh?(this.mediaConstraintsAudioOnly={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}):(this.mediaConstraintsAudioOnly={offerToReceiveAudio:1,offerToReceiveVideo:1},this.mediaConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1}),"iOS"===d.ag.name&&(T.log("Defining mediaConstraints for iOS "),this.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0}),this.trickleIce=G.trickleIce,this.callLocalStream=null,this.generatedLocalStream=!1,this.audioOnly=!1,this.inviteSended=!1,this.sendInviteTrickleIceFalseTimeOutId=0,this.sendInviteTrickleIceFalseTimer=5e3,this.message200OKSended=!1,this.send200OKTrickleIceFalseTimeOutId=0,this.send200OKTrickleIceFalseTimer=5e3,this.message200OKReceived=!1,this.callCancelled=!1,this.screenSharing=!1,this.desktopId=0,this.pc_config=G.pc_config,this.pc_constraints=G.pc_constraints,this.audioFileMediaElement=null,this.videoReceivedWidth=640,this.videoReceivedHeight=480,this.videoSendWidth=640,this.videoSendHeight=480,this.videoReceivedDelay=0,this.audioReceivedDelay=0,this.audioSendDelay=0,this.videoSendDelay=0,this.videoSendPacketLossRatio=0,this.audioSendPacketLossRatio=0,this.getStatsInterval=G.qosInterval,this.qm=null,this.statisticId=null,this.csmIntervalMs=G.csmIntervalMs,this.csmIntervalId=null,this.remoteId=0,this.callType="media",this.localCallProfile={audio:!1,audioActive:!1,video:!1,videoActive:!1},this.remoteCallProfile={audio:!1,audioActive:!1,video:!1,videoActive:!1},this.disconnectionTimeoutId=0,this.disconnectionTimer=4e4,this.disconnectionWarningDelay=9e3,this.disconnectionWarningInterval=0,this.disconnectionWarningTimeout=0,this.disconnectionWarningCount=0,this.checkCandidateTypesTimer=1e4,this.checkCandidateTypesTimeoutId=0,this.checkCandidateTypesTimeoutTable=[],this.data={},this.screenStream=null,this.screenIsDisplayed=!1,this.addingDataChannelOnCallOngoing=!1,this.sendDataChannel=null,this.receiveDataChannel=null,this.receiveChunkNb={},this.firstDataPacket={},this.receivedSize={},this.receiveArrayToStoreChunks={},this.destCallType="media",this.mcuRemoteStream=null,this.userMediaAccessRequired=!0,this.settingUpMode="normal",this.remoteType="web",this.mediaTypeForIncomingCall=G.mediaTypeForIncomingCall,this.mediaTypeForOutgoingCall=G.mediaTypeForOutgoingCall,this.mediaRoutingMode=G.mediaRoutingMode,this.stripAudioSDPActivated=!1,this.stripVideoSDPActivated=!1,this.iceState="notdefined",this.restarted=!1,this.audioSdpDirection=null,this.videoSdpDirection=null,this.isLocalAudioMuted=!1,this.isLocalVideoMuted=!1,this.isRemoteAudioMuted=!1,this.isRemoteVideoMuted=!1,this.isRemoteAudioSilent=!1,this.isRemoteVideoSilent=!1,this.isAccepted=!1,this.accessToMedia=!1,this.callConfiguration=null,this.captureSourceType=null,this.preferH264Codec=!1,this.preferVP8Codec=!1,this.preferVP9Codec=!1,this.candidateNb=0,this.sessionMCU=null,this.instanceId=0,this.retryUpdateMedia=!1,this.updateMediaOngoing=!1,this.setCallTurnServer=function(A){T.info("setCallTurnServer :",A);var t=JSON.stringify(this.pc_config);t=t.replace(/mp1.apizee.com/g,A),this.pc_config=JSON.parse(t)},this.setCallMediaRoutingMode=function(A){T.info("setCallMediaRoutingMode :",A),"hostOnly"===A?this.mediaRoutingMode=G.mediaRoutingModeEnum.hostOnly:"stun"===A?this.mediaRoutingMode=G.mediaRoutingModeEnum.stun:"stunOnly"===A?this.mediaRoutingMode=G.mediaRoutingModeEnum.stunOnly:"turn"===A?this.mediaRoutingMode=G.mediaRoutingModeEnum.turn:"turnOnly"===A?this.mediaRoutingMode=G.mediaRoutingModeEnum.turnOnly:(T.log("parameter error when calling function : setCallMediaRoutingMode()"),this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setCallMediaRoutingMode()","PARAMETER_ERROR_SETCALLMEDIAROUTINGMODE"))},this.checkDTLSCompliancy=function(){if(T.debug("checkDTLSCompliancy"),!1===apiCC.session.isDeviceDTLSCompliant())T.log("Device not DTLS compliant, setting DtlsSrtpKeyAgreement: false"),this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!1}]};else{var A=apiCC.session.isClientDTLSCompliant(this.remoteId);!1!==A&&"false"!==A||(T.log("Remote Device not DTLS compliant, setting DtlsSrtpKeyAgreement: false"),this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!1}]})}},this.sendData=function(A,t){T.info("datachannel - sendData");var l=null,s=null;if(A.file instanceof File)return T.log("File"),this.contentType=A.file.type,this.originalDataType="File",l=new FileReader,s=this,l.onload=function(v){s.sendData({file:v.target.result||l.result,name:A.name,type:A.type},t)},void l.readAsArrayBuffer(A.file);new I(this).send(A,this.sendDataChannel,t)},T.log("New Call for client with Id :"+G.clientId),this.generateCallId=function(){this.callId=apiCC.generateCallId(),T.info("new call with callId :"+this.callId)},this.sendInviteTrickleIceFalse=function(){T.log("sendInviteTrickleIceFalse"),T.log("sendInvite on candidate timer reached"),this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,G.nickname,this.dest_roomId,this.dest_roomId,this.callType,{offer:this.pc.localDescription,data:this.data,stream:this.mcuRemoteStream,volatile:!!this.restarted}),this.inviteSended=!0},this.send200OkTrickleIceFalse=function(){T.log("send200OkTrickleIceFalse"),this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,G.nickname,this.dest_roomId,this.pc.localDescription,this.data),this.message200OKSended=!0},this.onSetLocalDescriptionSuccess=function(){T.info("onSetLocalDescriptionSuccess"),this.localDescriptionSetted=!0,this.asyncCallbacks&&"subscribe"===this.asyncCallbacks.type&&delete this.asyncCallbacks,!1===this.trickleIce&&(!0===this.callee?(T.info("starting send200OKTrickleIceFalseTimeOutId"),this.send200OKTrickleIceFalseTimeOutId=setTimeout(this.callback(this,"send200OkTrickleIceFalse"),this.send200OKTrickleIceFalseTimer)):(T.info("starting sendInviteTrickleIceFalseTimeOutId"),this.sendInviteTrickleIceFalseTimeOutId=setTimeout(this.callback(this,"sendInviteTrickleIceFalse"),this.sendInviteTrickleIceFalseTimer))),G.rtpSenderSetParamatersCapable&&G.evaluateVideoCap(this)},this.onSetLocalDescriptionFailure=function(A){T.warn("onSetLocalDescriptionFailure",A);var t=null,l=null;this.callControl&&(t=this.callControl.roomName,l=this.callControl.type),Z.createErrorEvent("Set local Description Failure","SET_LOCAL_DESCRIPTION_FAILURE",this.callId,t,l),G.onHangup(this.callId,"Local_Description_Failure")},this.onSetRemoteDescriptionSuccess=function(){T.info("onSetRemoteDescriptionSuccess");var A=null;for(this.remoteDescriptionSetted=!0,!0===this.restarting&&delete this.restarting,this.data&&(this.data.mesh||this.data.subscribeOrder)||Z.createCallEstablishedEvent(this.calleeId,this.callType,this.callId,this.destCallType);this.incomingcandidatesQueue.length;)A=this.incomingcandidatesQueue.shift(),this.processCandidateMsg(A);if(void 0!==G.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId]){for(T.debug("Restoring candidate from client, this.callId :"+this.callId+" , instanceId :"+this.instanceId);G.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId].length;)A=G.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId].shift(),this.processCandidateMsg(A);delete G.clientIncomingCandidatesQueue[this.callId+"-"+this.instanceId]}if(this.asyncCallbacks&&("addingUserMedia"===this.asyncCallbacks.type?(this.asyncCallbacks.resolve(this.callConfiguration.userMediaStreamId),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks):"updateCallConfiguration"===this.asyncCallbacks.type&&(this.asyncCallbacks.resolve(),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks)),this.updateMediaOngoing=!1,!0===this.retryUpdateMedia){T.debug("an updateMedia was waiting for sig stable state or an other updateMedia end, updating Media now ..."),this.retryUpdateMedia=!1;var t=this.updateMedia(!1);T.debug("Retried updateMediaResult :",t)}},this.processCandidateMsg=function(A){T.info("processCandidateMsg :",A);var t=null;null!==this.pc?(void 0!==A.completeCandidate?(T.trace("new behavior of 2.13.8"),t=new apiCC.myWebRTC_Adapter.RTCIceCandidate(A.completeCandidate)):(T.log("old behavior < 2.13.8"),t=new apiCC.myWebRTC_Adapter.RTCIceCandidate({sdpMLineIndex:A.label,candidate:A.candidate})),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("addIceCandidate"),this.pc.addIceCandidate(t,function(){T.trace("addIceCandidate success")},function(l){T.warn("addIceCandidate failure: "+l),l=null})):(T.log("addIceCandidate - Promise version"),this.pc.addIceCandidate(t).then(function(){T.trace("addIceCandidate success")}).catch(function(l){T.warn("addIceCandidate failure: "+l),l=null}))):T.error("Error, call is not null but pc is null")},this.onSetRemoteDescriptionFailure=function(A){T.warn("onSetRemoteDescriptionFailure :",A);var t=null,l=null;this.callControl&&(t=this.callControl.roomName,l=this.callControl.type),Z.createErrorEvent("Set remote Description Failure","SET_REMOTE_DESCRIPTION_FAILURE",this.callId,t,l),G.onHangup(this.callId,"Remote_Description_Failure")},this.getUserMediaOnCall=function(){var A=this,t=!1;if(T.info("getUserMediaOnCall, audio Only :"+this.audioOnly),T.info("getUserMediaOnCall, screenSharing activated :"+this.screenSharing),T.log("webRTCClient.gum_config :",G.gum_config),this.callerId===G.clientId){if(T.log("outgoing call"),"VIDEO"===this.mediaTypeForOutgoingCall||"VIDEOONLY"===this.mediaTypeForOutgoingCall)if(T.log("mediaTypeForOutgoingCall :"+this.mediaTypeForOutgoingCall),"VIDEOONLY"===this.mediaTypeForOutgoingCall&&(t=!0),!0!==this.screenSharing){if(!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return T.log("getUserMediaOnCall without any device, calling without device"),void this.onUserMediaSuccessOnCall();T.log("video is not present :"+this.callType),"media"===this.callType&&(T.log("callType is media, but no webcam present, forcing callType to audio"),this.callType="audio",this.audioOnly=!0)}}else T.log("screenSharing, no device checking");else if("AUDIO"===this.mediaTypeForOutgoingCall)T.log("mediaTypeForOutgoingCall is AUDIO, setting call to audioOnly"),this.callType="audio",this.audioOnly=!0;else if("NONE"===this.mediaTypeForOutgoingCall||"DATA"===this.mediaTypeForOutgoingCall)return T.log("mediaTypeForOutgoingCall is NONE, call will be recvOnly"),void this.onUserMediaSuccessOnCall()}else if(T.log("incoming call"),"VIDEO"===this.mediaTypeForIncomingCall||"VIDEOONLY"===this.mediaTypeForIncomingCall){if(T.log("mediaTypeForIncomingCall :"+this.mediaTypeForIncomingCall),"VIDEOONLY"===this.mediaTypeForIncomingCall&&(t=!0),!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return T.log("getUserMediaOnCall without any device, calling without device"),void this.onUserMediaSuccessOnCall();T.log("video is not present :"+this.callType),"media"===this.callType&&(T.log("callType is media, but no webcam present, forcing callType to audio"),this.callType="audio",this.audioOnly=!0)}}else if("AUDIO"===this.mediaTypeForIncomingCall)T.log("mediaTypeForIncomingCall is AUDIO, setting call to audioOnly"),this.callType="audio",this.audioOnly=!0;else if("NONE"===this.mediaTypeForIncomingCall||"DATA"===this.mediaTypeForIncomingCall)return T.log("mediaTypeForIncomingCall is NONE, call will be recvOnly"),void this.onUserMediaSuccessOnCall();G.getUserMediaOnGoing=!0;var l=null,s=null;if(T.log("this.screenSharing :"+this.screenSharing),T.log("this.audioOnly :"+this.audioOnly),!0===this.screenSharing)if(T.log("getScreenMedia"),"Chrome"===d.Xh)T.log("this.desktopId :"+this.desktopId),l={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.desktopId}}};else{if(T.log("this.captureSourceType :"+this.captureSourceType),"screen"!==this.captureSourceType&&"window"!==this.captureSourceType&&"application"!==this.captureSourceType)return void T.error("captureSourceType value is not correct");l={video:{mediaSource:this.captureSourceType}}}else!0===this.audioOnly?(T.log("this.audioOnly = true"),G.gum_config=apiCC.setAudioSourceIdInConstraint(G.audioSourceId,G.gum_config),s=JSON.parse(JSON.stringify(G.gum_config)),!1===G.allowAsymetricMediaCalls?s.video=!1:T.log("allow AsymetricMediaCalls is activated"),l=s):(T.log("audio and video call"),l=(0,h.ws)({},G.gum_config),t?l.audio=!1:l=apiCC.setAudioSourceIdInConstraint(G.audioSourceId,l),l=apiCC.setVideoSourceIdInConstraint(G.videoSourceId,l),l=apiCC.setVideoFacingModeInConstraint(G.facingMode,l),"undefined"!=typeof apiRTC_React&&(l={audio:!0,video:{mandatory:{minWidth:500,minHeight:300,minFrameRate:30},facingMode:"user"}}));apiCC.createUserMediaStream({callId:this.callId,type:this.callType,gum_config:l,success:function(v){T.debug("[getUserMediaOnCall] success; userMediaStreamId: "+v.userMediaStreamId),null!=A.callConfiguration||(A.callConfiguration={}),A.callConfiguration.userMediaStreamId=v.userMediaStreamId,A.onUserMediaSuccessOnCall(v.stream)},failure:function(v,r){T.debug("[getUserMediaOnCall] failure; userMediaStreamId: "+v.userMediaStreamId),A.onUserMediaErrorOnCall(r)}})},this.handleToneChangeEvent=function(A){T.debug("handleToneChangeEvent :",A.tone),T.debug(""!==A.tone?"Tone played: "+A.tone:"All tones have played.")},this.sendTones=function(A,t,l){T.debug("sendTones :"),this.dtmfSender&&(T.debug("sendTones : Tones, duration, gap: ",A,t,l),this.dtmfSender.insertDTMF(A,t,l))},this.addStream=function(A){var t,l=null,s=null,v=0,r=!1,g=null,E=[];if("undefined"!=typeof apiRTC_React||"Firefox"===d.Xh&&d.PR<51||"Chrome"===d.Xh&&d.PR<65||"Safari"===d.Xh&&d.dc<12.1||"Mobile Safari"===d.Xh&&d.dc<12.1||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)T.info("using addStream method"),this.pc.addStream(A),T.debug("end addStream method");else{if(!("Firefox"===d.Xh&&d.PR<59||"Edge"===d.Xh)){for(T.info("using addTrack/replaceTrack method"),l=A.getTracks(),t=0;t<l.length;t+=1){for(r=!1,s=this.rtpSenders[l[t].kind],v=0;v<s.length;v+=1)if(null===s[v].track){r=!0;break}if(!0===r)E.push(s[v].replaceTrack(l[t])),T.debug("addStream -> replaceTrack",s[v]);else{if("RID"===this.simulcast&&"video"===l[t].kind&&"chrome"===h.wL.type){var te=[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}];this.callControl.callConfiguration.simulcast&&this.callControl.callConfiguration.simulcast.sendEncodings&&(te=this.callControl.callConfiguration.simulcast.sendEncodings.slice()),g=this.pc.addTransceiver(l[t],{direction:"sendonly",streams:[A],sendEncodings:te}).sender}else if(g=this.pc.addTrack(l[t],A),"RID"===this.simulcast&&"video"===l[t].kind&&"firefox"===h.wL.type){var ae=g.getParameters();ae||(ae={}),ae.encodings=this.callControl.callConfiguration.simulcast&&this.callControl.callConfiguration.simulcast.sendEncodings?this.callControl.callConfiguration.simulcast.sendEncodings.slice():[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}],E.push(g.setParameters(ae))}T.debug("addStream -> addTrack",g),this.rtpSenders[l[t].kind].push(g)}}return T.debug("end addTrack/replaceTrack method"),this.rtpSenders.audio.length>0&&(this.dtmfSender=this.rtpSenders.audio[0].dtmf,this.dtmfSender&&(this.dtmfSender.ontonechange=this.handleToneChangeEvent)),new Promise(function(Re,Ce){Promise.all(E).then(function(re){Re()}).catch(Ce)})}for(T.info("using addTrack method"),l=A.getTracks(),t=0;t<l.length;t+=1)this.pc.addTrack(l[t],A);T.debug("end addTrack method")}return Promise.resolve()},this.removeStream=function(A){var t,l=null,s=[];if(T.info("removeStream in call",A.id),"Firefox"===d.Xh&&d.PR<51||"Chrome"===d.Xh&&d.PR<65||"Safari"===d.Xh&&d.dc<12.1||"Mobile Safari"===d.Xh&&d.dc<12.1||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc)T.info("using removeStream method"),this.pc.removeStream(A),T.debug("end removeStream method");else{if(!("Firefox"===d.Xh&&d.PR<59||"Edge"===d.Xh)){for(T.info("using replaceTrack method"),t=0;t<this.rtpSenders.audio.length;t+=1)s.push(this.rtpSenders.audio[t].replaceTrack(null));for(t=0;t<this.rtpSenders.video.length;t+=1)s.push(this.rtpSenders.video[t].replaceTrack(null));return T.debug("end replaceTrack method"),new Promise(function(v,r){Promise.all(s).then(function(g){v()}).catch(r)})}for(T.info("using removeTrack method"),l=this.pc.getSenders(),T.debug("senders :",l),t=0;t<l.length;t+=1)this.pc.removeTrack(l[t]);T.debug("end removeTrack method")}return Promise.resolve()},this.stopStream=function(A){T.info("stopStream in call");var t,l=null;if("Chrome"===d.Xh&&d.PR<45||"Firefox"===d.Xh&&d.PR<44||"Opera"===d.Xh&&d.PR<34||"Chromium"===d.Xh&&d.PR<44||"Chrome WebView"===d.Xh&&d.PR<45)T.log("... using MediaStream.stop"),A.stop();else{for(T.log("... using MediaStreamTrack.stop"),l=A.getTracks(),t=0;t<l.length;t+=1)l[t].stop();T.log("... tracks stopped")}A=null},this.getScreenUserMediaOnCall=function(){T.info("getScreenUserMediaOnCall");try{T.log("getScreenMedia"),navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.desktopId,maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},this.callback(this,"onScreenUserMediaSuccessOnCall"),this.callback(this,"onScreenUserMediaErrorOnCall")),T.log("Requested access to local media with new syntax.")}catch(A){T.error("getUserMedia() failed. Is this a WebRTC capable browser?"),T.log("getUserMedia failed with exception: "+A.message)}},this.onScreenUserMediaSuccessOnCall=function(A){T.info("onScreenUserMediaSuccessOnCall");var t,l="Unknown",s="Unknown";A.getAudioTracks().length>0&&(A.getAudioTracks()[0].label&&(l=A.getAudioTracks()[0].label),T.log("Using audio device: "+l)),A.getVideoTracks().length>0&&(A.getVideoTracks()[0].label&&(s=A.getVideoTracks()[0].label),T.log("Using video device: "+s)),T.log("Changing video stream with screen"),this.screenStream=A,this.screenStream.getVideoTracks()[0].onended=this.callback(this,"stopScreenSharingOnSwitchStream"),T.log("Adding callLocalstream to screen MediaStream"),t=this.callLocalStream.getAudioTracks()[0].clone(),this.screenStream.addTrack(t),this.switchVideoToScreen()},this.toggleVideoScreen=function(){!0===this.screenIsDisplayed?this.switchScreenToVideo():this.switchVideoToScreen()},this.switchVideoToScreen=function(){var A=this;T.info("switchVideoToScreen in call"),this.removeStream(this.callLocalStream).then(function(){A.addStream(A.screenStream),A.updateMediaWithRetryManagement(!1),G.myWebRTC_Event.createSwitchStreamEvent(A.callId,A.screenStream),A.screenIsDisplayed=!0}).catch(function(t){T.error("Failed to switchVideoToScreen",t);var l=null,s=null;A.callControl&&(l=A.callControl.roomName,s=A.callControl.type),G.myWebRTC_Event.createErrorEvent("Failed to switchVideoToScreen","MEDIA_UPDATE_ERROR",A.callId,l,s)})},this.switchScreenToVideo=function(){var A=this;T.info("switchScreenToVideo in call"),this.removeStream(this.screenStream).then(function(){A.addStream(A.callLocalStream),A.updateMediaWithRetryManagement(!1),G.myWebRTC_Event.createSwitchStreamEvent(A.callId,A.callLocalStream),A.screenIsDisplayed=!1}).catch(function(t){T.error("Failed to switchScreenToVideo",t);var l=null,s=null;A.callControl&&(l=A.callControl.roomName,s=A.callControl.type),G.myWebRTC_Event.createErrorEvent("Failed to switchScreenToVideo","MEDIA_UPDATE_ERROR",A.callId,l,s)})},this.onScreenUserMediaErrorOnCall=function(A){T.error("Failed to get access to local media. Error code was "+A.code),T.error(A),A=null},this.addVideoMedia=function(){var A=this;T.info("addVideoMedia"),apiCC.createUserMediaStream({callId:this.callId,type:"media",gum_config:G.gum_config,success:function(l){T.debug("[addVideoMedia] success; userMediaStreamId: "+l.userMediaStreamId);var s=apiCC.getUserMediaStream(A.callConfiguration.userMediaStreamId),v=Promise.resolve();s&&(v=A.removeStream(s.stream).then(function(){G.myWebRTC_Event.createLocalStreamRemovedEvent(A.callType,A.callId,s.stream,A.remoteId,A.destCallType),apiCC.releaseUserMediaStream(s.userMediaStreamId,A.callId)})),v.then(function(){A.callConfiguration.userMediaStreamId=l.userMediaStreamId,A.callLocalStream=l.stream,A.addStream(l.stream),A.updateMediaWithRetryManagement(!1)}).catch(function(r){T.error("Failed to addVideoMedia",r);var g=null,E=null;A.callControl&&(g=A.callControl.roomName,E=A.callControl.type),G.myWebRTC_Event.createErrorEvent("Failed to addVideoMedia","MEDIA_UPDATE_ERROR",A.callId,g,E)})},failure:function(l,s){T.debug("[addVideoMedia] failure; userMediaStreamId: "+l.userMediaStreamId),A.onUserMediaErrorOnCall(s)}})},this.stopScreenSharingOnSwitchStream=function(){T.info("stopScreenSharingOnSwitchStream detected"),this.switchScreenToVideo(this.callId),null!==this.screenStream&&(T.log("stopping screenStream"),this.stopStream(this.screenStream),Z.createUserMediaStopEvent(this.callId,"screen"))},this.stopScreenSharing=function(){T.info("stopScreenSharing detected"),G.removeCallFromTableWithCallIdAndSendBye(this.callId,"stop_ScreenSharing")},this.checkingMutingState=function(){var A=this,t=null;T.debug("checkingMutingState");var l=function(){(0,h.ki)(A,"mcuRemoteStream","object")||(A.mcuRemoteStream={}),A.mcuRemoteStream.videoMuted=!0},s=function(){(0,h.ki)(A,"mcuRemoteStream","object")||(A.mcuRemoteStream={}),A.mcuRemoteStream.audioMuted=!0};(0,h.ki)(this.callConfiguration,"userMediaStreamId","string")&&(t=apiCC.getUserMediaStream(this.callConfiguration.userMediaStreamId))&&(t.videoMuted?(l(),this.isLocalVideoMuted=!0):this.isLocalVideoMuted=!1,t.audioMuted?(s(),this.isLocalAudioMuted=!0):this.isLocalAudioMuted=!1);var v=function(){A.isLocalVideoMuted||(t?t.video&&!t.videoMuted&&t.muteVideoOnStreams("enabled"):A.callLocalStream&&(G.muteTracks(A.callLocalStream.getVideoTracks()),A.isLocalVideoMuted=!0),l())},r=function(){A.isLocalAudioMuted||(t?t.audio&&!t.audioMuted&&t.muteAudioOnStreams("enabled"):A.callLocalStream&&(G.muteTracks(A.callLocalStream.getAudioTracks()),A.isLocalAudioMuted=!0),s())};!0===G.isVideoMuted&&(T.log("Client is video muted, applying to call"),v()),!0===G.isAudioMuted&&(T.log("Client is audio muted, applying to call"),r()),(0,h.ki)(this.callConfiguration,"muted","string")&&(T.log("callConfiguration muted is set :",this.callConfiguration.muted),"VIDEO"===this.callConfiguration.muted&&(v(),r()),"AUDIOONLY"===this.callConfiguration.muted&&r(),"VIDEOONLY"===this.callConfiguration.muted&&v(),delete this.callConfiguration.muted)},this.onUserMediaSuccessOnCall=function(A){T.info("onUserMediaSuccessOnCall");var t=(0,h.Pj)(),l={};!0===G.userMediaErrorDetected&&(G.userMediaErrorDetected=!1,l.userMediaErrorDetected=G.userMediaErrorDetected,apiCC.session.setUserData(l)),T.log("isHTTPS()"+t),G.getUserMediaOnGoing=!1,T.log("User has granted access to local media."),G.accessToLocalMedia=!0,G.displayHangUpButtonInCommand(),this.accessToMedia=!0,"LOCAL"!==this.calleeId&&G.setStatus(!0===this.callee?"You are connected to :"+this.callerId:"You are connected to :"+this.calleeId),!0===this.screenSharing?(this.callType="screenSharing",null!=A&&(A.onended=this.callback(this,"stopScreenSharing"),A.getVideoTracks().length>0&&(A.getVideoTracks()[0].onended=this.callback(this,"stopScreenSharing")))):!0===this.audioOnly&&(this.callType="audio"),!1===this.addingUserMedia?(G.miniVideo&&(T.log("webRTCClient.miniVideo.src :"+G.miniVideo.src),T.log("document.URL :"+document.URL),void 0!==A&&apiCC.attachMediaStream(G.miniVideo,A)),G.localVideo&&(T.log("webRTCClient.localVideo.src :"+G.localVideo.src),T.log("document.URL :"+document.URL),void 0!==A&&apiCC.attachMediaStream(G.localVideo,A),G.localVideo.style.opacity=1)):G.miniVideo&&void 0!==A&&apiCC.attachMediaStream(G.miniVideo,A),void 0!==A&&(this.callLocalStream=A),(0,h.yJ)()?(T.log("isHTTP true"),this.establishCall()):(T.log("webRTCClient.userAcceptOnIncomingCall :"+G.userAcceptOnIncomingCall),T.log("this.callee :"+this.callee),void 0!==this.data&&T.log("this.data.MCUType :"+this.data.MCUType),!0!==G.userAcceptOnIncomingCall||!0!==this.callee&&"MCU-Callee"!==this.data.MCUType||!1!==this.isAccepted?"LOCAL"!==this.calleeId?this.establishCall():T.log("call is not established as this is a LOCAL stream request"):T.log("Stand-by :: wait for establishCall"))},this.establishCall=function(){var A=this;T.debug("establishCall()"),!0!==this.started||!0!==this.addingUserMedia||!this.belongsToRoom()||"publish"!==this.settingUpType||this.data&&this.data.hasOwnProperty("MCUType")||!this.sessionMCU||this.sessionMCU.hasOwnProperty("roomMode")||(this.restarting=!0,this.pc.close(),this.pc=null,this.started=!1,this.localDescriptionSetted=!1,this.remoteDescriptionSetted=!1,this.sendedSdpOfferMessage=null,this.receivedSdpOfferMessage=null,this.rtpSenders={audio:[],video:[]},this.addingUserMedia=!1,this.updateUserMedia=!1,this.updateCause=null,this.incomingcandidatesQueue=[],this.message200OKReceived=!1,this.statisticId&&(clearInterval(this.statisticId),this.statisticId=null),this.csmIntervalId&&(clearInterval(this.csmIntervalId),this.csmIntervalId=null),this.instanceId=apiCC.generateInstanceId(),this.data.instanceId=this.instanceId),!0!==this.dataCall&&this.checkingMutingState(),this.maybeStart();var t=null;this.callee&&!0!==this.addingUserMedia&&!0!==this.updateUserMedia?(t=new apiCC.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),T.log("Avant setRemote pour le callee :",t),null!==this.pc?(G.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),t.sdp=G.mySDPManager.maybePreferCodec(t.sdp,"video","H264")),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("establishCall : before setRemoteDescription for callee"),this.pc.setRemoteDescription(t,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("establishCall : before setRemoteDescription for callee - Promise version"),this.pc.setRemoteDescription(t).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure")))):T.log("Error : PC is null"),this.doAnswer()):!0===this.addingUserMedia?(T.log("Adding local stream 1."),null!==this.pc?(null===this.callLocalStream&&null!==G.localStream&&(this.callLocalStream=G.localStream),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream).then(function(){A.updateMediaWithRetryManagement(!1)}).catch(function(l){T.error("failed to add stream",l)})):(T.log("No Stream to addStream"),this.updateMediaWithRetryManagement(!1))):T.error("Error : PC is null")):!0===this.updateUserMedia&&this.updateMediaWithRetryManagement(!1),T.log("End of establishCall()")},this.onUserMediaSuccessTestUni=function(){G.getUserMediaOnGoing=!1,T.info("onUserMediaSuccessTestUni : User has not granted access to local media.");var A=null,t={};!0===G.userMediaErrorDetected&&(G.userMediaErrorDetected=!1,t.userMediaErrorDetected=G.userMediaErrorDetected,apiCC.session.setUserData(t)),G.accessToLocalMedia=!0,this.maybeStart(),this.callee&&(A=new apiCC.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),G.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),A.sdp=G.mySDPManager.maybePreferCodec(A.sdp,"video","H264")),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("onUserMediaSuccessTestUni : before setRemoteDescription for callee"),this.pc.setRemoteDescription(A,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("onUserMediaSuccessTestUni : before setRemoteDescription for callee - Promise version"),this.pc.setRemoteDescription(A).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure"))),this.doAnswer())},this.onUserMediaErrorOnCall=function(A){var t=this;T.log("onUserMediaErrorOnCall");var l={};G.getUserMediaOnGoing=!1,setTimeout(function(){Z.createErrorEvent(A,"USER_MEDIA_ERROR",t.callId)}),T.error("Failed to get access to local media. Error code was "+A.code),T.error(A),A=null,"electron"!==d.$6&&"Chrome"===d.Xh&&d.PR>47&&(T.log("browser_version > 47"),"https:"!==window.location.protocol&&T.error("HTTPS is now mandatory to use getUserMedia()")),G.setStatus("<div>Your phone is registered, you can be reached at this number : "+G.clientId+"</div>"),!0===this.screenSharing&&(this.callType="screenSharing","https:"!==window.location.protocol?(T.log("You need to be connected using HTTPS for screenSharing"),Z.createDesktopCaptureEvent("UserMediaError_HTTPS_needed",this.callId,this.remoteId)):(T.log("screenSharing UserMediaError"),Z.createDesktopCaptureEvent("UserMediaError",this.callId,this.remoteId))),!0===this.callee?(this.myWebRTC_Stack.sendBye(this.callId,this.calleeId,this.dest_roomId,this.callerId,"User_Media_Error",this.data),G.removeCallFromTableWithCallIdandRemoteId(this.callId,this.callerId,"User_Media_Error")):(null!=this.data&&"MCU-Callee"===this.data.MCUType&&this.myWebRTC_Stack.sendBye(this.callId,this.callerId,this.dest_roomId,this.calleeId,"User_Media_Error",this.data),G.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"User_Media_Error")),!1===this.screenSharing&&(G.userMediaErrorDetected=!0,l.userMediaErrorDetected=G.userMediaErrorDetected,apiCC.session.setUserData(l))},this.maybeStart=function(){T.debug("maybeStart"),!this.started&&G.channelReady&&(G.accessToLocalMedia||this.dataCall)&&(T.log("Creating PeerConnection."),this.createPeerConnection(),G.unidirectionelCallOnly||!0===this.screenSharing?!1===this.callee&&(T.log("Adding local stream 2."),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream)):null!==G.localStream?(T.log("Add Stream of client.localStream"),this.addStream(G.localStream),this.callLocalStream=G.localStream):T.log("No Stream to add")):this.dataCall||(T.log("Adding local stream 3."),null!==this.callLocalStream?(T.log("Add Stream of callLocalStream"),this.addStream(this.callLocalStream)):null!==G.localStream?(T.log("Add Stream of client.localStream"),this.addStream(G.localStream),this.callLocalStream=G.localStream):(T.log("No Stream to add"),this.belongsToRoom()||"safari"!==h.wL.type||"function"!=typeof this.pc.addTransceiver||(T.debug("add transceivers"),this.pc.addTransceiver("audio",{direction:"recvonly"}),this.pc.addTransceiver("video",{direction:"recvonly"})))),this.started=!0,!1===this.callee&&(T.log("Before doCall()"),this.doCall())),T.log("End of maybeStart")},this.createDataChannel=function(){if(T.info("createDataChannel"),"Edge"===d.Xh&&d.PR<79)T.warn("Cannot create DataChannel as it is not supported on Edge");else if(null===this.sendDataChannel)try{this.sendDataChannel=this.pc.createDataChannel("apiRTCDataChannel",{}),this.sendDataChannel.binaryType="arraybuffer",T.log("Created data channel"),T.log("Subscribing to dc events"),this.sendDataChannel.onopen=this.callback(this,"onSendDataChannelOpen"),this.sendDataChannel.onclose=this.callback(this,"onSendDataChannelClose"),this.sendDataChannel.onmessage=this.callback(this,"onSendDataChannelMessage"),this.sendDataChannel.onerror=this.callback(this,"onSendDataChannelError")}catch(A){T.log("createDataChannel() failed with exception: "+A.message)}else T.log("Datachannel already exist")},this.createPeerConnection=function(){T.info("createPeerConnection");try{T.log("createPeerConnection with pc_config:",JSON.stringify(this.pc_config)),T.log("and pc_constraints:",JSON.stringify(this.pc_constraints)),"chrome"===h.wL.type&&h.wL.version>=72&&h.wL.version<78?(T.debug("Chrome 72=+ and 78-, force sdpSemantics plan-b"),this.pc_config.sdpSemantics="plan-b"):"iOS"===apiRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc?(T.debug("Cordova, force sdpSemantics plan-b"),this.pc_config.sdpSemantics="plan-b"):T.debug("sdpSemantics unified-plan is being used"),this.pc=new apiCC.myWebRTC_Adapter.RTCPeerConnection(this.pc_config,this.pc_constraints),this.dataCall&&this.createDataChannel(),this.pc.onicecandidate=this.callback(this,"onIceCandidate")}catch(A){return T.log("Failed to create PeerConnection, exception: "+A.message),void T.error("Cannot create RTCPeerConnection object; WebRTC is not supported by this browser.")}"Firefox"===d.Xh&&d.PR>=53||"Edge"===d.Xh||"chrome"===h.wL.type&&h.wL.version>=64?(this.pc.ontrack=this.callback(this,"onRemoteTrackAdded"),this.pc.onaddstream=this.callback(this,"onRemoteStreamAdded")):"Safari"===d.Xh&&d.PR>=12||"Mobile Safari"===d.Xh&&d.PR>=12?this.pc.ontrack=this.callback(this,"onRemoteTrackAdded"):this.pc.onaddstream=this.callback(this,"onRemoteStreamAdded"),this.pc.onremovestream=this.callback(this,"onRemoteStreamRemoved"),this.pc.onnegotiationneeded=this.callback(this,"onNegotiationNeeded"),this.pc.onsignalingstatechange=this.callback(this,"onSignalingStateChange"),this.pc.oniceconnectionstatechange=this.callback(this,"onIceConnectionStateChange"),this.pc.ondatachannel=this.callback(this,"onDataChannel"),this.pc.onicegatheringstatechange=this.callback(this,"onIceGatheringStateChange"),this.pc.onconnectionstatechange=this.callback(this,"onConnectionStateChange"),G.qosEnable&&(this.statisticId=setInterval(this.callback(this,"getStatistics"),this.getStatsInterval)),G.csmEnable&&(this.csmLastResults={},this.csmIntervalId=setInterval(this.callback(this,"csmHandler"),this.csmIntervalMs))},this.onIceGatheringStateChange=function(A){T.log("onIceGatheringStateChange"),null!==this.pc&&(T.info("onIceGatheringStateChange, Ice Gathering State is now : "+this.pc.iceGatheringState),"complete"===this.pc.iceGatheringState&&0===this.candidateNb&&T.warn("Warning, no candidate where retrieved for this call on client"))},this.onConnectionStateChange=function(A){T.log("onConnectionStateChange event :",A)},this.onDataChannel=function(A){T.info("onDataChannel event"),this.receiveDataChannel=A.channel,this.receiveDataChannel.binaryType="arraybuffer",null===this.sendDataChannel&&(T.log("Setting this.sendDataChannel with receivedDataChannel"),this.sendDataChannel=A.channel,this.sendDataChannel.onopen=this.callback(this,"onSendDataChannelOpen"),this.sendDataChannel.onclose=this.callback(this,"onSendDataChannelClose"),this.sendDataChannel.onmessage=this.callback(this,"onSendDataChannelMessage"),this.sendDataChannel.onerror=this.callback(this,"onSendDataChannelError")),T.log("got dataChannel",A.channel.label),T.log("Subscribing to dc events"),this.receiveDataChannel.onopen=this.callback(this,"onReceiveDataChannelOpen"),this.receiveDataChannel.onclose=this.callback(this,"onReceiveDataChannelClose"),this.receiveDataChannel.onmessage=this.callback(this,"onReceiveDataChannelMessage"),this.receiveDataChannel.onerror=this.callback(this,"onReceiveDataChannelError")},this.onSendDataChannelOpen=function(A){T.info("onSendDataChannelOpen"),"data"===this.callType&&"dataChannelConnector"===this.calleeId&&(this.pushDataStatus&&"pipeline"===this.pushDataStatus.type?(this.pushDataStatus.state="ready",setTimeout(function(){G.startNextPushData()})):!0!==this.transferStarted&&this.startTransfer()),Z.createEvent({eventType:"sendDataChannelOpen",callId:this.callId,remoteId:this.remoteId,details:A})},this.onSendDataChannelClose=function(A){T.info("onSendDataChannelClose"),this.sendDataChannel=null,null!==Z&&Z.createEvent({eventType:"sendDataChannelClose",callId:this.callId,remoteId:this.remoteId,details:A})},this.processOnDataChannelMessage=function(A){var t,l,s=null,v=null,r="",g=0;if(T.info("processOnDataChannelMessage"),s=JSON.parse(A.data),T.log("data.uuid :"+s.uuid),T.log("data.messageSize :"+s.messageSize),T.log("data.originalDataType :"+s.originalDataType),t=s.uuid,"ArrayBuffer"===s.originalDataType&&(T.log("ArrayBuffer conversion"),s.message=h.cw.decode(s.message)),T.log("data :"+s),T.log("data.uuid :"+t),T.log("receiveChunkNb[uuid] :"+this.receiveChunkNb[t]),void 0===this.receiveChunkNb[t])T.log("receiving first packet for uuid :"+t),T.log("evt.data.message :"+A.data),this.firstDataPacket[t]=s,this.receiveChunkNb[t]=1,this.receivedSize[t]=0,this.startingDate=new Date,this.transferDuration=0,Z.createEvent({eventType:"onFileReceiving",remoteId:this.remoteId,callId:this.callId,name:s.name,uuid:t}),Z.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:this.firstDataPacket[t].size,callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:0,transferEnded:!1});else if(T.log("new packet for uuid :"+t),this.receiveChunkNb[t]+=1,T.log("data.messageSize :"+s.messageSize),T.log("data.message.length :"+s.message.length),T.log("receivedSize :"+(g=s.messageSize||s.message.length)),this.receiveArrayToStoreChunks[t]||(this.receiveArrayToStoreChunks[t]=[]),this.receiveArrayToStoreChunks[t].push(s.message),this.receivedSize[t]+=g,this.transferDuration=new Date-this.startingDate,this.receivedSize[t]===this.firstDataPacket[t].size){if(T.log("End of data transfert"),T.log("this.firstDataPacket.type :"+this.firstDataPacket[t].type),"image/png-dataUrl"===this.firstDataPacket[t].type){for(T.log("Photo received from a takeSnapshot"),l=0;l<this.receiveArrayToStoreChunks[t].length;l+=1)r+=this.receiveArrayToStoreChunks[t][l];v=r}else v=new window.Blob(this.receiveArrayToStoreChunks[t]);Z.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:0,callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:100,transferEnded:!0}),Z.createEvent({eventType:"onFileReceived",callId:this.callId,uuid:t,remoteId:this.remoteId,callerId:this.callerId,calleeId:this.calleeId,data:{file:v,name:this.firstDataPacket[t].name,type:this.firstDataPacket[t].type,uuid:t},details:A}),delete this.receiveArrayToStoreChunks[t],delete this.receivedSize[t],delete this.receiveChunkNb[t],delete this.firstDataPacket[t]}else Z.createEvent({eventType:"onFileProgress",sendChunkNb:this.receiveChunkNb[t],fileSize:this.firstDataPacket[t].size,remainingSize:this.firstDataPacket[t].size-this.receivedSize[t],callId:this.callId,uuid:t,remoteId:this.remoteId,lastPacket:!1,startingDate:this.startingDate,transferDuration:this.transferDuration,percentage:parseInt(100*this.receivedSize[t]/this.firstDataPacket[t].size,10),transferEnded:!1})},this.onSendDataChannelMessage=function(A){T.info("onSendDataChannelMessage :",A),this.processOnDataChannelMessage(A)},this.onSendDataChannelError=function(A){T.info("onSendDataChannelError"),this.sendDataChannel=null,Z.createEvent({eventType:"sendDataChannelError",callId:this.callId,remoteId:this.remoteId,details:A})},this.onReceiveDataChannelOpen=function(A){T.info("onReceiveChannelOpen"),Z.createEvent({eventType:"receiveDataChannelOpen",callId:this.callId,remoteId:this.remoteId,details:A})},this.onReceiveDataChannelClose=function(A){T.info("onReceiveDataChannelClose"),this.receiveDataChannel=null,null!==Z&&Z.createEvent({eventType:"receiveDataChannelClose",callId:this.callId,remoteId:this.remoteId,details:A})},this.onReceiveDataChannelMessage=function(A){T.info("onReceiveChannelMessage"),this.processOnDataChannelMessage(A)},this.onReceiveDataChannelError=function(A){T.info("onReceiveChannelError"),Z.createEvent({eventType:"receiveDataChannelError",callId:this.callId,remoteId:this.remoteId,details:A})},this.startTransfer=function(){var A=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=t.hasOwnProperty("delay")?t.delay:100;!0!==this.transferStarted&&(T.info("startTransfer",l),this.transferStarted=!0,setTimeout(function(){A.dcfs||(A.dcfs=new I(A),A.dcfs.transfer(A.fileContent.buffer,A.data.offset>0?A.data.offset:0,A.sendDataChannel,{delay:l}))},l))},this.statisticsAnswer=function(A){var t=A.result(),l=null;this.qm||(this.qm=new R(this.getStatsInterval/1e3,this.callback(this,"onQosChange"),this.callback(this,"onQosAudioChange"),this.callback(this,"onQosVideoChange"),this.callId,G.apiKey,G.clientId,G.socket)),t&&(this.qm.insertStats(t,this.sendedSdpOfferMessage,this.receivedSdpOfferMessage,G.remoteVideo),l=this.qm.getAllStats(),G.qosEnable&&Z.createEvent({eventType:"onQosStatsUpdate",callId:this.callId,remoteId:this.remoteId,stats:l}),this.videoReceivedWidth=l.VideoRecv.FrameWidth,this.videoReceivedHeight=l.VideoRecv.FrameHeight,this.videoSendWidth=l.VideoSend.FrameWidth,this.videoSendHeight=l.VideoSend.FrameHeight,this.videoReceivedDelay=l.VideoRecv.delay,this.audioReceivedDelay=l.AudioRecv.delay,this.audioSendDelay=l.AudioSend.rtt,this.videoSendDelay=l.VideoSend.rtt,this.videoSendMoyDelay=l.VideoSend.moyRtt,this.videoSendPacketLossRatio=l.VideoSend.packetLostRatio,this.audioSendPacketLossRatio=l.AudioSend.packetLostRatio,this.videoSendEncodeUsagePercent=l.VideoSend.googEncodeUsagePercent,this.videoSendCpuLimitedResolution=l.VideoSend.googCpuLimitedResolution,this.videoSendBandwidthLimitedResolution=l.VideoSend.googBandwidthLimitedResolution,void 0!==this.videoSendCpuLimitedResolution&&!0===JSON.parse(this.videoSendCpuLimitedResolution)&&Z.createEvent({eventType:"cpuLimited",callId:this.callId,encodeUsagePercent:this.videoSendEncodeUsagePercent}),void 0!==this.videoSendBandwidthLimitedResolution&&!0===JSON.parse(this.videoSendBandwidthLimitedResolution)&&Z.createEvent({eventType:"bandwidthLimited",callId:this.callId}))},this.csmGetStatsHandler=function(A){var t,l=this,s=null,v=null,r={};if(this.csm||(this.csm=new c(this.csmIntervalMs/1e3,h.wL.type,h.wL.version,"standard"),this.csm.browserInfo={browserAbout:d.Xh+" "+d.dc,browserType:h.wL.type,browserVersion:h.wL.version},(0,h.Ym)(this.mcuRemoteStream,"attributes","object")&&(!0===this.mcuRemoteStream.replay?(0,h.Ym)(this.mcuRemoteStream.attributes.callerId,"string")&&(0,h.Ym)(this.mcuRemoteStream.attributes.callId,"string")&&(0,h.Ym)(this.mcuRemoteStream.attributes.recId,"string")&&(this.csm.callFeed={clientId:this.mcuRemoteStream.attributes.callerId,callId:this.mcuRemoteStream.attributes.callId,modifier:"replay",recId:this.mcuRemoteStream.attributes.recId}):(0,h.Ym)(this.mcuRemoteStream.attributes.callerId,"string")&&(0,h.Ym)(this.mcuRemoteStream.attributes.callId,"string")&&(this.csm.callFeed={clientId:this.mcuRemoteStream.attributes.callerId,callId:this.mcuRemoteStream.attributes.callId}))),r.post=function(E){l.mos||(l.mos=new j),E.quality={},E.audioReceived?l.isRemoteAudioMuted?E.quality.mosS="Muted":0!==E.audioReceived.bitsReceivedPerSecond?(E.audioReceived.delay=parseInt(l.audioReceivedDelay,10),E.quality.mosS=l.mos.NarrowBandSpeechQuality(E.audioReceived.delay,E.audioReceived.packetLossRatio)):E.quality.mosS="NoStream":E.quality.mosS="NoStream",E.videoReceived?l.isRemoteVideoMuted?E.quality.mosV="Muted":0!==E.videoReceived.bitsReceivedPerSecond?(E.videoReceived.width=l.videoReceivedWidth,E.videoReceived.height=l.videoReceivedHeight,E.videoReceived.delay=parseInt(l.videoReceivedDelay,10),E.quality.mosV=l.mos.videoQuality(E.videoReceived.width,E.videoReceived.height,E.videoReceived.packetLossRatio,Math.floor(E.videoReceived.bitsReceivedPerSecond/1e3),E.videoReceived.framesDecodedPerSecond)):E.quality.mosV="NoStream":E.quality.mosV="NoStream",E.audioReceived&&E.videoReceived&&(E.quality.mosAV=l.mos.audiovisualQuality(E.quality.mosS,E.quality.mosV,E.audioReceived.delay,E.videoReceived.delay)),E.audioSent?l.isLocalAudioMuted?E.quality.mosSS="Muted":0!==E.audioSent.bitsSentPerSecond?(E.audioSent.delay=parseInt(l.audioSendDelay,10),E.audioSent.packetLossRatio=l.audioSendPacketLossRatio,E.quality.mosSS=l.mos.NarrowBandSpeechQuality(E.audioSent.delay,E.audioSent.packetLossRatio)):E.quality.mosSS="NoStream":E.quality.mosSS="NoStream",E.videoSent?l.isLocalVideoMuted?E.quality.mosSV="Muted":0!==E.videoSent.bitsSentPerSecond?(E.videoSent.width=l.videoSendWidth,E.videoSent.height=l.videoSendHeight,E.videoSent.delay=parseInt(l.videoSendDelay,10),E.videoSent.moyDelay=parseInt(l.videoSendMoyDelay,10),E.videoSent.packetLossRatio=l.videoSendPacketLossRatio,E.videoSent.encodeUsagePercent=l.videoSendEncodeUsagePercent,E.videoSent.cpuLimitedResolution=l.videoSendCpuLimitedResolution,E.videoSent.bandwidthLimitedResolution=l.videoSendBandwidthLimitedResolution,E.quality.mosSV=l.mos.videoQuality(E.videoSent.width,E.videoSent.height,E.videoSent.packetLossRatio,Math.floor(E.videoSent.bitsSentPerSecond/1e3),E.videoSent.framesEncodedPerSecond)):E.quality.mosSV="NoStream":E.quality.mosSV="NoStream",E.audioSent&&E.videoSent&&(E.quality.mosSAV=l.mos.audiovisualQuality(E.quality.mosSS,E.quality.mosSV,E.audioSent.delay,E.videoSent.delay))},t=this.csm.addCallStats(A,r),0!==Object.keys(t).length){!t.quality||"Muted"===t.quality.mosS&&"Muted"===t.quality.mosV&&"Muted"===t.quality.mosSS&&"Muted"===t.quality.mosSV||G.qualityScoreEnable&&Z.createEvent({eventType:"onCallScoreUpdate",callId:this.callId,score:t.quality}),this.csmLastResults=t,this.callLocalStream&&"function"==typeof this.callLocalStream.getVideoTracks&&(s=this.callLocalStream.getVideoTracks())&&s[0]&&"function"==typeof s[0].getSettings&&(v=s[0].getSettings());var g={save:!0,clientId:G.clientId,callId:this.callId,instanceId:this.instanceId,browserInfo:this.csm.browserInfo,stats:t};this.sessionMCU&&(g.roomId=this.sessionMCU.roomName,g.pubSub=G.MCUClient.pubConnector),this.csm.callFeed&&(g.callFeed=this.csm.callFeed),v&&(g.videoSettings=v),this.data.mesh&&(g.mesh=this.data.mesh),this.myWebRTC_Stack.sendInfo("callStats",g),G.csmEnable&&Z.createEvent(this.data&&this.data.mesh&&(this.data.mesh.calleeCompositeUserId?this.data.mesh.calleeCompositeUserId===G.compositeClientId:this.data.mesh.calleeId===G.clientId)?{eventType:"onCallStatsUpdate",callId:this.data.mesh.calleeCallId,userId:this.data.mesh.callerId,stats:t}:{eventType:"onCallStatsUpdate",callId:this.callId,stats:t})}},this.onQosChange=function(A,t){Z.createEvent({eventType:"onQosChange",callId:this.callId,remoteId:this.remoteId,qosIn:A,qosOut:t})},this.onQosAudioChange=function(A,t){Z.createEvent({eventType:"onQosAudioChange",callId:this.callId,remoteId:this.remoteId,qosAudioIn:A,qosAudioOut:t})},this.onQosVideoChange=function(A,t){Z.createEvent({eventType:"onQosVideoChange",callId:this.callId,remoteId:this.remoteId,qosVideoIn:A,qosVideoOut:t})},this.getStatistics=function(){this.pc&&this.pc.getStats&&"Firefox"!==d.Xh&&this.pc.getStats(this.callback(this,"statisticsAnswer"))},this.csmHandler=function(){this.statisticId||this.getStatistics(),this.pc&&"function"==typeof this.pc.getStats&&this.pc.getStats(null).then(this.callback(this,"csmGetStatsHandler")).catch(function(A){T.warn("failed to get stats",A)})},this.doCall=function(){var A=null;T.log("Sending offer to peer"),this.audioOnly?(T.log("audioOnly call :",this.mediaConstraintsAudioOnly),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):(T.log("createOffer - Promise version"),this.pc.createOffer(this.mediaConstraintsAudioOnly).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):!0===this.screenSharing?(T.log("screenSharing call : one way media :",A),A={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),A)):(T.log("createOffer - Promise version"),this.pc.createOffer(A).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):!0===this.dataCall?(T.log("call is data only :",A),A="Firefox"===d.Xh&&d.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),A)):(T.log("createOffer - Promise version"),this.pc.createOffer(A).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure")))):(T.log("call is audio & video :",this.mediaConstraints),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)):(T.log("createOffer - Promise version"),this.pc.createOffer(this.mediaConstraints).then(this.callback(this,"setLocalAndSendMessageonOffer")).catch(this.callback(this,"onCreateOfferFailure"))))},this.doAnswer=function(){T.info("doAnswer");var A=null;this.audioOnly?(T.log("audioOnly call"),A=this.mediaConstraintsAudioOnly):A=this.mediaConstraints,"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createAnswer"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessage"),this.callback(this,"onCreateAnswerFailure"),A)):(T.log("createAnswer - Promise version"),this.pc.createAnswer(A).then(this.callback(this,"setLocalAndSendMessage")).catch(this.callback(this,"onCreateAnswerFailure")))},this.doUpdateAnswer=function(){T.info("doUpdateAnswer");var A=null;this.audioOnly?(T.log("audioOnly call"),A=this.mediaConstraintsAudioOnly):A=this.mediaConstraints,"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createAnswer"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessageUpdate"),this.callback(this,"onCreateAnswerFailure"),A)):(T.log("createAnswer - Promise version"),this.pc.createAnswer(A).then(this.callback(this,"setLocalAndSendMessageUpdate")).catch(this.callback(this,"onCreateAnswerFailure")))},this.updateMediaWithRetryManagement=function(A){T.debug("updateMediaWithRetryManagement");var t=this.updateMedia(A);T.debug("updateMediaResult :",t),"Sig_state_not_stable"!==t.reason&&"Update_already_ongoing"!==t.reason||(T.debug("updateMedia will be retried later for reason :",t.reason),this.retryUpdateMedia=!0)},this.updateMedia=function(A){return T.debug("updateMedia, callId :",this.callId),T.log("iceRestartActivated :",A),null===this.pc?(T.log("updateMedia, pc no more exist"),{status:"Not_Done",reason:"PC_Not_Exit"}):!0===this.updateMediaOngoing?(T.log("updateMedia, already ongoing"),{status:"Not_Done",reason:"Update_already_ongoing"}):(this.updateMediaOngoing=!0,"stable"!==this.pc.signalingState?{status:"Not_Done",reason:"Sig_state_not_stable"}:(T.log("Sending Update offer to peer."),this.audioOnly?(T.log("audioOnly call :",this.mediaConstraintsAudioOnly),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),void 0!==this.mediaConstraintsAudioOnly.mandatory?this.mediaConstraintsAudioOnly.mandatory.IceRestart=!0:this.mediaConstraintsAudioOnly.iceRestart=!0,T.log("this.mediaConstraints :",this.mediaConstraintsAudioOnly),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):(T.log("createOffer - Promise version"),!0===A&&(this.mediaConstraintsAudioOnly.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraintsAudioOnly),this.pc.createOffer(this.mediaConstraintsAudioOnly).then(this.callback(this,"setLocalAndSendMessageonOfferUpdate")).catch(this.callback(this,"onCreateOfferFailure")))):"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("createOffer"),!0===A&&(void 0!==this.mediaConstraints.mandatory?this.mediaConstraints.mandatory.IceRestart=!0:this.mediaConstraints.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraints),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)):(T.log("createOffer - Promise version"),!0===A&&(this.mediaConstraints.iceRestart=!0),T.log("this.mediaConstraints :",this.mediaConstraints),this.pc.createOffer(this.mediaConstraints).then(this.callback(this,"setLocalAndSendMessageonOfferUpdate")).catch(this.callback(this,"onCreateOfferFailure"))),{status:"OnGoing",reason:"OK"}))},this.manipulateSDP=function(A,t){var l=null,s=!1;return T.log("manipulateSDP with type :",t),!0===G.receiveMediaDeactivated&&(T.log("setting receiveMediaDeactivated in SDP :"+G.receiveMediaDeactivated),A.sdp=G.mySDPManager.setSendOnly(A.sdp)),!0===G.RTPMedia&&(A.sdp=A.sdp.replace(/RTP\/SAVPF/g,"RTP/SF")),null!==G.audioBandwidth&&(T.log("setting audioBandwidth in SDP :"+G.audioBandwidth),A.sdp=G.mySDPManager.setAudioBandwidth(A.sdp,G.audioBandwidth)),null!==G.videoBandwidth&&(T.log("setting videoBandwidth in SDP :"+G.videoBandwidth),A.sdp=G.mySDPManager.setVideoBandwidth(A.sdp,G.videoBandwidth)),null!==G.dataBandwidth&&(T.log("setting dataBandwidth in SDP :"+G.dataBandwidth),A.sdp=G.mySDPManager.setDataBandwidth(A.sdp,G.dataBandwidth)),!0===G.preferOpusCodec&&(T.log("setting preferOpusCodec"),A.sdp=G.mySDPManager.preferOpus(A.sdp)),!0!==G.preferVP9Codec&&!0!==this.preferVP9Codec||(T.log("Call prefer VP9 Codec"),A.sdp=G.mySDPManager.maybePreferCodec(A.sdp,"video","VP9")),!0!==G.preferH264Codec&&!0!==this.preferH264Codec||(T.log("Call prefer H264 Codec"),A.sdp=G.mySDPManager.maybePreferCodec(A.sdp,"video","H264")),!0===this.preferVP8Codec&&(T.log("Call prefer VP8 Codec"),A.sdp=G.mySDPManager.maybePreferCodec(A.sdp,"video","VP8")),!0===G.setStereo&&(T.log("Set Stereo"),A.sdp=G.mySDPManager.setCodecParam(A.sdp,"opus/48000","stereo","1")),A=G.mySDPManager.updateSDPcodecs(A,A.type,"audio",G.allowedAudioCodecs),A=G.mySDPManager.updateSDPcodecs(A,A.type,"video",G.allowedVideoCodecs),"OFFER"===t?"publish"===this.settingUpType&&"NONE"===this.mediaTypeForIncomingCall?(l=G.mySDPManager.createGuideline(A.sdp),"VIDEO"===this.mediaTypeForOutgoingCall?((0,h.ki)(l,"audio","object")&&"sendonly"!==l.audio.direction&&(l.audio.direction="sendonly",s=!0),(0,h.ki)(l,"video","object")&&"sendonly"!==l.video.direction&&(l.video.direction="sendonly",s=!0)):"AUDIO"===this.mediaTypeForOutgoingCall?((0,h.ki)(l,"audio","object")&&"sendonly"!==l.audio.direction&&(l.audio.direction="sendonly",s=!0),(0,h.ki)(l,"video","object")&&"inactive"!==l.video.direction&&(l.video.direction="inactive",s=!0)):"VIDEOONLY"===this.mediaTypeForOutgoingCall&&((0,h.ki)(l,"audio","object")&&"inactive"!==l.audio.direction&&(l.audio.direction="inactive",s=!0),(0,h.ki)(l,"video","object")&&"sendonly"!==l.video.direction&&(l.video.direction="sendonly",s=!0)),!0===s&&(A.sdp=l.generate())):"VIDEO"===this.mediaTypeForOutgoingCall?T.log("mediaTypeForOutgoingCall is VIDEO"):"AUDIO"===this.mediaTypeForOutgoingCall||!0===this.audioOnly?(T.log("mediaTypeForOutgoingCall is AUDIO"),A.sdp=G.mySDPManager.setRecvOnlyForVideo(A.sdp)):"VIDEOONLY"===this.mediaTypeForOutgoingCall?(T.log("mediaTypeForOutgoingCall is VIDEOONLY"),A.sdp=G.mySDPManager.setRecvOnlyForAudio(A.sdp)):"NONE"===this.mediaTypeForOutgoingCall&&(T.log("mediaTypeForOutgoingCall is NONE"),A.sdp=G.mySDPManager.setRecvOnly(A.sdp)):"ANSWER"===t&&("VIDEO"===this.mediaTypeForIncomingCall?T.log("mediaTypeForIncomingCall is VIDEO"):"AUDIO"===this.mediaTypeForIncomingCall||!0===this.audioOnly?(T.log("mediaTypeForIncomingCall is AUDIO"),A.sdp=G.mySDPManager.setRecvOnlyForVideo(A.sdp)):"VIDEOONLY"===this.mediaTypeForIncomingCall?(T.log("mediaTypeForIncomingCall is VIDEOONLY"),A.sdp=G.mySDPManager.setRecvOnlyForAudio(A.sdp)):"NONE"===this.mediaTypeForIncomingCall&&(T.log("mediaTypeForIncomingCall is NONE"),A.sdp=G.mySDPManager.setRecvOnly(A.sdp))),"SDP"===this.simulcast&&"OFFER"===t&&"publish"===this.settingUpType&&((l=G.mySDPManager.createGuideline(A.sdp)).mungeForSimulcasting(),A.sdp=l.generate()),A},this.setLocalAndSendMessageonOffer=function(A){T.info("setLocalAndSendMessageonOffer"),T.log("sessionDescription = ",A),T.log("sessionDescription.sdp = ",A.sdp);var t=null;A.sdp=this.manipulateSDP(A,"OFFER").sdp,T.log("manipulated sessionDescription.sdp = ",A.sdp),!0===this.stripAudioSDPActivated&&(A.sdp=G.mySDPManager.stripAudioMediaDescriptionFromSDP(A.sdp)),!0===this.stripVideoSDPActivated&&(A.sdp=G.mySDPManager.stripVideoMediaDescriptionFromSDP(A.sdp)),this.setLocalCallProfile(G.evalCallProfileWithSdp(A.sdp,"local","send")),this.sendedSdpOfferMessage=A,!0===this.dataCall&&(T.log("setLocalAndSendMessageonOffer : data Call"),this.callType="data"),!1===this.callCancelled?!1===G.NtoNConf?(T.log("Conf N to 1"),!0===this.screenSharing&&(t=G.mySDPManager.getAudioMediaDescriptionPart(this.sendedSdpOfferMessage.sdp),this.callType=null!=t?"screenSharingWithAudio":"screenSharing"),!0===this.trickleIce&&(this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,G.nickname,this.dest_roomId,this.dest_roomId,this.callType,{offer:A,data:this.data,stream:this.mcuRemoteStream,volatile:!!this.restarted}),this.inviteSended=!0),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessageonOffer : before setLocalDescription"),this.pc.setLocalDescription(this.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOffer : before setLocalDescription - Promise version"),this.pc.setLocalDescription(this.sendedSdpOfferMessage).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure")))):(T.log("Conf N to N"),this.myWebRTC_Stack.sendInviteBroadcast(this.callId,this.callerId,G.nickname,this.dest_roomId,this.dest_roomId,A),this.inviteSended=!0):(T.warn("Invite is not sent has call has been canceled"),G.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"Call_Cancelled"),0===G.callsTable.length&&(T.log("No more established calls for client"),G.initMediaElementState(),G.displayCallButtonInCommand()))},this.setLocalAndSendMessageonOfferUpdate=function(A){var l=null;T.info("setLocalAndSendMessageonOfferUpdate, sessionDescription :"+A),this.sendedSdpOfferMessage=A,T.log("sessionDescription.sdp = ",A.sdp),((0,h.Ym)(this.audioSdpDirection,"string")||(0,h.Ym)(this.videoSdpDirection,"string"))&&(l=G.mySDPManager.createGuideline(A.sdp),(0,h.ki)(l,"audio","object")&&(0,h.Ym)(this.audioSdpDirection,"string")&&(l.audio.direction=this.audioSdpDirection),(0,h.ki)(l,"video","object")&&(0,h.Ym)(this.videoSdpDirection,"string")&&(l.video.direction=this.videoSdpDirection),A.sdp=l.generate()),this.setLocalCallProfile(G.evalCallProfileWithSdp(A.sdp,"local","send"),!0),!0===this.trickleIce?(this.myWebRTC_Stack.sendUpdate(this.callId,this.callerId,this.calleeId,this.dest_roomId,this.callee?this.callerId:this.calleeId,A,this.callType,this.data),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription"),this.pc.setLocalDescription(A,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(A).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure")))):(T.log("Updating PC offer and answer after switch Stream"),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription"),this.pc.setLocalDescription(A,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(A).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),G.preferSendingH264Codec&&(T.log("Modification of SDP to set H264 as prefered sending codec"),this.pc.remoteDescription.sdp=G.mySDPManager.maybePreferCodec(this.pc.remoteDescription.sdp,"video","H264")),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessageonOfferUpdate : before setRemoteDescription"),this.pc.setRemoteDescription(this.pc.remoteDescription,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure"))):(T.log("setLocalAndSendMessageonOfferUpdate : before setRemoteDescription - Promise version"),this.pc.setRemoteDescription(this.pc.remoteDescription).then(this.callback(this,"onSetRemoteDescriptionSuccess")).catch(this.callback(this,"onSetRemoteDescriptionFailure"))))},this.onCreateOfferFailure=function(A){T.info("onCreateOfferFailure"+A),A=null},this.onCreateAnswerFailure=function(A){T.info("onCreateAnswerFailure"+A),A=null},this.setLocalAndSendMessage=function(A){var t;T.info("setLocalAndSendMessage"),T.log("sessionDescription.sdp = ",A.sdp),null!==this.pc?(A=this.manipulateSDP(A,"ANSWER"),t=G.mySDPManager.createGuideline(A.sdp),this.setLocalCallProfile(G.evalCallProfileWithSdpGuideline(t,A.sdp,"local","send")),this.setRemoteCallProfile(G.evalCallProfileWithSdpGuideline(t,A.sdp,"local","receive")),T.log("manipulated sessionDescription.sdp = ",A.sdp),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessage : before setLocalDescription"),this.pc.setLocalDescription(A,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessage : before setLocalDescription - Promise version"),this.pc.setLocalDescription(A).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),this.sendedSdpOfferMessage=A,!0===this.trickleIce&&this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,G.nickname,this.dest_roomId,A,this.data)):T.log("setLocalAndSendMessage, pc no more exist")},this.setLocalAndSendMessageUpdate=function(A){var t;null!==this.pc?("safari"===h.wL.type&&(A.sdp=this.manipulateSDP(A,"OFFER").sdp),t=G.mySDPManager.createGuideline(A.sdp),"AUDIOONLY"===this.mediaType?t.hasOwnProperty("video")&&"inactive"!==t.video.direction&&(T.debug("Only audio was requested at call setup: deactivating video"),t.video.direction="inactive",A.sdp=t.generate()):"VIDEOONLY"===this.mediaType&&t.hasOwnProperty("audio")&&"inactive"!==t.audio.direction&&(T.debug("Only video was requested at call setup: deactivating audio"),t.audio.direction="inactive",A.sdp=t.generate()),this.setLocalCallProfile(G.evalCallProfileWithSdpGuideline(t,A.sdp,"local","send"),!0),this.setRemoteCallProfile(G.evalCallProfileWithSdpGuideline(t,A.sdp,"local","receive"),!0),this.updateOngoingTimeoutId&&(clearTimeout(this.updateOngoingTimeoutId),delete this.updateOngoingTimeoutId),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh?(T.log("setLocalAndSendMessageUpdate : before setLocalDescription"),this.pc.setLocalDescription(A,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(T.log("setLocalAndSendMessageUpdate : before setLocalDescription - Promise version"),this.pc.setLocalDescription(A).then(this.callback(this,"onSetLocalDescriptionSuccess")).catch(this.callback(this,"onSetLocalDescriptionFailure"))),this.myWebRTC_Stack.send200Update(this.callId,this.callerId,this.calleeId,this.dest_roomId,this.callee?this.callerId:this.calleeId,A,this.data),this.asyncCallbacks&&"updateMediaType"===this.asyncCallbacks.type&&(T.debug("asyncCallbacks resolve"),this.asyncCallbacks.resolve(),this.asyncCallbacks.timeoutId&&(clearTimeout(this.asyncCallbacks.timeoutId),delete this.asyncCallbacks.timeoutId),delete this.asyncCallbacks)):T.log("setLocalAndSendMessageUpdate, pc no more exist")},this.onIceCandidate=function(A){try{T.debug("onIceCandidate :",JSON.stringify(A.candidate))}catch(v){T.error(v)}var t,l=0,s=0;t=this.callee?this.callerId:this.calleeId,null!==this.pc&&(T.debug("Ice Connection State is now : "+this.pc.iceConnectionState),T.debug("Ice Gathering State is now : "+this.pc.iceGatheringState)),A.candidate?(this.candidateNb+=1,!0===this.trickleIce?this.mediaRoutingMode===G.mediaRoutingModeEnum.hostOnly?-1!==(l=A.candidate.candidate.search("host"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,A.candidate.sdpMLineIndex,A.candidate.sdpMid,A.candidate.candidate,this.data,A.candidate,{volatile:!!this.restarted}):T.log("Media routing mode is hostOnly and not a HOST Candidate : ignoring message"):this.mediaRoutingMode===G.mediaRoutingModeEnum.stun?(l=A.candidate.candidate.search("host"),s=A.candidate.candidate.search("srflx"),-1!==l||-1!==s?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,A.candidate.sdpMLineIndex,A.candidate.sdpMid,A.candidate.candidate,this.data,A.candidate,{volatile:!!this.restarted}):T.log("Media routing mode is stun and not a HOST or SRFLX Candidate : ignoring message")):this.mediaRoutingMode===G.mediaRoutingModeEnum.stunOnly?-1!==(l=A.candidate.candidate.search("srflx"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,A.candidate.sdpMLineIndex,A.candidate.sdpMid,A.candidate.candidate,this.data,A.candidate,{volatile:!!this.restarted}):T.log("Media routing mode is stunOnly and not a SRFLX Candidate : ignoring message"):this.mediaRoutingMode===G.mediaRoutingModeEnum.turn?(T.log("Media routing mode is turn : all candidates are considered"),this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,A.candidate.sdpMLineIndex,A.candidate.sdpMid,A.candidate.candidate,this.data,A.candidate,{volatile:!!this.restarted})):this.mediaRoutingMode===G.mediaRoutingModeEnum.turnOnly&&(-1!==(l=A.candidate.candidate.search("relay"))?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,A.candidate.sdpMLineIndex,A.candidate.sdpMid,A.candidate.candidate,this.data,A.candidate,{volatile:!!this.restarted}):T.log("Media routing mode is TurnOnly and not a RELAY Candidate : ignoring message")):T.log("trickleIce is deactivated : candidates are not sended")):(T.info("End of candidates."),!1===this.trickleIce&&(T.log("trickleIce === false"),!0===this.callee?(0!==this.send200OKTrickleIceFalseTimeOutId&&(clearTimeout(this.send200OKTrickleIceFalseTimeOutId),this.send200OKTrickleIceFalseTimeOutId=0),!1===this.message200OKSended?this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,G.nickname,this.dest_roomId,this.pc.localDescription,this.data):T.log("200OK already sended")):null!==this.pc&&(0!==this.sendInviteTrickleIceFalseTimeOutId&&(clearTimeout(this.sendInviteTrickleIceFalseTimeOutId),this.sendInviteTrickleIceFalseTimeOutId=0),!1===this.inviteSended?(T.log("sendInvite on end of candidate"),this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,G.nickname,this.dest_roomId,this.dest_roomId,this.callType,{offer:this.pc.localDescription,data:this.data,stream:this.mcuRemoteStream,volatile:!!this.restarted}),this.inviteSended=!0):T.log("Invite already sended"))))},this.combineRemoteStreams=function(A,t,l,s){var v=A.getTracks(),r=l.getTracks();if(1===v.length&&1===r.length&&("audio"===v[0].kind&&"video"===r[0].kind||"video"===v[0].kind&&"audio"===r[0].kind)){T.debug("combineRemoteStreams");var g=new MediaStream;return g.addTrack(v[0]),g.addTrack(r[0]),"internal"===s&&(l.removeTrack(r[0]),this.onRemoteStreamRemoved({stream:l})),"internal"===t&&(A.removeTrack(v[0]),this.onRemoteStreamRemoved({stream:A})),this.onRemoteStreamAdded({stream:g}),!0}return!1},this.checkRemoteStreamExists=function(A,t){var l=!1,s=null,v=null,r=null,g=null,E=null;for(t&&Array.isArray(t)&&(g=t.slice(0)),s=this.remoteMediaStreams.length;--s>=0;){if(this.remoteMediaStreams[s].id===A){l=!0;break}if(g)for(r=(v=this.remoteMediaStreams[s].getTracks()).length;--r>=0;)(E=t.indexOf(v[r].id))>=0&&(g[E]=!0)}if(!l&&g){for(E=0,r=g.length;--r>=0;)!0===g[r]&&(E+=1);E===g.length&&(l=!0)}return l},this.onRemoteStreamAdded=function(A){var t,l=this,s=null,v=0;if(T.info("onRemoteStreamAdded",A),this.checkRemoteStreamExists(A.stream.id,A.stream.getTracks().map(function(K){return K.id})))T.debug("onRemoteStreamAdded: ignoring event; stream/track already known");else if(1!==this.remoteMediaStreams.length||!this.combineRemoteStreams(this.remoteMediaStreams[0],"internal",A.stream,"event")){T.debug("onRemoteStreamAdded adding",A.stream.id),this.remoteMediaStreams.push(A.stream),T.log("CallId is :"+this.callId),T.log("ClientId is :"+G.clientId),v=this.callee?this.callerId:this.calleeId,"undefined"==typeof apiRTC_React&&(!0===G.hideLocalVideoOnCall&&G.localVideo&&("Firefox"===d.Xh?""!==G.localVideo.mozSrcObject&&(G.localVideo.style.opacity=0):""!==G.localVideo.src&&(G.localVideo.style.opacity=0)),G.transitionToActive(),G.remoteVideo&&(G.remoteVideo.style.opacity=1),s=document.createElement("video"),G.remoteVideo&&(G.remoteVideo.appendChild(s),apiCC.attachMediaStream(s,A.stream),s.autoplay=!0,s.id="callId_"+this.callId+"-"+this.calleeId),s.oncanplay=G.myWebRTC_Event.createCanPlayRemoteVideoEvent(s.id,this.callType,v),G.remoteVideoDisplayManager()),this.sessionMCU&&"new"===this.sessionMCU.modeChangeKind&&G.processRemoteStreamAdded(this,A.stream),!0===this.screenSharing?this.callType="screenSharing":!0===this.audioOnly&&(this.callType="audio");var r,g=function(){T.debug("getCallIdAndUsername");var K="",L=l.callId,ne=apiCC.Session.getActiveSession();if(null!==ne){var ee=ne.getUserAgent();null!=ee&&(K=ee.username)}var ce={callId:L,username:K};return T.debug("getCallIdAndUsername result:",ce),ce},E=function(K){var L={eventType:"muteUnmuteEvent",muteType:"hardware",source:"local",mLine:K.kind};K.onmute=function(ne){T.debug(K.kind+" mute event");var ee=g();L.callId=ee.callId,L.username=ee.username,L.state="mute",apiCC.sendSentryEvent(L);var ce="";"audio"===K.kind?ce="audioIsSilentLocally":"video"===K.kind&&(ce="videoIsSilentLocally");var me={},Te={},ge=[];ge.push(ce),me.available=l.remoteCallProfile.audio,me.active=l.remoteCallProfile.audioActive,me.muted=l.isRemoteAudioMuted,me.silent=l.isRemoteAudioSilent,Te.available=l.remoteCallProfile.video,Te.active=l.remoteCallProfile.videoActive,Te.muted=l.isRemoteVideoMuted,Te.silent=l.isRemoteVideoSilent,l.myWebRTC_Event.createRemoteStreamUpdatedEvent(ge,me,Te,l.destCallType,l.callId,"adaptation")},K.onunmute=function(ne){T.debug(K.kind+" unmute event");var ee=g();L.callId=ee.callId,L.username=ee.username,L.state="unmute",apiCC.sendSentryEvent(L);var ce="";"audio"===K.kind?(l.isRemoteAudioSilent=!1,ce="audioIsSilentLocally"):"video"===K.kind&&(l.isRemoteVideoSilent=!1,ce="videoIsSilentLocally");var me={},Te={},ge=[];ge.push(ce),me.available=l.remoteCallProfile.audio,me.active=l.remoteCallProfile.audioActive,me.muted=l.isRemoteAudioMuted,me.silent=l.isRemoteAudioSilent,Te.available=l.remoteCallProfile.video,Te.active=l.remoteCallProfile.videoActive,Te.muted=l.isRemoteVideoMuted,Te.silent=l.isRemoteVideoSilent,l.myWebRTC_Event.createRemoteStreamUpdatedEvent(ge,me,Te,l.destCallType,l.callId,"adaptation")}},te=q(A.stream.getVideoTracks());try{for(te.s();!(r=te.n()).done;){var ae=r.value;E(ae),this.isRemoteVideoSilent=ae.muted}}catch(K){te.e(K)}finally{te.f()}var Re,Ce=q(A.stream.getAudioTracks());try{for(Ce.s();!(Re=Ce.n()).done;){var re=Re.value;E(re),this.isRemoteAudioSilent=re.muted}}catch(K){Ce.e(K)}finally{Ce.f()}t={available:this.remoteCallProfile.audio,active:this.remoteCallProfile.audioActive,muted:this.isRemoteAudioMuted,silent:this.isRemoteAudioSilent},s={available:this.remoteCallProfile.video,active:this.remoteCallProfile.videoActive,muted:this.isRemoteVideoMuted,silent:this.isRemoteVideoSilent},null!==this.data?void 0!==this.data.mesh?G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.stream,this.remoteId,this.destCallType,t,s):"publish"===this.data.type&&"passive"!==this.data.mode?T.warn("Filtering Remote stream added event (behavior on Chrome 44), no remote stream on publish calls"):!0===this.data.subscribeOrder&&void 0!==this.data.pubCallId?(T.debug("substitute callId: "+this.callId+" -> "+this.data.pubCallId),G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.data.pubCallId,A.stream,this.remoteId,this.destCallType,t,s)):G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.stream,this.remoteId,this.destCallType,t,s):G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.stream,this.remoteId,this.destCallType,t,s)}},this.onRemoteTrackAdded=function(A){T.info("onRemoteTrackAdded",A);var t,l=null,s=0;if(void 0!==A.streams[0]&&void 0!==A.track){if(this.checkRemoteStreamExists(A.streams[0].id,[A.track.id]))T.debug("onRemoteTrackAdded: ignoring event; stream/track already known");else if(1!==this.remoteMediaStreams.length||!this.combineRemoteStreams(this.remoteMediaStreams[0],"internal",A.streams[0],"event")){if(this.belongsToRoom()){if("audio"===this.callType&&"audio"!==A.track.kind||"videoOnly"===this.callType&&"video"!==A.track.kind||"media"===this.callType&&"video"!==A.track.kind||"screenSharing"===this.callType&&"video"!==A.track.kind||"screenSharingWithAudio"===this.callType&&"video"!==A.track.kind)return void T.debug("onRemoteTrackAdded: ignoring event; callType: "+this.callType+", event.track.kind: "+A.track.kind)}else if("audio"===this.destCallType&&"audio"!==A.track.kind||"videoOnly"===this.destCallType&&"video"!==A.track.kind||"media"===this.destCallType&&"video"!==A.track.kind||"screenSharing"===this.destCallType&&"video"!==A.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"!==A.track.kind)return T.debug("onRemoteTrackAdded: ignoring event; destCallType: "+this.destCallType+", event.track.kind: "+A.track.kind),void(2===this.remoteMediaStreams.length&&this.combineRemoveStreams(this.remoteMediaStreams[0],"internal",this.remoteMediaStreams[1],"internal"));T.debug("onRemoteTrackAdded adding; stream.id: "+A.streams[0].id),this.remoteMediaStreams.push(A.streams[0]),T.log("CallId is :"+this.callId),T.log("ClientId is :"+G.clientId),T.log("this.callType :"+this.callType),s=this.callee?this.callerId:this.calleeId,!0===G.hideLocalVideoOnCall&&G.localVideo&&("Firefox"===d.Xh?""!==G.localVideo.mozSrcObject&&(G.localVideo.style.opacity=0):""!==G.localVideo.src&&(G.localVideo.style.opacity=0)),G.transitionToActive(),G.remoteVideo&&(G.remoteVideo.style.opacity=1),l=document.createElement("video"),G.remoteVideo&&(G.remoteVideo.appendChild(l),apiCC.attachMediaStream(l,A.streams[0]),l.autoplay=!0,l.id="callId_"+this.callId+"-"+this.calleeId),!0===this.screenSharing?this.callType="screenSharing":!0===this.audioOnly&&(this.callType="audio"),l.oncanplay=G.myWebRTC_Event.createCanPlayRemoteVideoEvent(l.id,this.callType,s),G.remoteVideoDisplayManager(),this.sessionMCU&&"new"===this.sessionMCU.modeChangeKind&&G.processRemoteStreamAdded(this,A.streams[0]),A.streams[0].onaddtrack=function(v){T.debug("onRemoteTrackAdded ontrack.onaddtrack",v)},A.streams[0].onremovetrack=function(v){var r=null;if(T.debug("onRemoteTrackAdded ontrack.onremovetrack",v),this.updateOngoingTimeoutId)return T.debug("onRemoteTrackAdded onremovetrack: update ongoing"),void T.debug("onRemoteTrackAdded onremovetrack: ignoring event",v.track.kind);if("audio"===this.callType&&"audio"!==v.track.kind||"videoOnly"===this.callType&&"video"!==v.track.kind||"media"===this.callType&&"video"!==v.track.kind||"screenSharing"===this.callType&&"video"!==v.track.kind||"screenSharingWithAudio"===this.callType&&"video"!==v.track.kind)T.debug("onRemoteTrackAdded onremovetrack: ignoring event",v.track.kind);else if(v.target instanceof MediaStream){for(r=this.remoteMediaStreams.length;--r>=0;)if(this.remoteMediaStreams[r].id===v.target.id){T.debug("onRemoteTrackAdded onremovetrack removing",v.target.id),this.remoteMediaStreams.splice(r,1);break}G.myWebRTC_Event.createRemoteStreamRemovedEvent(this.callType,this.callId,v.target,this.remoteId,this.destCallType)}else T.debug("onRemoteTrackAdded onremovetrack: ignoring event target not MediaStream")}.bind(this),t={available:this.remoteCallProfile.audio,active:this.remoteCallProfile.audioActive,muted:this.isRemoteAudioMuted,silent:this.isRemoteAudioSilent},l={available:this.remoteCallProfile.video,active:this.remoteCallProfile.videoActive,muted:this.isRemoteVideoMuted,silent:this.isRemoteVideoSilent},null!==this.data?void 0!==this.data.mesh?("audio"===this.callType&&"audio"===A.track.kind||"videoOnly"===this.callType&&"video"===A.track.kind||"media"===this.callType&&"video"===A.track.kind||"screenSharing"===this.callType&&"video"===A.track.kind||"screenSharingWithAudio"===this.callType&&"video"===A.track.kind)&&G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.streams[0],this.remoteId,this.destCallType,t,l):"publish"===this.data.type&&"passive"!==this.data.mode?T.warn("Filtering Remote stream added event (behavior on Chrome 44), no remote stream on publish calls"):this.belongsToRoom()?("audio"===this.callType&&"audio"===A.track.kind||"videoOnly"===this.callType&&"video"===A.track.kind||"media"===this.callType&&"video"===A.track.kind||"screenSharing"===this.callType&&"video"===A.track.kind||"screenSharingWithAudio"===this.callType&&"video"===A.track.kind)&&(!0===this.data.subscribeOrder&&void 0!==this.data.pubCallId?(T.debug("substitute callId: "+this.callId+" -> "+this.data.pubCallId),G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.data.pubCallId,A.streams[0],this.remoteId,this.destCallType,t,l)):G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.streams[0],this.remoteId,this.destCallType,t,l)):("audio"===this.destCallType&&"audio"===A.track.kind||"videoOnly"===this.destCallType&&"video"===A.track.kind||"media"===this.destCallType&&"video"===A.track.kind||"screenSharing"===this.destCallType&&"video"===A.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"===A.track.kind)&&G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.streams[0],this.remoteId,this.destCallType,t,l):this.belongsToRoom()?("audio"===this.callType&&"audio"===A.track.kind||"videoOnly"===this.callType&&"video"===A.track.kind||"media"===this.callType&&"video"===A.track.kind||"screenSharing"===this.callType&&"video"===A.track.kind||"screenSharingWithAudio"===this.callType&&"video"===A.track.kind)&&G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.streams[0],this.remoteId,this.destCallType,t,l):("audio"===this.destCallType&&"audio"===A.track.kind||"videoOnly"===this.destCallType&&"video"===A.track.kind||"media"===this.destCallType&&"video"===A.track.kind||"screenSharing"===this.destCallType&&"video"===A.track.kind||"screenSharingWithAudio"===this.destCallType&&"video"===A.track.kind)&&G.myWebRTC_Event.createRemoteStreamAddedEvent(this.callType,this.callId,A.streams[0],this.remoteId,this.destCallType,t,l)}}else T.debug("onRemoteTrackAdded: ignoring event; event data are not correct")},this.onRemoteStreamRemoved=function(A){var t=null;for(T.info("onRemoteStreamRemoved",A),t=this.remoteMediaStreams.length;--t>=0;)if(this.remoteMediaStreams[t].id===A.stream.id){T.debug("onRemoteStreamRemoved removing",A.stream.id),this.remoteMediaStreams.splice(t,1);break}G.myWebRTC_Event.createRemoteStreamRemovedEvent(this.callType,this.callId,A.stream,this.remoteId,this.destCallType),A=null},this.onNegotiationNeeded=function(A){T.debug("onNegotiationNeeded",A),A=null,this.addingDataChannelOnCallOngoing&&(this.updateMediaWithRetryManagement(!1),this.addingDataChannelOnCallOngoing=!1)},this.onSignalingStateChange=function(A){T.debug("onSignalingStateChange",A),A=null},this.onCallDisconnection=function(){T.info("onCallDisconnection; callId: "+this.callId);var A=new Date;T.debug("date:",A),0!==this.disconnectionWarningInterval&&(T.debug("date:",A),T.debug("clearing disconnectionWarningInterval"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0),0!==this.disconnectionWarningTimeout&&(T.debug("date:",A),T.debug("clearing disconnectionWarningTimeout"),clearTimeout(this.disconnectionWarningTimeout),this.disconnectionWarningTimeout=0),this.belongsToRoom()?G.onHangup(this.callId,"disconnected"):G.onHangup(this.callId,"Ice_disconnected")},this.sendDisconnectionWarning=function(){T.log("sendDisconnectionWarning()");var A=null,t=null;if(this.callControl&&(A=this.callControl.roomName,t=this.callControl.type),this.disconnectionWarningCount++,Z.createEvent({eventType:"disconnectionWarning",callId:this.callId,remoteId:this.remoteId,tries:this.disconnectionWarningCount,roomName:A,settingUpType:t}),(this.disconnectionWarningCount-1)*this.disconnectionWarningDelay>=this.disconnectionTimer&&0!==this.disconnectionWarningInterval){var l=Date();T.debug("date :"+l),T.debug("clearing disconnectionWarningInterval : no more warnings"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0}},this.createIceErrorDescriptor=function(A,t){var l={};return"disconnected"===A?l.iceState="disconnected":"failed"===A?(l.iceState="failed",!0===t&&(l.previousIceState="disconnected")):l.iceState="unknown",l.callType=this.callType,this.belongsToRoom()?(l.context="conf",this.data.mesh?(l.mode="mesh",(this.data.mesh.callerCompositeUserId?this.data.mesh.callerCompositeUserId===G.compositeClientId:this.data.mesh.callerId===G.clientId)?(l.type="subscribe",l.clientId=this.data.mesh.callerId,l.remoteId=this.data.mesh.calleeId):(this.data.mesh.calleeCompositeUserId?this.data.mesh.calleeCompositeUserId===G.compositeClientId:this.data.mesh.calleeId===G.clientId)?(l.type="publish",l.clientId=this.data.mesh.calleeId,l.remoteId=this.data.mesh.callerId):l.type="unknown",l.mesh=this.data.mesh):(l.mode="sfu",l.type="publish"===this.settingUpType||"shareScreen"===this.settingUpType?"publish":"subscribe"===this.settingUpType?"subscribe":"unknown",this.callee?(l.clientId=this.calleeId,l.remoteId=this.callerId):(l.clientId=this.callerId,l.remoteId=this.calleeId)),this.mcuRemoteStream&&(l.stream=this.mcuRemoteStream)):(l.context="call",l.mode="p2p",this.callerId===G.clientId?(l.clientId=this.callerId,l.remoteId=this.calleeId):this.calleeId===G.clientId&&(l.clientId=this.calleeId,l.remoteId=this.callerId)),l},this.onIceConnectionStateChange=function(A){T.debug("onIceConnectionStateChange: ",A),A=null;var t=0,l=null,s=null,v=null;null!==this.pc?(T.info("Ice Connection State is now : "+this.pc.iceConnectionState),this.iceState=this.pc.iceConnectionState,"connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState||"checking"===this.pc.iceConnectionState?(T.debug("iceConnectionState === connected or completed or checking"),T.debug("this.disconnectionTimeoutId :"+this.disconnectionTimeoutId),0!==this.disconnectionTimeoutId&&(t=Date(),T.debug("date:",t),T.debug("clearing disconnectionTimeout"),clearTimeout(this.disconnectionTimeoutId),this.disconnectionTimeoutId=0),0!==this.disconnectionWarningInterval&&(t=Date(),T.debug("date:",t),T.debug("clearing disconnectionWarningInterval"),clearInterval(this.disconnectionWarningInterval),this.disconnectionWarningInterval=0),"checking"!==this.pc.iceConnectionState&&(this.checkCandidateTypesTimeoutId=setTimeout(this.callback(this,"checkCandidateTypes"),this.checkCandidateTypesTimer),this.checkCandidateTypesTimeoutTable.push(this.checkCandidateTypesTimeoutId))):"disconnected"===this.pc.iceConnectionState?(this.callControl&&(l=this.callControl.roomName,s=this.callControl.type),"conf"===(v=this.createIceErrorDescriptor("disconnected")).context&&this.myWebRTC_Stack.sendInfo("iceError",{clientId:G.clientId,callId:this.callId,roomId:this.sessionMCU.roomName,pubSub:G.MCUClient.pubConnector,descriptor:v}),T.warn("disconnection detected"),Z.createErrorEvent("iceDisconnection detected","ICE_CONNECTION_STATE_DISCONNECTED",this.callId,l,s,v),t=new Date,T.debug("date:",t),this.disconnectionTimeoutId=setTimeout(this.callback(this,"onCallDisconnection"),this.disconnectionTimer),this.disconnectionWarningCount=0,this.disconnectionWarningTimeout=setTimeout(this.callback(this,"sendDisconnectionWarning"),2e3),this.disconnectionWarningInterval=setInterval(this.callback(this,"sendDisconnectionWarning"),this.disconnectionWarningDelay)):"failed"===this.pc.iceConnectionState&&(this.callControl&&(l=this.callControl.roomName,s=this.callControl.type),"conf"===(v=this.createIceErrorDescriptor("failed",0!==this.disconnectionTimeoutId)).context&&this.myWebRTC_Stack.sendInfo("iceError",{clientId:G.clientId,callId:this.callId,roomId:this.sessionMCU.roomName,pubSub:G.MCUClient.pubConnector,descriptor:v}),T.warn("iceConnection failed detected"),Z.createErrorEvent("iceConnection failed detected","ICE_CONNECTION_STATE_FAILED",this.callId,l,s,v),0!==this.disconnectionTimeoutId?this.belongsToRoom()&&(clearTimeout(this.disconnectionTimeoutId),this.disconnectionTimeoutId=0,G.onHangup(this.callId,"disconnected")):this.belongsToRoom()&&(0,h.ki)(this.callControl,["autoRestart","counter"],"number")&&this.callControl.autoRestart.counter>0?G.onHangup(this.callId,"disconnected"):(T.warn("Removing call with callId: "+this.callId),G.removeCallFromTableWithCallIdAndSendBye(this.callId,"Ice_failed")))):T.log("Ice Connection State change with pc is null")},this.callback=function(A,t){return this.closureHandler=function(l,s){return A[t](l,s)},this.closureHandler},this.onSelectedCandidate=function(A){if(null==this.selectedCandidate||this.selectedCandidate.LocalCandidateType!==A.LocalCandidateType||this.selectedCandidate.RemoteCandidateType!==A.RemoteCandidateType||this.selectedCandidate.LocalAddress!==A.LocalAddress||this.selectedCandidate.RemoteAddress!==A.RemoteAddress||this.selectedCandidate.TransportType!==A.TransportType||this.selectedCandidate.LocalTransportType!==A.LocalTransportType){T.debug("WebRTC_Call::onSelectedCandidate() :",A),this.selectedCandidate=A,this.callControl&&this.callControl.autoRestart&&(T.debug("selectedCandidate, this.callControl.autoRestart.counter:",this.callControl.autoRestart.counter),T.debug("selectedCandidate, this.callControl.autoRestart.callIdWhenStartingTimer:",this.callControl.autoRestart.callIdWhenStartingTimer),this.callControl.autoRestart.counter&&(T.debug("Reinit of autoRestart.counter"),this.callControl.autoRestart.counter=0,void 0!==this.callControl.autoRestart.callIdWhenStartingTimer&&G.stopMaxCallRetriesTimer(this.callControl.autoRestart.callIdWhenStartingTimer))),this.myWebRTC_Event.createSelectedICECandidateEvent(this.callId,A.LocalCandidateType,A.RemoteCandidateType,A.LocalAddress,A.RemoteAddress,A.TransportType,A.LocalTransportType);var t=A;t.callId=this.callId,t.clientId=G.clientId,t.roomId=this.dest_roomId,void 0!==this.data.pubSub&&(t.pubSub=this.data.pubSub),void 0!==this.data.confId&&(t.confId=this.data.confId),void 0!==this.data.mesh&&(t.mesh=this.data.mesh),void 0!==this.data.instanceId&&(t.instanceId=this.data.instanceId),this.myWebRTC_Stack.sendInfo("callSelectedCandidate",t)}else T.debug("filtering duplicate candidate")},this.checkCandidateTypes=function(){T.debug("WebRTC_Call::checkCandidatesTypes()");var A=this,t={LocalCandidateType:"unknow",RemoteCandidateType:"unknow",LocalAddress:"unknow",RemoteAddress:"unknow",TransportType:"unknow",LocalTransportType:"unknow"},l=["googLocalAddress","googLocalCandidateType","googRemoteAddress","googRemoteCandidateType","googTransportType"];null===this.pc?(T.warn("Peer connection is null : no candidates"),A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t)):"undefined"!=typeof apiRTC_React?(T.warn("apiRTC_React : no info on candidates"),A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t)):"chrome"===h.wL.type?(T.debug("WebRTC_Call::checkCandidatesTypes() chrome"),this.pc.getStats(function(s){var v=s.result().filter(function(r){return 0===r.id.indexOf("Conn-")&&"true"===r.stat("googActiveConnection")})[0];v?(l.forEach(function(r){t[r.replace("goog","")]=v.stat(r)}),A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t)):(A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t))})):"firefox"===h.wL.type?(T.debug("WebRTC_Call::checkCandidatesTypes() firefox"),this.pc.getStats(null).then(function(s){var v=null;if(s.forEach(function(E){!0===E.selected&&(null!==v&&T.warn("multiple selected candidate-pairs"),v=E)}),null!==v){var r=s.get(v.localCandidateId),g=s.get(v.remoteCandidateId);t.LocalCandidateType=r.candidateType,t.RemoteCandidateType=g.candidateType,t.LocalAddress=r.address&&r.port?r.address+":"+r.port:r.ipAddress+":"+r.portNumber,t.RemoteAddress=g.address&&g.port?g.address+":"+g.port:g.ipAddress+":"+g.portNumber,t.TransportType=r.transport,t.LocalTransportType=r.mozLocalTransport,A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t)}}).catch(function(s){T.warn("failed to get stats",s)})):(T.debug("checkCandidateTypes not Chrome or Firefox"),A.myWebRTC_Event.createICECandidateTypeUpdateEvent(A.callId,t.LocalCandidateType,t.RemoteCandidateType),A.onSelectedCandidate(t))},this.belongsToRoom=function(){return!!(0,h.ki)(this.sessionMCU,"roomName","string")&&((0,h.ki)(this.data,"MCUType","string")&&("MCU-Caller"===this.data.MCUType||"MCU-Callee"===this.data.MCUType)&&(0,h.ki)(this.data,"confId","string")?this.data.confId===this.sessionMCU.roomName:this.dest_roomId===this.sessionMCU.roomName)},this.setLocalCallProfile=function(A){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=[],s={},v={},r=null,g=null,E="adaptation";!0!==this.dataCall&&"subscribe"!==this.settingUpType&&(this.localCallProfile.audioActive!==A.audioActive&&l.push("audioIsActive"),this.localCallProfile.videoActive!==A.videoActive&&l.push("videoIsActive"),this.localCallProfile=A,!0===this.screenSharing?!0===this.localCallProfile.audioActive&&!0===this.localCallProfile.videoActive?"screenSharingWithAudio"!==this.callType&&(this.callType="screenSharingWithAudio",l.push("callType")):!0===this.localCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",l.push("callType")):!0===this.localCallProfile.videoActive?"screenSharing"!==this.callType&&(this.callType="screenSharing",l.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",l.push("callType")):!0===this.localCallProfile.audioActive&&!0===this.localCallProfile.videoActive?"media"!==this.callType&&(this.callType="media",l.push("callType")):!0===this.localCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",l.push("callType")):!0===this.localCallProfile.videoActive?"videoOnly"!==this.callType&&(this.callType="videoOnly",l.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",l.push("callType")),!0===t&&l.length>0&&(s.available=this.localCallProfile.audio,s.active=this.localCallProfile.audioActive,s.muted=this.isLocalAudioMuted,s.silent=this.isRemoteAudioSilent,v.available=this.localCallProfile.video,v.active=this.localCallProfile.videoActive,v.muted=this.isLocalVideoMuted,v.silent=this.isRemoteVideoSilent,this.callConfiguration&&this.callConfiguration.userMediaStreamId&&(r=this.callConfiguration.userMediaStreamId,(g=apiCC.getUserMediaStream(r))&&(s.deviceLabel=g.audioDeviceLabel,v.deviceLabel=g.videoDeviceLabel)),this.updateCause&&(E=this.updateCause),this.myWebRTC_Event.createLocalStreamUpdatedEvent(l,s,v,!0,this.callType,this.callId,this.callLocalStream,r,E)))},this.setRemoteCallProfile=function(A){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=[],s={},v={},r="adaptation";!0!==this.dataCall&&(this.remoteCallProfile.audioActive!==A.audioActive&&l.push("audioIsActive"),this.remoteCallProfile.videoActive!==A.videoActive&&l.push("videoIsActive"),this.remoteCallProfile=A,"subscribe"===this.settingUpType?(!0===this.screenSharing?!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"screenSharingWithAudio"!==this.callType&&(this.callType="screenSharingWithAudio",l.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",l.push("callType")):!0===this.remoteCallProfile.videoActive?"screenSharing"!==this.callType&&(this.callType="screenSharing",l.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",l.push("callType")):!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"media"!==this.callType&&(this.callType="media",l.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.callType&&(this.callType="audio",l.push("callType")):!0===this.remoteCallProfile.videoActive?"videoOnly"!==this.callType&&(this.callType="videoOnly",l.push("callType")):"inactive"!==this.callType&&(this.callType="inactive",l.push("callType")),!0===t&&l.length>0&&(s.available=this.remoteCallProfile.audio,s.active=this.remoteCallProfile.audioActive,s.muted=this.isRemoteAudioMuted,s.silent=this.isRemoteAudioSilent,v.available=this.remoteCallProfile.video,v.active=this.remoteCallProfile.videoActive,v.muted=this.isRemoteVideoMuted,v.silent=this.isRemoteVideoSilent,this.updateCause&&(r=this.updateCause),this.myWebRTC_Event.createRemoteStreamUpdatedEvent(l,s,v,this.callType,this.callId,r))):(!0===this.screenSharing?!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"screenSharingWithAudio"!==this.destCallType&&(this.destCallType="screenSharingWithAudio",l.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.destCallType&&(this.destCallType="audio",l.push("callType")):!0===this.remoteCallProfile.videoActive?"screenSharing"!==this.destCallType&&(this.destCallType="screenSharing",l.push("callType")):"inactive"!==this.destCallType&&(this.destCallType="inactive",l.push("callType")):"publish"!==this.settingUpType&&"shareScreen"!==this.settingUpType||(!0===this.remoteCallProfile.audioActive&&!0===this.remoteCallProfile.videoActive?"media"!==this.destCallType&&(this.destCallType="media",l.push("callType")):!0===this.remoteCallProfile.audioActive?"audio"!==this.destCallType&&(this.destCallType="audio",l.push("callType")):!0===this.remoteCallProfile.videoActive?"videoOnly"!==this.destCallType&&(this.destCallType="videoOnly",l.push("callType")):"inactive"!==this.destCallType&&(this.destCallType="inactive",l.push("callType"))),!0===t&&l.length>0&&(s.available=this.remoteCallProfile.audio,s.active=this.remoteCallProfile.audioActive,s.muted=this.isRemoteAudioMuted,s.silent=this.isRemoteAudioSilent,v.available=this.remoteCallProfile.video,v.active=this.remoteCallProfile.videoActive,v.muted=this.isRemoteVideoMuted,v.silent=this.isRemoteVideoSilent,this.updateCause&&(r=this.updateCause),this.myWebRTC_Event.createRemoteStreamUpdatedEvent(l,s,v,this.destCallType,this.callId,r))))},this.setMediaConstraintsToSendOnlyOffer=function(){this.mediaConstraints="firefox"===h.wL.type?d.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}:"edge"===h.wL.type?{offerToReceiveAudio:0,offerToReceiveVideo:0}:"chrome"===h.wL.type&&h.wL.version<55?{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}:{offerToReceiveAudio:!1,offerToReceiveVideo:!1,mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},this.mediaConstraintsAudioOnly=this.mediaConstraints},this.applyOutgoingBitrate=function(A){var t=this;T.debug("applyOutgoingBitrate",this.callId,A);for(var l=null,s=0;s<this.rtpSenders.video.length;s+=1)if(this.rtpSenders.video[s].track){l=this.rtpSenders.video[s];break}if(l)if("function"==typeof l.getParameters&&"function"==typeof l.setParameters){var v=l.getParameters();if(Object.prototype.hasOwnProperty.call(v,"encodings")){if(1!==v.encodings.length)return void T.debug("encodings cannot be changed",this.callId,v.encodings.length)}else v.encodings=[{}];if(null!==A&&"number"==typeof A){A<50&&(A=50);var r=1e3*A;if(v.encodings[0].maxBitrate===r)return;v.encodings[0].maxBitrate=r}else{if(!Object.prototype.hasOwnProperty.call(v.encodings[0],"maxBitrate"))return;delete v.encodings[0].maxBitrate}l.setParameters(v).catch(function(g){T.error("applyOutgoingBitrate - setParameters",t.callId,g)})}else T.warn("no such functions: getParameters/setParameters",this.callId);else T.warn("no such video rtpSender",this.callId)},this.configureSimulcastEncodings=function(A){var t=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(T.debug("configureSimulcastEncodings",this.callId,A,l.maxBitrate),"RID"===this.simulcast){for(var s=null,v=0;v<this.rtpSenders.video.length;v+=1)if(this.rtpSenders.video[v].track){s=this.rtpSenders.video[v];break}if(s)if("function"==typeof s.getParameters&&"function"==typeof s.setParameters){var r=s.getParameters();if(Object.prototype.hasOwnProperty.call(r,"encodings"))if(3===r.encodings.length){for(var g=null,E=null,te=null,ae=r.encodings.length;--ae>=0;){var Re=r.encodings[ae];g||"h"!==Re.rid?E||"m"!==Re.rid?te||"l"!==Re.rid||(te=Re):E=Re:g=Re}if(g&&Object.prototype.hasOwnProperty.call(g,"maxBitrate")&&E&&Object.prototype.hasOwnProperty.call(E,"maxBitrate")&&te&&Object.prototype.hasOwnProperty.call(te,"maxBitrate")){var Ce=!1,re=Math.floor(te.maxBitrate/1e3),K=!1,L=!1;if(g.active&&g.maxBitrate>1&&(re+=Math.floor(g.maxBitrate/1e3),K=!0),E.active&&E.maxBitrate>1&&(re+=Math.floor(E.maxBitrate/1e3),L=!0),T.debug("currentStatus",re,K,L),"changeMaxBitrate"===A){if(!(0,h.ki)(l,"maxBitrate","number"))return;var ne=l.maxBitrate;re<=ne?(L||re+this.callConfiguration.simulcast.encodings.medium.maxBitrate<=ne&&("chrome"===h.wL.type?E.active=!0:"firefox"===h.wL.type&&(E.maxBitrate=1e3*this.callConfiguration.simulcast.encodings.medium.maxBitrate),this.callConfiguration.simulcast.encodings.medium.active=!0,L=!0,re+=this.callConfiguration.simulcast.encodings.medium.maxBitrate,Ce=!0),K||re+this.callConfiguration.simulcast.encodings.high.maxBitrate<=ne&&("chrome"===h.wL.type?g.active=!0:"firefox"===h.wL.type&&(g.maxBitrate=1e3*this.callConfiguration.simulcast.encodings.high.maxBitrate),this.callConfiguration.simulcast.encodings.high.active=!0,K=!0,re+=this.callConfiguration.simulcast.encodings.high.maxBitrate,Ce=!0)):(K&&(K=!1,this.callConfiguration.simulcast.encodings.high.active=!1,re-=Math.floor(g.maxBitrate/1e3),"chrome"===h.wL.type?g.active=!1:"firefox"===h.wL.type&&(g.maxBitrate=1),Ce=!0),re>ne&&L&&(L=!1,this.callConfiguration.simulcast.encodings.medium.active=!1,re-=Math.floor(E.maxBitrate/1e3),"chrome"===h.wL.type?E.active=!1:"firefox"===h.wL.type&&(E.maxBitrate=1),Ce=!0))}else"disableEncoding"===A&&(K?(K=!1,this.callConfiguration.simulcast.encodings.high.active=!1,re-=Math.floor(g.maxBitrate/1e3),"chrome"===h.wL.type?g.active=!1:"firefox"===h.wL.type&&(g.maxBitrate=1),Ce=!0):L&&(L=!1,this.callConfiguration.simulcast.encodings.medium.active=!1,re-=Math.floor(E.maxBitrate/1e3),"chrome"===h.wL.type?E.active=!1:"firefox"===h.wL.type&&(E.maxBitrate=1),Ce=!0));T.debug("applyChanges",re,K,L,Ce),Ce&&(s.setParameters(r).catch(function(ee){T.error("configureEncodings - setParameters",t.callId,ee)}),this.myWebRTC_Stack.sendInfo("configureEncodings",{pubSub:G.MCUClient.pubConnector,clientId:G.clientId,roomId:this.sessionMCU.roomName,callId:this.callId,instanceId:this.instanceId,hint:"simulcast",encodings:this.callConfiguration.simulcast.encodings}))}else T.warn("cannot find h/m/l encodings",this.callId)}else T.warn("wrong encodings",this.callId,r.encodings.length);else T.warn("no encodings configured",this.callId)}else T.warn("no such functions: getParameters/setParameters",this.callId);else T.warn("no such video rtpSender",this.callId)}}},x=(e(4363),e(9653),function(G){this.disconnectionTimer=15e3,this.userMediaId=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),this.callType="media",this.audio=!1,this.video=!1,this.audioSdpDirection=null,this.videoSdpDirection=null,this.callConfiguration={},this.sessionMCU=null,this.myWebRTC_Stack=new P.S(G.socket),this.getUserMediaStream=function(){return this.callConfiguration&&this.callConfiguration.userMediaStreamId?apiCC.getUserMediaStream(this.callConfiguration.userMediaStreamId):null},this.releaseUserMediaStream=function(){if(this.callConfiguration&&this.callConfiguration.userMediaStreamId){var A=this.callConfiguration.userMediaStreamId;return delete this.callConfiguration.userMediaStreamId,apiCC.releaseUserMediaStream(A,this.userMediaId)}return!1},this.close=function(){(this.addAck||this.addTimeoutId)&&(delete this.addAck,clearTimeout(this.addTimeoutId),delete this.addTimeoutId)}});function Se(G){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(G)}function Ee(G,A){var t="undefined"!=typeof Symbol&&G[Symbol.iterator]||G["@@iterator"];if(!t){if(Array.isArray(G)||(t=function(E,te){if(E){if("string"==typeof E)return he(E,void 0);var ae=Object.prototype.toString.call(E).slice(8,-1);return"Object"===ae&&E.constructor&&(ae=E.constructor.name),"Map"===ae||"Set"===ae?Array.from(E):"Arguments"===ae||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ae)?he(E,void 0):void 0}}(G))||A&&G&&"number"==typeof G.length){t&&(G=t);var l=0,s=function(){};return{s,n:function(){return l>=G.length?{done:!0}:{done:!1,value:G[l++]}},e:function(E){throw E},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var v,r=!0,g=!1;return{s:function(){t=t.call(G)},n:function(){var E=t.next();return r=E.done,E},e:function(E){g=!0,v=E},f:function(){try{r||null==t.return||t.return()}finally{if(g)throw v}}}}function he(G,A){(null==A||A>G.length)&&(A=G.length);for(var t=0,l=new Array(A);t<A;t++)l[t]=G[t];return l}var ue=i.Y.get("ApiCCMCUClient"),ke=apiCC.myWebRTC_Event,ze=function(G,A){ue.debug("ApiCCMCUClient creation"),this.pubConnector="janusConnector",this.meshModeEnabled=!1,this.sessionMCUs=[],this.distantCalls=[],this.streamList=[],this.disputableStreamList=[],this.publishCallId=null,this.joinSessionReqs=[],this.transitionCount=0,this.browserCapabilities={updateStream:!0,mesh2janusTransition:!0,checkCallStatus:!0},this.receiveSessionId=function(t){ue.debug("receiveSessionId()"),ke.createMCUSessionCreationEvent(t.sessionId,t.token),this.publish(t.sessionId,t.token)},this.sendSessionInvitation=function(t,l,s){var r;ue.debug("sendSessionInvitation()"),null!=l?(void 0===s&&(s=0),r=JSON.stringify({type:"MCUSessionInvitation",srcId:A,destId:t,sessionId:l,groupChatId:s}),ue.log("C->S: "+r),apiCC.session.channel.socket.emit("MCUSessionInvitation",r)):ue.log("Session is null or undefined, MCU Session invitation is not sended")},this.sendSessionInvitationToGroupChat=function(t,l){if(ue.debug("sendSessionInvitationToGroupChat()"),null!=t)if(null!=l){var v;v=JSON.stringify({type:"MCUSessionInvitationToGroupChat",srcId:A,groupChatId:t,sessionId:l}),ue.log("C->S: "+v),apiCC.session.channel.socket.emit("MCUSessionInvitationToGroupChat",v)}else ue.log("Session is null or undefined, MCU Session invitation is not sended");else ue.log("groupChatId is null or undefined, MCU Session invitation is not sended")},this.receiveSessionInvitation=function(t){ue.debug("receiveSessionInvitation()"),ue.log("msg.sessionId :"+t.sessionId),ue.log("msg.token :"+t.token),ue.log("msg.groupChatId :"+t.groupChatId),ke.createReceiveMCUSessionInvitationEvent(t.sessionId,t.token,t.groupChatId,t.srcId)},this.acceptSessionInvitation=function(t,l){ue.debug("acceptSessionInvitation()"),ue.log("sessionId :"+t),ue.log("token :"+l),this.publish(t,l)},this.leaveSession=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ue.info("leaveSession()");var s=null,v=null,r=null;if(!(r=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0})))return new Error("leaveSession: session not set");!0!==l.noHangup&&(apiCC.session.apiCCWebRTCClient.webRTCClient.removeAllCallsFromRoom(r.roomName,"leaveSession"),this.meshOnHangup(null,null,{roomId:r.roomName}));var g=[];g.push(r.roomName),apiCC.session.leavePresenceGroup(g),apiCC.session.unsubscribePresenceGroup(g),s={type:"leaveSession",roomId:r.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},v=JSON.stringify(s),ue.log("C->S: "+v),apiCC.session.channel.socket.emit("leaveSession",v),ue.debug("leaveSession: distant call clean up");for(var E=this.distantCalls.length;--E>=0;)this.distantCalls[E].roomId===r.roomName&&(ue.debug("leaveSession: remove distant call descriptor",this.distantCalls[E]),this.distantCalls.splice(E,1));apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({multi:!0,roomName:r.roomName});for(var te=this.streamList.length;--te>=0;)this.streamList[te].roomId===r.roomName&&this.streamList.splice(te,1);return this.removeSessionMCU(r),"OK"},this.createJoinSessionMessage=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null;t||(s=l.hasOwnProperty("sessionMCU")?l.sessionMCU:this.getSessionMCU(null,{first:!0}))&&(t=s.roomName);var v=s&&"mesh"===s.roomMode||!0===this.meshModeEnabled||!0===l.meshModeEnabled,r=s&&!0===s.meshOnly||!0===l.meshOnlyEnabled,g={type:"joinSession",roomId:t,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector,meshModeEnabled:v,meshOnlyEnabled:r,videoBandwidthSettings:apiCC.session.apiCCWebRTCClient.webRTCClient.videoBandwidthSettings,browserInfo:{browserAbout:d.Xh+" "+d.dc,browserType:h.wL.type,browserVersion:h.wL.version,osName:d.BF,osVersion:d.MM,deviceType:d.vO}}};if(l.hasOwnProperty("transactionId")&&(g.transactionId=l.transactionId),l.hasOwnProperty("convId")?g.data.convId=l.convId:s&&s.hasOwnProperty("convId")&&(g.data.convId=s.convId),l.moderationEnabled&&(g.data.moderationEnabled=!0),l.moderator&&(g.data.moderator=!0),l.qualityAdaptationEnabled&&(g.data.qualityAdaptationEnabled=!0),Array.isArray(l.supportedVideoCodecs)){g.data.supportedVideoCodecs=[];var E,te=Ee(l.supportedVideoCodecs);try{for(te.s();!(E=te.n()).done;){var ae=E.value;g.data.supportedVideoCodecs.push("h264"===ae?{codec:"h264",profilelevelid:"42e01f"}:"string"==typeof ae?{codec:ae}:ae)}}catch(Re){te.e(Re)}finally{te.f()}}else"safari"===h.wL.type&&("Safari"===d.Xh&&d.dc<12.1||"Mobile Safari"===d.Xh&&d.dc<12.1)&&(g.data.supportedVideoCodecs=[{codec:"h264",profilelevelid:"42e01f"}]);return g.data.capabilities=this.browserCapabilities,g},this.createSessionDescriptor=function(t){var l={roomId:t.roomName};return t.convId&&(l.convId=t.convId),t.roomMode&&(l.roomMode=t.roomMode),t.modeChangeKind&&(l.modeChangeKind=t.modeChangeKind),l},this.joinSession=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.getSessionMCU(t))return ue.warn("joinSession: session already set"),new Error("joinSession: session already set");if(this.getJoinSessionReq(t))return ue.warn("joinSession: session already requested"),new Error("joinSession: session already requested");var s={};s.roomId=t,s.transactionId=apiCC.randomString(12),this.joinSessionReqs.push(s);var v=Object.assign({},l);v.transactionId=s.transactionId,ue.info("joinSession() on ApiRTC MCU with roomId:",t);var r=this.createJoinSessionMessage(t,v),g=JSON.stringify(r);return ue.log("C->S: "+g),apiCC.session.channel.socket.emit("joinSession",g),"OK"},this.joinSessionAnswer=function(t){if(ue.debug("joinSessionAnswer()"),this.getSessionMCU(t.roomName))ue.warn("joinSessionAnswer: session already set");else{var l=null;if(t.hasOwnProperty("transactionId")&&(l=this.getJoinSessionReq(null,{transactionId:t.transactionId})),l||(l=this.getJoinSessionReq(t.roomName)),l){this.removeJoinSessionReq(l);var s={};if(s.roomID=t.sessionId,s.roomName=t.roomName,t.hasOwnProperty("convId")&&(s.convId=t.convId),s.joinSessionAnswer={},(0,h.ki)(t,"data","object")?(!0===t.data.failed?(s.joinSessionAnswer.failed=!0,s.joinSessionAnswer.reason=t.data.reason):s.joinSessionAnswer.failed=!1,t.data.mode&&"string"==typeof t.data.mode&&(s.roomMode=t.data.mode,ue.debug("session joined with mode; roomMode: "+s.roomMode)),"mesh"===s.roomMode&&!0===t.data.meshOnly&&(s.meshOnly=!0,ue.debug("meshOnly"))):s.joinSessionAnswer.failed=!1,this.sessionMCUs.push(s),!s.joinSessionAnswer.failed){var v=[];v.push(t.roomName),apiCC.session.joinPresenceGroup(v),apiCC.session.subscribePresenceGroup(v)}ke.createJoinMCUSessionAnswerEvent(t.sessionId,t.token,t.groupChatId,t.initiator,s)}else ue.debug("joinSessionAnswer: no joinSession requested")}},this.changeSessionMode=function(t,l){var s=this.getSessionMCU(t.roomName);if(s)if("mesh"===s.roomMode){for(var v=0,r=G.userMediaTable.length;--r>=0;)if(G.userMediaTable[r].sessionMCU===s){ue.debug("changeSessionMode: userMedia",G.userMediaTable[r]),G.userMediaTable[r].distantCalls=[],v+=1;for(var g=this.distantCalls.length;--g>=0;)ue.debug("changeSessionMode: distantCall",this.distantCalls[g]),"mesh"===this.distantCalls[g].callMode&&this.distantCalls[g].callFeed.callId===G.userMediaTable[r].userMediaId&&(ue.debug("changeSessionMode: match"),G.userMediaTable[r].distantCalls.push(this.distantCalls[g]))}for(var E=0,te=G.callControlTable.length;--te>=0;)"subscribe"===G.callControlTable[te].type&&G.callControlTable[te].roomName===s.roomName&&(E+=1,G.callControlTable[te].autoRestart.force=!0);if(ke.createMCURoomModeChangedEvent(s.roomName,"mesh","sfu","ongoing"),0===v&&0===E)delete s.roomMode,ke.createMCURoomModeChangedEvent(s.roomName,"mesh","sfu","complete");else{s.modeChangeKind="old";var ae={};ae.roomID=t.roomName,ae.roomName=t.roomName,t.hasOwnProperty("convId")&&(ae.convId=t.convId),ae.joinSessionAnswer={failed:!1},ae.modeChangeKind="new",ae.transitionTimeoutId=setTimeout(function(Re,Ce){delete Ce.transitionTimeoutId,G.finalizeMeshToJanusTransition(Re,Ce,{force:!0})}.bind(this,s,ae),3e4),this.sessionMCUs.push(ae),this.transitionCount+=1}}else ue.warn("changeSessionMode: session not using mesh mode");else ue.warn("changeSessionMode: no session")},this.updateSessionAnswer=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ue.debug("updateSessionAnswer");var s=this.getSessionMCU(t.roomName);if(!s){if(!l.createSession)return void ue.warn("updateSessionAnswer: no such session",t.roomName);ue.debug("force session creation; roomName: "+t.roomName),(s={}).roomID=t.roomName,s.roomName=t.roomName,t.hasOwnProperty("convId")&&(s.convId=t.convId),s.joinSessionAnswer={failed:!1},this.sessionMCUs.push(s);for(var v=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length;--v>=0;){var r=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[v];!r.data||"MCU-Caller"!==r.data.MCUType&&"MCU-Callee"!==r.data.MCUType||r.data.confId!==s.roomName||(r.sessionMCU=s)}}var g=!1;if(t.data&&"mesh"===t.data.mode?(s.roomMode="mesh",!0===t.data.meshOnly&&(s.meshOnly=!0)):("mesh"===s.roomMode&&(g=!0),delete s.roomMode),"new"===s.modeChangeKind){ue.debug("transition already ongoing");var E=this.getSessionMCU(null,{callback:function(ne){return ne.roomName===s.roomName&&"old"===ne.modeChangeKind}});E&&G.finalizeMeshToJanusTransition(E,s,{force:!0})}else if(g){ue.debug("transition NOT ongoing but should be"),ke.createMCURoomModeChangedEvent(s.roomName,"mesh","sfu","ongoing"),s.modeChangeKind="old";var te={};te.roomID=s.roomID,te.roomName=s.roomName,s.hasOwnProperty("convId")&&(te.convId=s.convId),te.joinSessionAnswer={failed:!1},te.modeChangeKind="new",this.sessionMCUs.push(te),this.transitionCount+=1,G.finalizeMeshToJanusTransition(s,te,{force:!0})}if(l.updateCalls)if(ue.debug("update stream list (prune)"),this.updateStreamList(t,{prune:!0}),"mesh"===s.roomMode){ue.debug("restart publish/shareScreen calls");for(var ae=G.userMediaTable.slice(),Re=ae.length;--Re>=0;){var Ce=ae[Re];Ce.sessionMCU===s&&G.onHangup(Ce.userMediaId,"disconnected")}}else{ue.debug("restart publish/shareScreen calls with no PeerConnection");for(var re=G.callsTable.slice(),K=re.length;--K>=0;){var L=re[K];L.sessionMCU===s&&("publish"!==L.settingUpType&&"shareScreen"!==L.settingUpType||L.data&&L.data.mesh||L.pc||G.onHangup(L.callId,"disconnected"))}}},this.processCheckCallStatus=function(t){this.updateStreamList(t)},this.updateStreamList=function(t){for(var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=(0,h.ki)(t,"availableStreams","array")?t.availableStreams.slice():null,v=(0,h.ki)(t,"availableComposite","array")?t.availableComposite.slice():null,r=(0,h.ki)(t,"availableReplay","array")?t.availableReplay.slice():null,g=this.streamList.length;--g>=0;){var E=this.streamList[g];if("regular"===E.type){if(!s)continue;for(var te=s.length;--te>=0&&s[te].id!==E.streamInfo.id;);if(te>=0){(0,h.ki)(E,"clearDisputableEntry","function")&&E.clearDisputableEntry(),s.splice(te,1);continue}!0===l.prune?((0,h.ki)(E,"clearDisputableEntry","function")&&E.clearDisputableEntry(),apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:E.streamInfo}),ke.createMCURemovedStreamEvent(E.streamInfo.id),this.streamList.splice(g,1)):E.disputableTimeoutId||(E.disputableTimeoutId=setTimeout(Ve.bind(this,E.streamInfo.id),3e4),E.clearDisputableEntry=et.bind(this,E.streamInfo.id),this.disputableStreamList.push(E))}else if("composite"===E.type){if(!v)continue;for(var ae=v.length;--ae>=0&&v[ae].id!==E.streamInfo.id;);if(ae>=0){v.splice(ae,1);continue}apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:E.streamInfo}),ke.createMCURemovedStreamEvent(E.streamInfo.id),this.streamList.splice(g,1)}else if("replay"===E.type){if(!r)continue;for(var Re=r.length;--Re>=0&&r[Re].id!==E.streamInfo.id;);Re>=0&&r.splice(Re,1)}}if(s)for(var Ce=0;Ce<s.length;Ce+=1){var re=[];re.push(s[Ce]);var K=this.newAvailableStream(re,"regular");ke.createMCUAvailableStreamEvent(re,K)}if(v)for(var L=0;L<v.length;L+=1){var ne=[];ne.push(v[L]);var ee=this.newAvailableStream(ne,"composite");ke.createMCUAvailableCompositeEvent(ne,ee)}if(r)for(var ce=0;ce<r.length;ce+=1){var me=[];me.push(r[ce]);var Te=this.newAvailableReplay(me);ke.createMCUAvailableReplayEvent(me,Te)}},this.getStreamList=function(){return ue.debug("getStreamList :",this.streamList),this.streamList},this.getStreamFromList=function(t){var l;for(ue.debug("getStreamFromList() with Id :",t),ue.log("this.streamList :",this.streamList),l=0;l<this.streamList.length;l+=1){if(this.streamList[l].streamInfo.id===t)return ue.log("stream found",this.streamList[l].streamInfo),this.streamList[l].streamInfo;ue.log("not the same stream",t)}return null},this.getStreamIdOfUser=function(t){var l;for(ue.debug("getStreamIdOfUser() with Id :",t),ue.log("this.streamList :",this.streamList),l=0;l<this.streamList.length;l+=1)if("replay"!==this.streamList[l].type){if(this.streamList[l].userId===t)return ue.log("stream found",this.streamList[l].streamInfo),this.streamList[l].streamInfo.id;ue.log("not the same userId",t)}return null},this.getStreamOfUserCall=function(t,l){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=this.streamList.length,r=!1;for((0,h.ki)(s,"replay","boolean")&&!0===s.replay&&(r=!0);--v>=0;){if(!0===r){if("replay"!==this.streamList[v].type)continue}else if("replay"===this.streamList[v].type)continue;if(this.streamList[v].userId===t&&this.streamList[v].streamInfo.attributes.callId===l)return this.streamList[v].streamInfo}return null},this.newAvailableStream=function(t,l,s){ue.debug("newAvailableStream():",t);var v=!1,r=!1,g=this.getSessionMCU(t[0].room);if(g){t[0].attributes.callerId!==A&&(v=!0);for(var E=G.getCallControls(["publish","shareScreen"],{addUserMedia:!0}),te=0;te<t.length;te+=1){for(var ae=this.streamList.length;--ae>=0&&("regular"!==this.streamList[ae].type||t[te].id!==this.streamList[ae].streamInfo.id););ae>=0?(r=!0,(0,h.ki)(this.streamList[ae],"clearDisputableEntry","function")?this.streamList[ae].clearDisputableEntry():ue.debug("clearDisputableEntry is not set")):ue.debug("streamList is empty"),v=!Object.prototype.hasOwnProperty.call(E,t[te].attributes.callId);var Re={type:l,userId:t[te].attributes.callerId,roomId:g.roomName,isRemoteStream:v,streamInfo:t[te]};if(!0===r?this.streamList[ae]=Re:this.streamList.push(Re),ue.log("this.streamList :",this.streamList),!0!==v&&"mesh"===g.roomMode){var Ce=G.findUserMediaById(t[te].attributes.callId);Ce&&!0===Ce.addAck&&(delete Ce.addAck,clearTimeout(Ce.addTimeoutId),delete Ce.addTimeoutId,ke.createCallEstablishedEvent(g.roomName,Ce.callType,Ce.userMediaId,"none"))}var re=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:t[te]});if(re&&!re.autoRestart.pending){ue.info("[newAvailableStream] auto subscribing to stream");var K=!!re.autoRestart.force;delete re.autoRestart.force;var L=re.callId,ne=this.subscribeToStreams([t[te]],re.mediaType,re.data,re.callConfiguration,{noStreamCheck:!0,force:K});L&&ne[0]&&ke.createCallRestartingEvent(re.callType,re.audioOnly,L,ne[0],"subscribe",apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,re.roomName,re.roomName,t[te].id)}!0!==r&&(0,h.Ym)(s,"function")&&s(v,t[te],l)}return v}ue.debug("newAvailableStream() but client is not in session")},this.updateAvailableStream=function(t,l,s){ue.info("updateAvailableStream():",t);var v=!1;if(this.getSessionMCU(t[0].room)){t[0].attributes.callerId!==A&&(v=!0);for(var r=0;r<t.length;r+=1)for(var g=this.streamList.length;--g>=0;)if(this.streamList[g].streamInfo.id===t[r].id){for(var E=[],te=0,ae=["audio","audioMuted","video","videoMuted"];te<ae.length;te++){var Re=ae[te];this.streamList[g].streamInfo[Re]!==t[r][Re]&&(this.streamList[g].streamInfo[Re]=t[r][Re],E.push(Re))}this.streamList[g].streamInfo.attributes.callType!==t[r].attributes.callType&&(this.streamList[g].streamInfo.attributes.callType=t[r].attributes.callType,E.push("callType")),this.streamList[g].streamInfo.attributes.descriptor&&t[r].attributes.descriptor&&this.streamList[g].streamInfo.attributes.descriptor.priority!==t[r].attributes.descriptor.priority&&(this.streamList[g].streamInfo.attributes.descriptor.priority=t[r].attributes.descriptor.priority,E.push("priority")),E.length>0&&(0,h.Ym)(s,"function")&&s(v,t[r],l,E);break}return v}ue.log("updateAvailableStream() but client is not in session")},this.newAvailableReplay=function(t){ue.info("newAvailableReplay() :",t);var l=!1,s=this.getSessionMCU(t[0].room);if(s){t[0].attributes.callerId!==A&&(l=!0);for(var v=0;v<t.length;v+=1)this.streamList.push({type:"replay",userId:t[v].attributes.callerId,roomId:s.roomName,isRemoteStream:l,streamInfo:t[v]});return l}ue.log("newAvailableReplay() but client is not in session")},this.subscribeToStreams=function(t,l,s,v){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};ue.info("subscribeToStreams():",t);var g,E,te=[],ae=null,Re=null,Ce=null;for(Ce in t){if(g=t[Ce],null===apiCC.session||void 0===apiCC.session)return ue.debug("no session, leaving subscribeToStreams()"),te;if(null!==(ae=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithStreamId(g.id,{ignoreModeChangeKindOld:!0}))){if(ue.debug("call already exists"),!0!==r.force){te[Ce]=ae.callId;continue}ue.debug("Force is true")}else ue.debug("call does not exist");for(E=this.streamList.length;--E>=0&&this.streamList[E].streamInfo.id!==g.id;);if(E>=0){if(ue.debug("stream exists"),this.streamList[E].disputableTimeoutId){ue.debug("stream temporarily not available"),te[Ce]=null,!0===r.autoSub&&((Re=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:g}))||apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"subscribe",roomName:g.room,mediaType:l,callConfiguration:v,data:s,stream:g}));continue}}else if(ue.debug("stream does not exist"),!0!==r.noStreamCheck){te[Ce]=null,ke.createErrorEvent("stream not available","STREAM_NOT_AVAILABLE",null,g.room,null,{stream:g});continue}ue.info("stream:",g);var re=this.getSessionMCU(g.room);re&&((Re=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallControl({type:"subscribe",stream:g}))||(Re=apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"subscribe",roomName:re.roomName,mediaType:l,callConfiguration:v,data:s,stream:g})),"COMPOSITE"!==g.attributes.callType&&"janusConnector"===this.pubConnector?(void 0===s&&(s={}),s.mesh&&delete s.mesh,(0,h.Ym)(v,"qos","object")?(s.qos={},s.qos.videoForbidInactive=!1!==v.qos.videoForbidInactive):(s.qos={},s.qos.videoForbidInactive=!0),(0,h.Ym)(v,"simulcast","object")&&(s.simulcast={},v.simulcast.streamQuality&&("high"===v.simulcast.streamQuality?s.simulcast.substream=2:"medium"===v.simulcast.streamQuality?s.simulcast.substream=1:"low"===v.simulcast.streamQuality&&(s.simulcast.substream=0)),v.simulcast.streamFrameRate&&("high"===v.simulcast.streamFrameRate?s.simulcast.temporal=2:"medium"===v.simulcast.streamFrameRate?s.simulcast.temporal=1:"low"===v.simulcast.streamFrameRate&&(s.simulcast.temporal=0))),(ae=new le(apiCC.session.apiCCWebRTCClient.webRTCClient)).instanceId=apiCC.generateInstanceId(),ae.callControl=Re,(0,h.ki)(ae.callControl.autoRestart,"counter","number")?(ae.callControl.autoRestart.counter+=1,ae.restarted=!0):ae.callControl.autoRestart.counter=0,ae.settingUpType="subscribe",ae.setupTimeoutId=setTimeout(function(){ue.warn("invite + SDP offer not received -> restart call"),G.onHangup(ae.callId,"disconnected")},15e3),null!=v&&null!=v.turnServerAddress&&ae.setCallTurnServer(v.turnServerAddress),ae.generateCallId(),Re.callId=ae.callId,ae.callerId=re.roomName,ae.calleeId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,ae.callee=!0,ae.mcuRemoteStream=g,ae.dest_roomId=re.roomName,ae.callType=g.attributes.callType,ae.callControl.callType=g.attributes.callType,"audio"!==g.attributes.callType&&"AUDIOONLY"!==l||(ae.audioOnly=!0,ae.callControl.audioOnly=!0),ae.remoteId=g.attributes.callerId,ae.remoteMailAddress=g.attributes.mailAddress,ae.streamId=g.id,ae.mediaType=l,ae.sessionMCU=re,ue.log("call.streamId: "+ae.streamId),ae.data=(0,h.Ym)(s,"object")?(0,h.ws)({},s):{},ae.data.pubSub="janusConnector",ae.data.type="subscribe",ae.data.mode="passive",ae.data.mediaType=l,ae.data.capabilities=this.browserCapabilities,ae.data.cloudConvId=re.convId,ae.data.instanceId=ae.instanceId,apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(ae),te[Ce]=ae.callId,ae.myWebRTC_Stack.sendInvite(ae.callId,apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,re.roomName,re.roomName,g.attributes.callType,{mode:"passive",data:ae.data,stream:g,volatile:!!ae.restarted})):((ae=new le(apiCC.session.apiCCWebRTCClient.webRTCClient)).instanceId=apiCC.generateInstanceId(),ae.callControl=Re,(0,h.ki)(ae.callControl.autoRestart,"counter","number")?(ae.callControl.autoRestart.counter+=1,ae.restarted=!0):ae.callControl.autoRestart.counter=0,ae.settingUpType="subscribe",null!=v&&null!=v.turnServerAddress&&ae.setCallTurnServer(v.turnServerAddress),void 0===s&&(s={}),ae.data=s,ae.data.pubSub=this.pubConnector,ae.data.type="subscribe",ae.data.capabilities=this.browserCapabilities,ae.data.cloudConvId=re.convId,ae.data.instanceId=ae.instanceId,ue.log("mediaType: ",l),ue.log("stream.attributes.callType: ",g.attributes.callType),ae.callType=g.attributes.callType,ae.callControl.callType=g.attributes.callType,"COMPOSITE"===g.attributes.callType&&"janusConnector"===this.pubConnector||"audio"===g.attributes.callType||"AUDIOONLY"===l?(ue.log("Setting call as audioOnly"),ae.audioOnly=!0,ae.callControl.audioOnly=!0,ae.stripVideoSDPActivated=!0):"VIDEOONLY"===l&&(ae.stripAudioSDPActivated=!0,ae.callType="videoOnly",ae.callControl.callType="videoOnly"),ae.mcuRemoteStream=g,ae.dest_roomId=re.roomName,ae.calleeId=re.roomName,ae.generateCallId(),Re.callId=ae.callId,ae.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,ae.sessionMCU=re,apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(ae),ae.createPeerConnection(),ae.doCall(),ae.started=!0,ae.callType=g.attributes.callType,ae.remoteId=g.attributes.callerId,ae.remoteMailAddress=g.attributes.mailAddress,!0===g.audio?ae.destCallType=!0===g.video?"media":"audio":!0===g.video&&(ae.destCallType="videoOnly"),void 0===g.id&&ue.log("stream.id is undefined :",g),ae.streamId=g.id,ae.mediaType=l,ue.log("stream.attributes.callType: ",g.attributes.callType),te[Ce]=ae.callId),ae.asyncCallbacks={},ae.asyncCallbacks.type="subscribe")}return te},this.unsubscribe=function(t){ue.info("unsubscribe() :",t);var l=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithStreamId(t);null===l?ue.log("error call not found on unsubscribe"):void 0!==l.callId&&apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(l.callId)},this.publish=function(t,l,s,v,r,g){ue.info("publish roomName :",t),ue.log("publish sessionId :",l),ue.log("publish token :",s),ue.log("publish callConfiguration :",v);var E=null,te=!1,ae=!1,Re=null,Ce=null,re=this.getSessionMCU(t);if(!re)return ue.error("roomName does not match any sessionMCU"),null;if(null!==r&&"object"===Se(r)||(r={}),"janusConnector"===this.pubConnector&&!r.mesh&&g&&g.callControl&&g.callControl.callId&&apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(g.callControl.callId))return ue.debug("call already exists",g.callControl.callId),g.callControl.callId;if(!0===v||"true"===v?(ue.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),te=!0,v={}):!1===v||"false"===v?(ue.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),v={}):null!==v&&"object"===Se(v)||(v={}),!0===v.audioOnly&&!0===v.videoOnly)return ke.createErrorEvent("Cannot publish without audio nor video","PUBLISH_FAILURE",null,t),null;if(!0===v.audioOnly&&(te=!0),!0===v.videoOnly&&(ae=!0),["audioOnly","videoOnly","record","private"].forEach(function(L){v.hasOwnProperty(L)&&((0,h.ki)(r,"callConfiguration","object")||(r.callConfiguration={}),r.callConfiguration[L]=v[L])}),re.convId&&(r.cloudConvId=re.convId),(0,h.Ym)(v,"qos","object")?(r.qos={},v.qos.videoMinBitrate?r.qos.videoMinBitrate=v.qos.videoMinBitrate:r.qos.videoMinQuality=v.qos.videoMinQuality&&["excellent","good","medium","bad"].indexOf(v.qos.videoMinQuality)>=0?v.qos.videoMinQuality:"bad",v.qos.videoStartBitrate?r.qos.videoStartBitrate=v.qos.videoStartBitrate:v.qos.videoStartQuality&&["upper","excellent","good","medium","bad"].indexOf(v.qos.videoStartQuality)>=0&&(r.qos.videoStartQuality=v.qos.videoStartQuality),r.qos.videoForbidInactive=!1!==v.qos.videoForbidInactive):r.qos={videoMinQuality:"bad",videoForbidInactive:!0},v.simulcast&&(v.userMediaStreamId&&(Ce=apiCC.getUserMediaStream(v.userMediaStreamId))&&Ce.isSimulcastCompliant()||delete v.simulcast),function(L){if(!(0,h.ki)(L,"simulcast","object")||"safari"===h.wL.type&&"SDP"!==L.simulcast.mode)return delete L.simulcast,!1;delete L.simulcast.sendEncodings,(0,h.ki)(L.simulcast,"maxBitrate","number")?"chrome"===h.wL.type&&h.wL.version>=78&&"SDP"!==L.simulcast.mode?(ue.debug("configure simulcast RID chrome maxBitrate"),!mt(L.simulcast,L.simulcast.maxBitrate)&&(ue.warn("cannot configure simulcast"),delete L.simulcast)):"firefox"===h.wL.type?(ue.debug("configure simulcast RID firefox maxBitrate"),!mt(L.simulcast,L.simulcast.maxBitrate)&&(ue.warn("cannot configure simulcast"),delete L.simulcast)):delete L.simulcast.encodings:(0,h.ki)(L.simulcast,"encodings","object")?"chrome"===h.wL.type&&h.wL.version>=78&&"SDP"!==L.simulcast.mode?(ue.debug("configure simulcast RID chrome encodings"),!gt(L.simulcast)&&(ue.warn("cannot configure simulcast"),delete L.simulcast)):"firefox"===h.wL.type?(ue.debug("configure simulcast RID firefox encodings"),!gt(L.simulcast)&&(ue.warn("cannot configure simulcast"),delete L.simulcast)):delete L.simulcast.encodings:"chrome"===h.wL.type&&h.wL.version>=78&&"SDP"!==L.simulcast.mode?(ue.debug("configure simulcast RID chrome default"),L.simulcast.encodings={high:{maxBitrate:900},medium:{maxBitrate:300,scaleResolutionDownBy:2},low:{maxBitrate:100,scaleResolutionDownBy:4}},!gt(L.simulcast)&&delete L.simulcast):"firefox"===h.wL.type&&(ue.debug("configure simulcast RID firefox default"),L.simulcast.encodings={high:{maxBitrate:900},medium:{maxBitrate:300,scaleResolutionDownBy:2},low:{maxBitrate:100,scaleResolutionDownBy:4}},!gt(L.simulcast))&&delete L.simulcast}(v),v.distributedBroadcastEnabled&&!v.simulcast&&(r.distributedBroadcastEnabled=!0),["audioLabels","videoLabels"].forEach(function(L){(0,h.Ym)(v[L],"array")&&(r[L]=[],v[L].forEach(function(ne){(0,h.Ym)(ne,"string")&&r[L].push(ne)}))}),(0,h.Ym)(v,"context","object"))try{JSON.stringify(v.context),r.context=v.context}catch(L){}if((0,h.Ym)(v,"profileType","string")&&(r.profileType=v.profileType),(0,h.Ym)(v,"priority","number")&&v.priority>=0&&(r.priority=v.priority),(0,h.Ym)(v,"downgradeProfileList","array")&&(r.downgradeProfileList=v.downgradeProfileList),ue.debug("callConfiguration; audioOnly: "+te+", videoOnly: "+ae),g&&!0===g.forceScreenSharingCallType)ue.debug("publish screenSharing");else if(!1===apiCC.mediaDeviceMgr.videoDevicePresent){if(!1===apiCC.mediaDeviceMgr.audioDevicePresent)return ue.debug("publish without any device, leaving publish ..."),r.publishWithoutMediaDeviceDetected=!0,apiCC.session.setUserData(r),ke.createErrorEvent("Cannot publish without audio nor video","PUBLISH_FAILURE",null,t),null;!0!==te&&(ue.debug("publish video, but no webcam present, forcing callType to audio"),te=!0)}else!1===apiCC.mediaDeviceMgr.audioDevicePresent&&!0!==ae&&(ue.debug("publish video, but no microphone present, forcing callType to videoOnly"),ae=!0);if(E=new le(apiCC.session.apiCCWebRTCClient.webRTCClient),void 0!==r.mesh&&void 0!==r.instanceId?(ue.debug("keeping instanceId "),E.instanceId=r.instanceId):E.instanceId=apiCC.generateInstanceId(),"janusConnector"!==this.pubConnector||r.mesh?(E.settingUpType="publish",E.generateCallId()):(E.settingUpType="publish",g&&g.callControl?(E.callControl=g.callControl,E.callControl.autoRestart.counter+=1,E.callId=E.callControl.callId,E.restarted=!0):(E.callControl=apiCC.session.apiCCWebRTCClient.webRTCClient.createCallControl({type:"publish",roomName:t,callConfiguration:v,data:r}),E.callControl.sessionId=l,E.callControl.token=s,E.callControl.autoRestart.counter=0,E.generateCallId(),E.callControl.callId=E.callId)),null!=v&&null!=v.turnServerAddress&&E.setCallTurnServer(v.turnServerAddress),v.userMediaStreamId&&((Ce=apiCC.getUserMediaStream(v.userMediaStreamId))?(E.callType=Ce.callType,ue.debug("Setting callType to "+E.callType),"screenSharing"===E.callType&&(E.screenSharing=!0)):(ue.debug("callConfiguration.userMediaStreamId is setted but stream is not present"),delete v.userMediaStreamId)),E.data=r,E.data.instanceId=E.instanceId,"restarted"===l&&(E.restarted=!0),E.mediaTypeForIncomingCall="NONE",!0===te?(ue.log("Setting call as audioOnly"),E.audioOnly=!0,E.callType="audio",E.mediaTypeForOutgoingCall="AUDIO"):!0===ae?(ue.log("Setting call as videoOnly"),E.callType="videoOnly",E.mediaTypeForOutgoingCall="VIDEOONLY"):ue.log("Not Setting call as audioOnly nor videoOnly"),E.dest_roomId=re.roomName,E.calleeId=re.roomName,E.data.pubSub=this.pubConnector,E.data.type="publish",E.data.capabilities=this.browserCapabilities,E.data.cloudConvId=re.convId,E.callConfiguration=v,E.sessionMCU=re,E.setMediaConstraintsToSendOnlyOffer(),E.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,(0,h.Ym)(v,"simulcast","object")){var K=null;Ce&&(K=Ce.getSimulcastProfile()),"chrome"===h.wL.type&&h.wL.version>=78&&"SDP"!==v.simulcast.mode?(ue.debug("simulcast chrome 78+ -> RID",v.simulcast),E.simulcast="RID",E.data.simulcast={enabled:!0,mode:"RID"},E.data.simulcast.encodings=Object.assign({},v.simulcast.encodings),K&&(E.data.simulcast.profile=K)):"chrome"===h.wL.type?(ue.debug("simulcast chrome -> SDP",v.simulcast),E.simulcast="SDP",E.data.simulcast={enabled:!0,mode:"SDP"}):"firefox"===h.wL.type?(ue.debug("simulcast firefox -> RID",v.simulcast),E.simulcast="RID",E.data.simulcast={enabled:!0,mode:"RID"},E.data.simulcast.encodings=Object.assign({},v.simulcast.encodings),K&&(E.data.simulcast.profile=K)):"safari"===h.wL.type&&(ue.debug("simulcast safari -> SDP",v.simulcast),E.simulcast="SDP",E.data.simulcast={enabled:!0,mode:"SDP"})}return ue.log("webRTCClient.accessToLocalMedia :",G.accessToLocalMedia),apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(E),this.publishCallId=E.callId,E.callControl&&E.callControl.autoRestart.stream&&ue.debug("call.callControl.autoRestart.stream.active :",E.callControl.autoRestart.stream.active),"janusConnector"===this.pubConnector&&E.callControl&&E.callControl.autoRestart.stream&&E.callControl.autoRestart.stream.active?(apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,E.callLocalStream=E.callControl.autoRestart.stream,E.establishCall(),E.callId):(void 0!==r.mesh&&null!==(Re=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(r.mesh.calleeCallId))&&Re.callConfiguration&&Re.callConfiguration.userMediaStreamId&&(E.callType=Re.callType,v.userMediaStreamId=Re.callConfiguration.userMediaStreamId),v.userMediaStreamId?((Ce=apiCC.getUserMediaStream(v.userMediaStreamId)).addCallInfo(E.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===this.pubConnector&&E.callControl&&(E.callControl.autoRestart.stream=Ce.stream),E.callConfiguration.userMediaStreamId=Ce.userMediaStreamId,E.callLocalStream=Ce.stream,E.establishCall(),E.callId):apiCC.userMediaStreamTable.length>0?((Ce=apiCC.userMediaStreamTable[0]).addCallInfo(E.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===this.pubConnector&&E.callControl&&(E.callControl.autoRestart.stream=Ce.stream),E.callConfiguration.userMediaStreamId=Ce.userMediaStreamId,E.callLocalStream=Ce.stream,E.establishCall(),E.callId):(apiCC.createUserMediaStream({callId:E.callId,type:E.callType,audioSourceId:G.audioSourceId,videoSourceId:G.videoSourceId,success:function(L){ue.debug("[publish] success; userMediaStreamId: "+L.userMediaStreamId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&E.callControl&&(E.callControl.autoRestart.stream=L.stream),E.callConfiguration.userMediaStreamId=L.userMediaStreamId,E.callLocalStream=L.stream,E.establishCall()}}),E.callId))},this.publishScreen=function(t,l,s,v){ue.info("publishScreen()");var r=this.getSessionMCU(t);return r?(null==l&&(l={}),null==s&&(s={}),void 0!==s.record&&(void 0!==l.callConfiguration||(l.callConfiguration={}),l.callConfiguration.record=s.record),void 0!==s.private&&(void 0!==l.callConfiguration||(l.callConfiguration={}),l.callConfiguration.private=s.private),l.pubSub=this.pubConnector,l.type="publish",apiCC.session.apiCCWebRTCClient.webRTCClient.shareScreen(r.roomName,l,v,s)):(ue.error("roomId does not match any sessionMCU"),null)},this.unpublish=function(t){ue.info("unpublish call with callId :",t),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(t),this.publishCallId=null},this.removeMCUStream=function(t,l,s){var v,r=!1;for("Broken_by_MCU"!==s&&"disconnected"!==s||(r=!0),ue.debug("streamId:",l),ue.debug("reason:",s),ue.debug("quiet:",r),v=0;v<this.streamList.length;v+=1)if(ue.log("this.streamList[i].streamInfo.id :",this.streamList[v].streamInfo.id),this.streamList[v].streamInfo.id===l){!0===r?(ue.debug("add stream into disputableStreamList: ",l),this.streamList[v].disputableTimeoutId=setTimeout(Ve.bind(this,this.streamList[v].streamInfo.id),3e4),this.streamList[v].clearDisputableEntry=et.bind(this,this.streamList[v].streamInfo.id),this.disputableStreamList.push(this.streamList[v])):(ue.debug("remove stream from streamList:",l),apiCC.session.apiCCWebRTCClient.webRTCClient.destroyCallControl({type:"subscribe",stream:this.streamList[v].streamInfo}),this.streamList.splice(v,1));break}void 0!==t&&apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(t),!0!==r&&ke.createMCURemovedStreamEvent(l)},this.startStreaming=function(t,l,s,v){ue.info("startStreaming");var r,g,E=null!=t&&t.length>0,te=null!=l&&l.length>0,ae={};if(!E&&!te||null==s||0===s.length)return!1;if(void 0===v){if(null===this.publishCallId)return ue.log("Cannot start streaming as no stream is published"),!1;v=this.publishCallId}var Re=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(v);return Re||(Re=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(v))?Re.sessionMCU?(E||(t="custom"),ae.pubSub=this.pubConnector,ae.service=t,te&&(ae.server=l),ae.streamKey=s,ue.log("startStreaming() on ApiRTC MCU with roomId:",Re.sessionMCU.roomName),r={type:"startStreaming",roomId:Re.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:v,data:ae},g=JSON.stringify(r),ue.log("C->S: "+g),apiCC.session.channel.socket.emit("startStreaming",g),!0):(ue.error("no such sessionMCU"),!1):(ue.error("callIdToStream does not match any call"),!1)},this.stopStreaming=function(t){var l,s;if(ue.info("stopStreaming"),void 0===t){if(null===this.publishCallId)return ue.log("Cannot stop streaming as no stream is published"),!1;t=this.publishCallId}var v=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(t);if(!v)return ue.error("callIdToStream does not match any call"),!1;var r=this.getSessionMCU(v.dest_roomId);return r?(ue.log("stopStreaming() on ApiRTC MCU with roomId:",r.roomName),l={type:"stopStreaming",roomId:r.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:t,data:{pubSub:this.pubConnector}},s=JSON.stringify(l),ue.log("C->S: "+s),apiCC.session.channel.socket.emit("stopStreaming",s),!0):(ue.error("dest_roomId does not match any sessionMCU"),!1)},this.startRecording=function(t,l,s,v,r){var g,E;if(ue.info("startRecording"),null==v){if(null===this.publishCallId)return void ue.log("Call recording can not start as stream is not published");v=this.publishCallId}var te=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(v);return te||(te=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(v))?te.sessionMCU?("AUDIO-ONLY"!==t&&"VIDEO-ONLY"!==t&&(t="AUDIO-VIDEO"),null==r&&(r={}),r.pubSub=this.pubConnector,ue.log("startRecording() on ApiRTC MCU with roomId :",te.sessionMCU.roomName),g={type:"startRecording",roomId:te.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:v,data:r,customIdInFilename:l,mediaType:t,convId:s},E=JSON.stringify(g),ue.log("C->S: "+E),void apiCC.session.channel.socket.emit("startRecording",E)):(ue.error("no such sessionMCU"),!1):(ue.error("callIdToRecord does not match any call"),!1)},this.stopRecording=function(t){var l,s;if(ue.info("stopRecording"),void 0===t){if(null===this.publishCallId)return void ue.log("Call recording can not stop as stream is not published");t=this.publishCallId}var v=apiCC.session.apiCCWebRTCClient.webRTCClient.findCallWithCallId(t);if(!v)return ue.error("callIdToRecord does not match any call"),!1;var r=this.getSessionMCU(v.dest_roomId);if(!r)return ue.error("dest_roomId does not match any sessionMCU"),!1;ue.log("stopRecording() on ApiRTC MCU with roomId :",r.roomName),l={type:"stopRecording",roomId:r.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:t,data:{pubSub:this.pubConnector}},s=JSON.stringify(l),ue.log("C->S: "+s),apiCC.session.channel.socket.emit("stopRecording",s)},this.recordingStarted=function(t){ue.info("recordingStarted:",t),ke.createMCURecordingStartedEvent(t.roomName,t.callId,t.clientId,t.recordType,t.time,t.convId,t.mediaId,t.mediaURL,t.remoteId,t.recordedFileName,t.mediaType,t.descriptor)},this.recordingStopped=function(t){ue.info("recordingStopped:",t),ke.createMCURecordingStoppedEvent(t.roomName,t.callId,t.clientId,t.recordType,t.time,t.convId,t.mediaId,t.mediaURL,t.remoteId,t.recordedFileName,t.mediaType,t.descriptor)},this.recordingStreamAvailable=function(t){ue.info("recordingStreamAvailable :",t),ke.createMCURecordedStreamsAvailableEvent(t.roomName,t.callId,t.clientId,t.recordedFileName,t.convId,t.mediaId,t.mediaURL,t.recordType,t.remoteId,t.mediaType,t.descriptor),"janusConnector"===this.pubConnector&&t.hasOwnProperty("confId")&&t.hasOwnProperty("remoteId")&&ke.createRecordedStreamsAvailableEvent(t.confId,t.clientId,t.remoteId,t.callId,t.convId,t.mediaId,t.mediaURL)},this.streamingStarted=function(t){ue.info("streamingStarted: ",t),ke.createMCUStreamingStartedEvent(t.roomName,t.callId,t.clientId,t.time)},this.streamingStopped=function(t){ue.info("streamingStopped: ",t),ke.createMCUStreamingStoppedEvent(t.roomName,t.callId,t.clientId,t.time)},this.startComposite=function(t){var l,s,v;(v=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(ue.log("startComposite() on ApiRTC MCU with roomId :",v.roomName),l={type:"startComposite",roomId:v.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},s=JSON.stringify(l),ue.log("C->S: "+s),apiCC.session.channel.socket.emit("startComposite",s)):ue.log("startComposite() but client is not in session")},this.stopComposite=function(t){var l,s,v;(v=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(ue.log("stopComposite() on ApiRTC MCU with roomId :",v.roomName),l={type:"stopComposite",roomId:v.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector}},s=JSON.stringify(l),ue.log("C->S: "+s),apiCC.session.channel.socket.emit("stopComposite",s)):ue.log("stopComposite() but client is not in session")},this.startCompositeRecording=function(t,l,s,v,r){var g,E,te;ue.info("startCompositeRecording with convId :",s),(te=r?this.getSessionMCU(r):this.getSessionMCU(null,{first:!0}))?("AUDIO-ONLY"!==t&&"VIDEO-ONLY"!==t&&(t="AUDIO-VIDEO"),(v=(0,h.Ym)(v,"object")?(0,h.ws)({},v):{}).pubSub=this.pubConnector,["complete","efficient","audioOnly"].indexOf(v.mode)<0&&(v.mode="complete"),v.labelEnabled=!0===v.labelEnabled,(0,h.Ym)(v,"labels","array")||(v.labels=["microphone","camera","screenSharing","sip"]),ue.log("startRecording() on ApiRTC MCU with roomId :",te.roomName),g={type:"startRecording",roomId:te.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:"COMPOSITE",data:v,customIdInFilename:l,mediaType:t,convId:s},E=JSON.stringify(g),ue.log("C->S: "+E),apiCC.session.channel.socket.emit("startRecording",E)):ue.log("startCompositeRecording() but client is not in session")},this.stopCompositeRecording=function(t){var l,s,v;ue.info("stopCompositeRecording"),(v=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0}))?(ue.log("stopRecording() on ApiRTC MCU with roomId :",v.roomName),l={type:"stopRecording",roomId:v.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:"COMPOSITE",data:{pubSub:this.pubConnector}},s=JSON.stringify(l),ue.log("C->S: "+s),apiCC.session.channel.socket.emit("stopRecording",s)):ue.log("stopCompositeRecording() but client is not in session")},this.enforceMCU=function(t){var l;if(l=t?this.getSessionMCU(t):this.getSessionMCU(null,{first:!0})){var s={type:"info",infoType:"enforceMCU",data:{clientId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,roomId:l.roomName,pubSub:this.pubConnector}},v=JSON.stringify(s);ue.log("C->S: "+v),apiCC.session.channel.socket.emit("info",v)}else ue.log("enforceMCU() but client is not in session")},this.meshPublish=function(t,l,s,v,r,g){var E=!1,te=null,ae=null,Re=this.getSessionMCU(t);if(!Re)return ue.error("meshPublish() - missing sessionMCU"),null;if(!0===v||!1===v||"true"===v||"false"===v?(ue.log("DEPRECATED ... please use callConfiguration JSON parameter : callConfiguration.audioOnly instead of audioOnly"),E=v,v={}):null!==v&&"object"===Se(v)||(v={}),null!==r&&"object"===Se(r)||(r={}),(0,h.Ym)(v,"profileType","string")&&(r.profileType=v.profileType),(0,h.Ym)(v,"priority","number")&&v.priority>=0&&(r.priority=v.priority),(0,h.Ym)(v,"downgradeProfileList","array")&&(r.downgradeProfileList=v.downgradeProfileList),void 0!==v.audioOnly&&(E=v.audioOnly,void 0!==r.callConfiguration||(r.callConfiguration={}),r.callConfiguration.audioOnly=v.audioOnly),(0,h.Ym)(v,"context","object"))try{JSON.stringify(v.context),r.context=v.context}catch(Ce){}return te=new x(apiCC.session.apiCCWebRTCClient.webRTCClient),!0!==E&&"true"!==E||(ue.log("Setting call as audioOnly"),te.callType="audio"),te.roomId=t,te.sessionId=l,te.token=s,te.callConfiguration=v,te.data=r,te.options=g,te.sessionMCU=Re,apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.push(te),v.userMediaStreamId?((ae=apiCC.getUserMediaStream(v.userMediaStreamId)).addCallInfo(te.userMediaId,"userMedia"),te.callConfiguration.userMediaStreamId=ae.userMediaStreamId,te.callType=ae.callType,te.audio=ae.audio,te.video=ae.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(te),apiCC.checkMutingStateForUserMedia(v,ae)):apiCC.createUserMediaStream({callId:te.userMediaId,callFlavor:"userMedia",type:te.callType,audioSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.audioSourceId,videoSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.videoSourceId,success:function(Ce){ue.debug("[meshPublish] success; userMediaStreamId: "+Ce.userMediaStreamId),te.callConfiguration.userMediaStreamId=Ce.userMediaStreamId,te.callType=Ce.callType,te.audio=Ce.audio,te.video=Ce.video,apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(te),apiCC.checkMutingStateForUserMedia(v,Ce)}}),te.userMediaId},this.meshOnUserMediaSuccess=function(t){var l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=null,v=null;!0===l?((s={}).type="streamStatusChanged",s.callerId=G.clientId,s.roomId=t.roomId,s.streams={},s.streams[t.userMediaId]={eventType:"modify",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},s.data={},s.data.meshPublish=!0,s.data.pubSub=this.pubConnector,v=JSON.stringify(s),ue.log("C->S: "+v),apiCC.session.channel.socket.emit("streamStatusChanged",v)):(this.publishCallId=t.userMediaId,t.addAck=!0,t.addTimeoutId=setTimeout(function(){G.onRemoteHangup(t.userMediaId,G.clientId,t.roomId,"Unable_to_establish",null,null)},t.disconnectionTimer),(s={}).type="streamStatusChanged",s.callerId=G.clientId,s.roomId=t.roomId,s.streams={},s.streams[t.userMediaId]={eventType:"add",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},s.data=t.data,s.data.meshPublish=!0,s.data.pubSub=this.pubConnector,v=JSON.stringify(s),ue.log("C->S: "+v),apiCC.session.channel.socket.emit("streamStatusChanged",v))},this.meshPublishScreen=function(t,l,s,v,r){var g=null,E=null,te=this.getSessionMCU(t);return te?(null!==s&&"object"===Se(s)||(s={}),(g=new x(apiCC.session.apiCCWebRTCClient.webRTCClient)).roomId=t,g.data=l,g.callConfiguration=s,g.captureSourceType=v,g.sessionMCU=te,apiCC.session.apiCCWebRTCClient.webRTCClient.userMediaTable.push(g),s.userMediaStreamId?((E=apiCC.getUserMediaStream(s.userMediaStreamId)).addCallInfo(g.userMediaId,"userMedia"),g.callConfiguration.userMediaStreamId=E.userMediaStreamId,g.callType=E.callType,g.audio=E.audio,g.video=E.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(g)):apiCC.createUserMediaStream({callId:g.userMediaId,callFlavor:"userMedia",type:"screenSharing",captureSourceType:v,success:function(ae){ue.debug("[meshPublishScreen] success; userMediaStreamId: "+ae.userMediaStreamId),g.callConfiguration.userMediaStreamId=ae.userMediaStreamId,g.callType=ae.callType,g.audio=ae.audio,g.video=ae.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnScreenMediaSuccess(g)}}),g.userMediaId):(ue.error("meshPublishScreen() - missing sessionMCU"),null)},this.meshOnScreenMediaSuccess=function(t){var l,s=null;t.addAck=!0,t.addTimeoutId=setTimeout(function(){G.onRemoteHangup(t.userMediaId,G.clientId,t.roomId,"Unable_to_establish",null,null)},t.disconnectionTimer),(s={}).type="streamStatusChanged",s.callerId=G.clientId,s.roomId=t.roomId,s.streams={},s.streams[t.userMediaId]={eventType:"add",callId:t.userMediaId,callType:t.callType,audio:t.audio,video:t.video},s.data={},s.data.pubSub=this.pubConnector,l=JSON.stringify(s),ue.log("C->S: "+l),apiCC.session.channel.socket.emit("streamStatusChanged",l)},this.meshOnHangup=function(t,l){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=0,r=null,g=null,E=null;if(null!==l&&"object"===Se(l)||(l={}),t){if(null!==(r=G.findUserMediaById(t)))for(r.close(),!0!==r.streamStolen&&(G.myWebRTC_Event.createHangupEvent("local",G.clientId,0,!0,null,r.userMediaId,r.callType),r.releaseUserMediaStream()),(g={}).type="streamStatusChanged",g.callerId=G.clientId,g.roomId=r.roomId,g.streams={},g.streams[r.userMediaId]={eventType:"remove",callId:r.userMediaId,callType:r.callType},s.restart&&(g.streams[r.userMediaId].restart=!0),g.data={},g.data.pubSub=this.pubConnector,E=JSON.stringify(g),ue.log("C->S: "+E),apiCC.session.channel.socket.emit("streamStatusChanged",E),v=G.userMediaTable.length;--v>=0;)if(G.userMediaTable[v]===r){G.userMediaTable.splice(v,1);break}}else for(v=G.userMediaTable.length;--v>=0;)r=G.userMediaTable[v],s.hasOwnProperty("roomId")&&r.sessionMCU.roomName!==s.roomId||(G.myWebRTC_Event.createHangupEvent("local",G.clientId,0,!0,null,r.userMediaId,r.callType),r.close(),r.releaseUserMediaStream(),(g={}).type="streamStatusChanged",g.callerId=G.clientId,g.roomId=r.roomId,g.streams={},g.streams[r.userMediaId]={eventType:"remove",callId:r.userMediaId,callType:r.callType},g.data={},g.data.pubSub=this.pubConnector,E=JSON.stringify(g),ue.log("C->S: "+E),apiCC.session.channel.socket.emit("streamStatusChanged",E),G.userMediaTable.splice(v,1))},this.participantEjected=function(t){(0,h.Ym)(t.data,"clientId","string")&&G.myWebRTC_Event.createMCUParticipantEjectedEvent(t.roomId,t.data.clientId,t.data.info)},this.ejectParticipant=function(t,l,s){var v;if(v=s?this.getSessionMCU(s):this.getSessionMCU(null,{first:!0})){var r={type:"ejectParticipant",roomId:v.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,data:{pubSub:this.pubConnector,clientId:t}};l&&(r.data.info=l);var g=JSON.stringify(r);ue.log("C->S: "+g),apiCC.session.channel.socket.emit("ejectParticipant",g)}else ue.debug("ejectParticipant() - missing sessionMCU")},this.getJoinSessionReq=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null;if(!t){if(l.hasOwnProperty("transactionId")){for(var v=this.joinSessionReqs.length;--v>=0;)if(this.joinSessionReqs[v].transactionId===l.transactionId){s=this.joinSessionReqs[v];break}return s}return null}for(var r=this.joinSessionReqs.length;--r>=0;)if(this.joinSessionReqs[r].roomId===t){s=this.joinSessionReqs[r];break}return s},this.removeJoinSessionReq=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t){if(!0===l.all)return this.joinSessionReqs.splice(0,this.joinSessionReqs.length),!0;l.hasOwnProperty("roomId")&&(t=this.getJoinSessionReq(l.roomId))}if(!t)return!1;for(var s=this.joinSessionReqs.length;--s>=0&&this.joinSessionReqs[s]!==t;);return s>=0&&(this.joinSessionReqs.splice(s,1),!0)},this.getSessionMCU=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null;if(!t){if(!0===l.first)return this.sessionMCUs[0];if((0,h.Ym)(l.callback,"function")){ue.debug("getSessionMCU callback");for(var v=this.sessionMCUs.length;--v>=0;)if(l.callback(this.sessionMCUs[v])){s=this.sessionMCUs[v];break}}return s}for(var r=this.sessionMCUs.length;--r>=0;)if(this.sessionMCUs[r].roomName===t){s=this.sessionMCUs[r];break}return s},this.removeSessionMCU=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t&&!0===l.all)return this.sessionMCUs.splice(0,this.sessionMCUs.length),!0;if(!t)return!1;for(var s=this.sessionMCUs.length;--s>=0&&this.sessionMCUs[s]!==t;);return s>=0&&(this.sessionMCUs.splice(s,1),!0)},this.callback=function(t,l){return this.closureHandler=function(s){return t[l](s)},this.closureHandler}};function Ve(G){ue.debug("disputableEntryTimeout",G);for(var A=apiCC.session.apiCCWebRTCClient.webRTCClient,t=this.disputableStreamList.length;--t>=0;)if(this.disputableStreamList[t].streamInfo.id===G){this.disputableStreamList.splice(t,1);break}for(var l=null,s=this.streamList.length;--s>=0;)if(this.streamList[s].streamInfo.id===G){l=A.destroyCallControl({type:"subscribe",stream:this.streamList[s].streamInfo}),this.streamList.splice(s,1);break}l&&l.callId&&ke.createHangupEvent("remote",A.clientId,l.roomName,!1,"Hangup_From_Callee",l.callId,l.callType),ke.createMCURemovedStreamEvent(G)}function et(G){ue.debug("clearDisputableEntry",G);for(var A=this.disputableStreamList.length;--A>=0;)if(this.disputableStreamList[A].streamInfo.id===G){this.disputableStreamList.splice(A,1);break}for(var t=this.streamList.length;--t>=0;)if(this.streamList[t].streamInfo.id===G){this.streamList[t].disputableTimeoutId&&(clearTimeout(this.streamList[t].disputableTimeoutId),delete this.streamList[t].disputableTimeoutId),delete this.streamList[t].clearDisputableEntry;break}}function _e(G){var A={};return(0,h.ki)(G,"maxBitrate","number")&&(A.maxBitrate=G.maxBitrate),(0,h.ki)(G,"scaleResolutionDownBy","number")&&(A.scaleResolutionDownBy=G.scaleResolutionDownBy),A}function gt(G){return(0,h.Ym)(G.encodings,"object")?(0,h.ki)(G.encodings.high,"maxBitrate","number")&&(0,h.ki)(G.encodings.medium,"maxBitrate","number")&&(0,h.ki)(G.encodings.low,"maxBitrate","number")?(G.encodings.high=Object.assign({active:!0},_e(G.encodings.high)),G.encodings.medium=Object.assign({active:!0},_e(G.encodings.medium)),G.encodings.low=Object.assign({active:!0},_e(G.encodings.low)),G.sendEncodings=[{rid:"h",active:!0},{rid:"m",active:!0},{rid:"l",active:!0}],G.sendEncodings[0].maxBitrate=1e3*G.encodings.high.maxBitrate,G.sendEncodings[1].maxBitrate=1e3*G.encodings.medium.maxBitrate,G.sendEncodings[2].maxBitrate=1e3*G.encodings.low.maxBitrate,(0,h.ki)(G.encodings.medium,"scaleResolutionDownBy","number")&&(G.sendEncodings[1].scaleResolutionDownBy=G.encodings.medium.scaleResolutionDownBy),(0,h.ki)(G.encodings.low,"scaleResolutionDownBy","number")&&(G.sendEncodings[2].scaleResolutionDownBy=G.encodings.low.scaleResolutionDownBy),!0):(ue.warn("no such maxBitrate"),!1):(ue.warn("no such encodings"),!1)}function mt(G,A){if(A<650)return!1;var t=Math.floor(9*A/13),l=Math.floor(3*A/13);return G.encodings={high:{maxBitrate:t},medium:{maxBitrate:l,scaleResolutionDownBy:2},low:{maxBitrate:A-t-l,scaleResolutionDownBy:4}},gt(G)}i.Y.get("CallControl");var ot=function(G){this.type=G.type,G.callId&&(this.callId=G.callId),this.callType=G.callType?G.callType:"media",Object.prototype.hasOwnProperty.call(G,"audioOnly")&&(this.audioOnly=!!G.audioOnly),G.roomName&&(this.roomName=G.roomName),G.mediaType&&(this.mediaType=G.mediaType),G.callConfiguration&&(this.callConfiguration=G.callConfiguration),G.data&&(this.data=G.data),G.stream&&(this.stream=G.stream),this.autoRestart={}},at=function(){var G=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];this.a=1,this.b=0,this.c=7,this.d=0,this.update=function(A,t,l){var s=0;for(null==t&&(t=0),null==l&&(l=A.length);s<l;s+=1)this.a=(this.a+A[t+s])%65521,this.b=(this.b+this.a)%65521,this.c=(this.c+3)*(A[t+s]+5)%65521,this.d=(this.d+this.c)%65521},this.digest=function(A){return G[this.d>>12&15]+G[this.d>>8&15]+G[this.d>>4&15]+G[15&this.d]+G[this.c>>12&15]+G[this.c>>8&15]+G[this.c>>4&15]+G[15&this.c]+G[this.b>>12&15]+G[this.b>>8&15]+G[this.b>>4&15]+G[15&this.b]+G[this.a>>12&15]+G[this.a>>8&15]+G[this.a>>4&15]+G[15&this.a]}};function yt(G,A){return null==A&&(A={}),"checksum64"===G?new at:null}function Et(G){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(G)}var ie=i.Y.get("WebRTC_Client"),dt=apiCC.myWebRTC_Event,Rt=function(G){function A(t,l,s){var v,r=t.width,g=r<<2,E=t.height,te=null,ae=0,Re=0,Ce=0,re=0,K=0,L=0,ne=0,ee=0,ce=0,me=0,Te=0,ge=0,Ie=0,we=0,Pe=0,We=0;if(l){for(te=l.data,s<0&&(s=0),ee=1-((K=(2.44413*(ae=s>=2.5?.98711*s-.9633:s>=.5?3.97156-4.14554*Math.sqrt(1-.26891*s):2*s*(3.97156-4.14554*Math.sqrt(.865545)))+2.85619*(Re=ae*ae)+1.26661*(Ce=Re*ae))/(re=1.57825+2.44413*ae+1.4281*Re+.422205*Ce))+(L=-(1.4281*Re+1.26661*Ce)/re)+(ne=.422205*Ce/re)),v=0;v<3;v++)for(ce=0;ce<E;ce++){for(Te=ce*g+(r-1<<2)+v,Pe=we=Ie=ge=te[me=ce*g+v],me=ce*g+v;me<=Te;me+=4)te[me]=ge=ee*te[me]+K*Ie+L*we+ne*Pe,Pe=we,we=Ie,Ie=ge;for(Te=ce*g+v,Pe=we=Ie=ge=te[me=ce*g+(r-1<<2)+v],me=ce*g+(r-1<<2)+v;me>=Te;me-=4)te[me]=ge=ee*te[me]+K*Ie+L*we+ne*Pe,Pe=we,we=Ie,Ie=ge}for(v=0;v<3;v++)for(We=0;We<r;We++){for(Te=(E-1)*g+(We<<2)+v,Pe=we=Ie=ge=te[me=(We<<2)+v],me=(We<<2)+v;me<=Te;me+=g)te[me]=ge=ee*te[me]+K*Ie+L*we+ne*Pe,Pe=we,we=Ie,Ie=ge;for(Te=(We<<2)+v,Pe=we=Ie=ge=te[me=(E-1)*g+(We<<2)+v],me=(E-1)*g+(We<<2)+v;me>=Te;me-=g)te[me]=ge=ee*te[me]+K*Ie+L*we+ne*Pe,Pe=we,we=Ie,Ie=ge}return l}}this.localVideo=null,this.miniVideo=null,this.remoteVideo=null,this.localStream=null,this.statusDiv=null,this.commandDiv=null,this.remoteStream=null,this.channelReady=!1,this.socket=G.channel.socket,this.clientId=G.apiCCId,this.compositeClientId=G.apiCCId+"@"+G.apiCCSessionId,this.apiKey=G.apiKey,this.isVideoMuted=!1,this.isAudioMuted=!1,this.callURLDestRoom=0,this.callControlTable=[],this.userMediaTable=[],this.callsTable=[],this.callsRetriesTable={},this.restartCallDelay=1e3,this.maxCallsRetriesDuration=15e4,this.accessToLocalMedia=!1,this.unidirectionelCallOnly=!1,this.NtoNConf=!1,this.autoAnswer=!1,this.RTPMedia=!1,this.logoAdded=!1,this.preferOpusCodec=!1,this.preferVP9Codec=!1,"undefined"!=typeof apiRTC_React&&"iOS"===d.BF?(ie.log("React and iOS : Setting H264 as preferred codec"),this.preferH264Codec=!0):this.preferH264Codec=!1,this.preferSendingH264Codec=!1,this.setStereo=!1,this.allowedAudioCodecs="",this.allowedVideoCodecs="",this.mediaRoutingModeEnum={hostOnly:1,stun:2,stunOnly:3,turn:4,turnOnly:5},this.mediaRoutingMode=this.mediaRoutingModeEnum.turn,this.myWebRTC_Event=apiCC.myWebRTC_Event,this.getUserMediaOnGoing=!1,this.userAcceptOnIncomingCall=!1,this.userAcceptOnIncomingCallBeforeGetUserMedia=!1,this.userAcceptOnIncomingDataCall=!1,this.userAcceptOnIncomingScreenSharingCall=!1,this.maxWidthRemoteVideo=0,this.maxHeightRemoteVideo=0,this.nickname=G.nickname,this.hideLocalVideoOnCall=!0,this.allowMultipleCalls=!1,this.mySDPManager=new y,this.MCUClient=new ze(this,this.clientId),this.audioSourceId=null,this.audioOutputId=null,this.videoSourceId=null,this.facingMode=null,this.apiRTCExtensionInstalled=!1,this.trickleIce=!0,this.waitingShareScreenCallId=0,this.waitingShareScreenDestNumber=0,this.waitingCaptureSourceType=null,this.qosEnable=!1,this.qosInterval=5e3,this.csmEnable=!1,this.qualityScoreEnable=!1,this.qualityScoreIntervalMs=5e3,this.csmIntervalMs=5e3,this.recordedCall=!1,this.audioBandwidth=null,this.videoBandwidth=null,this.videoRemoteBandwidth=null,this.videoBandwidthSettings={},this.dataBandwidth=null,this.pc_config="",this.clientIncomingCandidatesQueue=[],this.cleanStoredCallCandidateTimer=6e4,this.initializeGumConfig=function(){this.gum_config="Edge"===d.Xh&&d.PR>=15?{audio:!0,video:!0}:"Chrome"===d.Xh&&d.PR<49||"Firefox"===d.Xh&&d.PR<50?{audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}}:{audio:{},video:{}}},this.initializeGumConfig(),this.setGumConfigWithDevicePresent=function(){!1===apiCC.mediaDeviceMgr.audioDevicePresent&&(this.gum_config.audio=!1),!1===apiCC.mediaDeviceMgr.videoDevicePresent&&(this.gum_config.video=!1),!1===apiCC.mediaDeviceMgr.audioDevicePresent&&!1===apiCC.mediaDeviceMgr.videoDevicePresent&&(this.unidirectionelCallOnly=!0),ie.log("this.gum_config:",this.gum_config)},this.userMediaErrorDetected=!1,this.lastUsedUserMediaConstraint=null,this.mediaTypeForIncomingCall="VIDEO",this.mediaTypeForOutgoingCall="VIDEO",this.allowAsymetricMediaCalls=!1,this.receiveMediaDeactivated=!1,this.configTurnServer=null,apiCC.myWebRTC_Adapter.adaptForIoSCordova(),this.pc_config={iceServers:[{urls:["turns:mp1.apizee.com:443?transport=udp","turns:mp1.apizee.com:443?transport=tcp","turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp","turns:mp2.apizee.com:443?transport=udp","turns:mp2.apizee.com:443?transport=tcp","turn:mp2.apizee.com:443?transport=udp","turn:mp2.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]},"Firefox"===d.Xh&&d.PR<53?(ie.log("createPeerConnection FIREFOX"),ie.log("webrtcDetectedVersion : "+apiCC.myWebRTC_Adapter.webrtcDetectedVersion),this.pc_config=d.PR<38?{iceServers:[{url:"stun:mp1.apizee.com:443",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443",credential:"password",username:"anonymous"}]}:d.PR>=42?{iceServers:[{urls:["turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]}:{iceServers:[{urls:"turn:mp1.apizee.com:443?transport=tcp",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443?transport=tcp",credential:"password",username:"anonymous"}]}):"IE"===d.Xh||"Safari"===d.Xh&&d.PR<11?(ie.log("Browser is :"+d.Xh+" - using Plugin"),this.pc_config={iceServers:[{url:"stun:mp1.apizee.com:443",credential:"password",username:"anonymous"},{url:"turn:mp1.apizee.com:443",credential:"password",username:"anonymous"}]}):"Edge"===d.Xh&&d.PR<45?(ie.log("Browser is Edge - removing Turns config"),this.pc_config={iceServers:[{urls:["turn:mp1.apizee.com:443?transport=udp","turn:mp1.apizee.com:443?transport=tcp","turn:mp2.apizee.com:443?transport=udp","turn:mp2.apizee.com:443?transport=tcp"],credential:"password",username:"anonymous"}]}):ie.log("default this.pc_config configuration"),this.pc_constraints={optional:[]},"edge"===h.wL.type?ie.debug("not data channel capable"):"safari"===h.wL.type?h.wL.version>=11?this.dataChannelCapable=!0:ie.debug("not data channel capable"):this.dataChannelCapable=!0,"chrome"===h.wL.type&&h.wL.version>=68||"firefox"===h.wL.type&&h.wL.version>=64||"safari"===h.wL.type&&h.wL.version>=12?(ie.debug("RTCRtpSender#setParameters is available"),this.rtpSenderSetParamatersCapable=!0):(ie.debug("RTCRtpSender#setParameters is NOT available"),this.rtpSenderSetParamatersCapable=!1),this.initialize=function(t,l,s,v,r){this.localVideo=document.getElementById(t),null===this.localVideo&&ie.log("localVideo Div Name is not correct : INCORRECT_DIV_NAME_LOCALVIDEO"),this.miniVideo=document.getElementById(l),null===this.miniVideo&&ie.log("miniVideo Div Name is not correct : INCORRECT_DIV_NAME_MINIVIDEO"),this.remoteVideo=document.getElementById(s),null===this.remoteVideo&&ie.log("remoteVideo Div Name is not correct : INCORRECT_DIV_NAME_REMOTEVIDEO"),this.statusDiv=document.getElementById(v),null===this.statusDiv&&ie.log("status Div Name is not correct : INCORRECT_DIV_NAME_STATUS"),this.commandDiv=document.getElementById(r),null===this.commandDiv?ie.log("command Div Name is not correct : INCORRECT_DIV_NAME_COMMAND"):(ie.log("Command buttons are managed by ApiRTC"),this.displayCallButtonInCommand()),0!==this.callURLDestRoom&&(ie.log("callURLDestRoom is not null"),this.callperURL(this.callURLDestRoom),this.callURLDestRoom=0),this.initMediaElementState(),this.setStatus("<div>Your phone is registered, you can be reached at this number : "+this.clientId+"</div>")},this.setClientTurnServer=function(t){ie.info("setClientTurnServer :",t);var l=JSON.stringify(this.pc_config);l=l.replace(/mp1.apizee.com/g,t),this.pc_config=JSON.parse(l)},this.activateScreenSharing=function(t){apiCC.activateScreenSharing(t)},this.setGetUserMediaConfig=function(t){if(ie.log("setGetUserMediaConfig :",t),null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices.getSupportedConstraints&&void 0!==navigator.mediaDevices.getSupportedConstraints){var l=navigator.mediaDevices.getSupportedConstraints();ie.log("Supported Constraints :",l)}void 0!==t.video&&(void 0===t.video.height&&void 0===t.video.width||void 0!==t.optional&&(ie.warn("contraints with both optional/mandatory and specific or advanced constraints usage : this may failed depending of browsers"),ie.log("setGetUserMediaConfig : contraints modification to avoid both optional/mandatory and specific or advanced constraints usage"),void 0!==t.optional.sourceId&&(ie.log("sourceId contraints modification to deviceId"),void 0===t.video.deviceId&&(t.video.deviceId={}),t.video.deviceId.ideal=t.optional.sourceId),delete t.optional)),ie.log("this.gum_config :",this.gum_config),this.gum_config=t},this.getUserMedia=function(){try{this.gum_config=apiCC.setAudioSourceIdInConstraint(this.audioSourceId,this.gum_config),this.gum_config=apiCC.setVideoSourceIdInConstraint(this.videoSourceId,this.gum_config),this.lastUsedUserMediaConstraint=this.gum_config,"IE"===d.Xh&&d.dc>8?apiCC.getUserMediaWithCB(this.gum_config,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")):apiCC.getUserMedia(this.gum_config).then(this.callback(this,"onUserMediaSuccess")).catch(this.callback(this,"onUserMediaError"))}catch(t){ie.error("getUserMedia() failed. Is this a WebRTC capable browser?"),ie.log("getUserMedia failed with exception: "+t.message)}},this.onUserMediaSuccess=function(t){ie.info("onUserMediaSuccess : User has granted access to local media."),this.accessToLocalMedia=!0;var l=!1,s="Unknown",v=!1,r="Unknown";this.miniVideo&&apiCC.attachMediaStream(this.miniVideo,t),this.localVideo&&(apiCC.attachMediaStream(this.localVideo,t),this.localVideo.style.opacity=1),this.localStream=t,t.getAudioTracks().length>0&&(l=!0,t.getAudioTracks()[0].label&&(s=t.getAudioTracks()[0].label),ie.log("Using audio device: "+s)),t.getVideoTracks().length>0&&(v=!0,t.getVideoTracks()[0].label&&(r=t.getVideoTracks()[0].label),ie.log("Using video device: "+r)),this.myWebRTC_Event.createUserMediaSuccessEvent(!1,l,s,v,r,"media",null,t,null,!1)},this.onUserMediaError=function(t){ie.info("onUserMediaError : Failed to get access to local media. Error : ",t),ie.error(t),this.accessToLocalMedia=!1,"electron"!==d.$6&&"Chrome"===d.Xh&&d.PR>47&&(ie.log("browser_version > 47"),"https:"!==window.location.protocol&&ie.error("HTTPS is now mandatory to use getUserMedia()")),this.myWebRTC_Event.createUserMediaErrorEvent(!1,"media",t,null,null,null,this.gum_config),t=null,!0===apiCC.session.tryAudioCallAfterUserMediaError?(ie.log("this.lastUsedUserMediaConstraint :",this.lastUsedUserMediaConstraint),ie.log("this.lastUsedUserMediaConstraint.video :",this.lastUsedUserMediaConstraint.video),!1!==this.lastUsedUserMediaConstraint.video?(ie.log("this.lastUsedUserMediaConstraint.audio :",this.lastUsedUserMediaConstraint.audio),ie.log("UserMediaError, Trying to getUserMedia with audioOnly"),this.videoSourceId=null,this.gum_config.video=!1,this.getUserMedia()):ie.log("onUserMediaError without video")):ie.log("try AudioCall after UserMediaError is not activated")},this.evalCallProfileWithSdp=function(t,l,s){return this.evalCallProfileWithSdpGuideline(this.mySDPManager.createGuideline(t),t,l,s)},this.evalCallProfileWithSdpGuideline=function(t,l,s,v){var r={};return t.hasOwnProperty("audio")?(r.audio=!0,r.audioActive="local"===s&&"send"===v?"sendrecv"===t.audio.direction||"sendonly"===t.audio.direction:"local"===s&&"receive"===v||"remote"===s&&"send"===v?"sendrecv"===t.audio.direction||"recvonly"===t.audio.direction:"remote"===s&&"receive"===v&&("sendrecv"===t.audio.direction||"sendonly"===t.audio.direction)):(r.audio=!1,r.audioActive=!1),t.hasOwnProperty("video")?(r.video=!0,r.videoActive="local"===s&&"send"===v?"sendrecv"===t.video.direction||"sendonly"===t.video.direction:"local"===s&&"receive"===v||"remote"===s&&"send"===v?"sendrecv"===t.video.direction||"recvonly"===t.video.direction:"remote"===s&&"receive"===v&&("sendrecv"===t.video.direction||"sendonly"===t.video.direction)):(r.video=!1,r.videoActive=!1),r},this.checkDestCallTypeWithSDP=function(t,l){ie.debug("checkDestCallTypeWithSDP");var s=this.mySDPManager.createGuideline(t),v=!1,r=!1;!s.audio||"sendrecv"!==s.audio.direction&&"sendonly"!==s.audio.direction||(v=!0),!s.video||"sendrecv"!==s.video.direction&&"sendonly"!==s.video.direction||(r=!0),l.destCallType=!0===v?!0===r?"media":"audio":!0===r?"videoOnly":"inactive",ie.debug("call.destCallType: "+l.destCallType),!0!==l.callee||s.audio&&"sendonly"!==s.audio.direction||s.video&&"sendonly"!==s.video.direction||(l.userMediaAccessRequired=!1,l.mediaTypeForOutgoingCall="NONE",ie.debug("access to user media not required"))},this.evaluateVideoCap=function(t){delete t.videoCap,t.belongsToRoom()?"publish"!==t.settingUpType&&"shareScreen"!==t.settingUpType||t.localCallProfile&&t.localCallProfile.video&&t.localCallProfile.videoActive&&this.evalOutgoingVideoBandwithCap(t):(this.rtpSenderSetParamatersCapable||!t.callee)&&t.localCallProfile&&t.localCallProfile.video&&t.localCallProfile.videoActive&&this.evalOutgoingVideoBandwithCap(t)},this.processInvite=function(t){ie.info("processInvite() - invite received from :"+t.callerId);var l,s=0,v=null,r=null,g=null,E=null,te=!1,ae=null,Re=null,Ce=null,re={};if(void 0!==t.data&&"publish"===t.data.type&&void 0!==t.data.mesh){if(ie.info("received invite publish mesh; mesh: "+JSON.stringify(t.data.mesh)),null==(v=this.findCallWithCallIdAndInstanceId(t.data.mesh.callerCallId,t.data.instanceId)))return void ie.error("cannot find call; callId: "+t.data.mesh.callerCallId);v.userMediaAccessRequired=!1,v.data.mesh=t.data.mesh,v.setupTimeoutId&&(clearTimeout(v.setupTimeoutId),delete v.setupTimeoutId),te=!0}else{if(void 0!==t.data&&"subscribe"===t.data.type&&void 0!==t.data.mesh){if(ie.debug("received invite subscribe mesh; mesh: ",t.data.mesh),null!==(r=this.findUserMediaById(t.data.mesh.calleeCallId)))if(this.MCUClient.distantCalls.push({early:!0,roomId:t.roomId,clientId:t.data.mesh.callerId,callId:t.data.mesh.callerCallId,callMode:"mesh",callDirection:"recvonly",callFeed:{clientId:t.data.mesh.calleeId,callId:t.data.mesh.calleeCallId}}),setTimeout(function(ne,ee,ce){ie.debug("early distant call descriptor timeout");for(var me=this.MCUClient.distantCalls.length;--me>=0;)if(this.MCUClient.distantCalls[me].early&&this.MCUClient.distantCalls[me].roomId===ne&&this.MCUClient.distantCalls[me].clientId===ee&&this.MCUClient.distantCalls[me].callId===ce){ie.debug("remove early distant call descriptor: timeout"),this.MCUClient.distantCalls.splice(me,1);break}}.bind(this,t.roomId,t.data.callerId,t.data.callerCallId),3e4),"screenSharing"===r.callType||"screenSharingWithAudio"===r.callType)re.type="publish",re.mesh=t.data.mesh,re.instanceId=t.data.instanceId,this.MCUClient.publishScreen(t.roomId,re,null,r.captureSourceType);else{var K=(0,h.ws)({},r.callConfiguration);"AUDIOONLY"===t.data.mediaType?K.audioOnly=!0:"VIDEOONLY"===t.data.mediaType&&(K.videoOnly=!0),(g=apiCC.getUserMediaStream(K.userMediaStreamId))&&(g.audioMuted&&g.videoMuted?K.muted="VIDEO":g.audioMuted?K.muted="AUDIOONLY":g.videoMuted?K.muted="VIDEOONLY":delete K.muted),delete K.distributedBroadcastEnabled,delete K.simulcast,re.type="publish",re.mesh=t.data.mesh,re.instanceId=t.data.instanceId,this.MCUClient.publish(t.roomId,null,null,K,re,null)}else ie.debug("media not found: sending bye : Call_not_found"),new P.S(apiCC.session.channel.socket).sendBye(t.callId,t.calleeId,t.roomId,t.callerId,"Call_not_found",t.data);return}if(void 0!==t.data&&"publish"===t.data.type&&"passive"===t.data.mode){if(null==(v=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId,t.data.instanceId)))return void ie.debug("cannot find call; callId: "+t.callId+", callerId: "+t.callerId+", instanceId: "+t.data.instanceId);v.userMediaAccessRequired=!1,v.setupTimeoutId&&(clearTimeout(v.setupTimeoutId),delete v.setupTimeoutId),te=!0}else(v=new le(this)).callId=t.callId,v.instanceId=t.data.instanceId,v.callerId=t.callerId,v.calleeId=this.clientId,v.callee=!0,v.remoteId=t.callerId}if(v.dest_roomId=t.roomId,void 0!==v.data&&!0===te)for(Ce in t.data)t.data.hasOwnProperty(Ce)&&(v.data[Ce]=t.data[Ce]);else v.data=t.data;if(v.data.instanceId=v.instanceId,void 0!==t.data&&"sipConnector"===t.data.pubSub&&(v.trickleIce=!1,v.remoteType="sip"),v.checkDTLSCompliancy(),"Edge"===d.Xh&&(ae=apiCC.session.getConnectedUserInfo(t.callerId,"userData"),ie.log("destUserInfo :",ae),"User_Not_Found"!==ae&&void 0!==ae&&"Chrome"===(Re=JSON.parse(ae)).browser&&"Android"===Re.osName&&(ie.log("Browser is Edge and caller is Chrome on Android, setting VP8 as prefered codec for the call"),v.preferVP8Codec=!0)),void 0!==t.data&&"publish"===t.data.type&&"passive"===t.data.mode&&void 0!==t.stream&&void 0!==t.stream.id&&(v.streamId=t.stream.id,ie.log("call.streamId: "+v.streamId)),ie.log("processInvite() - Actual call Number is :"+(s=this.callsTable.length)),"screenSharing"===t.callType||"screenSharingWithAudio"===t.callType)v.screenSharing=!0,v.callType=t.callType;else if("data"!==t.callType&&!1===this.allowMultipleCalls){for(ie.log("processInvite() - Refusing double call checking ..."),l=0;l<s;l+=1)if("screenSharing"!==this.callsTable[l].callType&&"screenSharingWithAudio"!==this.callsTable[l].callType&&"data"!==this.callsTable[l].callType)return ie.log("processInvite() - Refusing double call"),!1===te?this.callsTable.push(v):ie.log("callAlreadyExist in table"),this.myWebRTC_Event.createCallAttemptEvent(this.clientId,t.callerId,t.callerNickname,v.callId),void this.refuseCall(v.callId,"User_Busy");ie.log("NOT Refusing double call")}!1===te?(s=this.callsTable.push(v),ie.log("processInvite() - New call Number is :"+s)):(ie.log("callAlreadyExist in table"),ie.log("processInvite() - call Number is :"+s)),this.checkDestCallTypeWithSDP(t.sdpoffer.sdp,v);var L=this.mySDPManager.createGuideline(t.sdpoffer.sdp);if(v.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(L,t.sdpoffer.sdp,"remote","send")),v.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(L,t.sdpoffer.sdp,"remote","receive")),this.rtpSenderSetParamatersCapable||(this.evaluateVideoCap(v),v.videoCap&&(L.video.bandwidth=v.videoCap,t.sdpoffer.sdp=L.generate())),v.receivedSdpOfferMessage=t.sdpoffer,(0,h.ki)(t,"stream","object")&&(!0===t.stream.audioMuted&&(v.isRemoteAudioMuted=!0),!0===t.stream.videoMuted&&(v.isRemoteVideoMuted=!0)),!0===this.autoAnswer&&this.displayHangUpButtonInCommand(),"data"===t.callType){if(ie.log("Receiving DATA call"),v.callType="data",v.dataCall=!0,"Edge"===d.Xh&&d.PR<79)return ie.warn("Cannot create DataChannel as it is not supported on Edge"),void this.refuseCall(v.callId,"DataChannel_Not_Supported");this.setStatus("Incoming data Call from ongoing :"+t.callerId),this.userAcceptOnIncomingDataCall||v.onUserMediaSuccessTestUni(),this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,v.callId,!1,s,!1,t.callType,!1,v.remoteType,v.destCallType)}else!1===v.userMediaAccessRequired||this.unidirectionelCallOnly||!0===v.screenSharing?(ie.log("call.userMediaAccessRequired :",v.userMediaAccessRequired),ie.log("this.unidirectionelCallOnly :",this.unidirectionelCallOnly),ie.log("call.screenSharing :",v.screenSharing),this.unidirectionelCallOnly&&this.setStatus("You are connected to "+t.callerId+', your audio and video media are not transmitted. <input type="button" id="AddMedia" value="Activate Audio & Video" onclick="apiCC.session.apiCCWebRTCClient.addMedia('+v.callId+')" />'),!0===v.screenSharing?!1===this.userAcceptOnIncomingScreenSharingCall?(this.setStatus("Screensharing session activated, accepting unidirectionnel call"),v.onUserMediaSuccessTestUni()):ie.debug("userAcceptOnIncomingScreenSharingCall is activated : need user accept"):!0===te?(ie.log("processInvite() - callAlreadyExist"),v.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCall||!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("processInvite() - Waiting for call accept or refuse from user - 1"):(ie.log("processInvite() - userAcceptOnIncomingCall is not activated"),v.onUserMediaSuccessTestUni()),void 0!==t.data&&!0===t.data.subscribeOrder||!1!==te||this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,v.callId,!1,s,!1,t.callType,!1,v.remoteType,v.destCallType)):(apiCC.userMediaStreamTable.length>0&&(E=apiCC.userMediaStreamTable[0].userMediaStreamId),!0!==this.accessToLocalMedia&&!E||!0!==this.autoAnswer?(this.setStatus("Incoming Call from :"+t.callerId+'. Click on "Autoriser" button to accept.'),!0===v.audioOnly&&!1===apiCC.mediaDeviceMgr.audioDevicePresent?(ie.log("processInvite() - audio and video media are not transmitted"),this.setStatus("You are connected to "+t.callerId+', your audio and video media are not transmitted. <input type="button" id="AddMedia" value="Activate Audio & Video" onclick="apiCC.session.apiCCWebRTCClient.addMedia('+v.callId+')" />'),v.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("Stand-by :: wait for getUserMediaOnCall && establishCall"):(ie.debug("processInvite() - call.getUserMediaOnCall()"),ie.log("processInvite() - this.autoAnswer :"+this.autoAnswer),v.getUserMediaOnCall()),!1===te&&this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,v.callId,!1,s,v.audioOnly,t.callType,!1,v.remoteType,v.destCallType)):(this.setStatus("You are connected to :"+t.callerId),ie.log("processInvite() :: User has already granted access to local media and AutoAnswer activated : establishing call"),!0===this.userAcceptOnIncomingCall||!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("processInvite() - Waiting for call accept or refuse from user - 2"):E?(ie.log("using First available stream on apiRTC"),(g=apiCC.getUserMediaStream(E)).addCallInfo(v.callId),null!=v.callConfiguration||(v.callConfiguration={}),v.callConfiguration.userMediaStreamId=g.userMediaStreamId,v.onUserMediaSuccessOnCall(g.stream)):v.establishCall(),!1===te&&this.myWebRTC_Event.createIncomingCallEvent(this.clientId,t.callerId,t.callerNickname,v.callId,!0,s,v.audioOnly,t.callType,!1,v.remoteType,v.destCallType)))},this.setRemoteDescriptionProcess=function(t,l){this.preferSendingH264Codec&&(ie.log("Modification of SDP to set H264 as prefered sending codec"),l.sdp=this.mySDPManager.maybePreferCodec(l.sdp,"video","H264")),"Chrome"===d.Xh&&d.PR<55||"Firefox"===d.Xh&&d.PR<50||"IE"===d.Xh||"undefined"!=typeof apiRTC_React?null!==t.pc?t.pc.setRemoteDescription(l,t.callback(t,"onSetRemoteDescriptionSuccess"),t.callback(t,"onSetRemoteDescriptionFailure")):ie.debug("setRemoteDescriptionProcess - pc is null"):(ie.log("before setRemoteDescription - Promise version"),null!==t.pc?t.pc.setRemoteDescription(l).then(t.callback(t,"onSetRemoteDescriptionSuccess")).catch(t.callback(t,"onSetRemoteDescriptionFailure")):ie.debug("setRemoteDescriptionProcess - pc is null"))},this.process200OK=function(t){var l,s=null,v=null;if(void 0!==t.data&&void 0!==t.data.instanceId?(ie.info("200OK received from callId :"+t.calleeId+", intanceId is :"+t.data.instanceId),s=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.calleeId,t.data.instanceId)):(ie.info("200OK received from callId :"+t.calleeId),s=this.findCallWithCallIdAndRemoteId(t.callId,t.calleeId)),null===s)return ie.warn("200OK received but callId and instanceId are not matching, no process"),void this.myWebRTC_Event.createErrorEvent("200OK received but callId is not matching, no process","NOT_MATCHING_CALLID_ON_200OK");s.calleeId=t.calleeId,t.sdpanswer&&"no-answer"!==t.sdpanswer.type?!1===s.message200OKReceived?(ie.debug("first 200OK for the call"),s.message200OKReceived=!0,"subscribe"!==s.data.type&&this.checkDestCallTypeWithSDP(t.sdpanswer.sdp,s),l=this.mySDPManager.createGuideline(t.sdpanswer.sdp),s.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(l,t.sdpanswer.sdp,"remote","send")),s.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(l,t.sdpanswer.sdp,"remote","receive")),this.evaluateVideoCap(s),!this.rtpSenderSetParamatersCapable&&s.videoCap&&(l.video.bandwidth=s.videoCap,t.sdpanswer.sdp=l.generate()),s.receivedSdpOfferMessage=t.sdpanswer,ie.log("process200OK : before setRemoteDescription"),v=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpanswer),this.videoRemoteBandwidth&&(ie.log("Modification of SDP to set remote video bandwidth"),v.sdp=this.mySDPManager.setVideoBandwidth(v.sdp,this.videoRemoteBandwidth)),this.setRemoteDescriptionProcess(s,v),this.setStatus("You are connected to :"+t.calleeId),null!=t.data&&(s.data=null!=s.data?(0,h.S6)(s.data,t.data):t.data)):ie.debug("200OK has already been received for this call, leaving process200OK"):dt.createCallEstablishedEvent(s.calleeId,s.callType,s.callId,s.destCallType)},this.cleanStoredCallCandidate=function(t,l){ie.debug("cleanStoredCallCandidate from callId :"+t+", instanceId is :"+l),void 0!==this.clientIncomingCandidatesQueue[t+"-"+l]&&0!==this.clientIncomingCandidatesQueue[t+"-"+l].length&&(this.clientIncomingCandidatesQueue[t+"-"+l].splice(0,this.clientIncomingCandidatesQueue[t+"-"+l].length),delete this.clientIncomingCandidatesQueue[t+"-"+l])},this.processCandidate=function(t){var l=null,s=t.data&&t.data.instanceId?t.data.instanceId:null;ie.debug("Candidate received from callId :"+t.callId+", instanceId is :"+s),l=t.callerId===this.clientId?s?this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.calleeId,s):this.findCallWithCallIdAndRemoteId(t.callId,t.calleeId):s?this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId,s):this.findCallWithCallIdAndRemoteId(t.callId,t.callerId),ie.trace("msg.label :"+t.label),ie.log("msg.candidate :"+t.candidate),null!==l?l.started&&l.remoteDescriptionSetted?l.processCandidateMsg(t):(ie.log("Call not started or remoteDescription is not yet setted"),l.incomingcandidatesQueue.push(t)):s&&(ie.debug("Call not found, Candidate message is not handled, storing candidate message in client"),null!=this.clientIncomingCandidatesQueue[t.callId+"-"+s]||(this.clientIncomingCandidatesQueue[t.callId+"-"+s]=[],ie.debug("First candidate for this call, starting a timeout before candidate storage cleaning"),setTimeout(this.cleanStoredCallCandidate.bind(this),this.cleanStoredCallCandidateTimer,t.callId,s)),this.clientIncomingCandidatesQueue[t.callId+"-"+s].push(t))},this.processUpdate=function(t){ie.info("Update message on:"+t.roomId);var l,s=null;if(null!==(s=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId===this.clientId?t.calleeId:t.callerId,t.data.instanceId)))if(t.hasOwnProperty("sdpoffer")&&t.sdpoffer.hasOwnProperty("sdp"))s.setRemoteCallProfile(this.evalCallProfileWithSdp(t.sdpoffer.sdp,"remote","receive"),!0),s.updateOngoingTimeoutId=setTimeout(function(){delete s.updateOngoingTimeoutId},4e4),this.checkDestCallTypeWithSDP(t.sdpoffer.sdp,s),ie.log("processUpdate : before setRemoteDescription"),l=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpoffer),this.setRemoteDescriptionProcess(s,l),s.doUpdateAnswer();else if((0,h.ki)(t.data,"mesh","object")&&(t.data.mesh.calleeCompositeUserId?t.data.mesh.calleeCompositeUserId===this.compositeClientId:t.data.mesh.calleeId===this.clientId)){ie.debug("mesh update from subscriber");var v={};"AUDIOONLY"===t.data.mediaType?v.audioOnly=!0:"VIDEOONLY"===t.data.mediaType&&(v.videoOnly=!0),this.updateCallConfigurationOnCall(t.callId,v).then(function(){ie.debug("updateCallConfigurationOnCall OK")}).catch(function(r){ie.error("updateCallConfigurationOnCall failed",r)})}else ie.error("update without SDP offer");else this.myWebRTC_Event.createErrorEvent("Cannot find call to process Update","CALL_NOT_FOUND_ON_UPDATE")},this.process200Update=function(t){ie.info("200 Update received from :"+t.calleeId),this.setStatus("You are connected to :"+t.calleeId);var l,s=null,v=null;if(null===(s=this.findCallWithCallIdAndRemoteIdAndInstanceId(t.callId,t.callerId===this.clientId?t.calleeId:t.callerId,t.data.instanceId)))return ie.info("Call not found on 200 Update"),void this.myWebRTC_Event.createErrorEvent("Cannot find call to process 200 Update","CALL_NOT_FOUND_ON_200UPDATE");s.calleeId=t.calleeId,l=this.mySDPManager.createGuideline(t.sdpanswer.sdp),s.setLocalCallProfile(this.evalCallProfileWithSdpGuideline(l,t.sdpanswer.sdp,"remote","send"),!0),s.setRemoteCallProfile(this.evalCallProfileWithSdpGuideline(l,t.sdpanswer.sdp,"remote","receive"),!0),this.evaluateVideoCap(s),!this.rtpSenderSetParamatersCapable&&s.videoCap&&(l.video.bandwidth=s.videoCap,t.sdpanswer.sdp=l.generate()),ie.log("process200Update : before setRemoteDescription"),v=new apiCC.myWebRTC_Adapter.RTCSessionDescription(t.sdpanswer),this.videoBandwidth&&(ie.log("Modification of SDP to set remote video bandwidth"),v.sdp=this.mySDPManager.setVideoBandwidth(v.sdp,this.videoBandwidth)),this.setRemoteDescriptionProcess(s,v),ie.log("msg.sdpanswer.sdp :",t.sdpanswer.sdp),!0===s.addingUserMedia&&(ie.log("adding localvideo in mini"),this.miniVideo&&(this.miniVideo.style.opacity=1),s.addingUserMedia=!1),!0===s.updateUserMedia&&(s.updateUserMedia=!1),s.updateCause&&(s.updateCause=null)},this.processSlowLink=function(t,l){for(var s=this.callsTable.length,v=null;--s>=0;)if(this.callsTable[s].callId===t){v=this.callsTable[s];break}if(null!==v){var r=null;l&&l.advice&&(r=l.advice),this.myWebRTC_Event.createSlowLinkEvent(v.callId,r)}},this.processAudioAmplitude=function(t,l){dt.createAudioAmplitudeEvent(t.descriptor.audioAmplitude,l,t.callId,t.descriptor.streamID)},this.processDistantIceError=function(t){"disconnected"===t.descriptor.iceState?this.myWebRTC_Event.createErrorEvent("distant iceDisconnection detected","DISTANT_ICE_CONNECTION_STATE_DISCONNECTED",null,t.roomId,null,t.descriptor):"failed"===t.descriptor.iceState&&dt.createErrorEvent("distant iceConnection failed detected","DISTANT_ICE_CONNECTION_STATE_FAILED",null,t.roomId,null,t.descriptor)},this.processStreamTrackMuteChanged=function(t,l,s){for(var v=this.callsTable.length,r=null,g=[],E={},te={};--v>=0;)if(this.callsTable[v].callId===t){r=this.callsTable[v];break}if(null!==r){"audio"===l?(r.isRemoteAudioMuted=s,g.push("audioIsMuted"),E.available=r.remoteCallProfile.audio,E.active=r.remoteCallProfile.audioActive,E.muted=r.isRemoteAudioMuted,E.silent=r.isRemoteAudioSilent,te.available=r.remoteCallProfile.video,te.active=r.remoteCallProfile.videoActive,te.muted=r.isRemoteVideoMuted,te.silent=r.isRemoteVideoSilent):"video"===l&&(r.isRemoteVideoMuted=s,g.push("videoIsMuted"),E.available=r.remoteCallProfile.audio,E.active=r.remoteCallProfile.audioActive,E.muted=r.isRemoteAudioMuted,E.silent=r.isRemoteAudioSilent,te.available=r.remoteCallProfile.video,te.active=r.remoteCallProfile.videoActive,te.muted=r.isRemoteVideoMuted,te.silent=r.isRemoteVideoSilent);var ae={eventType:"muteUnmuteEvent",muteType:"applicatif",source:"remote",mLine:l,callId:t};ae.state=s?"mute":"unmute";var Re=function(){ie.debug("getCallIdAndUsername");var Ce="",re="";apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.forEach(function(ee){re=ee.callId});var K=apiCC.Session.getActiveSession();if(null!==K){var L=K.getUserAgent();null!=L&&(Ce=L.username)}var ne={callId:re,username:Ce};return ie.debug("getCallIdAndUsername result:",ne),ne}();ae.callId=Re.callId,ae.username=Re.username,apiRTC.sendSentryEvent(ae),g.length>0&&this.myWebRTC_Event.createRemoteStreamUpdatedEvent(g,E,te,r.destCallType,r.callId,"userAction")}},this.processStreamTrackStatusChanged=function(t,l,s){for(var v=this.callsTable.length,r=null,g=[],E={},te={};--v>=0;)if(this.callsTable[v].callId===t){r=this.callsTable[v];break}if(null!==r){"audio"===l?(r.isRemoteAudioSilent=s,g.push("audioIsSilent"),E.available=r.remoteCallProfile.audio,E.active=r.remoteCallProfile.audioActive,E.muted=r.isRemoteAudioMuted,E.silent=r.isRemoteAudioSilent,te.available=r.remoteCallProfile.video,te.active=r.remoteCallProfile.videoActive,te.muted=r.isRemoteVideoMuted,te.silent=r.isRemoteVideoSilent):"video"===l&&(r.isRemoteVideoSilent=s,g.push("videoIsSilent"),E.available=r.remoteCallProfile.audio,E.active=r.remoteCallProfile.audioActive,E.muted=r.isRemoteAudioMuted,E.silent=r.isRemoteAudioSilent,te.available=r.remoteCallProfile.video,te.active=r.remoteCallProfile.videoActive,te.muted=r.isRemoteVideoMuted,te.silent=r.isRemoteVideoSilent);var ae={eventType:"muteUnmuteEvent",muteType:"hardware",source:"remote",mLine:l,callId:t};ae.state=s?"mute":"unmute";var Re=function(){ie.debug("getCallIdAndUsername");var Ce="",re="";apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.forEach(function(ee){re=ee.callId});var K=apiCC.Session.getActiveSession();if(null!==K){var L=K.getUserAgent();null!=L&&(Ce=L.username)}var ne={callId:re,username:Ce};return ie.debug("getCallIdAndUsername result:",ne),ne}();ae.callId=Re.callId,ae.username=Re.username,apiRTC.sendSentryEvent(ae),g.length>0&&this.myWebRTC_Event.createRemoteStreamUpdatedEvent(g,E,te,r.destCallType,r.callId,"userAction")}},this.processUpdateStream=function(t,l,s){for(var v=this.callsTable.length,r=null;--v>=0;)if((0,h.ki)(this.callsTable[v].data,"mesh","object")&&this.callsTable[v].data.mesh.calleeCallId===t||this.callsTable[v].callId===t){r=this.callsTable[v];break}if(!r)return!1;var g=!1;return"audio"===l?"inactive"===s?"media"===r.callType&&(r.callType="videoOnly",r.updateUserMedia=!0,r.updateCause="adaptation",r.audioSdpDirection="inactive",r.establishCall(),g=!0):"videoOnly"===r.callType&&(r.callType="media",r.updateUserMedia=!0,r.updateCause="adaptation",r.audioSdpDirection=null,r.establishCall(),g=!0):"video"===l&&("inactive"===s?"media"===r.callType&&(this.evalOutgoingVideoBandwithCap(r),r.callType="audio",r.updateUserMedia=!0,r.updateCause="adaptation",r.videoSdpDirection="inactive",r.establishCall(),g=!0):"audio"===r.callType&&(this.evalOutgoingVideoBandwithCap(r),r.callType="media",r.updateUserMedia=!0,r.updateCause="adaptation",r.videoSdpDirection=null,r.establishCall(),g=!0)),g},this.processUpdateVideoQuality=function(t,l){ie.debug("processUpdateVideoQuality",t,l);var s=this.findCallWithCallId(t);if(s)if(s.sessionMCU&&"mesh"!==s.sessionMCU.roomMode){var v=apiCC.getUserMediaStream(s.callConfiguration.userMediaStreamId);if(v){var r=v.getVideoTrack();if(r){var g={};l.width&&l.height&&(g.width=l.width,g.height=l.height),l.frameRate&&(g.frameRate=l.frameRate),r.applyConstraints(g).then(function(E){ie.debug("processUpdateVideoQuality - applyConstraints; OK")}).catch(function(E){ie.error("processUpdateVideoQuality - applyConstraints",E)})}else ie.warn("processUpdateVideoQuality - no such video track; callId:",t)}else ie.warn("processUpdateVideoQuality - no such userMediaStream; callId:",t)}else ie.warn("processUpdateVideoQuality - wrong roomMode; callId:",t);else ie.warn("processUpdateVideoQuality - no such call; callId:",t)},this.removeAllCallsFromRoom=function(t,l){ie.info("removeAllCallsFromRoom :"+t+" with reason :"+l);var s,v,r=this.callsTable.length,g=[];for(s=0;s<r;s+=1)this.callsTable[s].dest_roomId==t&&(ie.log("Call is attached to the room, removing ..."),g.push({callId:this.callsTable[s].callId}));for(v=0;v<g.length;v+=1)this.removeCallFromTableWithCallIdAndSendBye(g[v].callId,l);g.splice(0,g.length)},this.onHangup=function(t,l){var s=null,v=null,r=null,g=null,E=[],te=!1,ae=!1,Re=null,Ce=null;if(t?"string"!=typeof t&&(t=String(t)):t=null,l?"string"!=typeof l&&(l=null):l=null,this.setStatus("<div>Your phone is registered, you can be reached at this number : "+this.clientId+"</div>"),ie.info("Hanging up."),this.initMediaElementState(),null===t)ie.log("Leaving all calls that are established"),this.MCUClient&&this.MCUClient.meshOnHangup(),this.removeAllCalls(),this.callControlTable.splice(0,this.callControlTable.length);else if(null!==(v=this.findUserMediaById(t))){for("janusConnector"!==this.MCUClient.pubConnector||"RTC_Setup_Timeout"!==l&&"disconnected"!==l||(r=v.getUserMediaStream())&&r.stream&&("mesh"===v.sessionMCU.roomMode?(te=!0,ae=!0,Re=r.stream,v.streamStolen=!0):(te=!0,Re=r.stream,v.streamStolen=!0,(Ce=r.getCallInfo(v.userMediaId))&&(Ce.flavor="call"))),g=this.callsTable.length;--g>=0;)(0,h.Ym)(this.callsTable[g].data,"object")&&(0,h.Ym)(this.callsTable[g].data.mesh,"object")&&this.callsTable[g].data.mesh.calleeCallId===t&&E.push(this.callsTable[g].callId);for(g=E.length;--g>=0;)this.removeCallFromTableWithCallIdAndSendBye(E[g],l);this.MCUClient.meshOnHangup(t,null,{restart:te})}else null!==(s=this.findCallWithCallId(t))&&("janusConnector"!==this.MCUClient.pubConnector||"RTC_Setup_Timeout"!==l&&"disconnected"!==l||("publish"===s.settingUpType||"shareScreen"===s.settingUpType?s.data&&s.data.mesh||(te=!0,s.streamStolen=!0):"subscribe"===s.settingUpType&&(te=!0)),ie.log("Leaving call with callId :"+t),this.removeCallFromTableWithCallIdAndSendBye(t,l));this.displayCallButtonInCommand(),!0===te?null!==s?this.restartCall(s):null!==v&&this.restartCall(v,!0===ae?{userMedia:!0,mesh:!0}:{userMedia:!0,stream:Re}):(s&&s.callControl&&this.destroyCallControl(s.callControl),this.stopMaxCallRetriesTimer(t),this.stopRestartCallTimer(t),delete this.callsRetriesTable[t])},this.stopStream=function(t){ie.info("stopStream in client");var l,s=null;if("Chrome"===d.Xh&&d.PR<45||"Firefox"===d.Xh&&d.PR<44||"Opera"===d.Xh&&d.PR<34||"Chromium"===d.Xh&&d.PR<44||"Chrome WebView"===d.Xh&&d.PR<45)t.onended=null,t.stop();else{for(t.onended=null,ie.log("MediaStream.stop is now deprecated, using MediaStreamTrack.stop"),s=t.getTracks(),l=0;l<s.length;l+=1)s[l].onended=null,s[l].stop();ie.log("... tracks stopped")}t=null},this.clearCallTimeouts=function(t){var l;for(ie.debug("clearCallTimeouts"),0!==t.send200OKTrickleIceFalseTimeOutId&&(ie.debug("clearing send200OKTrickleIceFalseTimeOutId"),clearTimeout(t.send200OKTrickleIceFalseTimeOutId),t.send200OKTrickleIceFalseTimeOutId=0),0!==t.sendInviteTrickleIceFalseTimeOutId&&(ie.debug("clearing sendInviteTrickleIceFalseTimeOutId"),clearTimeout(t.sendInviteTrickleIceFalseTimeOutId),t.sendInviteTrickleIceFalseTimeOutId=0),0!==t.disconnectionTimeoutId&&(ie.debug("clearing disconnectionTimeout"),clearTimeout(t.disconnectionTimeoutId),t.disconnectionTimeoutId=0),0!==t.disconnectionWarningInterval&&(ie.debug("clearing disconnectionWarningInterval"),clearInterval(t.disconnectionWarningInterval),t.disconnectionWarningInterval=0),l=0;l<t.checkCandidateTypesTimeoutTable.length;l+=1)ie.debug("clearing checkCandidateTypesTimeout :",t.checkCandidateTypesTimeoutTable[l]),clearTimeout(t.checkCandidateTypesTimeoutTable[l]);t.checkCandidateTypesTimeoutTable.splice(0,t.checkCandidateTypesTimeoutTable.length)},this.removeAllCalls=function(){ie.info("removeAllCalls");var t,l=this.callsTable.length,s=0,r=null,g=0,E=null;for(ie.log("callsNumber = "+l),t=0;t<l;t+=1){if(s=this.callsTable[t-g].callee?this.callsTable[t-g].callerId:this.callsTable[t-g].calleeId,!0===this.callsTable[t-g].callee)this.callsTable[t-g].myWebRTC_Stack.sendBye(this.callsTable[t-g].callId,this.clientId,this.callsTable[t-g].dest_roomId,s,r="Hangup_From_Callee",this.callsTable[t-g].data);else{if(r="Hangup_From_Caller",!0!==this.callsTable[t-g].inviteSended){this.callsTable[t-g].callCancelled=!0,ie.warn("Leaving call iteration on removeAllCalls");continue}this.callsTable[t-g].myWebRTC_Stack.sendBye(this.callsTable[t-g].callId,this.clientId,this.callsTable[t-g].dest_roomId,s,r,this.callsTable[t-g].data)}(0,h.ki)(this.callsTable[t-g].sessionMCU,"roomName","string")&&(0,h.ki)(this.callsTable[t-g].data,"MCUType","string")&&("MCU-Caller"===this.callsTable[t-g].data.MCUType||"MCU-Callee"===this.callsTable[t-g].data.MCUType)&&this.MCUClient.leaveSession(this.callsTable[t-g].sessionMCU.roomName,{noHangup:!0}),this.callsTable[t-g].callConfiguration&&this.callsTable[t-g].callConfiguration.userMediaStreamId&&(E=apiCC.getUserMediaStream(this.callsTable[t-g].callConfiguration.userMediaStreamId))&&apiCC.releaseUserMediaStream(E.userMediaStreamId,this.callsTable[t-g].callId),null!==this.callsTable[t-g].screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.callsTable[t-g].screenStream),dt.createUserMediaStopEvent(this.callsTable[t-g].callId,"screen")),null!==this.callsTable[t-g].pc&&(ie.log("Closing PC"),this.qosEnable&&null!=this.callsTable[t-g].qm&&"function"==typeof this.callsTable[t-g].qm.saveStatsToDb&&(this.callsTable[t-g].qm.saveStatsToDb(!0),clearInterval(this.callsTable[t-g].statisticId)),this.callsTable[t-g].csmIntervalId&&clearInterval(this.callsTable[t-g].csmIntervalId),this.callsTable[t-g].pc.close(),this.callsTable[t-g].pc=null),this.removeRemoteVideoDisplay(this.callsTable[t-g].callId+"-"+this.callsTable[t-g].calleeId),this.myWebRTC_Event.createHangupEvent("local",this.clientId,this.callsTable[t-g].remoteId,!0,r,this.callsTable[t-g].callId,this.callsTable[t-g].callType),null!=this.callsTable[t-g].data&&("janusConnector"===this.callsTable[t-g].data.pubSub||"MCU-Caller"!==this.callsTable[t-g].data.MCUType&&"MCU-Callee"!==this.callsTable[t-g].data.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(this.callsTable[t-g].data.confId,this.callsTable[t-g].callerId,this.callsTable[t-g].calleeId,this.callsTable[t-g].callId)),this.clearCallTimeouts(this.callsTable[t-g]),0!==this.callsTable[t-g].incomingcandidatesQueue.length&&this.callsTable[t-g].incomingcandidatesQueue.splice(0,this.callsTable[t-g].incomingcandidatesQueue.length),void 0!==this.clientIncomingCandidatesQueue[this.callsTable[t-g].callId+"-"+this.callsTable[t-g].instanceId]&&0!==this.clientIncomingCandidatesQueue[this.callsTable[t-g].callId+"-"+this.callsTable[t-g].instanceId].length&&this.clientIncomingCandidatesQueue[this.callsTable[t-g].callId+"-"+this.callsTable[t-g].instanceId].splice(0,this.clientIncomingCandidatesQueue[this.callsTable[t-g].callId+"-"+this.callsTable[t-g].instanceId].length),ie.log("Removing call from table"),this.callsTable.splice(t-g,1),g+=1}},this.onRemoteHangup=function(t,l,s,v,r,g){var E=this;ie.debug("onRemoteHangup");var te=null,ae=null,Re=null,Ce=null,re=!1,K=!1,L=!1,ne=null,ee=null;if(ie.log("callId :"+t),ie.log("confId :"+r),"janusConnector"===this.MCUClient.pubConnector)if("RTC_Setup_Timeout"===v||"Broken_by_MCU"===v||"disconnected"===v)if(null!=(ae=null==g?this.findCallWithCallId(t):this.findCallWithCallIdAndInstanceId(t,g.instanceId))){if(ae.setupTimeoutId&&(clearTimeout(ae.setupTimeoutId),delete ae.setupTimeoutId),!0===ae.restarting)return void ie.debug("call restarting");if("publish"===ae.settingUpType||"shareScreen"===ae.settingUpType?ae.data&&ae.data.mesh||(re=!0,ae.streamStolen=!0):"subscribe"===ae.settingUpType&&(re=!0),null!==ae.sessionMCU&&"old"===ae.sessionMCU.modeChangeKind)return void ie.debug("onRemoteHangup ignore")}else null!==(Re=this.findUserMediaById(t))?(Re.close(),(Ce=Re.getUserMediaStream())&&Ce.stream&&(null!==Re.sessionMCU&&"old"===Re.sessionMCU.modeChangeKind?(re=!0,ne=Ce.stream,Re.streamStolen=!0,Re.distantCalls.length>0&&(L=!0),(ee=Ce.getCallInfo(Re.userMediaId))&&(ee.flavor="call")):null!==Re.sessionMCU&&"mesh"===Re.sessionMCU.roomMode?(re=!0,K=!0,ne=Ce.stream,Re.streamStolen=!0):(re=!0,ne=Ce.stream,Re.streamStolen=!0,(ee=Ce.getCallInfo(Re.userMediaId))&&(ee.flavor="call")))):ie.debug("No call and no userMedia found");else(ae=null==g?this.findCallWithCallId(t):this.findCallWithCallIdAndInstanceId(t,g.instanceId))?(ae.setupTimeoutId&&(clearTimeout(ae.setupTimeoutId),delete ae.setupTimeoutId),"subscribe"===ae.settingUpType&&(re=!0)):(Re=this.findUserMediaById(t))&&Re.close();if(!L)if(null!==Re){var ce=null,me=[];for(ce=this.callsTable.length;--ce>=0;)(0,h.ki)(this.callsTable[ce].data,"mesh","object")&&this.callsTable[ce].data.mesh.calleeCallId===t&&"subscribe"!==this.callsTable[ce].settingUpType&&me.push(this.callsTable[ce].callId);for(ce=me.length;--ce>=0;)this.removeCallFromTableWithCallIdAndSendBye(me[ce],v);if(this.MCUClient.meshOnHangup(t),"old"===Re.sessionMCU.modeChangeKind){var Te=this.MCUClient.getSessionMCU(null,{callback:function(ge){return ge.roomName===Re.sessionMCU.roomName&&"new"===ge.modeChangeKind}});Te&&this.finalizeMeshToJanusTransition(Re.sessionMCU,Te)}}else void 0!==t?te=null==g?this.removeCallFromTableWithCallIdandRemoteId(t,l,v):this.removeCallFromTableWithCallIdandInstanceId(t,g.instanceId,v):void 0!==r&&(te=this.removeCallFromTableWithConfIdandRemoteId(r,l,v));ie.log("Reason : "+v),void 0===v?this.setStatus("<div>Your partner : "+l+" have left the call. you can be reached at this number : "+this.clientId+"</div>"):(this.setStatus("<div>Call hangup with reason : "+v+". you can be reached at this number : "+this.clientId+"</div>"),ie.log("Remote Hangup for reason : "+v)),ae&&!0!==re?0===this.callsTable.length&&0===this.userMediaTable.length?(ie.log("No more established calls for client"),this.initMediaElementState(),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,l,!0,v),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,l,!0,v,t,te),this.displayCallButtonInCommand(),!0===this.getUserMediaOnGoing&&!0!==G.deactivateReloadOnCancel&&(ie.log("Cancel from Remote"),"undefined"==typeof apiRTC_React&&location.reload(),this.getUserMediaOnGoing=!1)):(ie.log("Other calls are still established"),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,l,!1,v),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,l,!1,v,t,te)):ae&&"subscribe"===ae.settingUpType&&(this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,l,!1,"restarted"),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,l,!1,"restarted",t,te)),null!=g&&("janusConnector"===this.MCUClient.pubConnector||"MCU-Caller"!==g.MCUType&&"MCU-Callee"!==g.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(r,this.clientId,l,t)),!0===re?null!==ae?this.restartCall(ae):null!==Re&&(!0===K?this.restartCall(Re,{userMedia:!0,mesh:!0}):this.randomDelayOnRestart?(ie.debug("onRemoteHangup - randomDelayOnRestart"),setTimeout(function(){E.restartCall(Re,{userMedia:!0,stream:ne})},5e3*Math.random())):this.restartCall(Re,{userMedia:!0,stream:ne})):(ae&&ae.callControl&&this.destroyCallControl(ae.callControl),(ae||Re)&&(this.stopMaxCallRetriesTimer(t),this.stopRestartCallTimer(t),delete this.callsRetriesTable[t]))},this.startMaxCallRetriesTimer=function(t){var l=this;ie.debug("startMaxCallRetriesTimer for callIdWhenStartingTimer :",t);var s=setTimeout(function(){ie.debug("[restartCall] MaxCallRetriesTimer reached for callIdWhenStartingTimer :",t),l.callsRetriesTable[t].allowedStatus=!1,delete l.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId},this.maxCallsRetriesDuration);this.callsRetriesTable[t]={},this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId=s},this.stopMaxCallRetriesTimer=function(t){ie.debug("stopMaxCallRetriesTimer for callId :",t),void 0!==this.callsRetriesTable[t]&&void 0!==this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId&&(clearTimeout(this.callsRetriesTable[t].maxCallsRetriesDurationTimeOutId),ie.debug("[restartCall] MaxCallRetriesTimer cleared for callId :",t),delete this.callsRetriesTable[t])},this.stopRestartCallTimer=function(t){ie.debug("stopRestartCallTimer for callId :",t),void 0!==this.callsRetriesTable[t]&&void 0!==this.callsRetriesTable[t].restartCallTimeOutId&&(clearTimeout(this.callsRetriesTable[t].restartCallTimeOutId),ie.error("[restartCall] RestartCallTimer cleared for callId :",t),delete this.callsRetriesTable[t].restartCallTimeOutId)},this.restartCall=function(t){var l=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ie.debug("[restartCall] restartCall for callId :",t.callId);var v=-1;if(!0!==s.userMedia)if(t.callControl&&t.callControl.autoRestart)if(0===(v=t.callControl.autoRestart.counter)&&(t.callControl.autoRestart.callIdWhenStartingTimer=t.callId,this.startMaxCallRetriesTimer(t.callId)),void 0!==this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&void 0===this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].allowedStatus){ie.debug("[restartCall] ... for callIdWhenStartingTimer :",t.callControl.autoRestart.callIdWhenStartingTimer),ie.debug("AutoRestartCounter :",v),ie.debug("Calling restartCallProcess in :",this.restartCallDelay*Math.pow(2,v));var r=setTimeout(function(){ie.debug("Timer reached for restartCall"),delete t.callControl.autoRestart.pending,l.restartCallProcess(t,s),void 0!==l.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&void 0!==l.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId&&delete l.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId},this.restartCallDelay*Math.pow(2,v));t.callControl.autoRestart.pending=!0,this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer].restartCallTimeOutId=r}else ie.warn("CALL_ABORTED, retries not allowed (maxCallsRetriesDuration reached) for callIdWhenStartingTimer :",t.callControl.autoRestart.callIdWhenStartingTimer),this.destroyCallControl(t.callControl),dt.createErrorEvent("call aborted after calls retries (maxCallsRetriesDuration reached)","CALL_ABORTED",t.callId,t.callControl.roomName),void 0!==this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer]&&delete this.callsRetriesTable[t.callControl.autoRestart.callIdWhenStartingTimer];else ie.debug("[restartCall] autoRestart options not defined");else this.restartCallProcess(t,s)},this.restartCallProcess=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ie.debug("restartCallProcess ");var s=!1,v=!1,r=null;if(!0!==t.restarting){if(t.restarting=!0,!0===l.userMedia&&(s=!0),!0===l.mesh&&(v=!0),!0===s)if(!0===v)"screenSharing"===t.callType||"screenSharingWithAudio"===t.callType?(t.restarting=!1,this.userMediaTable.push(t),this.MCUClient.meshOnScreenMediaSuccess(t)):(t.restarting=!1,this.userMediaTable.push(t),this.MCUClient.meshOnUserMediaSuccess(t));else if("screenSharing"===t.callType||"screenSharingWithAudio"===t.callType){delete t.data.meshPublish,t.data.type="publish";var g=this.createCallControl({type:"shareScreen",callId:t.userMediaId,roomName:t.roomId,callConfiguration:t.callConfiguration,data:t.data});g.captureSourceType=t.captureSourceType,g.autoRestart.counter=0,g.autoRestart.stream=l.stream,this.shareScreen(t.roomId,t.data,t.captureSourceType,t.callConfiguration,{callControl:g}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.userMediaId,t.userMediaId,"publish",this.clientId,t.roomId,t.roomId,null)}else{delete t.data.meshPublish;var E=this.createCallControl({type:"publish",callId:t.userMediaId,callType:t.callType,roomName:t.roomId,callConfiguration:t.callConfiguration,data:t.data});E.audioOnly="audio"===t.callType,E.sessionId=t.sessionId,E.token=t.token,E.autoRestart.counter=0,E.autoRestart.stream=l.stream,this.MCUClient.publish(t.roomId,t.sessionId,t.token,t.callConfiguration,t.data,{callControl:E}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,"audio"===t.callType,t.userMediaId,t.userMediaId,"publish",this.clientId,t.roomId,t.roomId,null)}else if("publish"===t.settingUpType)(0,h.Ym)(t.callControl,"object")?(ie.debug("[restartCall] restarting call publish"),this.MCUClient.publish(t.callControl.roomName,t.callControl.sessionId,t.callControl.token,t.callControl.callConfiguration,t.callControl.data,{callControl:t.callControl}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.callId,t.callId,"publish",this.clientId,t.callControl.roomName,t.callControl.roomName,null)):ie.warn("[restartCall] cannot auto restart; missing info");else if("shareScreen"===t.settingUpType)(0,h.Ym)(t.callControl,"object")?(ie.debug("[restartCall] restarting call shareScreen"),this.shareScreen(t.callControl.roomName,t.callControl.data,t.callControl.captureSourceType,t.callControl.callConfiguration,{callControl:t.callControl}),this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,t.callId,t.callId,"publish",this.clientId,t.callControl.roomName,t.callControl.roomName,null)):ie.warn("[restartCall] cannot auto restart; missing info");else if("subscribe"===t.settingUpType&&(ie.debug("[restartCall] restarting call subscribe"),r=!0===t.mcuRemoteStream.replay?this.MCUClient.getStreamOfUserCall(t.mcuRemoteStream.attributes.callerId,t.mcuRemoteStream.attributes.callId,{replay:!0}):this.MCUClient.getStreamOfUserCall(t.mcuRemoteStream.attributes.callerId,t.mcuRemoteStream.attributes.callId),(0,h.Ym)(t.callControl,"object")&&r)){ie.debug("[restartCall] stream exists, subscribing to it");var te=!!t.callControl.autoRestart.force;delete t.callControl.autoRestart.force;var ae=t.callControl.callId,Re=this.MCUClient.subscribeToStreams([r],t.callControl.mediaType,t.callControl.data,t.callControl.callConfiguration,{noStreamCheck:!0,autoSub:!0,force:te});ae&&Re[0]&&this.myWebRTC_Event.createCallRestartingEvent(t.callType,t.audioOnly,ae,Re[0],"subscribe",this.clientId,t.callControl.roomName,t.callControl.roomName,r.id)}}else ie.debug("[restartCall] call already restarting")},this.closingCallProcess=function(t,l){ie.log("Session terminated.");var s=null;(0,h.ki)(this.callsTable[t].sessionMCU,"roomName","string")&&(0,h.ki)(this.callsTable[t].data,"MCUType","string")&&("MCU-Caller"===this.callsTable[t].data.MCUType||"MCU-Callee"===this.callsTable[t].data.MCUType)&&this.MCUClient.leaveSession(this.callsTable[t].sessionMCU.roomName),this.callsTable[t].callConfiguration&&this.callsTable[t].callConfiguration.userMediaStreamId&&!0!==this.callsTable[t].streamStolen&&(s=apiCC.getUserMediaStream(this.callsTable[t].callConfiguration.userMediaStreamId))&&apiCC.releaseUserMediaStream(s.userMediaStreamId,this.callsTable[t].callId),null!==this.callsTable[t].screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.callsTable[t].screenStream),dt.createUserMediaStopEvent(this.callsTable[t].callId,"screen")),null!==this.callsTable[t].pc&&(ie.log("Closing PC"),this.qosEnable&&null!=this.callsTable[t].qm&&"function"==typeof this.callsTable[t].qm.saveStatsToDb&&(this.callsTable[t].qm.saveStatsToDb(!0),clearInterval(this.callsTable[t].statisticId)),this.callsTable[t].csmIntervalId&&clearInterval(this.callsTable[t].csmIntervalId),this.callsTable[t].beginTimeoutId&&(clearTimeout(this.callsTable[t].beginTimeoutId),delete this.callsTable[t].beginTimeoutId),this.callsTable[t].dcfs?"Ice_failed"===l?this.callsTable[t].dcfs.failure="iceFailed":this.callsTable[t].dcfs.canceled=!0:"data"===this.callsTable[t].callType&&"dataChannelConnector"===this.callsTable[t].calleeId&&(this.callsTable[t].failure||this.callsTable[t].success||setTimeout(function(v,r){dt.createEvent({eventType:"onFileSended",callId:v.callId,remoteId:v.remoteId,name:v.data.filename,error:r}),v.callbacks&&v.callbacks.failure&&v.callbacks.failure(r)},0,this.callsTable[t],"Ice_failed"===l?"iceFailed":"canceled")),this.callsTable[t].pc.close(),this.callsTable[t].pc=null)},this.removeCallProcess=function(t){var s=this,v=this.callsTable[t];this.clearCallTimeouts(v),0!==v.incomingcandidatesQueue.length&&v.incomingcandidatesQueue.splice(0,v.incomingcandidatesQueue.length),void 0!==this.clientIncomingCandidatesQueue[v.callId+"-"+v.instanceId]&&0!==this.clientIncomingCandidatesQueue[v.callId+"-"+v.instanceId].length&&this.clientIncomingCandidatesQueue[v.callId+"-"+v.instanceId].splice(0,this.clientIncomingCandidatesQueue[v.callId+"-"+v.instanceId].length),ie.log("Removing call from table"),this.callsTable.splice(t,1),ie.log("this.callsTable.length :",this.callsTable.length),ie.log("Call is terminated"),setTimeout(function(){s.startNextPushData()}),this.miniVideo&&0!==this.callsTable.length&&(ie.log("calling attachMediaStream"),apiCC.attachMediaStream(this.miniVideo,this.callsTable[0].callLocalStream)),this.evalOutgoingVideoBandwithCap()},this.removeCallFromTableWithCallIdAndSendBye=function(t,l){ie.debug("removeCallFromTableWithCallIdAndSendBye()",t);var s,r=null;if(-1!==(s=this.findCallIndexWithCallId(t))){if(this.closingCallProcess(s,l),this.removeRemoteVideoDisplay(this.callsTable[s].callId+"-"+this.callsTable[s].calleeId),this.callsTable[s].callee?(r=this.callsTable[s].callerId,null===l&&(l="Hangup_From_Callee")):(r=this.callsTable[s].calleeId,null===l&&(l="Hangup_From_Caller")),ie.log("reason is :"+l),"LOCAL"!==this.callsTable[s].calleeId){var g=apiCC.session.getConnectedUserInfo(this.callsTable[s].calleeId,"userData"),E=null;if("User_Not_Found"!==g)try{E=JSON.parse(g)}catch(te){ie.error("userInfo parse fail",g)}null!=E&&"true"===E.isSimulated?apiCC.session.channel.socket.emit("simulatedAgentCancelCallRequest",{number:this.callsTable[s].calleeId,callId:t}):this.callsTable[s].myWebRTC_Stack.sendBye(this.callsTable[s].callId,this.clientId,this.callsTable[s].dest_roomId,r,l,this.callsTable[s].data)}"Broken_by_MCU"!==l&&this.myWebRTC_Event.createHangupEvent("local",this.clientId,this.callsTable[s].remoteId,!0,l,this.callsTable[s].callId,this.callsTable[s].callType),null!=this.callsTable[s].data&&("janusConnector"===this.callsTable[s].data.pubSub||"MCU-Caller"!==this.callsTable[s].data.MCUType&&"MCU-Callee"!==this.callsTable[s].data.MCUType||this.myWebRTC_Event.createRecordedStreamsAvailableEvent(this.callsTable[s].data.confId,this.callsTable[s].callerId,this.callsTable[s].calleeId,this.callsTable[s].callId)),this.removeCallProcess(s)}else ie.log("No call removed");this.MCUClient.publishCallId===t&&(this.publishCallId=null)},this.removeCall=function(t){ie.info("removeCall");var s=null;return-1!==t?(this.closingCallProcess(t,null),0!==this.callsTable[t].disconnectionWarningTimeout&&(ie.debug("clearing disconnectionWarningTimeout"),clearTimeout(this.callsTable[t].disconnectionWarningTimeout),this.callsTable[t].disconnectionWarningTimeout=0),this.removeRemoteVideoDisplay(this.callsTable[t].callId+"-"+this.callsTable[t].calleeId),s=this.callsTable[t].callType,this.removeCallProcess(t)):ie.debug("No call removed"),s},this.removeCallFromTableWithConfIdandRemoteId=function(t,l,s){var v;return ie.debug("removeCallFromTableWithConfIdandRemoteId() with reason :"+s),s=null,v=this.findCallIndexWithConfIdAndRemoteId(t,l),this.removeCall(v)},this.removeCallFromTableWithCallIdandRemoteId=function(t,l,s){var v;return ie.debug("removeCallFromTableWithCallIdandRemoteId() with reason :"+s),ie.log("callId :"+t),ie.log("remoteId :"+l),s=null,v=this.findCallIndexWithCallIdAndRemoteId(t,l),this.removeCall(v)},this.removeCallFromTableWithCallIdandInstanceId=function(t,l,s){var v;return ie.debug("removeCallFromTableWithCallIdandInstanceId() with reason :"+s),ie.log("callId :"+t),ie.log("instanceId :"+l),s=null,v=this.findCallIndexWithCallIdAndInstanceId(t,l),this.removeCall(v)},this.transitionToActive=function(){ie.debug("transitionToActive"),this.remoteVideo&&(this.remoteVideo.style.opacity=1),setTimeout(this.callback(this,"callback2"),1e3)},this.callback2=function(){this.miniVideo&&(this.miniVideo.style.opacity=1)},this.initMediaElementState=function(){!1===this.autoAnswer?this.localVideo&&(this.localVideo.style.opacity=0,this.localVideo.src=""):this.localVideo&&(this.localVideo.style.opacity=1),this.remoteVideo&&(this.remoteVideo.style.opacity=0,this.remoteVideo.src=""),this.miniVideo&&(this.miniVideo.style.opacity=0),!0===this.autoAnswer?ie.log("autoAnswer Activated : localStream is not stopped"):this.miniVideo&&(this.miniVideo.src="")},this.toggleVideoMute=function(t){ie.debug("toggleVideoMute");var l,s,v=this.callsTable.length,r=null,g=null;if(null==t){for(ie.debug("no callId defined, toggleVideoMute all local video"),this.isVideoMuted?null!==this.localStream&&(ie.debug("localStream unMuteTracks"),this.unMuteTracks(this.localStream.getVideoTracks())):null!==this.localStream&&(ie.debug("localStream muteTracks"),this.muteTracks(this.localStream.getVideoTracks())),this.isVideoMuted=!this.isVideoMuted,l=0;l<v;l+=1)this.callsTable[l].data&&this.callsTable[l].data.mesh||(g=null,this.callsTable[l].callConfiguration&&(g=apiCC.getUserMediaStream(this.callsTable[l].callConfiguration.userMediaStreamId)),g?g.videoMuted?g.unMuteVideoOnStreams("enabled"):g.muteVideoOnStreams("enabled"):null!==this.callsTable[l].callLocalStream&&(this.callsTable[l].isLocalVideoMuted?(ie.debug("unmuting call :",this.callsTable[l].callId),this.unMuteTracks(this.callsTable[l].callLocalStream.getVideoTracks())):(ie.debug("muting call :",this.callsTable[l].callId),this.muteTracks(this.callsTable[l].callLocalStream.getVideoTracks())),this.callsTable[l].isLocalVideoMuted=!this.callsTable[l].isLocalVideoMuted));for(v=this.userMediaTable.length,l=0;l<v;l+=1)g=null,this.userMediaTable[l].callConfiguration&&(g=apiCC.getUserMediaStream(this.userMediaTable[l].callConfiguration.userMediaStreamId)),g&&(g.videoMuted?g.unMuteVideoOnStreams("enabled"):g.muteVideoOnStreams("enabled"));return{muteState:this.isVideoMuted,callId:"ALL"}}return ie.debug("callId is defined :",t),(s=this.findCallIndexWithCallId(t))>=0?(this.callsTable[s].callConfiguration&&(g=apiCC.getUserMediaStream(this.callsTable[s].callConfiguration.userMediaStreamId)),g?(g.videoMuted?g.unMuteVideoOnStreams("enabled"):g.muteVideoOnStreams("enabled"),{muteState:g.videoMuted,callId:t}):null!==this.callsTable[s].callLocalStream?(this.callsTable[s].isLocalVideoMuted?(ie.debug("unmuting call :",this.callsTable[s].callId),this.unMuteTracks(this.callsTable[s].callLocalStream.getVideoTracks())):(ie.debug("muting call :",this.callsTable[s].callId),this.muteTracks(this.callsTable[s].callLocalStream.getVideoTracks())),this.callsTable[s].isLocalVideoMuted=!this.callsTable[s].isLocalVideoMuted,{muteState:this.callsTable[s].isLocalVideoMuted,callId:t}):{muteState:"STREAM_NOT_FOUND",callId:t}):(r=this.findUserMediaById(t))&&(r.callConfiguration&&(g=apiCC.getUserMediaStream(r.callConfiguration.userMediaStreamId)),g)?(g.videoMuted?g.unMuteVideoOnStreams("enabled"):g.muteVideoOnStreams("enabled"),{muteState:g.videoMuted,callId:t}):{muteState:"CALL_NOT_FOUND",callId:t}},this.unMuteTracks=function(t){var l;if(0!==t.length){for(l=0;l<t.length;l+=1)t[l].enabled=!0;ie.log("tracks unMuted.")}else ie.log("No tracks available.")},this.muteTracks=function(t){var l;if(0!==t.length){for(l=0;l<t.length;l+=1)t[l].enabled=!1;ie.log("tracks muted.")}else ie.log("No tracks available.")},this.toggleAudioMute=function(t){ie.debug("toggleAudioMute");var l,s,v=this.callsTable.length,r=null,g=null;if(null==t){for(ie.debug("no callId defined, toggleAudioMute all local audio"),this.isAudioMuted?null!==this.localStream&&(ie.debug("localStream unMuteTracks"),this.unMuteTracks(this.localStream.getAudioTracks())):null!==this.localStream&&(ie.debug("localStream muteTracks"),this.muteTracks(this.localStream.getAudioTracks())),this.isAudioMuted=!this.isAudioMuted,l=0;l<v;l+=1)this.callsTable[l].data&&this.callsTable[l].data.mesh||(g=null,this.callsTable[l].callConfiguration&&(g=apiCC.getUserMediaStream(this.callsTable[l].callConfiguration.userMediaStreamId)),g?g.audioMuted?g.unMuteAudioOnStreams("enabled"):g.muteAudioOnStreams("enabled"):null!==this.callsTable[l].callLocalStream&&(this.callsTable[l].isLocalAudioMuted?(ie.debug("unmuting call :",this.callsTable[l].callId),this.unMuteTracks(this.callsTable[l].callLocalStream.getAudioTracks())):(ie.debug("muting call :",this.callsTable[l].callId),this.muteTracks(this.callsTable[l].callLocalStream.getAudioTracks())),this.callsTable[l].isLocalAudioMuted=!this.callsTable[l].isLocalAudioMuted));for(v=this.userMediaTable.length,l=0;l<v;l+=1)g=null,this.userMediaTable[l].callConfiguration&&(g=apiCC.getUserMediaStream(this.userMediaTable[l].callConfiguration.userMediaStreamId)),g&&(g.audioMuted?g.unMuteAudioOnStreams("enabled"):g.muteAudioOnStreams("enabled"));return{muteState:this.isAudioMuted,callId:"ALL"}}return ie.debug("callId is defined :",t),(s=this.findCallIndexWithCallId(t))>=0?(this.callsTable[s].callConfiguration&&(g=apiCC.getUserMediaStream(this.callsTable[s].callConfiguration.userMediaStreamId)),g?(g.audioMuted?g.unMuteAudioOnStreams("enabled"):g.muteAudioOnStreams("enabled"),{muteState:g.audioMuted,callId:t}):null!==this.callsTable[s].callLocalStream?(this.callsTable[s].isLocalAudioMuted?(ie.debug("unmuting call :",this.callsTable[s].callId),this.unMuteTracks(this.callsTable[s].callLocalStream.getAudioTracks())):(ie.debug("muting call :",this.callsTable[s].callId),this.muteTracks(this.callsTable[s].callLocalStream.getAudioTracks())),this.callsTable[s].isLocalAudioMuted=!this.callsTable[s].isLocalAudioMuted,{muteState:this.callsTable[s].isLocalAudioMuted,callId:t}):{muteState:"STREAM_NOT_FOUND",callId:t}):(r=this.findUserMediaById(t))&&(r.callConfiguration&&(g=apiCC.getUserMediaStream(r.callConfiguration.userMediaStreamId)),g)?(g.audioMuted?g.unMuteAudioOnStreams("enabled"):g.muteAudioOnStreams("enabled"),{muteState:g.audioMuted,callId:t}):{muteState:"CALL_NOT_FOUND",callId:t}},this.sendDTMF=function(t,l,s,v){ie.debug("sendDTMF");var r=0;null!=t?(ie.debug("callId is defined :",t),r=this.findCallIndexWithCallId(t),ie.debug("index :",r),r>=0&&(ie.debug("index :",r),this.callsTable[r].sendTones(l,s,v))):ie.debug("no callId defined, leaving sendDTMF")},this.xhr=function(t,l,s,v){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&s(r.responseText)},void 0!==v&&(r.upload.onprogress=v),r.open("POST",t),r.send(l)},this.takeSnapshot=function(t,l,s,v,r,g,E){var te=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};ie.info("takeSnapshot");var ae,Re=null,Ce=null,re=document.createElement("canvas"),K=null,L=null,ne=new Date,ee=ne.toJSON(),ce=ee.replace(new RegExp(":","g"),"-"),me=null;switch(v){case"Desactivated":ae=0;break;case"Low":ae=2;break;case"Medium":ae=4;break;case"High":ae=6;break;default:ie.log("blurLevel not defined switch case : "+v),ae=0}if(void 0!==E){if(ie.log("takeSnapshot of defined video Id :"+E),null===(me=document.getElementById(E)))return ie.log("Cannot find video with Id :"+E),ie.log("Leaving takeSnapshot"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT")}else if(ie.warn("ApiRTC DEPRECATED : Please add videoId for TakeSnapshot"),null!==this.localVideo)me=this.localVideo,ie.log("using localVideo for takeSnapshot");else{if(null===(me=document.getElementById("myLocalVideo")))return ie.log("Cannot find video with Id : myLocalVideo"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT");ie.log("using Video with Id : myLocalVideo for takeSnapshot")}re.width=me.videoWidth,re.height=me.videoHeight,te.hasOwnProperty("width")&&(ie.debug("options.width is set :"+te.width),re.width=te.width),te.hasOwnProperty("height")&&(ie.debug("options.height is set :"+te.height),re.height=te.height),ie.log("snapshot.width : "+re.width),ie.log("snapshot.height :"+re.height),(Re=re.getContext("2d")).drawImage(me,0,0,re.width,re.height),(Ce=document.createElement("img")).src=re.toDataURL("image/png"),Ce.style.padding=5,Ce.width=re.width,Ce.height=re.height,0!==ae?(ie.log("Adding Blur on Photo"),K=Re.getImageData(0,0,re.width,re.height),ie.log("av pixels data : "+K.data),K=A(Ce,K,ae),ie.log("ap pixels data : "+K.data),Re.putImageData(K,0,0),Ce.src=re.toDataURL("image/png")):ie.log("blur on photo is desactivated"),"object"===Et(l)?null!==l?l.src=Ce.src:ie.log("localPhotoIdOrDiv is null"):null!==document.getElementById(l)?document.getElementById(l).src=Ce.src:ie.log("localPhotoId is not defined"),L=new FormData,void 0!==r?(ie.log("sessionId !== undefined :"+r),L.append("destFileName",this.clientId+"-"+ce+".png"),L.append("data",re.toDataURL("image/png")),L.append("sessionId",r)):(ie.log("Upload on data1"),L.append("photo",re.toDataURL("image/png")),L.append("clientId",this.clientId),L.append("apiKey",apiCC.session.apiKey)),this.xhr(t,L,function(Te){if(ie.log("fileName :",Te),null!==Te)try{var ge=JSON.parse(Te);"OK"===ge.resultCode&&(ie.log("files loaded, filename :"+ge.fileUrl),dt.createSnapShotPhotoUploaded(ge.fileUrl))}catch(Ie){ie.log("Parsing error:",Ie)}"Photo received"!==Te&&"An error occurred."!==Te&&"Photo-"!==Te.substring(0,6)||dt.createSnapShotPhotoUploaded(Te)},g)},this.takeSnapshotAndSendOnDataChannel=function(t,l,s,v){ie.info("takeSnapshotAndSendOnDataChannel");var r,g=null,E=document.createElement("canvas"),te=null;if(void 0!==l){if(ie.log("takeSnapshot of defined video Id :"+l),null===(te=document.getElementById(l)))return ie.log("Cannot find video with Id :"+l),ie.log("Leaving takeSnapshot"),void this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct for takeSnapshot","INCORRECT_VIDEOID_FOR_SNAPSHOT")}else ie.warn("ApiRTC DEPRECATED : Please add videoId for TakeSnapshot");null!=te&&(E.width=te.clientWidth,E.height=te.clientHeight),ie.log("snapshot.width : "+E.width),ie.log("snapshot.height :"+E.height),E.getContext("2d").drawImage(te,0,0,E.width,E.height),(g=document.createElement("img")).src=E.toDataURL("image/png"),g.style.padding=5,g.width=E.width,g.height=E.height,"object"===Et(t)?null!==t?t.src=g.src:ie.log("localPhotoIdOrDiv is null"):null!==document.getElementById(t)?document.getElementById(t).src=g.src:ie.log("localPhotoId is not defined"),r=E.toDataURL("image/png"),this.sendDataWithCallId(s,{file:r,name:"nomFichier",type:"image/png-dataUrl"},v)},this.callWithNumber=function(t,l,s,v){ie.info("Click on Call Button, video activated : "+l),ie.log("callConfiguration : ",v);var r=null,g=0,E=null,te=null,ae=null,Re=null,Ce=null;if("number"==typeof t&&(ie.log("called number type is number, converting to string"),t=t.toString()),""!==t&&t!==this.clientId){if(this.setStatus("Calling Destination number :"+t),(r=new le(this)).instanceId=apiCC.generateInstanceId(),ie.log("Calling destination number :"+t),null==v||null==v.apzcallId?r.generateCallId():r.callId=v.apzcallId,!0===apiCC.isSIPNumber(t)?(ie.log("Prefix 0 , + , or 'sip:' detected, calling a SIP device"),!0===t.toString().startsWith("sip:")&&(t=t.toString().replace("sip:",""),ie.log("called SIP number is :",t)),null!=s?s.pubSub="sipConnector":(s={}).pubSub="sipConnector",r.trickleIce=!1):ie.log("Establishing Web call"),r.callerId=this.clientId,r.calleeId=t,r.dest_roomId=t,r.audioOnly=!l,r.remoteId=t,r.callConfiguration=v,null!=v?("VIDEO"===v.mediaTypeForOutgoingCall||"AUDIO"===v.mediaTypeForOutgoingCall||"VIDEOONLY"===v.mediaTypeForOutgoingCall||"NONE"===v.mediaTypeForOutgoingCall?(ie.log("Setting mediaTypeForOutgoingCall :"+v.mediaTypeForOutgoingCall),r.mediaTypeForOutgoingCall=v.mediaTypeForOutgoingCall):(ie.log("mediaTypeForOutgoingCall is not set"),!1===l&&(ie.log("videoActivated is false, setting mediaTypeForOutgoingCall to AUDIO"),r.mediaTypeForOutgoingCall="AUDIO")),null!=v.mediaRoutingMode&&r.setCallMediaRoutingMode(v.mediaRoutingMode),null!=v.turnServerAddress&&r.setCallTurnServer(v.turnServerAddress),!0!==v.preferVP9Codec&&!1!==v.preferVP9Codec||(r.preferVP9Codec=v.preferVP9Codec),v.hasOwnProperty("forceCallType")&&(r.callType=v.forceCallType,"screenSharing"!==r.callType&&"screenSharingWithAudio"!==r.callType||(r.screenSharing=!0))):ie.log("callConfiguration is not set"),void 0!==s&&void 0!==s.MCUType&&("MCU-Caller"!==s.MCUType&&"MCU-Callee"!==s.MCUType||("janusConnector"===this.MCUClient.pubConnector&&"Firefox"===d.Xh&&(r.mediaConstraints=d.PR>43?{offerToReceiveAudio:!1,offerToReceiveVideo:!1}:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}),s.pubSub=this.MCUClient.pubConnector,s.videoBandwidthSettings=this.videoBandwidthSettings,"groupKurentoConnector"===s.pubSub&&(s.pubSub="kurentoConnector"))),r.checkDTLSCompliancy(),E=r.callId,te=apiCC.session.getConnectedUserInfo(t,"userData"),ie.log("userInfo :",te),"User_Not_Found"!==te&&void 0!==te&&void 0!==(ae=JSON.parse(te))&&"true"===ae.react&&(ie.log("userInfoJson.react :",JSON.stringify(ae.react)),ie.log("userInfoJson.osName :",JSON.stringify(ae.osName)),"iOS"===ae.osName&&(ie.log("Callee : React and iOS detected, setting H264 as preferred codec for the call"),r.preferH264Codec=!0)),!0===r.audioOnly&&(r.callType="audio"),void 0!==s?r.data=s:s={},s.convId&&(s.cloudConvId||(s.cloudConvId=s.convId),delete s.convId),!0===s.dataCall&&(r.dataCall=!0),r.data.instanceId=r.instanceId,g=this.callsTable.push(r),ie.log("Call Number is :"+g),r.data&&"MCU-Caller"===r.data.MCUType&&"NONE"===r.mediaTypeForOutgoingCall)return r.inviteSended=!0,r.myWebRTC_Stack.sendInvite(r.callId,r.callerId,this.nickname,r.dest_roomId,r.dest_roomId,"none",{offer:{type:"no-offer"},data:r.data}),r.callId;r.data&&"MCU-Caller"===r.data.MCUType&&(r.settingUpType="publish",r.callControl=this.createCallControl({type:"publish",callId:r.callId,roomName:r.data.confId,callConfiguration:r.callConfiguration,data:r.data}),r.callControl.sessionId=r.data.confId,r.callControl.token=r.data.confId,r.callControl.autoRestart.counter=0,r.setMediaConstraintsToSendOnlyOffer()),(0,h.ki)(v,"userMediaStreamId","string")&&(Ce=v.userMediaStreamId),null!=ae&&"true"===ae.isSimulated?apiCC.session.channel.socket.emit("simulatedAgentCallRequest",{number:t,call:r,videoActivated:l,data:s,callConfiguration:{apzcallId:r.callId}}):!0===this.accessToLocalMedia&&!0===this.autoAnswer||r.dataCall||Ce?r.dataCall?(ie.log("Datachannel call"),r.establishCall()):(ie.log("callWithNumber :: User has already granted access to local media and AutoAnswer activated : establishing call"),Ce?((Re=apiCC.getUserMediaStream(Ce)).addCallInfo(r.callId),null!=r.callConfiguration||(r.callConfiguration={}),r.callConfiguration.userMediaStreamId=Re.userMediaStreamId,r.onUserMediaSuccessOnCall(Re.stream)):r.establishCall()):"MCU-Callee"===s.MCUType&&!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?ie.log("Stand-by :: wait for AcceptCall on recorded 1to1 call"):r.getUserMediaOnCall(),!0===this.autoAnswer&&this.displayHangUpButtonInCommand()}else this.setStatus("Dialed call number is not correct :"+t+".you can be reached at this number : "+this.clientId),ie.log("Call Number is incorrect");return E},this.startTestCall=function(t,l){ie.info("startTestCall : video activated : "+t);var s,v,r=null,g=null,E={};return this.setStatus("Starting test call."),(r=new le(this)).generateCallId(),r.instanceId=apiCC.generateInstanceId(),r.callerId=this.clientId,r.calleeId=12345,r.dest_roomId=12345,r.audioOnly=!t,r.remoteId=12345,r.callConfiguration=l,null!=l?("VIDEO"===l.mediaTypeForOutgoingCall||"AUDIO"===l.mediaTypeForOutgoingCall||"VIDEOONLY"===l.mediaTypeForOutgoingCall||"NONE"===l.mediaTypeForOutgoingCall?(ie.log("Setting mediaTypeForOutgoingCall :"+l.mediaTypeForOutgoingCall),r.mediaTypeForOutgoingCall=l.mediaTypeForOutgoingCall):ie.log("mediaTypeForOutgoingCall is not set"),null!=l.mediaRoutingMode&&r.setCallMediaRoutingMode(l.mediaRoutingMode),null!=l.turnServerAddress&&r.setCallTurnServer(l.turnServerAddress),!0!==l.preferVP9Codec&&!1!==l.preferVP9Codec||(r.preferVP9Codec=l.preferVP9Codec)):(ie.log("callConfiguration is not set"),l={}),r.checkDTLSCompliancy(),v=r.callId,E.pubSub="testCallKurentoConnector",r.data=E,r.data.instanceId=r.instanceId,!0===r.audioOnly&&(r.callType="audio"),s=this.callsTable.push(r),ie.log("Call Number is :"+s),!0===this.accessToLocalMedia&&!0===this.autoAnswer||r.dataCall||l.userMediaStreamId||apiCC.userMediaStreamTable.length>0?r.dataCall?(ie.log("Datachannel call"),r.establishCall()):(ie.log("startTestCall :: User has already granted access to local media and AutoAnswer activated : establishing call"),l.userMediaStreamId?((g=apiCC.getUserMediaStream(l.userMediaStreamId)).addCallInfo(r.callId),null!=r.callConfiguration||(r.callConfiguration={}),r.callConfiguration.userMediaStreamId=g.userMediaStreamId,r.callLocalStream=g.stream,r.establishCall()):(apiCC.userMediaStreamTable.length>0&&((g=apiCC.userMediaStreamTable[0]).addCallInfo(r.callId),null!=r.callConfiguration||(r.callConfiguration={}),r.callConfiguration.userMediaStreamId=g.userMediaStreamId,r.callLocalStream=g.stream),r.establishCall())):r.getUserMediaOnCall(),!0===this.autoAnswer&&this.displayHangUpButtonInCommand(),v},this.extensionInstallationSuccessCallback=function(){ie.debug("extensionInstallationSuccessCallback"),apiCC.session.apiCCWebRTCClient.webRTCClient.apiRTCExtensionInstalled=!0},this.extensionInstallationFailureCallback=function(t,l){ie.debug("extensionInstallationFailureCallback : Error :"+t+", "+l),t=null,l=null,dt.createDesktopCaptureEvent("Extension_installation_Error",this.waitingShareScreenCallId,this.waitingShareScreenDestNumber,this.waitingCaptureSourceType),this.setStatus('Inline extension installation is not possible, please install extension using following link: <a href="https://chrome.google.com/webstore/detail/apizee-desktop-capture/mjjnofoemoepfididplbfimokpnpcoeg?hl=fr" target="_blank">ApiRTC desktopCapture extension</a>')},this.manageNotInstalledExtension=function(t,l,s){ie.debug("manageNotInstalledExtension"),this.setStatus("ApiRTC extension need to be installed to enable screen sharing.<br>You can be reached at this number : "+this.clientId),ie.warn("apiRTC extension not installed"),dt.createDesktopCaptureEvent("Extension_not_installed",t,l),ie.warn("Starting apiRTC extension installation"),this.waitingShareScreenDestNumber=l,this.waitingShareScreenCallId=t,this.waitingCaptureSourceType=s,chrome.webstore.install("https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",this.callback(this,"extensionInstallationSuccessCallback"),this.callback(this,"extensionInstallationFailureCallback"))},this.shareScreen=function(t,l,s,v,r){ie.info("shareScreen");var g=null,E=null,te=null,ae=null;if(!0===apiCC.isScreenSharingCompliant())if(""!==t&&t!==this.clientId){if(null!==l&&"object"===Et(l)||(l={}),"janusConnector"===this.MCUClient.pubConnector&&!l.mesh&&r&&r.callControl&&r.callControl.callId&&this.findCallWithCallId(r.callControl.callId))return ie.debug("call already exists",r.callControl.callId),r.callControl.callId;if(null!==v&&"object"===Et(v)||(v={}),null!==v.qos&&"object"===Et(v.qos)?(l.qos={},l.qos.videoMinQuality="excellent"===v.qos.videoMinQuality?"excellent":"good"===v.qos.videoMinQuality?"good":"medium"===v.qos.videoMinQuality?"medium":"bad",!0===v.qos.videoForbidInactive&&(l.qos.videoForbidInactive=!0)):l.qos={videoMinQuality:"bad"},["audioLabels","videoLabels"].forEach(function(Ce){(0,h.Ym)(v[Ce],"array")&&(l[Ce]=[],v[Ce].forEach(function(re){(0,h.Ym)(re,"string")&&l[Ce].push(re)}))}),(0,h.Ym)(v,"context","object"))try{JSON.stringify(v.context),l.context=v.context}catch(Ce){}ie.log("shareScreen; callConfiguration: "+JSON.stringify(v)),E=new le(apiCC.session.apiCCWebRTCClient.webRTCClient),void 0!==l.mesh&&void 0!==l.instanceId?(ie.debug("keeping instanceId "),E.instanceId=l.instanceId):E.instanceId=apiCC.generateInstanceId(),ie.log("Calling destination number :"+t);var Re=this.MCUClient.getSessionMCU(t);if(Re&&(E.sessionMCU=Re),E.sessionMCU&&"janusConnector"===this.MCUClient.pubConnector&&!l.mesh?(E.settingUpType="shareScreen",r&&r.callControl?(E.callControl=r.callControl,E.callControl.autoRestart.counter+=1,E.callId=E.callControl.callId,E.restarted=!0):(E.callControl=this.createCallControl({type:"shareScreen",roomName:t,callConfiguration:v,data:l}),E.callControl.captureSourceType=s,E.callControl.autoRestart.counter=0,E.generateCallId(),E.callControl.callId=E.callId)):(E.settingUpType="shareScreen",E.generateCallId()),g=E.callId,E.callerId=this.clientId,E.calleeId=t,E.dest_roomId=t,E.audioOnly=!1,E.screenSharing=!0,E.remoteId=t,E.callType="screenSharing",E.captureSourceType=s,E.callConfiguration=v,E.data=l,E.data.instanceId=E.instanceId,null!=v&&null!=v.turnServerAddress&&E.setCallTurnServer(v.turnServerAddress),E.checkDTLSCompliancy(),apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.push(E),E.sessionMCU&&"janusConnector"===this.MCUClient.pubConnector&&E.callControl&&E.callControl.autoRestart.stream)return ie.debug("shareScreen; autoRestart"),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,E.callLocalStream=E.callControl.autoRestart.stream,E.establishCall(),E.callId;if(void 0!==l&&void 0!==l.mesh&&null!==(te=apiCC.session.apiCCWebRTCClient.webRTCClient.findUserMediaById(l.mesh.calleeCallId))&&te.callConfiguration&&te.callConfiguration.userMediaStreamId)return(ae=apiCC.getUserMediaStream(te.callConfiguration.userMediaStreamId)).addCallInfo(E.callId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,E.sessionMCU&&"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&E.callControl&&(E.callControl.autoRestart.stream=ae.stream),E.callConfiguration.userMediaStreamId=ae.userMediaStreamId,E.callLocalStream=ae.stream,E.establishCall(),E.callId;apiCC.createUserMediaStream({callId:E.callId,type:E.callType,captureSourceType:s,success:function(Ce){ie.debug("[shareScreen] success; userMediaStreamId: "+Ce.userMediaStreamId),apiCC.session.apiCCWebRTCClient.webRTCClient.accessToLocalMedia=!0,E.sessionMCU&&"janusConnector"===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.pubConnector&&E.callControl&&(E.callControl.autoRestart.stream=Ce.stream),E.callConfiguration.userMediaStreamId=Ce.userMediaStreamId,E.callLocalStream=Ce.stream,E.establishCall()}})}else this.setStatus("Dialed call number is not correct :"+t+".You can be reached at this number : "+this.clientId),ie.log("Call Number is incorrect");else ie.log("shareScreen is not supported on this browser"),dt.createDesktopCaptureEvent("Browser_Not_Compatible",g,t);return ie.info("shareScreen, callId :",g),g},this.startScreenSharingOnCall=function(t,l){ie.info("getScreenMedia for callId :"+t);var s=null;if("Chrome"===d.Xh)if(null!==(s=this.findCallWithCallId(t))){if(!1===this.apiRTCExtensionInstalled)return void this.manageNotInstalledExtension(s.callId,s.remoteId,l);null==l&&(l=["screen","window","tab"]),window.postMessage({command:"getDesktopId",callNumber:s.callId,remoteId:s.remoteId,captureSourceType:l,browser_major_version:d.PR},"*")}else ie.log("call not found");else ie.log("shareScreen is only available for chrome Browser"),dt.createDesktopCaptureEvent("Browser_Not_Compatible",t,null)},this.toggleVideoScreen=function(t){ie.info("toggleVideoScreen for callId :"+t);var l=this.findCallWithCallId(t);null!==l?l.toggleVideoScreen():ie.log("call not found")},this.switchVideoToScreen=function(t){ie.info("switchVideoToScreen for callId :"+t);var l=this.findCallWithCallId(t);null!==l?l.switchVideoToScreen():ie.log("call not found")},this.switchScreenToVideo=function(t){ie.info("switchScreenToVideo for callId :"+t);var l=this.findCallWithCallId(t);null!==l?l.switchScreenToVideo():ie.log("call not found")},this.addVideoMedia=function(t){ie.info("webRTCClient::addVideoMedia for callId :"+t);var l=this.findCallWithCallId(t);null!==l?l.addVideoMedia():ie.log("call not found")},this.callbymail=function(t){var l;ie.info("Click on Call per mail Button"),l=t,new RegExp("^[0-9a-z._-]+@{1}[0-9a-z.-]{2,}[.]{1}[a-z]{2,5}$","i").test(l)?(ie.log("Calling Destination mail :"+t),this.socket.emit("webrtc_invite_permail",t),G.channel.socket.emit("webrtc_invite_permail",t)):ie.log("Mail address is not correct :"+t)},this.callperURL=function(t){ie.info("Call per URL");var l,s=null;(s=new le(this)).instanceId=apiCC.generateInstanceId(),ie.log("Calling Destination number :"+t),s.generateCallId(),s.callerId=this.clientId,s.calleeId=t,s.dest_roomId=t,s.audioOnly=!1,s.getUserMediaOnCall(),s.remoteId=t,s.checkDTLSCompliancy(),l=this.callsTable.push(s),ie.log("Call Number is :"+l)},this.acceptCall=function(t,l){ie.info("acceptCall for callId :"+t),ie.log("acceptCall() - callConfiguration : ",l);var s=null,v=null;if(null!==(s=this.findCallWithCallId(t))){if(ie.log("acceptCall() - Call found"),s.isAccepted=!0,null!=l?("VIDEO"===l.mediaTypeForIncomingCall||"AUDIO"===l.mediaTypeForIncomingCall||"VIDEOONLY"===l.mediaTypeForIncomingCall||"NONE"===l.mediaTypeForIncomingCall||"DATA"===l.mediaTypeForIncomingCall?(ie.log("acceptCall() - Setting mediaTypeForIncomingCall :"+l.mediaTypeForIncomingCall),s.mediaTypeForIncomingCall=l.mediaTypeForIncomingCall):ie.log("acceptCall() - mediaTypeForIncomingCall is not set"),null!=l.mediaRoutingMode&&s.setCallMediaRoutingMode(l.mediaRoutingMode),null!=l.turnServerAddress&&s.setCallTurnServer(l.turnServerAddress),!0!==l.preferVP9Codec&&!1!==l.preferVP9Codec||(s.preferVP9Codec=l.preferVP9Codec)):(ie.log("acceptCall() - callConfiguration is not set"),l={}),!0===s.screenSharing&&(ie.log("acceptCall() for screenSharing : forcing mediaTypeForIncomingCall to NONE"),l.mediaTypeForIncomingCall="NONE",s.mediaTypeForIncomingCall="NONE"),s.callConfiguration=(0,h.S6)(s.callConfiguration,l),"VIDEO"===s.mediaTypeForIncomingCall?s.setLocalCallProfile({audio:!0,audioActive:!0,video:!0,videoActive:!0}):"AUDIO"===s.mediaTypeForIncomingCall?s.setLocalCallProfile({audio:!0,audioActive:!0,video:!1,videoActive:!1}):"VIDEOONLY"===s.mediaTypeForIncomingCall?s.setLocalCallProfile({audio:!1,audioActive:!1,video:!0,videoActive:!0}):"NONE"===s.mediaTypeForIncomingCall&&s.setLocalCallProfile({audio:!1,audioActive:!1,video:!1,videoActive:!1}),s.data&&"MCU-Callee"===s.data.MCUType&&"NONE"===s.mediaTypeForIncomingCall)return void s.myWebRTC_Stack.sendInvite(s.callId,s.callerId,this.nickname,s.dest_roomId,s.dest_roomId,"none",{offer:{type:"no-offer"},data:s.data});s.data&&"MCU-Callee"===s.data.MCUType&&(s.mediaTypeForOutgoingCall=s.mediaTypeForIncomingCall,s.settingUpType="publish",s.callControl=this.createCallControl({type:"publish",callId:s.callId,roomName:s.data.confId,callConfiguration:s.callConfiguration,data:s.data}),s.callControl.sessionId=s.data.confId,s.callControl.token=s.data.confId,s.callControl.autoRestart.counter=0,s.setMediaConstraintsToSendOnlyOffer()),this.unidirectionelCallOnly?(ie.log("acceptCall() - unidirectional call"),s.onUserMediaSuccessTestUni()):!0===this.userAcceptOnIncomingCallBeforeGetUserMedia?(ie.log("acceptCall with userAcceptOnIncomingCallBeforeGetUserMedia"),l.userMediaStreamId?((v=apiCC.getUserMediaStream(l.userMediaStreamId)).addCallInfo(s.callId),null!=s.callConfiguration||(s.callConfiguration={}),s.callConfiguration.userMediaStreamId=v.userMediaStreamId,s.onUserMediaSuccessOnCall(v.stream)):s.getUserMediaOnCall()):!0===s.accessToMedia||l.userMediaStreamId||s.dataCall?(ie.log("acceptCall() :: User has already granted access to local media and AutoAnswer activated : establishing call"),s.dataCall||l.userMediaStreamId&&((v=apiCC.getUserMediaStream(l.userMediaStreamId)).addCallInfo(s.callId),null!=s.callConfiguration||(s.callConfiguration={}),s.callConfiguration.userMediaStreamId=v.userMediaStreamId,s.callLocalStream=v.stream),s.establishCall()):ie.log("acceptCall() - call will be established when user accept his media")}else ie.log("Call not found")},this.refuseCall=function(t,l){ie.info("refuseCall for callId :"+t);var s,v=null;s=void 0!==l?l:"User_Refused_Call",null!==(v=this.findCallWithCallId(t))?(ie.log("Call found"),"MCU-Callee"===v.data.MCUType?(v.myWebRTC_Stack.sendBye(v.callId,v.callerId,v.dest_roomId,v.calleeId,"User_Media_Error",v.data),this.removeCallFromTableWithCallIdandRemoteId(v.callId,v.calleeId,s)):(v.myWebRTC_Stack.sendBye(v.callId,v.calleeId,v.dest_roomId,v.callerId,s,v.data),this.removeCallFromTableWithCallIdandRemoteId(v.callId,v.callerId,s)),0===this.callsTable.length&&(ie.log("No more established calls for client"),this.initMediaElementState())):ie.log("Call not found")},this.stopMedia=function(t){var l=this;return new Promise(function(s,v){var r=null,g=null;return(r=l.findCallWithCallId(t))?r.callLocalStream?void r.removeStream(r.callLocalStream).then(function(){return r.callLocalStream=null,(0,h.ki)(r.callConfiguration,"userMediaStreamId","string")&&(apiCC.releaseUserMediaStream(r.callConfiguration.userMediaStreamId,r.callId),delete r.callConfiguration.userMediaStreamId),s()}).catch(v):s():((g=l.findUserMediaById(t))&&g.releaseUserMediaStream(),s())})},this.addMedia=function(t,l,s,v){var r=this;ie.info("addMedia for callId :"+t);var g=null,E=null,te=null,ae=function(){return Promise.resolve()},Re=function(){return Promise.resolve()};!0===l&&(ae=function(){return r.stopMedia(t)}),(0,h.Ym)(s,"string")&&(te=apiCC.getUserMediaStream(s),s=null);var Ce=function(L){null!=L.callConfiguration||(L.callConfiguration={}),L.isLocalAudioMuted&&L.isLocalVideoMuted?L.callConfiguration.muted="VIDEO":L.isLocalAudioMuted?L.callConfiguration.muted="AUDIOONLY":L.isLocalVideoMuted&&(L.callConfiguration.muted="VIDEOONLY")},re=function(L,ne,ee){"audio"===ne?L.audioSdpDirection=ee?null:(0,h.ki)(L.remoteCallProfile,"audio","boolean")&&!0===L.remoteCallProfile.audio&&!0===L.remoteCallProfile.audioActive?"recvonly":"inactive":"video"===ne&&(L.videoSdpDirection=ee?null:(0,h.ki)(L.remoteCallProfile,"video","boolean")&&!0===L.remoteCallProfile.video&&!0===L.remoteCallProfile.videoActive?"recvonly":"inactive")},K=function(L,ne,ee,ce){var me,Te,ge;null!=L.callConfiguration||(L.callConfiguration={}),L.callConfiguration.userMediaStreamId=ne.userMediaStreamId,re(L,"audio",ne.audio),re(L,"video",ne.video),Ce(L),me=L,ge=ne.video,(Te=ne.audio)&&ge?(me.audioOnly=!1,me.mediaTypeForIncomingCall="VIDEO",me.mediaTypeForOutgoingCall="VIDEO"):Te?(me.audioOnly=!1,me.mediaTypeForIncomingCall="AUDIO",me.mediaTypeForOutgoingCall="AUDIO"):ge?(me.audioOnly=!1,me.mediaTypeForIncomingCall="VIDEOONLY",me.mediaTypeForOutgoingCall="VIDEOONLY"):(me.audioOnly=!1,me.mediaTypeForIncomingCall="NONE",me.mediaTypeForOutgoingCall="NONE"),L.callLocalStream=ne.stream,L.started?L.addingUserMedia=!0:r.accessToLocalMedia=!0,L.asyncCallbacks={},L.asyncCallbacks.type="addingUserMedia",L.asyncCallbacks.resolve=ee,L.asyncCallbacks.reject=ce,L.asyncCallbacks.timeoutId=setTimeout(function(){L.asyncCallbacks&&"function"==typeof L.asyncCallbacks.reject&&(L.asyncCallbacks.reject("addMedia timeout"),delete L.asyncCallbacks)},4e4),L.establishCall()};if(null!==(g=this.findCallWithCallId(t))){if(g.asyncCallbacks)return Promise.reject("job already ongoing");Re=function(){return new Promise(function(L,ne){te?(te.addCallInfo(g.callId),K(g,te,L,ne)):s?apiCC.createUserMediaStream({type:"media",callId:g.callId,stream:s,sync:!0,success:function(ee){ie.debug("[addMedia] success; userMediaStreamId: "+ee.userMediaStreamId),K(g,ee,L,ne)},failure:function(ee,ce){return ne(ce)}}):(0,h.ki)(v,"getUserMediaStreamId","function")?v.getUserMediaStreamId().then(function(ee){if(!(te=apiCC.getUserMediaStream(ee)))return ne("wrong userMediaStreamId");te.addCallInfo(g.callId),K(g,te,L,ne)}).catch(ne):apiCC.userMediaStreamTable.length>0?((te=apiCC.userMediaStreamTable[0]).addCallInfo(g.callId),K(g,te,L,ne)):(Ce(g),g.addingUserMedia=!0,g.asyncCallbacks={},g.asyncCallbacks.type="addingUserMedia",g.asyncCallbacks.resolve=L,g.asyncCallbacks.reject=ne,g.asyncCallbacks.timeoutId=setTimeout(function(){g.asyncCallbacks&&"function"==typeof g.asyncCallbacks.reject&&(g.asyncCallbacks.reject("addMedia timeout"),delete g.asyncCallbacks)},4e4),g.getUserMediaOnCall())})}}else if(E=this.findUserMediaById(t)){if(!0===E.addingUserMedia)return Promise.reject("addMedia already ongoing");Re=function(){return new Promise(function(L,ne){E.addingUserMedia=!0,new Promise(function(ee,ce){if(te)return te.addCallInfo(E.userMediaId,"userMedia"),null!=E.callConfiguration||(E.callConfiguration={}),E.callConfiguration.userMediaStreamId=te.userMediaStreamId,E.callType=te.callType,E.audio=te.audio,E.video=te.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(E,!0),ee(te.userMediaStreamId);if(s)apiCC.createUserMediaStream({callId:E.userMediaId,callFlavor:"userMedia",type:E.callType,stream:s,sync:!0,success:function(me){return ie.debug("[addMedia] success; userMediaStreamId: "+me.userMediaStreamId),null!=E.callConfiguration||(E.callConfiguration={}),E.callConfiguration.userMediaStreamId=me.userMediaStreamId,E.callType=me.callType,E.audio=me.audio,E.video=me.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(E,!0),ee(me.userMediaStreamId)},failure:function(me,Te){return ce(Te)}});else if((0,h.ki)(v,"getUserMediaStreamId","function"))v.getUserMediaStreamId().then(function(me){return(te=apiCC.getUserMediaStream(me))?(te.addCallInfo(E.userMediaId,"userMedia"),null!=E.callConfiguration||(E.callConfiguration={}),E.callConfiguration.userMediaStreamId=te.userMediaStreamId,E.callType=te.callType,E.audio=te.audio,E.video=te.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(E,!0),ee(te.userMediaStreamId)):ce("wrong userMediaStreamId")}).catch(ce);else{if(apiCC.userMediaStreamTable.length>0)return(te=apiCC.userMediaStreamTable[0]).addCallInfo(E.userMediaId,"userMedia"),null!=E.callConfiguration||(E.callConfiguration={}),E.callConfiguration.userMediaStreamId=te.userMediaStreamId,E.callType=te.callType,E.audio=te.audio,E.video=te.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(E,!0),ee(te.userMediaStreamId);apiCC.createUserMediaStream({callId:E.userMediaId,callFlavor:"userMedia",type:E.callType,audioSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.audioSourceId,videoSourceId:apiCC.session.apiCCWebRTCClient.webRTCClient.videoSourceId,success:function(me){return ie.debug("[addMedia] success; userMediaStreamId: "+me.userMediaStreamId),null!=E.callConfiguration||(E.callConfiguration={}),E.callConfiguration.userMediaStreamId=me.userMediaStreamId,E.callType=me.callType,E.audio=me.audio,E.video=me.video,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshOnUserMediaSuccess(E,!0),ee(me.userMediaStreamId)},failure:function(me,Te){return ce(Te)}})}}).then(function(ee){return ce=ee,new Promise(function(me,Te){for(var ge=[],Ie=0;Ie<apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length;Ie+=1){var we=apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable[Ie];void 0!==we.data&&void 0!==we.data.mesh&&we.data.mesh.calleeCallId===t&&ge.push(apiCC.session.apiCCWebRTCClient.webRTCClient.addMedia(we.callId,!0,ce))}Promise.all(ge).then(function(){return me(ce)}).catch(Te)});var ce}).then(function(ee){return delete E.addingUserMedia,L(ee)}).catch(function(ee){return delete E.addingUserMedia,ne(ee)})})}}else Re=function(){return Promise.reject("no suitable replacement")};return new Promise(function(L,ne){ae().then(function(){return Re()}).then(function(ee){return ie.info("addMedia success; userMediaStreamId: "+ee),L(ee)}).catch(function(ee){ie.error("addMedia failure: "+ee);var ce=null,me=null;return g?(g.callControl&&(ce=g.callControl.roomName,me=g.callControl.type),dt.createErrorEvent("Failed to addMedia","MEDIA_UPDATE_ERROR",g.callId,ce,me)):E&&dt.createErrorEvent("Failed to addMedia","MEDIA_UPDATE_ERROR",E.userMediaId,null,"publish"),ne(ee)})})},this.updateMediaDeviceOnCall=function(t,l){return ie.info("updateMediaDeviceOnCall for callId :"+t),this.addMedia(t,!0,l),t},this.updateMediaTypeOnCall=function(t,l){var s=function(g,E,te){return new Promise(function(ae,Re){var Ce,re={};g.callControl.mediaType=te,g.mediaType=te,g.data.mediaType=te,g.updateCause="userAction",re.type="update",re.mode="passive",re.callId=g.callId,re.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,re.callerNickname=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,re.calleeId=g.sessionMCU.roomName,re.roomId=g.sessionMCU.roomName,re.callType=E.attributes.callType,re.data=(0,h.S6)(g.data),re.data.type="subscribe",re.stream=E,Ce=JSON.stringify(re),ie.log("C->S: "+Ce),apiCC.session.apiCCWebRTCClient.webRTCClient.socket.emit("update",Ce),g.asyncCallbacks={},g.asyncCallbacks.type="updateMediaType",g.asyncCallbacks.resolve=ae,g.asyncCallbacks.reject=Re,g.asyncCallbacks.timeoutId=setTimeout(function(){g.asyncCallbacks&&"function"==typeof g.asyncCallbacks.reject&&(g.asyncCallbacks.reject("timeout"),delete g.asyncCallbacks)},2e4)})},v=this.findCallWithCallId(t);if(!v)return Promise.reject("call not found");if("subscribe"!==v.settingUpType)return Promise.reject("wrong call type");if(v.asyncCallbacks)return Promise.reject("job already ongoing");var r=this.MCUClient.getStreamFromList(v.streamId);if(!r)return Promise.reject("wrong streamId");if("VIDEO"===v.callControl.mediaType){if("AUDIOONLY"===l&&r.audio||"VIDEOONLY"===l&&r.video)return s(v,r,l)}else if("AUDIOONLY"===v.callControl.mediaType){if("VIDEO"===l&&r.video||"VIDEOONLY"===l&&r.video)return s(v,r,l)}else if("VIDEOONLY"===v.callControl.mediaType&&("VIDEO"===l&&r.video||"AUDIOONLY"===l&&r.audio))return s(v,r,l);return Promise.reject("wrong mediaType")},this.updateSimulcastFeedOnCall=function(t,l){var s=this.findCallWithCallId(t);if(!s)return Promise.reject("call not found");if("subscribe"!==s.settingUpType)return Promise.reject("wrong call type");if(s.asyncCallbacks)return Promise.reject("job already ongoing");var v=this.MCUClient.getStreamFromList(s.streamId);if(!v)return Promise.reject("wrong streamId");if(!l)return Promise.reject("wrong simulcast");s.callControl.callConfiguration.simulcast||(s.callControl.callConfiguration.simulcast={}),s.data.simulcast||(s.data.simulcast={}),l.streamQuality&&("high"===l.streamQuality?(s.callControl.callConfiguration.simulcast.substream=2,s.data.simulcast.substream=2):"medium"===l.streamQuality?(s.callControl.callConfiguration.simulcast.substream=1,s.data.simulcast.substream=1):"low"===l.streamQuality?(s.callControl.callConfiguration.simulcast.substream=0,s.data.simulcast.substream=0):(s.callControl.callConfiguration.simulcast.substream=-1,s.data.simulcast.substream=-1)),l.streamFrameRate&&("high"===l.streamFrameRate?(s.callControl.callConfiguration.simulcast.temporal=2,s.data.simulcast.temporal=2):"medium"===l.streamFrameRate?(s.callControl.callConfiguration.simulcast.temporal=1,s.data.simulcast.temporal=1):"low"===l.streamFrameRate?(s.callControl.callConfiguration.simulcast.temporal=0,s.data.simulcast.temporal=0):(s.callControl.callConfiguration.simulcast.temporal=-1,s.data.simulcast.temporal=-1));var r={type:"updateSimulcastFeed"};r.callId=s.callId,r.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,r.callerNickname=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,r.calleeId=s.sessionMCU.roomName,r.roomId=s.sessionMCU.roomName,r.callType=v.attributes.callType,r.data=(0,h.S6)(s.data),r.stream=v;var g=JSON.stringify(r);return ie.log("C->S: "+g),apiCC.session.apiCCWebRTCClient.webRTCClient.socket.emit("updateSimulcastFeed",g),Promise.resolve()},this.updateCallConfigurationOnCall=function(t,l){var r,g,s=function(r,g,E){"audio"===g?r.audioSdpDirection=E?null:"inactive":"video"===g&&(r.videoSdpDirection=E?null:"inactive")},v=this.findCallWithCallId(t);return v?"publish"!==v.settingUpType?Promise.reject("wrong call type"):v.asyncCallbacks?Promise.reject("job already ongoing"):((0,h.Ym)(l,"object")||(l={}),(0,h.ki)(l,"audioOnly","boolean")||(l.audioOnly=!1),(0,h.ki)(l,"videoOnly","boolean")||(l.videoOnly=!1),r=v,g=l,new Promise(function(E,te){r.mediaTypeForIncomingCall="NONE",!0===g.audioOnly?(ie.log("Setting call as audioOnly"),r.audioOnly=!0,r.callType="audio",r.mediaTypeForOutgoingCall="AUDIO",s(r,"audio",!0),s(r,"video",!1)):!0===g.videoOnly?(ie.log("Setting call as videoOnly"),r.audioOnly=!1,r.callType="videoOnly",r.mediaTypeForOutgoingCall="VIDEOONLY",s(r,"audio",!1),s(r,"video",!0)):(ie.log("Setting call as media"),r.audioOnly=!1,r.callType="media",r.mediaTypeForOutgoingCall="VIDEO",s(r,"audio",!0),s(r,"video",!0)),r.updateUserMedia=!0,r.updateCause="userAction",r.establishCall(),r.asyncCallbacks={},r.asyncCallbacks.type="updateCallConfiguration",r.asyncCallbacks.resolve=E,r.asyncCallbacks.reject=te,r.asyncCallbacks.timeoutId=setTimeout(function(){r.asyncCallbacks&&"function"==typeof r.asyncCallbacks.reject&&(r.asyncCallbacks.reject("timeout"),delete r.asyncCallbacks)},2e4)})):Promise.reject("call not found")},this.findUserMediaById=function(t){for(var l=this.userMediaTable.length;--l>=0;)if(this.userMediaTable[l].userMediaId===t)return this.userMediaTable[l];return null},this.findCallIndexWithCallIdAndRemoteId=function(t,l){ie.debug("findCallIndexWithCallIdAndRemoteId");var s,v=this.callsTable.length;for(ie.trace("callsNumber : "+v),s=0;s<v;s+=1)if(this.callsTable[s].callId===t&&(ie.log("callId found"),ie.log("this.callsTable[i].callee :"+this.callsTable[s].callee),ie.log("this.callsTable[i].calleeId :"+this.callsTable[s].calleeId),!0===this.callsTable[s].callee&&this.callsTable[s].callerId===l||!1===this.callsTable[s].callee&&this.callsTable[s].calleeId===l))return s;return ie.log("Call not found"),-1},this.findCallIndexWithConfIdAndRemoteId=function(t,l){ie.debug("findCallIndexWithConfIdAndRemoteId"),ie.log("confId :"+t),ie.log("remoteId :"+l);var s,v=this.callsTable.length;for(s=0;s<v;s+=1)if(ie.log("this.callsTable[i].data.confId :"+this.callsTable[s].data.confId),this.callsTable[s].data.confId===t){if(!0===this.callsTable[s].callee&&this.callsTable[s].callerId===l||!1===this.callsTable[s].callee&&this.callsTable[s].calleeId===l)return s}else ie.debug("ConfId is different");return ie.debug("Call not found - findCallIndexWithConfIdAndRemoteId"),-1},this.findCallIndexWithCallId=function(t){ie.debug("findCallIndexWithCallId");var l,s=this.callsTable.length;for(l=0;l<s;l+=1)if(this.callsTable[l].callId===t)return ie.log("Call found with callId"),l;return ie.debug("Call not found - findCallIndexWithCallId"),-1},this.findCallWithCallIdAndInstanceId=function(t,l){ie.debug("findCallWithCallIdAndInstanceId :"+t+" ,instanceId : "+l),void 0===l&&ie.debug("instanceId is undefined : must be a mesh publish call, id must be a streamId");var s,v=this.callsTable.length;for(ie.trace("callsNumber :"+v),s=0;s<v;s+=1)if(this.callsTable[s].callId===t&&this.callsTable[s].instanceId===l)return this.callsTable[s];return ie.debug("Call not found, findCallWithCallIdAndInstanceId"),null},this.findCallIndexWithCallIdAndInstanceId=function(t,l){ie.debug("findCallIndexWithCallIdAndInstanceId :"+t+" ,instanceId : "+l),void 0===l&&ie.debug("instanceId is undefined : must be a mesh publish call, id must be a streamId");var s,v=this.callsTable.length;for(ie.trace("callsNumber :"+v),s=0;s<v;s+=1)if(this.callsTable[s].callId===t&&this.callsTable[s].instanceId===l)return s;return ie.debug("Call not found, findCallIndexWithCallIdAndInstanceId"),-1},this.findCallWithCallId=function(t){ie.trace("findCallWithCallId :"+t);var l,s=this.callsTable.length;for(ie.trace("callsNumber :"+s),l=0;l<s;l+=1)if(ie.trace("this.callsTable[i].callId :"+this.callsTable[l].callId),this.callsTable[l].callId===t)return this.callsTable[l];return ie.debug("Call not found"),null},this.findCallWithStreamId=function(t,l){ie.debug("findCallWithStreamId :"+t);var s,v=!(!l||!l.ignoreModeChangeKindOld),r=this.callsTable.length;for(ie.trace("callsNumber :"+r),s=0;s<r;s+=1)if(ie.log("this.callsTable[i].streamId :"+this.callsTable[s].streamId),!(this.callsTable[s].streamId!=t||v&&this.callsTable[s].sessionMCU&&"old"===this.callsTable[s].sessionMCU.modeChangeKind))return ie.log("Call found"),this.callsTable[s];return ie.log("Call not found"),null},this.findCallWithCallIdAndRemoteIdAndInstanceId=function(t,l,s){ie.debug("findCallWithCallIdAndRemoteIdAndInstanceId callId : "+t+" ,instanceId : "+s);var v,r=this.callsTable.length;for(ie.trace("callsNumber :"+r),v=0;v<r;v+=1)if(this.callsTable[v].callId===t&&this.callsTable[v].instanceId===s&&(!0===this.callsTable[v].callee&&this.callsTable[v].callerId===l||!1===this.callsTable[v].callee&&this.callsTable[v].calleeId===l))return this.callsTable[v];return ie.debug("Call not found"),null},this.findCallWithCallIdAndRemoteId=function(t,l){ie.log("findCallWithCallIdAndRemoteId");var s,v=this.callsTable.length;for(ie.trace("callsNumber :"+v),s=0;s<v;s+=1)if(this.callsTable[s].callId===t&&(!0===this.callsTable[s].callee&&this.callsTable[s].callerId===l||!1===this.callsTable[s].callee&&this.callsTable[s].calleeId===l))return this.callsTable[s];return ie.log("Call not found"),null},this.remoteVideoDisplayManager=function(){ie.debug("remoteVideoDisplayManager");var t,l=[],s=0,v=0,r=0,g=0,E=0,te=0,ae=0;for(this.remoteVideo&&(0===this.maxWidthRemoteVideo&&(this.maxWidthRemoteVideo=this.remoteVideo.clientWidth),0===this.maxHeightRemoteVideo&&(this.maxHeightRemoteVideo=this.remoteVideo.clientHeight),s=(l=this.remoteVideo.children).length,r=this.maxHeightRemoteVideo,ie.log("maxWidth"+(v=this.maxWidthRemoteVideo)),ie.log("maxHeight"+r),g=this.remoteVideo.clientWidth),g>v&&(g=v),(E=3/4*(g/=s))>r&&(g=4/3*(E=r)),te=g/v*100,ae=E/r*100,ae+="%",ie.log("widthinPercent"+(te+="%")),ie.log("heightinPercent"+ae),t=0;t<s;t+=1)l[t].style.cssText="width:"+te+";height:"+ae+";"},this.removeRemoteVideoDisplay=function(t){ie.debug("removeRemoteVideoDisplay with callId ="+t);var l,s="callId_"+t,v=[],r=0;for(this.remoteVideo&&(r=(v=this.remoteVideo.children).length),l=0;l<r;l+=1)if(v[l].id===s)return this.remoteVideo.removeChild(v[l]),void ie.log("VideoDisplay removed for "+s);this.remoteVideoDisplayManager()},this.setStatus=function(t){null!==this.statusDiv?this.statusDiv.innerHTML=t:ie.log("Status Div Null")},this.displayCallButtonInCommand=function(){null!==this.commandDiv&&(this.commandDiv.innerHTML='<form name="form1" action=""><input type="texte" name="mail" value="" placeholder="Enter Destination number..."><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.call(document.forms.form1.mail.value);"><img src="http://www.apizee.com/Demo/images/Call.png" height="30px"></a></input></form>')},this.displayHangUpButtonInCommand=function(){ie.debug("displayHangUpButtonInCommand"),null!==this.commandDiv&&(this.commandDiv.innerHTML='<a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleAudioMute()"> <img src="http://www.apizee.com/Demo/images/Microphone.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleVideoMute();"> <img src="http://www.apizee.com/Demo/images/Camera2.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.hangUp()"> <img src="http://www.apizee.com/Demo/images/Hangup.png" height="30px" disabled="true"> </a>')},this.checkURLForCallDestination=function(){var t=0;return"room"===location.search.substring(1,5)&&(ie.log("Call establishment using URL"),t=location.search.substring(6),ie.log("Destination call number is :"+t)),t},this.releaseUserMedia=function(){ie.info("releaseUserMedia"),null!==this.localStream&&(ie.log("stopping localStream"),this.stopStream(this.localStream),dt.createUserMediaStopEvent(null,"media"),this.accessToLocalMedia=!1,this.autoAnswer=!1,ie.log("this.autoAnswer :"+this.autoAnswer)),null!=this.screenStream&&(ie.log("stopping screenStream"),this.stopStream(this.screenStream),dt.createUserMediaStopEvent(null,"screen"))},this.startDataChannelOnCall=function(t){ie.info("startDataChannelOnCall with callId :"+t);var l=this.findCallWithCallId(t);l?(ie.log("Call found",l),l.addingDataChannelOnCallOngoing=!0,l.createDataChannel()):ie.log("Call not found")},this.sendDataWithCallId=function(t,l,s){ie.info("sendDataWithCallId :"+t);var v=this.findCallWithCallId(t);v?(ie.log("Call found",v),v.sendData(l,s)):ie.log("Call not found")},this.processDataAck=function(t){ie.debug("processDataAck",t);var l=this.findCallWithCallId(t.callId);if(l)if("ok"===t.result)if((0,h.ki)(t,"capabilities","object")&&(0,h.ki)(t.capabilities,"dataEndAckEnabled","boolean")&&(l.dataEndAckEnabled=t.capabilities.dataEndAckEnabled,ie.debug("dataEndAckEnabled",l.dataEndAckEnabled)),"complete"===t.state)l.beginTimeoutId&&(clearTimeout(l.beginTimeoutId),delete l.beginTimeoutId),l.callbacks.success({state:"complete",filename:l.data.filename,size:l.data.size,mediaURL:t.mediaURL,mediaId:t.mediaId}),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(l.callId);else if("incomplete"===t.state){var s,v,r=1<<17,g=[],E=Math.floor(l.data.size/r),te=l.data.size%r;for(s=0;s<E;s+=1)(v=yt("checksum64")).update(l.fileContent,s*r,r),g.push(v.digest("hex"));if(te>0&&((v=yt("checksum64")).update(l.fileContent,E*r,te),g.push(v.digest("hex"))),ie.debug(JSON.stringify(g)),t.checksums.length===g.length){for(s=0;s<g.length&&t.checksums[s]===g[s];s+=1);l.data.offset=r*s}l.mediaURL=t.mediaURL,l.mediaId=t.mediaId,l.establishCall()}else"missing"===t.state?(l.mediaURL=t.mediaURL,l.mediaId=t.mediaId,l.establishCall()):"ready"===t.state?l.establishCall():(ie.debug("wrong state "+t.state),l.beginTimeoutId&&(clearTimeout(l.beginTimeoutId),delete l.beginTimeoutId),l.callbacks.failure("serverError"),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(l.callId));else ie.debug("wrong result "+t.result),l.beginTimeoutId&&(clearTimeout(l.beginTimeoutId),delete l.beginTimeoutId),l.callbacks.failure("serverError"),apiCC.session.apiCCWebRTCClient.webRTCClient.onHangup(l.callId);else ie.debug("no such call",t.callId)},this.processDataEndAck=function(t){ie.debug("processDataEndAck",t);var l=this.findCallWithCallId(t.callId);if(l){var s=null;if(!l.dcfs){if(!l.data||"pipeline"!==l.data.transferType)return void ie.debug("not pipeline");ie.debug("pipeline"),s=l,l.clientCall?(ie.debug("resolve client call"),l=l.clientCall):(ie.debug("no client call"),l=null)}l&&(l.success&&t.data&&(l.success.data=t.data),"ok"===t.result?(!0===t.complete||(delete l.success,l.failure="transferIncomplete"),l.dcfs.terminateTransfer()):"error"===t.result&&(delete l.success,l.failure=t.errorInfo,l.dcfs.terminateTransfer())),s&&"error"===t.result&&(ie.debug("error on pipeline"),s.failure=t.errorInfo,dt.createEvent({eventType:"onFileSended",callId:s.callId,remoteId:s.remoteId,name:s.filename,error:s.failure}),s.callbacks.failure(s.failure),this.onHangup(s.callId))}else ie.debug("no such call",t.callId)},this.pushData=function(t,l,s,v){var r=this;if(!(0,h.Ym)(l,"object")||((l=Object.assign({},l)).transferType||(l.transferType="file"),"file"===l.transferType&&!t)||"file"!==l.transferType&&"pipeline"!==l.transferType&&"plugin"!==l.transferType||!("plugin"!==l.transferType||l.pluginName&&l.pluginData))return null;(0,h.Ym)(v,"object")||(v={}),"function"!=typeof v.pending&&(v.pending=function(){}),"function"!=typeof v.progress&&(v.progress=function(){}),"function"!=typeof v.success&&(v.success=function(){}),"function"!=typeof v.failure&&(v.failure=function(){});var g=new le(apiCC.session.apiCCWebRTCClient.webRTCClient);if(g.generateCallId(),g.instanceId=apiCC.generateInstanceId(),g.callerId=apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,g.calleeId="dataChannelConnector",g.dest_roomId="dataChannelConnector",g.callType="data",g.dataCall=!0,g.remoteId="dataChannelConnector",l.pipelineCallId&&(g.pipelineCallId=l.pipelineCallId),g.data={},g.data.pubSub="dataChannelConnector",g.data.transferType=l.transferType,"pipeline"===l.transferType?(l.checksumEnabled=!1,g.transferCount=0):"plugin"===l.transferType&&(l.checksumEnabled=!1,g.data.pluginName=l.pluginName,g.data.pluginData=Object.assign({},l.pluginData),g.data.pluginData.headers&&(g.data.pluginData.headers=Object.assign({},g.data.pluginData.headers)),g.data.pluginData.data&&(g.data.pluginData.data=Object.assign({},g.data.pluginData.data)),g.data.pluginData.formData&&(g.data.pluginData.formData=Object.assign({},g.data.pluginData.formData))),(0,h.ki)(l,"context","object"))try{JSON.stringify(l.context),g.data.context=Object.assign({},l.context)}catch(E){}if(!0===l.overwrite&&(g.data.overwrite=!0),(0,h.Ym)(l,"ttl","number")&&l.ttl>0&&(g.data.ttl=l.ttl),g.data.instanceId=g.instanceId,t&&(g.data.cloudConvId=t),g.callbacks=v,null!=s&&null!=s.turnServerAddress&&g.setCallTurnServer(s.turnServerAddress),"pipeline"===g.data.transferType)g.data.size=0,g.pushDataStatus={type:"pipeline",state:"pending",data:l},this.callsTable.push(g),setTimeout(function(){r.startNextPushData()});else if((0,h.Ym)(l,"file","object")&&(l.file instanceof File||l.file.constructor===File||!0===l.asFile))g.data.filename=(0,h.Ym)(l,"filename","string")?l.filename:l.file.name,g.data.contentType=(0,h.Ym)(l,"filetype","string")?l.filetype:l.file.type,(0,h.Ym)(l,"sourceType","string")&&l.sourceType.length>0&&(g.data.sourceType=l.sourceType),g.data.size=l.file.size,g.data.metadata=l.metadata,g.pushDataStatus={type:"file",state:"pending",convId:String(t),data:l},this.callsTable.push(g),setTimeout(function(){r.startNextPushData()});else{if(!((0,h.Ym)(l,"buffer","object")&&(l.buffer instanceof ArrayBuffer||l.buffer.constructor===ArrayBuffer||!0===l.asBuffer)&&(0,h.Ym)(l,"filename","string")&&(0,h.Ym)(l,"filetype","string")))return null;g.data.filename=l.filename,g.data.contentType=l.filetype,(0,h.Ym)(l,"sourceType","string")&&l.sourceType.length>0&&(g.data.sourceType=l.sourceType),g.data.size=l.buffer.byteLength,g.data.metadata=l.metadata,g.pushDataStatus={type:"buffer",state:"pending",convId:String(t),data:l},this.callsTable.push(g),setTimeout(function(){r.startNextPushData()})}return g.callId},this.startNextPushData=function(){for(var t=this,l=[],s=0;s<this.callsTable.length;s+=1){var v=this.callsTable[s];if("data"===v.callType&&v.dataCall&&"dataChannelConnector"===v.remoteId&&v.pushDataStatus){if("ready"===v.pushDataStatus.state)continue;l.push(v)}}if(0===l.length)return!1;var r=null;"active"===l[0].pushDataStatus.state?l.splice(0,1):"pending"===l[0].pushDataStatus.state&&(r=l[0],l.splice(0,1));for(var g=0;g<l.length;g+=1){var E=l[g];E.pushDataStatus.rank!==g&&(E.pushDataStatus.rank=g,dt.createEvent({eventType:"onFilePending",callId:E.callId,remoteId:E.remoteId,name:E.data.filename,rank:g}),E.callbacks.pending({state:"pending",callId:E.callId,rank:g}))}if(!r)return!1;ie.debug("startNextPushData",r.callId);var te=r.pushDataStatus.data;if(delete r.pushDataStatus.data,"pipeline"===r.pushDataStatus.type){r.pushDataStatus.state="active";var ae={type:"pushData",callerId:apiCC.session.apiCCId,callId:r.callId,data:r.data},Re=JSON.stringify(ae);return ie.debug("C->S: "+Re),apiCC.session.channel.socket.emit("pushData",Re),!0}if("file"===r.pushDataStatus.type){r.pushDataStatus.state="active";var Ce=new FileReader;Ce.onload=function(re){apiCC.session.apiCCWebRTCClient.webRTCClient.startPushData(r,te,re.target.result)},Ce.readAsArrayBuffer(te.file)}else{if("buffer"!==r.pushDataStatus.type)return ie.error("startNextPushData - wrong type"),r.callbacks.failure("start",r.callId),this.onHangup(r.callId),!1;r.pushDataStatus.state="active",this.startPushData(r,te,te.buffer)}return r.beginTimeoutId=setTimeout(function(){delete r.beginTimeoutId,r.callbacks.failure("timeout",r.callId),t.onHangup(r.callId)},2e4),!0},this.startPushData=function(t,l,s){if(t.fileContent=new Uint8Array(s),t.pipelineCallId){var v=this.findCallWithCallId(t.pipelineCallId);if(!v)return ie.error("no such pipeline call"),void this.onHangup(t.callId);t.pipelineCall=v,v.clientCall=t,t.sendDataChannel=v.sendDataChannel,t.startTransfer({delay:0===v.transferCount?100:0}),v.transferCount+=1}else{if(!Object.prototype.hasOwnProperty.call(l,"checksumEnabled")||l.checksumEnabled){var g=yt("checksum64");g.update(t.fileContent),t.data.checksum=g.digest("hex")}else t.data.checksumEnabled=!1;var E={type:"pushData",callerId:apiCC.session.apiCCId,convId:t.pushDataStatus.convId,callId:t.callId,data:t.data},te=JSON.stringify(E);ie.debug("C->S: "+te),apiCC.session.channel.socket.emit("pushData",te)}},this.cancelPushData=function(t){for(var l=null,s=this.callsTable.length;--s>=0;){var v=this.callsTable[s];if(v.callId===t&&"data"===v.callType&&v.dataCall&&"dataChannelConnector"===v.remoteId&&v.pushDataStatus){l=v;break}}if(!l)return ie.error("cancelPushData - no such call",t),"no such call";if("pending"===l.pushDataStatus.state)dt.createEvent({eventType:"onFileSended",callId:l.callId,remoteId:l.remoteId,name:l.data.filename,error:"canceled"}),l.callbacks.failure("canceled"),this.onHangup(l.callId);else if("active"===l.pushDataStatus.state)this.onHangup(l.callId);else{if("ready"!==l.pushDataStatus.state)return ie.error("cancelPushData - wrong state"),"wrong state";l.clientCall&&this.cancelPushData(l.clientCall.callId),l.success={state:"complete"},dt.createEvent({eventType:"onFileSended",callId:l.callId,remoteId:l.remoteId}),l.callbacks.success(l.success),this.onHangup(l.callId)}return null},this.setVideoBandwidth=function(t,l,s){if("number"==typeof t){var v=!1,r=!1;if("overall"===l?"incoming"===s?t>0?(this.videoBandwidthSettings.overallIncoming=t,v=!0):(delete this.videoBandwidthSettings.overallIncoming,v=!0):"outgoing"===s&&(t>0?(this.videoBandwidthSettings.overallOutgoing=t,v=!0,r=!0):(delete this.videoBandwidthSettings.overallOutgoing,v=!0,r=!0)):"perCall"===l?"incoming"===s?t>0?(this.videoBandwidthSettings.perCallIncoming=t,v=!0):(delete this.videoBandwidthSettings.perCallIncoming,v=!0):"outgoing"===s&&(t>0?(this.videoBandwidthSettings.perCallOutgoing=t,v=!0,r=!0):(delete this.videoBandwidthSettings.perCallOutgoing,v=!0,r=!0)):"remote"===l&&(this.videoRemoteBandwidth=t),v)for(var g=this.MCUClient.sessionMCUs.length;--g>=0;){var te=JSON.stringify({type:"info",infoType:"setVideoBandwidthSettings",data:{clientId:this.clientId,roomId:this.MCUClient.sessionMCUs[g].roomName,pubSub:this.MCUClient.pubConnector,videoBandwidthSettings:this.videoBandwidthSettings}});ie.log("C->S: "+te),apiCC.session.channel.socket.emit("info",te)}r&&this.evalOutgoingVideoBandwithCap()}else ie.error("Unvalid target bandwidth usage value needs to be a number :",t)},this.setAudioBandwidth=function(t){this.audioBandwidth=t},this.setDataBandwidth=function(t){this.dataBandwidth=t},this.processCheckCallStatus=function(t){this.MCUClient.processCheckCallStatus(t);var l={type:"updateCallStatus",clientId:this.clientId,data:{}};t.data.pubSub&&(l.data.pubSub=t.data.pubSub),l.sessions=[];for(var s=0;s<this.MCUClient.sessionMCUs.length;s+=1)l.sessions.push(this.MCUClient.createSessionDescriptor(this.MCUClient.sessionMCUs[s]));l.calls=[];for(var v=0;v<this.userMediaTable.length;v+=1){var r=this.userMediaTable[v];l.calls.push({callId:r.userMediaId,callType:r.callType,remoteId:r.remoteId,roomId:r.roomId,data:r.data,meshPublish:!0})}for(var g=0;g<this.callsTable.length;g+=1){var E=this.callsTable[g];l.calls.push({callId:E.callId,callType:E.callType,remoteId:E.remoteId,roomId:E.roomId,data:E.data,remoteStream:E.mcuRemoteStream})}var te=JSON.stringify(l);apiCC.session.channel.socket.emit("updateCallStatus",te)},this.processRemoteStreamAdded=function(t,l){if(t.sessionMCU&&"new"===t.sessionMCU.modeChangeKind){ie.debug("processRemoteStreamAdded",t);var s=this.MCUClient.getSessionMCU(null,{callback:function(r){return r.roomName===t.sessionMCU.roomName&&"old"===r.modeChangeKind}});if(!s)return void ie.error("wrong roomId: no such old session");ie.debug("oldSessionMCU",s);for(var v=this.callsTable.length;--v>=0;)if(this.callsTable[v].sessionMCU===s&&(0,h.ki)(this.callsTable[v],["mcuRemoteStream","attributes","callId"],"string")&&this.callsTable[v].mcuRemoteStream.attributes.callId===t.mcuRemoteStream.attributes.callId){ie.debug("processRemoteStreamAdded: bye",this.callsTable[v]),this.removeCallFromTableWithCallIdAndSendBye(this.callsTable[v].callId);break}}},this.processDistantCallEstablished=function(t){if(ie.debug("processDistantCallEstablished",t),(0,h.ki)(t,["descriptor","callFeed","callId"],"string"))if(t.descriptor.callFeed.clientId===this.clientId){var l=null;if("mesh"===t.descriptor.callMode?l=this.MCUClient.getSessionMCU(null,{callback:function(me){return me.roomName===t.descriptor.roomId&&"mesh"===me.roomMode}}):"sfu"===t.descriptor.callMode&&(l=this.MCUClient.getSessionMCU(null,{callback:function(me){return me.roomName===t.descriptor.roomId&&!me.hasOwnProperty("roomMode")}})),l){ie.debug("sessionMCU",l);var s=null,v=null;if("mesh"===t.descriptor.callMode?(s=this.findUserMediaById(t.descriptor.callFeed.callId),ie.debug("userMedia",s)):(v=this.findCallWithCallId(t.descriptor.callFeed.callId),ie.debug("call",v)),t.active){if(!s&&!v)return void ie.debug("wrong callId: no such call");for(var r=this.MCUClient.distantCalls.length;--r>=0&&(this.MCUClient.distantCalls[r].roomId!==t.descriptor.roomId||this.MCUClient.distantCalls[r].clientId!==t.descriptor.clientId||this.MCUClient.distantCalls[r].callId!==t.descriptor.callId););if(r>=0){if(!this.MCUClient.distantCalls[r].early)return void ie.debug("processDistantCallEstablished: descriptor already exists");ie.debug("processDistantCallEstablished: replace early descriptor",this.MCUClient.distantCalls[r],t.descriptor),this.MCUClient.distantCalls[r]=t.descriptor}else ie.debug("processDistantCallEstablished: add descriptor",t.descriptor),this.MCUClient.distantCalls.push(t.descriptor)}else if("old"===l.modeChangeKind){for(var g=this.MCUClient.distantCalls.length;--g>=0;)if(this.MCUClient.distantCalls[g].roomId===t.descriptor.roomId&&this.MCUClient.distantCalls[g].clientId===t.descriptor.clientId&&this.MCUClient.distantCalls[g].callId===t.descriptor.callId){ie.debug("processDistantCallEstablished: set descriptor to removed",this.MCUClient.distantCalls[g]),this.MCUClient.distantCalls[g].removed=!0;break}}else for(var E=this.MCUClient.distantCalls.length;--E>=0;)if(this.MCUClient.distantCalls[E].roomId===t.descriptor.roomId&&this.MCUClient.distantCalls[E].clientId===t.descriptor.clientId&&this.MCUClient.distantCalls[E].callId===t.descriptor.callId){ie.debug("processDistantCallEstablished: remove descriptor",this.MCUClient.distantCalls[E]),this.MCUClient.distantCalls.splice(E,1);break}if("new"===l.modeChangeKind){var te=this.MCUClient.getSessionMCU(null,{callback:function(me){return me.roomName===t.descriptor.roomId&&"old"===me.modeChangeKind}});if(!te)return void ie.error("wrong roomId: no such old session");ie.debug("oldSessionMCU",te),ie.debug("processDistantCallEstablished: replacement");for(var ae=!1,Re=this.userMediaTable.length;--Re>=0;){var Ce=this.userMediaTable[Re];if(Ce.sessionMCU===te){var re=!1,K=0;ie.debug("processDistantCallEstablished: userMedia",Ce);for(var L=Ce.distantCalls.length;--L>=0;)Ce.distantCalls[L].replaced?K+=1:Ce.distantCalls[L].callFeed.callId===t.descriptor.callFeed.callId&&(ie.debug("processDistantCallEstablished: distantCall",Ce.distantCalls[L]),re=!0,Ce.distantCalls[L].replaced=!0,K+=1);if(re){if(K===Ce.distantCalls.length){ie.debug("processDistantCallEstablished: remove replaced distant call descriptors");for(var ne=this.MCUClient.distantCalls.length;--ne>=0;)"mesh"===this.MCUClient.distantCalls[ne].callMode&&this.MCUClient.distantCalls[ne].callFeed.callId===Ce.userMediaId&&this.MCUClient.distantCalls[ne].replaced&&(ie.debug("processDistantCallEstablished: remove distantCall",this.MCUClient.distantCalls[ne]),this.MCUClient.distantCalls.splice(ne,1));ie.debug("processDistantCallEstablished: close old calls");for(var ee=this.callsTable.slice(),ce=ee.length;--ce>=0;)(0,h.ki)(ee[ce].data,"mesh","object")&&ee[ce].data.mesh.calleeCallId===Ce.userMediaId&&"subscribe"!==ee[ce].settingUpType&&this.removeCallFromTableWithCallIdAndSendBye(ee[ce].callId);this.MCUClient.meshOnHangup(Ce.userMediaId),ae=!0}break}}}ae&&this.finalizeMeshToJanusTransition(te,l)}}else ie.debug("wrong roomId: no such session")}else ie.debug("wrong clientId: message not intended for self");else ie.debug("wrong format: missing callFeed")},this.finalizeMeshToJanusTransition=function(t,l){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ie.debug("finalizeMeshToJanusTransition");var v=0,r=0;if(!0===s.force){for(var g=this.callsTable.slice(),E=g.length;--E>=0;){var te=g[E];te.sessionMCU===t&&(("publish"===te.settingUpType||"shareScreen"===te.settingUpType)&&te.data&&te.data.mesh?this.onHangup(te.callId):this.onHangup(te.callId,"disconnected"))}for(var ae=this.userMediaTable.slice(),Re=ae.length;--Re>=0;){var Ce=ae[Re];Ce.sessionMCU===t&&this.onHangup(Ce.userMediaId,"disconnected")}}else for(var re=this.userMediaTable.length;--re>=0;){var K=this.userMediaTable[re];if(K.sessionMCU===t){v+=1;for(var L=0,ne=K.distantCalls.length;--ne>=0;)ie.debug("finalizeMeshToJanusTransition: distantCall",K.distantCalls[ne]),K.distantCalls[ne].replaced&&(L+=1);L===K.distantCalls.length&&(r+=1)}}v===r&&(ie.debug("finalizeMeshToJanusTransition: finalize transition"),l.transitionTimeoutId&&(clearTimeout(l.transitionTimeoutId),delete l.transitionTimeoutId),this.MCUClient.removeSessionMCU(t),delete l.modeChangeKind,this.MCUClient.transitionCount-=1,this.MCUClient.transitionCount<=0&&this.evalOutgoingVideoBandwithCap(),dt.createMCURoomModeChangedEvent(l.roomName,"mesh","sfu","complete"))},this.processConfigureEncodings=function(t){var l=this.findCallWithCallId(t.callId);if(l&&Object.prototype.hasOwnProperty.call(t,"command")&&"RID"===l.simulcast){var s={};Object.prototype.hasOwnProperty.call(t,"maxBitrate")&&(s.maxBitrate=t.maxBitrate),l.configureSimulcastEncodings(t.command,s)}},this.processSimulcastFeedChanged=function(t){var l=this.findCallWithCallId(t.callId);if(l){var s={};2===t.substream?s.streamQuality="high":1===t.substream?s.streamQuality="medium":0===t.substream&&(s.streamQuality="low"),2===t.temporal?s.streamFrameRate="high":1===t.temporal?s.streamFrameRate="medium":0===t.temporal&&(s.streamFrameRate="low"),Object.keys(s).length>0&&dt.createSimulcastFeedChanged(l.callId,s)}},this.createCallControl=function(t){var l=new ot(t);return this.callControlTable.push(l),l},this.destroyCallControl=function(t){if(t.multi){if(!t.roomName)return ie.warn("findCallControl: cannot destroy without roomName"),null;for(var l=[],s=this.callControlTable.length;--s>=0;)this.callControlTable[s].roomName===t.roomName&&(l.push(this.callControlTable[s]),this.callControlTable.splice(s,1));return l}var v=this.findCallControl(t,{accept:"index"});if(null!==v&&v>=0){var r=this.callControlTable[v];return this.callControlTable.splice(v,1),r}return null},this.findCallControl=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="index"===l.accept;if("publish"===t.type||"shareScreen"===t.type){if(!t.callId)return ie.warn("findCallControl: cannot search without callId"),null;for(var v=null,r=null,g=this.callControlTable.length;--g>=0;)if(("publish"===this.callControlTable[g].type||"shareScreen"===this.callControlTable[g].type)&&this.callControlTable[g].callId===t.callId){v=this.callControlTable[g],r=g;break}return v?s?r:v:null}if("subscribe"===t.type){if(!(0,h.ki)(t,"stream","object")||!Object.prototype.hasOwnProperty.call(t.stream,"id")||!(0,h.ki)(t.stream,"attributes","object"))return ie.warn("findCallControl: cannot search without stream"),null;for(var E=null,te=null,ae=this.callControlTable.length;--ae>=0;)if("subscribe"===this.callControlTable[ae].type&&(this.callControlTable[ae].stream.id===t.stream.id||this.callControlTable[ae].stream.attributes.callerId===t.stream.attributes.callerId&&this.callControlTable[ae].stream.attributes.callId===t.stream.attributes.callId)){E=this.callControlTable[ae],te=ae;break}return E?s?te:E:null}return ie.warn("findCallControl: wrong type",t.type),null},this.getCallControls=function(t){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={};if(l.addUserMedia)for(var v=this.userMediaTable.length;--v>=0;){var r=this.userMediaTable[v];s[r.userMediaId]=r}if(t){for(var g=this.callControlTable.length;--g>=0;){var E=this.callControlTable[g];t.indexOf(E.type)>=0&&(s[E.callId]=E)}return s}for(var te=this.callControlTable.length;--te>=0;){var ae=this.callControlTable[te];s[ae.callId]=ae}return s},this.getCallIds=function(t){for(var l=[],s=this.callControlTable.length;--s>=0;){var v=this.callControlTable[s];t.indexOf(v.type)>=0&&l.push(v.callId)}return l},this.evalOutgoingVideoBandwithCap=function(t){if(ie.debug("evalOutgoingVideoBandwithCap"),!(this.MCUClient.transitionCount>0)){var l=null;this.videoBandwidthSettings.perCallOutgoing&&(l=this.videoBandwidthSettings.perCallOutgoing);for(var s=[],v=this.callsTable.length;--v>=0;)this.callsTable[v].belongsToRoom()&&"publish"!==this.callsTable[v].settingUpType&&"shareScreen"!==this.callsTable[v].settingUpType||this.callsTable[v].localCallProfile&&this.callsTable[v].localCallProfile.video&&this.callsTable[v].localCallProfile.videoActive&&s.push(this.callsTable[v]);if(0===s.length)return l;if(this.videoBandwidthSettings.overallOutgoing){var r=Math.floor(this.videoBandwidthSettings.overallOutgoing/s.length);l=l?Math.min(l,r):r}for(var g=s.length;--g>=0;)t&&s[g]===t?l&&s[g].videoCap!==l?(s[g].videoCap=l,this.rtpSenderSetParamatersCapable&&s[g].applyOutgoingBitrate(s[g].videoCap)):!l&&s[g].videoCap&&(delete s[g].videoCap,this.rtpSenderSetParamatersCapable&&s[g].applyOutgoingBitrate(null)):l&&s[g].videoCap!==l?(s[g].videoCap=l,this.rtpSenderSetParamatersCapable?s[g].applyOutgoingBitrate(s[g].videoCap):setTimeout(function(E){E.belongsToRoom()||!E.callee?(E.updateUserMedia=!0,E.establishCall()):ie.debug("Call is not to be updated")},0,s[g])):!l&&s[g].videoCap&&(delete s[g].videoCap,this.rtpSenderSetParamatersCapable?s[g].applyOutgoingBitrate(null):setTimeout(function(E){E.belongsToRoom()||!E.callee?(E.updateUserMedia=!0,E.establishCall()):ie.debug("Call is not to be updated")},0,s[g]));return l}ie.debug("evalOutgoingVideoBandwithCap - transition ongoing")},this.callback=function(t,l){return this.closureHandler=function(s){return t[l](s)},this.closureHandler},this.callbackWithParams=function(t,l){return this.closureHandler=function(s,v,r){return t[l](s,v,r)},this.closureHandler},this.simulatedAgentLaunchWaitingCall=function(){this.socket.emit("simulatedAgentLaunchWaitingCall",{type:"simulatedAgentLaunchWaitingCall"})}},je=(e(2707),i.Y.get("PreCallTest")),Wt=2e4,Gt=apiCC.myWebRTC_Event,kt=function(G,A,t,l,s){var v=this;this.webRTCClient=G.webRTCClient,this.notifyTerminated=G.notifyTerminated,this.audioSourceId=l,this.videoSourceId=s,this.testId="initial",this.stepId="initial",this.report={tests:[],resolutions:[],failurCause:""},this.maxHeight=240,this.maxWidth=320,this.resolutions=[[320,240,"QVGA"],[640,480,"VGA"],[1024,576,"SD"],[1280,720,"HD 720p"],[1920,1080,"HD 1080p"]],this.currentResolution=0,this.userMediastreamId=null,"simpleVideoRecordTest"===t&&(je.warn("Simple video record test is activated"),this.simpleVideoRecordTest=!0),!0===apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled&&(je.debug("Forcing meshModeEnabled to false for precall test"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled=!1,this.modifyMeshModeEnabledValueBeforePreCall=!0),this.generateId=function(r){for(var g="",E="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",te=0;te<r;te+=1)g+=E.charAt(Math.floor(Math.random()*E.length));return g},this.generateRoomId=function(){return"PC-"+this.generateId(4)+"-"+this.generateId(4)+"-"+this.generateId(4)},this.pushStats=function(r,g){return r.data.push(g),!0},this.evalQuartiles=function(r,g,E){var te=[];if(r.forEach(void 0===E?function(Ft){"number"==typeof Ft[g]&&te.push(Ft[g])}:function(Ft){te.push(E(Ft[g]))}),te.sort(function(Ft,si){return Ft<si?-1:Ft===si?0:1}),te.length%2==0){var ae=te.length/2,Re=Math.floor((te[ae-1]+te[ae])/2);if(ae%2==0){var Ce=ae/2,re=Math.floor((te[Ce-1]+te[Ce])/2),K=ae+Ce,L=Math.floor((te[K-1]+te[K])/2);return{min:te[0],firstQuartile:re,median:Re,thirdQuartile:L,max:te[te.length-1]}}var ne=Math.floor(ae/2);return{min:te[0],firstQuartile:te[ne],median:Re,thirdQuartile:te[ae+ne],max:te[te.length-1]}}var me=Math.floor(te.length/2),Te=te[me];if((me+1)%2==0){var ge=(me+1)/2,Ie=Math.floor((te[ge-1]+te[ge])/2),we=me+ge,Pe=Math.floor((te[we-1]+te[we])/2);return{min:te[0],firstQuartile:Ie,median:Te,thirdQuartile:Pe,max:te[te.length-1]}}var We=Math.floor(me/2);return{min:te[0],firstQuartile:te[We],median:Te,thirdQuartile:te[me+We],max:te[te.length-1]}},this.runBitRateTest=function(){apiCC.webRTCCompliant?(je.debug("Run bitrate test"),"initial"===this.testId&&(this.handlers=[{type:"joinMCUSessionAnswer",callback:this.handleJoinMCUSessionAnswer.bind(this)},{type:"MCUAvailableStream",callback:this.handleMCUAvailableStream.bind(this)},{type:"onCallStatsUpdate",callback:this.handleOnCallStatsUpdate.bind(this)},{type:"remoteStreamAdded",callback:this.handleRemoteStreamAdded.bind(this)},{type:"userMediaSuccess",callback:this.handleuserMediaSuccess.bind(this)},{type:"MCURecordedStreamsAvailable",callback:this.handleRecordingStreamAvailable.bind(this)}],this.handlers.forEach(function(r){apiRTC.addEventListener(r.type,r.callback)}),this.webRTCClient.setMCUConnector("mcu4.apizee.com"),this.webRTCClient.setAllowMultipleCalls(!0),this.webRTCClient.enableCallStatsMonitoring(!0,1e3),this.webRTCClient.enableQualityEvaluating(!0,1e3),this.startNextTest())):(this.report.failurCause="Your device is not WebRTC Compliant",this.terminate())},this.startNextTest=function(){if(!0===this.simpleVideoRecordTest)"initial"===this.testId?(je.debug("initial simple test"),A?this.runResolutionTest():this.startTestAudioNlVideo(2e3)):"resolution-test"===this.testId?(je.debug("resolution-test simple"),this.startTestAudioNlVideo(2e3)):"audio-and-video-2000"===this.testId&&(je.debug("Before recordThenTerminate simple"),this.recordThenTerminate());else if("initial"===this.testId)A?this.runResolutionTest():this.startTestAudioNlVideo(t);else if("resolution-test"===this.testId)this.startTestAudioNlVideo(t);else if(this.testId==="audio-and-video-"+t)if("success"===this.report[this.testId].status){var g=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==g.bitsReceivedPerSecond.max&&g.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():g.bitsReceivedPerSecond.max>=15e5?this.startTestAudioNlVideo(1500):g.bitsReceivedPerSecond.max>=1e6?this.startTestAudioNlVideo(1e3):g.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):g.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-1500"===this.testId)if("success"===this.report[this.testId].status){var te=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==te.bitsReceivedPerSecond.max&&te.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():te.bitsReceivedPerSecond.max>=1e6?this.startTestAudioNlVideo(1e3):te.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):te.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-1000"===this.testId)if("success"===this.report[this.testId].status){var Re=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==Re.bitsReceivedPerSecond.max&&Re.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():Re.bitsReceivedPerSecond.max>=6e5?this.startTestAudioNlVideo(600):Re.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-600"===this.testId)if("success"===this.report[this.testId].status){var re=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==re.bitsReceivedPerSecond.max&&re.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():re.bitsReceivedPerSecond.max>=25e4?this.startTestAudioNlVideo(250):this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else if("audio-and-video-250"===this.testId)if("success"===this.report[this.testId].status){var L=this.stats[this.report[this.testId].subscribeCallIds[0]].videoReceived;void 0!==L.bitsReceivedPerSecond.max&&L.bitsReceivedPerSecond.max+.15*this.videoBandwidth*1e3>=1e3*this.videoBandwidth?this.recordThenTerminate():this.startTestAudioNlOnly()}else this.startTestAudioNlOnly();else this.recordThenTerminate()},this.startTestAudioNlVideo=function(r){this.prepareEnvForNewTest(),je.debug("%ctestAudioNlVideo"+r),this.testId="audio-and-video-"+r,this.report.tests.push(this.testId),this.audioEnabled=!0,this.videoEnabled=!0,this.videoBandwidth=r,this.webRTCClient.setRemoteVideoBandwidth(this.videoBandwidth),this.stats={},this.report[this.testId]={audioEnabled:!0,audioLimited:!1,videoEnabled:!0,videoLimited:!0,videoBandwidth:this.videoBandwidth,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Wt)},this.startTestAudioNlOnly=function(){this.prepareEnvForNewTest(),je.debug("%cstartTestAudioNlOnly"),this.testId="audio-only",this.report.tests.push(this.testId),this.audioEnabled=!0,this.videoEnabled=!1,this.webRTCClient.setRemoteVideoBandwidth(null),this.stats={},this.report[this.testId]={audioEnabled:!0,audioLimited:!1,videoEnabled:!1,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Wt)},this.startTestVideoNlOnly=function(){this.prepareEnvForNewTest(),je.debug("%cstartTestVideoNlOnly"),this.testId="video-only",this.report.tests.push(this.testId),this.audioEnabled=!1,this.videoEnabled=!0,this.videoBandwidth=600,this.webRTCClient.setRemoteVideoBandwidth(this.videoBandwidth),this.stats={},this.report[this.testId]={audioEnabled:!1,audioLimited:!1,videoEnabled:!0,stats:this.stats},this.mcuSession={},this.mcuSession.roomId=this.generateRoomId(),this.report[this.testId].roomId=this.mcuSession.roomId,this.webRTCClient.joinMCUSession(this.mcuSession.roomId),this.stepId="joining-mcu-session",this.timeoutId=setTimeout(this.abortJoinMCUSession.bind(this),Wt)},this.recordThenTerminate=function(){!0===v.modifyMeshModeEnabledValueBeforePreCall&&(je.debug("Restoring meshModeEnabled to true, as it was modified for precall test"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.meshModeEnabled=!0);var r=null;if(v.videoEnabled&&v.audioEnabled?r="AUDIO-VIDEO":v.audioEnabled?r="AUDIO-ONLY":v.videoEnabled&&(r="VIDEO-ONLY"),!r)return je.error("Can't define record type"),void v.terminate();je.debug("Start recording with type:",r),v.webRTCClient.startRecording(r,"recordPreCall",null,null,{ttl:900}),setTimeout(function(){je.debug("Stop recording"),v.webRTCClient.stopRecording()},1e4)},this.terminate=function(){je.debug("Terminate"),this.testId="terminated",this.handlers&&this.handlers.forEach(function(r){apiRTC.removeEventListener(r.type,r.callback)}),this.notifyTerminated(this.report),this.leaveSession()},this.succeed=function(){Gt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"success",stepId:this.stepId}),this.report[this.testId].status="success",this.startNextTest()},this.fail=function(){je.debug("fail"),Gt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"failure",stepId:this.stepId}),this.report[this.testId].status="failure",this.report[this.testId].stepId=this.stepId,this.leaveSession(),this.startNextTest()},this.prepareEnvForNewTest=function(){void 0!==v.mcuSession&&v.leaveSession()},this.abortJoinMCUSession=function(){je.debug("abortJoinMCUSession"),this.fail()},this.abortStreamPublishing=function(){je.debug("abortStreamPublishing"),this.fail()},this.abortStreamSubscribing=function(){je.debug("abortStreamSubscribing"),this.fail()},this.observeStreamPublished=function(){if(je.debug("observeStreamPublished"),"Safari"===apiRTC.browser||"Mobile Safari"===apiRTC.browser)return je.info("Safari"),je.error("observeStreamPublished not supported on Safari"),clearInterval(this.intervalId),void this.fail();if(this.intervalCounter+=1,this.intervalCounter>30)return clearInterval(this.intervalId),void this.fail();if(this.audioEnabled&&this.videoEnabled){var r=0;if(void 0!==this.stats[this.publishCallId]&&(void 0!==this.stats[this.publishCallId].audioSent&&void 0!==this.stats[this.publishCallId].audioSent.bitsSentPerSecond&&this.stats[this.publishCallId].audioSent.bitsSentPerSecond.thirdQuartile>=2e4&&(r+=1),void 0!==this.stats[this.publishCallId].videoSent&&void 0!==this.stats[this.publishCallId].videoSent.bitsSentPerSecond&&this.stats[this.publishCallId].videoSent.bitsSentPerSecond.thirdQuartile>=125e3&&(r+=1)),2===r){clearInterval(this.intervalId);var g=this.streams[0];this.subscribeToUserStream(g.attributes.callerId,g.id,"VIDEO"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Wt)}else je.debug("okCnt !== 2")}else if(this.audioEnabled)if(void 0!==this.stats[this.publishCallId])if(void 0!==this.stats[this.publishCallId].audioSent&&void 0!==this.stats[this.publishCallId].audioSent.bitsSentPerSecond)if(this.stats[this.publishCallId].audioSent.bitsSentPerSecond.thirdQuartile>=2e4){clearInterval(this.intervalId);var E=this.streams[0];this.subscribeToUserStream(E.attributes.callerId,E.id,"AUDIOONLY"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Wt)}else je.debug("no stats audio 1 ");else je.debug("no stats audio 2");else je.debug("no stats audio 3");else if(this.videoEnabled)if(void 0!==this.stats[this.publishCallId])if(void 0!==this.stats[this.publishCallId].videoSent&&void 0!==this.stats[this.publishCallId].videoSent.bitsSentPerSecond)if(this.stats[this.publishCallId].videoSent.bitsSentPerSecond.thirdQuartile>=125e3){clearInterval(this.intervalId);var te=this.streams[0];this.subscribeToUserStream(te.attributes.callerId,te.id,"VIDEOONLY"),this.stepId="stream-subscribing",this.timeoutId=setTimeout(this.abortStreamSubscribing.bind(this),Wt)}else je.debug("no stats video 1 ");else je.debug("no stats video 2");else je.debug("no stats video 3");else je.debug("no audio or video"),clearInterval(this.intervalId),this.fail()},this.observeStreamSubscribed=function(){if(this.intervalCounter+=1,this.intervalCounter>30)return clearInterval(this.intervalId),void this.succeed();var r=null,g=null,E=0,te=0;this.audioEnabled&&(r=this.stats[this.publishCallId].audioSent),this.videoEnabled&&(g=this.stats[this.publishCallId].videoSent);for(var ae=0;ae<this.subscribeCallIds.length;ae+=1){var Re=this.subscribeCallIds[ae];if(this.audioEnabled&&this.videoEnabled){var Ce=0;void 0!==this.stats[Re]&&(void 0!==this.stats[Re].audioReceived&&void 0!==this.stats[Re].audioReceived.bitsReceivedPerSecond&&null!=r&&void 0!==r.bitsSentPerSecond&&this.stats[Re].audioReceived.bitsReceivedPerSecond.thirdQuartile>=r.bitsSentPerSecond.firstQuartile-2e3&&(Ce+=1),void 0!==this.stats[Re].videoReceived&&void 0!==this.stats[Re].videoReceived.bitsReceivedPerSecond&&null!=g&&void 0!==g.bitsSentPerSecond&&this.stats[Re].videoReceived.bitsReceivedPerSecond.thirdQuartile>=g.bitsSentPerSecond.firstQuartile&&(Ce+=1)),2===Ce&&(E+=1)}else this.audioEnabled?void 0!==this.stats[Re]&&void 0!==this.stats[Re].audioReceived&&void 0!==this.stats[Re].audioReceived.bitsReceivedPerSecond&&null!=r&&void 0!==r.bitsSentPerSecond&&this.stats[Re].audioReceived.bitsReceivedPerSecond.thirdQuartile>=r.bitsSentPerSecond.firstQuartile&&(E+=1):te+=1}te>0?(clearInterval(this.intervalId),this.fail()):E===this.subscribeCallIds.length&&(clearInterval(this.intervalId),this.succeed())},this.handleJoinMCUSessionAnswer=function(r){if("joining-mcu-session"===this.stepId){if(Gt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"start",stepId:this.stepId}),clearTimeout(this.timeoutId),this.mcuSession.sessionId=r.detail.sessionId,this.mcuSession.token=r.detail.token,this.audioEnabled&&this.videoEnabled){var g=this,E={audio:{},video:{}};E=apiCC.setResolutionInConstraint(this.maxWidth,this.maxHeight,E),je.debug("constraints :",E),apiRTC.createUserMediaStream({type:"media",audioSourceId:this.audioSourceId,videoSourceId:this.videoSourceId,gum_config:E,release:function(te){je.debug("createUserMediaStream release",te.userMediaStreamId)},success:function(te){je.debug("createUserMediaStream success",te.userMediaStreamId),je.debug("audioSourceId",l),je.debug("videoSourceId",s)},failure:function(te,ae){je.error("createUserMediaStream failure",te.userMediaStreamId),je.error("failure; userMediaStreamId: "+te.userMediaStreamId),je.error("failure; error: "+ae),Gt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"failure",stepId:this.stepId,createUserMediaStreamError:ae}),g.terminate()}})}else if(this.audioEnabled)this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,{audioOnly:!0});else{if(!this.videoEnabled)return void this.fail();this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,{videoOnly:!0,qos:{videoStartQuality:"upper"}})}this.subscribeCallIds=[],this.report[this.testId].publishCallId=this.publishCallId,this.report[this.testId].subscribeCallIds=[],this.streams=[],this.stepId="stream-publishing",this.timeoutId=setTimeout(this.abortStreamPublishing.bind(this),Wt)}},this.handleuserMediaSuccess=function(r){var g={userMediaStreamId:r.detail.userMediaStreamId,qos:{videoStartQuality:"upper"}};this.userMediastreamId=r.detail.userMediaStreamId,this.publishCallId=this.webRTCClient.publish(this.mcuSession.roomId,this.mcuSession.sessionId,this.mcuSession.token,g),this.report[this.testId].publishCallId=this.publishCallId},this.handleRecordingStreamAvailable=function(r){je.debug("handleRecordingStreamAvailable"),this.terminate()},this.handleMCUAvailableStream=function(r){if("stream-publishing"===this.stepId&&!1===r.detail.isRemoteStream)for(var g=0;g<r.detail.streams.length;g+=1){var E=r.detail.streams[g];if(E.room===this.mcuSession.roomId&&E.attributes.callId===this.publishCallId&&"stream-publishing"===this.stepId){if(clearTimeout(this.timeoutId),this.stepId="stream-published",this.streams.push(E),!0===this.simpleVideoRecordTest){var te="VIDEO";!1===E.audio&&(te="VIDEOONLY"),!1===E.video&&(te="AUDIOONLY"),this.subscribeToUserStream(E.attributes.callerId,E.id,te),this.stepId="stream-subscribing"}else this.intervalId=setInterval(this.observeStreamPublished.bind(this),1e3);this.intervalCounter=0}}},this.handleRemoteStreamAdded=function(r){"stream-subscribing"===this.stepId&&void 0!==this.subscribeCallIds.find(function(g){return g===r.detail.callId})&&(clearTimeout(this.timeoutId),this.stepId="stream-subscribed",this.intervalId=setInterval(this.observeStreamSubscribed.bind(this),1e3),this.intervalCounter=0)},this.handleOnCallStatsUpdate=function(r){var g=this;if("stream-published"!==this.stepId&&"stream-subscribing"!==this.stepId&&"stream-subscribed"!==this.stepId||(void 0===this.stats[this.publishCallId]&&(this.stats[this.publishCallId]={}),void 0!==r.detail.stats.audioSent&&(void 0===this.stats[this.publishCallId].audioSent&&(this.stats[this.publishCallId].audioSent={startTime:r.detail.stats.audioSent.timestamp,data:[]}),this.pushStats(this.stats[this.publishCallId].audioSent,r.detail.stats.audioSent)?this.stats[this.publishCallId].audioSent.data.length>=5&&["bitsSentPerSecond","packetsSentPerSecond"].forEach(function(Re){var Ce=g.evalQuartiles(g.stats[g.publishCallId].audioSent.data,Re);Ce.sampleCount=g.stats[g.publishCallId].audioSent.data.length,Ce.time=r.detail.stats.audioSent.timestamp-g.stats[g.publishCallId].audioSent.startTime,g.stats[g.publishCallId].audioSent[Re]=Ce}):je.debug("audio stats not pushed for :",this.publishCallId)),void 0!==r.detail.stats.videoSent&&(void 0===this.stats[this.publishCallId].videoSent&&(this.stats[this.publishCallId].videoSent={startTime:r.detail.stats.videoSent.timestamp,data:[]}),this.pushStats(this.stats[this.publishCallId].videoSent,r.detail.stats.videoSent)?this.stats[this.publishCallId].videoSent.data.length>=5&&(["bitsSentPerSecond","packetsSentPerSecond","framesEncodedPerSecond"].forEach(function(Re){var Ce=g.evalQuartiles(g.stats[g.publishCallId].videoSent.data,Re);Ce.sampleCount=g.stats[g.publishCallId].videoSent.data.length,Ce.time=r.detail.stats.videoSent.timestamp-g.stats[g.publishCallId].videoSent.startTime,g.stats[g.publishCallId].videoSent[Re]=Ce}),this.stats[this.publishCallId].videoSent.width=r.detail.stats.videoSent.width,this.stats[this.publishCallId].videoSent.height=r.detail.stats.videoSent.height):je.debug("video stats not pushed for :",this.publishCallId))),"stream-subscribed"===this.stepId)for(var E=function(Re){ae=0;var Ce=g.subscribeCallIds[Re];void 0===g.stats[Ce]&&(g.stats[Ce]={}),void 0!==r.detail.stats.audioReceived&&(void 0===g.stats[Ce].audioReceived&&(g.stats[Ce].audioReceived={startTime:r.detail.stats.audioReceived.timestamp,data:[]}),g.pushStats(g.stats[Ce].audioReceived,r.detail.stats.audioReceived)?(void 0===g.stats[Ce].audioReceived.data[(ae=g.stats[Ce].audioReceived.data.length)-1].mosS&&(g.stats[Ce].audioReceived.data[ae-1].mosS={}),g.stats[Ce].audioReceived.data[ae-1].mosS=r.detail.stats.quality.mosS,g.stats[Ce].audioReceived.data.length>=15&&(["bitsReceivedPerSecond","packetsReceivedPerSecond","delay"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].audioReceived.data,re);K.sampleCount=g.stats[Ce].audioReceived.data.length,K.time=r.detail.stats.audioReceived.timestamp-g.stats[Ce].audioReceived.startTime,g.stats[Ce].audioReceived[re]=K}),void 0!==g.stats[Ce].audioReceived.data[0].jitter&&["jitter"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].audioReceived.data,re,function(L){return Math.floor(1e3*L)});K.sampleCount=g.stats[Ce].audioReceived.data.length,K.time=r.detail.stats.audioReceived.timestamp-g.stats[Ce].audioReceived.startTime,g.stats[Ce].audioReceived[re]=K}),g.stats[Ce].audioReceived.packetsLost={max:r.detail.stats.audioReceived.packetsLost,sampleCount:g.stats[Ce].audioReceived.data.length,time:r.detail.stats.audioReceived.timestamp-g.stats[Ce].audioReceived.startTime},["packetsLostRatio"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].audioReceived.data,re);K.sampleCount=g.stats[Ce].audioReceived.data.length,K.time=r.detail.stats.audioReceived.timestamp-g.stats[Ce].audioReceived.startTime,g.stats[Ce].audioReceived[re]=K}),void 0===g.stats[Ce].audioReceived.mosS&&(g.stats[Ce].audioReceived.mosS={}),["mosS"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].audioReceived.data,re);K.sampleCount=g.stats[Ce].audioReceived.data.length,g.stats[Ce].audioReceived[re]=K}))):je.error("audio stats not pushed for callId :",Ce)),void 0!==r.detail.stats.videoReceived&&(void 0===g.stats[Ce].videoReceived&&(g.stats[Ce].videoReceived={startTime:r.detail.stats.videoReceived.timestamp,data:[]}),g.pushStats(g.stats[Ce].videoReceived,r.detail.stats.videoReceived)?(void 0===g.stats[Ce].videoReceived.data[(ae=g.stats[Ce].videoReceived.data.length)-1].mosV&&(g.stats[Ce].videoReceived.data[ae-1].mosV={}),void 0===g.stats[Ce].videoReceived.data[ae-1].mosAV&&(g.stats[Ce].videoReceived.data[ae-1].mosAV={}),g.stats[Ce].videoReceived.data[ae-1].mosV=r.detail.stats.quality.mosV,g.stats[Ce].videoReceived.data[ae-1].mosAV=r.detail.stats.quality.mosAV,g.stats[Ce].videoReceived.data.length>=15&&(["bitsReceivedPerSecond","packetsReceivedPerSecond","framesDecodedPerSecond"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].videoReceived.data,re);K.sampleCount=g.stats[Ce].videoReceived.data.length,K.time=r.detail.stats.videoReceived.timestamp-g.stats[Ce].videoReceived.startTime,g.stats[Ce].videoReceived[re]=K}),void 0!==g.stats[Ce].videoReceived.data[0].jitter&&["jitter"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].videoReceived.data,re,function(L){return Math.floor(1e3*L)});K.sampleCount=g.stats[Ce].videoReceived.data.length,K.time=r.detail.stats.videoReceived.timestamp-g.stats[Ce].videoReceived.startTime,g.stats[Ce].videoReceived[re]=K}),g.stats[Ce].videoReceived.packetsLost={max:r.detail.stats.videoReceived.packetsLost,sampleCount:g.stats[Ce].videoReceived.data.length,time:r.detail.stats.videoReceived.timestamp-g.stats[Ce].videoReceived.startTime},["packetsLostRatio"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].videoReceived.data,re);K.sampleCount=g.stats[Ce].videoReceived.data.length,K.time=r.detail.stats.videoReceived.timestamp-g.stats[Ce].videoReceived.startTime,g.stats[Ce].videoReceived[re]=K}),void 0===g.stats[Ce].videoReceived.mosV&&(g.stats[Ce].videoReceived.mosV={}),["mosV"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].videoReceived.data,re);K.sampleCount=g.stats[Ce].videoReceived.data.length,g.stats[Ce].videoReceived[re]=K}),void 0===g.stats[Ce].videoReceived.mosAV&&(g.stats[Ce].videoReceived.mosAV={}),["mosAV"].forEach(function(re){var K=g.evalQuartiles(g.stats[Ce].videoReceived.data,re);K.sampleCount=g.stats[Ce].videoReceived.data.length,g.stats[Ce].videoReceived[re]=K}),g.stats[Ce].videoReceived.width=r.detail.stats.videoReceived.width,g.stats[Ce].videoReceived.height=r.detail.stats.videoReceived.height)):je.error("video stats not pushed for callId :",Ce))},te=0;te<this.subscribeCallIds.length;te+=1){var ae;E(te)}},this.subscribeToUserStream=function(r,g,E){var te=this,ae=this.webRTCClient.getStreamFromList(g);if(null!=ae){var Re=[];Re.push(ae),this.webRTCClient.subscribe(Re,E).forEach(function(Ce){te.subscribeCallIds.push(Ce),te.report[te.testId].subscribeCallIds.push(Ce)})}},this.leaveSession=function(){je.debug("leaveSession"),void 0!==this.streams&&"number"==typeof this.streams[0]&&this.webRTCClient.unsubscribe(this.streams[0]),null!==this.userMediastreamId&&apiRTC.releaseUserMediaStream(this.userMediastreamId),delete this.streams,delete this.subscribeCallIds,"string"==typeof this.publishCallId&&this.webRTCClient.unpublish(this.publishCallId),delete this.publishCallId,void 0!==this.mcuSession&&void 0!==this.mcuSession.sessionId&&(this.webRTCClient.leaveMCUSession(),delete this.mcuSession.sessionId),delete this.mcuSession,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.splice(0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.length),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionReqs.splice(0,apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionReqs.length),je.debug("leaveSession done")},this.runResolutionTest=function(){this.testId="resolution-test",this.stepId="resolution-test",Gt.createEvent({eventType:"preCallTestStatus",testId:this.testId,status:"start",stepId:this.stepId}),je.debug("Run resolution test"),this.startGetUserMedia(this.resolutions[this.currentResolution])},this.startGetUserMedia=function(r){je.debug("startGetUserMedia :",r);var g={audio:!1,video:{}};g=apiCC.setVideoSourceIdInConstraint(this.videoSourceId,g),g=apiCC.setResolutionInConstraint(r[0],r[1],g),je.debug("startGetUserMedia constraints:",g),apiCC.getUserMedia(g).then(function(E){this.resolutions.length>1?(this.report.resolutions.push(r[2]+":   "+r[0]+"x"+r[1]),this.maxWidth=r[0],this.maxHeight=r[1],E.getTracks().forEach(function(te){te.stop()}),this.maybeContinueGetUserMedia()):je.debug("No video track in returned stream.")}.bind(this)).catch(function(E){je.debug("startGetUserMedia catch error:",E),this.resolutions.length>1?je.debug(r[0]+"x"+r[1]+" not supported"):je.error("getUserMedia failed with error: "+E.name),this.maybeContinueGetUserMedia()}.bind(this))},this.maybeContinueGetUserMedia=function(){this.currentResolution!==this.resolutions.length-1?(this.currentResolution++,this.startGetUserMedia(this.resolutions[this.currentResolution])):this.startNextTest()}},Xe=i.Y.get("ApiCCWebRTCClient"),zt=function(G,A,t,l,s,v){Xe.debug("apiCC.ApiCCWebRTCClient"),this.myWebRTC_Event=apiCC.myWebRTC_Event,this.webRTCClient=new Rt(G),this.webRTCClient.channelReady=!0,this.callTest=null,"undefined"==typeof apiRTC_React&&this.webRTCClient.initialize(A,t,l,s,v),this.call=function(r,g,E){return"RECORD"===g&&Xe.warn("DEPRECATED : usage of data parameter on call() as a string with 'RECORD' value will be deprecated in a next version of apiRTC. Please consider using a JSON Data parameter instead : data = {isRecorded : true}"),!0===this.webRTCClient.recordedCall&&(Xe.log("recordedCall option is activated"),void 0!==g&&"RECORD"!==g||(g={}),g.MCUType="MCU-Caller",g.confId=Math.floor(1000001*Math.random()).toString()),void 0!==g&&("RECORD"!==g&&!0!==g.isRecorded||(Xe.log("recordedCall option is activated"),"RECORD"===g&&(g={}),g.MCUType="MCU-Caller",g.confId=Math.floor(1000001*Math.random()).toString())),null!=E&&!0===E.record&&(Xe.log("callConfiguration record option is activated"),void 0!==g&&"RECORD"!==g||(g={}),g.MCUType="MCU-Caller",g.confId=Math.floor(1000001*Math.random()).toString()),Xe.log("session.webRTCPluginActivated =",G.webRTCPluginActivated),("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&!0===G.webRTCPluginActivated?(Xe.log("managing call with WebRTC Plugin"),null==E&&(E={}),E.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){Xe.log("manageWebRTCPlugin cb in call"),apiCC.session.apiCCWebRTCClient.webRTCClient.callWithNumber(r,!0,g,E)},function(){Xe.log("actionOnInstallationNeeded")}),E.apzcallId):(Xe.log("managing call with browser"),this.webRTCClient.callWithNumber(r,!0,g,E))},this.getStatsFromCall=function(r,g){var E=this.webRTCClient.findCallWithCallId(r);null===E?g(new Error("Call was not found"),null):null===E.pc?g(new Error("Call has no peerconnection"),null):!0===this.webRTCClient.csmEnable?g(null,this.webRTCClient.csmLastResults):g(new Error("Call stats monitoring not activated"),null)},this.testCall=function(r){return Xe.log("session.webRTCPluginActivated =",G.webRTCPluginActivated),("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&!0===G.webRTCPluginActivated?(Xe.log("managing call with WebRTC Plugin"),null==r&&(r={}),r.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){Xe.log("manageWebRTCPlugin cb in call"),apiCC.session.apiCCWebRTCClient.webRTCClient.startTestCall(!0,r)},function(){Xe.log("actionOnInstallationNeeded")}),r.apzcallId):(Xe.log("managing call with browser"),this.webRTCClient.startTestCall(!0,r))},this.setClientTurnServer=function(r){this.webRTCClient.setClientTurnServer(r)},this.activateScreenSharing=function(r){this.webRTCClient.activateScreenSharing(r)},this.shareScreen=function(r,g,E){return Xe.info("shareScreen"),this.webRTCClient.shareScreen(r,g,E)},this.startScreenSharingOnCall=function(r,g){Xe.info("startScreenSharingOnCall"),this.webRTCClient.startScreenSharingOnCall(r,g)},this.startDataChannel=function(r,g){if(Xe.info("startDataChannel"),!("Edge"===d.Xh&&d.PR<79))return void 0!==g?g.dataCall=!0:(g={}).dataCall=!0,this.webRTCClient.callWithNumber(r,!0,g,null);Xe.warn("Cannot startDataChannel as it is not supported on Edge")},this.startDataChannelOnCall=function(r){this.webRTCClient.startDataChannelOnCall(r)},this.sendDataWithCallId=function(r,g,E){this.webRTCClient.sendDataWithCallId(r,g,E)},this.callAudio=function(r,g,E){return Xe.info("callAudio"),this.webRTCClient.callWithNumber(r,!1,g,E)},this.callbymail=function(r){this.webRTCClient.callbymail(r)},this.addMedia=function(r){return this.webRTCClient.addMedia(r),r},this.hangUp=function(r){this.webRTCClient.onHangup(r)},this.getMyMedia=function(r,g){Xe.info("getMyMedia : ",r),"screen"===r?this.webRTCClient.shareScreen("LOCAL",{},g):this.webRTCClient.getUserMedia()},this.releaseStream=function(r){Xe.info("releaseStream : ",r),Xe.info("releaseStream.callId : ",r.callId),void 0!==r.callId?this.webRTCClient.removeCallFromTableWithCallIdAndSendBye(r.callId,"stop_ScreenSharing"):this.webRTCClient.stopStream(r)},this.autoAnswerUserMediaSuccessHandler=function(r){Xe.info("autoAnswerUserMediaSuccessHandler :"+r),r=null,this.webRTCClient.autoAnswer=!0},this.autoAnswerUserMediaErrorHandler=function(r){Xe.info("autoAnswerUserMediaErrorHandler :"+r),r=null,this.webRTCClient.autoAnswer=!1},this.activateAutoAnswer=function(){apiCC.addEventListener("userMediaSuccess",this.callback(this,"autoAnswerUserMediaSuccessHandler")),apiCC.addEventListener("userMediaError",this.callback(this,"autoAnswerUserMediaErrorHandler")),this.webRTCClient.getUserMedia()},this.getAutoAnswer=function(){return this.webRTCClient.autoAnswer},this.setUnidirectionalCall=function(r){!0===r||!1===r?this.webRTCClient.unidirectionelCallOnly=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUnidirectionalCall()","PARAMETER_ERROR_SETUNIDIRCALL")},this.setReceiveMediaDeactivated=function(r){!0===r||!1===r?this.webRTCClient.receiveMediaDeactivated=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setReceiveMediaDeactivated()","PARAMETER_ERROR_SETRECVMEDIADEACTIVATED")},this.setPreferVP9Codec=function(r){!0===r||!1===r?this.webRTCClient.preferVP9Codec=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setPreferVP9Codec()","PARAMETER_ERROR_SETPREFERVP9CODEC")},this.setPreferH264Codec=function(r){!0===r||!1===r?this.webRTCClient.preferH264Codec=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setPreferH264Codec()","PARAMETER_ERROR_SETPREFERH264CODEC")},this.getUnidirectionalCall=function(){return this.webRTCClient.unidirectionelCallOnly},this.toggleVideoMute=function(r){return this.webRTCClient.toggleVideoMute(r)},this.isVideoMuted=function(r){var g;return Xe.debug("isVideoMuted :",r),null==r?this.webRTCClient.isVideoMuted:(Xe.debug("callId is defined :",r),-1!==(g=this.webRTCClient.findCallIndexWithCallId(r))?this.webRTCClient.callsTable[g].isLocalVideoMuted:void 0)},this.toggleAudioMute=function(r){return this.webRTCClient.toggleAudioMute(r)},this.sendDTMF=function(r,g,E,te){return this.webRTCClient.sendDTMF(r,g,E,te)},this.isAudioMuted=function(r){var g;return Xe.debug("isAudioMuted :",r),null==r?this.webRTCClient.isAudioMuted:(Xe.debug("callId is defined :",r),-1!==(g=this.webRTCClient.findCallIndexWithCallId(r))?this.webRTCClient.callsTable[g].isLocalAudioMuted:void 0)},this.setNtoNConf=function(r){!0===r||!1===r?this.webRTCClient.NtoNConf=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setNtoNConf()","PARAMETER_ERROR_SETNTONCONF")},this.getNtoNConf=function(){return this.webRTCClient.NtoNConf},this.setRTPMedia=function(r){!0===r||!1===r?this.webRTCClient.RTPMedia=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setRTPMedia()","PARAMETER_ERROR_SETRTPMEDIA")},this.getRTPMedia=function(){return this.webRTCClient.RTPMedia},this.setMediaRoutingMode=function(r){"hostOnly"===r?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.hostOnly:"stun"===r?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.stun:"stunOnly"===r?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.stunOnly:"turn"===r?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turn:"turnOnly"===r?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turnOnly:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setMediaRoutingMode()","PARAMETER_ERROR_SETMEDIAROUTINGMODE")},this.enableQos=function(r,g){"Chrome"!==apiCC.browser&&"Firefox"!==apiCC.browser&&(Xe.warn("enableQos() is only supported on Chrome and Firefox, support on other browsers will be added soon"),r=!1),Xe.info("this.enableQos="+r),this.webRTCClient.qosEnable=r,this.webRTCClient.qosInterval=g||this.webRTCClient.qosInterval},this.enableCallStatsMonitoring=function(r,g){["chrome","firefox"].indexOf(h.wL.type)<0?Xe.warn("enableCallStatsMonitoring() is only supported on Chrome and Firefox, support on other browsers will be added soon"):(this.webRTCClient.csmEnable=r,g&&(this.webRTCClient.csmIntervalMs=g))},this.enableQualityEvaluating=function(r,g){["chrome","firefox"].indexOf(h.wL.type)<0?Xe.warn("enableQualityEvaluating() is only supported on Chrome and Firefox, support on other browsers will be added soon"):(this.webRTCClient.qualityScoreEnable=r,g&&(this.webRTCClient.qualityScoreIntervalMs=g))},this.getMediaRoutingMode=function(){var r=null;return this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.hostOnly?r="hostOnly":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.stun?r="stun":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.stunOnly?r="stunOnly":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turn?r="turn":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turnOnly&&(r="turnOnly"),r},this.setMediaTypeForIncomingCall=function(r){Xe.debug("setMediaTypeForIncomingCall :",r),"VIDEO"===r||"AUDIO"===r||"VIDEOONLY"===r||"NONE"===r?this.webRTCClient.mediaTypeForIncomingCall=r:Xe.log("setMediaTypeForIncomingCall, value is not correct",r)},this.setMediaTypeForOutgoingCall=function(r){Xe.debug("setMediaTypeForOutgoingCall :",r),"VIDEO"===r||"AUDIO"===r||"VIDEOONLY"===r||"NONE"===r?this.webRTCClient.mediaTypeForOutgoingCall=r:Xe.log("setMediaTypeForOutgoingCall, value is not correct",r)},this.setStereo=function(r){Xe.info("setStereo :",r),!0===r?(this.webRTCClient.setStereo=r,this.webRTCClient.gum_config={audio:{mandatory:{echoCancellation:!1,googEchoCancellation:!1},optional:[]},video:{mandatory:{},optional:[]}}):!1===r?this.webRTCClient.setStereo=r:Xe.log("setStereo, value is not correct",r)},this.setMCUConnector=function(r){Xe.info("setMCUConnector :",r),Xe.log("setting value :",r),"mcu4.apizee.com"===r?this.webRTCClient.MCUClient.pubConnector="janusConnector":"mcu3.apizee.com"===r?this.webRTCClient.MCUClient.pubConnector="groupKurentoConnector":Xe.log("value is incorrect :",r)},this.enableMeshRoomMode=function(r){Xe.info("enableMeshRoomMode :",r),"IE"===d.Xh?(Xe.log("IE detected, MeshRoomMode is not supported"),this.webRTCClient.MCUClient.meshModeEnabled=!1):this.webRTCClient.MCUClient.meshModeEnabled=r},this.setAllowAsymetricMediaCalls=function(r){Xe.info("setAllowAsymetricMediaCalls :",r),!0===r||!1===r?this.webRTCClient.allowAsymetricMediaCalls=r:Xe.log("setAllowAsymetricMediaCalls, value is not correct",r)},this.takeSnapshot=function(r,g,E,te,ae,Re,Ce){this.webRTCClient.takeSnapshot(r,g,G.apiKey,E,te,ae,Re,Ce)},this.takeSnapshotAndSendOnDataChannel=function(r,g,E,te){this.webRTCClient.takeSnapshotAndSendOnDataChannel(r,g,E,te)},this.setUserAcceptOnIncomingCall=function(r){Xe.info("setUserAcceptOnIncomingCall :",r),!0===r||!1===r?this.webRTCClient.userAcceptOnIncomingCall=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALL")},this.setUserAcceptOnIncomingCallBeforeGetUserMedia=function(r){Xe.info("setUserAcceptOnIncomingCallBeforeGetUserMedia :",r),!0===r||!1===r?this.webRTCClient.userAcceptOnIncomingCallBeforeGetUserMedia=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingCallBeforeGetUserMedia()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALLBEFOREGUM")},this.setUserAcceptOnIncomingDataCall=function(r){!0===r||!1===r?this.webRTCClient.userAcceptOnIncomingDataCall=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingDataCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALL")},this.setUserAcceptOnIncomingScreenSharingCall=function(r){!0===r||!1===r?this.webRTCClient.userAcceptOnIncomingScreenSharingCall=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingScreenSharingCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOSCREENSHARINGCALL")},this.setHideLocalVideoOnCall=function(r){!0===r||!1===r?this.webRTCClient.hideLocalVideoOnCall=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : hideLocalVideoOnCall()","PARAMETER_ERROR_SETHIDELOCALVIDEOONCALL")},this.setAllowMultipleCalls=function(r){!0===r||!1===r?this.webRTCClient.allowMultipleCalls=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setAllowMultipleCalls()","PARAMETER_ERROR_SETALLOWMULTIPLECALLS")},this.setPcConfig=function(r){Xe.info("Setting PC_config to :",r),this.webRTCClient.pc_config=r},this.setPcConstraints=function(r){Xe.info("Setting PC_constraints to :"+r),this.webRTCClient.pc_constraints=r},this.setGetUserMediaConfig=function(r){this.webRTCClient.setGetUserMediaConfig(r)},this.setTrickleIce=function(r){Xe.info("Setting trickleIce to :"+r),!0===r||!1===r?this.webRTCClient.trickleIce=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setTrickleIce()","PARAMETER_ERROR_SETTRICKLEICE")},this.setRecordedCall=function(r){!0===r||!1===r?this.webRTCClient.recordedCall=r:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setRecordedCall()","PARAMETER_ERROR_SETRECORDEDCALL")},this.getRecordedCall=function(){return this.webRTCClient.recordedCall},this.acceptCall=function(r,g){this.webRTCClient.acceptCall(r,g)},this.refuseCall=function(r){Xe.info("refuseCall"),this.webRTCClient.refuseCall(r)},this.toggleVideoScreen=function(r){Xe.info("toggleVideoScreen"),this.webRTCClient.toggleVideoScreen(r)},this.switchVideoToScreen=function(r){Xe.info("switchVideoToScreen"),this.webRTCClient.switchVideoToScreen(r)},this.switchScreenToVideo=function(r){Xe.info("switchScreenToVideo"),this.webRTCClient.switchScreenToVideo(r)},this.addVideoMedia=function(r){Xe.info("addVideoMedia"),this.webRTCClient.addVideoMedia(r)},this.updateMediaDeviceOnCall=function(r,g){return Xe.info("updateMediaDeviceOnCall"),this.webRTCClient.updateMediaDeviceOnCall(r,g)},this.updateMediaTypeOnCall=function(r,g){return!(0,h.Ym)(r,"string")||"VIDEO"!==g&&"AUDIOONLY"!==g&&"VIDEOONLY"!==g?Promise.reject("wrong arguments"):this.webRTCClient.updateMediaTypeOnCall(r,g)},this.releaseUserMedia=function(){this.webRTCClient.releaseUserMedia()},this.setAllowedAudioCodecs=function(r){this.webRTCClient.allowedAudioCodecs=r},this.setAllowedVideoCodecs=function(r){this.webRTCClient.allowedVideoCodecs=r},this.setAudioBandwidth=function(r){this.webRTCClient.setAudioBandwidth(r)},this.setVideoBandwidth=function(r){},this.setRemoteVideoBandwidth=function(r){"number"==typeof r?this.webRTCClient.setVideoBandwidth(r,"remote"):Xe.error("Unvalid target bandwidth usage value needs to be a number :",r)},this.setOverallIncomingVideoBandwidth=function(r){"number"==typeof r?this.webRTCClient.setVideoBandwidth(r,"overall","incoming"):Xe.error("Unvalid target bandwidth usage value needs to be a number :",r)},this.setOverallOutgoingVideoBandwidth=function(r){"number"==typeof r?this.webRTCClient.setVideoBandwidth(r,"overall","outgoing"):Xe.error("Unvalid target bandwidth usage value needs to be a number :",r)},this.setPerCallIncomingVideoBandwidth=function(r){"number"==typeof r?this.webRTCClient.setVideoBandwidth(r,"perCall","incoming"):Xe.error("Unvalid target bandwidth usage value needs to be a number :",r)},this.setPerCallOutgoingVideoBandwidth=function(r){"number"==typeof r?this.webRTCClient.setVideoBandwidth(r,"perCall","outgoing"):Xe.error("Unvalid target bandwidth usage value needs to be a number :",r)},this.setDataBandwidth=function(r){this.webRTCClient.setDataBandwidth(r)},this.createMCUSession=function(r,g){Xe.info("createMCUSession"),this.webRTCClient.MCUClient.initDivElements(r,g),this.webRTCClient.MCUClient.createSession()},this.joinMCUSession=function(r){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Xe.debug("joinMCUSession"),r?this.webRTCClient.MCUClient.joinSession(r,g):new Error("wrong roomId")},this.getMCUStreamList=function(){return Xe.debug("getMCUStreamList"),this.webRTCClient.MCUClient.getStreamList()},this.getStreamFromList=function(r){return Xe.debug("getStreamFromList"),this.webRTCClient.MCUClient.getStreamFromList(r)},this.getStreamIdOfUser=function(r){return Xe.debug("getStreamIdOfUser"),this.webRTCClient.MCUClient.getStreamIdOfUser(r)},this.getCallIdFromStreamId=function(r){Xe.debug("getCallIdFromStreamId");var g=this.webRTCClient.findCallWithStreamId(r);return null===g?(Xe.log("call not found in getCallIdFromStreamId"),null):g.callId},this.getCallIdFromRemoteMCUUser=function(r){var g,E;return Xe.debug("getCallIdFromRemoteMCUUser"),g=this.webRTCClient.MCUClient.getStreamIdOfUser(r),null===(E=this.webRTCClient.findCallWithStreamId(g))?(Xe.log("call not found in getCallIdFromRemoteMCUUser"),null):E.callId},this.ejectParticipantFromMCUSession=function(r,g,E){this.webRTCClient.MCUClient.ejectParticipant(r,g,E)},this.publish=function(r,g,E,te,ae,Re){if("IE"===d.Xh&&(Xe.log("apiCC.session.webRTCPluginActivated ="+apiCC.session.webRTCPluginActivated),Xe.log("apiCC.webRTCPluginInstalled ="+apiCC.webRTCPluginInstalled)),("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&!0===apiCC.session.webRTCPluginActivated&&!1===apiCC.webRTCPluginInstalled)return Xe.log("managing call with WebRTC Plugin"),null==te&&(te={}),te.apzcallId=apiCC.generateCallId(),apiCC.manageWebRTCPlugin(function(){apiCC.webRTCPluginInstalled=!0,Xe.info("manageWebRTCPlugin cb in call");var re=this.webRTCClient.MCUClient.getSessionMCU(r);return re&&"mesh"===re.roomMode?this.webRTCClient.MCUClient.meshPublish(r,g,E,te,ae,Re):(Xe.debug("publish"),this.webRTCClient.MCUClient.publish(r,g,E,te,ae,Re))},function(){Xe.log("actionOnInstallationNeeded")}),te.apzcallId;var Ce=this.webRTCClient.MCUClient.getSessionMCU(r);return Ce&&"mesh"===Ce.roomMode?this.webRTCClient.MCUClient.meshPublish(r,g,E,te,ae,Re):(Xe.debug("publish"),this.webRTCClient.MCUClient.publish(r,g,E,te,ae,Re))},this.unpublish=function(r){Xe.info("unpublish"),this.webRTCClient.MCUClient.unpublish(r)},this.publishScreen=function(r,g,E,te){var ae=this.webRTCClient.MCUClient.getSessionMCU(r);return ae&&"mesh"===ae.roomMode?(Xe.info("publishScreen"),this.webRTCClient.MCUClient.meshPublishScreen(r,g,E,te)):(Xe.info("publishScreen"),this.webRTCClient.MCUClient.publishScreen(r,g,E,te))},this.subscribe=function(r,g,E,te,ae){return Xe.info("subscribe :",r),"IE"===d.Xh&&(Xe.log("apiCC.session.webRTCPluginActivated ="+apiCC.session.webRTCPluginActivated),Xe.log("apiCC.webRTCPluginInstalled ="+apiCC.webRTCPluginInstalled)),("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&!0===apiCC.session.webRTCPluginActivated&&!1===apiCC.webRTCPluginInstalled?(Xe.log("managing call with WebRTC Plugin"),apiCC.manageWebRTCPlugin(function(){return apiCC.webRTCPluginInstalled=!0,Xe.log("manageWebRTCPlugin cb in subscribe"),"boolean"==typeof g&&(Xe.warn("DEPRECATED : usage of audioOnly parameter on subscribe() is now replaced by mediatype with value VIDEO, AUDIOONLY or VIDEOONLY and will be deprecated in a next version of apiRTC"),g=!0===g?"AUDIOONLY":"VIDEO"),apiCC.session.apiCCWebRTCClient.subscribe(r,g,E,te)},function(){Xe.log("actionOnInstallationNeeded")}),"WebRTC_Plugin"):("boolean"==typeof g&&(Xe.warn("DEPRECATED : usage of audioOnly parameter on subscribe() is now replaced by mediatype with value VIDEO, AUDIOONLY or VIDEOONLY and will be deprecated in a next version of apiRTC"),g=!0===g?"AUDIOONLY":"VIDEO"),this.webRTCClient.MCUClient.subscribeToStreams(r,g,E,te,ae))},this.unsubscribe=function(r){Xe.info("unsubscribe :",r),this.webRTCClient.MCUClient.unsubscribe(r)},this.startStreaming=function(r,g,E,te){return Xe.info("startStreaming"),this.webRTCClient.MCUClient.startStreaming(r,g,E,te)},this.stopStreaming=function(r){return Xe.info("stopStreaming"),this.webRTCClient.MCUClient.stopStreaming(r)},this.startRecording=function(r,g,E,te,ae){Xe.info("startRecording"),this.webRTCClient.MCUClient.startRecording(r,g,E,te,ae)},this.stopRecording=function(r){Xe.info("stopRecording"),this.webRTCClient.MCUClient.stopRecording(r)},this.changeStreamPriority=function(r,g){var E=this.webRTCClient.findCallWithCallId(r);if(!E&&!(E=this.webRTCClient.findUserMediaById(r)))return Xe.error("changeStreamPriority - no such call",r),!1;if(!E.sessionMCU)return Xe.error("changeStreamPriority - no such sessionMCU"),!1;if(!(0,h.Ym)(g,"number")||g<0)return Xe.error("changeStreamPriority - wrong priority",g),!1;var te=JSON.stringify({type:"changeStreamPriority",roomId:E.sessionMCU.roomName,callerId:apiCC.session.apiCCWebRTCClient.webRTCClient.clientId,callId:r,data:{pubSub:this.webRTCClient.MCUClient.pubConnector,priority:g}});return Xe.log("C->S: "+te),apiCC.session.channel.socket.emit("changeStreamPriority",te),!0},this.startComposite=function(r){Xe.info("startComposite"),this.webRTCClient.MCUClient.startComposite(r)},this.stopComposite=function(r){Xe.info("stopComposite"),this.webRTCClient.MCUClient.stopComposite(r)},this.startCompositeRecording=function(r,g,E,te,ae){Xe.info("startCompositeRecording"),this.webRTCClient.MCUClient.startCompositeRecording(r,g,E,te,ae)},this.stopCompositeRecording=function(r){Xe.info("stopCompositeRecording"),this.webRTCClient.MCUClient.stopCompositeRecording(r)},this.checkCallExist=function(r){for(var g=null,E=this.webRTCClient.callsTable.length;--E>=0;){var te=this.webRTCClient.callsTable[E];if(te.callId===r&&te.data&&te.sessionMCU&&("MCU-Caller"===te.data.MCUType||"MCU-Callee"===te.data.MCUType)&&te.data.confId===te.sessionMCU.roomName){g=te;break}}return g||Xe.error("startCallRecording: no such call"),g},this.startCallRecording=function(r){var g;if(g=this.checkCallExist(r)){var E=(0,h.ws)({},g.data);this.webRTCClient.MCUClient.startCompositeRecording("AUDIO-VIDEO",null,g.sessionMCU.convId,E,g.sessionMCU.roomName)}},this.stopCallRecording=function(r){var g;(g=this.checkCallExist(r))&&this.webRTCClient.MCUClient.stopCompositeRecording(g.sessionMCU.roomName)},this.enforceMCU=function(r){this.webRTCClient.MCUClient.enforceMCU(r)},this.takeSnapshotOnMCUSession=function(r){return Xe.info("takeSnapshotOnMCUSession"),this.webRTCClient.MCUClient.takeSnapshot(r)},this.sendMCUSessionInvitation=function(r,g,E){this.webRTCClient.MCUClient.sendSessionInvitation(r,g,E)},this.sendMCUSessionInvitationToGroupChat=function(r,g){this.webRTCClient.MCUClient.sendSessionInvitationToGroupChat(r,g)},this.acceptMCUSessionInvitation=function(r,g,E,te){this.webRTCClient.MCUClient.initDivElements(E,te),this.webRTCClient.MCUClient.acceptSessionInvitation(r,g)},this.leaveMCUSession=function(r){this.webRTCClient.MCUClient.leaveSession(r)},this.recordStream=function(r){Xe.info("recordStream :",r),void 0!==MediaRecorder?apiCC.recordMgr.record(r).then(function(){Xe.log("Recording started")}).catch(function(g){Xe.error("startRecord failed :",g)}):Xe.debug("MediaRecorder is not supported on this browser, leaving recordStream process")},this.stopRecordStream=function(r){Xe.info("stopRecordStream"),void 0!==MediaRecorder?apiCC.recordMgr.stop().then(function(g){Xe.log("Recording stopped"),r(g)}).catch(function(g){Xe.error("stopRecord failed :",g)}):Xe.debug("MediaRecorder is not supported on this browser, leaving recordStream process")},this.getMediaDevices=function(r){Xe.debug("getMediaDevices 2"),apiCC.getMediaDevices().then(function(g){r(g),apiCC.mediaDeviceMgr.gotSources(g)}).catch(function(g){r(null),apiCC.mediaDeviceMgr.gotSources(null)})},this.setAudioSourceId=function(r){Xe.info("setAudioSourceId :"+r),this.webRTCClient.audioSourceId=r},this.setAudioOutputId=function(r){Xe.info("setaudioOutputId :"+r),this.webRTCClient.audioOutputId=r},this.setVideoSourceId=function(r){Xe.info("setVideoSourceId :"+r),this.webRTCClient.videoSourceId=r},this.setVideoFacingMode=function(r){Xe.info("setVideoFacingMode :"+r),"user"===r||"environment"===r||"left"===r||"right"===r||"deactivated"===r?this.webRTCClient.facingMode="deactivated"===r?null:r:Xe.log("facingMode value is not correct")},this.attachMediaStream=function(r,g){Xe.debug("attachMediaStream"),apiCC.attachMediaStream(r,g)},this.addStreamInDiv=function(r,g,E,te,ae,Re){Xe.debug("addStreamInDiv"),apiCC.addStreamInDiv(r,g,E,te,ae,Re)},this.removeElementFromDiv=function(r,g){Xe.debug("removeElementFromDiv"),apiCC.removeElementFromDiv(r,g)},this.setSelectedStream=function(r){Xe.warn("setSelectedStream() is now deprecated")},this.callback=function(r,g){return this.closureHandler=function(E){return r[g](E)},this.closureHandler},this.startPrecallTest=function(r,g,E,te,ae){this.callTest=new kt({webRTCClient:this,notifyTerminated:r},g,E,te,ae),this.callTest.runBitRateTest()}}},6527:(V,J,e)=>{"use strict";e.d(J,{p:()=>d}),e(3843),e(3710),e(7941),e(2772),e(2564),e(561),e(1058),e(9653),e(3290),e(6755),e(4916),e(3123),e(2222),e(4812);var i=e(1549).Y.get("ApiCCWhiteBoardClient"),d=function(h,P,w,M,C){function S(n){n.style.display="none"}i.debug("Loading apiCC.ApiCCWhiteBoardClient"),this.roomId=null,this.whiteBoardDisconnectionTimeoutId=0,this.sessionStarted=!1,this.prev={},this.lastEmit=Date.now(),this.clients={},this.listenedPeers={},this.touchScreenActivated=!1,this.touchControlPoint={},this.drawElements=[],this.ghostElements={},this.redoStack=[],this.undoIndex=0,this.userCursorColor=null,this.cursors={},this.cursorStyle="cross",this.CURSOR_STYLES=["circle","cross"],this.currentScale=1,this.dx=0,this.dy=0,this.instructionsFaded=!1,this.canvas=null,this.ctx=null,this.currentTool="pen",this.currentColor="rgba(0, 0, 0, 1)",this.currentBrushWidth=1,this.readOnly=!1,this.isDrawing=!1,this.focusOnDrawing=!1,this.paperSheetId=0,this.drawingId=0,this.offline=!1,this.roomJoined=!1,this.laserModeActivated=!1,this.AVAILABLE_TOOLS=["pen","ellipse","rectangle","erase","void","arrow"],this.GEOMETRY_TOOLS=["arrow","rectangle","ellipse"],this.disconnectionTimer=void 0!==C?C:3e4,i.log("Setting Whiteboard disconnectionTimer to : "+this.disconnectionTimer),this.setCanvas=function(n){i.debug("[Whiteboard] setCanvas() :",n),null!==this.canvas&&(i.log("Unsetting old canvas events"),this.sessionStarted&&!this.readOnly&&(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1)))),null!==n&&null!==document.getElementById(n)?(this.canvas=document.getElementById(n),this.ctx=this.canvas.getContext("2d"),this.sessionStarted&&!this.readOnly&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove,this.touchScreenActivated&&(this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)))):(null!==n&&null===document.getElementById(n)&&i.warn("No such element whose id is : "+n),this.canvas=null,this.ctx=null)},this.setCanvas(P),this.sendDataToRoom=function(n){if(i.info("[Whiteboard] sendDataToRoom()"),!1===this.offline&&null!==this.roomId){if(null===apiCC.session||void 0===apiCC.session)return void i.info("apiCC.session does not exist, leaving process");i.debug("this.drawElements :",this.drawElements),i.debug("data.tool :",n.tool);var y=[];i.debug("drawElementsToSend :",y);var R,m={x:0,y:0,drawing:!1,tool:this.currentTool,cursorColor:this.userCursorColor,color:this.currentColor,width:this.currentBrushWidth,paperSheetId:this.paperSheetId,drawElements:y,id:apiCC.session.apiCCId},u=Object.keys(n);for(R=0;R<u.length;R++)m[u[R]]=n[u[R]];apiCC.session.roomMgr.sendMessageToRoom(this.roomId,"whiteBoard",m)}},this.setCursorsDiv=function(){i.warn("[Whiteboard] setCursorsDiv() - method obsolete, please use setUserCursorColor to set a cursor pointer that will be seen by other users")},this.setUserCursorColor=function(n){i.debug("[Whiteboard] setUserCursorColor() : "+n),null===n||"invisible"===n?this.userCursorColor="invisible":/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)?this.userCursorColor=n:(i.warn("[Whiteboard] setUserCursorColor() color "+n+" is invalid, defaulting to invisible"),this.userCursorColor="invisible")},this.setUserCursorColor(w),this.setCursorStyle=function(n){i.debug("[Whiteboard] setCursorStyle() : "+n),this.CURSOR_STYLES.indexOf(n)>-1?(this.userCursorColor="invisible",this.cursorStyle=n):i.error("[Whiteboard] setCursorStyle() style "+n+" is invalid")},this.setFocusOnDrawing=function(n){i.debug("[Whiteboard] setFocusOnDrawing()"),this.focusOnDrawing=n},this.createRoom=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.debug("[Whiteboard] createRoom()"),apiCC.session.roomMgr.createRoom("whiteBoard",n)},this.requestContactListInRoom=function(n){i.log("[Whiteboard] requestContactListInRoom :"+n),apiCC.session.roomMgr.requestContactListInRoom(n)},this.setDrawingTool=function(n){i.debug("[Whiteboard] setDrawingTool()");var y=0;null!==apiCC.session&&(y=apiCC.session.apiCCId),this.AVAILABLE_TOOLS.indexOf(n)>-1&&(this.currentTool=n,this.ghostElements[y]=null)},this.setReadOnly=function(n){i.debug("[Whiteboard] setReadOnly()");var y=0;null!==apiCC.session&&(y=apiCC.session.apiCCId),this.ghostElements[y]=null,this.readOnly=!0===n,this.readOnly&&null!==this.canvas?(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1))):null!==this.canvas&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove,this.touchScreenActivated&&(this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)))},this.laserModeProcess=function(n){var y=this;setTimeout(function(){return y.undo(n)},5e3)},this.undo=function(n){i.debug("[Whiteboard] undo()");var y=this.drawElements.length-1,R=null,m=[],u=[],f=null,I=0;if(null!==apiCC.session&&(I=apiCC.session.apiCCId),void 0===n)for(;y>=0;)this.drawElements[y].userId==I&&(null===R&&(R=this.drawElements[y].undoIndex),R===this.drawElements[y].undoIndex&&(f=this.drawElements.splice(y,1)[0],m.push(f),u.push(f.drawingId))),y--;else for(y=0;y<this.drawElements.length;y++)this.drawElements[y].userId==I&&this.drawElements[y].drawingId===n&&(i.debug("[Whiteboard] element found with drawingId in undo laser :",n),f=this.drawElements.splice(y,1)[0],m.push(f),u.push(f.drawingId));m.length>0&&(this.redraw(),this.sendDataToRoom({tool:"void",delete:u,undoneElements:m}),this.redoStack.push(m))},this.redo=function(){i.debug("[Whiteboard] redo()");var n,y=[];if(this.redoStack.length>0){for(y=this.redoStack.pop(),n=0;n<y.length;n++)this.addNewDrawing(y[n]);this.sendDataToRoom({tool:"void",drawObjectsArray:y}),this.redraw()}},this.setBrushSize=function(n){i.debug("[Whiteboard] setBrushSize()"),!isNaN(n)&&n>0&&(this.currentBrushWidth=n)},this.setBrushColor=function(n){i.debug("[Whiteboard] setBrushColor()"),this.currentColor=n},this.setScale=function(n){i.debug("[Whiteboard] setScale()"),n>0?(this.currentScale=n,this.redraw()):i.warn("Scale factor must be > 0!")},this.getScale=function(){return i.debug("[Whiteboard] getScale()"),this.currentScale},this.setOffset=function(n,y){i.debug("[Whiteboard] setOffset()");var R=parseInt(n,10),m=parseInt(y,10);isNaN(R)||isNaN(m)||(this.dx=Number(R),this.dy=Number(m),this.redraw())},this.getOffset=function(){return i.debug("[Whiteboard] getOffset()"),{x:this.dx,y:this.dy}},this.printSharedText=function(n,y,R,m,u,f){i.debug("[Whiteboard] printSharedText()"),this.setBrushStyle(this.currentColor,this.currentBrushWidth),this.undoIndex++,this.redoStack=[];var I=0;null!==apiCC.session&&(I=apiCC.session.apiCCId);var c={type:"text",x:n,y,text:R,size:m,font:u,border:f,userId:I,drawingId:this.drawingId,color:this.currentColor,width:this.currentBrushWidth,undoIndex:this.undoIndex,time:Date.now()};this.sendDataToRoom({x:n,y,tool:"void",drawObject:c}),this.drawingId++,this.addNewDrawing(c)},this.addPeerListener=function(n,y){i.debug("[Whiteboard] addPeerListener()"),this.listenedPeers.hasOwnProperty(n)||(this.listenedPeers[n]=[]),this.listenedPeers[n].push(y)},this.inviteInRoom=function(n,y,R){var m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i.debug("[Whiteboard] inviteInRoom()"),null!==n?null!==y?apiCC.session.roomMgr.inviteInRoom(n,y,"whiteBoard",R,m):i.debug("wrong destId"):i.debug("wrong roomId")},this.answerToRoomInvitation=function(n,y){i.info("[Whiteboard] answerToRoomInvitation()");var R=y&&!this.isInRoom();return this.isInRoom()?i.error("[Whiteboard] cannot answer room invitation : user is already in a room"):apiCC.session.roomMgr.answerToRoomInvitation(n,y,"whiteBoard"),R&&(i.log("[Whiteboard] user joining room"),this.paperSheetId=0,this.drawingId=0,this.roomId=n,this.sendDataToRoom({tool:"void",needCatchUp:"*||-1"})),R},this.joinRoom=function(n){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.info("[Whiteboard] joinRoom() roomId :",n),null==n?i.error("[Whiteboard] cannot join room : room is null or undefined"):this.isInRoom()&&!0===this.roomJoined?i.error("[Whiteboard] cannot join room : user is already in a room"):apiCC.session.roomMgr.joinRoom(n,"whiteBoard",y)},this.leaveRoom=function(){i.info("[Whiteboard] leaveRoom()"),this.isInRoom()&&(apiCC.session.roomMgr.leaveRoom(this.roomId,"whiteBoard"),this.roomId=null,this.paperSheetId=0,this.drawingId=0,this.listenedPeers={},this.roomJoined=!1)},this.isInRoom=function(){return null!==this.roomId},this.clearPaper=function(){i.debug("[Whiteboard] clearPaper()"),this.deleteHistory()},this.refreshCanvas=function(){null!==this.canvas&&null!==this.ctx&&(this.canvas.width=this.canvas.width)},this.deleteHistory=function(){i.info("[Whiteboard] deleteHistory()");var n=0;null!==apiCC.session&&(n=apiCC.session.apiCCId),this.refreshCanvas(),this.drawElements=[],this.ghostElements[n]=null,this.paperSheetId++,this.drawingId=0,this.sendDataToRoom({tool:"void",deleteHistory:!0})},this.setBrushStyle=function(n,y){null!==this.ctx&&(this.ctx.strokeStyle=n,this.ctx.fillStyle=n,this.ctx.lineWidth=y)},this.redraw=function(){var n,y,R;for(i.debug("[Whiteboard] redraw()"),this.refreshCanvas(),n=0;n<this.drawElements.length;n++)this.drawSingleObject(this.drawElements[n]);for(y=Object.keys(this.ghostElements),n=0;n<y.length;n++)null!==this.ghostElements[y[n]]&&this.drawSingleObject(this.ghostElements[y[n]]);for(y=Object.keys(this.cursors),n=0;n<y.length;n++)if(null!==this.cursors[y[n]]&&"invisible"!==this.cursors[y[n]].color&&(0!==this.cursors[y[n]].x||0!==this.cursors[y[n]].y))switch(R={fromx:(this.cursors[y[n]].x-this.dx)*this.currentScale-13,fromy:(this.cursors[y[n]].y-this.dy)*this.currentScale-13,tox:(this.cursors[y[n]].x-this.dx)*this.currentScale+13,toy:(this.cursors[y[n]].y-this.dy)*this.currentScale+13},this.setBrushStyle(this.cursors[y[n]].color,4),this.cursorStyle){case"circle":null!==this.ctx&&(this.ctx.globalAlpha=.4,this.fillEllipse(R.fromx,R.fromy,R.tox,R.toy),this.drawEllipse(R.fromx+2,R.fromy+2,R.tox-2,R.toy-2),this.ctx.globalAlpha=1);break;case"cross":null!==this.ctx&&(this.ctx.globalAlpha=.7,this.ctx.beginPath(),this.ctx.moveTo(R.fromx+(R.tox-R.fromx)/2,R.fromy),this.ctx.lineTo(R.fromx+(R.tox-R.fromx)/2,R.toy),this.ctx.lineCap="butt",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(R.fromx,R.fromy+(R.toy-R.fromy)/2),this.ctx.lineTo(R.tox,R.fromy+(R.toy-R.fromy)/2),this.ctx.lineCap="butt",this.ctx.stroke(),this.ctx.globalAlpha=1)}},this.addNewDrawing=function(n){var y=0;this.drawElements.push(n),this.drawSingleObject(n),null!==apiCC.session&&(y=apiCC.session.apiCCId),n.userId===y&&!0===this.laserModeActivated&&this.laserModeProcess(n.drawingId)},this.drawSingleObject=function(n){if(null!==this.ctx&&null!==this.canvas){var y={};switch(this.setBrushStyle(n.color,n.width),this.ctx.scale(this.currentScale,this.currentScale),y.fromx=n.fromx-this.dx,y.tox=n.tox-this.dx,y.x=n.x-this.dx,y.fromy=n.fromy-this.dy,y.toy=n.toy-this.dy,y.y=n.y-this.dy,n.type){case"arrow":this.drawArrow(y.fromx,y.fromy,y.tox,y.toy);break;case"ellipse":this.drawEllipse(y.fromx,y.fromy,y.tox,y.toy);break;case"rectangle":this.drawRectangle(y.fromx,y.fromy,y.tox,y.toy);break;case"pen":this.drawLine(y.fromx,y.fromy,y.tox,y.toy);break;case"erase":this.eraseArea(y.fromx,y.fromy);break;case"text":this.drawText(y.x,y.y,n.text,n.size,n.font,n.border)}this.ctx.scale(1/this.currentScale,1/this.currentScale)}},this.drawLine=function(n,y,R,m){null!==this.ctx&&(this.ctx.beginPath(),this.ctx.moveTo(n,y),this.ctx.lineTo(R,m),this.ctx.lineCap="round",this.ctx.stroke())},this.drawText=function(n,y,R,m,u,f){if(null!==this.ctx){var I,c,j="Arial";null!=u&&(j=u),this.ctx.font=m+"px "+j,this.ctx.fillText(R,n,y),null!=f&&(I=this.ctx.strokeStyle,c=this.ctx.lineWidth,this.ctx.strokeStyle=f,this.ctx.lineWidth=1,this.ctx.strokeText(R,n,y),this.ctx.strokeStyle=I,this.ctx.lineWidth=c)}},this.eraseArea=function(n,y){null!==this.ctx&&this.ctx.clearRect(n-this.ctx.lineWidth-1,y-this.ctx.lineWidth-1,2*this.ctx.lineWidth+2,2*this.ctx.lineWidth+2)},this.drawArrow=function(n,y,R,m){if(null!==this.ctx){var u=Math.atan2(m-y,R-n);this.ctx.beginPath(),this.ctx.lineCap="butt",this.ctx.moveTo(n,y),this.ctx.lineTo(R,m),this.ctx.stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(R,m),this.ctx.rotate(u+Math.PI/2),this.ctx.moveTo(0,-this.ctx.lineWidth),this.ctx.lineTo(5*this.ctx.lineWidth*.5+1,10+.25*this.ctx.lineWidth),this.ctx.lineTo(-5*this.ctx.lineWidth*.5-1,10+.25*this.ctx.lineWidth),this.ctx.closePath(),this.ctx.restore(),this.ctx.fill()}},this.drawEllipse=function(n,y,R,m){var u=null,f=null;null!==this.ctx&&(u={x:Math.abs(n-R)/2,y:Math.abs(y-m)/2},f={x:n-(n-R)/2,y:y-(y-m)/2},this.ctx.beginPath(),"IE"!==apiRTC.browser&&this.ctx.ellipse(f.x,f.y,u.x,u.y,0,0,2*Math.PI),this.ctx.stroke())},this.fillEllipse=function(n,y,R,m){if(null!==this.ctx){var u={x:Math.abs(n-R)/2,y:Math.abs(y-m)/2},f={x:n-(n-R)/2,y:y-(y-m)/2};this.ctx.beginPath(),"IE"!==apiRTC.browser&&this.ctx.ellipse(f.x,f.y,u.x,u.y,0,0,2*Math.PI),this.ctx.fill()}},this.drawRectangle=function(n,y,R,m){if(null!==this.ctx){this.ctx.beginPath();var u=n,f=y;n>R&&(u=R),y>m&&(f=m),this.ctx.rect(u,f,Math.abs(n-R),Math.abs(y-m)),this.ctx.stroke()}},this.getContext=function(){return this.ctx},this.loadPhotoInBackground=function(n){i.debug("[Whiteboard] loadPhotoInBackground :"+n);var y=document.getElementsByTagName("body")[0];y.style.backgroundImage="url("+n+")",y.style.backgroundPosition="50% 50%",y.style.backgroundRepeat="no-repeat"},this.messageProcessing=function(n){i.debug("[Whiteboard] messageProcessing");var y,R=null,m=null,u=!1,f=null,I=null,c=null,j=null,q=null;if(this.cursors[n.id]||(i.log("[Whiteboard] messageProcessing - creating cursor for new user : "+n.id),this.cursors[n.id]={id:n.id},this.clients[n.id]={}),this.cursors[n.id].x=n.x,this.cursors[n.id].y=n.y,this.cursors[n.id].lastUpdate=Date.now(),this.cursors[n.id].color=n.cursorColor&&null!==n.cursorColor?n.cursorColor:"invisible",void 0===apiRTC.userAgentInstance||"ON"===apiRTC.userAgentInstance.capabilities.whiteboardCursor?"invisible"!==this.cursors[n.id].color&&(u=!0):(i.debug("[Whiteboard] - cursor is not supported on userAgent"),this.cursors[n.id].color="invisible"),null!==this.ghostElements[n.id]&&(this.ghostElements[n.id]=null,u=!0),this.listenedPeers.hasOwnProperty(n.id))for(f={id:n.id,x:n.x,y:n.y,tool:n.tool,drawing:n.drawing},y=0;y<this.listenedPeers[n.id].length;y++)"function"==typeof this.listenedPeers[n.id][y]?this.listenedPeers[n.id][y](f):i.warn("[Whiteboard] Peer listenener is not a function!");if(n.drawing&&this.clients[n.id]&&(i.debug("data.drawing && this.clients[data.id]"),this.GEOMETRY_TOOLS.indexOf((m={fromx:void 0!==n.prevX?n.prevX:this.clients[n.id].x,fromy:void 0!==n.prevY?n.prevY:this.clients[n.id].y,tox:n.x,toy:n.y,type:null!==n.tool?n.tool:"pen",color:n.color,width:n.width,userId:n.id,drawingId:n.drawingId}).type)>-1?n.prevX&&n.prevY&&(this.ghostElements[n.id]=m,u=!0):this.addNewDrawing(m),this.focusOnDrawing&&((R=this.canvas.parentNode).scrollLeft=this.currentScale*(n.x-this.dx)-R.clientWidth/2,R.scrollTop=this.currentScale*(n.y-this.dy)-R.clientHeight/2)),n.drawObject&&((m=n.drawObject).color=n.color,m.width=n.width,this.ghostElements[n.id]=null,this.addNewDrawing(m),this.focusOnDrawing&&((R=this.canvas.parentNode).scrollLeft=this.currentScale*(n.x-this.dx)-R.clientWidth/2,R.scrollTop=this.currentScale*(n.y-this.dy)-R.clientHeight/2)),n.hasOwnProperty("drawObjectsArray"))for(y=0;y<n.drawObjectsArray.length;y++)this.addNewDrawing(n.drawObjectsArray[y]);if(n.hasOwnProperty("delete"))for(y=this.drawElements.length-1,u=!0;y>=0;)n.delete.indexOf(this.drawElements[y].drawingId)>-1&&this.drawElements[y].userId==n.id&&this.drawElements.splice(y,1),y--;if(n.hasOwnProperty("paperSheetId")){if(n.paperSheetId<this.paperSheetId)i.debug("[Whiteboard] - data.paperSheetId < this.paperSheetId");else if(n.paperSheetId>this.paperSheetId){if(i.debug("[Whiteboard] - messageProcessing : peer has a more recent version : "+this.paperSheetId+" vs "+n.paperSheetId),n.hasOwnProperty("deleteHistory")&&i.debug("User : "+n.id+" ,has deleted the history"),n.hasOwnProperty("drawElements")){for(i.debug("[Whiteboard] - messageProcessing : receiving update from peer"),this.drawElements=null!==n.drawElements?n.drawElements:[],y=0;y<this.drawElements.length;y++)this.drawElements[y].hasOwnProperty("userId")&&this.drawElements[y].hasOwnProperty("drawingId")&&(this.clients[this.drawElements[y].userId]={x:0,y:0,drawing:!1,tool:"pen",cursorColor:null,color:null,width:1,paperSheetId:this.paperSheetId,drawingId:this.drawElements[y].drawingId,id:this.drawElements[y].userId});this.paperSheetId=n.paperSheetId,this.drawingId=0,u=!0}}else if(n.hasOwnProperty("drawingId"))if(i.debug("[Whiteboard] - data.hasOwnProperty(drawingId): "),0!==n.drawingId&&void 0===this.clients[n.id]||void 0!==this.clients[n.id]&&this.clients[n.id].hasOwnProperty("drawingId")&&n.drawingId-this.clients[n.id].drawingId>1)i.log("[Whiteboard] - messageProcessing : catchup from peer required : "+n.drawingId),j=n.id+"||-1",void 0!==this.clients[n.id]&&this.clients[n.id].hasOwnProperty("drawingId")&&(j=n.id+"||"+this.clients[n.id].drawingId),this.sendDataToRoom({tool:"void",needCatchUp:j});else if(n.hasOwnProperty("needCatchUp")&&(n.needCatchUp.startsWith(apiCC.session.apiCCId+"||")||n.needCatchUp.startsWith("*||"))){for(i.debug("[Whiteboard] - messageProcessing : letting peer catchup: "+n.id),I=n.needCatchUp.split("||")[1],c=[],y=0;y<this.drawElements.length;y++)(q=this.drawElements[y]).hasOwnProperty("userId")&&q.hasOwnProperty("drawingId")&&q.userId===apiCC.session.apiCCId&&q.drawingId>parseInt(I,10)&&c.push(q);this.sendDataToRoom({tool:"void",catchUpData:c,catchupIndex:I})}else i.debug("[Whiteboard] - else - drawingId");else if(n.hasOwnProperty("needCatchUp")){for(i.debug("[Whiteboard] - messageProcessing : needCatchUp"+n.id),I=n.needCatchUp.split("||")[1],c=[],y=0;y<this.drawElements.length;y++)c.push(q=this.drawElements[y]);i.debug("[Whiteboard] - sending catchUpData : ",c),this.sendDataToRoom({tool:"void",catchUpData:c,catchupIndex:I})}else i.debug("[Whiteboard] - else - paperSheetId");if(n.hasOwnProperty("catchUpData")){for(i.debug("[Whiteboard] - messageProcessing : catching up: "+n.id),"complete"===n.catchUpStatus&&(i.debug("catchUpData is complete, cleaning drawElements"),this.drawElements.splice(0,this.drawElements.length)),y=0;y<n.catchUpData.length;y++)q=n.catchUpData[y],n.userId===apiCC.session.apiCCId&&q.hasOwnProperty("drawingId")&&this.drawingId<q.drawingId&&(this.drawingId=q.drawingId+1);this.drawElements=n.catchUpData.concat(this.drawElements),this.paperSheetId=n.paperSheetId,u=!0}}u&&this.redraw(),this.clients[n.id]=n},this.isStarted=function(){return this.sessionStarted},this.start=function(){this.isStarted()?i.warn("[Whiteboard] WhiteBoardClient is already started"):(i.info("[Whiteboard] starting WhiteBoardClient"),this.isDrawing=!1,this.prev={},this.lastEmit=Date.now(),this.currentScale=1,this.dx=0,this.dy=0,this.drawingId=0,this.clients={},this.listenedPeers={},this.cursors={},this.drawElements=[],this.touchScreenActivated=!1,this.sessionStarted=!0,null!==this.canvas&&(this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmousemove=this.onmousemove),this.redraw()),null!==apiCC.session&&void 0!==apiCC.session.roomMgr||(i.log("[Whiteboard] roomMgr is not defined, setting offline mode"),this.offline=!0)},this.stop=function(){this.isStarted()?(i.info("[Whiteboard] Stopping WhiteBoardClient"),this.isInRoom()&&this.leaveRoom(),this.sessionStarted=!1,null!==this.canvas&&(this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null,this.touchScreenActivated&&(this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1))),this.drawElements=[],this.ghostElements={},this.redoStack=[]):i.info("[Whiteboard] cannot stop WhiteboardClient as it is not started")},this.getTouchOffSet=function(n){i.debug("[Whiteboard] getTouchOffSet():");var y,R,m,u,f=null,I={offsetX:0,offsetY:0};return f=n.target,y=window.getComputedStyle(f,null),R=parseInt(y.borderLeftWidth,10),m=parseInt(y.borderTopWidth,10),u=f.getBoundingClientRect(),I.offsetX=n.clientX-R-u.left,I.offsetY=n.clientY-m-u.top,i.log("offset.offsetX :"+I.offsetX),i.log("offset.offsetY :"+I.offsetY),I},this.toggleTouchScreen=function(){!0===this.touchScreenActivated?this.deactivateTouchScreen():this.activateTouchScreen()},this.activateTouchScreen=function(){null!==this.canvas?(this.touchScreenActivated=!0,this.canvas.addEventListener("touchstart",this.onTouchStart,!1),this.canvas.addEventListener("touchend",this.onTouchEnd,!1),this.canvas.addEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.addEventListener("touchleave",this.onTouchEnd,!1),this.canvas.addEventListener("touchmove",this.onTouchMove,!1)):i.warn("Trying to activateTouchScreen() while canvas is null.")},this.deactivateTouchScreen=function(){null!==this.canvas?(this.touchScreenActivated=!1,this.canvas.removeEventListener("touchstart",this.onTouchStart,!1),this.canvas.removeEventListener("touchend",this.onTouchEnd,!1),this.canvas.removeEventListener("touchcancel",this.onTouchCancel,!1),this.canvas.removeEventListener("touchleave",this.onTouchEnd,!1),this.canvas.removeEventListener("touchmove",this.onTouchMove,!1)):i.warn("Trying to deactivateTouchScreen() while canvas is null.")},this.activateLaserMode=function(){this.laserModeActivated=!0},this.deactivateLaserMode=function(){this.laserModeActivated=!1},this.sendDrawingData=function(n,y,R){i.debug("[Whiteboard] sendDrawingData()");var m={x:n.offsetX,y:n.offsetY,drawing:y,prevX:this.prev.x,prevY:this.prev.y};if(!1!==y||"invisible"!==this.userCursorColor){var u=0;null!==apiCC.session&&(u=apiCC.session.apiCCId),null!==R&&(m.drawObject=R,m.drawObject.drawingId=this.drawingId,m.drawObject.userId=u,this.drawingId++),m.drawingId=this.drawingId,this.sendDataToRoom(m)}else i.debug("isDrawing false and userCursorColor invisible - leaving sendDrawingData")},this.onmousedown=function(n){n.preventDefault();var y,R,m=n.target||n.srcElement,u=m.currentStyle||window.getComputedStyle(m,null),f=parseInt(u.borderLeftWidth,10)||0,I=parseInt(u.borderTopWidth,10)||0,c=m.getBoundingClientRect(),j={offsetX:this.dx+1/this.currentScale*(n.clientX-f-c.left),offsetY:this.dy+1/this.currentScale*(n.clientY-I-c.top)};if(this.prev.x=j.offsetX,this.prev.y=j.offsetY,this.isDrawing=!0,this.undoIndex++,this.redoStack=[],null===(y=document.getElementById(M))||this.instructionsFaded||(S(y),this.instructionsFaded=!0),"erase"===this.currentTool){this.sendDrawingData(j,this.isDrawing,null);var q=0;null!==apiCC.session&&(q=apiCC.session.apiCCId),this.lastEmit=Date.now(),R={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:q,drawingId:this.drawingId,undoIndex:this.undoIndex,time:Date.now()},this.drawingId++,this.addNewDrawing(R),this.redraw()}}.bind(this),this.onmouseup=function(n){var y,R=null,m=null,u=0,f=0,I=null,c={offsetX:0,offsetY:0},j=0;this.isDrawing&&this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(m=(R=n.target||n.srcElement).currentStyle||window.getComputedStyle(R,null),u=parseInt(m.borderLeftWidth,10)||0,f=parseInt(m.borderTopWidth,10)||0,I=R.getBoundingClientRect(),c.offsetX=this.dx+1/this.currentScale*(n.clientX-u-I.left),c.offsetY=this.dy+1/this.currentScale*(n.clientY-f-I.top),null!==apiCC.session&&(j=apiCC.session.apiCCId),y={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,tox:c.offsetX,toy:c.offsetY,color:this.currentColor,width:this.currentBrushWidth,userId:j,undoIndex:this.undoIndex,time:Date.now()},this.sendDrawingData(c,this.isDrawing,y),this.ghostElements[j]=null,this.redraw(),this.addNewDrawing(y),this.prev.x=c.offsetX,this.prev.y=c.offsetY),this.isDrawing=!1,this.ghostElements[j]=null}.bind(this),this.onmouseleave=function(){var n=0;null!==apiCC.session&&(n=apiCC.session.apiCCId),this.isDrawing=!1,this.sendDrawingData({offsetX:0,offsetY:0},this.isDrawing,null),this.ghostElements[n]=null}.bind(this),this.onmousemove=function(n){var y,R,m,u,f,I=null,c={};if(y=(I=n.target||n.srcElement).currentStyle||window.getComputedStyle(I,null),R=parseInt(y.borderLeftWidth,10)||0,m=parseInt(y.borderTopWidth,10)||0,u=I.getBoundingClientRect(),c.offsetX=this.dx+1/this.currentScale*(n.clientX-R-u.left),c.offsetY=this.dy+1/this.currentScale*(n.clientY-m-u.top),Date.now()-this.lastEmit>30)if(this.sendDrawingData(c,this.isDrawing,null),this.lastEmit=Date.now(),this.isDrawing){var j=0;null!==apiCC.session&&(j=apiCC.session.apiCCId),f={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:j,undoIndex:this.undoIndex,time:Date.now()},"pen"===this.currentTool||"erase"===this.currentTool?("pen"===this.currentTool&&(f.tox=c.offsetX,f.toy=c.offsetY),f.drawingId=this.drawingId,this.drawingId++,this.addNewDrawing(f),this.prev.x=c.offsetX,this.prev.y=c.offsetY):this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(f.tox=c.offsetX,f.toy=c.offsetY,this.ghostElements[j]=f),"pen"!==this.currentTool&&this.redraw()}else"erase"===this.currentTool&&(this.redraw(),f={type:"rectangle",fromx:c.offsetX-this.currentBrushWidth,fromy:c.offsetY-this.currentBrushWidth,tox:parseInt(c.offsetX,10)+parseInt(this.currentBrushWidth,10),toy:parseInt(c.offsetY,10)+parseInt(this.currentBrushWidth,10),color:"#444444",width:1},this.drawSingleObject(f),f.color="#DDDDDD",f.fromx=f.fromx-1,f.fromy=f.fromy-1,f.tox=f.tox+1,f.toy=f.toy+1,this.drawSingleObject(f))}.bind(this),this.onTouchStart=function(n){i.debug("[Whiteboard] handleStart"),n.preventDefault();var y,R=n.changedTouches,m={};this.isDrawing=!0,this.undoIndex++,this.redoStack=[],(m=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*m.offsetX,m.offsetY=this.dy+1/this.currentScale*m.offsetY,this.prev.x=m.offsetX,this.prev.y=m.offsetY,this.sendDrawingData(m,!1,null),null!==(y=document.getElementById(M))&&S(y)}.bind(this),this.onTouchEnd=function(n){i.debug("[Whiteboard] handleEnd :"+n);var y,R={},m=n.changedTouches,u=0;this.isDrawing&&this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&((R=this.getTouchOffSet(m[0])).offsetX=this.dx+1/this.currentScale*R.offsetX,R.offsetY=this.dy+1/this.currentScale*R.offsetY,null!==apiCC.session&&(u=apiCC.session.apiCCId),y={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,tox:R.offsetX,toy:R.offsetY,color:this.currentColor,width:this.currentBrushWidth,userId:u,undoIndex:this.undoIndex,time:Date.now()},this.sendDrawingData(R,this.isDrawing,y),this.addNewDrawing(y),this.prev.x=R.offsetX,this.prev.y=R.offsetY),this.isDrawing=!1,this.ghostElements[u]=null,n=null}.bind(this),this.onTouchCancel=function(n){i.debug("[Whiteboard] handleCancel :"+n);var y=0;null!==apiCC.session&&(y=apiCC.session.apiCCId),this.isDrawing=!1,this.ghostElements[y]=null,n=null}.bind(this),this.onTouchMove=function(n){i.debug("[Whiteboard] handleMove :"+n);var y,R=n.changedTouches,m={};if(Date.now()-this.lastEmit>30&&((m=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*m.offsetX,m.offsetY=this.dy+1/this.currentScale*m.offsetY,this.sendDrawingData(m,this.isDrawing,null),this.lastEmit=Date.now(),this.isDrawing)){(m=this.getTouchOffSet(R[0])).offsetX=this.dx+1/this.currentScale*m.offsetX,m.offsetY=this.dy+1/this.currentScale*m.offsetY;var u=0;null!==apiCC.session&&(u=apiCC.session.apiCCId),y={type:this.currentTool,fromx:this.prev.x,fromy:this.prev.y,color:this.currentColor,width:this.currentBrushWidth,userId:u,undoIndex:this.undoIndex,time:Date.now()},"pen"===this.currentTool||"erase"===this.currentTool?("pen"===this.currentTool&&(y.tox=m.offsetX,y.toy=m.offsetY),y.drawingId=this.drawingId,this.drawingId++,this.addNewDrawing(y),this.prev.x=m.offsetX,this.prev.y=m.offsetY):this.GEOMETRY_TOOLS.indexOf(this.currentTool)>-1&&(y.tox=m.offsetX,y.toy=m.offsetY,this.ghostElements[u]=y,this.redraw())}}.bind(this)}},2719:(V,J,e)=>{"use strict";e.r(J),e(2772),e(3710),e(9554),e(1539),e(8674),e(561),e(2564),e(8309),e(4916),e(3123),e(1058),e(6992),e(8783),e(3948),e(285),e(1637),e(4363),e(9653),e(9714),e(3843),e(7941),e(4812),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2222),e(9600),e(6755),e(4747),e(2526),e(1817),e(2165);var i=e(1549),d=e(5945),h=e(8765),P=e(1215),w=e(3173),M=i.Y.get("RecordManager"),C=e(4708);function S(u){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(u)}var n=i.Y.get("ApiCC_Methods"),y=e(6075).F;apiCC.myWebRTC_Adapter=new y,apiCC.myWebRTC_Event=new h.K;var R=apiCC.myWebRTC_Event;apiCC,apiCC.myEventTable=[],apiCC.ApiCCSession=e(3720).K,apiCC.ApiCCWebRTCClient=e(5882).D,apiCC.ApiCCUserMediaStream=e(7323).q,apiCC.ApiCCPointerSharingClient=e(9213).X,apiCC.ApiCCWhiteBoardClient=e(6527).p,apiCC.ApiCCDataClient=e(128)._,apiCC.ApiCCIMClient=e(6844).U,apiCC.ApiCCCoBrowsingClient=e(1254).W,apiCC.recordMgr=new function(){M.debug("RecordManager creation"),this.mediaRecorder=null,this.recordedBlobs=[],this.mimeType=null,this.record=function(u,f){var I=this;return M.info("record"),M.log("stream :"+u),M.log("stream :",u),new Promise(function(c,j){var q=null;if(void 0===MediaRecorder)return M.debug("MediaRecorder is not supported on this browser, leaving recordStream process"),void j(P.g.createError(w.g.ERROR_STREAM_RECORD,"MediaRecorder is not supported on this browser, leaving recordStream process",M));if(null===u)return M.debug("Stream has no data, cannot record"),void j(P.g.createError(w.g.ERROR_STREAM_RECORD,"Stream has no data, cannot record",M));if(null!==I.mediaRecorder&&(M.log("this.mediaRecorder.state :"+I.mediaRecorder.state),"recording"===I.mediaRecorder.state||"paused"===I.mediaRecorder.state))return M.log("mediaRecorder is already ongoing, use stopRecordStream before trying another record"),void j(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already ongoing, use stopRecordStream before trying another record",M));if(M.debug("checking MediaRecorderOptions mimeType support"),null!=f?(M.debug("options is defined :",f),null!=f.mimeType&&(M.debug("contentType is defined :",f.mimeType),MediaRecorder.isTypeSupported(f.mimeType)&&(q=f.mimeType))):f={},null===q){var b="video/webm;codecs=vp8,opus";MediaRecorder.isTypeSupported(b)||(M.debug(b+" is not Supported"),b="video/webm;codecs=vp9,opus",MediaRecorder.isTypeSupported(b)||(M.debug(b+" is not Supported"),b="video/webm",MediaRecorder.isTypeSupported(b)||(M.debug(b+" is not Supported"),b=""))),f.mimeType=b}I.mimeType=f.mimeType,M.debug("Start record with MediaRecorderOptions :",f);try{I.recordedBlobs=[],I.mediaRecorder=new MediaRecorder(u,f)}catch(T){return M.error("Exception while creating MediaRecorder: "+T+". mimeType: "+f.mimeType),void j(P.g.createError(w.g.ERROR_STREAM_RECORD,"Exception while creating MediaRecorder: "+T+". mimeType: "+f.mimeType,M))}I.mediaRecorder.onstart=function(T){M.log("onstart :"+T),this.onerror=null,c()},I.mediaRecorder.ondataavailable=function(T){T.data&&T.data.size>0&&apiCC.recordMgr.recordedBlobs.push(T.data)},I.mediaRecorder.onerror=function(T){M.log("onerror :"+T),j(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+T,M)),this.onerror=null},I.mediaRecorder.start(10),M.log("MediaRecorder started",I.mediaRecorder)})},this.stop=function(){var u=this;return M.info("stop"),new Promise(function(f,I){return u.mediaRecorder.onstop=function(c){M.log("mediaRecorder onstop :"+c),this.onstart=null,this.onstop=null,this.onerror=null,this.onpause=null,this.onresume=null,this.ondataavailable=null;var j=new Blob(apiCC.recordMgr.recordedBlobs,{type:this.mimeType});f(j)},void 0===MediaRecorder?(M.debug("MediaRecorder is not supported on this browser, leaving recordStream process"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"MediaRecorder is not supported on this browser, leaving recordStream process",M))):null===u.mediaRecorder?(M.log("mediaRecorder is not running, use startRecordStream before trying to stop"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to stop",M))):(M.log("this.mediaRecorder.state :"+u.mediaRecorder.state),"inactive"===u.mediaRecorder.state?(M.log("mediaRecorder is already inactive"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already inactive",M))):void u.mediaRecorder.stop())})},this.pause=function(){var u=this;return M.info("pause"),new Promise(function(f,I){return null===u.mediaRecorder?(M.log("mediaRecorder is not running, use startRecordStream before trying to pause"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to pause",M))):(M.log("this.mediaRecorder.state :"+u.mediaRecorder.state),"paused"===u.mediaRecorder.state?(M.log("mediaRecorder is already paused"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already paused",M))):"inactive"===u.mediaRecorder.state?(M.log("mediaRecorder is inactive"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is inactive",M))):(u.mediaRecorder.onerror=function(c){M.log("onerror :"+c),I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+c,M)),this.onerror=null},u.mediaRecorder.onpause=function(c){M.log("onpause :"+c),this.onerror=null,f()},void u.mediaRecorder.pause()))})},this.resume=function(){var u=this;return M.info("resume"),new Promise(function(f,I){return null===u.mediaRecorder?(M.log("mediaRecorder is not running, use startRecordStream before trying to resume"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is not running, use startRecordStream before trying to resume",M))):(M.log("this.mediaRecorder.state :"+u.mediaRecorder.state),"recording"===u.mediaRecorder.state?(M.log("mediaRecorder is already recording"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is already recording",M))):"inactive"===u.mediaRecorder.state?(M.log("mediaRecorder is inactive"),void I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder is inactive",M))):(u.mediaRecorder.onerror=function(c){M.log("onerror :"+c),I(P.g.createError(w.g.ERROR_STREAM_RECORD,"mediaRecorder error :"+c,M)),this.onerror=null},u.mediaRecorder.onresume=function(c){M.log("onresume :"+c),this.onerror=null,f()},void u.mediaRecorder.resume()))})}},"electron"!==d.$6?e(2746):n.debug("Electron detected, not loading onbeforeunload"),apiCC.addEventListener=function(u,f){var c=null;["sessionReady","incomingCall","callEstablished","remoteHangup","userMediaSuccess","userMediaError","userMediaStop","error","receiveIMMessage","updatePresence","webRTCClientCreated","updateUserStatus","channelEvent","groupChatCreation","groupChatInvitation","groupChatMemberUpdate","addUserInGroupChatAnswer","receiveGroupChatMessage","userDataAnswer","fetchUserDataAnswer","receiveConversationList","receiveConversationHistory","receiveConversationDetailReport","receiveContactOccurrencesFromConversationList","receiveMCUSessionInvitation","MCUSessionCreation","MCUAvailableStream","MCUAvailableStreamUpdate","MCUAvailableReplay","MCURemoveStream","canPlayRemoteVideo","recordedFileAvailable","receiveData","roomCreation","roomJoined","roomInvitation","roomMemberUpdate","receiveRoomMessage","contactListInRoom","snapShotPhotoUploaded","stopRecord","callAttempt","joinMCUSessionAnswer","hangup","desktopCapture","remoteStreamAdded","localStreamRemoved","remoteStreamRemoved","switchStream","sendDataChannelOpen","sendDataChannelClose","sendDataChannelError","receiveDataChannelOpen","receiveDataChannelClose","receiveDataChannelError","connectedUsersListUpdate","onFileSended","onFileSending","onFileReceiving","onFileReceived","onFileProgress","onFilePending","recordedStreamsAvailable","closingWhiteBoard","webRTCPluginInstallation","onQosStatsUpdate","onQosChange","onQosAudioChange","onCallScoreUpdate","activeSpeaker","stopSpeaking","audioAmplitude","preCallTestStatus","onQosVideoChange","onCallStatsUpdate","cpuLimited","bandwidthLimited","MCURecordedStreamsAvailable","MCURecordingStarted","MCURecordingStopped","ICECandidateTypeUpdate","disconnectionWarning","MCUAvailableComposite","callRestarting","selectedICECandidate","MCUParticipantEjected","MCURoomModeChanged","MCUStreamingStarted","MCUStreamingStopped","mediaDeviceChanged","externalJsLoadingStatus","slowLink","localStreamUpdated","remoteStreamUpdated","simulcastFeedChanged","videoQualityChanged","bandwidthResourceManagement","backgroundSubstractionStopVisibilityChange","backgroundSubstractionStopComputeTime","AIESnapshot","AIELog","cloudEventOccurred"].indexOf(u)>-1?("remoteHangup"===u&&n.warn("DEPRECATED : ApiRTC : remoteHangup event is now deprecated, please use hangup event instead"),n.log("Adding listener on type :"+u),"undefined"!=typeof apiRTC_React?eventManager.addEventListener(u,f):document.addEventListener?document.addEventListener(u,f,!1):"undefined"!=typeof $jqApz?(n.log("using $jqApz"),$jqApz(document).on(u,f)):"undefined"!=typeof jQuery?(n.log("using jQuery"),jQuery(document).on(u,f)):n.warn("Custom Events not supported on this browser : addEventListener()"),c=apiCC.myEventTable.push({type:u,listener:f}),n.trace("number of myEventTable:"+c)):(R.createErrorEvent("ERROR: Trying to add a listener on an unknow event","UNKNOWN_EVENT_ON_ADDLISTENER"),n.log("ERROR: Trying to add a listener on an unknow event :"+u))},apiCC.removeEventListener=function(u,f){n.debug("Removing listener on type :"+u),document.removeEventListener?document.removeEventListener(u,f,!1):"undefined"!=typeof jQuery?jQuery(document).off(u,f):n.log("Custom Events not supported on this browser")},apiCC.setSessionStorage=function(u,f,I){n.debug("setSessionStorage"),I=I||36e5;var c=new Date,j=new Date;j.setTime(c.getTime()+I);try{var q=JSON.stringify({value:f,expiresAt:j});sessionStorage.setItem(u,q)}catch(b){n.error("Sotheming went wrong during json strigify to set session storage values")}},apiCC.isWebRTCCompliant=function(){n.debug("isWebRTCCompliant");var u=!1,f=!1;return["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(I){u||I in window&&(u=!0)}),!1===u?(n.debug("isWebRTCCompliant::isWebRTCSupported false"),!1):(["getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia"].forEach(function(I){f||I in navigator&&(f=!0)}),!1===f?(n.debug("isWebRTCCompliant::isWebRTCGUMSupported false or you are connected with HTTP"),!1):"MIUI Browser"===d.Xh?(n.debug("isWebRTCCompliant::MIUI Browser detected false"),!1):"UCBrowser"===d.Xh?(n.debug("isWebRTCCompliant::UCBrowser detected false"),!1):"QQ"===d.Xh||"QQBrowser"===d.Xh||"QQBrowserLite"===d.Xh?(n.debug("isWebRTCCompliant::QQ or QQBrowser or QQBrowserLite detected false"),!1):"Baidu"===d.Xh||"baidu"===d.Xh?(n.debug("isWebRTCCompliant::Baidu or baidu detected false"),!1):("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&!0!==this.webRTCPluginActivated?(n.debug("isWebRTCCompliant FALSE : IE or Safari"),!1):(n.debug("isWebRTCCompliant:: WebRTC is supported"),!0))},apiCC.isQoSStatCompliant=function(){var u=!1;return["chrome","firefox"].indexOf(apiCC.browserDetails.type)<0?(n.debug("QoS Statistics is only supported on Chrome and Firefox"),u):u=!0},apiCC.isScreenSharingCompliant=function(){var u=!1;return"IE"===d.Xh||"Android"===d.BF||"iOS"===apiRTC.osName&&"undefined"!=typeof cordova||("Chrome"===d.Xh||"Firefox"===d.Xh&&d.PR>=52||navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia?u=!0:n.debug("ScreenSharing is not supported")),u},apiCC.getMediaDevices=function(){return n.debug("getMediaDevices"),new Promise(function(u,f){if("undefined"!=typeof apiRTC_React)n.log("enumerateDevices() is supported - React Native"),mediaDevices.enumerateDevices().then(function(I){n.log("enumerateDevices(), sources :",I),apiCC.mediaDeviceMgr.mediaSourceInfos=I,u(I)}).catch(function(I){n.log("enumerateDevices(), error :",I),f(I)});else if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)n.log("enumerateDevices() is supported."),navigator.mediaDevices.enumerateDevices().then(function(I){n.log("enumerateDevices(), sources :",I),apiCC.mediaDeviceMgr.mediaSourceInfos=I,u(I)}).catch(function(I){n.log("enumerateDevices(), error :",I),f(I)});else if(n.log("enumerateDevices() not supported."),"undefined"==typeof MediaStreamTrack)n.warn("This browser does not support MediaStreamTrack"),f(new Error("getMediaDevices() - MediaStreamTrack undefined"));else try{MediaStreamTrack.getSources(u)}catch(I){n.debug("catch MediaStreamTrack.getSources :"+I),f(new Error("getMediaDevices() - Error on MediaStreamTrack.getSources :"+I))}})},apiCC.getMediaDevicesWithCB=function(u){if(n.debug("getMediaDevicesWithCB"),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)n.log("enumerateDevices() is supported."),navigator.mediaDevices.enumerateDevices().then(u).catch(function(f){n.log("navigator.mediaDevices.enumerateDevices error: ",f),f=null});else if(n.log("enumerateDevices() not supported."),"undefined"==typeof MediaStreamTrack)u(null),n.warn("This browser does not support MediaStreamTrack");else try{MediaStreamTrack.getSources(u)}catch(f){n.debug("catch MediaStreamTrack.getSources :"+f),u(null)}},apiCC.getUserMedia=function(u){return n.info("getUserMedia"),n.debug("with constraints :",u),new Promise(function(f,I){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia?(n.debug("webRTC getUserMedia with promises"),navigator.mediaDevices.getUserMedia(u).then(f).catch(I)):"undefined"!=typeof apiRTC_React?(n.debug("webRTC getUserMedia with promises on React Native"),mediaDevices.getUserMedia(u).then(f).catch(I)):(n.debug("webRTC getUserMedia without promises"),apiCC.myWebRTC_Adapter.getUserMedia(u,f,I))})},apiCC.getUserMediaWithCB=function(u,f,I){n.info("getUserMediaWithCB"),n.debug("with constraints :"+JSON.stringify(u)),void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia?(n.log("getUserMedia with promises"),navigator.mediaDevices.getUserMedia(u).then(f).catch(I)):(n.log("getUserMedia without promises"),apiCC.myWebRTC_Adapter.getUserMedia(u,f,I))},apiCC.userMediaStreamTable=[],apiCC.getUserMediaStreamIds=function(){for(var u=[],f=apiCC.userMediaStreamTable.length;--f>=0;)u.push(apiCC.userMediaStreamTable[f].userMediaStreamId);return u},apiCC.getUserMediaStream=function(u,f){var I=null,c=apiCC.userMediaStreamTable.length;if(null==u){if(f&&"function"==typeof f.accept)for(;--c>=0;)if(!0===f.accept(apiCC.userMediaStreamTable[c])){I=apiCC.userMediaStreamTable[c];break}}else for(;--c>=0;)if(apiCC.userMediaStreamTable[c].userMediaStreamId===u){I=apiCC.userMediaStreamTable[c];break}return I},apiCC.getFirstUserMediaStream=function(){return apiCC.userMediaStreamTable.length>0?apiCC.userMediaStreamTable[0]:null},apiCC.createUserMediaStream=function(u){var f=function(j){for(var q=apiCC.userMediaStreamTable.length;--q>=0;)if(apiCC.userMediaStreamTable[q].userMediaStreamId===j){apiCC.userMediaStreamTable.splice(q,1);break}},I=new apiCC.ApiCCUserMediaStream,c="call";return n.debug("[createUserMediaStream] userMediaStreamId: "+I.userMediaStreamId),null==u&&(u={}),u.type&&(I.callType=u.type),u.stream?(I.stream=u.stream,I.streamStolen=!0,I.notifyUserMediaStop=!1):u.gum_config&&(I.gum_config=(0,C.S6)(u.gum_config)),u.audioSourceId&&(I.inputs.audioSourceId=u.audioSourceId),u.videoSourceId&&(I.inputs.videoSourceId=u.videoSourceId),u.facingMode&&(I.inputs.facingMode=u.facingMode),u.captureSourceType&&(I.captureSourceType=u.captureSourceType),u.notifyUserMediaSuccess&&(I.notifyUserMediaSuccess=u.notifyUserMediaSuccess),u.notifyUserMediaError&&(I.notifyUserMediaError=u.notifyUserMediaError),u.tryAudioCallAfterUserMediaError&&(I.tryAudioCallAfterUserMediaError=u.tryAudioCallAfterUserMediaError),u.displayMediaStreamConstraints&&(I.displayMediaStreamConstraints=u.displayMediaStreamConstraints),u.forceExtensionOnChrome&&(I.forceExtensionOnChrome=u.forceExtensionOnChrome),u.filters&&(I.filters=u.filters),u.callId&&("call"!==u.callFlavor&&"userMedia"!==u.callFlavor||(c=u.callFlavor),I.addCallInfo(u.callId,c,null===I.stream)),I.callbacks.release="function"==typeof u.release?u.release:function(){},I.callbacks.success="function"==typeof u.success?u.success:function(){},I.callbacks.failure="function"==typeof u.failure?u.failure:function(){},apiCC.userMediaStreamTable.push(I),null===I.stream?"screenSharing"===I.callType||"screenSharingWithAudio"===I.callType?I.getScreenMedia():"data"!==I.callType?I.getUserMedia():!0===u.sync?(f(I.userMediaStreamId),I.callbacks.failure(I,"wrong type")):setTimeout(function(){f(I.userMediaStreamId),I.callbacks.failure(I,"wrong type")},0):(I.updateMediaProperties(I.stream),!0===u.sync?I.callbacks.success(I):setTimeout(function(){I.callbacks.success(I)},0)),I},apiCC.releaseUserMediaStream=function(u,f,I){var c=!1,j=apiCC.userMediaStreamTable.length,q=null;if(null!==f&&"string"!=typeof f&&(f=null),null==u){if(I&&"function"==typeof I.accept)for(;--j>=0;)if(!0===I.accept(apiCC.userMediaStreamTable[j])){if(f){if(null===(q=apiCC.userMediaStreamTable[j].getOwnerCallInfo())||q.callId!==f){apiCC.userMediaStreamTable[j].removeCallInfo(f);break}}else if(null!==(q=apiCC.userMediaStreamTable[j].getOwnerCallInfo()))break;n.debug("[releaseUserMediaStream] match; userMediaStreamId: "+apiCC.userMediaStreamTable[j].userMediaStreamId),apiCC.userMediaStreamTable[j].release(),f&&apiCC.userMediaStreamTable[j].removeCallInfo(f),apiCC.userMediaStreamTable.splice(j,1),c=!0;break}}else for(;--j>=0;)if(apiCC.userMediaStreamTable[j].userMediaStreamId===u){if(f){if(null===(q=apiCC.userMediaStreamTable[j].getOwnerCallInfo())||q.callId!==f){apiCC.userMediaStreamTable[j].removeCallInfo(f);break}}else if(null!==(q=apiCC.userMediaStreamTable[j].getOwnerCallInfo()))break;n.debug("[releaseUserMediaStream] id; userMediaStreamId: "+apiCC.userMediaStreamTable[j].userMediaStreamId),apiCC.userMediaStreamTable[j].release(),f&&apiCC.userMediaStreamTable[j].removeCallInfo(f),apiCC.userMediaStreamTable.splice(j,1),c=!0;break}return c},apiCC.activeSpeakerDetect=!1,apiCC.activeSpeakerThreshold=100,apiCC.enableActiveSpeakerDetecting=function(u,f){apiCC.activeSpeakerDetect=u,f&&(apiCC.activeSpeakerThreshold=f)},apiCC.apiRTCExtensionInstalled=!1,apiCC.extensionInstallationSuccessCallback=function(){n.debug("extensionInstallationSuccessCallback"),apiCC.apiRTCExtensionInstalled=!0},apiCC.extensionInstallationFailureCallback=function(u,f){n.debug("extensionInstallationFailureCallback : Error :"+u+", "+f),u=null,f=null,R.createDesktopCaptureEvent("Extension_installation_Error",apiRTC.waitingShareScreenCallId,apiRTC.waitingShareScreenDestNumber,apiRTC.waitingCaptureSourceType)},apiCC.manageNotInstalledExtension=function(u,f,I){n.debug("manageNotInstalledExtension"),n.warn("apiRTC extension not installed"),R.createDesktopCaptureEvent("Extension_not_installed",u,f),n.warn("Starting apiRTC extension installation"),apiRTC.waitingShareScreenDestNumber=f,apiRTC.waitingShareScreenCallId=u,apiRTC.waitingCaptureSourceType=I,d.PR>=71?(n.debug("Chrome >= 71, opening Chrome web Store"),apiRTC.extensionInstallationFailureCallback("Chrome71 : chrome.webstore.install() no more supported","Chrome71-screenShare"),window.open("https://chrome.google.com/webstore/detail/apizee-desktop-capture/mjjnofoemoepfididplbfimokpnpcoeg")):chrome.webstore.install("https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",apiRTC.extensionInstallationSuccessCallback,apiRTC.extensionInstallationFailureCallback)},apiCC.activateScreenSharing=function(u){n.debug("activateScreenSharing");var f=null;void 0!==u?n.log("extensionId is defined :"+u):(n.log("using apirtc extension's Id"),u="mjjnofoemoepfididplbfimokpnpcoeg"),"Chrome"===d.Xh?null!==document.getElementById(u)?(n.log("extensionLink is present, screenSharing is already activated"),window.postMessage("apiRTC-extension","*")):(n.log("screenSharing is not yet activated"),(f=document.createElement("link")).href="https://chrome.google.com/webstore/detail/"+u,f.rel="chrome-webstore-item",f.id=u,document.getElementsByTagName("head")[0].appendChild(f),window.addEventListener("message",function(I){var c=null;if(n.log("message: event: "+JSON.stringify(I.data)),I.origin==window.location.origin){if("apiRTC-DeskstopCapture-loaded"!==I.data)return"extensionInstalledAndLoaded"===I.data?(apiCC.apiRTCExtensionInstalled=!0,null!==apiCC.waitingShareScreenUserMediaStream&&void 0!==apiCC.waitingShareScreenUserMediaStream&&(apiCC.userMediaStreamTable.push(apiCC.waitingShareScreenUserMediaStream[0]),delete apiCC.waitingShareScreenUserMediaStream),void(apiCC.waitingShareScreenUserMediaStreamId&&(c=apiCC.getUserMediaStream(apiCC.waitingShareScreenUserMediaStreamId),delete apiCC.waitingShareScreenUserMediaStreamId,c&&c.getScreenMedia()))):void("object"===S(I.data)&&void 0!==I.data.desktopId&&("getScreenMedia"!==I.data.remoteId||null===(c=apiCC.getUserMediaStream(I.data.callNumber))||c.registerScreenMedia(I.data.captureSourceType,I.data.desktopId)));apiCC.apiRTCExtensionInstalled=!0}}),window.postMessage("apiRTC-extension","*")):(n.log("activateScreenSharing is only available for chrome Browser"),R.createDesktopCaptureEvent("Browser_Not_Compatible",null,null))},apiCC.checkIfAudioSourceIdExistOnDevice=function(u){n.log("checkIfAudioSourceIdExistOnDevice :",u);var f,I=!1,c=null;if(null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)"audio"!==(c=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).kind&&"audioinput"!==c.kind||(c.deviceId===u?(n.log("Audio device present :",u),I=!0):n.log("not this deviceId"));return I},apiCC.setAudioSourceIdInConstraint=function(u,f){return n.log("setAudioSourceIdInConstraint:",f),null==u?n.log("audioSourceId not defined"):!1===f.audio?n.log("constraints.audio === false, no audio device present"):!1===apiCC.checkIfAudioSourceIdExistOnDevice(u)?(n.log("audioSourceId not found on device"),f.audio={}):(!0!==f.audio&&void 0!==f.audio||(f.audio={}),n.log("audioSourceId is defined :",u),"iOS"===d.ag.name?"Mobile Safari"===d.Xh||(f.audio.deviceId=u):"Firefox"===d.Xh&&d.PR>=50?f.audio.deviceId=u:"Chrome"===d.Xh&&d.PR<48||"Safari"===d.Xh&&d.PR<11?f.audio.optional=[{sourceId:u}]:f.audio.deviceId=u?{ideal:u}:void 0),n.debug("constraints =",f),f},apiCC.checkIfVideoSourceIdExistOnDevice=function(u){n.log("checkIfVideoSourceIdExistOnDevice :",u);var f,I=!1,c=null;if(n.debug("apiCC.mediaDeviceMgr.mediaSourceInfos :",apiCC.mediaDeviceMgr.mediaSourceInfos),null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)"video"!==(c=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).kind&&"videoinput"!==c.kind||(c.deviceId===u?(n.log("Video device present :",u),I=!0):n.log("not this deviceId"));return I},apiCC.getMediaDeviceLabelFromDeviceid=function(u){n.log("getMediaDeviceLabelFromDeviceid :",u);var f,I="Not_Found",c=null;if(n.debug("apiCC.mediaDeviceMgr.mediaSourceInfos :",apiCC.mediaDeviceMgr.mediaSourceInfos),null!==apiCC.mediaDeviceMgr.mediaSourceInfos)for(f=0;f<apiCC.mediaDeviceMgr.mediaSourceInfos.length;++f)(c=apiCC.mediaDeviceMgr.mediaSourceInfos[f]).deviceId===u?(n.log("Video device present :",u),I=c.label):n.log("not this deviceId");return I},apiCC.setVideoSourceIdInConstraint=function(u,f){if(n.log("setVideoSourceIdInConstraint : ",f),null==u)n.log("videoSourceId not defined");else if(!1===f.video)n.log("constraints.video === false, no video device present");else if(!1===apiCC.checkIfVideoSourceIdExistOnDevice(u))n.log("videoSourceId not found on device"),f.video={};else if(n.log("videoSourceId is defined :",u),!0!==f.video&&void 0!==f.video||(f.video={}),"iOS"===d.ag.name)if("Mobile Safari"===d.Xh){if(u){var I=!1,c=d.ag.version.split(".");c.length>0&&parseInt(c[0])<13&&(I=!0),f.video.deviceId=I?{exact:u}:{ideal:u}}}else f.video.deviceId=u;else"Firefox"===d.Xh&&d.PR>=50?"Firefox"===d.Xh&&d.PR>=77?(n.debug("FX > 77 using exact to set deviceId"),f.video.deviceId={exact:u}):f.video.deviceId=u:"Chrome"===d.Xh&&d.PR<48||"Safari"===d.Xh&&d.PR<11?f.video.optional=[{sourceId:u}]:f.video.deviceId=u?{ideal:u}:void 0;return n.log("constraints =",f),f},apiCC.setVideoFacingModeInConstraint=function(u,f){n.log("setVideoFacingModeInConstraint");var I={};return!1===f.video?(n.log("facingMode value is not setted, constraints.video is false"),f):null==u?(n.log("facingMode value is not setted"),f):"user"!==u&&"environment"!==u&&"left"!==u&&"right"!==u?(n.log("facingMode value is not correct"),f):(null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices.getSupportedConstraints&&void 0!==navigator.mediaDevices.getSupportedConstraints&&(I=navigator.mediaDevices.getSupportedConstraints()),I.hasOwnProperty("facingMode")?(n.log("Setting FacingMode in constraint"),!0===f.video&&(f.video={}),f.video.facingMode={ideal:u}):n.log("FacingMode not supported by device"),n.debug("constraints =",f),f)},apiCC.setResolutionInConstraint=function(u,f,I){return n.log("setResolutionInConstraint"),u<=0||f<=0?(n.log("Resolution value must be positif non null"),I):(!0===I.video||void 0!==I.video?"iOS"===d.ag.name?"Mobile Safari"===d.Xh?(I.video.width=u?{exact:u}:void 0,I.video.height=f?{exact:f}:void 0):(I.video.width=u,I.video.height=f):"Firefox"===d.Xh&&d.PR>=50?(I.video.width=u,I.video.height=f):"Safari"===d.Xh&&d.PR>=11||"Mobile Safari"===d.Xh||"Edge"===d.Xh||"Chrome"===d.Xh&&d.PR>=49||"Firefox"===d.Xh&&d.PR>=50?(I.video.width=u?{exact:u}:void 0,I.video.height=f?{exact:f}:void 0):I.video.mandatory=[{width:u,height:f}]:n.error("setResolutionInConstraint : contraint.video must be true or defined"),n.debug("constraints =",I),I)},apiCC.checkConstraintDependingOnDevice=function(u){n.debug("checkConstraintDependingOnDevice :",u),"Mobile Safari"===d.Xh&&d.PR>=13&&void 0!==u.video&&void 0!==u.video.height&&void 0!==u.video.width&&1080===u.video.height.ideal&&1920===u.video.width.ideal&&(n.debug("Downgrading selected height and width resolution on iOS, to avoid stream issue"),u.video.height.ideal=720,u.video.width.ideal=1280)},apiCC.attachMediaStream=function(u,f){n.debug("attachMediaStream"),null!==u?(void 0!==u.srcObject?u.srcObject=f:void 0!==u.mozSrcObject?u.mozSrcObject=f:void 0!==u.src?"Chrome"===d.Xh&&d.PR<46?(n.log("Attaching media stream for Chrome < 46"),u.src=webkitURL.createObjectURL(f)):u.src=URL.createObjectURL(f):n.error("Error attaching stream to element."),"iOS"===d.ag.name&&(n.log("iOS detected"),u.setAttribute("playsinline",!0))):n.log("videoElt is null")},apiCC.addStreamInDiv=function(u,f,I,c,j,q,b){n.debug("addStreamInDiv");var T,Z=null,le=null,x=!1,Se=null;(0,C.Ym)(b,"object")&&null!=b.type&&(f=b.type),(0,C.Ym)(b,"object")&&void 0!==b.forceAudioAndVideoMediaElementSeparation&&(n.debug("forceAudioAndVideoMediaElementSeparation is set"),x=!0),"audio"===f?Z=document.createElement("audio"):("iOS"===d.BF&&"Mobile Safari"===d.Xh&&(n.debug("iOS && Mobile Safari"),x=!0),Z=document.createElement("video")),Z.id=c,Z.autoplay=!0,!0===x&&!1===q?(n.debug("before adding separated MediaEltAudio"),(Se=document.createElement("audio")).id=c+"_sepAudio",Se.muted=q,Se.autoplay=!0,Z.muted=!0):Z.muted=q,Z.style.width=j.width,Z.style.height=j.height,T=function(Ee){var he=null,ue=Ee.play();he=function(){var ke=Ee.play();n.log("funcFixIoS"),void 0!==ke&&ke.then(function(){n.log("Autoplay started"),apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.setStatus("Audio is now activated"),document.removeEventListener("touchstart",he)}).catch(function(Ne){n.error("Autoplay was prevented")})},void 0!==ue&&ue.then(function(){n.log("Autoplay started")}).catch(function(ke){"iOS"===d.ag.name?(n.warn("iOS : Autoplay was prevented, activating touch event to start media play"),apiCC.myWebRTC_Event.createErrorEvent("ERROR: iOS : Autoplay was prevented","IOS_AUTOPLAY_PREVENTED"),document.addEventListener("touchstart",he),apiCC.session&&apiCC.session.apiCCWebRTCClient&&apiCC.session.apiCCWebRTCClient.webRTCClient.setStatus("WARNING : Audio autoplay was prevented by iOS, touch screen to activate audio")):n.warn("Autoplay was prevented")})},"Chrome"===d.Xh&&"61"===d.PR&&"Android"===d.BF&&(Z.style.borderRadius="1px",n.log("Patch for video display on Chrome 61 Android")),apiCC.session&&apiCC.session.apiCCWebRTCClient&&void 0!==apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId&&null!==apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId?(n.log("audioOutputId set to: "+apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId),Z.setSinkId(apiCC.session.apiCCWebRTCClient.webRTCClient.audioOutputId).then(function(){n.log("Success, audio output device attached")})):n.log("No audioOutputId set"),"iOS"!==d.BF&&(le=document.getElementById(I)).appendChild(Z),void 0!==u&&(apiCC.attachMediaStream(Z,u),!0===x&&!1===q&&apiCC.attachMediaStream(Se,u)),"iOS"===d.BF&&(le=document.getElementById(I)).appendChild(Z),!0===x&&!1===q&&null!==le&&le.appendChild(Se),T(Z),!0===x&&!1===q&&T(Se)},apiCC.removeElementFromDiv=function(u,f){n.debug("removeElementFromDiv");var I,c,j=null;I=document.getElementById(f),j=document.getElementById(u),null!==I&&(n.log("Removing video element with Id : "+f),null!==j&&j.removeChild(I)),null!==(c=document.getElementById(f+"_sepAudio"))&&(n.log("iOS : Removing audio element with Id : "+f+"_sepAudio"),null!==j&&j.removeChild(c))},apiCC.randomString=function(u,f){for(var I="string"==typeof f&&f.length>0?f:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c="";--u>=0;)c+=I.charAt(Math.floor(Math.random()*I.length));return c},apiCC.generateCallId=function(){var u;return u=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),n.debug("new callId :"+u),u},apiCC.generateInstanceId=function(){var u;return u=void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString():Math.floor(1000001*Math.random()).toString(),n.debug("new instanceId :"+u),u},apiCC.myApiCCWhiteBoardClient=null,apiCC.createWhiteBoard=function(u,f,I,c){return n.debug("createWhiteBoard"),apiCC.myApiCCWhiteBoardClient=new apiCC.ApiCCWhiteBoardClient(apiCC.session,u,f,I,c),apiCC.myApiCCWhiteBoardClient},apiCC.closeWhiteBoardClient=function(u){n.info("closeWhiteBoardClient"),R.createClosingWhiteBoardEvent(apiCC.myApiCCWhiteBoardClient.roomId,u),apiCC.myApiCCWhiteBoardClient.isInRoom()&&apiCC.myApiCCWhiteBoardClient.leaveRoom(),apiCC.myApiCCWhiteBoardClient.stop()},apiCC.registerIOsDevice=function(u){n.debug("call registerIOsDevice 1");var f={type:"registerIOsDevice",senderId:apiCC.session.apiCCId,token:u},I=JSON.stringify(f);n.debug("call registerIOsDevice "+I),apiCC.session.channel.socket.emit("registerIOsDevice",I),n.debug("call registerIOsDevice  done")},apiCC.registerAndroidDevice=function(u){n.debug("registerAndroidDevice");var f={type:"registerAndroidDevice",senderId:apiCC.session.apiCCId,token:u},I=JSON.stringify(f);apiCC.session.channel.socket.emit("registerAndroidDevice",I)},apiCC.unRegisterIOsDevice=function(u){n.debug("unRegisterIOsDevice");var f={type:"unRegisterIOsDevice",senderId:apiCC.session.apiCCId,token:u},I=JSON.stringify(f);apiCC.session.channel.socket.emit("unRegisterIOsDevice",I)},apiCC.unRegisterAndroidDevice=function(u){n.debug("unRegisterAndroidDevice");var f={type:"unRegisterAndroidDevice",senderId:apiCC.session.apiCCId,token:u},I=JSON.stringify(f);apiCC.session.channel.socket.emit("unRegisterAndroidDevice",I)},apiCC.storeSessionInfoInSessionStorage=function(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.info("storeSessionInfoInSessionStorage",u),apiCC.session){var f=5e3;(0,C.ki)(apiCC.session,"apiCCIdPersistenceTimeout","number")&&apiCC.session.apiCCIdPersistenceTimeout>=0&&(f=apiCC.session.apiCCIdPersistenceTimeout),(0,C.Ym)(u.apiCCIdPersistenceTimeout,"number")&&u.apiCCIdPersistenceTimeout>=0&&(f=u.apiCCIdPersistenceTimeout),apiCC.setSessionStorage("apiCCId",apiCC.session.apiCCId,f),apiCC.setSessionStorage("apiKey",apiCC.session.apiKey,f),null!==apiCC.session.sessionId&&apiCC.setSessionStorage("sessionId",apiCC.session.sessionId,f)}},apiCC.disconnect=function(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.info("disconnect",u),null!==apiCC&&apiCC.cleanAllEventListener(),null!==apiCC.session&&void 0!==apiCC.session&&("undefined"==typeof apiRTC_React&&!0!==u.invalidateApiCCId&&apiCC.storeSessionInfoInSessionStorage(u),null!==apiCC.myApiCCWhiteBoardClient&&(n.log("apiCC.myApiCCWhiteBoardClient.roomId :"+apiCC.myApiCCWhiteBoardClient.roomId),null!==apiCC.myApiCCWhiteBoardClient.roomId&&apiCC.closeWhiteBoardClient("USER_DISCONNECTION")),n.log("Disconnecting from Server"),void 0!==apiCC.session.channel.socket&&null!==apiCC.session.channel.socket&&apiCC.session.channel.socket.disconnect(),apiCC.session.channel.channelHasBeenDisconnected=!1,apiCC.session.connectedUsersList.splice(0,apiCC.session.connectedUsersList.length)),apiCC&&(apiCC.session=null,apiCC.jsLoaded=!1)},apiCC.reconnect=function(){n.log("Reconnect"),n.log("apiCC.session.channel.socket:",apiCC.session.channel.socket),apiCC.session.channel.socket.socket.connect()},apiCC.cleanApiRTCContext=function(){null!==apiCC.session&&void 0!==apiCC.session&&(null!==apiCC.session.apiCCWebRTCClient&&void 0!==apiCC.session.apiCCWebRTCClient&&(0!==apiCC.session.apiCCWebRTCClient.webRTCClient.callsTable.length&&n.warn("Call is still established and will be disconnected"),apiCC.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCUs.length>0&&n.log("MCU session is still established and will be disconnected"),apiCC.session.apiCCWebRTCClient.hangUp(),null!==apiCC.session.apiCCWebRTCClient.webRTCClient.localStream&&(apiCC.session.apiCCWebRTCClient.webRTCClient.stopStream(apiCC.session.apiCCWebRTCClient.webRTCClient.localStream),R.createUserMediaStopEvent(null,"media")),apiCC.session.apiCCWebRTCClient=null),null!==apiCC.session.apiCCIMClient&&void 0!==apiCC.session.apiCCIMClient&&(apiCC.session.apiCCIMClient=null),null!==apiCC.session.apiCCDataClient&&void 0!==apiCC.session.apiCCDataClient&&(apiCC.session.apiCCDataClient=null),null!==apiCC.myApiCCWhiteBoardClient&&void 0!==apiCC.myApiCCWhiteBoardClient&&(apiCC.myApiCCWhiteBoardClient=null),null!==apiCC.session.apiCCCoBrowsingClient&&void 0!==apiCC.session.apiCCCoBrowsingClient&&(apiCC.session.apiCCCoBrowsingClient=null))},apiCC.cleanAllEventListener=function(){var u,f=0;if(null!==apiCC&&null!==apiCC.myEventTable&&(f=apiCC.myEventTable.length),0!==f){for(n.trace("number of myEventTable:"+f),u=0;u<f;u+=1)apiCC.removeEventListener(apiCC.myEventTable[u].type,apiCC.myEventTable[u].listener);apiCC.myEventTable.splice(0,f),f=apiCC.myEventTable.length,n.trace("number of myEventTable after splice:"+f)}},apiCC.testUserPing=function(u){n.debug("testUserPing()");var f,I,c,j,q=apiCC.bandwidthTestServer+"/upload-test",b=new XMLHttpRequest,T=new FormData,Z=Math.round(5*Math.random()),le=!1;"withCredentials"in b?b.open("POST",q,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest).open("POST",q):b=null,f=new Blob([Z],{type:"text/xml"}),T.append("file",f),b?(b.onload=function(){200===b.status&&(j=Date.now()-I,le||(clearTimeout(c),u(null,j)))},b.onerror=function(x){n.log("testUserUpload onerror status :",x.target.status),u({err:"An error occured during XMLHttpRequest",msg:x.target.status},null)},c=setTimeout(function(){le=!0,u("Ping timeout",-1)},5e3),b.send(T),I=Date.now()):u({err:"XMLHttpRequest is not defined",msg:"XMLHttpRequest is not defined"},null)},apiCC.testUserDownload=function(u,f){n.debug("testUserDownload()");var I,c,q,b,T,Z=apiCC.bandwidthTestServer+"/files/noise_"+u+"ko.jpg",le=0,x=new Image,Se=0;Z+="?nnn="+Date.now();var Ee=[[256,257529],[500,525944],[768,787234],[1e3,1055741],[1500,1541044],[2e3,1992034],[2500,2596028],[3e3,2904977],[3500,3648299],[4e3,4151187],[4500,4741712],[5e3,5264577],[5500,5776081],[6e3,6318553],[6500,6779868],[7e3,7334256],[7500,7874040],[8e3,8081460],[8500,8651795],[9e3,9081899],[9500,9503574],[1e4,10082008],[10500,10543425],[11e3,11200424],[11500,11200424],[12e3,12110671],[12500,12715962],[13e3,13222120],[13500,13605073],[14e3,13954769],[14500,14777594],[15e3,15178928],[15500,15602106],[16e3,16054618],[16500,16578623],[17e3,17048069],[17500,17456403],[18e3,17910332],[18500,18725846],[19e3,19284746],[19500,19771902],[2e4,20121527],[21e3,20975042],[22e3,22189200],[23e3,23027928],[24e3,24027870],[25e3,24878845],[26e3,26237503],[27e3,27112004],[28e3,27953446],[29e3,29313013],[3e4,30474095]];for(b=0;b<Ee.length;b++)u===Ee[b][0]&&(le=Ee[b][1]);apiCC.testUserPing(function(he,ue){x.onload=function(){for((c=Date.now()-I)-ue>10&&(c-=ue),q=Math.round(le/(c/1e3)/1e3),T={type:"download",kBPerSec:q},b=0;b<apiCC.bandwidthRatingThresholds.length;b++)8*T.kBPerSec>=apiCC.bandwidthRatingThresholds[b]&&Se++;T.rating=Se+"/"+apiCC.bandwidthRatingThresholds.length,f(null,T)},x.onerror=function(ke,Ne){f({label:"Error when downloading",err:ke,msg:Ne},null)},I=(new Date).getTime(),x.src=Z})},apiCC.testUserUpload=function(u,f){n.debug("testUserUpload()");var I,c,j,q,b,Z,le=apiCC.bandwidthTestServer+"/upload-test",x=new XMLHttpRequest,Se=new FormData,Ee="",he=0;for(("withCredentials"in x?x.open("POST",le,!0):"undefined"!=typeof XDomainRequest?(x=new XDomainRequest).open("POST",le):x=null,c=0);c<u;c++)Ee+=Math.round(5*Math.random());I=new Blob([Ee],{type:"text/xml"}),Se.append("file",I),x?(x.onload=function(){if(200===x.status){for(b=Date.now()-q,Z=Math.round(u/(b/1e3)/1e3),j={type:"upload",kBPerSec:Z},c=0;c<apiCC.bandwidthRatingThresholds.length;c++)8*j.kBPerSec>=apiCC.bandwidthRatingThresholds[c]&&he++;j.rating=he+"/"+apiCC.bandwidthRatingThresholds.length,f(null,j)}else f({err:"An error occured during XMLHttpRequest",msg:x.status},null)},x.onerror=function(ue){n.log("testUserUpload onerror status :",ue.target.status),f({err:"An error occured during XMLHttpRequest",msg:ue.target.status},null)},x.send(Se),q=Date.now()):f({err:"XMLHttpRequest is not defined",msg:"XMLHttpRequest is not defined"},null)},apiCC.testUserUploadLoop=function(u,f,I){var c={type:"upload",kBPerSec:f.kbps/8,kbps:f.kbps,rating:f.rating},j=0;f.kbps>1e3?apiCC.testUserUpload(u,function(q,b){null!==q?I({err:"An error occured during XMLHttpRequest"},null):(c.kBPerSec=b.kBPerSec,c.kbps=8*b.kBPerSec,c.rating=b.rating,j=c.kbps-f.kbps,n.debug("upload "+u+" "+JSON.stringify(c)+"; diff "+j),j>=2e4&&u<12e6?apiCC.testUserUploadLoop(u+8e6,c,I):j>=1e4&&u<14e6?apiCC.testUserUploadLoop(u+6e6,c,I):j>=5e3&&u<16e6?apiCC.testUserUploadLoop(u+4e6,c,I):j>=1e3&&u<18e6?apiCC.testUserUploadLoop(u+2e6,c,I):j>=200&&u<19e6?apiCC.testUserUploadLoop(u+1e6,c,I):I(null,c))}):I(null,c)},apiCC.testUserDownloadLoop=function(u,f,I){var c={type:"download",kBPerSec:f.kbps/8,kbps:f.kbps,rating:f.rating},j=0;f.kbps>=3500?apiCC.testUserDownload(u,function(q,b){null!==q?I({err:"Error when downloading"},null):(c.kBPerSec=b.kBPerSec,c.kbps=8*b.kBPerSec,c.rating=b.rating,j=c.kbps-f.kbps,n.debug("download "+u+" "+JSON.stringify(c)+"; diff "+j),j>=2e4?apiCC.testUserDownloadLoop(3e4,c,I):j>=1e4&&u<=2e4?apiCC.testUserDownloadLoop(u+1e4,c,I):j>=5e3&&u<=25e3?apiCC.testUserDownloadLoop(u+5e3,c,I):j>=1e3&&u<=27e3?apiCC.testUserDownloadLoop(u+3e3,c,I):j>=200&&u<=29e3?apiCC.testUserDownloadLoop(u+1e3,c,I):I(null,c))}):I(null,c)},apiCC.listenedAudioSources={};var m=window.AudioContext||window.webkitAudioContext||!1;apiCC.audioContext=null,apiCC.getAudioContext=function(){return"iOS"===apiRTC.osName&&"undefined"!=typeof cordova?n.debug("No audioContext for iOS cordova"):m&&null===apiCC.audioContext&&(apiCC.audioContext=new m),apiCC.audioContext},apiCC.listenToAudioSources=function(u){n.debug("listenToAudioSources()");var f,I=apiCC.getAudioContext();null!=I?(Object.keys(apiCC.listenedAudioSources).length>0&&apiCC.stopAudioSourceListening(),apiCC.getMediaDevices().then(function(c){for(n.log(c),f=0;f<c.length;f++)"audioinput"===c[f].kind&&(apiCC.listenedAudioSources[c[f].deviceId]={deviceId:c[f].deviceId,callback:u,label:c[f].label},navigator.getUserMedia({audio:{optional:[{sourceId:c[f].deviceId}]},video:!1},function(j){n.log("new stream processing function for : "+this.device.deviceId),this.device.audioListener=this;var q=this,b=I.createScriptProcessor(2048,1,1),T=I.createMediaStreamSource(j);b.connect(I.destination),b.onaudioprocess=function(){var le,Se=new Uint8Array(this.analyser.frequencyBinCount),Ee=0;for(this.analyser.getByteFrequencyData(Se),le=0;le<Se.length;le++)Ee+=Se[le];q.device.callback({deviceId:q.device.deviceId,label:q.device.label,amplitude:Ee/Se.length,active:j.active})},b.analyser=I.createAnalyser(),b.analyser.smoothingTimeConstant=.3,b.analyser.fftSize=1024,T.connect(b.analyser),b.analyser.connect(b),this.destroy=function(){n.log("destroy()");var Z,le=j.getTracks();for(Z=0;Z<le.length;Z+=1)le[Z].stop();T.disconnect(),b.analyser.disconnect(),b.disconnect()}}.bind({device:apiCC.listenedAudioSources[c[f].deviceId]}),function(j){n.error("Error getting microphone",j)}))},function(c){n.debug("listenToAudioSources() - getMediaDevices error :",c)})):n.debug("listenToAudioSources() - Unable to create audio context")},apiCC.stopAudioSourceListening=function(){var u;for(n.debug("stopAudioSourceListening()"),u=0;u<Object.keys(apiCC.listenedAudioSources).length;u++)void 0!==apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[u]]?void 0!==apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[u]].audioListener?apiCC.listenedAudioSources[Object.keys(apiCC.listenedAudioSources)[u]].audioListener.destroy():n.warn("error on stopAudioSourceListening, audioListener"):n.warn("error on stopAudioSourceListening, listenedAudioSources element");apiCC.listenedAudioSources={}},apiCC.webRTCPluginInstalled=!1,apiCC.iePluginInstallationPreventUnload=!1,apiCC.setlogStorageActivated=function(u,f){n.debug("setlogStorageActivated :",u),this.logStorageActivated=(!0===u||!1===u)&&u,void 0!==f&&(this.logStorageLevel=f)},apiCC.sendLogToCloud=function(u,f,I,c){n.info("sendLogToCloud");var j,q,b=[],Z=[],le=null,x=null;for(b.push(JSON.stringify({title:"ApiRTC logs",description:"Logs of apiRTC client"})),b.push(JSON.stringify({ts:Date.now(),name:"system-info",args:{browserName:apiCC.browser,browserVersion:apiCC.browser_version,platform:apiCC.osName}})),j=0;j<u.length;j++)b.push(JSON.stringify("error"===u[j][0]?{name:"test-run",args:{error:u[j][1]}}:{name:"test-run",args:{info:u[j][1]}}));Z=b.concat(apiCC.logStorage),le=new FormData,q="["+Z.join(",\n")+"]",n.debug("fileContent :",q),!0!==c&&(le.append("data",q),le.append("apiKey",apiCC.initApiKey),void 0!==f&&le.append("id",f),(x=new XMLHttpRequest).open("POST",I+"/test/api/",!0),x.onreadystatechange=function(){4===x.readyState&&200===x.status&&console.info("[apiRTC_Logs] POST'd successfully"),console.trace(x.responseText)},x.send(le))},apiCC.manageWebRTCPlugin=function(u,f){var I;n.debug("manageWebRTCPlugin"),I="https:"!==window.location.protocol?"http":"https",loadjs([I+"://cdn.temasys.io/adapterjs/0.15.x/adapter.debug.js"],"temAdapter",{async:!0,numRetries:apiCC.extJsLoadingRetryNb||100,reqdelay:apiCC.extJsLoadingRetryDelay||200,success:function(){n.log("End of .js loading for plugin"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","loaded"),AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,AdapterJS.WebRTCPlugin.pluginInfo.type,function(){apiCC.myWebRTC_Adapter.RTCSessionDescription=RTCSessionDescription,apiCC.myWebRTC_Adapter.RTCIceCandidate=RTCIceCandidate,apiCC.myWebRTC_Adapter.RTCPeerConnection=RTCPeerConnection,apiCC.myWebRTC_Adapter.getUserMedia=navigator.getUserMedia,apiCC.attachMediaStream=attachMediaStream,AdapterJS.webRTCReady(function(c){return n.log("webRTCReady, plugin already installed"),u()})},function(){return apiCC.iePluginInstallationPreventUnload=!0,f(),AdapterJS.webRTCReady(function(c){return n.log("webRTCReady after plugin install"),apiCC.iePluginInstallationPreventUnload=!1,apiCC.myWebRTC_Adapter.RTCSessionDescription=RTCSessionDescription,apiCC.myWebRTC_Adapter.RTCIceCandidate=RTCIceCandidate,apiCC.myWebRTC_Adapter.RTCPeerConnection=RTCPeerConnection,apiCC.myWebRTC_Adapter.getUserMedia=navigator.getUserMedia,apiCC.attachMediaStream=attachMediaStream,u()}),apiCC.session.apiCCWebRTCClient.myWebRTC_Event.createEvent({eventType:"webRTCPluginInstallation"}),null})},error:function(c){n.error("temAdapter loading error"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","error")},retrycb:function(c,j){n.warn("temAdapter loading retry :"+c+" ,delay before retry :"+j),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("temAdapter","retry")}})},apiCC.checkMutingStateForUserMedia=function(u,f){n.debug("checkMutingStateForUserMedia"),(0,C.ki)(u,"muted","string")&&(n.log("callConfiguration muted is set :",u.muted),"VIDEO"===u.muted&&(f.muteVideoOnStreams("enabled"),f.muteAudioOnStreams("enabled")),"AUDIOONLY"===u.muted&&f.muteAudioOnStreams("enabled"),"VIDEOONLY"===u.muted&&f.muteVideoOnStreams("enabled"))},apiCC.isSIPNumber=function(u){var f,I=null,c=!1;return f=u.toString().startsWith("sip:"),u.toString().length<=20&&(I=!0),(0!==u.toString().indexOf("0")&&0!==u.toString().indexOf("+")||!0!==I)&&!0!==f||(c=!0),c},apiCC.loadSentry=function(u,f){n.debug("Remote logging activation"),loadjs([f+"://browser.sentry-cdn.com/5.24.2/bundle.tracing.min.js"],"Sentry",{async:!0,numRetries:10,reqdelay:500,success:function(){Sentry.init({dsn:"https://c24c226714f841dbbc3d1518b6cc7fe8@o333237.ingest.sentry.io/5448622",release:apiCC.version,tracesSampleRate:1}),Sentry.configureScope(function(I){I.setTag("apiKey",u)})},error:function(I){console.error("Remote logging - loading error")},retrycb:function(I,c){console.warn("Remote logging - loading retry :"+I+" ,delay before retry :"+c)}})},apiCC.sendSentryEvent=function(u){if(n.debug("sendSentryEvent",u),"undefined"!=typeof Sentry){var f="",I={};"muteUnmuteEvent"===u.eventType?(f="Mute event on callId:"+u.callId,I.muteType=u.muteType,I.source=u.source,I.mLine=u.mLine,I.state=u.state,I.callId=u.callId,I.username=u.username):n.error("sendSentryEvent error : type ",u.eventType," is not supported");var c=Object.keys(I);""!==f&&c.length>0&&Sentry.withScope(function(j){c.forEach(function(q){j.setTag(q,I[q])}),Sentry.captureMessage(f)})}else n.debug("Sentry not activated")}},5945:(V,J,e)=>{"use strict";e.d(J,{ag:()=>M,E2:()=>d,cf:()=>R,Xh:()=>h,dc:()=>P,PR:()=>w,vO:()=>n,BF:()=>C,MM:()=>S,$6:()=>y}),e(8309),e(2772),e(9064);var i,d=null,h=null,P=null,w=null,M=null,C=null,S=null,n=null,y=null,R=null;i=(d=new UAParser).getBrowser(),M=d.getOS(),R=d.getBrowser(),"undefined"!=typeof apiRTC_React?(P=DeviceInfo.getSystemVersion(),C=DeviceInfo.getSystemName(),h=DeviceInfo.getUserAgent(),n=DeviceInfo.getModel()):(P=i.version,C=d.getOS().name,S=d.getOS().version,h=i.name,n=d.getDevice().type),w=void 0!==P?i.major:99,window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf(" electron/")>=0&&(y="electron")},4708:(V,J,e)=>{"use strict";function i(c){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(j){return typeof j}:function(j){return j&&"function"==typeof Symbol&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j})(c)}e.d(J,{_C:()=>h,Pj:()=>P,yJ:()=>w,dD:()=>M,Wc:()=>C,S6:()=>S,ws:()=>n,wL:()=>y,cw:()=>m,Ym:()=>u,ki:()=>f,fS:()=>I}),e(4603),e(4916),e(9714),e(3123),e(9600),e(1249),e(7941),e(4723),e(1058),e(6992),e(9575),e(1539),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(9753),e(7042),e(2526),e(1817),e(2165),e(8783),e(3948);var d=e(1549).Y.get("Utils");function h(c){return new RegExp("^[0-9-.]*$","g").test(c)}function P(){return"undefined"!=typeof apiRTC_React||"https:"===window.location.protocol}function w(){return"undefined"==typeof apiRTC_React&&"http:"===window.location.protocol}function M(c){var j,q,b,T,Z={};for(b=0,T=(j=c.split("&")).length;b<T;b++)Z[(q=j[b].split("="))[0]]=q[1];return Z}function C(c){return Object.keys(c).map(function(j){return j+"="+c[j]}).join("&")}function S(c,j){d.debug("mergeJSON");var q={},b=null;if(c)for(b in c)c.hasOwnProperty(b)&&(q[b]=c[b]);if(j)for(b in j)j.hasOwnProperty(b)&&(q[b]=j[b]);return d.log(q),q}var n=function(c,j){var q,b,T;for(null==c&&(c={}),q=1;q<arguments.length;q+=1)for(b in T=arguments[q])T.hasOwnProperty(b)&&(c[b]=T[b]);return c},y=function(){var c=function(q,b,T){var Z=q.match(b);return Z&&Z.length>=T&&parseInt(Z[T],10)},j={};if("undefined"!=typeof apiRTC_React)return j.type="react-native",j;if(void 0!==window&&void 0!==window.navigator)if(window.navigator.mozGetUserMedia)j.type="firefox",j.version=c(window.navigator.userAgent,/Firefox\/(\d+)\./,1);else if(window.navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)j.type="chrome",j.version=c(window.navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!window.navigator.userAgent.match(/Version\/(\d+).(\d+)/))return j;j.type="safari",j.version=c(window.navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(window.navigator.mediaDevices&&window.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))j.type="edge",j.version=c(window.navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.navigator.mediaDevices||!window.navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return j;j.type="safari",j.version=c(window.navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return j}(),R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-/=",m={decode:function(c){var j,q=R.indexOf(c.charAt(c.length-1)),b=R.indexOf(c.charAt(c.length-2)),T=c.length/4*3,Z=null,le=null,x=null,Se=null,Ee=null,he=null,ue=0,ke=null;for(64===q&&T--,64===b&&T--,ke=new Uint8Array(T),j=0;j<T;j+=3)Z=R.indexOf(c.charAt(ue++))<<2|(Se=R.indexOf(c.charAt(ue++)))>>4,le=(15&Se)<<4|(Ee=R.indexOf(c.charAt(ue++)))>>2,x=(3&Ee)<<6|(he=R.indexOf(c.charAt(ue++))),ke[j]=Z,64!==Ee&&(ke[j+1]=le),64!==he&&(ke[j+2]=x);return ke},encode:function(c){var j,q="",b=new Uint8Array(c),T=b.byteLength,Z=T%3,le=T-Z,x=null;for(j=0;j<le;j+=3)q+=R[(16515072&(x=b[j]<<16|b[j+1]<<8|b[j+2]))>>18]+R[(258048&x)>>12]+R[(4032&x)>>6]+R[63&x];return 1===Z?q+=R[(252&(x=b[le]))>>2]+R[(3&x)<<4]+"==":2===Z&&(q+=R[(64512&(x=b[le]<<8|b[le+1]))>>10]+R[(1008&x)>>4]+R[(15&x)<<2]+"="),q}};function u(c,j){return 3===arguments.length?f(arguments[0],arguments[1],arguments[2]):"null"===j?null===c:"array"===j?null!==c&&"object"===i(c)&&Array.isArray(c):null!==c&&i(c)===j}function f(c,j,q){if(null!==j&&"object"===i(j)&&Array.isArray(j)&&j.length>=1){var b=j[0];if(j.length>1)return u(c,"object")&&u(b,"string")&&c.hasOwnProperty(b)&&u(c[b],"object")&&f(c[b],j.slice(1),q);j=b}return"undefined"===q?u(c,"object")&&u(j,"string")&&!c.hasOwnProperty(j)&&u(c[j],q):u(c,"object")&&u(j,"string")&&c.hasOwnProperty(j)&&u(c[j],q)}function I(c,j){if(c===j)return!0;if(!(c instanceof Object&&j instanceof Object)||c.constructor!==j.constructor)return!1;for(var q in c)if(c.hasOwnProperty(q)){if(!j.hasOwnProperty(q))return!1;if(c[q]===j[q])continue;if("object"!==i(c[q])||!I(c[q],j[q]))return!1}for(q in j)if(j.hasOwnProperty(q)&&!c.hasOwnProperty(q))return!1;return!0}},6075:(V,J,e)=>{"use strict";e.d(J,{F:()=>d});var i=e(1549).Y.get("WebRTC_Stack"),d=function(){this.adaptForIoSCordova=function(){if("iOS"===apiRTC.osName&&"undefined"!=typeof cordova){if(i.log("Modification for iOS cordova"),void 0===cordova.plugins)return void i.log("cordova.plugins not defined");if(void 0===cordova.plugins.iosrtc)return void i.log("cordova.plugins.iosrtc not defined");this.RTCPeerConnection=cordova.plugins.iosrtc.RTCPeerConnection,this.RTCSessionDescription=cordova.plugins.iosrtc.RTCSessionDescription,this.RTCIceCandidate=cordova.plugins.iosrtc.RTCIceCandidate}},"undefined"!=typeof RTCSessionDescription?this.RTCSessionDescription=RTCSessionDescription:i.log("RTCSessionDescription is undefined"),"undefined"!=typeof RTCIceCandidate?this.RTCIceCandidate=RTCIceCandidate:i.log("RTCIceCandidate is undefined"),"undefined"!=typeof RTCPeerConnection?this.RTCPeerConnection=RTCPeerConnection:i.log("RTCPeerConnection is undefined"),void 0!==navigator.getUserMedia?this.getUserMedia=navigator.getUserMedia:"undefined"!=typeof getUserMedia?this.getUserMedia=getUserMedia:i.log("getUserMedia is undefined")}},8765:(V,J,e)=>{"use strict";e.d(J,{K:()=>M}),e(6755),e(2772),e(3710),e(8309),e(9601),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(1549),d=e(5945),h=e(4708);function P(C){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(S){return typeof S}:function(S){return S&&"function"==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(C)}var w=i.Y.get("WebRTC_Event"),M=function(){if(w.debug("WebRTC_Event"),this.customEventIsDefined="notTested","notTested"===this.customEventIsDefined)try{new CustomEvent("test",{detail:"test",bubbles:!0,cancelable:!0}),this.customEventIsDefined=!0}catch(C){this.customEventIsDefined=!1,w.log("customEvent error :"+C)}("IE"===d.Xh&&d.dc>8||"Netscape"===d.Xh)&&(w.log("polyfill the CustomEvent()"),function(){function C(S,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var y=document.createEvent("CustomEvent");return y.initCustomEvent(S,n.bubbles,n.cancelable,n.detail),y}C.prototype=window.CustomEvent.prototype,window.CustomEvent=C}(),this.customEventIsDefined=!0),"IE"===d.Xh&&d.dc>8&&(w.log("polyfill startsWith()"),String.prototype.startsWith||(String.prototype.startsWith=function(C,S){return this.indexOf(C,S=S||0)===S})),this.eventDispatchMgr=function(C,S){if("undefined"!=typeof apiRTC_React)eventManager.dispatchEvent({type:C,detail:S});else if(!1===this.customEventIsDefined)"undefined"!=typeof $jqApz?(w.log("CustomEvent not supported by Browser, using $jqApz "),$jqApz.event.trigger({type:C,detail:S})):"undefined"!=typeof jQuery?(w.log("CustomEvent not supported by Browser, using jQuery "),jQuery.event.trigger({type:C,detail:S})):w.warn("Custom Events not supported on this browser : eventDispatchMgr()");else{var y=new CustomEvent(C,{detail:S,bubbles:!0,cancelable:!0});document.dispatchEvent(y)}},this.createIncomingCallEvent=function(C,S,n,y,R,m,u,f,I,c,j){var q={eventType:"incomingCall",time:new Date,clientId:C,callerId:S,callId:y,autoAnswerActivated:R,callNumber:m,callerNickname:n,audioOnly:u,callType:f,destCallType:j,recordedCall:I,remoteType:c};this.eventDispatchMgr("incomingCall",q)},this.createCallAttemptEvent=function(C,S,n,y){var R={eventType:"callAttempt",time:new Date,clientId:C,callerId:S,callId:y,callerNickname:n};this.eventDispatchMgr("callAttempt",R)},this.createCallEstablishedEvent=function(C,S,n,y){w.debug("createCallEstablishedEvent with callType : "+S),w.debug("destCallType : "+y);var R={eventType:"callEstablished",time:new Date,calleeId:C,callType:S,callId:n,destCallType:y};this.eventDispatchMgr("callEstablished",R)},this.createHangupEvent=function(C,S,n,y,R,m,u){var f={eventType:"hangup",time:new Date,hangupType:C,clientId:S,remoteId:n,lastEstablishedCall:y,reason:R,callId:m,callType:u};this.eventDispatchMgr("hangup",f)},this.createRemoteHangupEvent=function(C,S,n,y){var R={eventType:"remoteHangup",time:new Date,clientId:C,remoteId:S,lastEstablishedCall:n,reason:y};this.eventDispatchMgr("remoteHangup",R)},this.createCallRestartingEvent=function(C,S,n,y,R,m,u,f,I){var c={eventType:"callRestarting",time:new Date,callType:C,audioOnly:S,oldCallId:n,newCallId:y,dataType:R,clientId:m,remoteId:u,destRoom:f,streamId:I};this.eventDispatchMgr("callRestarting",c)},this.createUserMediaSuccessEvent=function(C,S,n,y,R,m,u,f,I,c,j){var q={eventType:"userMediaSuccess",time:new Date,onCallEstablishment:C,audioIsAvailable:S,audioDeviceLabel:n,videoIsAvailable:y,videoDeviceLabel:R,callType:m,callId:u,stream:f,remoteId:I,restarted:c,userMediaStreamId:j};this.eventDispatchMgr("userMediaSuccess",q)},this.createUserMediaErrorEvent=function(C,S,n,y,R,m,u){var f={eventType:"userMediaError",time:new Date,onCallEstablishment:C,callType:S,userMediaStreamId:y,callId:R,tryAudioCallActivated:m,gumConfig:u};"object"===P(n)?(f.error={},f.error.message=n.message,f.error.code=n.code,f.error.name=n.name):f.error=n,this.eventDispatchMgr("userMediaError",f)},this.createUserMediaStopEvent=function(C,S,n){var y={eventType:"userMediaStop",time:new Date,callId:C,mediaType:S,userMediaStreamId:n};this.eventDispatchMgr("userMediaStop",y)},this.createICECandidateTypeUpdateEvent=function(C,S,n){var y={eventType:"ICECandidateTypeUpdate",time:new Date,callId:C,localCandidate:S,remoteCandidate:n};this.eventDispatchMgr("ICECandidateTypeUpdate",y)},this.createSelectedICECandidateEvent=function(C,S,n,y,R,m,u){var f={eventType:"selectedICECandidate",time:new Date,callId:C,localCandidateType:S,remoteCandidateType:n,localAddress:y,remoteAdress:R,transportType:m,localTransportType:u};this.eventDispatchMgr("selectedICECandidate",f)},this.createErrorEvent=function(C,S,n,y,R,m,u){var f={eventType:"error",time:new Date,errorInfo:C,errorCode:S,callId:n,roomName:y,roomCallType:R};(0,h.Ym)(m,"object")&&(f.data=m),(0,h.Ym)(u,"string")&&(f.convId=u),this.eventDispatchMgr("error",f)},this.createReceiveIMMessageEvent=function(C,S,n,y,R,m){var u={eventType:"receiveIMMessage",time:new Date,senderId:C,senderNickname:S,senderPhotoURL:n,message:y,UUCSeq:R,convId:m};this.eventDispatchMgr("receiveIMMessage",u)},this.createChannelEvent=function(C,S){var n={eventType:"channelEvent",time:new Date,channelEvent:C,event:S};this.eventDispatchMgr("channelEvent",n)},this.createSessionReadyEvent=function(C){w.debug("createSessionReadyEvent");var S={eventType:"sessionReady",time:new Date,apiCCId:C};this.eventDispatchMgr("sessionReady",S)},this.createWebRTCClientCreatedEvent=function(){var C={eventType:"webRTCClientCreated",time:new Date};this.eventDispatchMgr("webRTCClientCreated",C)},this.createUpdatePresenceEvent=function(C,S,n){var y={eventType:"updatePresence",time:new Date,connectedUsersList:C,connectedUsersListWithStatus:n,state:S};this.eventDispatchMgr("updatePresence",y)},this.createCloudEventOccurredEvent=function(C,S){var n={eventType:"cloudEventOccurred",time:new Date,topic:C,target:S};this.eventDispatchMgr("cloudEventOccurred",n)},this.createUpdateUserStatusEvent=function(C){var S={eventType:"updateUserStatus",time:new Date,message:C};this.eventDispatchMgr("updateUserStatus",S)},this.createGroupChatCreationEvent=function(C,S,n,y,R,m){var u={eventType:"groupChatCreation",time:new Date,status:C,groupChatId:S,initialDestId:n,invitationSendedToInitialDestId:y,newContactId:R,invitationSendedToNewContactId:m};this.eventDispatchMgr("groupChatCreation",u)},this.createGroupChatInvitationEvent=function(C,S,n,y,R){var m={eventType:"groupChatInvitation",time:new Date,groupChatId:C,contactList:R,senderId:S,senderNickname:n,senderPhotoURL:y};this.eventDispatchMgr("groupChatInvitation",m)},this.createGroupChatMemberUpdateEvent=function(C,S,n){var y={eventType:"groupChatMemberUpdate",time:new Date,groupChatId:C,contactList:S,status:n};this.eventDispatchMgr("groupChatMemberUpdate",y)},this.createAddUserInGroupChatEvent=function(C,S,n){var y={eventType:"addUserInGroupChatAnswer",time:new Date,invitationSended:C,groupChatId:S,contactId:n};this.eventDispatchMgr("addUserInGroupChatAnswer",y)},this.createReceiveGroupChatMessageEvent=function(C,S,n,y,R){var m={eventType:"receiveGroupChatMessage",time:new Date,groupChatId:C,senderId:S,senderNickname:n,message:y};(0,h.Ym)(R,"object")&&(m.metadata=R),this.eventDispatchMgr("receiveGroupChatMessage",m)},this.createReceiveConversationListAnswerEvent=function(C){var S={eventType:"receiveConversationList",time:new Date,convList:C};this.eventDispatchMgr("receiveConversationList",S)},this.createReceiveContactOccurrencesFromConversationListAnswerEvent=function(C){var S={eventType:"receiveContactOccurrencesFromConversationList",time:new Date,occurrencesList:C};this.eventDispatchMgr("receiveContactOccurrencesFromConversationList",S)},this.createReceiveConversationDetailReportAnswerEvent=function(C){var S={eventType:"receiveConversationDetailReport",time:new Date,CDR:C};this.eventDispatchMgr("receiveConversationDetailReport",S)},this.createReceiveConversationHistoryEvent=function(C,S,n){var y={eventType:"receiveConversationHistory",time:new Date,convId:C,convHistory:S,status:n};this.eventDispatchMgr("receiveConversationHistory",y)},this.createUserDataAnswerEvent=function(C,S,n,y){var R={eventType:"userDataAnswer",time:new Date,userFound:C,contactId:S,nickname:n,photoURL:y};this.eventDispatchMgr("userDataAnswer",R)},this.createFetchUserDataAnswerEvent=function(C){var S="fetchUserDataAnswer";this.eventDispatchMgr(S,{eventType:S,timeout:C.timeout,userData:C.userData,id:C.id})},this.createReceiveDataEvent=function(C,S,n){var y={eventType:"receiveData",time:new Date,senderId:C,dstRoomId:S,data:n};this.eventDispatchMgr("receiveData",y)},this.createMCUSessionCreationEvent=function(C,S){var n={eventType:"MCUSessionCreation",time:new Date,sessionId:C,token:S};this.eventDispatchMgr("MCUSessionCreation",n)},this.createJoinMCUSessionAnswerEvent=function(C,S,n,y,R){var m={eventType:"joinMCUSessionAnswer",time:new Date,sessionId:C,token:S,groupChatId:n,initiator:y,roomId:R.roomName};R.roomMode&&(m.mode=R.roomMode),!0===R.meshOnly&&(m.meshOnly=!0),R.joinSessionAnswer&&(m.result=Object.assign({},R.joinSessionAnswer)),this.eventDispatchMgr("joinMCUSessionAnswer",m)},this.createMCUAvailableStreamEvent=function(C,S){var n={eventType:"MCUAvailableStream",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableStream",n)},this.createMCUAvailableReplayEvent=function(C,S){var n={eventType:"MCUAvailableReplay",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableReplay",n)},this.createMCUAvailableCompositeEvent=function(C,S){var n={eventType:"MCUAvailableComposite",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableComposite",n)},this.createMCURemovedStreamEvent=function(C){var S={eventType:"MCURemoveStream",time:new Date,streamId:C};this.eventDispatchMgr("MCURemoveStream",S)},this.createMCUAvailableStreamUpdateEvent=function(C,S){var n={eventType:"MCUAvailableStreamUpdate",time:new Date,streams:C,isRemoteStream:S};this.eventDispatchMgr("MCUAvailableStreamUpdate",n)},this.createMCUParticipantEjectedEvent=function(C,S,n){var y={eventType:"MCUParticipantEjected",time:new Date,roomId:C,clientId:S};n&&(y.data=n),this.eventDispatchMgr("MCUParticipantEjected",y)},this.createReceiveMCUSessionInvitationEvent=function(C,S,n,y){void 0===n&&(n=0);var R={eventType:"receiveMCUSessionInvitation",time:new Date,sessionId:C,token:S,groupChatId:n,initiatorId:y};this.eventDispatchMgr("receiveMCUSessionInvitation",R)},this.createRemoteStreamAddedEvent=function(C,S,n,y,R,m,u){var f={eventType:"remoteStreamAdded",time:new Date,callId:S,callType:C,stream:n,remoteId:y,destCallType:R,audioIsAvailable:m.available,audioIsActive:m.active,audioIsMuted:m.muted,videoIsAvailable:u.available,videoIsActive:u.active,videoIsMuted:u.muted};this.eventDispatchMgr("remoteStreamAdded",f)},this.createRemoteStreamRemovedEvent=function(C,S,n,y,R){var m={eventType:"remoteStreamRemoved",time:new Date,callId:S,callType:C,stream:n,remoteId:y,destCallType:R};this.eventDispatchMgr("remoteStreamRemoved",m)},this.createSimulcastFeedChanged=function(C,S){var n={eventType:"simulcastFeedChanged",time:new Date,callId:C,simulcast:S};this.eventDispatchMgr("simulcastFeedChanged",n)},this.createLocalStreamRemovedEvent=function(C,S,n,y,R){var m={eventType:"localStreamRemoved",time:new Date,callId:S,callType:C,stream:n,remoteId:y,destCallType:R};this.eventDispatchMgr("localStreamRemoved",m)},this.createSlowLinkEvent=function(C,S){var n={eventType:"slowLink",time:new Date,callId:C};S&&(n.advice=S),this.eventDispatchMgr("slowLink",n)},this.createVideoQualityChangedEvent=function(C,S,n,y){var R={eventType:"videoQualityChanged",time:new Date,roomname:S,callId:C,hint:n,profileType:y.name};y.bitrate&&(R.bitrate=y.bitrate),y.width&&y.height&&(R.width=y.width,R.height=y.height),y.frameRate&&(R.frameRate=y.frameRate),this.eventDispatchMgr("videoQualityChanged",R)},this.createAudioAmplitudeEvent=function(C,S,n,y){var R={eventType:"audioAmplitude",time:new Date,callId:n,userMediaStreamId:y,descriptor:{amplitude:C,isSpeaking:S}};this.eventDispatchMgr("audioAmplitude",R)},this.createLocalStreamUpdatedEvent=function(C,S,n,y,R,m,u,f,I){var c={eventType:"localStreamUpdated",time:new Date,changeList:C,audioIsAvailable:S.available,audioDeviceLabel:S.deviceLabel,audioIsActive:S.active,audioIsMuted:S.muted,audioIsSilent:S.silent,videoIsAvailable:n.available,videoDeviceLabel:n.deviceLabel,videoIsActive:n.active,videoIsMuted:n.muted,videoIsSilent:n.silent,onCall:y,callType:R,callId:m,stream:u,userMediaStreamId:f,cause:I};this.eventDispatchMgr("localStreamUpdated",c)},this.createRemoteStreamUpdatedEvent=function(C,S,n,y,R,m){var u={eventType:"remoteStreamUpdated",time:new Date,changeList:C,audioIsAvailable:S.available,audioIsActive:S.active,audioIsMuted:S.muted,audioIsSilent:S.silent,videoIsAvailable:n.available,videoIsActive:n.active,videoIsMuted:n.muted,videoIsSilent:n.silent,callType:y,callId:R,cause:m};this.eventDispatchMgr("remoteStreamUpdated",u)},this.createCanPlayRemoteVideoEvent=function(C,S,n){var y={eventType:"canPlayRemoteVideo",time:new Date,videoDivId:C,callType:S,remoteId:n};this.eventDispatchMgr("canPlayRemoteVideo",y)},this.createRecordedFileAvailableEvent=function(C){var S={eventType:"recordedFileAvailable",time:new Date,fileName:C};this.eventDispatchMgr("recordedFileAvailable",S)},this.createRecordedStreamsAvailableEvent=function(C,S,n,y,R,m,u){var f={eventType:"recordedStreamsAvailable",time:new Date,confId:C,userId1:S,userId2:n,callId:y,apiKey:apiCC.session.apiKey};R&&(f.convId=R),m&&(f.mediaId=m),u&&(f.mediaURL=u),this.eventDispatchMgr("recordedStreamsAvailable",f)},this.createMCURecordedStreamsAvailableEvent=function(C,S,n,y,R,m,u,f,I,c,j){var q={eventType:"MCURecordedStreamsAvailable",time:new Date,roomName:C,callId:S,clientId:n,convId:R,mediaId:m,mediaURL:u,recordType:f};I&&(q.remoteId=I),y&&(q.recordedFileName=y),c&&(q.mediaType=c),(0,h.Ym)(j,"object")?(q.descriptor={},(0,h.Ym)(j,"mode","string")&&(q.descriptor.mode=j.mode),(0,h.Ym)(j,"labelEnabled","boolean")&&(q.descriptor.labelEnabled=j.labelEnabled),!0===q.descriptor.labelEnabled&&(0,h.Ym)(j,"labels","array")&&(q.descriptor.labels=j.labels)):q.descriptor={mode:"complete",labelEnabled:!1},this.eventDispatchMgr("MCURecordedStreamsAvailable",q)},this.createMCURecordingStartedEvent=function(C,S,n,y,R,m,u,f,I,c,j,q){var b={eventType:"MCURecordingStarted",time:new Date,roomName:C,callId:S,clientId:n,recordType:y,recordStartTime:R};m&&(b.convId=m),u&&(b.mediaId=u),f&&(b.mediaURL=f),I&&(b.remoteId=I),c&&(b.recordedFileName=c),j&&(b.mediaType=j),(0,h.Ym)(q,"object")&&(b.descriptor={},(0,h.Ym)(q,"mode","string")&&(b.descriptor.mode=q.mode),(0,h.Ym)(q,"labelEnabled","boolean")&&(b.descriptor.labelEnabled=q.labelEnabled),!0===b.descriptor.labelEnabled&&(0,h.Ym)(q,"labels","array")&&(b.descriptor.labels=q.labels)),this.eventDispatchMgr("MCURecordingStarted",b)},this.createMCURecordingStoppedEvent=function(C,S,n,y,R,m,u,f,I,c,j,q){var b={eventType:"MCURecordingStopped",time:new Date,roomName:C,callId:S,clientId:n,recordType:y,recordStartTime:R};m&&(b.convId=m),u&&(b.mediaId=u),f&&(b.mediaURL=f),I&&(b.remoteId=I),c&&(b.recordedFileName=c),j&&(b.mediaType=j),(0,h.Ym)(q,"object")&&(b.descriptor={},(0,h.Ym)(q,"mode","string")&&(b.descriptor.mode=q.mode),(0,h.Ym)(q,"labelEnabled","boolean")&&(b.descriptor.labelEnabled=q.labelEnabled),!0===b.descriptor.labelEnabled&&(0,h.Ym)(q,"labels","array")&&(b.descriptor.labels=q.labels)),this.eventDispatchMgr("MCURecordingStopped",b)},this.createStopRecordEvent=function(){var C={eventType:"stopRecord",time:new Date};this.eventDispatchMgr("stopRecord",C)},this.createMCUStreamingStartedEvent=function(C,S,n,y){var R={eventType:"MCUStreamingStarted",time:new Date,roomName:C,callId:S,clientId:n,streamingStartTime:y};this.eventDispatchMgr("MCUStreamingStarted",R)},this.createMCUStreamingStoppedEvent=function(C,S,n,y){var R={eventType:"MCUStreamingStopped",time:new Date,roomName:C,callId:S,clientId:n,streamingEndTime:y};this.eventDispatchMgr("MCUStreamingStopped",R)},this.createMCURoomModeChangedEvent=function(C,S,n,y){var R={eventType:"MCURoomModeChanged",time:new Date,roomId:C,oldMode:S,newMode:n,state:y};this.eventDispatchMgr("MCURoomModeChanged",R)},this.createSnapShotPhotoUploaded=function(C){var S={eventType:"snapShotPhotoUploaded",time:new Date,fileName:C};this.eventDispatchMgr("snapShotPhotoUploaded",S)},this.createRoomCreationEvent=function(C,S,n){var y={eventType:"roomCreation",time:new Date,status:C,roomId:S,roomType:n};this.eventDispatchMgr("roomCreation",y)},this.createRoomJoinedEvent=function(C,S,n){var y={eventType:"roomJoined",time:new Date,status:C,roomId:S,roomType:n};this.eventDispatchMgr("roomJoined",y)},this.createRoomInvitationEvent=function(C,S,n,y,R,m){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},f="roomInvitation",I={eventType:"roomInvitation",time:new Date,roomId:C,contactList:R,senderId:S,senderNickname:n,senderPhotoURL:y,roomType:m};u.cloudConvId&&(I.cloudConvId=u.cloudConvId),!0===u.webconf&&(I.webconf=!0),this.eventDispatchMgr(f,I)},this.createRoomMemberUpdateEvent=function(C,S,n,y){var R={eventType:"roomMemberUpdate",time:new Date,roomId:C,contactList:S,status:n,roomType:y};this.eventDispatchMgr("roomMemberUpdate",R)},this.createContactListInRoomEvent=function(C,S,n){var y={eventType:"contactListInRoom",time:new Date,roomId:C,contactList:S,roomType:n};this.eventDispatchMgr("contactListInRoom",y)},this.createReceiveRoomMessageEvent=function(C,S,n,y,R){var m={eventType:"receiveRoomMessage",time:new Date,roomId:C,senderId:S,senderNickname:n,message:y,roomType:R};this.eventDispatchMgr("receiveRoomMessage",m)},this.createDesktopCaptureEvent=function(C,S,n){var y={eventType:"desktopCapture",time:new Date,event:C,callId:S,remoteId:n};this.eventDispatchMgr("desktopCapture",y)},this.createMediaDeviceChangedEvent=function(C,S,n){var y="NotDefined";null!=S&&(y=S);var R={eventType:"mediaDeviceChanged",time:new Date,diff:C,updateReason:y,firstMediaDeviceListInitialization:n};this.eventDispatchMgr("mediaDeviceChanged",R)},this.createSwitchStreamEvent=function(C,S){var n={eventType:"switchStream",time:new Date,callId:C,stream:S};this.eventDispatchMgr("switchStream",n)},this.createConnectedUsersListUpdateEvent=function(C,S,n,y){var R={eventType:"ConnectedUsersListUpdate",time:new Date,group:C,usersList:S,status:n,updateReason:y};this.eventDispatchMgr("connectedUsersListUpdate",R)},this.createClosingWhiteBoardEvent=function(C,S){var n={eventType:"closingWhiteBoard",time:new Date,roomId:C,reason:S};this.eventDispatchMgr("closingWhiteBoard",n)},this.createExternalJsLoadingStatusEvent=function(C,S){var n={eventType:"externalJsLoadingStatus",extjs:C,status:S,time:new Date};this.eventDispatchMgr("externalJsLoadingStatus",n)},this.createBackgroundSubstractionStopVisibilityChangeEvent=function(C){this.eventDispatchMgr("backgroundSubstractionStopVisibilityChange",{userMediaStreamId:C})},this.createBackgroundSubstractionStopComputeTimeEvent=function(C){this.eventDispatchMgr("backgroundSubstractionStopComputeTime",{userMediaStreamId:C})},this.createAIESnapshotEvent=function(C,S){this.eventDispatchMgr("AIESnapshot",{userMediaStreamId:C,image:S})},this.createAIELogEvent=function(C,S){this.eventDispatchMgr("AIELog",{userMediaStreamId:C,log:S})},this.createEvent=function(C){if(!C.eventType)throw new Error("The event json must have an eventType"+C);C.time=new Date,this.eventDispatchMgr(C.eventType,C)}}},940:(V,J,e)=>{"use strict";e.d(J,{S:()=>P}),e(2772);var i=e(1549),d=e(5945),h=i.Y.get("WebRTC_Stack"),P=function(w){this.sendInvite=function(M,C,S,n,y,R){var m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};h.debug("WebRTC_Stack::sendInvite()"),R||(R="media");var u={type:"invite",callId:M,callerId:C,callerNickname:S,calleeId:n,roomId:y,callType:R};m.mode&&(u.mode=m.mode);var f=m.offer;if(f){if("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11){var I=f.type,c=f.sdp;h.log("JSON.stringify(type):",JSON.stringify(I)),h.log("JSON.stringify(sdp):",JSON.stringify(c)),f={type:I,sdp:c}}u.sdpoffer=f}m.data&&(u.data=m.data),m.stream&&(u.stream=m.stream);var j=JSON.stringify(u);h.info("C->S:",j),w.emit("invite",j)},this.sendInviteBroadcast=function(M,C,S,n,y,R){var u;h.debug("WebRTC_Stack::sendInviteBroadcast()"),u=JSON.stringify({type:"invite",callId:M,callerId:C,callerNickname:S,calleeId:n,roomId:y,sdpoffer:R}),h.debug("C->S: "+u),w.emit("invite_broadcast",u)},this.send200OK=function(M,C,S,n,y,R,m){h.debug("WebRTC_Stack::send200OK()");var f,I=null;("IE"===d.Xh||"Safari"===d.Xh&&d.PR<11)&&(h.log("JSON.stringify(offer.sdp) :"+JSON.stringify(R.sdp)),h.log("JSON.stringify(offer.type) :"+JSON.stringify(R.type)),(I={}).sdp=R.sdp,I.type=R.type,R=I),f=JSON.stringify({type:"200OK",callId:M,callerId:C,calleeId:S,calleeNickname:n,roomId:y,sdpanswer:R,data:m}),h.info("C->S: "+f),w.emit("200OK",f)},this.sendCandidate=function(M,C,S,n,y,R,m,u,f,I){h.debug("WebRTC_Stack::sendCandidate()");var c=null,j={};h.debug("completeCandidate :",I),"IE"===d.Xh?(h.log("Browser is IE, adapting completeCandidate"),j.sdpMLineIndex=I.sdpMLineIndex,j.candidate=I.candidate,j.sdpMid=I.sdpMid):j=I,null!==f?(h.log("call data is defined :",f),c={type:"candidate",callId:M,callerId:C,calleeId:S,roomId:n,dst:y,label:R,id:m,candidate:u,data:f,completeCandidate:j}):(h.log("call data is undefined"),c={type:"candidate",callId:M,callerId:C,calleeId:S,roomId:n,dst:y,label:R,id:m,candidate:u,completeCandidate:j});var q=JSON.stringify(c);h.info("C->S:",q),w.emit("candidate",q)},this.sendBye=function(M,C,S,n,y,R){h.debug("WebRTC_Stack::sendBye()");var m,u=null;null!==R?(h.log("call data is defined :"+R),u={type:"bye",callId:M,clientId:C,roomId:S,dst:n,reason:y,data:R}):(h.log("call data is undefined"),u={type:"bye",callId:M,clientId:C,roomId:S,dst:n,reason:y}),m=JSON.stringify(u),h.info("C->S: "+m),w.emit("bye",m)},this.sendUpdate=function(M,C,S,n,y,R,m,u){h.debug("WebRTC_Stack::sendUpdate()");var f,I=null;I={type:"update",callId:M,callerId:C,calleeId:S,roomId:n,dst:y,sdpoffer:R,callType:m},null!=u&&(h.log("call data is defined: "+u),I.data=u),f=JSON.stringify(I),h.info("C->S: "+f),w.emit("update",f)},this.send200Update=function(M,C,S,n,y,R,m){h.debug("WebRTC_Stack::send200Update()");var u,f=null;null!==m?(h.log("call data is defined :"+m),f={type:"200update",callId:M,callerId:C,calleeId:S,roomId:n,dst:y,sdpanswer:R,data:m}):(h.log("call data is undefined"),f={type:"200update",callId:M,callerId:C,calleeId:S,roomId:n,dst:y,sdpanswer:R}),u=JSON.stringify(f),h.info("C->S: "+u),w.emit("200update",u)},this.sendDebugCommand=function(M,C,S){var y;h.debug("WebRTC_Stack::sendDebugCommand :"+M),y=JSON.stringify({type:"debugCommand",command:M,apiKey:C,clientId:S}),h.info("C->S: "+y),w.emit("debugCommand",y)},this.sendAck=function(M,C,S){var y;h.debug("WebRTC_Stack::sendAck()"),y=JSON.stringify({type:"Ack",AckMessageType:M,cSeq:C,dst:S}),h.info("C->S: "+y),w.emit("Ack",y)},this.sendInfo=function(M,C){var n,y=["activeSpeaker","callStats","stopSpeaking"];y.indexOf(M)<0&&h.debug("WebRTC_Stack::sendInfo()"),n=JSON.stringify({type:"info",infoType:M,data:C}),y.indexOf(M)<0&&h.info("C->S: "+n),w.emit("info",n)},this.sendDataMessage=function(M,C){h.debug("WebRTC_Stack::sendDataMessage()");var n=JSON.stringify({type:"apiRTCDataMessage",senderId:M,data:C});h.info("C->S: "+n),w.emit("apiRTCDataMessage",n)}}},2746:(V,J,e)=>{"use strict";e.r(J);var i=e(1549).Y.get("onbeforeunload");apiCC.beforeUnloadFct=function(d){i.debug("User has refreshed or left the page, eventType :",d);try{if("undefined"!=typeof mailClicked&&null!==mailClicked&&(i.log("mailClicked variable is defined"),!0===mailClicked))return i.log("mailClicked is true : leaving onbeforeunload"),void(mailClicked=!1)}catch(h){i.log("Catch error on PATCH/WORKAROUND to avoid reload of page in chrome when mailto :"+h)}try{if(void 0!==apiCC.iePluginInstallationPreventUnload&&null!==apiCC.iePluginInstallationPreventUnload&&!0===apiCC.iePluginInstallationPreventUnload)return void i.log("iePluginInstallationPreventUnload is true : leaving onbeforeunload")}catch(h){i.log("Catch error on PATCH/WORKAROUND to avoid reload of page in IE when installing webRTC plugin :"+h)}null!=apiCC&&(apiCC.storeSessionInfoInSessionStorage(),apiCC.cleanApiRTCContext(),apiCC.disconnect({invalidateApiCCId:!0}),apiCC.cleanAllEventListener(),apiCC.myEventTable=[]),null!=apiCC&&(apiCC.session=null,apiCC.jsLoaded=!1)},"Mobile Safari"===apiRTC.browser?window.addEventListener("pagehide",function(){apiCC.beforeUnloadFct("unload_MobileSafari")}):window.onbeforeunload=function(){apiCC.beforeUnloadFct("unload")}},9064:(V,J,e)=>{"use strict";function i(d){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(h){return typeof h}:function(h){return h&&"function"==typeof Symbol&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h})(d)}e(2222),e(2772),e(4916),e(3123),e(5306),e(3210),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948),V=e.hmd(V),function(d){var h="function",P="undefined",w="object",M="model",C="name",S="type",n="vendor",y="version",R="architecture",m="console",u="mobile",f="tablet",I="smarttv",c="wearable",j={extend:function(Se,Ee){var he={};for(var ue in Se)he[ue]=Ee[ue]&&Ee[ue].length%2==0?Ee[ue].concat(Se[ue]):Se[ue];return he},has:function(Se,Ee){return"string"==typeof Se&&-1!==Ee.toLowerCase().indexOf(Se.toLowerCase())},lowerize:function(Se){return Se.toLowerCase()},major:function(Se){return"string"===i(Se)?Se.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(Se){return Se.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},q={rgx:function(Se,Ee){for(var he,ue,ke,Ne,ze,Ve,et=0;et<Ee.length&&!ze;){var _e=Ee[et],gt=Ee[et+1];for(he=ue=0;he<_e.length&&!ze;)if(ze=_e[he++].exec(Se))for(ke=0;ke<gt.length;ke++)Ve=ze[++ue],i(Ne=gt[ke])===w&&Ne.length>0?2==Ne.length?this[Ne[0]]=i(Ne[1])==h?Ne[1].call(this,Ve):Ne[1]:3==Ne.length?this[Ne[0]]=i(Ne[1])!==h||Ne[1].exec&&Ne[1].test?Ve?Ve.replace(Ne[1],Ne[2]):void 0:Ve?Ne[1].call(this,Ve,Ne[2]):void 0:4==Ne.length&&(this[Ne[0]]=Ve?Ne[3].call(this,Ve.replace(Ne[1],Ne[2])):void 0):this[Ne]=Ve||void 0;et+=2}},str:function(Se,Ee){for(var he in Ee)if(i(Ee[he])===w&&Ee[he].length>0){for(var ue=0;ue<Ee[he].length;ue++)if(j.has(Ee[he][ue],Se))return"?"===he?void 0:he}else if(j.has(Ee[he],Se))return"?"===he?void 0:he;return Se}},b={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[C,y],[/(opios)[\/\s]+([\w\.]+)/i],[[C,"Opera Mini"],y],[/\s(opr)\/([\w\.]+)/i],[[C,"Opera"],y],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[C,y],[/(konqueror)\/([\w\.]+)/i],[[C,"Konqueror"],y],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[C,"IE"],y],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[C,"Edge"],y],[/(yabrowser)\/([\w\.]+)/i],[[C,"Yandex"],y],[/(Avast)\/([\w\.]+)/i],[[C,"Avast Secure Browser"],y],[/(AVG)\/([\w\.]+)/i],[[C,"AVG Secure Browser"],y],[/(puffin)\/([\w\.]+)/i],[[C,"Puffin"],y],[/(focus)\/([\w\.]+)/i],[[C,"Firefox Focus"],y],[/(opt)\/([\w\.]+)/i],[[C,"Opera Touch"],y],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[C,"UCBrowser"],y],[/(comodo_dragon)\/([\w\.]+)/i],[[C,/_/g," "],y],[/(windowswechat qbcore)\/([\w\.]+)/i],[[C,"WeChat(Win) Desktop"],y],[/(micromessenger)\/([\w\.]+)/i],[[C,"WeChat"],y],[/(brave)\/([\w\.]+)/i],[[C,"Brave"],y],[/(qqbrowserlite)\/([\w\.]+)/i],[C,y],[/(QQ)\/([\d\.]+)/i],[C,y],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[C,y],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[C,y],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[C,y],[/(MetaSr)[\/\s]?([\w\.]+)/i],[C],[/(LBBROWSER)/i],[C],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[y,[C,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[y,[C,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[C,y],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[y,[C,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[C,/(.+)/,"$1 WebView"],y],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[C,/(.+(?:g|us))(.+)/,"$1 $2"],y],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[y,[C,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[C,"Sailfish Browser"],y],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[C,y],[/(dolfin)\/([\w\.]+)/i],[[C,"Dolphin"],y],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[C,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[C,"Chrome"],y],[/(coast)\/([\w\.]+)/i],[[C,"Opera Coast"],y],[/fxios\/([\w\.-]+)/i],[y,[C,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[y,[C,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[y,C],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[C,"GSA"],y],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[C,[y,q.str,b.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[C,y],[/(navigator|netscape)\/([\w\.-]+)/i],[[C,"Netscape"],y],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[C,y]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[R,"amd64"]],[/(ia32(?=;))/i],[[R,j.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[R,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[R,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[R,/ower/,"",j.lowerize]],[/(sun4\w)[;\)]/i],[[R,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[R,j.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[M,n,[S,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[M,[n,"Apple"],[S,f]],[/(apple\s{0,1}tv)/i],[[M,"Apple TV"],[n,"Apple"],[S,I]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[n,M,[S,f]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[M,[n,"Amazon"],[S,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[M,q.str,b.device.amazon.model],[n,"Amazon"],[S,u]],[/android.+aft([bms])\sbuild/i],[M,[n,"Amazon"],[S,I]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[M,n,[S,u]],[/\((ip[honed|\s\w*]+);/i],[M,[n,"Apple"],[S,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[n,M,[S,u]],[/\(bb10;\s(\w+)/i],[M,[n,"BlackBerry"],[S,u]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[M,[n,"Asus"],[S,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[n,"Sony"],[M,"Xperia Tablet"],[S,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[M,[n,"Sony"],[S,u]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[n,M,[S,m]],[/android.+;\s(shield)\sbuild/i],[M,[n,"Nvidia"],[S,m]],[/(playstation\s[34portablevi]+)/i],[M,[n,"Sony"],[S,m]],[/(sprint\s(\w+))/i],[[n,q.str,b.device.sprint.vendor],[M,q.str,b.device.sprint.model],[S,u]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[n,[M,/_/g," "],[S,u]],[/(nexus\s9)/i],[M,[n,"HTC"],[S,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[M,[n,"Huawei"],[S,u]],[/android.+(bah2?-a?[lw]\d{2})/i],[M,[n,"Huawei"],[S,f]],[/(microsoft);\s(lumia[\s\w]+)/i],[n,M,[S,u]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[M,[n,"Microsoft"],[S,m]],[/(kin\.[onetw]{3})/i],[[M,/\./g," "],[n,"Microsoft"],[S,u]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[M,[n,"Motorola"],[S,u]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[M,[n,"Motorola"],[S,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[n,j.trim],[M,j.trim],[S,I]],[/hbbtv.+maple;(\d+)/i],[[M,/^/,"SmartTV"],[n,"Samsung"],[S,I]],[/\(dtv[\);].+(aquos)/i],[M,[n,"Sharp"],[S,I]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[n,"Samsung"],M,[S,f]],[/smart-tv.+(samsung)/i],[n,[S,I],M],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[n,"Samsung"],M,[S,u]],[/sie-(\w*)/i],[M,[n,"Siemens"],[S,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[n,"Nokia"],M,[S,u]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[M,[n,"Acer"],[S,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[M,[n,"LG"],[S,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[n,"LG"],M,[S,f]],[/(lg) netcast\.tv/i],[n,M,[S,I]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[M,[n,"LG"],[S,u]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[n,M,[S,f]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[M,[n,"Lenovo"],[S,f]],[/(lenovo)[_\s-]?([\w-]+)/i],[n,M,[S,u]],[/linux;.+((jolla));/i],[n,M,[S,u]],[/((pebble))app\/[\d\.]+\s/i],[n,M,[S,c]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[n,M,[S,u]],[/crkey/i],[[M,"Chromecast"],[n,"Google"],[S,I]],[/android.+;\s(glass)\s\d/i],[M,[n,"Google"],[S,c]],[/android.+;\s(pixel c)[\s)]/i],[M,[n,"Google"],[S,f]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[M,[n,"Google"],[S,u]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[M,/_/g," "],[n,"Xiaomi"],[S,u]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[M,/_/g," "],[n,"Xiaomi"],[S,f]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[M,[n,"Meizu"],[S,u]],[/(mz)-([\w-]{2,})/i],[[n,"Meizu"],M,[S,u]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[M,[n,"OnePlus"],[S,u]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[M,[n,"RCA"],[S,f]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[M,[n,"Dell"],[S,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[M,[n,"Verizon"],[S,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[n,"Barnes & Noble"],M,[S,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[M,[n,"NuVision"],[S,f]],[/android.+;\s(k88)\sbuild/i],[M,[n,"ZTE"],[S,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[M,[n,"Swiss"],[S,u]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[M,[n,"Swiss"],[S,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[M,[n,"Zeki"],[S,f]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[n,"Dragon Touch"],M,[S,f]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[M,[n,"Insignia"],[S,f]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[M,[n,"NextBook"],[S,f]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[n,"Voice"],M,[S,u]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[n,"LvTel"],M,[S,u]],[/android.+;\s(PH-1)\s/i],[M,[n,"Essential"],[S,u]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[M,[n,"Envizen"],[S,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[n,M,[S,f]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[M,[n,"MachSpeed"],[S,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[n,M,[S,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[M,[n,"Rotor"],[S,f]],[/android.+(KS(.+))\s+build/i],[M,[n,"Amazon"],[S,f]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[n,M,[S,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[S,j.lowerize],n,M],[/[\s\/\(](smart-?tv)[;\)]/i],[[S,I]],[/(android[\w\.\s\-]{0,9});.+build/i],[M,[n,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[y,[C,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[C,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[C,y],[/rv\:([\w\.]{1,9}).+(gecko)/i],[y,C]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[C,y],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[C,[y,q.str,b.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[C,"Windows"],[y,q.str,b.os.windows.version]],[/\((bb)(10);/i],[[C,"BlackBerry"],y],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[C,y],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[C,"Symbian"],y],[/\((series40);/i],[C],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[C,"Firefox OS"],y],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[C,y],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[C,"Chromium OS"],y],[/(sunos)\s?([\w\.\d]*)/i],[[C,"Solaris"],y],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[C,y],[/(haiku)\s(\w+)/i],[C,y],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[y,/_/g,"."],[C,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[C,"Mac OS"],[y,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[C,y]]},Z=function Se(Ee,he){if("object"===i(Ee)&&(he=Ee,Ee=void 0),!(this instanceof Se))return new Se(Ee,he).getResult();var ue=Ee||(d&&d.navigator&&d.navigator.userAgent?d.navigator.userAgent:""),ke=he?j.extend(T,he):T;return this.getBrowser=function(){var Ne={name:void 0,version:void 0};return q.rgx.call(Ne,ue,ke.browser),Ne.major=j.major(Ne.version),Ne},this.getCPU=function(){var Ne={architecture:void 0};return q.rgx.call(Ne,ue,ke.cpu),Ne},this.getDevice=function(){var Ne={vendor:void 0,model:void 0,type:void 0};return q.rgx.call(Ne,ue,ke.device),Ne},this.getEngine=function(){var Ne={name:void 0,version:void 0};return q.rgx.call(Ne,ue,ke.engine),Ne},this.getOS=function(){var Ne={name:void 0,version:void 0};return q.rgx.call(Ne,ue,ke.os),Ne},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ue},this.setUA=function(Ne){return ue=Ne,this},this};Z.VERSION="0.7.21",Z.BROWSER={NAME:C,MAJOR:"major",VERSION:y},Z.CPU={ARCHITECTURE:R},Z.DEVICE={MODEL:M,VENDOR:n,TYPE:S,CONSOLE:m,MOBILE:u,SMARTTV:I,TABLET:f,WEARABLE:c,EMBEDDED:"embedded"},Z.ENGINE={NAME:C,VERSION:y},Z.OS={NAME:C,VERSION:y},("undefined"==typeof exports?"undefined":i(exports))!==P?(i(V)!==P&&V.exports&&(exports=V.exports=Z),exports.UAParser=Z,d.UAParser=Z):"function"==typeof define&&e.amdO?define(function(){return Z}):d&&(d.UAParser=Z);var le=d&&(d.jQuery||d.Zepto);if(le&&!le.ua){var x=new Z;le.ua=x.getResult(),le.ua.get=function(){return x.getUA()},le.ua.set=function(Se){x.setUA(Se);var Ee=x.getResult();for(var he in Ee)le.ua[he]=Ee[he]}}}("object"===("undefined"==typeof window?"undefined":i(window))?window:void 0)},8274:(V,J,e)=>{"use strict";e.r(J),e.d(J,{Call:()=>Zi,CloudApi:()=>zr,Conference:()=>nr,Contact:()=>ci,Conversation:()=>qt,ConversationCall:()=>Va,DataChannel:()=>Kn,Enterprise:()=>dr,EventCenter:()=>b,EventEmitter:()=>w,MediaDevice:()=>le,Observable:()=>ke,PointerSharingRoom:()=>gr,ReceivedCallInvitation:()=>Di,ReceivedConversationInvitation:()=>L,ReceivedConversationJoinRequest:()=>Yn,ReceivedDataChannelInvitation:()=>mn,ReceivedFileTransferInvitation:()=>Rn,ReceivedInvitation:()=>v,ReceivedPointerSharingInvitation:()=>Q,ReceivedWhiteboardInvitation:()=>Bt,SentInvitation:()=>ft,Session:()=>Ui,Stream:()=>Tn,UserAgent:()=>Jr,UserData:()=>Ke,default:()=>Lo}),e(7941),e(2526),e(1817),e(1539),e(2165),e(6992),e(8783),e(3948);var i=e(3173);function d(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function h(D){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}e(4603),e(4916),e(9714),e(7042),e(561),e(9070),e(8309),e(1038),e(9753);var w=function(){function D(){!function(O,U){if(!(O instanceof U))throw new TypeError("Cannot call a class as a function")}(this,D)}var Y;return Y=[{key:"getListeners",value:function(O){var U,de,fe=this._getEvents();if(O instanceof RegExp)for(de in U={},fe)fe.hasOwnProperty(de)&&O.test(de)&&(U[de]=fe[de]);else U=fe[O]||(fe[O]=[]);return U}},{key:"flattenListeners",value:function(O){var U,de=[];for(U=0;U<O.length;U+=1)de.push(O[U].listener);return de}},{key:"getListenersAsObject",value:function(O){var U,de=this.getListeners(O);return de instanceof Array&&((U={})[O]=de),U||de}},{key:"emit",value:function(O){var U=Array.prototype.slice.call(arguments,1);return this.emitEvent(O,U)}},{key:"addListener",value:function(O,U){if(!n(U))throw new TypeError("listener must be a function");var de,fe=this.getListenersAsObject(O),H="object"===h(U);for(de in fe)fe.hasOwnProperty(de)&&-1===C(fe[de],U)&&fe[de].push(H?U:{listener:U,once:!1});if("contactListUpdate"===O){apiRTC.userAgentInstance.currentSession.contactListUpdateListenerSetted=!0;var a,o=function(z,$){var X="undefined"!=typeof Symbol&&z[Symbol.iterator]||z["@@iterator"];if(!X){if(Array.isArray(z)||(X=function(Dt,Ut){if(Dt){if("string"==typeof Dt)return d(Dt,void 0);var gi=Object.prototype.toString.call(Dt).slice(8,-1);return"Object"===gi&&Dt.constructor&&(gi=Dt.constructor.name),"Map"===gi||"Set"===gi?Array.from(Dt):"Arguments"===gi||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(gi)?d(Dt,void 0):void 0}}(z))){X&&(z=X);var se=0,Me=function(){};return{s:Me,n:function(){return se>=z.length?{done:!0}:{done:!1,value:z[se++]}},e:function(Dt){throw Dt},f:Me}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Fe,bt=!0,ht=!1;return{s:function(){X=X.call(z)},n:function(){var Dt=X.next();return bt=Dt.done,Dt},e:function(Dt){ht=!0,Fe=Dt},f:function(){try{bt||null==X.return||X.return()}finally{if(ht)throw Fe}}}}(apiRTC.userAgentInstance.currentSession.waitingContactListUpdateEvent);try{for(o.s();!(a=o.n()).done;)this.emit("contactListUpdate",a.value)}catch(z){o.e(z)}finally{o.f()}apiRTC.userAgentInstance.currentSession.waitingContactListUpdateEvent=[]}else if("mediaDeviceChanged"===O&&!0===apiRTC.mediaDeviceMgr.mediaDeviceChangedDetected){var F=apiRTC.mediaDeviceMgr.getMediaDeviceListsDiff(apiRTC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiRTC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources);apiRTC.myWebRTC_Event.createMediaDeviceChangedEvent(F,"updatedOnDeviceChange",apiRTC.mediaDeviceMgr.realMediaDevicesListInitializationWasAlreadyDone)}return this}},{key:"addOnceListener",value:function(O,U){return this.addListener(O,{listener:U,once:!0})}},{key:"defineEvent",value:function(O){return this.getListeners(O),this}},{key:"defineEvents",value:function(O){for(var U=0;U<O.length;U+=1)this.defineEvent(O[U]);return this}},{key:"removeListener",value:function(O,U){var de,fe,H=this.getListenersAsObject(O);for(fe in H)H.hasOwnProperty(fe)&&-1!==(de=C(H[fe],U))&&H[fe].splice(de,1);return this}},{key:"addListeners",value:function(O,U){return this.manipulateListeners(!1,O,U)}},{key:"removeListeners",value:function(O,U){return this.manipulateListeners(!0,O,U)}},{key:"manipulateListeners",value:function(O,U,de){var fe,H,a=O?this.removeListener:this.addListener,o=O?this.removeListeners:this.addListeners;if("object"!==h(U)||U instanceof RegExp)for(fe=de.length;fe--;)a.call(this,U,de[fe]);else for(fe in U)U.hasOwnProperty(fe)&&(H=U[fe])&&("function"==typeof H?a.call(this,fe,H):o.call(this,fe,H));return this}},{key:"removeEvent",value:function(O){var U,de=h(O),fe=this._getEvents();if("string"===de)delete fe[O];else if(O instanceof RegExp)for(U in fe)fe.hasOwnProperty(U)&&O.test(U)&&delete fe[U];else delete this._events;return this}},{key:"emitEvent",value:function(O,U){var de,fe,H,a,o=this.getListenersAsObject(O);for(a in o)if(o.hasOwnProperty(a))for(de=o[a].slice(0),H=0;H<de.length;H++)!0===(fe=de[H]).once&&this.removeListener(O,fe.listener),fe.listener.apply(this,U||[])===this._getOnceReturnValue()&&this.removeListener(O,fe.listener);return this}},{key:"setOnceReturnValue",value:function(O){return this._onceReturnValue=O,this}},{key:"_getOnceReturnValue",value:function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue}},{key:"_getEvents",value:function(){return this._events||(this._events={})}}],Y&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(D.prototype,Y),D}(),M=w.prototype,C=function(D,_){for(var Y=D.length;Y--;)if(D[Y].listener===_)return Y;return-1},S=function(D){return function(){return this[D].apply(this,arguments)}},n=function D(_){return"function"==typeof _||_ instanceof RegExp||!(!_||"object"!==h(_))&&D(_.listener)};M.on=S("addListener"),M.once=S("addOnceListener"),M.off=S("removeListener"),M.removeAllListeners=S("removeEvent"),M.trigger=S("emitEvent"),e(1249);var y=e(5945),R=e(1549),m=e(4708),u=(R.Y.get("ApiCC"),{});u[1]="ERROR",u[2]="WARN",u[3]="INFO",u[4]="DEBUG",u[5]="TRACE";var f={description:"ApiRTC Cloud Communication Library",session:null,jsLoaded:!1,initApiKey:null,initApiCCId:null,extJsLoadingRetryNb:null,extJsLoadingRetryDelay:null,bandwidthTestServer:"https://cloud.apizee.com",bandwidthRatingThresholds:[300,500,1e3,1500,2e3],LOG_LEVEL_OFF:0,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL_TRACE:5,browser:y.Xh,browser_major_version:y.PR,browser_version:y.dc,osName:y.BF,osVersion:y.MM,osUAParser:y.ag,browserInfo:y.cf,browserDetails:m.wL,parser:y.E2,logStorageActivated:!1,logStorageLevel:3,logStorage:[],eventCenter:null},c=R.Y.get("EventCenter"),j="eventCenterData",q="[REMOTE-EVENTCENTER]",b=function(){function D(){var O=this;(function(U,de){if(!(U instanceof de))throw new TypeError("Cannot call a class as a function")})(this,D),this.consoleOutputEnabled=!1,this.storageDisabled=!1,"undefined"==typeof apiRTC_React&&(document.addEventListener("error",function(U){O.handleErrorEvent(U)}),document.addEventListener("userMediaError",function(U){O.handleErrorEvent(U)}))}var Y;return(Y=[{key:"handleErrorEvent",value:function(O){var U=O.detail;if(!0!==this.storageDisabled)if(void 0!==U){var de={},fe={},H="UNKNOWN";de.type=O.type;for(var a=0,o=Object.keys(U);a<o.length;a++){var k=o[a];"eventType"!==k&&(de[k]=U[k])}de.systemInfo={apiRTC:f.version,app:y.$6,device:y.vO,osName:y.BF,osVersion:y.MM,browser:y.Xh,browser_version:y.dc},null!=f.session?H=f.session.apiCCId:null!=f.initApiCCId&&(H=f.initApiCCId),de.userInfo={apiCCId:H,apiKey:apiRTC.initApiKey};var F=localStorage.getItem(j);(F=F?JSON.parse(F):[]).unshift(de),F.length>100&&F.splice(100,F.length-100),localStorage.setItem(j,JSON.stringify(F)),this.consoleOutputEnabled&&c.error("[EVENTCENTER]",de),"undefined"!=typeof Sentry&&("USER_MEDIA_ERROR"!==O.detail.errorCode?(fe.type=O.type,O.detail.error&&(fe.error=O.detail.error),O.detail.errorInfo&&(fe.errorInfo=O.detail.errorInfo),O.detail.errorCode&&(fe.errorCode=O.detail.errorCode),O.detail.callId&&(fe.callId=O.detail.callId),O.detail.convId&&(fe.convId=O.detail.convId),O.detail.gumConfig&&(fe.gumConfigVideo=!1!==O.detail.gumConfig.video),Sentry.withScope(function(z){z.setTag("event-center",!0),z.setTag("userId",f.session.apiCCId),Sentry.captureException(new Error(JSON.stringify(fe)))})):c.debug("Filtering error event for USER_MEDIA_ERROR for Sentry"))}else c.error("Can't handle error event: data is undefined");else c.debug("Event Center is disabled")}},{key:"handleDataAnswer",value:function(O){O?O.map(function(U){c.debug(q+": ",U)}):c.debug(q+": "+this.getUsername()+" has no event records")}},{key:"getStoredData",value:function(){var O=localStorage.getItem(j);return void 0===O?(c.warn("No data was stored by event center"),null):JSON.parse(O)}},{key:"clearStoredData",value:function(){localStorage.removeItem(j)}},{key:"enableConsoleOutput",value:function(O){this.consoleOutputEnabled=O}},{key:"disableStorage",value:function(O){this.storageDisabled=O}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(D.prototype,Y),D}();e(3710);var Z=R.Y.get("MediaDevice"),le=function(){function D(O,U,de,fe){(function(H,a){if(!(H instanceof a))throw new TypeError("Cannot call a class as a function")})(this,D),Z.trace("Create "+U+" MediaDevice"),this.id=O,this.type=U,this.label=de,this.capabilities=fe}var Y;return(Y=[{key:"getId",value:function(){return this.id.toString()}},{key:"getType",value:function(){return this.type}},{key:"getLabel",value:function(){return this.label}},{key:"isCamera",value:function(){return"videoinput"===this.type}},{key:"isMicrophone",value:function(){return"audioinput"===this.type}},{key:"isAudioOutput",value:function(){return"audiooutput"===this.type}},{key:"getCapabilities",value:function(){return this.capabilities}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(D.prototype,Y),D}(),x=(e(1532),e(4129),e(9653),e(4363),e(2772),e(9554),e(4747),e(8674),e(9575),e(2472),e(2990),e(8927),e(3105),e(5035),e(4345),e(7174),e(2846),e(4731),e(7209),e(6319),e(8867),e(7789),e(3739),e(9368),e(4483),e(2056),e(3462),e(678),e(7462),e(3824),e(5021),e(2974),e(5016),e(2707),e(2564),e(7327),e(9600),e(285),e(1637),e(2479),e(8304),e(489),e(2419),e(8011),e(4819),e(5003),e(1215));function Se(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Ee(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}var he=new WeakMap,ue=new WeakMap,ke=function(){function D(U){(function(de,fe){if(!(de instanceof fe))throw new TypeError("Cannot call a class as a function")})(this,D),ue.set(this,U),he.set(this,new w)}var _,Y,O;return _=D,O=[{key:"getAvailableEvents",value:function(){return[]}}],(Y=[{key:"on",value:function(U,de){return this.constructor.getAvailableEvents().indexOf(U)>-1?he.get(this).on(U,de):ue.get(this).error("No such event "+U),this}},{key:"removeListener",value:function(U,de){if(this.constructor.getAvailableEvents().indexOf(U)>-1){var fe,H=!1,a=function(o,k){var F="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!F){if(Array.isArray(o)||(F=function(Fe,bt){if(Fe){if("string"==typeof Fe)return Se(Fe,void 0);var ht=Object.prototype.toString.call(Fe).slice(8,-1);return"Object"===ht&&Fe.constructor&&(ht=Fe.constructor.name),"Map"===ht||"Set"===ht?Array.from(Fe):"Arguments"===ht||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ht)?Se(Fe,void 0):void 0}}(o))){F&&(o=F);var z=0,$=function(){};return{s:$,n:function(){return z>=o.length?{done:!0}:{done:!1,value:o[z++]}},e:function(Fe){throw Fe},f:$}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var X,se=!0,Me=!1;return{s:function(){F=F.call(o)},n:function(){var Fe=F.next();return se=Fe.done,Fe},e:function(Fe){Me=!0,X=Fe},f:function(){try{se||null==F.return||F.return()}finally{if(Me)throw X}}}}(he.get(this).getListeners(U));try{for(a.s();!(fe=a.n()).done;)if(fe.value.listener===de){H=!0;break}}catch(o){a.e(o)}finally{a.f()}H?he.get(this).off(U,de):ue.get(this).trace("removeListener() - No such listener for event "+U)}else ue.get(this).error("No such event "+U);return this}}])&&Ee(_.prototype,Y),O&&Ee(_,O),D}();function Ne(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return ze(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?ze(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function ze(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Ve(D){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function et(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}e(6699),e(2023),e(6755),e(3843);var _e=R.Y.get("ApiRTCManager"),gt=["sessionReady","incomingCall","callEstablished","userMediaSuccess","userMediaStop","userMediaError","callRestarting","error","receiveIMMessage","updatePresence","webRTCClientCreated","updateUserStatus","channelEvent","groupChatCreation","groupChatInvitation","groupChatMemberUpdate","addUserInGroupChatAnswer","receiveGroupChatMessage","userDataAnswer","fetchUserDataAnswer","receiveConversationList","receiveConversationHistory","receiveConversationDetailReport","receiveContactOccurrencesFromConversationList","receiveMCUSessionInvitation","MCUSessionCreation","MCUAvailableStream","MCUAvailableStreamUpdate","MCURemoveStream","canPlayRemoteVideo","recordedFileAvailable","receiveData","roomCreation","roomJoined","roomInvitation","roomMemberUpdate","receiveRoomMessage","contactListInRoom","snapShotPhotoUploaded","stopRecord","callAttempt","joinMCUSessionAnswer","hangup","desktopCapture","remoteStreamAdded","remoteStreamRemoved","switchStream","sendDataChannelOpen","sendDataChannelClose","sendDataChannelError","receiveDataChannelOpen","receiveDataChannelClose","receiveDataChannelError","connectedUsersListUpdate","onFileSended","onFileSending","onFileReceiving","onFileReceived","onFileProgress","onFilePending","recordedStreamsAvailable","closingWhiteBoard","webRTCPluginInstallation","onQosStatsUpdate","onQosChange","onQosAudioChange","onQosVideoChange","MCURecordedStreamsAvailable","MCURecordingStarted","MCURecordingStopped","ICECandidateTypeUpdate","disconnectionWarning","MCUAvailableComposite","MCUParticipantEjected","MCUStreamingStarted","MCUStreamingStopped","MCUAvailableReplay","MCURoomModeChanged","onCallStatsUpdate","slowLink","localStreamUpdated","remoteStreamUpdated","audioAmplitude","videoQualityChanged","cpuLimited","bandwidthLimited","simulcastFeedChanged","cloudEventOccurred","groupUnsubscribed","transferBegun","transferProgress","transferEnded"],mt=null,ot=!1,at=!1,yt=function(D){if(null!==mt&&mt.isInitialized()){if("groupUnsubscribed"===D||"transferBegun"===D||"transferProgress"===D||"transferEnded"===D)return;apiRTC.addEventListener(D,function(_){_e.trace("Emiting "+D,_),mt.eventEmitter.emit(D,_)})}},Et=function(D){null!==mt&&mt.isInitialized()&&apiRTC.removeEventListener(D,function(_){_e.trace("Emiting "+D,_),mt.eventEmitter.emit(D,_)})},ie=function(){function D(){if(function(U,de){if(!(U instanceof de))throw new TypeError("Cannot call a class as a function")}(this,D),null!==mt)throw"Cannot construct singleton ApiRTCManager";this.eventEmitter=new w,this.apiRTCSession=null,this.whiteBoardClient=null,this.pointerSharingClient=null,this.webRTCClient=null,this.dataClient=null,this.IMClient=null,this.contactDisconnectionDelay=i.g.CONTACT_DISCONNECTION_DELAY,mt=this}var _,Y,O;return _=D,Y=[{key:"onEvent",value:function(U,de){return gt.indexOf(U)>-1?this.eventEmitter.on(U,de):_e.error("No such apiRTC event "+U),this}},{key:"onceEvent",value:function(U,de){gt.indexOf(U)>-1?this.eventEmitter.once(U,de):_e.error("No such apiRTC event "+U)}},{key:"sendData",value:function(U,de){var fe=this;return new Promise(function(H,a){null===fe.dataClient?a(i.g.ERROR_APIRTC_INITIALISATION_FAILED):fe.dataClient.sendData(U,de,function(o){var k=i.g.ERROR_OTHER;null!=o?"timeoutReached"!==o.reason&&"destNotFound"!==o.reason?H():("timerReached"===o.reason?k=i.g.ERROR_TIMED_OUT:"destNotFound"===o.reason&&(k=i.g.ERROR_NOT_FOUND),a(k)):a(k)})})}},{key:"sendMessage",value:function(U,de){var fe=this,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(a,o){null===fe.IMClient?o(i.g.ERROR_APIRTC_INITIALISATION_FAILED):fe.IMClient.sendMessage(U,de,function(k){var F=i.g.ERROR_OTHER;null!=k?"timeoutReached"!==k.reason&&"destNotFound"!==k.reason?a(k.UUCSeq):("timerReached"===k.reason?F=i.g.ERROR_TIMED_OUT:"destNotFound"===k.reason&&(F=i.g.ERROR_NOT_FOUND),o(F)):o(F)},H)})}},{key:"joinGroupChat",value:function(U){var de=this;return new Promise(function(fe,H){if(null===de.IMClient)return H(x.g.createError(i.g.ERROR_WRONG_STATE,"joinGroupChat() - cannot join group chat"));de.IMClient.joinGroupChat(U),fe()})}},{key:"leaveGroupChat",value:function(U){var de=this;return new Promise(function(fe,H){if(null===de.IMClient)return H(x.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - cannot leave group chat"));de.IMClient.leaveGroupChat(U),fe()})}},{key:"sendMessageToGroupChat",value:function(U,de){var fe=this,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(a,o){if(null===fe.IMClient)o(i.g.ERROR_APIRTC_INITIALISATION_FAILED);else{var k={};x.g.isTypeof(H,"metadata","object")&&(k.metadata=H.metadata),fe.IMClient.sendMessageToGroupChat(U,de,function(F){return null!==F&&"object"===Ve(F)?"ack"===F.reason?a(F.UUCSeq):o("timeoutReached"===F.reason?i.g.ERROR_TIMED_OUT:"destNotFound"===F.reason?i.g.ERROR_NOT_FOUND:i.g.ERROR_OTHER):o(i.g.ERROR_OTHER)},k)}})}},{key:"removeEventListener",value:function(U,de){null!=de&&(gt.indexOf(U)>-1?this.eventEmitter.off(U,de):_e.error("No such apiRTC event "+U))}},{key:"isInitialized",value:function(){return ot}},{key:"unsubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.unsubscribePresenceGroup([U]),mt.eventEmitter.emit("groupUnsubscribed",U)):_e.error("apiRTC session is not initialized")}},{key:"joinAndSubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.joinPresenceGroup([U]),this.apiRTCSession.subscribePresenceGroup([U])):_e.error("apiRTC session is not initialized")}},{key:"leaveAndUnsubscribeToPresenceGroup",value:function(U){null!==this.apiRTCSession?(this.apiRTCSession.leavePresenceGroup([U]),this.unsubscribeToPresenceGroup(U)):_e.error("apiRTC session is not initialized")}},{key:"subscribeToCloudEvent",value:function(U,de){this.apiRTCSession?this.apiRTCSession.subscribeToCloudEvent(U,de):_e.error("apiRTC session is not initialized")}},{key:"unsubscribeToCloudEvent",value:function(U,de){this.apiRTCSession?this.apiRTCSession.unsubscribeToCloudEvent(U,de):_e.error("apiRTC session is not initialized")}},{key:"disconnect",value:function(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(apiRTC.disconnect(U),ot=!1,this.apiRTCSession=null,this.webRTCClient=null,this.dataClient=null,this.IMClient=null,at){var de,fe=Ne(gt);try{for(fe.s();!(de=fe.n()).done;){var H=de.value;Et(H)}}catch(a){fe.e(a)}finally{fe.f()}at=!1}}},{key:"initializeApiRTC",value:function(U){return _e.info("initializeApiRTC()"),new Promise(function(de,fe){if(void 0===U&&void 0===U.apiKey)fe("Invalid apiRTC initialization params");else{var H=function(a){switch(_e.debug("onChannelEventDuringInit()",a.detail),a.detail.channelEvent){case"onChannelError":fe("Channel Error : "+a.detail.event);break;case"onChannelConnectError":a.detail.event.message.includes("access token failure")&&fe("Channel Connect Error: "+a.detail.event.message);break;case"onChannelOpened":_e.debug("onChannelOpened");break;default:_e.debug("Unhandle case in onChannelEventDuringInit :",a.detail.channelEvent)}};apiRTC.addEventListener("channelEvent",H),U.onReady=function(){if(ot=!0,mt.webRTCClient=apiRTC.session.createWebRTCClient({}),mt.webRTCClient.setMCUConnector(U.hasOwnProperty("mcu")?U.mcu:i.g.DEFAULT_MCU),x.g.isPropertyTypeof(U,"turnServerAddress","string")&&mt.webRTCClient.setClientTurnServer(U.turnServerAddress),mt.webRTCClient.setUserAcceptOnIncomingCallBeforeGetUserMedia(!0),x.g.isPropertyTypeof(U,"userAcceptOnIncomingDataCall","boolean")?mt.webRTCClient.setUserAcceptOnIncomingDataCall(U.userAcceptOnIncomingDataCall):mt.webRTCClient.setUserAcceptOnIncomingDataCall(!0),x.g.isPropertyTypeof(U,"userAcceptOnIncomingScreenSharingCall","boolean")?mt.webRTCClient.setUserAcceptOnIncomingScreenSharingCall(U.userAcceptOnIncomingScreenSharingCall):mt.webRTCClient.setUserAcceptOnIncomingScreenSharingCall(!1),mt.dataClient=apiRTC.session.createDataClient(),mt.IMClient=apiRTC.session.createIMClient(),mt.pointerSharingClient=apiRTC.session.createPointerSharingClient(),mt.webRTCClient.setAllowMultipleCalls(!0),mt.apiRTCSession=apiRTC.session,!at){var a,o=Ne(gt);try{for(o.s();!(a=o.n()).done;)yt(a.value)}catch(F){o.e(F)}finally{o.f()}at=!0}apiRTC.removeEventListener("channelEvent",H),de(apiRTC.session.apiCCId)},ot=!1,mt.apiRTCSession=null,mt.webRTCClient=null,mt.dataClient=null,mt.IMClient=null,apiRTC.init(U)}})}},{key:"createWhiteBoard",value:function(){_e.debug("createWhiteBoard()"),mt.whiteBoardClient=apiRTC.createWhiteBoard(null,"invisible",null,6e4)}},{key:"getMediaDevices",value:function(){return _e.debug("ApiRTCManager::getMediaDevices()"),new Promise(function(U,de){apiRTC.getMediaDevices().then(function(fe){_e.debug("ApiRTCManager::getMediaDevices(), sources :",fe),U(fe)}).catch(function(fe){var H="getMediaDevices() - error";_e.error(H,fe),de(new Error(H))})})}},{key:"getUserMedia",value:function(U){return new Promise(function(de,fe){apiRTC.getUserMedia(U).then(function(H){_e.debug("ApiRTCManager::getUserMedia() success"),de(H)}).catch(function(H){_e.error("ApiRTCManager::getUserMedia() - Could not get user media :",H),fe(new Error("ApiRTCManager::getUserMedia() - Could not get user media :"+H))})})}},{key:"setAudioSourceIdInConstraint",value:function(U,de){return apiRTC.setAudioSourceIdInConstraint(U,de)}},{key:"setVideoSourceIdInConstraint",value:function(U,de){return apiRTC.setVideoSourceIdInConstraint(U,de)}},{key:"attachMediaStream",value:function(U,de){apiRTC.attachMediaStream(U,de)}},{key:"addStreamInDiv",value:function(U,de,fe,H,a,o,k){apiRTC.addStreamInDiv(U,de,fe,H,a,o,k)}},{key:"removeElementFromDiv",value:function(U,de){_e.debug("removeElementFromDiv"),apiRTC.removeElementFromDiv(U,de)}},{key:"getClientId",value:function(){return null!==this.apiRTCSession&&null!==this.apiRTCSession.apiCCWebRTCClient?this.apiRTCSession.apiCCWebRTCClient.webRTCClient.clientId:null}},{key:"getActiveApiKey",value:function(){return void 0!==apiRTC.session&&null!==apiRTC.session?apiRTC.session.apiKey:null}}],O=[{key:"get",value:function(){return null===mt&&(mt=new D),mt}}],Y&&et(_.prototype,Y),O&&et(_,O),D}();function dt(D){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Mt(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Rt(D,_){return(Rt=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function je(D,_){if(_&&("object"===dt(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return xt(D)}function xt(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Wt(D){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Gt=R.Y.get("Invitation"),kt=new WeakMap,Xe=["statusChange"],zt=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Rt(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Wt(U);if(de){var k=Wt(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return je(this,a)});function H(){var a;return function(o,k){if(!(o instanceof k))throw new TypeError("Cannot call a class as a function")}(this,H),(a=fe.call(this,Gt)).id=null,kt.set(xt(a),i.g.INVITATION_STATUS_STANDBY),a.apiRTCManager=ie.get(),a.type="not_defined",a}return _=H,O=[{key:"getAvailableEvents",value:function(){return Xe}}],(Y=[{key:"setStatus",value:function(a){kt.set(this,a),he.get(this).emit("statusChange",{status:a,id:this.id})}},{key:"getStatus",value:function(){return kt.get(this)}}])&&Mt(_.prototype,Y),O&&Mt(_,O),H}(ke);function G(D){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function t(D,_){return(t=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function l(D,_){if(_&&("object"===G(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function s(D){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}R.Y.get("ReceivedInvitation");var v=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&t(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=s(O);if(U){var o=s(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return l(this,H)});function fe(H,a){var o;return function(k,F){if(!(k instanceof F))throw new TypeError("Cannot call a class as a function")}(this,fe),(o=de.call(this)).id=a,o.sender=H,o.receiveTime=Date.now(),o}return(Y=[{key:"accept",value:function(){return new Promise}},{key:"decline",value:function(H){}},{key:"getSender",value:function(){return this.sender}},{key:"getReceiveTime",value:function(){return this.receiveTime}},{key:"getId",value:function(){return this.id}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(zt);function r(D){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function g(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function te(D,_){return(te=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function ae(D,_){if(_&&("object"===r(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return Re(D)}function Re(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Ce(D){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var re=R.Y.get("ReceivedInvitation"),K=new WeakMap,L=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&te(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=Ce(O);if(U){var o=Ce(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return ae(this,H)});function fe(H,a,o){var k,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return g(this,fe),k=de.call(this,H,a.invitationId),re.info("Create ReceivedConversationInvitation"),k.conversation=o,k.type="conversation",k.invitationData=a,K.set(Re(k),F),k}return Y=[{key:"accept",value:function(H){var a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},k=function(){return new Promise(function(z,$){var X=K.get(a);o.hasOwnProperty("password")&&(X.password=o.password),o.hasOwnProperty("session")&&(X.session=o.session),a.conversation.join(X).then(function(){null!=H&&a.conversation.publish(H),z(a.conversation)}).catch(function(se){$(x.g.createError(i.g.ERROR_OTHER,"accept() - cannot join webconf",re,{fromError:se}))})})},F=function(){return new Promise(function(z,$){a.conversation.joinGroupChat().then(function(){z(a.conversation)}).catch(function(X){$(x.g.createError(i.g.ERROR_OTHER,"accept() - cannot join groupChat",re,{fromError:X}))})})};return new Promise(function(z,$){return a.getStatus()!==i.g.INVITATION_STATUS_STANDBY?$(x.g.createError(i.g.ERROR_WRONG_STATE,"accept() - cannot accept invitation",re)):(a.setStatus(i.g.INVITATION_STATUS_ACCEPTED),a.apiRTCManager.sendData(a.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:a.id,answer:"accept"}),a.invitationData&&a.invitationData.conversationTypes?a.invitationData.conversationTypes.indexOf("WEBCONF")>=0?k().then(z).catch($):a.invitationData.conversationTypes.indexOf("GROUP_CHAT")>=0?F().then(z).catch($):void 0:k().then(z).catch($))})}},{key:"decline",value:function(H){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:H,answer:"decline"}))}},{key:"getConversation",value:function(){return this.conversation}}],Y&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(v);function ne(D){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function ee(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return ce(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?ce(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function ce(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function me(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Te(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function ge(D,_){return(ge=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Ie(D,_){if(_&&("object"===ne(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return we(D)}function we(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Pe(D){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}e(189);var We=R.Y.get("Call"),Je=ie.get(),tt=["streamAdded","streamRemoved","response","accepted","declined","hangup","localStreamAvailable","recordAvailable","statsUpdate","error","disconnectionWarning","userMediaError","desktopCapture","remoteStreamUpdated","recordingStarted","recordingStopped","recordingAvailable"],Ft=new Set(["audioSent","videoSent","audioReceived","videoReceived","quality"]),si=new WeakMap,Pi=new WeakMap,yi=new WeakMap,Ti=new WeakMap,_i=new WeakMap,Zi=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&ge(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Pe(U);if(de){var k=Pe(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Ie(this,a)});function H(a,o){var k,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(me(this,H),k=fe.call(this,We),We.debug("Create Call with id "+a),si.set(we(k),a),Pi.set(we(k),o),k.publishedStreams=new Map,k.receivedStreams=new Map,k.stats={},yi.set(we(k),F.hasOwnProperty("started")&&F.started?i.g.CALL_STATUS_ONGOING:i.g.CALL_STATUS_WAITING_FOR_CALLEE),Ti.set(we(k),!!F.hasOwnProperty("isRecorded")&&F.isRecorded),F.isRecorded){k.confId=null,k.recordingStatus=null;for(var z=Je.webRTCClient.webRTCClient.callsTable.length;--z>=0;){var $=Je.webRTCClient.webRTCClient.callsTable[z];if($.callId===a&&$.data){k.confId=$.data.confId;break}}Ti.set(we(k),!0)}else Ti.set(we(k),!1);var X={hangup:function(Me){k.getId()===Me.detail.callId&&k.destroy()},receiveData:function(Me){void 0!==Me.detail.data.info&&Me.detail.data.info===i.g.INVITATION_ANSWER_IDENTIFIER&&Me.detail.data.invitationId.toString()===k.getId()&&k.getStatus()===i.g.CALL_STATUS_WAITING_FOR_CALLEE&&(We.info("Call answer from "+k.getContact().getUsername()+" for "+k.getId()),"accept"===Me.detail.data.answer?(yi.set(we(k),i.g.CALL_STATUS_ONGOING),he.get(we(k)).emit("accepted"),he.get(we(k)).emit("response","accepted")):(yi.set(we(k),i.g.CALL_STATUS_ENDED),he.get(we(k)).emit("declined",{reason:"User_Refused_Call"}),he.get(we(k)).emit("response","declined")))},remoteStreamUpdated:function(Me){if(k.getId()===Me.detail.callId){var Fe={callId:Me.detail.callId,audio:Me.detail.audioIsAvailable&&Me.detail.audioIsActive,audioMuted:Me.detail.audioIsMuted,audioSilent:Me.detail.audioIsSilent,video:Me.detail.videoIsAvailable&&Me.detail.videoIsActive,videoMuted:Me.detail.videoIsMuted,videoSilent:Me.detail.videoIsSilent};he.get(we(k)).emit("remoteStreamUpdated",Fe)}},MCURecordingStarted:function(Me){if(Ti.get(we(k))&&Me.detail.roomName===k.confId){var Fe=x.g.parseRecordingEvent("MCURecordingStarted",Me.detail);"COMPOSITE"===Fe.callId&&(k.recordingStatus=Fe,he.get(we(k)).emit("recordingStarted",Fe))}},MCURecordingStopped:function(Me){if(Ti.get(we(k))&&Me.detail.roomName===k.confId){var Fe=x.g.parseRecordingEvent("MCURecordingStopped",Me.detail);"COMPOSITE"===Fe.callId&&(delete k.recordingStatus,he.get(we(k)).emit("recordingStopped",Fe))}},MCURecordedStreamsAvailable:function(Me){if(Ti.get(we(k))&&Me.detail.roomName===k.confId){var Fe=x.g.parseRecordingEvent("MCURecordedStreamsAvailable",Me.detail);he.get(we(k)).emit("recordingAvailable",Fe)}}};for(var se in X)Je.onEvent(se,X[se]);return _i.set(we(k),X),k}return _=H,O=[{key:"getAvailableEvents",value:function(){return tt}}],(Y=[{key:"destroy",value:function(){var a=_i.get(this);if(a){for(var o in a)Je.removeEventListener(o,a[o]);_i.delete(this)}}},{key:"getId",value:function(){return si.get(this).toString()}},{key:"isRecorded",value:function(){return Ti.get(this)}},{key:"getContact",value:function(){return Pi.get(this)}},{key:"getStatus",value:function(){return yi.get(this)}},{key:"setStatus",value:function(a){yi.set(this,a)}},{key:"getPublishedStreams",value:function(){var a,o=[],k=ee(this.publishedStreams.values());try{for(k.s();!(a=k.n()).done;)o.push(a.value)}catch(z){k.e(z)}finally{k.f()}return o}},{key:"getReceivedStreams",value:function(){var a,o=[],k=ee(this.receivedStreams.values());try{for(k.s();!(a=k.n()).done;)o.push(a.value)}catch(z){k.e(z)}finally{k.f()}return o}},{key:"hangUp",value:function(){this.getStatus()===i.g.CALL_STATUS_ENDED?We.error("hangUp() - Call has already ended"):Je.webRTCClient.hangUp(this.getId())}},{key:"getStats",value:function(){return x.g.assignObject({},this.stats)}},{key:"stopPublishedStreams",value:function(){return Je.webRTCClient.webRTCClient.stopMedia(this.getId())}},{key:"replacePublishedStreams",value:function(a,o){var k=this,F=function(z){if(Fn.has(z))return Fn.get(z);var $=apiCC.getUserMediaStream(z);if($){var X="audio";return!0===$.video&&(X="video"),new Tn($.stream,{type:X,constructor:!0,userMediaStreamId:$.userMediaStreamId})}return null};return new Promise(function(z,$){if(k.getStatus()!==i.g.CALL_STATUS_ONGOING)return $(new Error("replacePublishedStreams() - Cannot replace stream as call is not ongoing"));if(null===a)if(x.g.isPropertyTypeof(o,"getStream","function")){var X={getUserMediaStreamId:function(){return o.getStream().then(function(se){return se.userMediaStreamId}).catch($)}};Je.webRTCClient.webRTCClient.addMedia(k.getId(),!0,null,X).then(function(se){return z(F(se))}).catch(function(se){return $(new Error("replacePublishedStreams() - "+se))})}else Je.webRTCClient.webRTCClient.addMedia(k.getId(),!0,null,null).then(function(se){return z(F(se))}).catch(function(se){return $(new Error("replacePublishedStreams() - "+se))});else Je.webRTCClient.webRTCClient.addMedia(k.getId(),!0,a.userMediaStreamId).then(function(se){return z(F(se))}).catch(function(se){return $(new Error("replacePublishedStreams() - "+se))})})}},{key:"getRecordingInfo",value:function(){return Ti.get(this)?this.recordingStatus:null}},{key:"startRecording",value:function(){var a=this;return new Promise(function(o,k){if(a.asyncCallbacks)return k(x.g.createError(i.g.ERROR_OTHER,"startRecording() - busy",We));a.asyncCallbacks={},a.asyncCallbacks.timeoutId=setTimeout(function(){return a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"startRecording() - timeout",We))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),a.asyncCallbacks.error=function(F){if(a.confId===F.detail.roomName&&"COMPOSITE"===F.detail.callId&&F.detail.errorCode.indexOf("START_RECORD")>=0)return a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"startRecording() - "+F.detail.errorInfo,We))},a.asyncCallbacks.recordingStarted=function(F){if(a.confId===F.detail.roomName&&"COMPOSITE"===F.detail.callId){a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks);var z=x.g.parseRecordingEvent("MCURecordingStarted",F.detail);return o(z)}},Je.onEvent("error",a.asyncCallbacks.error),Je.onEvent("MCURecordingStarted",a.asyncCallbacks.recordingStarted),Je.webRTCClient.startCallRecording(si.get(a))})}},{key:"stopRecording",value:function(){var a=this;return new Promise(function(o,k){if(a.asyncCallbacks)return k(x.g.createError(i.g.ERROR_OTHER,"stopRecording() - busy",We));a.asyncCallbacks={},a.asyncCallbacks.timeoutId=setTimeout(function(){return a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"stopRecording() - timeout",We))},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),a.asyncCallbacks.error=function(F){if(a.confId===F.detail.roomName&&"COMPOSITE"===F.detail.callId&&F.detail.errorCode.indexOf("STOP_RECORD")>=0)return a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"stopRecording() - "+F.detail.errorInfo,We))},a.asyncCallbacks.recordingStopped=function(F){if(a.confId===F.detail.roomName&&"COMPOSITE"===F.detail.callId){a.asyncCallbacks&&(Je.removeEventListener("error",a.asyncCallbacks.error),Je.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks);var z=x.g.parseRecordingEvent("MCURecordingStopped",F.detail);return o(z)}},Je.onEvent("error",a.asyncCallbacks.error),Je.onEvent("MCURecordingStopped",a.asyncCallbacks.recordingStopped),Je.webRTCClient.stopCallRecording(si.get(a))})}},{key:"manageCallEstablishedEvent",value:function(a){We.debug("callEstablished",a.detail,this.getId());var o=a.detail.callId.toString();this.getId()===o&&(We.info("callEstablished from "+this.getContact().getUsername(),a),this.getStatus()!==i.g.CALL_STATUS_ONGOING&&this.getStatus()!==i.g.CALL_STATUS_ENDED&&(he.get(this).emit("accepted"),he.get(this).emit("response","accepted"),yi.set(this,i.g.CALL_STATUS_ONGOING)))}},{key:"manageRemoteStreamAddedEvent",value:function(a){We.debug("remoteStreamAdded",a.detail,this.getId());var o=a.detail.callId.toString();if(this.getId()===o){var z=new Tn(a.detail.stream,{screensharing:"screenSharing"===a.detail.callType,type:"audio"===a.detail.destCallType?"audio":"video",contact:this.getContact(),streamId:a.detail.stream.id,callId:a.detail.callId,callAudioAvailable:a.detail.audioIsAvailable,callAudioActive:a.detail.audioIsActive,callAudioMuted:a.detail.audioIsMuted,callVideoAvailable:a.detail.videoIsAvailable,callVideoActive:a.detail.videoIsActive,callVideoMuted:a.detail.videoIsMuted,constructor:!0});this.receivedStreams.set(a.detail.stream.id,z),he.get(this).emit("streamAdded",z)}}},{key:"manageRemoteStreamRemovedEvent",value:function(a){We.debug("remoteStreamRemoved",a.detail,this.getId());var o=a.detail.callId.toString();if(this.getId()===o){var k=this.receivedStreams.get(a.detail.stream.id);this.receivedStreams.delete(a.detail.stream.id),he.get(this).emit("streamRemoved",k)}}},{key:"manageUserMediaSuccessEvent",value:function(a){We.debug("UserMediaSuccess",a.detail,this.getId());var o,k=null;if(o=!0===a.detail.videoIsAvailable?"video":"audio",null!==a.detail.callId&&(k=a.detail.callId.toString()),this.getId()===k){We.info("localStreamAvailable",a.detail);var F=Fn.get(a.detail.userMediaStreamId);F||(F=new Tn(a.detail.stream,{type:o,constructor:!0,userMediaStreamId:a.detail.userMediaStreamId})),this.publishedStreams.set(x.g.guid(),F),he.get(this).emit("localStreamAvailable",F)}}},{key:"manageCallStatsUpdateEvent",value:function(a){if(this.getId()===a.detail.callId){for(var o=0,k=Object.keys(a.detail.stats);o<k.length;o++){var F=k[o];Ft.has(F)&&(this.stats[F]=a.detail.stats[F])}he.get(this).emit("statsUpdate",x.g.assignObject({},{stats:this.stats}))}}},{key:"manageErrorEvent",value:function(a){if(We.debug("Error",a.detail,this.getId()),this.getId()===a.detail.callId){var o={errorCode:a.detail.errorCode,errorInfo:a.detail.errorInfo};a.detail.data&&(o.descriptor=a.detail.data),he.get(this).emit("error",o)}}},{key:"manageDisconnectionWarningEvent",value:function(a){We.debug("DisconnectionWarning",a.detail,this.getId()),this.getId()===a.detail.callId&&he.get(this).emit("disconnectionWarning",{tries:a.detail.tries})}},{key:"manageHangupEvent",value:function(a){We.debug("hangup",a.detail,this.getId());var o=a.detail.callId.toString(),k=this.getStatus()===i.g.CALL_STATUS_WAITING_FOR_CALLEE&&"remote"===a.detail.hangupType;if(this.getId()===o&&this.getStatus()!==i.g.CALL_STATUS_ENDED){yi.set(this,i.g.CALL_STATUS_ENDED),We.info("Hangup from "+this.getContact().getUsername(),a);var F,z=ee(this.receivedStreams.keys());try{for(z.s();!(F=z.n()).done;){var $=F.value,X=this.receivedStreams.get($);this.receivedStreams.delete($),he.get(this).emit("streamRemoved",X)}}catch(se){z.e(se)}finally{z.f()}he.get(this).emit("hangup",{from:a.detail.hangupType,reason:a.detail.reason}),k&&(he.get(this).emit("declined",{reason:a.detail.reason}),he.get(this).emit("response","declined"))}}},{key:"manageRecordAvailableEvent",value:function(a){We.warn("recordedStreamsAvailable",a.detail,this.getId()),he.get(this).emit("recordAvailable",{mediaURL:a.detail.mediaURL})}},{key:"manageUserMediaErrorEvent",value:function(a){We.warn("userMediaError",a.detail,this.getId()),he.get(this).emit("userMediaError",{callType:a.detail.callType,error:a.detail.error,onCallEstablishment:a.detail.onCallEstablishment,userMediaStreamId:a.detail.userMediaStreamId,tryAudioCallActivated:a.detail.tryAudioCallActivated})}},{key:"manageDesktopCaptureEvent",value:function(a){We.warn("desktopCapture",a.detail,this.getId()),he.get(this).emit("desktopCapture",{event:a.detail.event})}}])&&Te(_.prototype,Y),O&&Te(_,O),H}(ke);function ki(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function $t(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}var ni=R.Y.get("ConversationCatalog"),ai=null,Ci=function(){function D(){if(function(U,de){if(!(U instanceof de))throw new TypeError("Cannot call a class as a function")}(this,D),null!==ai)throw"Cannot construct singleton CallCatalog";this.callList=new Map,ai=this}var _,Y,O;return _=D,O=[{key:"get",value:function(){return null===ai&&(ai=new D),ai}}],(Y=[{key:"getOrCreateCall",value:function(U,de,fe){var H=null;return null!=U&&(this.callList.has(U.toString())?H=this.callList.get(U.toString()):(H=new Zi(U.toString(),de,fe),this.callList.set(U.toString(),H))),H}},{key:"getCall",value:function(U,de){var fe=null;if(null!=U){if(!this.callList.has(U.toString()))return null;fe=this.callList.get(U.toString())}else if(de){var H,a=function(F,z){var $="undefined"!=typeof Symbol&&F[Symbol.iterator]||F["@@iterator"];if(!$){if(Array.isArray(F)||($=function(ht,Dt){if(ht){if("string"==typeof ht)return ki(ht,void 0);var Ut=Object.prototype.toString.call(ht).slice(8,-1);return"Object"===Ut&&ht.constructor&&(Ut=ht.constructor.name),"Map"===Ut||"Set"===Ut?Array.from(ht):"Arguments"===Ut||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ut)?ki(ht,void 0):void 0}}(F))){$&&(F=$);var X=0,se=function(){};return{s:se,n:function(){return X>=F.length?{done:!0}:{done:!1,value:F[X++]}},e:function(ht){throw ht},f:se}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Me,Fe=!0,bt=!1;return{s:function(){$=$.call(F)},n:function(){var ht=$.next();return Fe=ht.done,ht},e:function(ht){bt=!0,Me=ht},f:function(){try{Fe||null==$.return||$.return()}finally{if(bt)throw Me}}}}(this.callList.values());try{for(a.s();!(H=a.n()).done;){var o=H.value,k=o.getContact();if(k&&k.getId()===de.getId()){fe=o;break}}}catch(F){a.e(F)}finally{a.f()}}return fe}},{key:"removeCallFromList",value:function(U){ni.log("removeCallFromList : av instance.callList :",ai.callList),ai.callList.has(U)&&ai.callList.delete(U),ni.log("removeCallFromList : ap instance.callList :",ai.callList)}},{key:"getCalls",value:function(){return this.callList}}])&&$t(_.prototype,Y),O&&$t(_,O),D}();function Ii(D){return(Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function wi(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Ei(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Ai(D,_){return(Ai=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Vi(D,_){if(_&&("object"===Ii(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return cn(D)}function cn(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Hi(D){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Ji=R.Y.get("ReceivedInvitation"),un=Ci.get(),hn=["expired","statusChange"],Di=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Ai(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Hi(U);if(de){var k=Hi(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Vi(this,a)});function H(a,o,k){var F,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return wi(this,H),F=fe.call(this,a,o),Ji.info("Create ReceivedCallInvitation with call type "+k),F.type="call",F.callType=k,F.isRecordedCall=!!z.hasOwnProperty("isRecorded")&&z.isRecorded,F.call=un.getOrCreateCall(F.id,F.sender,{isRecorded:F.isRecorded()}),F.apiRTCManager.onEvent("hangup",function($){var X=$.detail.callId.toString();F.id.toString()===X&&F.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(F.setStatus(i.g.INVITATION_STATUS_EXPIRED),he.get(cn(F)).emit("expired"))}),F}return _=H,Y=[{key:"getCallType",value:function(){return this.callType}},{key:"isRecorded",value:function(){return this.isRecordedCall}},{key:"accept",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(F,z){var $="audio"===o.getCallType(),X=!0,se=k;k.hasOwnProperty("audioOnly")&&($=k.audioOnly,delete k.audioOnly,null!=se.mediaTypeForIncomingCall||!0===k.audioOnly&&(se.mediaTypeForIncomingCall="AUDIO")),k.hasOwnProperty("noStream")&&(se.mediaTypeForIncomingCall="NONE",X=!1),"NONE"===se.mediaTypeForIncomingCall&&(X=!1),o.getStatus()===i.g.INVITATION_STATUS_STANDBY?(o.setStatus(i.g.INVITATION_STATUS_ACCEPTED),o.apiRTCManager.sendData(o.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:o.id,answer:"accept"}),o.call.setStatus(i.g.CALL_STATUS_ONGOING),X&&null!==a&&a instanceof Tn&&(Ji.debug("accept() - A stream was preselected; audio only : ",$),se.userMediaStreamId=a.userMediaStreamId),o.apiRTCManager.webRTCClient.acceptCall(o.id,se),F(o.call)):z(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this call, invitation state invalid",Ji))})}},{key:"decline",value:function(a){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:a,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}},{key:"getCall",value:function(){return this.call}}],O=[{key:"getAvailableEvents",value:function(){return hn}}],Y&&Ei(_.prototype,Y),O&&Ei(_,O),H}(v);function en(D){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function In(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Yi(D,_){return(Yi=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function xn(D,_){if(_&&("object"===en(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function Nn(D){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Ki=R.Y.get("ReceivedInvitation"),Xn=["error","progress","statusChange"],Rn=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Yi(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Nn(U);if(de){var k=Nn(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return xn(this,a)});function H(a,o,k){var F;return function(z,$){if(!(z instanceof $))throw new TypeError("Cannot call a class as a function")}(this,H),F=fe.call(this,a,o),Ki.debug("Create ReceivedFileTransferInvitation"),F.type="sendFile",F.fileInfo=k,F.apiRTCManager.onEvent("hangup",function(z){Ki.debug("hangup");var $=z.detail.callId.toString();F.getId()===$&&(Ki.debug("hangup for ReceivedFileTransferInvitation"),F.getStatus()===i.g.INVITATION_STATUS_ENDED?Ki.debug("invitation ended"):(Ki.debug("invitation is cancelled"),F.setStatus(i.g.INVITATION_STATUS_CANCELLED)),apiRTC.userAgentInstance.currentSession.invitationsMap.has(z.detail.remoteId+"-sendfile-"+$)&&apiRTC.userAgentInstance.currentSession.invitationsMap.delete(z.detail.remoteId+"-sendfile-"+$))}),F}return _=H,O=[{key:"getAvailableEvents",value:function(){return Xn}}],(Y=[{key:"accept",value:function(){var a=this;return new Promise(function(o,k){if(a.getStatus()!==i.g.INVITATION_STATUS_STANDBY)k(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this file transfer session, invitation state invalid",Ki));else{a.setStatus(i.g.INVITATION_STATUS_ACCEPTED),a.apiRTCManager.sendData(a.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:a.id,answer:"accept"});var F=a;a.apiRTCManager.onEvent("onFileReceived",function z($){if($.detail.callId.toString()===F.id.toString()){if(Ki.debug("typeof(e.detail.data.file) :",en($.detail.data.file)),"string"==typeof $.detail.data.file)o({file:$.detail.data.file,name:$.detail.data.name,type:$.detail.data.type});else{var X=new FileReader;X.addEventListener("loadend",function(){a.setStatus(i.g.INVITATION_STATUS_ENDED),a.apiRTCManager.webRTCClient.hangUp(F.id.toString());try{Ki.info("accept() - file received from "+F.sender.getUsername()+" !"),o({file:$.detail.data.file,name:$.detail.data.name,type:$.detail.data.type})}catch(se){Ki.error("File Error",se),k(x.g.createError(i.g.ERROR_OTHER,"accept() - Could not read file received",Ki))}}),X.readAsArrayBuffer($.detail.data.file)}a.apiRTCManager.removeEventListener("onFileReceived",z)}}),a.apiRTCManager.onEvent("onFileProgress",function(z){z.detail.callId.toString()===F.id.toString()&&(Ki.trace("file transfering",z.detail),he.get(F).emit("progress",{uuid:z.detail.uuid,fileSize:z.detail.fileSize,remainingSize:z.detail.remainingSize,percentage:z.detail.percentage,sendChunkNb:z.detail.sendChunkNb,transferDuration:z.detail.transferDuration,lastPacket:z.detail.lastPacket}))}),a.apiRTCManager.onEvent("receiveDataChannelError",function(z){z.detail.callId.toString()===F.id.toString()&&(Ki.warn("receiveDataChannelError",z.detail),he.get(F).emit("error","receiveDataChannelError"))}),a.apiRTCManager.webRTCClient.acceptCall(a.id,{mediaTypeForIncomingCall:"DATA"})}})}},{key:"getFileInfo",value:function(){return this.fileInfo}},{key:"decline",value:function(a){Ki.log("decline"),this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:a,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}}])&&In(_.prototype,Y),O&&In(_,O),H}(v);function Fi(D){return(Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function ta(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Oe(D,_){return(Oe=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function ct(D,_){if(_&&("object"===Fi(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function It(D){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var rt=R.Y.get("ReceivedInvitation"),Bt=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&Oe(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=It(O);if(U){var o=It(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return ct(this,H)});function fe(H,a){var o,k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return ta(this,fe),o=de.call(this,H,a),rt.info("Create ReceivedWhiteboardInvitation"),o.type="whiteboard",k.cloudConvId&&(o.cloudConvId=k.cloudConvId),!0===k.webconf&&(o.webconf=!0),o}return(Y=[{key:"accept",value:function(){var H=this;return new Promise(function(a,o){if(H.getStatus()===i.g.INVITATION_STATUS_STANDBY){H.setStatus(i.g.INVITATION_STATUS_ACCEPTED),H.apiRTCManager.sendData(H.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:"wb-"+H.id,answer:"accept"}),H.apiRTCManager.whiteBoardClient.leaveRoom(),H.apiRTCManager.whiteBoardClient.start();var k={};H.cloudConvId&&(k.convId=H.cloudConvId),!0===H.webconf&&(k.webconf=!0),H.apiRTCManager.whiteBoardClient.joinRoom(H.id,k),a(H.id)}else o(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this whiteboard session, invitation state invalid",rt))})}},{key:"decline",value:function(H){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:"wb-"+this.id,reason:H,answer:"decline"}))}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(v);function lt(D){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function vi(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function pi(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function ri(D,_){return(ri=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function wt(D,_){if(_&&("object"===lt(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return jt(D)}function jt(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Vt(D){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var fi=R.Y.get("DataChannel"),qn=ie.get(),ia=["response","accepted","declined","error","opened","closed","error","transferProgress","transferComplete","dataReceived","ended"],na=new WeakMap,ca=new WeakMap,Pn=new WeakMap,Hn=new WeakMap,Kn=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&ri(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Vt(U);if(de){var k=Vt(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return wt(this,a)});function H(a,o){var k,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return vi(this,H),k=fe.call(this,fi),fi.debug("Create DataChannel with id "+a),na.set(jt(k),a),ca.set(jt(k),o),Hn.set(jt(k),i.g.DATACHANNEL_TYPE_RECEIVE),F.hasOwnProperty("type")&&(F.type===i.g.DATACHANNEL_TYPE_RECEIVE?Hn.set(jt(k),i.g.DATACHANNEL_TYPE_RECEIVE):F.type===i.g.DATACHANNEL_TYPE_SEND&&Hn.set(jt(k),i.g.DATACHANNEL_TYPE_SEND)),Pn.set(jt(k),i.g.DATACHANNEL_STATUS_WAITING),qn.onEvent("receiveData",function(z){void 0!==z.detail.data.info&&z.detail.data.info===i.g.INVITATION_ANSWER_IDENTIFIER&&z.detail.data.invitationId.toString()===k.getId()&&k.getStatus()===i.g.DATACHANNEL_STATUS_WAITING&&(fi.info("DataChannel answer from "+k.getContact().getUsername()+" for "+k.getId()),"accept"===z.detail.data.answer?he.get(jt(k)).emit("accepted"):(Pn.set(jt(k),i.g.DATACHANNEL_STATUS_ENDED),he.get(jt(k)).emit("declined")),he.get(jt(k)).emit("response"))}).onEvent("callEstablished",function(z){var $=z.detail.callId.toString();k.getId()===$&&(fi.info("callEstablished from "+k.getContact().getUsername(),z),k.getStatus()!==i.g.DATACHANNEL_STATUS_ONGOING&&k.getStatus()!==i.g.DATACHANNEL_STATUS_ENDED&&he.get(jt(k)).emit("accepted"))}).onEvent("hangup",function(z){var $=z.detail.callId.toString(),X=k.getStatus()===i.g.DATACHANNEL_STATUS_WAITING&&"remote"===z.detail.hangupType;k.getId()===$&&k.getStatus()!==i.g.DATACHANNEL_STATUS_ENDED&&(Pn.set(jt(k),i.g.DATACHANNEL_STATUS_ENDED),fi.info("Hangup from "+k.getContact().getUsername(),z),he.get(jt(k)).emit("ended",{from:z.detail.hangupType}),X&&he.get(jt(k)).emit("declined"))}).onEvent("onFileReceived",function(z){if(z.detail.callId.toString()===k.getId()){var $=z.detail.data,X=new FileReader;X.addEventListener("loadend",function(){try{var se=x.g.arrayBuffertoString(X.result);fi.info("dataReceived !"),he.get(jt(k)).emit("dataReceived",{uuid:$.uuid,data:se})}catch(Me){fi.error("dataReceived Error",Me)}}),X.readAsArrayBuffer($.file)}}).onEvent("onFileProgress",function(z){if(z.detail.callId.toString()===k.getId()){var $=z.detail;fi.trace("file transfering",$);var X={uuid:$.uuid,fileSize:$.fileSize,remainingSize:$.remainingSize,percentage:$.percentage,sendChunkNb:$.sendChunkNb,transferDuration:$.transferDuration,lastPacket:$.lastPacket};he.get(jt(k)).emit("transferProgress",X),$.transferEnded&&he.get(jt(k)).emit("transferComplete",X)}}).onEvent("receiveDataChannelError",function(z){var $=z.detail.callId.toString();k.getId()===$&&he.get(jt(k)).emit("error","receiveDataChannelError")}).onEvent("sendDataChannelError",function(z){var $=z.detail.callId.toString();k.getId()===$&&he.get(jt(k)).emit("error","sendDataChannelError")}).onEvent("receiveDataChannelClose",function(z){var $=z.detail.callId.toString();k.getId()===$&&he.get(jt(k)).emit("closed")}).onEvent("sendDataChannelClose",function(z){var $=z.detail.callId.toString();k.getId()===$&&he.get(jt(k)).emit("closed")}).onEvent("receiveDataChannelOpen",function(z){var $=z.detail.callId.toString();k.getId()===$&&(Pn.set(jt(k),i.g.DATACHANNEL_STATUS_ONGOING),he.get(jt(k)).emit("opened"))}).onEvent("sendDataChannelOpen",function(z){var $=z.detail.callId.toString();k.getId()===$&&he.get(jt(k)).emit("opened")}),k}return _=H,O=[{key:"getAvailableEvents",value:function(){return ia}}],(Y=[{key:"getId",value:function(){return na.get(this).toString()}},{key:"getContact",value:function(){return ca.get(this)}},{key:"getType",value:function(){return Hn.get(this)}},{key:"getStatus",value:function(){return Pn.get(this)}},{key:"sendData",value:function(a){var o=this;return new Promise(function(k,F){var z=!1;o.getStatus()!==i.g.DATACHANNEL_STATUS_ONGOING?F(x.g.createError(i.g.ERROR_OTHER,"Cannot send data as datachannel session is not ongoing",fi)):o.getType()!==i.g.DATACHANNEL_TYPE_SEND?F(x.g.createError(i.g.ERROR_OTHER,"Cannot send data as datachannel session is receiving only",fi)):qn.webRTCClient.sendDataWithCallId(o.getId(),{file:a},function($){z||(z=!0,k($.uuid)),fi.trace("sendData() - progress : ",$);var X={uuid:$.uuid,fileSize:$.fileSize,remainingSize:$.remainingSize,percentage:$.percentage,sendChunkNb:$.sendChunkNb,transferDuration:$.transferDuration,lastPacket:$.lastPacket};he.get(o).emit("transferProgress",X),$.transferEnded&&he.get(o).emit("transferComplete",X)})})}},{key:"close",value:function(){this.getStatus()===i.g.DATACHANNEL_STATUS_ENDED?fi.error("close() - DataChannel session has already ended"):qn.webRTCClient.hangUp(this.getId())}}])&&pi(_.prototype,Y),O&&pi(_,O),H}(ke);function Qn(D){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function aa(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function ua(D,_){return(ua=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Ea(D,_){if(_&&("object"===Qn(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return ma(D)}function ma(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function $n(D){return($n=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var ra=R.Y.get("ReceivedInvitation"),ga=["expired","statusChange"],mn=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&ua(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=$n(U);if(de){var k=$n(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Ea(this,a)});function H(a,o){var k;return function(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}(this,H),k=fe.call(this,a,o),ra.info("Create ReceivedDataChannelInvitation "),k.type="dataChannel",k.apiRTCManager.onEvent("hangup",function(F){var z=F.detail.callId.toString();k.id.toString()===z&&k.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(k.setStatus(i.g.INVITATION_STATUS_EXPIRED),he.get(ma(k)).emit("expired"))}),k}return _=H,O=[{key:"getAvailableEvents",value:function(){return ga}}],(Y=[{key:"accept",value:function(){var a=this;return new Promise(function(o,k){if(a.getStatus()===i.g.INVITATION_STATUS_STANDBY){a.setStatus(i.g.INVITATION_STATUS_ACCEPTED),a.apiRTCManager.sendData(a.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:a.id,answer:"accept"});var F=new Kn(a.id,a.sender,{started:!0,type:i.g.DATACHANNEL_TYPE_SEND});a.apiRTCManager.webRTCClient.acceptCall(a.id,{mediaTypeForIncomingCall:"DATA"}),o(F)}else k(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot join this datachannel session, invitation state invalid",ra))})}},{key:"decline",value:function(a){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(this.setStatus(i.g.INVITATION_STATUS_DECLINED),this.apiRTCManager.sendData(this.sender.getId(),{event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:this.id,reason:a,answer:"decline"}),this.apiRTCManager.webRTCClient.refuseCall(this.id))}}])&&aa(_.prototype,Y),O&&aa(_,O),H}(v);function va(D){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function ya(D,_){return(ya=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Jn(D,_){if(_&&("object"===va(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function oa(D){return(oa=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var ha=R.Y.get("ReceivedInvitation"),Yn=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&ya(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=oa(O);if(U){var o=oa(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return Jn(this,H)});function fe(H,a,o){var k;return function(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}(this,fe),k=de.call(this,H,o),ha.info("Create ReceivedConversationJoinRequest"),k.type="conversationJoinRequest",k.conversation=a||null,k}return(Y=[{key:"getConversation",value:function(){return this.conversation}},{key:"accept",value:function(){var H=this;return new Promise(function(a,o){H.getStatus()===i.g.INVITATION_STATUS_STANDBY?(H.setStatus(i.g.INVITATION_STATUS_ACCEPTED),H.conversation?H.conversation.allowEntry(H.sender,{invitationId:H.id,answer:"accept",ackEnabled:!0}).then(a).catch(o):(H.apiRTCManager.sendData(H.sender.getId(),{roomname:H.id,event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:H.id,answer:"accept",command:"access",value:{access:!0}}),a())):o(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - Cannot accept request, invitation state invalid",ha))})}},{key:"decline",value:function(H){var a=this;return new Promise(function(o,k){a.getStatus()===i.g.INVITATION_STATUS_STANDBY?(a.setStatus(i.g.INVITATION_STATUS_DECLINED),a.conversation?a.conversation.denyEntry(a.sender,{invitationId:a.id,answer:"decline",reason:H}).then(o).catch(k):(a.apiRTCManager.sendData(a.sender.getId(),{roomname:a.id,event:i.g.INVITATION_ANSWER_IDENTIFIER,invitationId:a.id,reason:H,answer:"decline",command:"access",value:{access:!1}}),o())):k(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"decline() - Cannot decline request, invitation state invalid",ha))})}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(v);function zn(D){return(zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Ca(D,_){return(Ca=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function p(D,_){if(_&&("object"===zn(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function N(D){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var B=R.Y.get("ReceivedInvitation"),Q=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&Ca(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=N(O);if(U){var o=N(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return p(this,H)});function fe(H,a,o){var k;return function(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}(this,fe),(k=de.call(this,H,a)).session=o,k.type="pointerSharing",k}return(Y=[{key:"accept",value:function(){var H=this;return new Promise(function(a,o){H.getStatus()===i.g.INVITATION_STATUS_STANDBY?(H.setStatus(i.g.INVITATION_STATUS_ACCEPTED),H.session.joinPointerSharingRoom(H.id).then(a).catch(function(k){o(x.g.createError(i.g.ERROR_OTHER,"accept() - cannot accept invitation",B))})):o(x.g.createError(i.g.ERROR_INVITATION_STATE_INVALID,"accept() - cannot accept invitation",B))})}},{key:"decline",value:function(H){this.getStatus()===i.g.INVITATION_STATUS_STANDBY&&this.setStatus(i.g.INVITATION_STATUS_DECLINED)}}])&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(v),pe=e(8364);function ve(D){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function be(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Ue(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}e(4723),e(4812),e(9601);var xe=R.Y.get("UserData"),qe=ie.get(),Ke=function(){function D(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var de in be(this,D),U)U.hasOwnProperty(de)&&(this[de]=U[de])}var _,Y,O;return _=D,O=[{key:"equals",value:function(U,de){if(!(U instanceof Object&&de instanceof Object))return!1;for(var fe in U)if(void 0===de[fe]||"object"===ve(de[fe])&&!this.equals(de[fe],U[fe])||de[fe]!==U[fe])return!1;for(var H in de)if(void 0===U[H]||"object"===ve(U[H])&&!this.equals(U[H],de[H])||U[H]!==de[H])return!1;return!0}}],(Y=[{key:"get",value:function(U){return this.hasOwnProperty(U)&&void 0!==this[U]&&"null"!==this[U]&&null!==this[U]?this[U]:null}},{key:"setToSession",value:function(){try{var U={};for(var de in this)this.hasOwnProperty(de)&&"function"!=typeof this[de]&&(U[de]=this[de]);qe.apiRTCSession.setUserData(U)}catch(fe){xe.error("setUserData() - could not set userData")}}},{key:"setProp",value:function(U,de){return this[U]=de,this}},{key:"setProps",value:function(U){for(var de in U)U.hasOwnProperty(de)&&(this[de]=U[de]);return this}}])&&Ue(_.prototype,Y),O&&Ue(_,O),D}();function pt(D){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Qe(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function $e(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Ae(D,_){return(Ae=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function W(D,_){if(_&&("object"===pt(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return oe(D)}function oe(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function De(D){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Be=R.Y.get("SentInvitation"),it=["response","receive","statusChange"],ft=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Ae(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=De(U);if(de){var k=De(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return W(this,a)});function H(a,o){var k,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Qe(this,H),(k=fe.call(this)).conversation=o,Be.info("Create SentInvitation"),k.destination=a,k.id=x.g.guid(),k.sendTime=Date.now(),k.expirationTime=null,k.expirationTimeout=null,F.hasOwnProperty("expirationTime")&&(k.expirationTime=F.expirationTime,k.expirationTimeout=setTimeout(function(){k.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(Be.info("Conversation invitation expired"),k.setStatus(i.g.INVITATION_STATUS_EXPIRED),he.get(oe(k)).emit("response",k.getStatus()))},F.expirationTime)),F.hasOwnProperty("receiveNotifier")&&F.receiveNotifier.on("receive",function(){he.get(oe(k)).emit("receive")}),k.apiRTCManager.onEvent("receiveData",function(z){void 0!==z.detail.data.event&&z.detail.data.event===i.g.INVITATION_ANSWER_IDENTIFIER&&z.detail.data.invitationId.toString()===k.id.toString()&&k.getStatus()===i.g.INVITATION_STATUS_STANDBY&&(Be.info("Received invitation answer for "+k.id,z.detail.data),null!==k.expirationTimeout&&clearTimeout(k.expirationTimeout),k.setStatus("accept"===z.detail.data.answer?i.g.INVITATION_STATUS_ACCEPTED:i.g.INVITATION_STATUS_DECLINED),he.get(oe(k)).emit("response",k.getStatus()))}),k.apiRTCManager.onEvent("hangup",function(z){Be.debug("hangup");var $=z.detail.callId.toString();k.getId()===$&&(Be.debug("hangup for sentInvitation"),k.setStatus(i.g.INVITATION_STATUS_ENDED))}),k}return _=H,O=[{key:"getAvailableEvents",value:function(){return it}}],(Y=[{key:"getId",value:function(){return this.id}},{key:"onResponse",value:function(a){this.on("response",a)}},{key:"cancel",value:function(){Be.info("cancel"),"sendFile"===this.type?(Be.info("cancel sendfile"),this.apiRTCManager.webRTCClient.hangUp(this.id)):Be.warn("cancel is not managed for invitation with type :",this.type)}}])&&$e(_.prototype,Y),O&&$e(_,O),H}(zt);function Tt(D){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Qt(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Ht(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Ht(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Ht(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function ti(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function li(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Li(D,_){return(Li=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Si(D,_){if(_&&("object"===Tt(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return ei(D)}function ei(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function xi(D){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var vt=R.Y.get("Contact"),di=ie.get(),Wi=new pe.Z,bi=Ci.get(),pn=["message","conversationInvitation","data","joinGroup","leaveGroup","whiteboardInvitation","fileSentSuccessfully","fileTransferInvitation","fileTransferProgress","dataChannelInvitation","incomingCall","newMediaAvailable","customEvent","fileTransferError","incomingScreenSharingCall","incomingScreenSharingCallInvitation"],gn=new WeakMap,Wn=new WeakMap,Zt=new Map,ci=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Li(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=xi(U);if(de){var k=xi(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Si(this,a)});function H(a){var o,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ti(this,H),o=fe.call(this,vt),vt.debug("Create Contact with id "+a),vt.debug("Create Contact with userData :",k),Wn.set(ei(o),a.toString()),o.groups=[],o.previousMessages=[],o.userData=new Ke(k),o.enterprise=null,o.streams=new Map,o.profile=null,o.fileTransfers=[],o.promises=[],gn.set(ei(o),[]),di.onEvent("roomInvitation",function(F){if(null!=F.detail.senderId&&"whiteBoard"===F.detail.roomType&&F.detail.senderId.toString()===o.getId()){vt.info("Received whiteboard invitation from "+o.getUsername());var z={};F.detail.cloudConvId&&(z.cloudConvId=F.detail.cloudConvId),!0===F.detail.webconf&&(z.webconf=!0),he.get(ei(o)).emit("whiteboardInvitation",new Bt(ei(o),F.detail.roomId,z))}}).onEvent("receiveIMMessage",function(F){F.detail.senderId.toString()===o.getId()&&(he.get(ei(o)).emit("message",{content:F.detail.message,uuid:F.detail.UUCSeq,time:F.detail.time}),o.addMessageToHistory(F.detail.message,Math.round(F.detail.time.getTime()/1e3),F.detail.UUCSeq,!0))}).onEvent("receiveData",function(F){if(F.detail.senderId.toString()===o.getId()){vt.debug("Received data e.detail.data : ",F.detail.data);var z=F.detail.data,$=null,X=Dn.get();if(void 0!==z.roomname&&($=X.isConference(z.roomname)?X.getOrCreateConference(X.getNameFromTechnicalName(z.roomname)):X.getOrCreateConversation(X.getNameFromTechnicalName(z.roomname))),void 0!==z.event)switch(z.event){case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:case i.g.INVITATION_ANSWER_IDENTIFIER:break;case i.g.CONTACT_SEND_DATA_IDENTIFIER:vt.trace("Received data from "+o.getUsername(),z.content),he.get(ei(o)).emit("data",z.content);break;case i.g.CONVERSATION_INVITATION_IDENTIFIER:if(null!==$){vt.debug("Received conversation invitation from "+o.getId());var se={};z.hasOwnProperty("password")&&(se.password=z.password),he.get(ei(o)).emit("conversationInvitation",new L(ei(o),z,$,se))}break;case i.g.CONTACT_SEND_FILEINFO_IDENTIFIER:vt.debug("Received file info from "+o.getUsername(),z.fileInfo);var Me=z.callId.toString();if(x.g._private.dataCallsFileInfo.set(Me,z.fileInfo),x.g._private.dataCallsOnHold.has(Me)){var Fe=null;apiRTC.userAgentInstance.currentSession.invitationsMap.has(o.getId()+"-sendfile-"+Me)?(Fe=apiRTC.userAgentInstance.currentSession.invitationsMap.get(o.getId()+"-sendfile-"+Me),vt.debug("invitation already exist :",Fe)):(Fe=new Rn(ei(o),Me,z.fileInfo),apiRTC.userAgentInstance.currentSession.invitationsMap.set(o.getId()+"-sendfile-"+Me,Fe)),he.get(ei(o)).emit("fileTransferInvitation",Fe)}break;case i.g.CONTACT_DATACHANNEL_INVITATION:vt.debug("Received datachannel invitation from "+o.getUsername()),x.g._private.dataChannelInvitations.set(z.callId.toString(),!0),x.g._private.dataCallsOnHold.has(z.callId.toString())&&he.get(ei(o)).emit("dataChannelInvitation",new mn(ei(o),z.callId.toString()));break;case i.g.CONTACT_NEW_MEDIA_IDENTIFIER:vt.debug("New media available from "+o.getUsername(),z.fileinfo),he.get(ei(o)).emit("newMediaAvailable",{media:z.media});break;case i.g.CONTACT_EVENTCENTER_DATA_REQUEST:vt.debug("New request for event center data from "+o.getUsername());var bt=apiRTC.eventCenter.getStoredData();if(void 0===bt)return void vt.error("Can't send event center stored data, it's undefined");vt.debug("Sending requested event center data"),o.sendCustomEvent(i.g.CONTACT_EVENTCENTER_DATA_ANSWER,{data:bt});break;case i.g.CONTACT_EVENTCENTER_DATA_ANSWER:if(vt.debug("New event center data from "+o.getUsername()),void 0===z.data)return void vt.error("Can't handle remote event center data, it's undefined");apiRTC.eventCenter.handleDataAnswer(z.data);break;case i.g.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_IDENTIFIER:vt.debug("New getAudioFlowStatus from "+z.requesterId+" on stream "+z.streamId);var ht=o.getContact(z.requesterId),Dt=o.getLocalStreamPublished();if(null===Dt)return o.sendToContactRemoteStreamError("No stream found on remote",ht,z);ht.sendCustomEvent(i.g.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout,audioFlowStatus:Dt.getAudioFlowStatus()});break;case i.g.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_IDENTIFIER:vt.debug("New getVideoFlowStatus from "+z.requesterId+" on stream "+z.streamId);var Ut=o.getContact(z.requesterId),gi=o.getLocalStreamPublished();if(null===gi)return o.sendToContactRemoteStreamError("No stream found on remote",Ut,z);Ut.sendCustomEvent(i.g.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout,videoFlowStatus:gi.getVideoFlowStatus()});break;case i.g.CONTACT_GET_SETTINGS_IDENTIFIER:vt.debug("New getSettings from "+z.requesterId);var dn=o.getContact(z.requesterId),bn=o.getLocalStreamPublished();if(null===bn)return o.sendToContactRemoteStreamError("No stream found on remote",dn,z);bn.getSettings().then(function(Gn){dn.sendCustomEvent(i.g.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout,settings:Gn})}).catch(function(Gn){o.sendToContactRemoteStreamError(Gn.message,dn,z)});break;case i.g.CONTACT_GET_CAPABILITIES_IDENTIFIER:vt.debug("New getCapabilities from "+z.requesterId);var Wa=o.getContact(z.requesterId),ja=o.getLocalStreamPublished();if(null===ja)return o.sendToContactRemoteStreamError("No stream found on remote",Wa,z);ja.getCapabilities().then(function(Gn){Wa.sendCustomEvent(i.g.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout,capabilities:Gn})}).catch(function(Gn){o.sendToContactRemoteStreamError(Gn.message,Wa,z)});break;case i.g.CONTACT_GET_CONSTRAINTS_IDENTIFIER:vt.debug("New getConstraints from "+z.requesterId);var Ln=o.getContact(z.requesterId),$a=o.getLocalStreamPublished();if(null===$a)return o.sendToContactRemoteStreamError("No stream found on remote",Ln,z);$a.getConstraints().then(function(Gn){Ln.sendCustomEvent(i.g.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout,constraints:Gn})}).catch(function(Gn){o.sendToContactRemoteStreamError(Gn.message,Ln,z)});break;case i.g.CONTACT_APPLY_CONSTRAINTS_IDENTIFIER:var Mr=o.getLocalStreamPublished(),ur=o.getContact(z.requesterId);Mr.applyConstraints(z.constraints).then(function(){ur.sendCustomEvent(i.g.CONTACT_APPLY_CONSTRAINTS_RESULT_IDENTIFIER,{callId:z.callId,streamId:z.streamId,timeout:z.timeout})}).catch(function(Gn){o.sendToContactRemoteStreamError(Gn.message,ur,z)});break;case i.g.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_RESULT_IDENTIFIER:vt.debug("getRemoteAudioFlowStatus result :",z);var $r=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===$r&&vt.error("Can't find the local stream to resolve the request.."),$r.resolvePendingPromise(z.timeout,z.audioFlowStatus);break;case i.g.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_RESULT_IDENTIFIER:vt.debug("getRemoteVideoFlowStatus result :",z);var Zr=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===Zr&&vt.error("Can't find the local stream to resolve the request.."),Zr.resolvePendingPromise(z.timeout,z.videoFlowStatus);break;case i.g.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER:vt.debug("remote getSettings result :",z);var eo=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===eo&&vt.error("Can't find the local stream to resolve the request.."),eo.resolvePendingPromise(z.timeout,z.settings);break;case i.g.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER:vt.debug("remote getCapabilities result :",z);var to=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===to&&vt.error("Can't find the local stream to resolve the request.."),to.resolvePendingPromise(z.timeout,z.capabilities);break;case i.g.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER:vt.debug("remote getConstraints result :",z);var no=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===no&&vt.error("Can't find the local stream to resolve the request.."),no.resolvePendingPromise(z.timeout,z.constraints);break;case i.g.CONTACT_GET_REMOTE_ERROR:vt.debug("remote stream request error:",z);var ao=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===ao&&vt.error("Can't find the local stream to reject the request.."),ao.rejectPendingPromise(z.timeout,z.message);break;case i.g.CONTACT_APPLY_CONSTRAINTS_RESULT_IDENTIFIER:vt.debug("remote applyConstraints result :",z);var ro=o.getRemoteStreamSubscribed(z.callId,z.streamId);null===ro&&vt.error("Can't find the local stream to resolve the request.."),ro.resolvePendingPromise(z.timeout,z.constraints);break;default:var oo={event:z.event,content:z};null!==$&&(oo.conversation=$),he.get(ei(o)).emit("customEvent",oo)}}}).onEvent("incomingCall",function(F){if(F.detail.callerId.toString()===o.getId()){var z=F.detail.callId.toString();if("data"===F.detail.callType)if(vt.debug("Received file transfer invitation from "+o.getUsername()),x.g._private.dataCallsFileInfo.has(z)){var $=x.g._private.dataCallsFileInfo.get(z),X=null;apiRTC.userAgentInstance.currentSession.invitationsMap.has(o.getId()+"-sendfile-"+z)?(X=apiRTC.userAgentInstance.currentSession.invitationsMap.get(o.getId()+"-sendfile-"+z),vt.debug("invitation already exist :",X)):(X=new Rn(ei(o),z,$),apiRTC.userAgentInstance.currentSession.invitationsMap.set(o.getId()+"-sendfile-"+z,X)),he.get(ei(o)).emit("fileTransferInvitation",X)}else x.g._private.dataChannelInvitations.has(z)?he.get(ei(o)).emit("dataChannelInvitation",new mn(ei(o),z)):(vt.info("File information has not been received yet, putting invitation on hold"),x.g._private.dataCallsOnHold.set(z));else if("screenSharing"===F.detail.callType)if(!0===apiRTC.session.apiCCWebRTCClient.webRTCClient.userAcceptOnIncomingScreenSharingCall){vt.debug("Received screenSharingCallInvitation from "+o.getUsername());var se=new Di(ei(o),z,F.detail.callType,{isRecorded:!!F.detail.hasOwnProperty("recordedCall")&&F.detail.recordedCall});he.get(ei(o)).emit("incomingScreenSharingCallInvitation",se)}else{vt.debug("Received screenSharingCall from "+o.getUsername());var Me=bi.getOrCreateCall(z,ei(o),{started:!0,isRecorded:!!F.detail.hasOwnProperty("recordedCall")&&F.detail.recordedCall});he.get(ei(o)).emit("incomingScreenSharingCall",Me)}else vt.info("Received call invitation from "+o.getUsername()),he.get(ei(o)).emit("incomingCall",new Di(ei(o),z,F.detail.callType,{isRecorded:!!F.detail.hasOwnProperty("recordedCall")&&F.detail.recordedCall}))}}).onEvent("hangup",function(F){var z=F.detail.callId.toString();o.getId()===F.detail.remoteId.toString()&&(vt.debug("hangup event :",F.detail),o.fileTransfers.includes(z)&&(vt.info("File transfer finished from "+o.getUsername()),o.fileTransfers.splice(o.fileTransfers.indexOf(z),1)))}).onEvent("sendDataChannelError",function(F){var z=F.detail.callId.toString();o.getId()===F.detail.remoteId.toString()&&o.fileTransfers.includes(z)&&(vt.info("File transfer error from "+o.getUsername()),he.get(ei(o)).emit("fileTransferError",{error:"sendDataChannelError",invitationId:z}))}).onEvent("fetchUserDataAnswer",function(F){o.getId()===F.detail.id.toString()&&(o.userData=new Ke(F.detail.userData),o.promises.forEach(function(z){F.detail.timeout===z.timeout&&(clearTimeout(z.timeout),z.resolve(F.detail.userData))}))}),o}return _=H,Y=[{key:"getId",value:function(){return Wn.get(this)}},{key:"id",get:function(){return vt.warn("contact.id is deprecated, please use contact.getId() instead"),this.getId()}},{key:"fetchProfileInformation",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(k,F){null===a.profile||o?Wi.getUserProfile(di.getActiveApiKey(),a.getId()).then(function(z){a.profile=z,k(z)}).catch(F):k(a.profile)})}},{key:"getActiveStreams",value:function(){return this.streams.values()}},{key:"getLocalStreamWithCallId",value:function(a){for(var o=null,k=Tn.getLocalStreams(),F=k.next();!F.done;){for(var z=F.value,$=z.publishedInConversations.values(),X=$.next();!X.done;)X.value===a&&(o=z),X=$.next();F=k.next()}return o}},{key:"addMessageToHistory",value:function(a,o,k,F){-1===gn.get(this).indexOf(k.toString())&&(this.previousMessages.push({content:a,timestamp:o,uuid:k,fromContact:F}),gn.get(this).push(k.toString()))}},{key:"getPreviousMessages",value:function(){return this.previousMessages.sort(function(a,o){return new Date(o.timestamp)-new Date(a.timestamp)}),this.previousMessages}},{key:"getUserData",value:function(){return this.userData}},{key:"fetchUserData",value:function(){var a=this;return new Promise(function(o,k){var F=setTimeout(function(){k("Timeout error during fetchUserData() process")},5e3);a.promises.push({timeout:F,resolve:o}),apiRTC.session.fetchUserData({apiKey:di.getActiveApiKey(),id:a.getId(),timeout:F})})}},{key:"getUsername",value:function(){return null!==this.userData.get("username")?this.userData.get("username"):null!==this.userData.get("nickname")?this.userData.get("nickname"):this.getId()}},{key:"getPhotoUrl",value:function(){return null!==this.userData.get("photo_url")?this.userData.get("photo_url"):null!==this.userData.get("photoUrl")?this.userData.get("photoUrl"):Wi.getUserPhotoUrl(this.getId())}},{key:"fetchWebSessionInformation",value:function(a){var o=this;return new Promise(function(k,F){a instanceof Ui?Zt.has(o.getId()+":"+a.getId())?k(Zt.get(o.getId()+":"+a.getId())):Wi.getWebSession(a,o,di.getActiveApiKey()).then(function(z){Zt.set(o.getId()+":"+a.getId(),z),k(z)}).catch(function(z){F(x.g.createError(i.g.ERROR_OTHER,"fetchWebSessionInformation() - could not fetch web session information",vt))}):F(x.g.createError(i.g.ERROR_BAD_PARAMETER,"fetchWebSessionInformation() - parameter is not an instance of apiRTC.Session",vt))})}},{key:"loadMessageHistory",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(F,z){o.fetchWebSessionInformation(a).then(function($){return Wi.getSessionHistory($.webSessionId,a.getToken(),k)}).then(function($){vt.debug("loadMessageHistory() - got messages",$.messages);var X,se=Qt($.messages);try{for(se.s();!(X=se.n()).done;){var Me=X.value;o.addMessageToHistory(Me.value,Me.timestamp,Me.uuid,Me.destId.toString()!==o.getId())}}catch(Fe){se.e(Fe)}finally{se.f()}F()}).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"loadMessageHistory() - could not load session history",vt))})})}},{key:"addToGroup",value:function(a){this.inGroup(a)||(this.groups.push(a),he.get(this).emit("joinGroup",a))}},{key:"removeFromGroup",value:function(a){this.inGroup(a)&&(this.groups.splice(this.groups.indexOf(a),1),he.get(this).emit("leaveGroup",a))}},{key:"inGroup",value:function(a){return this.groups.includes(a)}},{key:"isOnline",value:function(){return 0!==this.groups.length}},{key:"sendData",value:function(a){var o=this;return this.isOnline()||vt.warn("sendData() - contact "+this.getUsername()+" does not seem to be connected."),new Promise(function(k,F){di.sendData(o.getId(),{event:i.g.CONTACT_SEND_DATA_IDENTIFIER,content:a}).then(k).catch(function(z){switch(z){case i.g.ERROR_TIMED_OUT:F(x.g.createError(i.g.ERROR_TIMED_OUT,"sendData() - Data transmission timed out ",vt));break;case i.g.ERROR_NOT_FOUND:F(x.g.createError(i.g.ERROR_NOT_FOUND,"sendData() - Contact was not found ",vt));break;default:F(x.g.createError(i.g.ERROR_OTHER,"sendData() - Data transmission timed out ",vt))}})})}},{key:"sendCustomEvent",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isOnline()||vt.warn("sendCustomEvent() - contact "+this.getUsername()+" does not seem to be connected."),new Promise(function(F,z){var $=k;$.event=a,di.sendData(o.getId(),$).then(F).catch(function(X){switch(X){case i.g.ERROR_TIMED_OUT:z(x.g.createError(i.g.ERROR_TIMED_OUT,"sendCustomEvent() - Data transmission timed out ",vt));break;case i.g.ERROR_NOT_FOUND:z(x.g.createError(i.g.ERROR_NOT_FOUND,"sendCustomEvent() - Contact was not found ",vt));break;default:z(x.g.createError(i.g.ERROR_OTHER,"sendCustomEvent() - Data transmission timed out ",vt))}})})}},{key:"sendMessage",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isOnline()||vt.warn("sendMessage() - contact "+this.getUsername()+" does not seem to be connected.");var F=null,z=function(){return new Promise(function($,X){k.hasOwnProperty("session")?o.fetchWebSessionInformation(k.session).then(function(se){$({save:!0,cloudSessionId:se.webSessionId,apiRTCId:k.session.getId()})}).catch(X):$({})})};return new Promise(function($,X){"string"!=typeof a?X(x.g.createError(i.g.ERROR_BAD_PARAMETER,"sendMessage() - message parameter is not instance of string",vt)):z().then(function(se){return vt.info("sendMessage() - with options :",F=se),di.sendMessage(o.getId(),a,F)},function(se){X(x.g.createError(i.g.ERROR_OTHER,"sendMessage() - Error occured when fetching options for sending message",vt))}).then(function(se){o.addMessageToHistory(a,Math.floor(Date.now()/1e3),se,!1),$(se)},function(se){switch(se){case i.g.ERROR_TIMED_OUT:X(x.g.createError(i.g.ERROR_TIMED_OUT,"sendMessage() - Data transmission timed out ",vt));break;case i.g.ERROR_NOT_FOUND:X(x.g.createError(i.g.ERROR_NOT_FOUND,"sendMessage() - Contact was not found ",vt));break;default:X(x.g.createError(i.g.ERROR_OTHER,"sendMessage() - Data transmission timed out ",vt))}})})}},{key:"inviteTo",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sendConversationInvitation(a,o)}},{key:"sendConversationInvitation",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a instanceof qt?a.sendInvitation(this,o):(vt.error("sendConversationInvitation() - Parameter is not a conversation"),null)}},{key:"sendWhiteboardInvitation",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};di.whiteBoardClient.roomId!==a&&(di.whiteBoardClient.leaveRoom(),di.whiteBoardClient.start(),di.whiteBoardClient.joinRoom(a));var k=o.context?o.context:null,F={};o.cloudConversationId&&(F.convId=o.cloudConversationId),di.whiteBoardClient.inviteInRoom(a,this.getId(),k,F);var z=new ft(this,null);return z.id="wb-"+a,z.type="whiteboard",z}},{key:"call",value:function(a){var o,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{mediaTypeForOutgoingCall:"VIDEO",record:!1};this.isOnline()||vt.warn("call() - contact "+this.getUsername()+" does not seem to be connected.");var F={},z=x.g.assignObject({},k),$=!!k.hasOwnProperty("audioOnly")&&k.audioOnly;k.hasOwnProperty("record")&&(null!=z.record||(z.record=k.record)),null!==a&&a instanceof Tn&&(z.userMediaStreamId=a.userMediaStreamId,a.isScreensharing()&&(z.forceCallType="screenSharing")),z.cloudConversationId&&(F.cloudConvId=z.cloudConversationId,delete z.cloudConversationId),o=$?di.webRTCClient.callAudio(this.getId(),F,z):di.webRTCClient.call(this.getId(),F,z);var X=bi.getOrCreateCall(o,this,{isRecorded:z.record});return X}},{key:"shareScreen",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isOnline()||vt.warn("call() - contact "+this.getUsername()+" does not seem to be connected.");var o={},k=null,F=a,z=a.captureSourceType;vt.warn("call() - contact "+this.getUsername()+" does not seem to be connected."),k=di.webRTCClient.shareScreen(this.getId(),o,z);var $=bi.getOrCreateCall(k,this,{isRecorded:F.record});return $}},{key:"startDataChannel",value:function(){if(this.isOnline()||vt.warn("startDataChannel() - contact "+this.getUsername()+" does not seem to be connected."),!("Edge"===y.Xh&&y.PR<79)){var a=di.webRTCClient.startDataChannel(this.getId());return di.sendData(this.getId(),{callId:a,event:i.g.CONTACT_DATACHANNEL_INVITATION}),new Kn(a,this,{type:i.g.DATACHANNEL_TYPE_SEND})}vt.warn("Cannot startDataChannel as it is not supported on Edge")}},{key:"sendFile",value:function(a,o){if(this.isOnline()||vt.warn("sendFile() - contact "+this.getUsername()+" does not seem to be connected."),"Edge"===y.Xh&&y.PR<79)return vt.warn("Cannot sendFile as Datachannel is not supported on Edge"),null;var k=di.webRTCClient.startDataChannel(this.getId()),F=this;if(void 0===k)return vt.warn("Error on startDataChannel"),null;di.sendData(this.getId(),{fileInfo:a,callId:k,event:i.g.CONTACT_SEND_FILEINFO_IDENTIFIER}),di.onEvent("sendDataChannelOpen",function $(X){vt.debug("sendFile() - DataChannel open",X.detail),X.detail.callId.toString()===k.toString()&&(di.webRTCClient.sendDataWithCallId(k,{file:o,name:a.name,type:a.type},function(se){vt.trace("sendFile() - progress : ",se);var Me={uuid:se.uuid,fileSize:se.fileSize,remainingSize:se.remainingSize,percentage:se.percentage,sendChunkNb:se.sendChunkNb,transferDuration:se.transferDuration,lastPacket:se.lastPacket};he.get(F).emit("fileTransferProgress",{fileInfo:a,transferInformation:Me}),se.transferEnded&&he.get(F).emit("fileSentSuccessfully",{fileInfo:a,transferInformation:Me})}),di.removeEventListener("sendDataChannelOpen",$))}),this.fileTransfers.push(k.toString());var z=new ft(this,null);return z.id=k.toString(),z.type="sendFile",z.on("response",function(){z.getStatus()!==i.g.INVITATION_STATUS_ACCEPTED&&vt.log("sendFile() - invitation has not been accepted, cleaning listeners")}),z}},{key:"pushMedia",value:function(a,o){var k=this,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(z,$){k.fetchWebSessionInformation(o).then(function(X){return F.token=o.token,Wi.pushConversationMedia(X.conversationId,a,di.getActiveApiKey(),F)}).then(function(X){di.sendData(k.getId(),{event:i.g.CONTACT_NEW_MEDIA_IDENTIFIER,media:{url:X.url,id:X.id}}),z({url:X.url,id:X.id})}).catch(function(X){$(x.g.createError(i.g.ERROR_OTHER,"pushMedia() - failed to push media",vt))})})}},{key:"fetchMediaList",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vt.debug("fetchMediaList()"),new Promise(function(F,z){o.fetchWebSessionInformation(a).then(function($){return k.token=a.getToken(),Wi.getConversationMediaList($.conversationId,di.getActiveApiKey(),k)}).then(F).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"getMediaList() - failed to get media list",vt))})})}},{key:"sendEventCenterDataRequest",value:function(){return this.sendCustomEvent(i.g.CONTACT_EVENTCENTER_DATA_REQUEST)}},{key:"getLocalStreamPublished",value:function(){var a=Tn.getLocalStreams().next();return void 0===a.value?null:a.value}},{key:"getRemoteStreamSubscribed",value:function(a,o){var k=Ui.getActiveSession().getCall(a);if(k){vt.debug("remote stream is associated to a call");var F,z=Qt(k.getReceivedStreams());try{for(z.s();!(F=z.n()).done;){var $=F.value;if($.getId()===o)return $}}catch(Dt){z.e(Dt)}finally{z.f()}}else{var X=Ui.getActiveSession().getActiveConversations(),se=Ui.getActiveSession().getActiveConferences();for(var Me in X){var Fe=X[Me].getSubscribedStream(o);if(void 0!==Fe)return vt.debug("remote stream is associated to a conversation"),Fe}for(var bt in se){var ht=se[bt].getSubscribedStream(o);if(void 0!==ht)return vt.debug("remote stream is associated to a conference"),ht}}return null}},{key:"getContact",value:function(a){return Ui.getActiveSession().getOrCreateContact(a)}},{key:"sendToContactRemoteStreamError",value:function(a,o,k){vt.debug("sendToContactRemoteStreamError",a,o,k),o.sendCustomEvent(i.g.CONTACT_GET_REMOTE_ERROR,{callId:k.callId,streamId:k.streamId,timeout:k.timeout,message:a})}}],O=[{key:"getAvailableEvents",value:function(){return pn}}],Y&&li(_.prototype,Y),O&&li(_,O),H}(ke);function Gi(D){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Bi(D,_){return(Bi=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function En(D,_){if(_&&("object"===Gi(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function Zn(D){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var nn=R.Y.get("ConversationCall"),Ri=ie.get(),Va=function(D){!function(H,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(a&&a.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),a&&Bi(H,a)}(fe,D);var Y,O,U,de=(O=fe,U=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}(),function(){var H,a=Zn(O);if(U){var o=Zn(this).constructor;H=Reflect.construct(a,arguments,o)}else H=a.apply(this,arguments);return En(this,H)});function fe(H,a,o){var k;return function(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}(this,fe),(k=de.call(this,nn)).conversation=H,k.callId=a,k.stream=o,k}return Y=[{key:"getConversation",value:function(){return this.conversation}},{key:"getCallId",value:function(){return this.callId}},{key:"getStream",value:function(){return this.stream}},{key:"isRecorded",value:function(){return!!this.recordingStatus}},{key:"getRecordingInfo",value:function(){return this.isRecorded()?this.recordingStatus:null}},{key:"isStreamed",value:function(){return!!this.streamingStatus}},{key:"getStreamingInfo",value:function(){return this.isStreamed()?this.streamingStatus:null}},{key:"startRecordingPublishedStream",value:function(H){var a=this;return H||(H={}),new Promise(function(o,k){if(a.asyncCallbacks)return k(x.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - busy",nn));a.asyncCallbacks={},a.asyncCallbacks.timeoutId=setTimeout(function(){return a.asyncCallbacks&&(Ri.removeEventListener("error",a.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - timeout",nn))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),a.asyncCallbacks.error=function(X){if(String(X.detail.convId)===a.conversation.getCloudConversationId()&&X.detail.callId===a.callId&&X.detail.errorCode.indexOf("START_RECORD")>=0)return a.asyncCallbacks&&(Ri.removeEventListener("error",a.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"startRecordingPublishedStream() - "+X.detail.errorInfo,nn))},a.asyncCallbacks.recordingStarted=function(X){if(String(X.detail.convId)===a.conversation.getCloudConversationId()&&X.detail.callId===a.callId){a.asyncCallbacks&&(Ri.removeEventListener("error",a.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStarted",a.asyncCallbacks.recordingStarted),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks);var se=x.g.parseRecordingEvent("MCURecordingStarted",X.detail);return o(se)}},Ri.onEvent("error",a.asyncCallbacks.error),Ri.onEvent("MCURecordingStarted",a.asyncCallbacks.recordingStarted);var F="AUDIO-VIDEO";!0===H.audioOnly?F="AUDIO-ONLY":!0===H.videoOnly&&(F="VIDEO-ONLY");var z="userStream";x.g.isPropertyTypeof(H,"customIdInFilename","string")&&(z=H.customIdInFilename);var $={};x.g.isPropertyTypeof(H,"data","object")&&($=Object.assign({},H.data)),x.g.isPropertyTypeof(H,"ttl","number")&&H.ttl>0&&($.ttl=H.ttl),Ri.webRTCClient.startRecording(F,z,a.conversation.getCloudConversationId(),a.callId,$)})}},{key:"stopRecordingPublishedStream",value:function(){var H=this;return new Promise(function(a,o){if(H.asyncCallbacks)return o(x.g.createError(i.g.ERROR_OTHER,"stopRecordingPublishedStream() - busy",nn));H.asyncCallbacks={},H.asyncCallbacks.timeoutId=setTimeout(function(){return H.asyncCallbacks&&(Ri.removeEventListener("error",H.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStopped",H.asyncCallbacks.recordingStopped),delete H.asyncCallbacks),a(H.recordingStatus)},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),H.asyncCallbacks.error=function(k){if(String(k.detail.convId)===H.conversation.getCloudConversationId()&&k.detail.callId===H.callId&&k.detail.errorCode.indexOf("STOP_RECORD")>=0)return H.asyncCallbacks&&(Ri.removeEventListener("error",H.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStopped",H.asyncCallbacks.recordingStopped),clearTimeout(H.asyncCallbacks.timeoutId),delete H.asyncCallbacks),o(x.g.createError(i.g.ERROR_OTHER,"stopRecordingPublishedStream() - "+k.detail.errorInfo,nn))},H.asyncCallbacks.recordingStopped=function(k){if(String(k.detail.convId)===H.conversation.getCloudConversationId()&&k.detail.callId===H.callId){H.asyncCallbacks&&(Ri.removeEventListener("error",H.asyncCallbacks.error),Ri.removeEventListener("MCURecordingStopped",H.asyncCallbacks.recordingStopped),clearTimeout(H.asyncCallbacks.timeoutId),delete H.asyncCallbacks);var F=x.g.parseRecordingEvent("MCURecordingStopped",k.detail);return a(F)}},Ri.onEvent("error",H.asyncCallbacks.error),Ri.onEvent("MCURecordingStopped",H.asyncCallbacks.recordingStopped),Ri.webRTCClient.stopRecording(H.callId)})}},{key:"replacePublishedStream",value:function(H,a){var o=this;return new Promise(function(k,F){if(null===H){if(!x.g.isPropertyTypeof(a,"getStream","function"))return F(new Error("replacePublishedStream() - Cannot replace stream, wrong arguments"));o.stream.publishedInConversations.delete(o.conversation.getName()),o.conversation.conversationPublishedStreams.delete(o.stream.userMediaStreamId);var z={getUserMediaStreamId:function(){return a.getStream().then(function(X){o.stream=X,X.publishedInConversations.set(o.conversation.getName(),o.callId),o.conversation.callIdToStreamId.set(o.callId,X.userMediaStreamId);var se={contact:null,isRemote:!1,hasAudio:X.hasAudio(),hasVideo:X.hasVideo(),isScreensharing:X.isScreensharing(),streamId:X.userMediaStreamId,callId:o.callId};return o.conversation.conversationPublishedStreams.set(X.userMediaStreamId,se),X.userMediaStreamId}).catch(F)}};Ri.webRTCClient.webRTCClient.addMedia(o.callId,!0,null,z).then(function(X){return k(function(se){if(Fn.has(se))return Fn.get(se);var Me=apiCC.getUserMediaStream(se);if(Me){var Fe="audio";return!0===Me.video&&(Fe="video"),new Tn(Me.stream,{type:Fe,constructor:!0,userMediaStreamId:Me.userMediaStreamId})}return null}(X))}).catch(function(X){return F(new Error("replacePublishedStream() - "+X))})}else{o.stream.publishedInConversations.delete(o.conversation.getName()),o.conversation.conversationPublishedStreams.delete(o.stream.userMediaStreamId),Ri.webRTCClient.webRTCClient.addMedia(o.callId,!0,H.userMediaStreamId).then(function(X){return k(H)}).catch(function(X){return F(new Error("replacePublishedStream() - "+X))}),o.stream=H,H.publishedInConversations.set(o.conversation.getName(),o.callId),o.conversation.callIdToStreamId.set(o.callId,H.userMediaStreamId);var $={contact:null,isRemote:!1,hasAudio:H.hasAudio(),hasVideo:H.hasVideo(),isScreensharing:H.isScreensharing(),streamId:H.userMediaStreamId,callId:o.callId};o.conversation.conversationPublishedStreams.set(H.userMediaStreamId,$)}})}},{key:"startStreaming",value:function(){var H=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(o,k){return H.asyncCallbacks?k(x.g.createError(i.g.ERROR_OTHER,"startStreaming() - busy",nn)):Ri.webRTCClient.startStreaming(a.service,a.server,a.streamKey,H.callId)?(H.asyncCallbacks={},H.asyncCallbacks.timeoutId=setTimeout(function(){return H.asyncCallbacks&&(Ri.removeEventListener("MCUStreamingStarted",H.asyncCallbacks.streamingStarted),delete H.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"startStreaming() - timeout",nn))},i.g.CONVERSATION_STREAMING_STARTED_DELAY),H.asyncCallbacks.streamingStarted=function(F){if(F.detail.roomName===H.conversation._getTechnicalName()&&F.detail.callId===H.callId){H.asyncCallbacks&&(Ri.removeEventListener("MCUStreamingStarted",H.asyncCallbacks.streamingStarted),clearTimeout(H.asyncCallbacks.timeoutId),delete H.asyncCallbacks);var z=ji("MCUStreamingStarted",F.detail);return o(z)}},void Ri.onEvent("MCUStreamingStarted",H.asyncCallbacks.streamingStarted)):k(x.g.createError(i.g.ERROR_BAD_PARAMETER,"startStreaming() - cannot start streaming",nn))})}},{key:"stopStreaming",value:function(){var H=this;return new Promise(function(a,o){return H.asyncCallbacks?o(x.g.createError(i.g.ERROR_OTHER,"stopStreaming() - busy",nn)):Ri.webRTCClient.stopStreaming(H.callId)?(H.asyncCallbacks={},H.asyncCallbacks.timeoutId=setTimeout(function(){return H.asyncCallbacks&&(Ri.removeEventListener("MCUStreamingStopped",H.asyncCallbacks.streamingStopped),delete H.asyncCallbacks),o(x.g.createError(i.g.ERROR_OTHER,"stopStreaming() - timeout",nn))},i.g.CONVERSATION_STREAMING_STOPPED_DELAY),H.asyncCallbacks.streamingStopped=function(k){if(k.detail.roomName===H.conversation._getTechnicalName()&&k.detail.callId===H.callId){H.asyncCallbacks&&(Ri.removeEventListener("MCUStreamingStopped",H.asyncCallbacks.streamingStopped),clearTimeout(H.asyncCallbacks.timeoutId),delete H.asyncCallbacks);var F=ji("MCUStreamingStopped",k.detail);return a(F)}},void Ri.onEvent("MCUStreamingStopped",H.asyncCallbacks.streamingStopped)):o(x.g.createError(i.g.ERROR_BAD_PARAMETER,"stopStreaming() - cannot stop streaming",nn))})}},{key:"changeStreamPriority",value:function(H){var a=this;return new Promise(function(o,k){return Ri.webRTCClient.changeStreamPriority(a.callId,H)?(a.conversation.changeStreamPriority(a.stream.userMediaStreamId,!1,H),o()):k(x.g.createError(i.g.ERROR_BAD_PARAMETER,"changeStreamPriority() - cannot change stream priority",nn))})}},{key:"updatePublishedStream",value:function(H,a){var o=this;return new Promise(function(k,F){return"audio"!==H&&"video"!==H?F(x.g.createError(i.g.ERROR_BAD_PARAMETER,"updatePublishedStream() - wrong type",nn)):Ri.webRTCClient.webRTCClient.processUpdateStream(o.callId,H,a?"sendonly":"inactive")?k():F(x.g.createError(i.g.ERROR_OTHER,"updatePublishedStream() - cannot update",nn))})}}],Y&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(fe.prototype,Y),fe}(ke);function pa(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Ta(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Ta(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Ta(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Za(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}var an=R.Y.get("ContactCatalog"),yn=null,Sn={},An={leftGroup:{},joinedGroup:{},userDataChanged:[]},Mn=function(){function D(){if(function(de,fe){if(!(de instanceof fe))throw new TypeError("Cannot call a class as a function")}(this,D),null!==yn)throw"Cannot construct singleton ContactCatalog";this.contactList=new Map,this.eventEmitter=new w,yn=this;var U=ie.get();U.onEvent("connectedUsersListUpdate",function(de){var fe=apiRTC.session.apiCCId.toString(),H={};switch(de.detail.updateReason){case"newConnectionState":if("online"===de.detail.status){an.debug("new connection");var a,o=pa(de.detail.usersList);try{for(o.s();!(a=o.n()).done;)(H={userId:a.value,group:de.detail.group}).userId.toString()!==fe&&er(H)}catch(X){o.e(X)}finally{o.f()}}else{an.debug("new disconnection");var k,F=pa(de.detail.usersList);try{for(F.s();!(k=F.n()).done;)void 0===Sn[(H={userId:k.value,group:de.detail.group}).group]&&(Sn[H.group]={}),H.userId.toString()!==fe&&(Sn[H.group][H.userId.toString()]=setTimeout(ea(H),U.contactDisconnectionDelay))}catch(X){F.e(X)}finally{F.f()}}break;case"userDataUpdate":an.debug("userDataUpdate");var z,$=pa(de.detail.usersList);try{for($.s();!(z=$.n()).done;)(H={userId:z.value,group:de.detail.group}).userId.toString()!==fe&&tr(H)}catch(X){$.e(X)}finally{$.f()}break;case"callState":an.debug("callState change for user");break;default:an.warn("default case for updateReason value")}}).onEvent("groupUnsubscribed",function(de){var fe,H=yn.getContacts(de),a=pa(H.keys());try{for(a.s();!(fe=a.n()).done;)H.get(fe.value).removeFromGroup(de)}catch(k){a.e(k)}finally{a.f()}})}var _,Y,O;return _=D,O=[{key:"get",value:function(){return null===yn&&(yn=new D),yn}}],(Y=[{key:"onUpdate",value:function(U){this.eventEmitter.on("update",U)}},{key:"removeUpdateListener",value:function(U){this.eventEmitter.off("update",U)}},{key:"getContact",value:function(U){return null!=U&&this.contactList.has(U.toString())?this.contactList.get(U.toString()):null}},{key:"getOrCreateContact",value:function(U){var de=null;if(null!=U)if(this.contactList.has(U.toString()))de=this.contactList.get(U.toString());else try{de=new ci(U.toString(),{}),this.contactList.set(U.toString(),de)}catch(fe){an.debug("Contact not added : "+fe)}return de}},{key:"getContacts",value:function(U){if(null==U)return this.contactList;var de,fe=new Map,H=pa(this.contactList.keys());try{for(H.s();!(de=H.n()).done;){var a=de.value;this.contactList.get(a).inGroup(U)&&fe.set(a,this.contactList.get(a))}}catch(o){H.e(o)}finally{H.f()}return fe}},{key:"getOnlineContacts",value:function(U){var de=new Map;if(null==U){var fe,H=pa(this.contactList.keys());try{for(H.s();!(fe=H.n()).done;){var a=fe.value;this.contactList.get(a).isOnline()&&de.set(a,this.contactList.get(a))}}catch(z){H.e(z)}finally{H.f()}}else{var o,k=pa(this.contactList.keys());try{for(k.s();!(o=k.n()).done;){var F=o.value;this.contactList.get(F).inGroup(U)&&this.contactList.get(F).isOnline()&&de.set(F,this.contactList.get(F))}}catch(z){k.e(z)}finally{k.f()}}return de}}])&&Za(_.prototype,Y),O&&Za(_,O),D}();function ea(D){return function(){var O,U,_=D.userId.toString();if(an.info("Contact disconnected "+_+" from "+D.group),yn.contactList.has(_)){var Y=yn.contactList.get(_);if(void 0===Y)return void an.debug("Contact not exist with userId :",_);Y.removeFromGroup(D.group),O=D.group,U=Y,an.debug("updateContactListOnUserDisconnect()"),void 0===An.leftGroup[O]&&(An.leftGroup[O]=[]),An.leftGroup[O].push(U),jn(),void 0!==Sn[D.group]&&void 0!==Sn[D.group][_]&&delete Sn[D.group][_]}}}function jn(){0===Object.keys(An.leftGroup).length&&0===Object.keys(An.joinedGroup).length&&0===An.userDataChanged.length||(yn.eventEmitter.emit("update",An),An={leftGroup:{},joinedGroup:{},userDataChanged:[]})}function er(D){an.debug("updateContactListOnUserConnection()");var _=D.userId.toString(),Y=null,O=apiRTC.session.getConnectedUserInfo(_,"userData");an.debug("userData :",O);try{D.userData=JSON.parse(O)}catch(U){an.warn("userData parse error : "+U)}if(yn.contactList.has(_))Y=yn.contactList.get(D.userId),Ke.equals(Y.userData,D.userData)||(Y.userData=new Ke(D.userData),An.userDataChanged.push(Y));else{try{Y=new ci(_,D.userData),yn.contactList.set(_,Y)}catch(U){an.debug("Contact not added : "+U)}Y=yn.contactList.get(_)}void 0!==Y?(void 0!==Sn[D.group]&&void 0!==Sn[D.group][_]&&(clearTimeout(Sn[D.group][_]),delete Sn[D.group][_]),Y.inGroup(D.group)||(Y.addToGroup(D.group),void 0===An.joinedGroup[D.group]&&(An.joinedGroup[D.group]=[]),An.joinedGroup[D.group].push(Y)),jn()):an.debug("Contact not exist with userId :",_)}function tr(D){an.debug("updateContactListOnUserDataUpdate()");var _=D.userId.toString(),Y=yn.contactList.get(D.userId);if(void 0!==Y){var O=apiRTC.session.getConnectedUserInfo(_,"userData");an.debug("userData :",O);try{D.userData=JSON.parse(O)}catch(U){an.warn("userData parse error : "+U)}Ke.equals(Y.userData,D.userData)||(Y.userData=new Ke(D.userData),An.userDataChanged.push(Y)),jn()}else an.debug("Contact not exist with userId :",_)}function Ia(D){return(Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function vn(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Mi(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Mi(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Mi(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Aa(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Un(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function On(D,_){return(On=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Fa(D,_){if(_&&("object"===Ia(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return Ot(D)}function Ot(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Ma(D){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Ye=R.Y.get("Conversation"),ut=ie.get(),rn=new pe.Z,zi=Mn.get(),ir=["adaptationTriggered","audioAmplitude","availableStreamsUpdated","bandwidthLimited","callStatsUpdate","compositeListChanged","contactJoined","contactJoinedWaitingRoom","contactLeft","contactLeftWaitingRoom","cpuLimited","customEvent","data","disconnectionWarning","entryAllowed","entryDenied","error","hangup","joined","left","localStreamUpdated","message","messageNotDelivered","moderatorConnected","newMediaAvailable","newWhiteboardSession","participantEjected","persistentDataUpdated","pointerLocationChanged","pointerSharingEnabled","recordingAvailable","recordingStarted","recordingStopped","remoteStreamUpdated","replayListChanged","roomModeChanged","simulcastFeedChanged","slowLink","streamAdded","streamListChanged","streamRemoved","streamingStarted","streamingStopped","transferPending","transferBegun","transferEnded","transferProgress","whiteboardRoomMemberUpdate","videoQualityChanged","waitingForModeratorAcceptance"],Ra=new Set(["CHAT","CALL","GROUP_CHAT","WEBCONF","REPORT","REPORT_PART","TICKET","EVENT","OTHER","BOT"]),Oa=new Set(["audioSent","videoSent","audioReceived","videoReceived","quality"]),Ba=new Set(["CALL_ABORTED","SET_LOCAL_DESCRIPTION_FAILURE","SET_REMOTE_DESCRIPTION_FAILURE"]),sa=new WeakMap,fa=new WeakMap,la=new WeakMap,ye=new WeakMap,Le=new WeakMap,Ge=new WeakMap,st=new WeakMap,He=new WeakMap,Ct=new WeakMap,St=new WeakMap,_t=new WeakMap,Nt=new WeakMap,Xt=new WeakMap,qt=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&On(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=Ma(U);if(de){var k=Ma(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Fa(this,a)});function H(a){var o,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Aa(this,H),o=fe.call(this,Ye),Ye.debug("Create Conversation"),sa.set(Ot(o),null==a?x.g.guid().toString():a.toString()),fa.set(Ot(o),"OTHER"),o.active=!Object.prototype.hasOwnProperty.call(k,"active")||"boolean"!=typeof k.active||k.active,o.meshModeEnabled=!0===k.meshModeEnabled,o.meshOnlyEnabled=!0===k.meshOnlyEnabled,o.moderationEnabled=!0===k.moderationEnabled,o.moderator=!0===k.moderator,o.conversationCalls=new Map,o.callIdToStreamId=new Map,o.token=null,o.sessionId=null,o.webconfId=null,o.conversationStreams=new Map,o.conversationPublishedStreams=new Map,o.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED,o.status=i.g.CONVERSATION_STATUS_NOT_JOINED,o.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_NOT_STARTED,o.pointerSharingState=i.g.STATE_IDLE,o.pointerSharingAutoInvite=!1,o.pgroupWaitingRoomSubscribedTo=!1,Le.set(Ot(o),null),Ge.set(Ot(o),null),st.set(Ot(o),new Map),ye.set(Ot(o),null),He.set(Ot(o),null),la.set(Ot(o),{}),_t.set(Ot(o),new Map),Xt.set(Ot(o),null),Nt.set(Ot(o),null),o.transferCallIds=[],o.uploadCap=null,o.downloadCap=null,o.reservedStreams=[];var F={contactCatalog:{}};for(var z in F.contactCatalog.onUpdate=function(X){Ye.debug("onUpdate: contactList",X);var se=o._getTechnicalName();if(void 0!==X.joinedGroup[se]){var Me,Fe=vn(X.joinedGroup[se]);try{for(Fe.s();!(Me=Fe.n()).done;){var bt=Me.value;Ye.debug(bt.getUsername()+" joined conversation "+o.getName()),he.get(Ot(o)).emit("contactJoined",bt),o.pointerSharingState===i.g.STATE_ACTIVE&&!0===o.pointerSharingAutoInvite&&ut.pointerSharingClient.inviteInRoom(se,bt.getId())}}catch(Ln){Fe.e(Ln)}finally{Fe.f()}}else Ye.debug("not an event joinedGroup for conversation");if(void 0!==X.leftGroup[se]){var ht,Dt=vn(X.leftGroup[se]);try{for(Dt.s();!(ht=Dt.n()).done;){var Ut=ht.value;Ye.debug(Ut.getUsername()+" left conversation "+o.getName()),he.get(Ot(o)).emit("contactLeft",Ut)}}catch(Ln){Dt.e(Ln)}finally{Dt.f()}}else Ye.debug("not an event leftGroup for conversation");if(o.getRole()===i.g.CONVERSATION_ROLE_MODERATOR){var gi,dn=zi.getContacts(i.g.CONVERSATION_WAITING_ROOM_PREFIX+se),bn=vn(_t.get(Ot(o)).keys());try{for(bn.s();!(gi=bn.n()).done;){var Wa=gi.value;if(!dn.has(Wa)){var ja=zi.getContact(Wa);null!==ja&&(Ye.debug(ja.getUsername()+" left waiting room "+o.getName()),he.get(Ot(o)).emit("contactLeftWaitingRoom",ja))}}}catch(Ln){bn.e(Ln)}finally{bn.f()}dn.forEach(function(Ln,$a){_t.get(Ot(o)).has($a)||null===Ln||(Ye.debug(Ln.getUsername()+" joined waiting room "+o.getName()),he.get(Ot(o)).emit("contactJoinedWaitingRoom",Ln),ut.sendData($a,{event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected",roomname:se}).catch(function(Mr){var ur=x.g.createError(Mr,"Notification not delivered",Ye);he.get(Ot(o)).emit("messageNotDelivered",{error:ur,contact:Ln,event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected"})}))}),_t.set(Ot(o),dn)}},zi.onUpdate(F.contactCatalog.onUpdate),he.get(Ot(o)).on("contactJoined",function(X){o.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&ut.sendData(X.getId(),{event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected",roomname:o._getTechnicalName()}).catch(function(se){var Me=x.g.createError(se,"Notification not delivered",Ye);he.get(Ot(o)).emit("messageNotDelivered",{error:Me,contact:X,event:i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER,command:"conversationModeratorConnected"})})}),F.apiRTCManager={},F.apiRTCManager.receiveData=function(X){var se=X.detail.data;if(se.roomname===o._getTechnicalName()){var Me=zi.getOrCreateContact(X.detail.senderId);if(se.event)switch(se.event){case i.g.CONVERSATION_SEND_DATA_IDENTIFIER:if(o.status!==i.g.CONVERSATION_STATUS_JOINED)break;he.get(Ot(o)).emit("data",{sender:Me,content:se.content});break;case i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER:if(o.status!==i.g.CONVERSATION_STATUS_JOINED)break;Ye.info("New media available in conversation",se.media),he.get(Ot(o)).emit("newMediaAvailable",{sender:Me,media:se.media});break;case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:if(o.status!==i.g.CONVERSATION_STATUS_JOINED)break;o.updateData();break;case i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER:he.get(Ot(o)).emit("moderatorConnected",Me);break;case i.g.CONVERSATION_CLOSED_IDENTIFIER:se.instanceId===o.getInstanceId()&&(Ye.info("Conference "+o.getName()+" has been closed..."),he.get(Ot(o)).emit("closed"),o.leave());break;case i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER:if(null==se.access){Ye.error("Conversation join answer has no access data");break}he.get(Ot(o)).emit(se.access?"entryAllowed":"entryDenied");break;default:he.get(Ot(o)).emit("customEvent",{event:se.event,content:se,sender:Me})}else if("new_snapshot"===se.command){if(o.status!==i.g.CONVERSATION_STATUS_JOINED)return;Ye.info("New media available in conversation",se.value.snapshot),he.get(Ot(o)).emit("newMediaAvailable",{sender:Me,media:se.value.snapshot})}else Ye.debug("Unprocessed conversation message",se)}},F.apiRTCManager.receiveGroupChatMessage=function(X){if((o.status===i.g.CONVERSATION_STATUS_JOINED||o.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED)&&X.detail.groupChatId.toString()===o._getTechnicalName()){var se={sender:zi.getOrCreateContact(X.detail.senderId),sender_id:X.detail.senderId,content:X.detail.message,time:new Date};x.g.isTypeof(X.detail,"metadata","object")&&(se.metadata=X.detail.metadata),he.get(Ot(o)).emit("message",se)}},F.apiRTCManager.receiveRoomMessage=function(X){if("pointerSharing"===X.detail.roomType&&o.pointerSharingState===i.g.STATE_ACTIVE&&"pointerLocation"===X.detail.message.type&&X.detail.roomId===o._getTechnicalName()){var se={sender:zi.getOrCreateContact(X.detail.senderId),source:X.detail.message.source,x:X.detail.message.x,y:X.detail.message.y};x.g.isPropertyTypeof(X.detail.message,"data","object")&&(se.data=X.detail.message.data),he.get(Ot(o)).emit("pointerLocationChanged",se)}},F.apiRTCManager.roomInvitation=function(X){if(Ye.info("roomInvitation event handler ",X),X.detail.roomId.toString()===o._getTechnicalName())if(Ye.info("roomInvitation for actual conversation",X),"whiteBoard"===X.detail.roomType){if(o.status===i.g.CONVERSATION_STATUS_JOINED){var se=zi.getOrCreateContact(X.detail.senderId);he.get(Ot(o)).emit("newWhiteboardSession",{sender:se})}}else"pointerSharing"===X.detail.roomType&&sn(Ot(o),!1,!0).then(function(){}).catch(function(Me){})},F.apiRTCManager.onFilePending=function(X){if(o.transferCallIds.includes(X.detail.callId)){var se={id:X.detail.callId,name:X.detail.name,rank:X.detail.rank};he.get(Ot(o)).emit("transferPending",se)}},F.apiRTCManager.onFileSending=function(X){if(o.transferCallIds.includes(X.detail.callId)){var se={id:X.detail.callId,name:X.detail.name};he.get(Ot(o)).emit("transferBegun",se)}},F.apiRTCManager.onFileProgress=function(X){if(o.transferCallIds.includes(X.detail.callId)){var se={id:X.detail.callId,name:X.detail.name,size:X.detail.fileSize,remBytes:X.detail.remainingSize,percentage:X.detail.percentage};he.get(Ot(o)).emit("transferProgress",se)}},F.apiRTCManager.onFileSended=function(X){var se=o.transferCallIds.indexOf(X.detail.callId);if(se>=0){var Me={id:X.detail.callId,name:X.detail.name};X.detail.error&&(Me.error=X.detail.error),he.get(Ot(o)).emit("transferEnded",Me),o.transferCallIds.splice(se,1)}},F.apiRTCManager)ut.onEvent(z,F.apiRTCManager[z]);Ct.set(Ot(o),F);var $={MCUAvailableStream:function(X){var se,Me=vn(X.detail.streams);try{for(Me.s();!(se=Me.n()).done;){var Fe=se.value;if(Fe.room===o._getTechnicalName()){var bt={contact:zi.getOrCreateContact(Fe.attributes.callerId),isRemote:X.detail.isRemoteStream,hasAudio:Fe.audio,hasVideo:Fe.video,isAudioMuted:Fe.audioMuted,isVideoMuted:Fe.videoMuted,isScreensharing:"screenSharing"===Fe.attributes.callType,isSIP:!0===Fe.sip,isSimulcast:!0===Fe.simulcast,streamId:Fe.id,type:"regular",callId:Fe.attributes.callId,descriptor:Fe.attributes.descriptor,context:Fe.context};o.conversationStreams.set(bt.streamId,bt);var ht={listEventType:"added"};x.g.assignObject(ht,bt),he.get(Ot(o)).emit("streamListChanged",ht)}}}catch(bn){Me.e(bn)}finally{Me.f()}Ye.debug("Nb stream into conversation :"+o.conversationStreams.size);var Dt,Ut={},gi=vn(o.conversationStreams.keys());try{for(gi.s();!(Dt=gi.n()).done;){var dn=Dt.value;Ut[dn]=o.conversationStreams.get(dn)}}catch(bn){gi.e(bn)}finally{gi.f()}he.get(Ot(o)).emit("availableStreamsUpdated",Ut)},MCUAvailableStreamUpdate:function(X){var se,Me=vn(X.detail.streams);try{for(Me.s();!(se=Me.n()).done;){var Fe=se.value;if(Fe.room===o._getTechnicalName()){var bt=o.conversationStreams.get(Fe.id);if(bt&&"regular"===bt.type){bt.hasAudio=Fe.audio,bt.hasVideo=Fe.video,bt.isAudioMuted=Fe.audioMuted,bt.isVideoMuted=Fe.videoMuted,bt.descriptor=Fe.attributes.descriptor;var ht={listEventType:"updated"};x.g.assignObject(ht,bt),he.get(Ot(o)).emit("streamListChanged",ht),bt.descriptor&&Object.prototype.hasOwnProperty.call(bt.descriptor,"priority")&&o.changeStreamPriority(bt.streamId,!0,bt.descriptor.priority)}}}}catch(bn){Me.e(bn)}finally{Me.f()}Ye.debug("Nb stream into conversation :"+o.conversationStreams.size);var Dt,Ut={},gi=vn(o.conversationStreams.keys());try{for(gi.s();!(Dt=gi.n()).done;){var dn=Dt.value;Ut[dn]=o.conversationStreams.get(dn)}}catch(bn){gi.e(bn)}finally{gi.f()}he.get(Ot(o)).emit("availableStreamsUpdated",Ut)},MCUAvailableComposite:function(X){var se,Me=vn(X.detail.streams);try{for(Me.s();!(se=Me.n()).done;){var Fe=se.value;if(Fe.room===o._getTechnicalName()){var bt={isRemote:X.detail.isRemoteStream,hasAudio:Fe.audio,hasVideo:Fe.video,isAudioMuted:Fe.audioMuted,isVideoMuted:Fe.videoMuted,isScreensharing:"screenSharing"===Fe.attributes.callType,isSIP:!0===Fe.sip,streamId:Fe.id,type:"composite",callId:Fe.attributes.callId,descriptor:Fe.attributes.descriptor,context:Fe.context};o.conversationStreams.set(bt.streamId,bt);var ht={listEventType:"added"};x.g.assignObject(ht,bt),he.get(Ot(o)).emit("compositeListChanged",ht)}}}catch(Dt){Me.e(Dt)}finally{Me.f()}},MCUAvailableReplay:function(X){var se,Me=vn(X.detail.streams);try{for(Me.s();!(se=Me.n()).done;){var Fe=se.value;if(Fe.room===o._getTechnicalName()){var bt={contact:zi.getOrCreateContact(Fe.attributes.callerId),isRemote:X.detail.isRemoteStream,hasAudio:Fe.audio,hasVideo:Fe.video,isAudioMuted:Fe.audioMuted,isVideoMuted:Fe.videoMuted,isScreensharing:"screenSharing"===Fe.attributes.callType,isSIP:!0===Fe.sip,streamId:Fe.id,type:"replay",callId:Fe.attributes.callId,descriptor:Fe.attributes.descriptor,context:Fe.context};o.conversationStreams.set(bt.streamId,bt);var ht={listEventType:"added"};x.g.assignObject(ht,bt),he.get(Ot(o)).emit("replayListChanged",ht)}}}catch(Dt){Me.e(Dt)}finally{Me.f()}},MCURemoveStream:function(X){if(o.conversationStreams.has(X.detail.streamId)){var se={listEventType:"removed"};x.g.assignObject(se,o.conversationStreams.get(X.detail.streamId)),"regular"===se.type?he.get(Ot(o)).emit("streamListChanged",se):"composite"===se.type&&he.get(Ot(o)).emit("compositeListChanged",se),o.conversationStreams.delete(X.detail.streamId),Ye.debug("Nb stream into conversation :"+o.conversationStreams.size);var Me,Fe={},bt=vn(o.conversationStreams.keys());try{for(bt.s();!(Me=bt.n()).done;){var ht=Me.value;Fe[ht]=o.conversationStreams.get(ht)}}catch(Dt){bt.e(Dt)}finally{bt.f()}he.get(Ot(o)).emit("availableStreamsUpdated",Fe)}else Ye.debug("Not a conversation's stream")},remoteStreamAdded:function(X){if(o.callIdToStreamId.has(X.detail.callId)){Ye.info("remoteStreamAdded",X.detail);var se=zi.getOrCreateContact(X.detail.remoteId),Me=o.callIdToStreamId.get(X.detail.callId),Fe=st.get(Ot(o));Fe.has(Me)&&he.get(Ot(o)).emit("streamRemoved",Fe.get(Me));var Dt=new Tn(X.detail.stream,{type:"audio"===X.detail.callType?"audio":"video",contact:se,streamId:Me,callId:X.detail.callId,callAudioAvailable:X.detail.audioIsAvailable,callAudioActive:X.detail.audioIsActive,callAudioMuted:X.detail.audioIsMuted,callVideoAvailable:X.detail.videoIsAvailable,callVideoActive:X.detail.videoIsActive,callVideoMuted:X.detail.videoIsMuted,screensharing:"screenSharing"===X.detail.callType,constructor:!0});Dt.publishedInConversations.set(o.getName(),X.detail.callId),st.get(Ot(o)).set(Me,Dt),he.get(Ot(o)).emit("streamAdded",Dt)}},remoteStreamRemoved:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me=st.get(Ot(o));Me.has(se)&&(he.get(Ot(o)).emit("streamRemoved",Me.get(se)),Me.delete(se))}},roomMemberUpdate:function(X){Ye.info("roomMemberUpdate event handler ",X);var se,Me=[],Fe=vn(X.detail.contactList);try{for(Fe.s();!(se=Fe.n()).done;)Me.push(zi.getOrCreateContact(se.value.contactId))}catch(ht){Fe.e(ht)}finally{Fe.f()}"whiteBoard"===X.detail.roomType&&(Ye.info("Received whiteboard room member update"),he.get(Ot(o)).emit("whiteboardRoomMemberUpdate",{contacts:Me,roomId:X.detail.roomId,status:X.detail.status}))},slowLink:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se};X.detail.advice&&(Me.advice=X.detail.advice),he.get(Ot(o)).emit("slowLink",Me)}},videoQualityChanged:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,hint:X.detail.hint,profileType:X.detail.profileType};X.detail.bitrate&&(Me.bitrate=X.detail.bitrate),X.detail.width&&X.detail.height&&(Me.width=X.detail.width,Me.height=X.detail.height),X.detail.frameRate&&(Me.frameRate=X.detail.frameRate),he.get(Ot(o)).emit("videoQualityChanged",Me)}},simulcastFeedChanged:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,simulcast:X.detail.simulcast};he.get(Ot(o)).emit("simulcastFeedChanged",Me)}},localStreamUpdated:function(X){if(X.detail.onCall&&o.callIdToStreamId.has(X.detail.callId)){var se={callId:X.detail.callId,streamId:X.detail.userMediaStreamId,audio:X.detail.audioIsAvailable&&X.detail.audioIsActive,audioMuted:X.detail.audioIsMuted,audioSilent:X.detail.audioIsSilent,video:X.detail.videoIsAvailable&&X.detail.videoIsActive,videoMuted:X.detail.videoIsMuted,videoSilent:X.detail.videoIsSilent,cause:X.detail.cause};he.get(Ot(o)).emit("localStreamUpdated",se)}},remoteStreamUpdated:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,audio:X.detail.audioIsAvailable&&X.detail.audioIsActive,audioMuted:X.detail.audioIsMuted,audioSilent:X.detail.audioIsSilent,video:X.detail.videoIsAvailable&&X.detail.videoIsActive,videoMuted:X.detail.videoIsMuted,videoSilent:X.detail.videoIsSilent,cause:X.detail.cause};setTimeout(function(){he.get(Ot(o)).emit("remoteStreamUpdated",Me)})}},MCURecordingStarted:function(X){if(X.detail.roomName===o._getTechnicalName()){var se=x.g.parseRecordingEvent("MCURecordingStarted",X.detail);if("COMPOSITE"===se.callId)o.recordingStatus=se;else{var Me=o.conversationCalls.get(se.callId);Me&&(Me.recordingStatus=se)}he.get(Ot(o)).emit("recordingStarted",se)}},MCURecordingStopped:function(X){if(X.detail.roomName===o._getTechnicalName()){var se=x.g.parseRecordingEvent("MCURecordingStopped",X.detail);if("COMPOSITE"===se.callId)delete o.recordingStatus;else{var Me=o.conversationCalls.get(se.callId);Me&&delete Me.recordingStatus}he.get(Ot(o)).emit("recordingStopped",se)}},MCURecordedStreamsAvailable:function(X){if(X.detail.roomName===o._getTechnicalName()){var se=x.g.parseRecordingEvent("MCURecordedStreamsAvailable",X.detail);he.get(Ot(o)).emit("recordingAvailable",se)}},MCUStreamingStarted:function(X){if(X.detail.roomName===o._getTechnicalName()){var se=ji("MCUStreamingStarted",X.detail),Me=o.conversationCalls.get(se.callId);Me&&(Me.streamingStatus=se),he.get(Ot(o)).emit("streamingStarted",se)}},MCUStreamingStopped:function(X){if(X.detail.roomName===o._getTechnicalName()){var se=ji("MCUStreamingStopped",X.detail),Me=o.conversationCalls.get(se.callId);Me&&delete Me.streamingStatus,he.get(Ot(o)).emit("streamingStopped",se)}},onCallStatsUpdate:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,stats:{}};X.detail.userId&&(Me.mesh=!0,Me.userId=X.detail.userId,Me.contact=zi.getOrCreateContact(X.detail.userId));for(var Fe=0,bt=Object.keys(X.detail.stats);Fe<bt.length;Fe++){var ht=bt[Fe];Oa.has(ht)&&(Me.stats[ht]=X.detail.stats[ht])}he.get(Ot(o)).emit("callStatsUpdate",Me)}},cpuLimited:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,encodeUsagePercent:X.detail.encodeUsagePercent};he.get(Ot(o)).emit("cpuLimited",Me)}},bandwidthLimited:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,resolutionChanged:!0};he.get(Ot(o)).emit("bandwidthLimited",Me)}},audioAmplitude:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me={callId:X.detail.callId,streamId:se,amplitude:X.detail.descriptor.amplitude,isSpeaking:X.detail.descriptor.isSpeaking,descriptor:{amplitude:X.detail.descriptor.amplitude,isSpeaking:X.detail.descriptor.isSpeaking}};he.get(Ot(o)).emit("audioAmplitude",Me)}},hangup:function(X){if(o.callIdToStreamId.has(X.detail.callId)){var se=o.callIdToStreamId.get(X.detail.callId),Me=st.get(Ot(o));Me.has(se)&&(he.get(Ot(o)).emit("streamRemoved",Me.get(se)),Me.delete(se)),"restarted"!==X.detail.reason&&"disconnected"!==X.detail.reason&&"Broken_by_MCU"!==X.detail.reason&&"RTC_Setup_Timeout"!==X.detail.reason&&(o.conversationCalls.has(X.detail.callId)?fn(Ot(o),X.detail.callId):(o.callIdToStreamId.delete(X.detail.callId),o.releaseResources(se,{isRemote:!0,triggerAdaptation:!0})),he.get(Ot(o)).emit("hangup",{from:X.detail.hangupType,reason:X.detail.reason,streamId:se}))}},callRestarting:function(X){if(o.callIdToStreamId.has(X.detail.oldCallId)){var se=o.callIdToStreamId.get(X.detail.oldCallId);o.callIdToStreamId.delete(X.detail.oldCallId),o.callIdToStreamId.set(X.detail.newCallId,se)}},MCUParticipantEjected:function(X){if(o._getTechnicalName()===X.detail.roomId){var se=He.get(Ot(o));if(X.detail.clientId===se.getId())o.leave().catch(function(Fe){Ye.error("leave",Fe)}).then(function(){he.get(Ot(o)).emit("participantEjected",{self:!0})});else{var Me=zi.getOrCreateContact(X.detail.clientId);he.get(Ot(o)).emit("participantEjected",{self:!1,contact:Me})}}},MCURoomModeChanged:function(X){o._getTechnicalName()===X.detail.roomId&&he.get(Ot(o)).emit("roomModeChanged",{oldMode:X.detail.oldMode,newMode:X.detail.newMode,state:X.detail.state})}};return St.set(Ot(o),$),he.get(Ot(o)).on("left",function(){o.pgroupWaitingRoomSubscribedTo&&(ut.apiRTCSession.unsubscribePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+o._getTechnicalName()]),o.pgroupWaitingRoomSubscribedTo=!1),Le.set(Ot(o),null),Ge.set(Ot(o),null),He.set(Ot(o),null),Xt.set(Ot(o),null)}),o}return _=H,Y=[{key:"destroy",value:function(){Dn.get().deleteConversation(this.getName());var a=Ct.get(this);if(a){if(a.apiRTCManager)for(var o in a.apiRTCManager)ut.removeEventListener(o,a.apiRTCManager[o]);a.contactCatalog&&zi.removeUpdateListener(a.contactCatalog.onUpdate),Ct.delete(this)}}},{key:"getStatus",value:function(){return this.status}},{key:"getName",value:function(){return sa.get(this).toString()}},{key:"_getTechnicalName",value:function(){return sa.get(this).toString()}},{key:"getRole",value:function(){return Le.get(this)}},{key:"getInstanceId",value:function(){return Xt.get(this)}},{key:"getFriendlyName",value:function(){return null}},{key:"getModerator",value:function(){return Ge.get(this)}},{key:"getType",value:function(){return fa.get(this)}},{key:"setType",value:function(a){return!this.isBound()&&!!Ra.has(a)&&(fa.set(this,a),!0)}},{key:"getCloudConversationId",value:function(){var a=ye.get(this);return a?a.toString():null}},{key:"bind",value:function(a){var o=this;a||(a={});var k=ye.get(this);return null!==k?Promise.resolve(String(k)):new Promise(function(F,z){mi(o,a).then(function($){F(String($.id))}).catch(function($){z(x.g.createError(i.g.ERROR_HTTP,"bind() - cannot bind conversation",Ye,{fromError:$}))})})}},{key:"isBound",value:function(){return null!==ye.get(this)}},{key:"isGroupChatJoined",value:function(){return this.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED}},{key:"joinGroupChat",value:function(){var a=this;return new Promise(function(o,k){if(a.groupChatStatus!==i.g.CONVERSATION_STATUS_NOT_JOINED)return k(x.g.createError(i.g.ERROR_WRONG_STATE,"joinGroupChat() - cannot join group chat",Ye));a.bind().then(function(){return new Promise(function(F,z){if(a.asyncCallbacks)return z(x.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - busy",Ye));a.asyncCallbacks={},a.asyncCallbacks.timeoutId=setTimeout(function(){return ut.removeEventListener("groupChatMemberUpdate",a.asyncCallbacks.groupChatMemberUpdate),delete a.asyncCallbacks,z(x.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - timeout",Ye))},i.g.CONVERSATION_GROUP_CHAT_MEMBER_UPDATE_DELAY),a.asyncCallbacks.groupChatMemberUpdate=function($){if($.detail.groupChatId===a._getTechnicalName()&&"online"===$.detail.status&&function(X,se){for(var Me=X.length;--Me>=0;)if(X[Me].contactId===se)return!0;return!1}($.detail.contactList,ut.getClientId()))return a.asyncCallbacks&&(ut.removeEventListener("groupChatMemberUpdate",a.asyncCallbacks.groupChatMemberUpdate),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks),F()},ut.onEvent("groupChatMemberUpdate",a.asyncCallbacks.groupChatMemberUpdate),ut.joinGroupChat(a._getTechnicalName())})}).then(function(){a.groupChatStatus=i.g.CONVERSATION_STATUS_JOINED,ut.joinAndSubscribeToPresenceGroup(a._getTechnicalName()),o()}).catch(function(F){k(x.g.createError(i.g.ERROR_OTHER,"joinGroupChat() - cannot join group chat",Ye,{fromError:F}))})})}},{key:"leaveGroupChat",value:function(){var a=this;return new Promise(function(o,k){return a.groupChatStatus!==i.g.CONVERSATION_STATUS_JOINED?k(x.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - group chat not joined",Ye)):a.status!==i.g.CONVERSATION_STATUS_NOT_JOINED?k(x.g.createError(i.g.ERROR_WRONG_STATE,"leaveGroupChat() - webconf active",Ye)):void ut.leaveGroupChat(a._getTechnicalName()).then(function(){a.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED,ut.leaveAndUnsubscribeToPresenceGroup(a._getTechnicalName()),o()}).catch(function(F){k(x.g.createError(i.g.ERROR_OTHER,"leaveGroupChat() - cannot leave group chat",Ye,{fromError:F}))})})}},{key:"isJoined",value:function(){return this.status===i.g.CONVERSATION_STATUS_JOINED}},{key:"isPublishedStream",value:function(a){return a.publishedInConversations.has(this.getName())}},{key:"publish",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){if(k.status!==i.g.CONVERSATION_STATUS_JOINED)return z(x.g.createError(i.g.ERROR_OTHER,"publish() - conversation not joined",Ye));if(!(a instanceof Tn))return z(x.g.createError(i.g.ERROR_OTHER,"publish() - No stream specified",Ye));if(k.isPublishedStream(a))return z(x.g.createError(i.g.ERROR_OTHER,"publish() - Stream is already published in this conversation!",Ye));var $={};$.userMediaStreamId=a.userMediaStreamId,null!==o&&"object"===Ia(o)&&($.audioOnly=o.audioOnly,$.videoOnly=o.videoOnly,$.private=o.private,$.record=o.record,$.turnServerAddress=o.turnServerAddress,$.profileType=o.profileType,$.priority=o.priority,$.downgradeProfileList=o.downgradeProfileList,$.distributedBroadcastEnabled=o.distributedBroadcastEnabled),x.g.isPropertyTypeof(o,"mediaType","string")&&($.mediaType=o.mediaType,$.audioOnly&&($.mediaType="AUDIOONLY"),$.videoOnly&&($.mediaType="VIDEOONLY")),x.g.isPropertyTypeof(o,"qos","object")&&($.qos={},x.g.isPropertyTypeof(o.qos,"videoMinBitrate","number")&&($.qos.videoMinBitrate=o.qos.videoMinBitrate),x.g.isPropertyTypeof(o.qos,"videoMinQuality","string")&&($.qos.videoMinQuality=o.qos.videoMinQuality),x.g.isPropertyTypeof(o.qos,"videoStartBitrate","number")&&($.qos.videoStartBitrate=o.qos.videoStartBitrate),x.g.isPropertyTypeof(o.qos,"videoStartQuality","string")&&($.qos.videoStartQuality=o.qos.videoStartQuality),x.g.isPropertyTypeof(o.qos,"videoForbidInactive","boolean")&&($.qos.videoForbidInactive=o.qos.videoForbidInactive)),x.g.isPropertyTypeof(o,"simulcast","object")&&!$.audioOnly&&($.simulcast={},x.g.isPropertyTypeof(o.simulcast,"mode","string")&&["RID","SDP"].indexOf(o.simulcast.mode)>=0&&($.simulcast.mode=o.simulcast.mode),x.g.isPropertyTypeof(o.simulcast,"maxBitrate","number")?$.simulcast.maxBitrate=o.simulcast.maxBitrate:x.g.isPropertyTypeof(o.simulcast,"encodings","object")&&($.simulcast.encodings=Object.assign({},o.simulcast.encodings))),["audioLabels","videoLabels"].forEach(function(Dt){x.g.isTypeof(o,Dt,"array")&&($[Dt]=[],o[Dt].forEach(function(Ut){x.g.isTypeof(Ut,"string")&&$[Dt].push(Ut)}))}),x.g.isPropertyTypeof(o,"context","object")&&($.context=o.context);var X=null;if(a.hasVideo()&&k.getNetworkCap({capacity:!0})&&o.profileType&&o.downgradeProfileList)for(var se=o.downgradeProfileList.length;--se>=0;)if(o.downgradeProfileList[se].name===o.profileType){o.downgradeProfileList[se].bitrate&&(X=o.downgradeProfileList[se].bitrate);break}if(X){if(!k.reserveResources(o.profileType,X,a.userMediaStreamId,!1,o.priority,{isVideoOnly:!a.hasAudio(),isVideoMuted:$.audioOnly,control:!0})&&!k.disableLowerPriorityVideo(!1,X,o.priority)){if(!a.hasAudio())return z(x.g.createError(i.g.ERROR_OTHER,"publish() - not enough bandwidth",Ye));$.audioOnly=!0}k.reserveResources(o.profileType,X,a.userMediaStreamId,!1,o.priority,{isVideoOnly:!a.hasAudio(),isVideoMuted:$.audioOnly})}Ye.info("callConfiguration:",$);var Me=a.isScreensharing(),Fe=ut.webRTCClient.publish(k.sessionId,k.sessionId,k.token,$,{},{forceScreenSharingCallType:Me});if(!Fe)return k.releaseResources(a.userMediaStreamId),z(x.g.createError(i.g.ERROR_OTHER,"publish() - failed to establish call",Ye));k.conversationCalls.set(Fe,new Va(k,Fe,a)),a.publishedInConversations.set(k.getName(),Fe),k.callIdToStreamId.set(Fe,a.userMediaStreamId);var bt={contact:null,isRemote:!1,hasAudio:a.hasAudio(),hasVideo:a.hasVideo(),isScreensharing:a.isScreensharing(),streamId:a.userMediaStreamId,callId:Fe};k.conversationPublishedStreams.set(a.userMediaStreamId,bt);var ht={callEstablishedHandler:function(Dt){Dt.detail.callId.toString()===Fe.toString()&&(ut.removeEventListener("callEstablished",ht.callEstablishedHandler),k.removeListener("error",ht.errorHandler),F(a))}};ut.onEvent("callEstablished",ht.callEstablishedHandler),ht.errorHandler=function(Dt){Dt.callId===Fe&&(ut.removeEventListener("callEstablished",ht.callEstablishedHandler),k.removeListener("error",ht.errorHandler),k.releaseResources(a.userMediaStreamId),z(x.g.createError(i.g.ERROR_OTHER,"publish() - "+Dt.errorInfo,Ye)))},k.on("error",ht.errorHandler)})}},{key:"unpublish",value:function(a,o){if(o||(o={}),a instanceof Tn)if(this.isPublishedStream(a)){var k=a.publishedInConversations.get(this.getName());fn(this,k,{stream:a,triggerAdaptation:!o.noTriggerAdaptation}),ut.webRTCClient.unpublish(k)}else Ye.error("unpublish() - Stream is not publishing to conversation");else Ye.error("unpublish() - No stream specified",a)}},{key:"getConversationCall",value:function(a){if(!a)return null;var o=a.publishedInConversations.get(this.getName());return o?this.conversationCalls.get(o):null}},{key:"getCallId",value:function(a){return a.publishedInConversations.get(this.getName())}},{key:"checkAccess",value:function(a){var o=this;return a||(a={}),new Promise(function(k,F){if(!0!==a.force&&o.accessStatus)return k(o.accessStatus);a.hasOwnProperty("session")||null===Ui.getActiveSession()||(a.session=Ui.getActiveSession()),o.bind(a).then(function(z){return a.convId=z,rn.checkConferenceAccess(o._getTechnicalName(),ut.getActiveApiKey(),a)}).then(function(z){return z.access!==i.g.CONVERSATION_ACCESS_GRANTED&&z.access!==i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION&&Ye.warn("checkAccess() - unknown access response:",z.access),z.role!==i.g.CONVERSATION_ROLE_MODERATOR&&z.role!==i.g.CONVERSATION_ROLE_CONTRIBUTOR&&z.role!==i.g.CONVERSATION_ROLE_GUEST&&Ye.warn("checkAccess() - unknown role response:",z.role),z.hasOwnProperty("webconfId")&&(o.webconfId=z.webconfId,delete z.webconfId),o.accessStatus=x.g.assignObject({},z),k(o.accessStatus)}).catch(function(z){F(x.g.createError(i.g.ERROR_APIRTC_INITIALISATION_FAILED,"checkAccess() - cannot check access",Ye,{fromError:z}))})})}},{key:"join",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ye.debug("Joining "+this.getName()),new Promise(function(k,F){if(a.status!==i.g.CONVERSATION_STATUS_NOT_JOINED)return F(x.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation",Ye));o=Object.assign({},o);var z=!1;o.qualityAdaptationEnabled&&(z=!0,delete o.qualityAdaptationEnabled);var $=null;o.supportedVideoCodecs&&($=o.supportedVideoCodecs,delete o.supportedVideoCodecs),a.checkAccess(o).then(function(X){if(!a.conference){if("public"!==X.type)return Promise.reject(x.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - wrong conference type",Ye));if(X.access!==i.g.CONVERSATION_ACCESS_GRANTED)return Promise.reject(x.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - access to conference not granted",Ye))}return ii(a,X)}).then(function(X){if(Le.set(a,X.role),a.status=i.g.CONVERSATION_STATUS_JOINING,a.conference)return o.hasOwnProperty("password")&&Nt.set(a,o.password),a.friendlyName=X.hasOwnProperty("friendlyName")?X.friendlyName:a.friendlyName,Xt.set(a,X.instanceId),on(a,He.get(a),ut.getActiveApiKey())}).then(function(){var X=a,se=function bt(ht){if(Ye.debug("joinMCUSessionAnswer",X._getTechnicalName(),ht.detail),ht.detail.roomId.toString()===X._getTechnicalName()){if(ht.detail.result&&ht.detail.result.failed)return Ye.error("Conversation "+X.getName()+" join failed",ht.detail),this.status=i.g.CONVERSATION_STATUS_NOT_JOINED,F(x.g.createError(i.g.ERROR_UNAUTHORIZED,"join() - "+(ht.detail.result.reason?ht.detail.result.reason:"join failed"),Ye));Ye.info("Conversation "+X.getName()+" joined",ht.detail),ut.removeEventListener("joinMCUSessionAnswer",bt),X.status=i.g.CONVERSATION_STATUS_JOINED,X.token=ht.detail.token,X.sessionId=ht.detail.sessionId,X.mode=ht.detail.mode,X.conversationStreams=new Map;var Ut=St.get(X);ut.onEvent("MCUAvailableStream",Ut.MCUAvailableStream).onEvent("MCUAvailableStreamUpdate",Ut.MCUAvailableStreamUpdate).onEvent("MCURemoveStream",Ut.MCURemoveStream).onEvent("MCUAvailableComposite",Ut.MCUAvailableComposite).onEvent("MCUAvailableReplay",Ut.MCUAvailableReplay).onEvent("MCUParticipantEjected",Ut.MCUParticipantEjected).onEvent("remoteStreamAdded",Ut.remoteStreamAdded).onEvent("remoteStreamRemoved",Ut.remoteStreamRemoved).onEvent("roomMemberUpdate",Ut.roomMemberUpdate).onEvent("slowLink",Ut.slowLink).onEvent("localStreamUpdated",Ut.localStreamUpdated).onEvent("remoteStreamUpdated",Ut.remoteStreamUpdated).onEvent("simulcastFeedChanged",Ut.simulcastFeedChanged).onEvent("MCURecordingStarted",Ut.MCURecordingStarted).onEvent("MCURecordingStopped",Ut.MCURecordingStopped).onEvent("MCURecordedStreamsAvailable",Ut.MCURecordedStreamsAvailable).onEvent("MCUStreamingStarted",Ut.MCUStreamingStarted).onEvent("MCUStreamingStopped",Ut.MCUStreamingStopped).onEvent("MCURoomModeChanged",Ut.MCURoomModeChanged).onEvent("onCallStatsUpdate",Ut.onCallStatsUpdate).onEvent("hangup",Ut.hangup).onEvent("callRestarting",Ut.callRestarting).onEvent("audioAmplitude",Ut.audioAmplitude).onEvent("videoQualityChanged",Ut.videoQualityChanged).onEvent("cpuLimited",Ut.cpuLimited).onEvent("bandwidthLimited",Ut.bandwidthLimited),X.conference&&X.updateData(),X.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&(ut.apiRTCSession.subscribePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+X._getTechnicalName()]),X.pgroupWaitingRoomSubscribedTo=!0),X.groupChatStatus!==i.g.CONVERSATION_STATUS_NOT_JOINED&&(X.groupChatStatus=i.g.CONVERSATION_STATUS_NOT_JOINED),he.get(X).emit("joined");var gi={};"mesh"===ht.detail.mode&&(gi.mode="mesh",!0===ht.detail.meshOnly&&(gi.meshOnly=!0)),k(gi)}};ut.onEvent("joinMCUSessionAnswer",se);var Me={};Me.convId=a.getCloudConversationId(),a.meshModeEnabled&&(Me.meshModeEnabled=a.meshModeEnabled),a.meshOnlyEnabled&&(Me.meshOnlyEnabled=a.meshOnlyEnabled),a.conference||(a.moderationEnabled&&(Me.moderationEnabled=!0),a.getRole()===i.g.CONVERSATION_ROLE_MODERATOR&&(Me.moderator=!0)),z&&(Me.qualityAdaptationEnabled=!0),$&&(Me.supportedVideoCodecs=$);var Fe=ut.webRTCClient.joinMCUSession(a._getTechnicalName(),Me);if(Fe instanceof Error)return ut.removeEventListener("joinMCUSessionAnswer",se),X.status=i.g.CONVERSATION_STATUS_NOT_JOINED,F(x.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation :"+Fe.message,Ye))}).catch(function(X){return a.status=i.g.CONVERSATION_STATUS_NOT_JOINED,F(x.g.createError(i.g.ERROR_OTHER,"join() - cannot join conversation",Ye,{fromError:X}))})})}},{key:"cancelJoin",value:function(){return null!==this.cancelJoin0&&"function"==typeof this.cancelJoin0&&this.cancelJoin0()}},{key:"eject",value:function(a,o){var k=this;return new Promise(function(F,z){if(k.status!==i.g.CONVERSATION_STATUS_JOINED)return z(x.g.createError(i.g.ERROR_OTHER,"eject() - conference not joined",Ye));if(k.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return z(x.g.createError(i.g.ERROR_UNAUTHORIZED,"eject() - only moderator can eject a contact",Ye));var $={};$.timeoutId=setTimeout(function(){return $&&(ut.removeEventListener("MCUParticipantEjected",$.ejected),$=!1),z(x.g.createError(i.g.ERROR_OTHER,"eject() - timeout",Ye))},i.g.CONVERSATION_PARTICIPANT_EJECTION_DELAY),$.ejected=function(X){if(X.detail.roomId===k._getTechnicalName()&&X.detail.clientId===a.getId())return $&&(clearTimeout($.timeoutId),ut.removeEventListener("MCUParticipantEjected",$.ejected),$=!1),F()},ut.onEvent("MCUParticipantEjected",$.ejected),ut.webRTCClient.ejectParticipantFromMCUSession(a.getId(),o)})}},{key:"allowEntry",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){if(k.status!==i.g.CONVERSATION_STATUS_JOINED)return z(x.g.createError(i.g.ERROR_OTHER,"allowEntry() - conference not joined",Ye));if(!(a instanceof ci))return z(x.g.createError(i.g.ERROR_BAD_PARAMETER,"allowEntry() - parameter is not an instance of apiRTC.Contact",Ye));if(k.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return z(x.g.createError(i.g.ERROR_UNAUTHORIZED,"allowEntry() - only moderator can allow entry to a contact",Ye));var $={roomname:k._getTechnicalName(),event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,access:!0,command:"access",value:{access:!0}};if(o.hasOwnProperty("invitationId")&&($.invitationId=o.invitationId),o.hasOwnProperty("answer")&&($.answer=o.answer),ut.sendData(a.getId(),$).catch(function(se){var Me=x.g.createError(se,"Notification not delivered",Ye);he.get(k).emit("messageNotDelivered",{error:Me,contact:a,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})}),!0===o.ackEnabled){var X=setInterval(function(){$.command="access-new",ut.sendData(a.getId(),$).catch(function(se){var Me=x.g.createError(se,"Notification not delivered",Ye);he.get(k).emit("messageNotDelivered",{error:Me,contact:a,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})})},i.g.CONVERSATION_JOIN_REQUEST_INTERVAL);ut.onEvent("receiveData",function se(Me){var Fe=zi.getOrCreateContact(Me.detail.senderId);Me.detail.hasOwnProperty("data")&&"access-ack"===Me.detail.data.command&&Me.detail.data.roomname===k._getTechnicalName()&&Fe.getId()===a.getId()&&(clearInterval(X),ut.removeEventListener("receiveData",se))})}return F()})}},{key:"denyEntry",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){if(k.status!==i.g.CONVERSATION_STATUS_JOINED)return z(x.g.createError(i.g.ERROR_OTHER,"denyEntry() - conference not joined",Ye));if(!(a instanceof ci))return z(x.g.createError(i.g.ERROR_BAD_PARAMETER,"denyEntry() - parameter is not an instance of apiRTC.Contact",Ye));if(k.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)return z(x.g.createError(i.g.ERROR_UNAUTHORIZED,"denyEntry() - only moderator can deny entry to a contact",Ye));var $={roomname:k._getTechnicalName(),event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,access:!1,command:"access",value:{access:!1}};return o.hasOwnProperty("invitationId")&&($.invitationId=o.invitationId),o.hasOwnProperty("answer")&&($.answer=o.answer),o.hasOwnProperty("reason")&&($.reason=o.reason),ut.sendData(a.getId(),$).catch(function(X){var se=x.g.createError(X,"Notification not delivered",Ye);he.get(k).emit("messageNotDelivered",{error:se,contact:a,event:i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER,command:"access"})}),F()})}},{key:"sendJoinRequest",value:function(){var a=this;if(this.status===i.g.CONVERSATION_STATUS_WAITING){if(!this.joinRequestIntervalId){var o=qi(this);o&&(ut.sendData(o,{roomname:this._getTechnicalName(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,invitationId:this._getTechnicalName(),sendTime:Date.now(),command:"userWaiting",value:{username:Kt()}}).catch(function(k){var F=x.g.createError(k,"Notification not delivered",Ye);he.get(a).emit("messageNotDelivered",{error:F,contact:a.getModerator(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,command:"userWaiting"})}),this.joinRequestIntervalId=setInterval(function(){ut.sendData(o,{roomname:a._getTechnicalName(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,invitationId:a._getTechnicalName(),sendTime:Date.now(),command:"userWaiting-new",value:{username:Kt()}}).catch(function(k){var F=x.g.createError(k,"Notification not delivered",Ye);he.get(a).emit("messageNotDelivered",{error:F,contact:a.getModerator(),event:i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER,command:"userWaiting-new"})})},i.g.CONVERSATION_JOIN_REQUEST_INTERVAL))}}else Ye.error("sendJoinRequest() - Not in conversation's waiting room, cannot send join request")}},{key:"leave",value:function(){var a=this;return new Promise(function(o,k){if(a.status!==i.g.CONVERSATION_STATUS_JOINED)return k(x.g.createError(i.g.ERROR_WRONG_STATE,"leave() - webconf not joined",Ye));for(var F=St.get(a),z=0,$=Object.keys(F);z<$.length;z++){var X=$[z];Ye.info("Session, removing apiRTCManager event :",X),ut.removeEventListener(X,F[X])}var Me,Fe=vn(a.conversationStreams.keys());try{for(Fe.s();!(Me=Fe.n()).done;){var bt=Me.value;Ye.trace("Leave() - unsubscribe to "+bt),ut.webRTCClient.unsubscribe(bt)}}catch(ht){Fe.e(ht)}finally{Fe.f()}sn(a,!1,!1).then(function(){}).catch(function(ht){}),ut.IMClient.leaveGroupChat(a._getTechnicalName()),a.whiteboardStarted===i.g.CONVERSATION_WHITEBOARD_STARTED&&ut.whiteBoardClient.roomId===a._getTechnicalName()&&(ut.whiteBoardClient.leaveRoom(),ut.whiteBoardClient.stop(),a.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_NOT_STARTED),ut.webRTCClient.leaveMCUSession(),a.conversationStreams=new Map,a.status=i.g.CONVERSATION_STATUS_NOT_JOINED,he.get(a).emit("left"),o()})}},{key:"subscribeToStream",value:function(a,o){var k=this;if(o||(o={}),Ye.debug("subscribeToMedia",a),!this.isJoined())return Promise.reject(x.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - conversation not joined",Ye));var F={};null!=o.turnServerAddress&&(F.turnServerAddress=o.turnServerAddress),x.g.isPropertyTypeof(o,"qos","object")&&(F.qos={},x.g.isPropertyTypeof(o.qos,"videoForbidInactive","boolean")&&(F.qos.videoForbidInactive=o.qos.videoForbidInactive));var z=Number(a),$=ut.webRTCClient.getStreamFromList(z),X=this.conversationStreams.get(z);if(!$||!X)return Promise.reject(x.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - no such stream",Ye));if(x.g.isPropertyTypeof(o,"simulcast","object")){var se=["high","medium","low"];F.simulcast={},o.simulcast.streamQuality&&(F.simulcast.streamQuality=se.indexOf(o.simulcast.streamQuality)>=0?o.simulcast.streamQuality:"default"),o.simulcast.streamFrameRate&&(F.simulcast.streamFrameRate=se.indexOf(o.simulcast.streamFrameRate)>=0?o.simulcast.streamFrameRate:"default")}return new Promise(function(Me,Fe){var bt="VIDEO";if(X.hasVideo&&k.getNetworkCap({capacity:!0})&&x.g.isPropertyTypeof(X,"descriptor","object")){var ht=X.descriptor;if(!k.reserveResources(ht.profileType,ht.bitrate,z,!0,ht.priority,{isVideoOnly:!X.hasAudio,isVideoMuted:o.audioOnly,control:!0})&&!k.disableLowerPriorityVideo(!0,ht.bitrate,ht.priority)){if(!X.hasAudio)return Fe(x.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - not enough bandwidth",Ye));o.audioOnly=!0}k.reserveResources(ht.profileType,ht.bitrate,z,!0,ht.priority,{isVideoOnly:!X.hasAudio,isVideoMuted:o.audioOnly})}!0===o.audioOnly?bt="AUDIOONLY":!0===o.videoOnly&&(bt="VIDEOONLY");var Dt=ut.webRTCClient.subscribe([$],bt,{},F,o)[0];if(!Dt)return k.releaseResources(z),Fe(x.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - stream not available",Ye));k.callIdToStreamId.set(Dt,z),Ye.debug("Subscribed to stream "+a+" through call "+Dt);var Ut={streamAddedHandler:function(gi){gi.streamId===z&&(k.removeListener("streamAdded",Ut.streamAddedHandler),k.removeListener("error",Ut.errorHandler),Me(gi))}};k.on("streamAdded",Ut.streamAddedHandler),Ut.errorHandler=function(gi){gi.callId===Dt&&(k.removeListener("streamAdded",Ut.streamAddedHandler),k.removeListener("error",Ut.errorHandler),k.releaseResources(z),Fe(x.g.createError(i.g.ERROR_OTHER,"subscribeToMedia() - "+gi.errorInfo,Ye)))},k.on("error",Ut.errorHandler)})}},{key:"updateSubscribedStream",value:function(a,o){o||(o={});var k=Number(a);if(!st.get(this).has(k))return Ye.error("updateSubscribedStream() - Conversation stream "+a+" does not exist or was not subscribed to"),Promise.reject("wrong streamId");var F=st.get(this).get(k);if(x.g.isTypeof(o.simulcast,"object"))return ut.webRTCClient.webRTCClient.updateSimulcastFeedOnCall(F.callId,o.simulcast);var z="VIDEO";return!0===o.audioOnly?z="AUDIOONLY":!0===o.videoOnly&&(z="VIDEOONLY"),ut.webRTCClient.webRTCClient.updateMediaTypeOnCall(F.callId,z)}},{key:"unsubscribeToStream",value:function(a,o){o||(o={});var k=Number(a);ut.webRTCClient.unsubscribe(k),this.releaseResources(a,{isRemote:!0,triggerAdaptation:!o.noTriggerAdaptation})}},{key:"subscribeToMedia",value:function(a,o){return this.subscribeToStream(a,o)}},{key:"unsubscribeToMedia",value:function(a){this.unsubscribeToStream(a)}},{key:"startRecording",value:function(a){var o=this;return a||(a={}),new Promise(function(k,F){if(o.status!==i.g.CONVERSATION_STATUS_JOINED)return F(x.g.createError(i.g.ERROR_OTHER,"startRecording() - conversation not joined",Ye));if(o.asyncCallbacks)return F(x.g.createError(i.g.ERROR_OTHER,"startRecording() - busy",Ye));o.asyncCallbacks={},o.asyncCallbacks.timeoutId=setTimeout(function(){return o.asyncCallbacks&&(ut.removeEventListener("error",o.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",o.asyncCallbacks.recordingStarted),delete o.asyncCallbacks),F(x.g.createError(i.g.ERROR_OTHER,"startRecording() - timeout",Ye))},i.g.CONVERSATION_RECORDING_STARTED_DELAY),o.asyncCallbacks.error=function(se){if(String(se.detail.convId)===o.getCloudConversationId()&&"COMPOSITE"===se.detail.callId&&se.detail.errorCode.indexOf("START_RECORD")>=0)return o.asyncCallbacks&&(ut.removeEventListener("error",o.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",o.asyncCallbacks.recordingStarted),clearTimeout(o.asyncCallbacks.timeoutId),delete o.asyncCallbacks),F(x.g.createError(i.g.ERROR_OTHER,"startRecording() - "+se.detail.errorInfo,Ye))},o.asyncCallbacks.recordingStarted=function(se){if(String(se.detail.convId)===o.getCloudConversationId()&&"COMPOSITE"===se.detail.callId){o.asyncCallbacks&&(ut.removeEventListener("error",o.asyncCallbacks.error),ut.removeEventListener("MCURecordingStarted",o.asyncCallbacks.recordingStarted),clearTimeout(o.asyncCallbacks.timeoutId),delete o.asyncCallbacks);var Me=x.g.parseRecordingEvent("MCURecordingStarted",se.detail);return k(Me)}},ut.onEvent("error",o.asyncCallbacks.error),ut.onEvent("MCURecordingStarted",o.asyncCallbacks.recordingStarted);var z="AUDIO-VIDEO";!0===a.audioOnly?z="AUDIO-ONLY":!0===a.videoOnly&&(z="VIDEO-ONLY");var $="composite";x.g.isPropertyTypeof(a,"customIdInFilename","string")&&($=a.customIdInFilename);var X={};x.g.isPropertyTypeof(a,"data","object")&&(X=x.g.assignObject({},a.data)),X.mode=["complete","efficient","audioOnly"].indexOf(a.mode)>=0?a.mode:"complete",X.labelEnabled=!0===a.labelEnabled,!0===X.labelEnabled&&(X.labels=[],x.g.isTypeof(a.labels,"array")&&a.labels.forEach(function(se){x.g.isTypeof(se,"string")&&X.labels.push(se)})),x.g.isTypeof(a,"ttl","number")&&a.ttl>0&&(X.ttl=a.ttl),ut.webRTCClient.startCompositeRecording(z,$,o.getCloudConversationId(),X)})}},{key:"stopRecording",value:function(){var a=this;return new Promise(function(o,k){if(a.asyncCallbacks)return k(x.g.createError(i.g.ERROR_OTHER,"stopRecording() - busy",Ye));a.asyncCallbacks={},a.asyncCallbacks.timeoutId=setTimeout(function(){return a.asyncCallbacks&&(ut.removeEventListener("error",a.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),delete a.asyncCallbacks),o(a.recordingStatus)},i.g.CONVERSATION_RECORDING_STOPPED_DELAY),a.asyncCallbacks.error=function(F){if(String(F.detail.convId)===a.getCloudConversationId()&&"COMPOSITE"===F.detail.callId&&F.detail.errorCode.indexOf("STOP_RECORD")>=0)return a.asyncCallbacks&&(ut.removeEventListener("error",a.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks),k(x.g.createError(i.g.ERROR_OTHER,"stopRecording() - "+F.detail.errorInfo,Ye))},a.asyncCallbacks.recordingStopped=function(F){if(String(F.detail.convId)===a.getCloudConversationId()&&"COMPOSITE"===F.detail.callId){a.asyncCallbacks&&(ut.removeEventListener("error",a.asyncCallbacks.error),ut.removeEventListener("MCURecordingStopped",a.asyncCallbacks.recordingStopped),clearTimeout(a.asyncCallbacks.timeoutId),delete a.asyncCallbacks);var z=x.g.parseRecordingEvent("MCURecordingStopped",F.detail);return o(z)}},ut.onEvent("error",a.asyncCallbacks.error),ut.onEvent("MCURecordingStopped",a.asyncCallbacks.recordingStopped),ut.webRTCClient.stopCompositeRecording()})}},{key:"getContacts",value:function(){Ye.debug("getContacts()");var a={};if(this.isBound()){var o,k=Mn.get().getContacts(this._getTechnicalName()),F=vn(k.keys());try{for(F.s();!(o=F.n()).done;){var z=o.value;a[z]=k.get(z)}}catch($){F.e($)}finally{F.f()}}else Ye.warn("getContacts() - Cannot get contacts as conversation is not joined");return a}},{key:"getContactsNumber",value:function(){Ye.debug("getContactsNumber()");var a=0;return this.isBound()?a=Mn.get().getContacts(this._getTechnicalName()).size:Ye.warn("getContactsNumber() - Cannot get contacts as conversation is not joined"),a}},{key:"getData",value:function(){return Ye.debug("getData()"),this.isBound()||Ye.warn("getData() - Cannot get most recent data as conversation is not joined, you may want to call Conversation.updateData() instead"),la.get(this)}},{key:"setData",value:function(a){var o=this;return new Promise(function(k,F){o.bind().then(function(){return rn.setConversationData(ye.get(o),JSON.stringify(a),ut.getActiveApiKey(),{token:He.get(o).token})}).then(function(){la.set(o,a),ut.dataClient.sendDataToGroup(o._getTechnicalName(),{event:i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER,roomname:o._getTechnicalName()}),k()}).catch(function(){F(x.g.createError(i.g.ERROR_OTHER,"setData() - cannot set conversation data",Ye))})})}},{key:"updateData",value:function(){var a=this;return new Promise(function(o,k){(a.isBound()?mi(a):a.bind()).then(function(){o(),he.get(a).emit("persistentDataUpdated",la.get(a))}).catch(function(F){k(x.g.createError(i.g.ERROR_OTHER,"updateData() - cannot update conversation data",Ye,{fromError:F}))})})}},{key:"getAvailableMediaList",value:function(){return Ye.warn("Function deprecated, please use Conversation.getAvailableStreamList() instead"),this.getAvailableStreamList()}},{key:"getAvailableStreamList",value:function(){var a,o=[],k=vn(this.conversationStreams.keys());try{for(k.s();!(a=k.n()).done;)o.push(this.conversationStreams.get(a.value))}catch(z){k.e(z)}finally{k.f()}return o}},{key:"getStreamInfo",value:function(a){return this.conversationStreams.get(a)}},{key:"getSubscribedStream",value:function(a){return st.get(this).get(Number(a))}},{key:"linkWhiteboardClientToConversation",value:function(){Ye.warn("DEPRECATED : linkWhiteboardClientToConversation : no more needed")}},{key:"startNewWhiteboardSession",value:function(a,o){var k=this;return Ye.debug("startNewWhiteboardSession()"),new Promise(function(F,z){k.bind().then(function(){if(k.asyncCallbacks)return z(x.g.createError(i.g.ERROR_OTHER,"startNewWhiteboardSession() - busy",Ye));if(k.whiteboardStarted!==i.g.CONVERSATION_WHITEBOARD_NOT_STARTED)return F();ut.whiteBoardClient.start(),k.asyncCallbacks={},k.asyncCallbacks.ackHandler=function(X){var se=X.detail;se.roomId===k._getTechnicalName()&&"whiteBoard"===se.roomType&&("roomCreation"===se.eventType&&"roomCreated"===se.status||"roomJoined"===se.eventType&&"roomJoined"===se.status)&&(k.asyncCallbacks&&(ut.removeEventListener("roomCreation",k.asyncCallbacks.ackHandler),ut.removeEventListener("roomJoined",k.asyncCallbacks.ackHandler),clearTimeout(k.asyncCallbacks.timeoutId),delete k.asyncCallbacks),ut.whiteBoardClient.setCanvas(a),null!=o&&ut.whiteBoardClient.setUserCursorColor(o),ut.whiteBoardClient.deleteHistory(),k.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_STARTED,F())},ut.onEvent("roomCreation",k.asyncCallbacks.ackHandler),ut.onEvent("roomJoined",k.asyncCallbacks.ackHandler),k.asyncCallbacks.timeoutId=setTimeout(function(){return k.asyncCallbacks&&(ut.removeEventListener("roomCreation",k.asyncCallbacks.ackHandler),ut.removeEventListener("roomJoined",k.asyncCallbacks.ackHandler),delete k.asyncCallbacks),z(x.g.createError(i.g.ERROR_OTHER,"startNewWhiteboardSession() - timeout",Ye))},i.g.CONVERSATION_WHITEBOARD_START_DELAY);var $=k.getCloudConversationId();ut.whiteBoardClient.joinRoom(k._getTechnicalName(),{convId:$,webconf:!0})}).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"startNewWhiteboardSession() - cannot start whiteboard session",Ye,{fromError:$}))})})}},{key:"stopNewWhiteboardSession",value:function(){var a=this;return Ye.debug("stopNewWhiteboardSession()"),new Promise(function(o,k){a.bind().then(function(){return a.whiteboardStarted!==i.g.CONVERSATION_WHITEBOARD_STARTED?(Ye.error("Conversation is not joined!"),k(x.g.createError(i.g.ERROR_WRONG_STATE,"stopWhiteBoard() - Conversation not joined",Ye))):ut.whiteBoardClient.roomId!==a._getTechnicalName()?(Ye.error("Whiteboard session is not joined for this conversation!"),k(x.g.createError(i.g.ERROR_WRONG_STATE,"stopWhiteBoard() - whiteboard not joined",Ye))):(ut.whiteBoardClient.leaveRoom(),ut.whiteBoardClient.stop(),a.whiteboardStarted=i.g.CONVERSATION_WHITEBOARD_NOT_STARTED,void o())}).catch(function(F){k(x.g.createError(i.g.ERROR_OTHER,"stopNewWhiteboardSession() - cannot stop whiteboard session",Ye,{fromError:F}))})})}},{key:"enablePointerSharing",value:function(a){return sn(this,!0,a)}},{key:"sendPointerLocation",value:function(a,o,k,F){ut.pointerSharingClient.sendPointerLocation(this._getTechnicalName(),a,o,k,F)}},{key:"sendData",value:function(a){var o=this;return new Promise(function(k,F){o.bind().then(function(){ut.dataClient.sendDataToGroup(o._getTechnicalName(),{event:i.g.CONVERSATION_SEND_DATA_IDENTIFIER,content:a,roomname:o._getTechnicalName()}),k()}).catch(function(z){F(x.g.createError(i.g.ERROR_OTHER,"sendData() - cannot send data",Ye))})})}},{key:"sendRawData",value:function(a){var o=this;return new Promise(function(k,F){o.bind().then(function(){ut.dataClient.sendDataToGroup(o._getTechnicalName(),a),k()}).catch(function(z){F(x.g.createError(i.g.ERROR_OTHER,"sendRawData() - cannot send data",Ye))})})}},{key:"sendCustomEvent",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(F,z){o.bind().then(function(){var $=k;$.event=a,$.roomname=o._getTechnicalName(),ut.dataClient.sendDataToGroup(o._getTechnicalName(),$),F()}).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"sendCustomEvent() - cannot send data",Ye))})})}},{key:"sendMessage",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){return k.groupChatStatus!==i.g.CONVERSATION_STATUS_JOINED&&k.status!==i.g.CONVERSATION_STATUS_JOINED?z(x.g.createError(i.g.ERROR_WRONG_STATE,"sendMessage() - group chat not joined",Ye)):null===a||"string"!=typeof a?z(x.g.createError(i.g.ERROR_BAD_PARAMETER,"sendMessage() - wrong type of message",Ye)):void k.bind().then(function(){var $={};return x.g.isTypeof(o,"metadata","object")&&($.metadata=o.metadata),ut.sendMessageToGroupChat(k._getTechnicalName(),a,$)}).then(function($){return X=$,new Promise(function(se,Me){var Fe=He.get(k);null!==Fe?rn.saveGroupChatMessage(k,Fe,ut.getActiveApiKey(),a,X,o).then(function(){se(X)}).catch(Me):se(X)});var X}).then(F).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"sendMessage() - cannot send message",Ye,{fromError:$}))})})}},{key:"pushMedia",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){k.bind().then(function(){return o.hasOwnProperty("token")||(o.token=He.get(k).token),rn.pushConversationMedia(ye.get(k),a,ut.getActiveApiKey(),o)}).then(function($){ut.dataClient.sendDataToGroup(k._getTechnicalName(),{event:i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER,roomname:k._getTechnicalName(),media:{url:$.url,id:$.id},command:"new_snapshot",value:{snapshot:$.url}}),F({url:$.url,id:$.id})}).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"pushMedia() - cannot push media",Ye,{fromError:$}))})})}},{key:"pushData",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return k=x.g.assignObject({},k),new Promise(function(F,z){if(!0!==ut.webRTCClient.webRTCClient.dataChannelCapable||!0===k.forceHTTP){if(!a.file)return z(x.g.createError(i.g.ERROR_BAD_PARAMETER,"pushData() - missing file",Ye));var $={};if(x.g.isTypeof(a,"metadata","object"))try{$.metadata=JSON.stringify(a.metadata)}catch(X){Ye.error("JSON.stringify",X)}$.asFile=!0,$.filename=x.g.isTypeof(a,"filename","string")?a.filename:a.file.name,!0===a.overwrite&&($.overwrite=!0),x.g.isTypeof(a,"ttl","number")&&a.ttl>0&&($.ttl=a.ttl),o.pushMedia(a.file,$).then(F).catch(z)}else o.bind().then(function(){var X=o._getTechnicalName(),se={};k.hasOwnProperty("turnServerAddress")&&(se.turnServerAddress=k.turnServerAddress,delete k.turnServerAddress);var Me=ut.webRTCClient.webRTCClient.pushData(o.getCloudConversationId(),a,se,{success:function(Fe){if("complete"!==Fe.state)return z(x.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",Ye));ut.dataClient.sendDataToGroup(X,{event:i.g.CONVERSATION_NEW_MEDIA_IDENTIFIER,roomname:X,media:{url:Fe.mediaURL,id:Fe.mediaId},command:"new_snapshot",value:{snapshot:Fe.mediaURL}}),F({url:Fe.mediaURL,id:Fe.mediaId})},failure:function(Fe,bt){if("iceFailed"===Fe){var ht=x.g.assignObject({},k);return ht.forceHTTP=!0,void o.pushData(a,ht).then(F).catch(z)}if("timeout"===Fe){if(bt){var Dt=o.transferCallIds.indexOf(bt);Dt>=0&&o.transferCallIds.splice(Dt,1)}return z(x.g.createError(i.g.ERROR_TIMED_OUT,"pushData() - push data timed out",Ye))}return z("canceled"===Fe?x.g.createError(i.g.ERROR_OPERATION_CANCELED,"pushData() - push data canceled",Ye):x.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",Ye,{fromError:Fe}))}});if(!Me)return z(x.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",Ye));o.transferCallIds.push(Me)}).catch(function(X){return z(x.g.createError(i.g.ERROR_OTHER,"pushData() - cannot push data",Ye,{fromError:X}))})})}},{key:"cancelPushData",value:function(a){var o=this;return new Promise(function(k,F){if(!o.transferCallIds.includes(a))return F(x.g.createError(i.g.ERROR_OTHER,"cancelPushData() - no such push data",Ye));var z=ut.webRTCClient.webRTCClient.cancelPushData(a);if(z)return F(x.g.createError(i.g.ERROR_OTHER,"cancelPushData() - "+z,Ye));k()})}},{key:"fetchMediaList",value:function(a,o){var k=this;return o||(o={}),new Promise(function(F,z){k.bind().then(function(){return Object.prototype.hasOwnProperty.call(o,"token")||(o.token=x.g.isTypeof(a,"object")&&a instanceof Ui?a.getToken():He.get(k).token),rn.getConversationMediaList(ye.get(k),ut.getActiveApiKey(),o)}).then(F).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"fetchMediaList() - cannot fetch media list",Ye,{fromError:$}))})})}},{key:"getWaitingRoomContacts",value:function(){Ye.debug("getWaitingRoomContacts()");var a={};if(this.status!==i.g.CONVERSATION_STATUS_JOINED)Ye.error("getWaitingRoomContacts() - Conversation is not joined, cannot get waiting room contacts");else if(this.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR)Ye.error("getWaitingRoomContacts() - Role is not moderator, cannot get waiting room contacts");else{var o,k=Mn.get().getContacts(i.g.CONVERSATION_WAITING_ROOM_PREFIX+this._getTechnicalName()),F=vn(k.keys());try{for(F.s();!(o=F.n()).done;){var z=o.value;a[z]=k.get(z)}}catch($){F.e($)}finally{F.f()}}return a}},{key:"fetchMessageHistory",value:function(a){var o=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(F,z){o.bind().then(function(){return Object.prototype.hasOwnProperty.call(k,"token")?rn.loadGroupChatMessages(o,null,k.token):(x.g.isTypeof(a,"object")&&a instanceof Ui||(a=He.get(o)),rn.loadGroupChatMessages(o,a))}).then(function($){var X=$.map(function(se){var Me={content:se.content,timestamp:1e3*se.created_at,date:new Date(1e3*se.created_at),sender_id:se.user_id,display_name:se.display_name};return se.user_id.toString()!==a.getId()&&(Me.sender=a.getOrCreateContact(se.user_id)),Me});F(X)}).catch(function($){z(x.g.createError(i.g.ERROR_OTHER,"fetchMessageHistory() - cannot fetch message history",Ye))})})}},{key:"sendInvitation",value:function(a,o){var k=this;if(o||(o={}),a instanceof ci){Ye.info("Invite "+a.getId()+" to "+this._getTechnicalName()),a.isOnline()||Ye.warn("sendInvitation() - contact "+a.getUsername()+" does not seem to be connected.");var F={receiveNotifier:new w};o.hasOwnProperty("expirationTime")&&(F.expirationTime=o.expirationTime);var z=new ft(a,this,F);z.type="conversation";var $={event:i.g.CONVERSATION_INVITATION_IDENTIFIER,invitationId:z.id,roomname:this._getTechnicalName(),sendTime:z.sendTime,conversationTypes:[]};return this.status===i.g.CONVERSATION_STATUS_JOINED?$.conversationTypes.push("WEBCONF"):this.groupChatStatus===i.g.CONVERSATION_STATUS_JOINED&&$.conversationTypes.push("GROUP_CHAT"),ut.sendData(a.getId(),$).then(function(){F.receiveNotifier.emit("receive")}).catch(function(X){var se=x.g.createError(X,"Invitation not delivered",Ye);he.get(k).emit("messageNotDelivered",{error:se,contact:a,event:i.g.CONVERSATION_INVITATION_IDENTIFIER})}),z}return Ye.error("Parameter is not a contact"),null}},{key:"isRecorded",value:function(){return!!this.recordingStatus}},{key:"getRecordingInfo",value:function(){return this.isRecorded()?this.recordingStatus:null}},{key:"setNetworkCap",value:function(a,o){return"number"!=typeof a||"number"!=typeof o?(Ye.error("setNetworkCap - wrong cap",a,o),!1):a<=0||o<=0?(this.uploadCap=null,this.downloadCap=null,!0):(this.uploadCap=a,this.downloadCap=o,!0)}},{key:"getNetworkCap",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.uploadCap||!this.downloadCap)return null;if(a.capacity)return[this.uploadCap,this.downloadCap];for(var o=this.uploadCap,k=this.downloadCap,F=this.reservedStreams.length;--F>=0;)this.reservedStreams[F].isVideoMuted||(this.reservedStreams[F].isRemote?k-=this.reservedStreams[F].resource:o-=this.reservedStreams[F].resource);return[o,k]}},{key:"getStreamResourceReservation",value:function(a){for(var o=this.reservedStreams.length;--o>=0;)if(this.reservedStreams[o].streamId===a)return this.reservedStreams[o];return null}},{key:"reserveResources",value:function(a,o,k,F,z){var $=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(Ye.debug("reserveResources",k),this.getStreamResourceReservation(k))throw new Error("reserveResources - already reserved stream");var X=!1,se={streamId:k,profileType:a,priority:z,resource:o,isRemote:F};if(se.isVideoOnly=!!$.isVideoOnly,$.isVideoMuted)se.isVideoMuted=!0,X=!0;else{se.isVideoMuted=!1;var Me=this.getNetworkCap();X=F?Me[1]>=se.resource:Me[0]>=se.resource}if($.control)return X;if(!X)throw new Error("reserveResources - no such bandwidth availability");return this.reservedStreams.push(se),this.reservedStreams.sort(function(Fe,bt){return Fe.priority>bt.priority?-1:Fe.priority===bt.priority?0:1}),Ye.debug("reservedStreams",this.reservedStreams),!0}},{key:"releaseResources",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.getNetworkCap({capacity:!0}))return!1;Ye.debug("releaseResources",a);for(var k=!1,F=this.reservedStreams.length;--F>=0;)if(this.reservedStreams[F].streamId===a){this.reservedStreams.splice(F,1),k=!0;break}return Ye.debug("reservedStreams",this.reservedStreams),k&&o.triggerAdaptation&&this.enableHigherPriorityVideo(!!o.isRemote),k}},{key:"changeStreamPriority",value:function(a,o,k){Ye.debug("changeStreamPriority",a,o,k);for(var F=null,z=this.reservedStreams.length;--z>=0;)if(this.reservedStreams[z].isRemote===o&&this.reservedStreams[z].streamId===a){F=this.reservedStreams[z];break}return!(!F||F.priority===k||(F.priority=k,this.reservedStreams.sort(function($,X){return $.priority>X.priority?-1:$.priority===X.priority?0:1}),Ye.debug("reservedStreams",this.reservedStreams),F.isVideoMuted?this.disableLowerPriorityVideo(F.isRemote,F.resource,F.priority)&&Vn(this,F):this.enableHigherPriorityVideo(F.isRemote,{resource:F.resource,priority:F.priority,control:!0})&&(Oi(this,F),this.enableHigherPriorityVideo(F.isRemote)),0))}},{key:"disableLowerPriorityVideo",value:function(a,o,k){Ye.debug("disableLowerPriorityVideo",a,o,k);for(var F=[],z=0,$=this.reservedStreams.length;--$>=0&&(this.reservedStreams[$].isRemote!==a||this.reservedStreams[$].isVideoMuted||this.reservedStreams[$].priority>=k||(F.push(this.reservedStreams[$]),!((z+=this.reservedStreams[$].resource)>=o))););if(0===F.length||z<o)return!1;for(var X=F.length;--X>=0;)Oi(this,F[X]);return!0}},{key:"enableHigherPriorityVideo",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ye.debug("enableHigherPriorityVideo",a);var k=this.getNetworkCap(),F=a?k[1]:k[0];o.resource&&o.resource>0&&(F+=o.resource);for(var z=[],$=0;$<this.reservedStreams.length;$+=1)this.reservedStreams[$].isRemote===a&&this.reservedStreams[$].isVideoMuted&&(Object.prototype.hasOwnProperty.call(o,"priority")&&this.reservedStreams[$].priority<=o.priority||this.reservedStreams[$].resource<=F&&(F-=this.reservedStreams[$].resource,z.push(this.reservedStreams[$])));if(0===z.length)return!1;if(o.control)return!0;for(var X=z.length;--X>=0;)Vn(this,z[X]);return!0}},{key:"startComposite",value:function(){var a=this;return new Promise(function(o,k){if(a.status!==i.g.CONVERSATION_STATUS_JOINED)return k(x.g.createError(i.g.ERROR_OTHER,"startComposite() - conversation not joined",Ye));ut.webRTCClient.startComposite(a._getTechnicalName()),o()})}},{key:"stopComposite",value:function(){var a=this;return new Promise(function(o,k){if(a.status!==i.g.CONVERSATION_STATUS_JOINED)return k(x.g.createError(i.g.ERROR_OTHER,"stopComposite() - conversation not joined",Ye));ut.webRTCClient.stopComposite(a._getTechnicalName()),o()})}},{key:"manageDisconnectionWarningEvent",value:function(a){Ye.debug("manageDisconnectionWarningEvent",a.detail);var o={};if(this.callIdToStreamId.has(a.detail.callId)){Ye.debug("call is linked with conversation");var k=this.callIdToStreamId.get(a.detail.callId);o="publish"===a.detail.settingUpType||"shareScreen"===a.detail.settingUpType?this.conversationPublishedStreams.get(k):this.conversationStreams.get(k),he.get(this).emit("disconnectionWarning",{streamInfo:o})}else Ye.debug("call is not linked with conversation")}},{key:"manageErrorEvent",value:function(a){if(Ye.debug("manageErrorEvent",a.detail),"DISTANT_ICE_CONNECTION_STATE_DISCONNECTED"===a.detail.errorCode||"DISTANT_ICE_CONNECTION_STATE_FAILED"===a.detail.errorCode)he.get(this).emit("error",{errorCode:a.detail.errorCode,errorInfo:a.detail.errorInfo,descriptor:a.detail.data});else if(this.callIdToStreamId.has(a.detail.callId)){Ye.debug("call is linked with conversation");var o=this.callIdToStreamId.get(a.detail.callId),k={streamInfo:"publish"===a.detail.settingUpType?this.conversationPublishedStreams.get(o):this.conversationStreams.get(o),errorCode:a.detail.errorCode,errorInfo:a.detail.errorInfo,callId:a.detail.callId,streamId:o};if(a.detail.data&&(k.descriptor=a.detail.data),he.get(this).emit("error",k),Ba.has(a.detail.errorCode)){var F=this.conversationCalls.get(a.detail.callId);F?this.unpublish(F.stream):(this.unsubscribeToStream(o),"CALL_ABORTED"===a.detail.errorCode&&this.callIdToStreamId.delete(a.detail.callId))}}else Ye.debug("call is not linked with conversation")}}],O=[{key:"getAvailableEvents",value:function(){return ir}}],Y&&Un(_.prototype,Y),O&&Un(_,O),H}(ke),Kt=function(){var D="guest";if(apiRTC.userAgentInstance){var _=apiRTC.userAgentInstance.getUsername();_&&(D=_)}return D},mi=function(D){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(Y,O){var U=null;if(x.g.isPropertyTypeof(_,"session","object")&&_.session instanceof Ui)U=_.session;else{if(null===Ui.getActiveSession())return O(x.g.createError(i.g.ERROR_BAD_PARAMETER,"getOrCreateConversation() - missing session",Ye));U=Ui.getActiveSession()}var de={};de.token=U.getToken(),de.active=D.active,rn.getOrCreateConversation(D,ut.getActiveApiKey(),de).then(function(fe){x.g.isTypeof(fe,"public_id","string")&&(fe.id=fe.public_id,delete fe.public_id),ye.set(D,fe.id),la.set(D,fe.data),x.g.isTypeof(fe.typeString,"string")&&Ra.has(fe.typeString)&&fa.set(D,fe.typeString),He.set(D,U),Y(fe)}).catch(function(fe){ye.set(D,null),la.set(D,null),fa.set(D,null),O(x.g.createError(i.g.ERROR_HTTP,"getOrCreateConversation() - cannot get/create conversation",Ye,{fromError:fe}))})})},qi=function(D){var _=D.getModerator();return _?_.getId():!D.conference&&D.moderationEnabled?"#":null},ii=function(D,_){return new Promise(function(Y,O){if(D.conference){if(_.access===i.g.CONVERSATION_ACCESS_GRANTED)return Y(_);if(_.access!==i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION)return O(x.g.createError(i.g.ERROR_BAD_PARAMETER,"You were not allowed to join the conference"));var U=zi.getOrCreateContact(_.moderator);Ge.set(D,U),Xi(D).then(function(){Y(_)}).catch(O)}else{if(!D.moderationEnabled)return Y(Object.assign(_,{access:i.g.CONVERSATION_ACCESS_GRANTED,role:i.g.CONVERSATION_ROLE_GUEST}));if(D.moderator)return Y(Object.assign(_,{access:i.g.CONVERSATION_ACCESS_GRANTED,role:i.g.CONVERSATION_ROLE_MODERATOR}));Xi(D).then(function(){Y(Object.assign(_,{access:i.g.CONVERSATION_NEED_MODERATOR_ACCEPTATION,role:i.g.CONVERSATION_ROLE_GUEST}))}).catch(O)}})},Xi=function(D){return new Promise(function(_,Y){var O=D.getModerator();D.status=i.g.CONVERSATION_STATUS_WAITING;var U=!1,de=setTimeout(function(){ut.apiRTCSession.joinPresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]),U=!0},i.g.JOIN_WAITING_ROOM_PRESENCE_GROUP_TIMEOUT);O&&he.get(D).emit("waitingForModeratorAcceptance",O);var fe=new ft(O,D);fe.id=D._getTechnicalName(),fe.type=D.conference?"conference":"conversation",D.sendJoinRequest();var H=function a(o){Ye.debug("dataMessage (waitingRoom)",o.detail);var k=o.detail.data;if(k.roomname===D._getTechnicalName()){var F=o.detail.senderId.toString();"access"===k.command||"access-new"===k.command||k.event===i.g.CONVERSATION_JOIN_ANSWER_IDENTIFIER?(delete D.cancelJoin0,D.joinRequestIntervalId&&(clearInterval(D.joinRequestIntervalId),delete D.joinRequestIntervalId),ut.removeEventListener("receiveData",a),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):de&&clearTimeout(de),k.value.hasOwnProperty("access")&&k.value.access||k.access?(ut.sendData(F,{roomname:D._getTechnicalName(),command:"access-ack"}).catch(function(z){var $=x.g.createError(z,"Notification not delivered",Ye);he.get(D).emit("messageNotDelivered",{error:$,contact:O,command:"access-ack"})}),_()):(D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,Y(x.g.createError(i.g.ERROR_NOT_ALLOWED,"You were not allowed to join the conversation",Ye)))):k.event===i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER&&k.roomname===D._getTechnicalName()&&he.get(D).emit("moderatorConnected",zi.getOrCreateContact(F))}};ut.onEvent("receiveData",H),fe.onResponse(function(a){ut.removeEventListener("receiveData",H),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):de&&clearTimeout(de),a===i.g.INVITATION_STATUS_ACCEPTED?_():(D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,Y(x.g.createError(i.g.ERROR_NOT_ALLOWED,"You were not allowed to join the conversation",Ye)))}),D.cancelJoin0=function(){return delete D.cancelJoin0,D.joinRequestIntervalId&&(clearInterval(D.joinRequestIntervalId),delete D.joinRequestIntervalId),ut.removeEventListener("receiveData",H),!0===U?ut.apiRTCSession.leavePresenceGroup([i.g.CONVERSATION_WAITING_ROOM_PREFIX+D._getTechnicalName()]):de&&clearTimeout(de),D.status=i.g.CONVERSATION_STATUS_NOT_JOINED,Y(x.g.createError(i.g.ERROR_OPERATION_CANCELED,"Operation canceled",Ye)),!0}})},on=function(D,_,Y){return new Promise(function(O){rn.updateConferencePresence(D,_,Y).then(O,function(U){Ye.warn("updateConferencePresence",U),O()})})},fn=function(D,_){var Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=Y.stream;if(!O){var U=D.conversationCalls.get(_);if(!U)return!1;O=U.stream}return Y.noTriggerAdaptation?D.releaseResources(O.userMediaStreamId):D.releaseResources(O.userMediaStreamId,{triggerAdaptation:!0}),O.publishedInConversations.delete(D.getName()),D.conversationPublishedStreams.delete(O.userMediaStreamId),D.callIdToStreamId.delete(_),D.conversationCalls.delete(_),!0},Oi=function(D,_){var Y={streamId:_.streamId,isRemote:_.isRemote};if(_.isRemote)if(_.isVideoOnly){Y.action="hangup";var O=st.get(D).get(_.streamId);O&&(Y.callId=O.callId),Ye.debug("disableVideoTrack - hangup",_.streamId),D.unsubscribeToStream(_.streamId,{noTriggerAdaptation:!0})}else{Y.action="disableTrack",Y.trackType="video";var U=st.get(D).get(_.streamId);U&&(Y.callId=U.callId),Ye.debug("disableVideoTrack - disable video track",_.streamId),D.updateSubscribedStream(_.streamId,{audioOnly:!0}).catch(function(a){Ye.error("disableVideoTrack - updateSubscribedStream",a)}),_.isVideoMuted=!0}else if(_.isVideoOnly){Y.action="hangup";var de=Fn.get(_.streamId),fe=D.getConversationCall(de);fe&&(Y.callId=fe.callId),Ye.debug("disableVideoTrack - hangup",_.streamId),D.unpublish(de,{noTriggerAdaptation:!0})}else{var H=D.getConversationCall(Fn.get(_.streamId));H?(Y.action="disableTrack",Y.trackType="video",Y.callId=H.callId,Ye.debug("disableVideoTrack - disable video track",_.streamId),H.updatePublishedStream("video",!1).catch(function(a){Ye.error("disableVideoTrack - updatePublishedStream",a)}),_.isVideoMuted=!0):Y=null}Y&&he.get(D).emit("adaptationTriggered",Y)},Vn=function(D,_){var Y={streamId:_.streamId,isRemote:_.isRemote,action:"enableTrack",trackType:"video"};if(_.isRemote){var O=st.get(D).get(_.streamId);O&&(Y.callId=O.callId),Ye.debug("enableVideoTrack - enable video track",_.streamId),D.updateSubscribedStream(_.streamId,{audioOnly:!1}).catch(function(de){Ye.error("enableVideoTrack - updateSubscribedStream",de)}),_.isVideoMuted=!1}else{var U=D.getConversationCall(Fn.get(_.streamId));U?(Y.callId=U.callId,Ye.debug("enableVideoTrack - enable video track",_.streamId),U.updatePublishedStream("video",!0).catch(function(de){Ye.error("enableVideoTrack - updatePublishedStream",de)}),_.isVideoMuted=!1):Y=null}Y&&he.get(D).emit("adaptationTriggered",Y)},sn=function(D,_,Y){return!0===Y?D.pointerSharingState===i.g.STATE_IDLE?(D.pointerSharingState=i.g.STATE_JOINING,new Promise(function(O,U){ut.pointerSharingClient.joinRoom(D._getTechnicalName(),{success:function(de){D.pointerSharingState=i.g.STATE_ACTIVE,!0===_&&(D.pointerSharingAutoInvite=!0);var fe={enabled:!0,roomId:de};he.get(D).emit("pointerSharingEnabled",fe),O(),!0===D.pointerSharingAutoInvite&&zi.getContacts(D._getTechnicalName()).forEach(function(H){ut.pointerSharingClient.inviteInRoom(D._getTechnicalName(),H.getId())})},failure:function(de,fe){D.pointerSharingState=i.g.STATE_IDLE,D.pointerSharingAutoInvite=!1,U(de)}})})):Promise.reject(x.g.createError(i.g.ERROR_WRONG_STATE,"enablePointerSharing() - cannot enable pointer sharing")):!1===Y?D.pointerSharingState===i.g.STATE_ACTIVE?(D.pointerSharingState=i.g.STATE_LEAVING,new Promise(function(O,U){ut.pointerSharingClient.leaveRoom(D._getTechnicalName()),D.pointerSharingState=i.g.STATE_IDLE,D.pointerSharingAutoInvite=!1;var de={enabled:!1,roomId:D._getTechnicalName()};he.get(D).emit("pointerSharingEnabled",de),O()})):Promise.reject(x.g.createError(i.g.ERROR_WRONG_STATE,"enablePointerSharing() - cannot disable pointer sharing")):Promise.reject(x.g.createError(i.g.ERROR_BAD_PARAMETER,"enablePointerSharing() - cannot enable/disable pointer sharing"))},ji=function(D,_){var Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return["roomName","callId","clientId"].forEach(function(O){_.hasOwnProperty(O)&&(Y[O]=String(_[O]))}),Y};function _n(D){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function _a(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Ga(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function Da(D,_,Y){return(Da="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(O,U,de){var fe=function(a,o){for(;!Object.prototype.hasOwnProperty.call(a,o)&&null!==(a=ka(a)););return a}(O,U);if(fe){var H=Object.getOwnPropertyDescriptor(fe,U);return H.get?H.get.call(de):H.value}})(D,_,Y||D)}function qa(D,_){return(qa=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function co(D,_){if(_&&("object"===_n(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return function(Y){if(void 0===Y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(D)}function ka(D){return(ka=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}e(2222);var Qi=R.Y.get("Conference"),uo=qt.getAvailableEvents().concat(["closed"]),nr=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&qa(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=ka(U);if(de){var k=ka(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return co(this,a)});function H(a){var o,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _a(this,H),o=fe.call(this,a,k),Qi.info("Create conference"),o.conference=!0,o.friendlyName=k.hasOwnProperty("friendlyName")?k.friendlyName:a,o}return _=H,O=[{key:"getAvailableEvents",value:function(){return uo}}],(Y=[{key:"destroy",value:function(){Dn.get().deleteConference(this.getName()),Da(ka(H.prototype),"destroy",this).call(this)}},{key:"_getTechnicalName",value:function(){return ho()+sa.get(this)}},{key:"getFriendlyName",value:function(){return this.friendlyName}},{key:"getInfo",value:function(){var a=this;return new Promise(function(o,k){var F={},z=He.get(a);z&&(F.token=z.getToken()),rn.getWebconf(a._getTechnicalName(),F).then(function($){return o({dtmfCode:$.dtmfCode,endTime:$.end,hasPassword:$.hasPassword,sipNumber:$.sipNumber,startTime:$.start,state:$.state,type:$.type})}).catch(function($){return k(x.g.createError(i.g.ERROR_OTHER,"getInfo() - Cannot get conference info",Qi))})})}},{key:"close",value:function(){var a=this;return Qi.debug("Closing "+this.getName()),new Promise(function(o,k){a.status!==i.g.CONVERSATION_STATUS_JOINED?k(x.g.createError(i.g.ERROR_OTHER,"close() - Conversation has to be joined to be closed",Qi)):a.getRole()!==i.g.CONVERSATION_ROLE_MODERATOR?k(x.g.createError(i.g.ERROR_UNAUTHORIZED,"close() - Role has to be moderator to close the conversation",Qi)):rn.closeConferenceInstance(a,He.get(a)).then(function(){Qi.debug("Conversation closed successfully"),ut.dataClient.sendDataToGroup(a._getTechnicalName(),{event:i.g.CONVERSATION_CLOSED_IDENTIFIER,instanceId:a.getInstanceId(),roomname:a._getTechnicalName()}),he.get(a).emit("closed"),a.leave(),o()}).catch(function(F){var z="close() - An error occured when closing conversation",$={error:new Error(z),code:i.g.ERROR_OTHER};Qi.error(z,F),F.hasOwnProperty("code")?$.code=F.code:F.hasOwnProperty("http_code")&&($.code=F.http_code.toString().startsWith("4")?i.g.ERROR_UNAUTHORIZED:i.g.ERROR_SERVER_UNAVAILABLE),k($)})})}},{key:"sendInvitation",value:function(a,o){var k=this;if(o||(o={}),a instanceof ci){Qi.info("Invite "+a.getId()+" to "+this._getTechnicalName()),a.isOnline()||Qi.warn("sendInvitation() - contact "+a.getUsername()+" does not seem to be connected.");var F={receiveNotifier:new w};o.hasOwnProperty("expirationTime")&&(F.expirationTime=o.expirationTime);var z=new ft(a,this,F),$={event:i.g.CONVERSATION_INVITATION_IDENTIFIER,invitationId:z.id,roomname:this._getTechnicalName(),friendlyName:this.getFriendlyName(),sendTime:z.sendTime};return z.type="conference",null!==Nt.get(this)&&($.password=Nt.get(this)),ut.sendData(a.getId(),$).then(function(){F.receiveNotifier.emit("receive")}).catch(function(X){var se=x.g.createError(X,"Invitation not delivered",Qi);he.get(k).emit("messageNotDelivered",{error:se,contact:a,event:i.g.CONVERSATION_INVITATION_IDENTIFIER})}),z}return Qi.error("Parameter is not a contact"),null}},{key:"getTags",value:function(){var a=this;return new Promise(function(o,k){var F=Ui.getActiveSession();if(!F)return k(x.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - no session found",Qi));var z=F.getUserAgent().getEnterprise();if(!z)return k(x.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - no enterprise found",Qi));z.getTags(a).then(function($){for(var X=[],se=0;se<$.length;se+=1)!0===$[se].selected&&X.push($[se]);return o(X)}).catch(function($){return k(x.g.createError(i.g.ERROR_NOT_ALLOWED,"getTags() - cannot get tags",Qi,{fromError:$}))})})}},{key:"setTags",value:function(a){var o=this;return new Promise(function(k,F){if(!Array.isArray(a))return F(x.g.createError(i.g.ERROR_BAD_PARAMETER,"setTags() - wrong tags",Qi));if(!o.webconfId)return F(x.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no webconf found",Qi));var z=Ui.getActiveSession();if(!z)return F(x.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no session found",Qi));var $=z.getUserAgent().getEnterprise();if(!$)return F(x.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no enterprise found",Qi));var X=z.getToken();if(!X)return F(x.g.createError(i.g.ERROR_NOT_ALLOWED,"setTags() - no token found",Qi));for(var se=[],Me=0;Me<a.length;Me+=1){if(!a[Me].hasOwnProperty("id"))return F(x.g.createError(i.g.ERROR_BAD_PARAMETER,"setTags() - wrong tags",Qi));se.push(a[Me].id)}rn.updateWebconfTags($.getId(),o.webconfId,se,X).then(function(){return k()}).catch(function(Fe){return F(x.g.createError(i.g.ERROR_OTHER,"setTags() - cannot set tags",Qi,{fromError:Fe}))})})}}])&&Ga(_.prototype,Y),O&&Ga(_,O),H}(qt),ho=function(){return ut.getActiveApiKey()+":"};function Or(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}R.Y.get("ConversationCatalog");var Ha=null,Dn=function(){function D(){if(function(U,de){if(!(U instanceof de))throw new TypeError("Cannot call a class as a function")}(this,D),null!==Ha)throw"Cannot construct singleton ConversationCatalog";this.conversationList=new Map,this.conferenceList=new Map,Ha=this}var _,Y,O;return _=D,Y=[{key:"deleteConversation",value:function(U){return!!(x.g.isTypeof(U,"string")&&U.length>0)&&this.conversationList.delete(U)}},{key:"deleteConference",value:function(U){return!!(x.g.isTypeof(U,"string")&&U.length>0)&&this.conferenceList.delete(U)}},{key:"getOrCreateConversation",value:function(U){var de=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},fe=null;return null!=U&&""!==U?this.conversationList.has(U.toString())?fe=this.conversationList.get(U.toString()):(fe=new qt(U.toString(),de),this.conversationList.set(U.toString(),fe)):(fe=new qt(null,de),this.conversationList.set(fe.getName(),fe)),fe}},{key:"getOrCreateConference",value:function(U){var de=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},fe=null;return null!=U&&""!==U?this.conferenceList.has(U.toString())?fe=this.conferenceList.get(U.toString()):(fe=new nr(U.toString(),de),this.conferenceList.set(U.toString(),fe)):(fe=new nr(null,de),this.conferenceList.set(fe.getName(),fe)),fe}},{key:"getConversations",value:function(){return this.conversationList}},{key:"getConferences",value:function(){return this.conferenceList}},{key:"isConference",value:function(U){return _r(U).hasOwnProperty("apiKey")}},{key:"getNameFromTechnicalName",value:function(U){return _r(U).name}}],O=[{key:"get",value:function(){return null===Ha&&(Ha=new D),Ha}}],Y&&Or(_.prototype,Y),O&&Or(_,O),D}();function _r(D){var _=D.match(/^([^:]+)[:]([^:]+)$/);return null===_||_.length<3?{name:D}:{apiKey:_[1],name:_[2]}}function pr(D){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Na(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Dr(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Dr(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Dr(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function kr(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function fr(D,_){return(fr=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function po(D,_){if(_&&("object"===pr(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return hi(D)}function hi(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function ar(D){return(ar=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var At=R.Y.get("Session"),Ni=ie.get(),Ja=new pe.Z,Cn=Ci.get(),fo=["rawData","whiteboardInvitation","fileTransferInvitation","conversationMessage","conversationData","dataChannelInvitation","contactMessage","contactData","customEvent","conversationInvitation","incomingCall","disconnect","error","contactListUpdate","reconnecting","reconnection","conversationJoinRequest","newMediaAvailableFromContact","whiteboardRoomMemberUpdate","incomingScreenSharingCall","pointerSharingInvitation","pointerLocationChanged","incomingScreenSharingCallInvitation","cloudEventOccurred"],Nr=new WeakMap,Ya=new WeakMap,rr=null,mr=new WeakMap,za=new WeakMap,Ui=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&fr(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=ar(U);if(de){var k=ar(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return po(this,a)});function H(a){var o;(function($,X){if(!($ instanceof X))throw new TypeError("Cannot call a class as a function")})(this,H),o=fe.call(this,At),At.debug("Create Session"),o.id=null,o.token=null,o.ccsToken=null,Nr.set(hi(o),a),Ya.set(hi(o),null),za.set(hi(o),{}),o.isRecording=!1,o.userData=new Ke,o.contactListUpdateListenerSetted=!1,o.waitingContactListUpdateEvent=[];var k=Mn.get(),F=Dn.get(),z={};return o.invitationsMap=new Map,z.channelEvent=function($){switch($.detail.channelEvent){case"onChannelReconnecting":he.get(hi(o)).emit("reconnecting",$);break;case"onChannelReconnect":he.get(hi(o)).emit("reconnection",$);break;case"onChannelError":he.get(hi(o)).emit("error",$);break;case"onChannelDisconnect":At.error("Session :: onChannelDisconnect"),he.get(hi(o)).emit("disconnect",$)}},z.incomingCall=function($){var X=k.getOrCreateContact($.detail.callerId),se=$.detail.callId.toString();if("data"===$.detail.callType)if(At.info("Received file transfer invitation from "+X.getUsername()),x.g._private.dataCallsFileInfo.has(se)){var Me=x.g._private.dataCallsFileInfo.get(se),Fe=null;o.invitationsMap.has($.detail.callerId+"-sendfile-"+se)?(Fe=o.invitationsMap.get($.detail.callerId+"-sendfile-"+se),At.debug("invitation already exist :",Fe)):(Fe=new Rn(X,se,Me),o.invitationsMap.set($.detail.callerId+"-sendfile-"+se,Fe)),he.get(hi(o)).emit("fileTransferInvitation",Fe)}else x.g._private.dataChannelInvitations.has(se)?he.get(hi(o)).emit("dataChannelInvitation",new mn(X,se)):(At.debug("File information has not been received yet, putting invitation on hold"),x.g._private.dataCallsOnHold.set(se));else if("screenSharing"===$.detail.callType)if(!0===apiRTC.session.apiCCWebRTCClient.webRTCClient.userAcceptOnIncomingScreenSharingCall){At.debug("Received screenSharingCallInvitation from "+X.getUsername());var bt=new Di(X,se,$.detail.callType,{isRecorded:!!$.detail.hasOwnProperty("recordedCall")&&$.detail.recordedCall});he.get(hi(o)).emit("incomingScreenSharingCallInvitation",bt)}else{At.debug("Received screenSharingCall from "+X.getUsername());var ht=Cn.getOrCreateCall(se,X,{started:!0,isRecorded:!!$.detail.hasOwnProperty("recordedCall")&&$.detail.recordedCall});he.get(hi(o)).emit("incomingScreenSharingCall",ht)}else{At.info("Received call invitation from "+X.getUsername());var Dt=new Di(X,se,$.detail.callType,{isRecorded:!!$.detail.hasOwnProperty("recordedCall")&&$.detail.recordedCall});he.get(hi(o)).emit("incomingCall",Dt)}},z.roomInvitation=function($){var X=k.getOrCreateContact($.detail.senderId);if("whiteBoard"===$.detail.roomType){if(null!==X){At.info("Received whiteboard invitation from "+X.getUsername());var se={};$.detail.cloudConvId&&(se.cloudConvId=$.detail.cloudConvId),!0===$.detail.webconf&&(se.webconf=!0),he.get(hi(o)).emit("whiteboardInvitation",new Bt(X,$.detail.roomId,se))}}else"pointerSharing"===$.detail.roomType&&(null===X||F.getConversations().has($.detail.roomId)||F.getConferences().has($.detail.roomId)||(At.info("Received pointer sharing invitation from "+X.getUsername()),he.get(hi(o)).emit("pointerSharingInvitation",new Q(X,$.detail.roomId,hi(o)))))},z.roomMemberUpdate=function($){var X,se=[],Me=Na($.detail.contactList);try{for(Me.s();!(X=Me.n()).done;)se.push(k.getOrCreateContact(X.value.contactId))}catch(bt){Me.e(bt)}finally{Me.f()}"whiteBoard"===$.detail.roomType&&(At.info("Received whiteboard room member update"),he.get(hi(o)).emit("whiteboardRoomMemberUpdate",{contacts:se,roomId:$.detail.roomId,status:$.detail.status}))},z.receiveRoomMessage=function($){if(At.debug("receiveRoomMessage",$),"pointerSharing"===$.detail.roomType&&"pointerLocation"===$.detail.message.type&&za.get(hi(o)).hasOwnProperty($.detail.roomId)){var X={sender:k.getOrCreateContact($.detail.senderId),source:$.detail.message.source,x:$.detail.message.x,y:$.detail.message.y};x.g.isPropertyTypeof($.detail.message,"data","object")&&(X.data=$.detail.message.data),he.get(hi(o)).emit("pointerLocationChanged",X)}},z.receiveIMMessage=function($){var X=k.getOrCreateContact($.detail.senderId);At.debug("Received IM from "+X.getUsername()+" : ",$.detail.message),he.get(hi(o)).emit("contactMessage",{sender:X,content:$.detail.message,uuid:$.detail.UUCSeq,time:$.detail.time})},z.receiveData=function($){var X=k.getOrCreateContact($.detail.senderId),se=$.detail.data,Me=null;if(void 0!==se.roomname&&(Me=F.isConference(se.roomname)?F.getOrCreateConference(F.getNameFromTechnicalName(se.roomname)):F.getOrCreateConversation(F.getNameFromTechnicalName(se.roomname))),At.trace("Received data from "+X.getId(),$.detail),he.get(hi(o)).emit("rawData",{sender:X,content:se}),void 0!==se.event)switch(se.event){case i.g.INVITATION_ANSWER_IDENTIFIER:case i.g.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER:case i.g.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER:case i.g.CONVERSATION_CLOSED_IDENTIFIER:break;case i.g.CONTACT_SEND_DATA_IDENTIFIER:At.debug("Received contact data from "+X.getUsername(),se.content),he.get(hi(o)).emit("contactData",{sender:X,content:se.content});break;case i.g.CONVERSATION_SEND_DATA_IDENTIFIER:void 0!==se.roomname&&(At.debug("Received conversation data from "+X.getUsername(),se.content),he.get(hi(o)).emit("conversationData",{sender:X,conversation:Me,content:se.content}));break;case i.g.CONTACT_NEW_MEDIA_IDENTIFIER:he.get(hi(o)).emit("newMediaAvailableFromContact",{sender:X,media:se.media});break;case i.g.CONTACT_DATACHANNEL_INVITATION:At.debug("Received datachannel invitation from "+X.getUsername()),x.g._private.dataChannelInvitations.set(se.callId.toString(),!0),x.g._private.dataCallsOnHold.has(se.callId.toString())&&he.get(hi(o)).emit("dataChannelInvitation",new mn(X,se.callId.toString()));break;case i.g.CONTACT_SEND_FILEINFO_IDENTIFIER:At.debug("Received file info from "+X.getUsername(),se.fileInfo);var Fe=se.callId.toString();if(x.g._private.dataCallsFileInfo.set(Fe,se.fileInfo),x.g._private.dataCallsOnHold.has(Fe)){var bt=null;o.invitationsMap.has(X.getId()+"-sendfile-"+Fe)?(bt=o.invitationsMap.get(X.getId()+"-sendfile-"+Fe),At.debug("invitation already exist :",bt)):(bt=new Rn(X,Fe,se.fileInfo),o.invitationsMap.set($.detail.callerId+"-sendfile-"+Fe,bt)),he.get(hi(o)).emit("fileTransferInvitation",bt)}else At.debug("no dataCallsOnHold");break;case i.g.CONVERSATION_INVITATION_IDENTIFIER:if(void 0!==se.roomname){At.info("Received conversation invitation from "+X.getUsername());var ht={session:hi(o)};se.hasOwnProperty("password")&&(ht.password=se.password),Me?(se.hasOwnProperty("friendlyName")&&Me.name===Me.friendlyName&&(Me.friendlyName=se.friendlyName),he.get(hi(o)).emit("conversationInvitation",new L(X,se,Me,ht))):he.get(hi(o)).emit("conversationInvitation",new L(X,se,null,ht))}break;case i.g.CONVERSATION_JOIN_REQUEST_IDENTIFIER:At.info("Received conversation join request from "+X.getUsername()),Me?he.get(hi(o)).emit("conversationJoinRequest",new Yn(X,Me,se.invitationId)):he.get(hi(o)).emit("conversationJoinRequest",new Yn(X,null,null));break;default:var Dt={event:se.event,content:se,sender:X};null!==Me&&(Dt.conversation=Me),he.get(hi(o)).emit("customEvent",Dt)}else if(void 0!==se.command)switch(se.command){case"userWaiting":case"userWaiting-new":At.info("Received conversation join request from "+X.getUsername()),Me?he.get(hi(o)).emit("conversationJoinRequest",new Yn(X,Me,null)):he.get(hi(o)).emit("conversationJoinRequest",new Yn(X,null,null))}},z.receiveGroupChatMessage=function($){var X=k.getOrCreateContact($.detail.senderId),se=null,Me=$.detail.groupChatId.toString();if(void 0!==Me&&(se=F.isConference(Me)?F.getOrCreateConference(F.getNameFromTechnicalName(Me)):F.getOrCreateConversation(F.getNameFromTechnicalName(Me))),null!==se){At.debug("Received conversation message from "+X.getUsername(),$.detail.message);var Fe={sender:X,conversation:se,content:$.detail.message};x.g.isTypeof($.detail,"metadata","object")&&(Fe.metadata=$.detail.metadata),he.get(hi(o)).emit("conversationMessage",Fe)}},z.cloudEventOccurred=function($){var X={topic:$.detail.topic,target:$.detail.target};he.get(hi(o)).emit("cloudEventOccurred",X)},z.callEstablished=function($){if(void 0!==$.detail.callId){var X=$.detail.callId.toString();At.debug("callEstablished",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&se.manageCallEstablishedEvent($)}else At.debug("callEstablished",$.detail)},z.remoteStreamAdded=function($){if(void 0!==$.detail.callId){var X=$.detail.callId.toString();At.debug("remoteStreamAdded",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&se.manageRemoteStreamAddedEvent($)}else At.debug("remoteStreamAdded",$.detail)},z.remoteStreamRemoved=function($){if(void 0!==$.detail.callId){var X=$.detail.callId.toString();At.debug("remoteStreamRemoved",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&se.manageRemoteStreamRemovedEvent($)}else At.debug("remoteStreamRemoved",$.detail)},z.userMediaSuccess=function($){var X=null;if(null!=$.detail.callId){X=$.detail.callId.toString(),At.debug("userMediaSuccess",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&se.manageUserMediaSuccessEvent($)}else At.debug("userMediaSuccess",$.detail)},z.onCallStatsUpdate=function($){if(void 0!==$.detail.callId){var X=$.detail.callId.toString(),se=Cn.getCall(X,null,{});null!==se&&se.manageCallStatsUpdateEvent($)}else At.debug("onCallStatsUpdate",$.detail)},z.error=function($){if(At.debug("error",$.detail),null!=$.detail.roomName){At.debug("error on conversation :",$.detail,$.detail.roomName,$.detail.callId);var X=null;void 0!==$.detail.roomName&&null!==(X=F.isConference($.detail.roomName)?F.getOrCreateConference(F.getNameFromTechnicalName($.detail.roomName)):F.getOrCreateConversation(F.getNameFromTechnicalName($.detail.roomName)))&&X.manageErrorEvent($)}else if(void 0!==$.detail.callId){var se=$.detail.callId.toString();At.debug("error",$.detail,se);var Me=Cn.getCall(se,null,{});null!==Me&&(Me.manageErrorEvent($),"RECORDING_FAILED"===$.detail.errorCode&&Cn.removeCallFromList(Me.getId()))}else At.debug("error",$.detail),he.get(hi(o)).emit("error",$.detail)},z.disconnectionWarning=function($){if(null!==$.detail.roomName){At.debug("disconnectionWarning on conversation :",$.detail,$.detail.roomName,$.detail.callId);var X=null;void 0!==$.detail.roomName&&null!==(X=F.isConference($.detail.roomName)?F.getOrCreateConference(F.getNameFromTechnicalName($.detail.roomName)):F.getOrCreateConversation(F.getNameFromTechnicalName($.detail.roomName)))&&X.manageDisconnectionWarningEvent($)}else if($.detail.callId){var se=$.detail.callId.toString();At.debug("disconnectionWarning",$.detail,se);var Me=Cn.getCall(se,null,{});null!==Me&&Me.manageDisconnectionWarningEvent($)}else At.debug("disconnectionWarning",$.detail)},z.hangup=function($){if($.detail.callId){var X=$.detail.callId.toString();At.debug("hangup",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&(se.manageHangupEvent($),!1===se.isRecorded()&&Cn.removeCallFromList(se.getId()))}else At.debug("hangup",$.detail)},z.recordedStreamsAvailable=function($){if($.detail.userId2){var X=k.getOrCreateContact($.detail.userId2),se=Cn.getCall(null,X);se&&(se.manageRecordAvailableEvent($),Cn.removeCallFromList(se.getId()))}else At.debug("recordedStreamsAvailable",$.detail)},z.desktopCapture=function($){if($.detail.callId){var X=$.detail.callId.toString();At.warn("desktopCapture",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&(se.manageDesktopCaptureEvent($),Cn.removeCallFromList(se.getId()))}else At.debug("desktopCapture",$.detail)},z.userMediaError=function($){if($.detail.callId){var X=$.detail.callId.toString();At.warn("userMediaError",$.detail,X);var se=Cn.getCall(X,null,{});null!==se&&(se.manageUserMediaErrorEvent($),!1===$.detail.tryAudioCallActivated&&Cn.removeCallFromList(se.getId()))}else At.debug("userMediaError",$.detail)},At.debug("av apiRTCManager onEvent ..."),Ni.onEvent("disconnectionWarning",z.disconnectionWarning).onEvent("incomingCall",z.incomingCall).onEvent("roomInvitation",z.roomInvitation).onEvent("roomMemberUpdate",z.roomMemberUpdate).onEvent("receiveRoomMessage",z.receiveRoomMessage).onEvent("receiveIMMessage",z.receiveIMMessage).onEvent("receiveData",z.receiveData).onEvent("receiveGroupChatMessage",z.receiveGroupChatMessage).onEvent("cloudEventOccurred",z.cloudEventOccurred).onEvent("callEstablished",z.callEstablished).onEvent("remoteStreamAdded",z.remoteStreamAdded).onEvent("remoteStreamRemoved",z.remoteStreamRemoved).onEvent("userMediaSuccess",z.userMediaSuccess).onEvent("onCallStatsUpdate",z.onCallStatsUpdate).onEvent("error",z.error).onEvent("hangup",z.hangup).onEvent("recordedStreamsAvailable",z.recordedStreamsAvailable).onEvent("desktopCapture",z.desktopCapture).onEvent("userMediaError",z.userMediaError),apiRTC.addEventListener("channelEvent",z.channelEvent),k.onUpdate(function($){!1===o.contactListUpdateListenerSetted&&(At.debug("No listener for contactListUpdate, storing event ..."),o.waitingContactListUpdateEvent.push($)),he.get(hi(o)).emit("contactListUpdate",$)}),mr.set(hi(o),z),o}return _=H,Y=[{key:"getToken",value:function(){return this.token}},{key:"getId",value:function(){return this.id}},{key:"getUserAgent",value:function(){return Nr.get(this)}},{key:"getContact",value:function(a){return At.warn("getContact() - Method deprecated, use Session.getOrCreateContact() instead"),Mn.get().getOrCreateContact(a)}},{key:"getOrCreateContact",value:function(a){return Mn.get().getOrCreateContact(a)}},{key:"createConversation",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.warn("createConversation() - Method deprecated, use Session.getConversation() instead"),this.getConversation(a,o)}},{key:"getConversation",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.trace("Getting conversation "+a,o),Dn.get().getOrCreateConversation(a)}},{key:"getConference",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return At.trace("Getting conference "+a,o),Dn.get().getOrCreateConference(a)}},{key:"getOrCreateConversation",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},k=Dn.get().getNameFromTechnicalName(a);return Dn.get().isConference(a)?Dn.get().getOrCreateConference(k,o):Dn.get().getOrCreateConversation(k,o)}},{key:"getOrCreateConference",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getOrCreateConversation(a,o)}},{key:"getActiveConversations",value:function(){var a,o={},k=Dn.get().getConversations(),F=Na(k.keys());try{for(F.s();!(a=F.n()).done;){var z=a.value,$=k.get(z);$.isJoined()&&(o[z]=$)}}catch(X){F.e(X)}finally{F.f()}return o}},{key:"getActiveConferences",value:function(){var a,o={},k=Dn.get().getConferences(),F=Na(k.keys());try{for(F.s();!(a=F.n()).done;){var z=a.value,$=k.get(z);$.isJoined()&&(o[z]=$)}}catch(X){F.e(X)}finally{F.f()}return o}},{key:"getWhiteboardClient",value:function(){return At.trace("getWhiteboardClient()"),Ni.whiteBoardClient}},{key:"setUserData",value:function(a){this.userData.setProps(a).setToSession()}},{key:"setUsername",value:function(a){this.userData.setProp("username",a).setToSession()}},{key:"setPhotoUrl",value:function(a){this.userData.setProp("photo_url",a).setToSession()}},{key:"getUserData",value:function(){return this.userData}},{key:"getUsername",value:function(){return null!==this.userData.get("username")?this.userData.get("username"):null!==this.userData.get("nickname")?this.userData.get("nickname"):this.id.toString()}},{key:"getPhotoUrl",value:function(){return null!==this.userData.get("photo_url")?this.userData.get("photo_url"):null!==this.userData.get("photoUrl")?this.userData.get("photoUrl"):this.userId?Ja.getUserPhotoUrl(this.userId):null}},{key:"subscribeToGroup",value:function(a){this.getSubscribedPresenceGroup().includes(a)?At.debug("Already subscribed to this group"):Ni.apiRTCSession.subscribePresenceGroup([a])}},{key:"unsubscribeToGroup",value:function(a){this.getSubscribedPresenceGroup().includes(a)?Ni.unsubscribeToPresenceGroup(a):At.debug("Not subscribed to this group")}},{key:"joinGroup",value:function(a){this.getPresenceGroup().includes(a)?At.debug("Already joined this group"):Ni.joinAndSubscribeToPresenceGroup(a)}},{key:"leaveGroup",value:function(a){this.getPresenceGroup().includes(a)?Ni.leaveAndUnsubscribeToPresenceGroup(a):At.debug("Group was not joined")}},{key:"subscribeToCloudEvent",value:function(a,o){Ni.subscribeToCloudEvent(a,o)}},{key:"unsubscribeToCloudEvent",value:function(a,o){Ni.unsubscribeToCloudEvent(a,o)}},{key:"joinConversationSpace",value:function(a){Ni.apiRTCSession.joinConversationSpace(a)}},{key:"leaveConversationSpace",value:function(a){Ni.apiRTCSession.leaveConversationSpace(a)}},{key:"getContacts",value:function(a){At.trace("getContacts()");var o,k={},F=Mn.get().getContacts(a),z=Na(F.keys());try{for(z.s();!(o=z.n()).done;){var $=o.value;k[$]=F.get($)}}catch(X){z.e(X)}finally{z.f()}return k}},{key:"getContactsArray",value:function(a){At.log("getContactsArray");var o=Mn.get().getContacts(a);return Array.from(o.values())}},{key:"getOnlineContactsArray",value:function(a){At.log("getOnlineContactsArray");var o=Mn.get().getOnlineContacts(a);return Array.from(o.values())}},{key:"getCall",value:function(a){return At.trace("getCall()"),Ci.get().getCall(a)}},{key:"getCalls",value:function(){At.trace("getCalls()");var a,o={},k=Ci.get().getCalls(),F=Na(k.keys());try{for(F.s();!(a=F.n()).done;){var z=a.value;o[z]=k.get(z)}}catch($){F.e($)}finally{F.f()}return o}},{key:"disconnect",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{invalidateUserToken:!0};return new Promise(function(k,F){if(At.info("disconnect()"),null===a.token&&null===a.id)At.error("disconnect() - Session is already disconnected"),F("disconnect() - Session is already disconnected");else{var z,$=Na(Dn.get().getConversations().keys());try{for($.s();!(z=$.n()).done;){var X=z.value;X.status===i.g.CONVERSATION_STATUS_JOINED&&X.leave()}}catch(Dt){$.e(Dt)}finally{$.f()}if(clearInterval(Ya.get(a)),Ya.set(a,null),null!==a.token&&o.hasOwnProperty("invalidateUserToken")&&o.invalidateUserToken)Ja.invalidateUserToken(a.token).then(function(){rr=null,Ni.disconnect({invalidateApiCCId:!0}),a.id=null,a.token=null;for(var Dt=mr.get(a),Ut=0,gi=Object.keys(Dt);Ut<gi.length;Ut++){var dn=gi[Ut];At.info("Session, removing apiRTCManager event :",dn),Ni.removeEventListener(dn,Dt[dn])}k()}).catch(function(Dt){At.error("disconnect() - An error occured during disconnection",Dt),F(new Error("disconnect() - An error occured during disconnection"))});else{rr=null,Ni.disconnect(),a.id=null;for(var se=mr.get(a),Me=0,Fe=Object.keys(se);Me<Fe.length;Me++){var bt=Fe[Me];At.info("Session, removing apiRTCManager event :",bt),Ni.removeEventListener(bt,se[bt])}k()}}})}},{key:"cloudRequest",value:function(a,o,k){return Ja.cloudRequest(a,o,k)}},{key:"sendRawData",value:function(a,o){return new Promise(function(k,F){null!=a?Ni.sendData(a.getId(),o).then(k).catch(function(z){switch(z){case i.g.ERROR_TIMED_OUT:F(x.g.createError(i.g.ERROR_TIMED_OUT,"sendRawData() - Data transmission timed out ",At));break;case i.g.ERROR_NOT_FOUND:F(x.g.createError(i.g.ERROR_NOT_FOUND,"sendRawData() - Contact was not found ",At));break;default:F(x.g.createError(i.g.ERROR_OTHER,"sendRawData() - Data transmission timed out ",At))}}):F(x.g.createError(i.g.ERROR_OTHER,"sendRawData() - Contact undefined",At))})}},{key:"startRecordingOutgoingStream",value:function(a,o){this.isRecording?At.error("startRecordingOutgoingStream() - already recording"):(Ni.webRTCClient.startRecording(a,o),this.isRecording=!0)}},{key:"stopRecordingOutgoingStream",value:function(){var a=this;return new Promise(function(o,k){a.isRecording?(a.isRecording=!1,Ni.onceEvent("MCURecordedStreamsAvailable",function(F){o({filename:F.detail.recordedFileName,url:i.g.RECORD_PLAY_URL+F.detail.recordedFileName})}),Ni.webRTCClient.stopRecording()):(At.error("stopRecordingOutgoingStream() - not recording"),k(new Error("stopRecordingOutgoingStream() - not recording")))})}},{key:"init",value:function(a){var o=this;this.id=a,rr=this,null===Ya.get(this)&&Ya.set(this,setInterval(function(){mo(o)},3e4))}},{key:"setMCUServer",value:function(a){Ni.webRTCClient.setMCUConnector(a)}},{key:"allowMultipleCalls",value:function(a){Ni.webRTCClient.setAllowMultipleCalls(a)}},{key:"setCallStatsMonitoringEnabled",value:function(a,o){Ni.webRTCClient.enableCallStatsMonitoring(a,o)}},{key:"setQualityEvaluatingEnabled",value:function(a,o){Ni.webRTCClient.enableQualityEvaluating(a,o)}},{key:"getContactFromWebSession",value:function(a){var o=this;return new Promise(function(k,F){Ja.getSessionHistory(a,o.getToken()).then(function(z){"1"!==z.exist.toString()?F(x.g.createError(i.g.ERROR_NOT_FOUND,"No such web session",At)):z.user1.toString()===o.getId()?k(o.getContact(z.user2)):z.user2.toString()===o.getId()?k(o.getContact(z.user1)):F(x.g.createError(i.g.ERROR_UNAUTHORIZED,"User has no access to this web session",At))}).catch(function(z){z.hasOwnProperty("code")?F({code:z.code,error:z.error}):z.hasOwnProperty("http_code")?z.http_code.toString().startsWith("4")?F(x.g.createError(i.g.ERROR_OTHER,"Error while getting contact from websession",At)):F(x.g.createError(i.g.ERROR_SERVER_UNAVAILABLE,"Error while getting contact from websession",At)):F(x.g.createError(i.g.ERROR_OTHER,"Error while getting contact from websession",At))})})}},{key:"joinPointerSharingRoom",value:function(a){var o=this;return new Promise(function(k,F){if(za.get(o).hasOwnProperty(a))return F(x.g.createError(i.g.ERROR_WRONG_STATE,"joinPointerSharingRoom() - cannot join pointer sharing room again",At));Ni.pointerSharingClient.joinRoom(a,{success:function(z){var $=new gr(o,z);za.get(o)[z]=$,k($)},failure:function(z,$){F(x.g.createError("timeout"===z?i.g.ERROR_TIMED_OUT:i.g.ERROR_OTHER,"joinPointerSharingRoom() - cannot join pointer sharing room",At))}})})}},{key:"getSubscribedPresenceGroup",value:function(){return void 0!==apiCC&&null!==apiCC.session&&void 0!==apiCC.session?apiCC.session.subscribeToPresenceGroup:null}},{key:"getPresenceGroup",value:function(){return void 0!==apiCC&&null!==apiCC.session&&void 0!==apiCC.session?apiCC.session.presenceGroup:null}}],O=[{key:"getAvailableEvents",value:function(){return fo}},{key:"getActiveSession",value:function(){return rr}}],Y&&kr(_.prototype,Y),O&&kr(_,O),H}(ke),gr=function(D,_){this.session=D,this.roomId=_,this.getRoomId=function(){return this.roomId},this.isActive=function(){return null!==this.session&&null!==this.roomId&&Ni.pointerSharingClient.roomActive(this.roomId)},this.leaveRoom=function(){var Y=this;return new Promise(function(O,U){if(null===Y.session||null===Y.roomId)return U(x.g.createError(i.g.ERROR_WRONG_STATE,"leaveRoom() - cannot leave room again",At));Ni.pointerSharingClient.leaveRoom(Y.roomId),delete za.get(Y.session)[Y.roomId],Y.session=null,Y.roomId=null,O()})},this.invite=function(Y,O){var U=this;return new Promise(function(de,fe){if(null===U.session||null===U.roomId)return fe(x.g.createError(i.g.ERROR_WRONG_STATE,"invite() - cannot invite",At));Ni.pointerSharingClient.inviteInRoom(U.roomId,Y.getId(),O),de()})},this.sendPointerLocation=function(Y,O,U,de){var fe=this;return new Promise(function(H,a){return null===fe.session||null===fe.roomId?a(x.g.createError(i.g.ERROR_WRONG_STATE,"sendPointerLocation() - cannot send pointer location",At)):Ni.pointerSharingClient.sendPointerLocation(fe.roomId,Y,O,U,de)?void H():a(x.g.createError(i.g.ERROR_WRONG_STATE,"sendPointerLocation() - cannot send pointer location",At))})}},mo=function(D){for(var _=D.getActiveConferences(),Y=0,O=Object.keys(_);Y<O.length;Y++)Ja.updateConferencePresence(_[O[Y]],D,Ni.getActiveApiKey())};function vr(D,_,Y){return(vr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(O,U,de){var fe=function(a,o){for(;!Object.prototype.hasOwnProperty.call(a,o)&&null!==(a=Ua(a)););return a}(O,U);if(fe){var H=Object.getOwnPropertyDescriptor(fe,U);return H.get?H.get.call(de):H.value}})(D,_,Y||D)}function or(D){return(or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function Pa(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Pr(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Pr(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Pr(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Ur(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Lr(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function xr(D,_,Y){return _&&Lr(D.prototype,_),Y&&Lr(D,Y),D}function Wr(D,_){if("function"!=typeof _&&null!==_)throw new TypeError("Super expression must either be null or a function");D.prototype=Object.create(_&&_.prototype,{constructor:{value:D,writable:!0,configurable:!0}}),_&&Cr(D,_)}function Cr(D,_){return(Cr=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function jr(D){var _=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Y){return!1}}();return function(){var Y,O=Ua(D);if(_){var U=Ua(this).constructor;Y=Reflect.construct(O,arguments,U)}else Y=O.apply(this,arguments);return go(this,Y)}}function go(D,_){if(_&&("object"===or(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return $i(D)}function $i(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function Ua(D){return(Ua=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}var Pt=R.Y.get("Stream"),br=ie.get(),vo=Dn.get(),Co=["stopped","trackStopped","audioAmplitude","audioAmplitudeInfo","muteStateChange","activeStateChange","backgroundSubstractionStopVisibilityChange","backgroundSubstractionStopComputeTime","AIESnapshot","AIELog","audioFlowStatusChanged","videoFlowStatusChanged","remoteAudioFlowStatusChanged","remoteVideoFlowStatusChanged"],Fn=new Map,sr=new WeakMap,Xa=new WeakMap,Ka=new WeakMap,yr=new WeakMap,La={},Tn=function(D){Wr(Y,D);var _=jr(Y);function Y(O){var U,de=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ur(this,Y),U=_.call(this,Pt),!0!==de.constructor)throw new Error("Stream constructor should not be used directly, please use a static method of class Stream such as : createStreamFromUserMedia, createStreamFromMediaStream, createScreensharingStream");if(delete de.constructor,!de.hasOwnProperty("type"))throw new Error("Cannot create Stream with no type");if(Pt.debug("Create Stream with options",de),U.data=O,U.audioInput=de.hasOwnProperty("audioInput")?de.audioInput:null,U.videoInput=de.hasOwnProperty("videoInput")?de.videoInput:null,de.hasOwnProperty("userMediaStreamId")?(U.userMediaStreamId=de.userMediaStreamId,U.isRemote=!1,Fn.set(U.userMediaStreamId,$i(U))):(U.userMediaStreamId=null,U.isRemote=!0),U.streamId=x.g.isPropertyTypeof(de,"streamId","number")?de.streamId:null!==U.userMediaStreamId?Number(U.userMediaStreamId):void 0!==Number.MAX_SAFE_INTEGER?Math.floor(Math.random()*Number.MAX_SAFE_INTEGER):Math.floor(1024*Math.random()*1024*1024),U.contact=de.hasOwnProperty("contact")?de.contact:null,de.hasOwnProperty("callId")?(U.callId=de.callId,U.callAudioAvailable=de.callAudioAvailable,U.callAudioActive=de.callAudioActive,U.callAudioMuted=de.callAudioMuted,U.callAudioSilent=de.callAudioSilent,U.callVideoAvailable=de.callVideoAvailable,U.callVideoActive=de.callVideoActive,U.callVideoMuted=de.callVideoMuted,U.callVideoSilent=de.callVideoSilent):U.callId=null,U.publishedInConversations=new Map,U.mediaRecorder=null,U.recordedBlobs=[],sr.set($i(U),!!de.hasOwnProperty("screensharing")&&de.screensharing),Xa.set($i(U),null),Ka.set($i(U),null),U.type=de.type,U.promises=[],"IE"!==apiRTC.browser&&null!==U.data){var fe,H=function(se){se.addEventListener("ended",function(Me){La.hasOwnProperty(se.id)||(he.get($i(U)).emit("trackStopped",{type:se.kind,id:se.id}),La[se.id]=!0)})},a=Pa(U.data.getVideoTracks());try{for(a.s();!(fe=a.n()).done;){var o=fe.value;H(o)}}catch(se){a.e(se)}finally{a.f()}var k,F=Pa(U.data.getAudioTracks());try{for(F.s();!(k=F.n()).done;){var z=k.value;H(z)}}catch(se){F.e(se)}finally{F.f()}}var $={};if(x.g.isTypeof(U.userMediaStreamId,"string")?($.userMediaStop=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId){var Me={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};he.get($i(U)).emit("stopped",Me);var Fe=yr.get($i(U));if(Fe)for(var bt in Fe)apiRTC.removeEventListener(bt,Fe[bt])}},$.localStreamUpdated=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId&&null===se.detail.callId){if(se.detail.changeList.indexOf("audioIsMuted")>=0){var Me={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId,type:"audio",muted:se.detail.audioIsMuted};he.get($i(U)).emit("muteStateChange",Me),U.sendAudioFlowStatusChanged()}if(se.detail.changeList.indexOf("videoIsMuted")>=0){var Fe={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId,type:"video",muted:se.detail.videoIsMuted};he.get($i(U)).emit("muteStateChange",Fe),U.sendVideoFlowStatusChanged()}se.detail.changeList.indexOf("audioIsSilent")>=0&&U.sendAudioFlowStatusChanged(),se.detail.changeList.indexOf("videoIsSilent")>=0&&U.sendVideoFlowStatusChanged()}},$.backgroundSubstractionStopVisibilityChange=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId){var Me={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};he.get($i(U)).emit("backgroundSubstractionStopVisibilityChange",Me)}},$.backgroundSubstractionStopComputeTime=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId){var Me={streamId:U.streamId,userMediaStreamId:U.userMediaStreamId};he.get($i(U)).emit("backgroundSubstractionStopComputeTime",Me)}},$.AIESnapshot=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId){var Me=se.detail.image;he.get($i(U)).emit("AIESnapshot",Me)}},$.AIELog=function(se){if(se.detail.userMediaStreamId===U.userMediaStreamId){var Me=se.detail.log;he.get($i(U)).emit("AIELog",Me)}}):x.g.isTypeof(U.callId,"string")&&($.hangup=function(se){if("remote"===se.detail.hangupType&&se.detail.callId===U.callId){var Me={streamId:U.streamId,callId:U.callId};he.get($i(U)).emit("stopped",Me);var Fe=yr.get($i(U));for(var bt in Fe)apiRTC.removeEventListener(bt,Fe[bt])}},$.remoteStreamUpdated=function(se){if(se.detail.callId===U.callId){if(se.detail.changeList.indexOf("audioIsActive")>=0){U.callAudioActive=se.detail.audioIsActive;var Me={streamId:U.streamId,callId:U.callId,type:"audio",active:se.detail.audioIsActive};he.get($i(U)).emit("activeStateChange",Me)}if(se.detail.changeList.indexOf("audioIsMuted")>=0){U.callAudioMuted=se.detail.audioIsMuted;var Fe={streamId:U.streamId,callId:U.callId,type:"audio",muted:se.detail.audioIsMuted};he.get($i(U)).emit("muteStateChange",Fe),U.sendRemoteAudioFlowStatusChanged({enabled:se.detail.audioIsMuted,muted:se.detail.audioIsSilent})}if(se.detail.changeList.indexOf("videoIsActive")>=0){U.callVideoActive=se.detail.videoIsActive;var bt={streamId:U.streamId,callId:U.callId,type:"video",active:se.detail.videoIsActive};he.get($i(U)).emit("activeStateChange",bt)}if(se.detail.changeList.indexOf("videoIsMuted")>=0){U.callVideoMuted=se.detail.videoIsMuted;var ht={streamId:U.streamId,callId:U.callId,type:"video",muted:se.detail.videoIsMuted};he.get($i(U)).emit("muteStateChange",ht),U.sendRemoteVideoFlowStatusChanged({enabled:se.detail.videoIsMuted,muted:se.detail.videoIsSilent})}se.detail.changeList.indexOf("audioIsSilent")>=0&&(U.callAudioSilent=se.detail.audioIsSilent,U.sendRemoteAudioFlowStatusChanged({enabled:se.detail.audioIsMuted,muted:se.detail.audioIsSilent})),se.detail.changeList.indexOf("videoIsSilent")>=0&&(U.callVideoSilent=se.detail.videoIsSilent,U.sendRemoteVideoFlowStatusChanged({enabled:se.detail.videoIsMuted,muted:se.detail.videoIsSilent})),se.detail.changeList.indexOf("audioIsSilentLocally")>=0&&U.sendAudioFlowStatusChanged(),se.detail.changeList.indexOf("videoIsSilentLocally")>=0&&U.sendVideoFlowStatusChanged()}}),Object.keys($).length>0)for(var X in yr.set($i(U),$),$)apiRTC.addEventListener(X,$[X]);return U}return xr(Y,[{key:"getContact",value:function(){return this.contact}},{key:"getData",value:function(){return this.data}},{key:"getConversations",value:function(){var O,U=[],de=Pa(this.publishedInConversations.keys());try{for(de.s();!(O=de.n()).done;)U.push(vo.getConversations(O.value))}catch(H){de.e(H)}finally{de.f()}return U}},{key:"isScreensharing",value:function(){return sr.get(this)}},{key:"hasData",value:function(){return null!==this.data}},{key:"hasVideo",value:function(){return this.callId?this.callVideoAvailable&&this.callVideoActive:!!this.hasData()&&this.data.getVideoTracks().length>0}},{key:"hasAudio",value:function(){return this.callId?this.callAudioAvailable&&this.callAudioActive:!!this.hasData()&&this.data.getAudioTracks().length>0}},{key:"isVideoMuted",value:function(){if(this.callId)return this.callVideoMuted;if(this.hasData()){var O=this.data.getVideoTracks();return O&&O.length>0&&!O[0].enabled}return!1}},{key:"isAudioMuted",value:function(){if(this.callId)return this.callAudioMuted;if(this.hasData()){var O=this.data.getAudioTracks();return O&&O.length>0&&!O[0].enabled}return!1}},{key:"getType",value:function(){return this.type}},{key:"release",value:function(){this.hasData()&&(this.releaseAudio(),this.releaseVideo(),this.data=null,this.userMediaStreamId&&(apiCC.releaseUserMediaStream(this.userMediaStreamId),Fn.delete(this.userMediaStreamId)))}},{key:"releaseAudio",value:function(){var O=this;this.hasData()&&(this.disableAudioAnalysis(),this.data.getAudioTracks().forEach(function(U){U.stop(),La.hasOwnProperty(U.id)||(he.get(O).emit("trackStopped",{type:U.kind,id:U.id}),La[U.id]=!0)}))}},{key:"releaseVideo",value:function(){var O=this;this.hasData()&&this.data.getVideoTracks().forEach(function(U){U.stop(),La.hasOwnProperty(U.id)||(he.get(O).emit("trackStopped",{type:U.kind,id:U.id}),La[U.id]=!0)})}},{key:"muteAudio",value:function(){Pt.warn("This method is deprecated now, please use Stream.disableAudio() instead"),this.disableAudio()}},{key:"muteVideo",value:function(){Pt.warn("This method is deprecated now, please use Stream.disableVideo() instead"),this.disableVideo()}},{key:"unmuteAudio",value:function(){Pt.warn("This method is deprecated now, please use Stream.enableAudio() instead"),this.enableAudio()}},{key:"unmuteVideo",value:function(){Pt.warn("This method is deprecated now, please use Stream.enableVideo() instead"),this.enableVideo()}},{key:"enableAudio",value:function(){if(this.userMediaStreamId){var O=apiCC.getUserMediaStream(this.userMediaStreamId);O&&O.unMuteAudioOnStreams("enabled")}else this.callId&&this.hasData()&&(this.data.getAudioTracks().forEach(function(U){U.enabled=!0}),this.sendAudioFlowStatusChanged())}},{key:"disableAudio",value:function(){if(this.userMediaStreamId){var O=apiCC.getUserMediaStream(this.userMediaStreamId);O&&O.muteAudioOnStreams("enabled")}else this.callId&&this.hasData()&&(this.data.getAudioTracks().forEach(function(U){U.enabled=!1}),this.sendAudioFlowStatusChanged())}},{key:"enableVideo",value:function(){if(this.userMediaStreamId){var O=apiCC.getUserMediaStream(this.userMediaStreamId);O&&O.unMuteVideoOnStreams("enabled")}else this.callId&&this.hasData()&&(this.data.getVideoTracks().forEach(function(U){U.enabled=!0}),this.sendVideoFlowStatusChanged("enabled"))}},{key:"disableVideo",value:function(){if(this.userMediaStreamId){var O=apiCC.getUserMediaStream(this.userMediaStreamId);O&&O.muteVideoOnStreams("enabled")}else this.callId&&this.hasData()&&(this.data.getVideoTracks().forEach(function(U){U.enabled=!1}),this.sendVideoFlowStatusChanged())}},{key:"getAudioFlowStatus",value:function(){var O={};return this.data.getAudioTracks().forEach(function(U){O.enabled=U.enabled,O.muted=U.muted}),O}},{key:"getVideoFlowStatus",value:function(){var O={};return this.data.getVideoTracks().forEach(function(U){O.enabled=U.enabled,O.muted=U.muted}),O}},{key:"getRemoteAudioFlowStatus",value:function(){var O=this;return new Promise(function(U,de){if(!O.isRemote)return de("Please use this function on a remote Stream");if(Pt.debug("getRemoteAudioFlowStatus()"),null===O.contact)return de("No contact associated");var fe=O.addPendingPromise("getRemoteAudioFlowStatus",U,de);O.contact.sendCustomEvent(i.g.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:O.callId,streamId:O.getId(),timeout:fe})})}},{key:"getRemoteVideoFlowStatus",value:function(){var O=this;return new Promise(function(U,de){if(!O.isRemote)return de("Please use this function on a remote Stream");if(Pt.debug("getRemoteVideoFlowStatus()"),null===O.contact)return de("No contact associated");var fe=O.addPendingPromise("getRemoteVideoFlowStatus",U,de);O.contact.sendCustomEvent(i.g.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:O.callId,streamId:O.getId(),timeout:fe})})}},{key:"attachToElement",value:function(O){Pt.debug("attachToElement"),br.attachMediaStream(O,this.data)}},{key:"addInDiv",value:function(O,U,de,fe,H){Pt.debug("addInDiv"),br.addStreamInDiv(this.data,this.type,O,U,de,fe,H)}},{key:"removeFromDiv",value:function(O,U){Pt.debug("removeFromDiv"),br.removeElementFromDiv(O,U)}},{key:"startRecord",value:function(O){return Pt.info("startRecord :",O),apiCC.recordMgr.record(this.data,O)}},{key:"stopRecord",value:function(){return Pt.info("stopRecord() - Stopping record"),apiCC.recordMgr.stop()}},{key:"pauseRecord",value:function(){return Pt.info("pauseRecord() - Pausing record"),apiCC.recordMgr.pause()}},{key:"resumeRecord",value:function(){return Pt.info("resumeRecord() - Resuming record"),apiCC.recordMgr.resume()}},{key:"enableAudioAnalysis",value:function(){var O=this,U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Pt.info("enableAudioAnalysis()");var de=x.g.getAudioContext(),fe=null,H=!1,a=Ka.get(this),o=Xa.get(this);de?this.hasData()?null!==a||null!==o?Pt.error("enableAudioAnalysis() - Audio analysis already enabled"):(a=de.createMediaStreamSource(this.data),(o=de.createScriptProcessor(2048,1,1)).connect(de.destination),o.onaudioprocess=function(){var k,F=new Uint8Array(o.analyser.frequencyBinCount),z=0;o.analyser.getByteFrequencyData(F);var $,X=Pa(F);try{for(X.s();!($=X.n()).done;)z+=$.value}catch(bt){X.e(bt)}finally{X.f()}k=z/F.length,he.get(O).emit("audioAmplitude",k);var se=0;F.sort(function(bt,ht){return ht-bt}),F=F.slice(0,50);for(var Me=0;Me<F.length;Me++)se+=F[Me];(k=se/F.length)>("number"==typeof U.threshold?U.threshold:i.g.STREAM_AUDIO_ANALYSIS_THRESHOLD)&&(H||(H=!0,he.get(O).emit("audioAmplitudeInfo",{amplitude:k,isSpeaking:!0})),null!==fe&&clearTimeout(fe),fe=setTimeout(function(){he.get(O).emit("audioAmplitudeInfo",{amplitude:k,isSpeaking:!1}),H=!1},1e3))},o.analyser=de.createAnalyser(),o.analyser.smoothingTimeConstant=.5,o.analyser.fftSize=1024,a.connect(o.analyser),o.analyser.connect(o),Xa.set(this,o),Ka.set(this,a)):Pt.error("enableAudioAnalysis() - Stream has no data, unable to enable audio analysis"):Pt.error("enableAudioAnalysis() - AudioContext is not available, unable to enable audio analysis")}},{key:"disableAudioAnalysis",value:function(){Pt.info("disableAudioAnalysis()");var O=Ka.get(this),U=Xa.get(this);null!==O&&O.disconnect(),null!==U&&(U.analyser.disconnect(),U.disconnect()),Xa.set(this,null),Ka.set(this,null)}},{key:"takeSnapshot",value:function(){var O=this,U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Pt.info("takeSnapshot()");var de=null,fe=null;return new Promise(function(H,a){if(O.hasData()){O.hasVideo()||Pt.warn("takeSnapshot() - This stream does not have a video track"),de=document.createElement("video"),fe=function(z){if(o.width=de.videoWidth,o.height=de.videoHeight,U.hasOwnProperty("width")&&(o.width=U.width),U.hasOwnProperty("height")&&(o.height=U.height),U.hasOwnProperty("filters")){for(var $=[],X=0,se=Object.keys(U.filters);X<se.length;X++){var Me=se[X];$.push(Me+"("+U.filters[Me]+")")}k.filter=$.join(" ")}k.drawImage(de,0,0,o.width,o.height),!0===z&&de.remove(),U.hasOwnProperty("output")&&"blob"===U.output?void 0!==U.outputMimeType?(Pt.debug("options.outputMimeType is defined :",U.outputMimeType),o.toBlob(function(Fe){H(Fe)},U.outputMimeType,U.outputQualityArgument)):o.toBlob(function(Fe){H(Fe)},"image/png"):void 0!==U.outputMimeType?(Pt.debug("options.outputMimeType is defined :",U.outputMimeType),H(o.toDataURL(U.outputMimeType,U.outputQualityArgument))):H(o.toDataURL("image/png"))};var o=document.createElement("canvas"),k=o.getContext("2d");null==U.divId?setTimeout(function(){O.attachToElement(de),de.addEventListener("canplay",function(){fe(!0)}),de.muted=!0,de.play()},1e3):null===(de=document.getElementById(U.divId))?Pt.error("divId not found for snapshot"):fe(!1)}else{var F="takeSnapshot() - Stream has no data, cannot get snapshot";Pt.error(F),a(new Error(F))}})}},{key:"getId",value:function(){return String(this.streamId)}},{key:"getOwner",value:function(){return this.contact?this.contact:Ui.getActiveSession().getUserAgent()}},{key:"getLabels",value:function(){var O={};return this.hasData()&&this.data.getAudioTracks().length>0&&(O.audioSourceLabel="",this.data.getAudioTracks()[0].label&&(O.audioSourceLabel=this.data.getAudioTracks()[0].label)),this.hasData()&&this.data.getVideoTracks().length>0&&(O.videoSourceLabel="",this.data.getVideoTracks()[0].label&&(O.videoSourceLabel=this.data.getVideoTracks()[0].label)),Pt.debug("getLabels:",O),O}},{key:"checkImageCaptureCompatibility",value:function(){return"undefined"==typeof ImageCapture}},{key:"getLocalMediaStreamTrack",value:function(){var O=null;return 1===this.data.getVideoTracks().length&&(O=this.data.getVideoTracks()[0]),O}},{key:"getLocalMediaStreamAudioTrack",value:function(){var O=null;return 1===this.data.getAudioTracks().length&&(O=this.data.getAudioTracks()[0]),O}},{key:"applyConstraints",value:function(O){var U=this;return new Promise(function(de,fe){if(U.isRemote){if(Pt.debug("applyConstraints() on a remote stream"),null===U.contact)return fe("No contact associated");var H=U.addPendingPromise("applyConstraints",de,fe);U.contact.sendCustomEvent(i.g.CONTACT_APPLY_CONSTRAINTS_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:U.callId,streamId:U.getId(),timeout:H,constraints:O})}else{if(Pt.debug("applyConstraints()"),!MediaStreamTrack.prototype.hasOwnProperty("applyConstraints"))return fe("Navigator not compatible with this function");var a=null,o=null;if(void 0===O)return fe("Missing argument");void 0!==O.audio&&(a=U.getLocalMediaStreamAudioTrack().applyConstraints(O.audio).catch(function(k){return fe(k)})),void 0!==O.video&&(o=U.getLocalMediaStreamTrack().applyConstraints(O.video).catch(function(k){return fe(k)})),Promise.all([a,o]).then(function(k){return null!==k[0]&&Pt.debug("audio constraints applied"),null!==k[1]&&Pt.debug("video constraints applied"),de()})}})}},{key:"applyConstraint",value:function(O,U){Pt.error("Due to a certain amount of problems with this function it has been desactivated, please use Stream.applyConstraints instead")}},{key:"setCapability",value:function(O,U){Pt.error("Due to a certain amount of problems with this function it has been desactivated, please use Stream.applyConstraints instead")}},{key:"getSettings",value:function(){var O=this;return new Promise(function(U,de){if(!O.isRemote)return Pt.debug("getSettings()"),MediaStreamTrack.prototype.hasOwnProperty("getSettings")?U({audio:O.getStreamTrackSettings(O.getLocalMediaStreamAudioTrack()),video:O.getStreamTrackSettings(O.getLocalMediaStreamTrack())}):de("Navigator not compatible with this function");if(Pt.debug("getSettings() on a remote stream"),null===O.contact)return de("No contact associated");var fe=O.addPendingPromise("getSettings",U,de);O.contact.sendCustomEvent(i.g.CONTACT_GET_SETTINGS_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:O.callId,streamId:O.getId(),timeout:fe})})}},{key:"getStreamTrackSettings",value:function(O){if(null!==O)return O.getSettings()}},{key:"getCapabilities",value:function(){var O=this;return new Promise(function(U,de){if(!O.isRemote)return Pt.debug("getCapabilities()"),MediaStreamTrack.prototype.hasOwnProperty("getCapabilities")?U({audio:O.getStreamTrackCapabilities(O.getLocalMediaStreamAudioTrack()),video:O.getStreamTrackCapabilities(O.getLocalMediaStreamTrack())}):de("Navigator not compatible with this function");if(Pt.debug("getCapabilities() on a remote stream"),null===O.contact)return de("No contact associated");var fe=O.addPendingPromise("getCapabilities",U,de);O.contact.sendCustomEvent(i.g.CONTACT_GET_CAPABILITIES_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:O.callId,streamId:O.getId(),timeout:fe})})}},{key:"getStreamTrackCapabilities",value:function(O){return null!==O?O.getCapabilities():{}}},{key:"getConstraints",value:function(){var O=this;return new Promise(function(U,de){if(!O.isRemote)return Pt.debug("getConstraints()"),MediaStreamTrack.prototype.hasOwnProperty("getConstraints")?U({audio:O.getStreamTrackConstraints(O.getLocalMediaStreamAudioTrack()),video:O.getStreamTrackConstraints(O.getLocalMediaStreamTrack())}):de("Navigator not compatible with this function");if(Pt.debug("getConstraints() on a remote stream"),null===O.contact)return de("No contact associated");var fe=O.addPendingPromise("getConstraints",U,de);O.contact.sendCustomEvent(i.g.CONTACT_GET_CONSTRAINTS_IDENTIFIER,{requesterId:Ui.getActiveSession().getUserAgent().userId,callId:O.callId,streamId:O.getId(),timeout:fe})})}},{key:"getStreamTrackConstraints",value:function(O){return null!==O?O.getConstraints():{}}},{key:"takePhoto",value:function(){var O=this;return new Promise(function(U,de){if(Pt.debug("takePhoto()"),O.checkImageCaptureCompatibility())de("Your navigator is not compatible with takePhoto()");else{var fe=O.getLocalMediaStreamTrack();null!==fe?new ImageCapture(fe).takePhoto().then(function(H){var a=new Image;a.src=URL.createObjectURL(H),U(a)}).catch(function(H){de("takePhoto() error: ",H)}):de("No local mediaStreamTrack found")}})}},{key:"activateAIAnnotations",value:function(){var O=this.getStreamAIE();null!==O&&O.activateAnnotations()}},{key:"stopAIAnnotations",value:function(){var O=this.getStreamAIE();null!==O&&O.stopAnnotations()}},{key:"activateAILogs",value:function(){var O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof O)return Pt.error("minLogPeriod parameter must be an integer");var U=this.getStreamAIE();null!==U&&U.activateLogs(O)}},{key:"stopAILogs",value:function(){var O=this.getStreamAIE();null!==O&&O.stopLogs()}},{key:"activateAISnapshots",value:function(){var O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"!=typeof O)return Pt.error("minSnapshotPeriod parameter must be an integer");var U=this.getStreamAIE();null!==U&&U.activateSnapshots(O)}},{key:"stopAISnapshots",value:function(){var O=this.getStreamAIE();null!==O&&O.stopSnapshots()}},{key:"getStreamAIE",value:function(){var O=null;if(void 0!==apiCC){var U=apiCC.getUserMediaStream(this.userMediaStreamId);null!==U.mediaFilterManager?(Object.values(U.mediaFilterManager.filters).forEach(function(fe){null!==fe.streamAIE&&(O=fe.streamAIE)}),null===O&&Pt.error("Applied filter is not an AI filter")):Pt.error("No filter applied on stream")}return O}},{key:"addChildren",value:function(O,U){this.childrenTypeExists(U)?Pt.error("This stream already has a sub instance running for this"):(void 0===this.childrens&&(this.childrens=[]),this.childrens.push(O))}},{key:"releaseChildren",value:function(O){void 0!==this.childrens&&this.childrens.forEach(function(U,de){U.childType===O&&U.hasOwnProperty("release")&&U.release()})}},{key:"removeChildren",value:function(O){var U=this;void 0!==this.childrens&&this.childrens.forEach(function(de,fe){if(de.childType===O)return U.childrens.splice(fe,1)})}},{key:"childrenTypeExists",value:function(O){var U=!1;return void 0!==this.childrens&&this.childrens.forEach(function(de){de.childType===O&&(U=!0)}),U}},{key:"createChildStreamFromStream",value:function(O,U){var de=this;return new Promise(function(fe,H){Pt.debug("createChildStreamFromStream");var a={};a.type=i.g.STREAM_TYPE_NO_INPUT,O.getAudioTracks().length>0&&(a.type=i.g.STREAM_TYPE_AUDIO),O.getVideoTracks().length>0&&(a.type=i.g.STREAM_TYPE_VIDEO);var o=de;apiRTC.createUserMediaStream({type:"media",stream:O,success:function(k){Pt.debug("[createChildStreamFromStream] success; userMediaStreamId: "+k.userMediaStreamId),a.constructor=!0,a.userMediaStreamId=k.userMediaStreamId,fe(new bo(k.stream,a,o,U))},failure:function(k,F){Pt.debug("[createChildStreamFromStream] failure :",F),H()}})})}},{key:"loadBlurAPI",value:function(){return new Promise(function(O,U){apiCC.resourcesLoader.loadjs(["https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"],"blur-api",{async:!0,numRetries:20,reqdelay:200,success:function(){Pt.debug("Blur API loaded"),O()},error:function(fe){U("Resources loading failed, depsNotFound: "+fe)},retrycb:function(fe,H){Pt.warn("Blur API model loading retry :"+fe+" ,delay before retry :"+H)}})})}},{key:"processBlur",value:function(O,U){U.blurVariables.canvasSegmentedCtx.save(),U.blurVariables.canvasBlurredCtx.save(),U.blurVariables.finalCanvasCtx.save(),U.blurVariables.canvasSegmentedCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasBlurredCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.clearRect(0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasBlurredCtx.drawImage(O.image,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.drawImage(O.image,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.globalCompositeOperation="destination-atop",U.blurVariables.canvasSegmentedCtx.drawImage(O.segmentationMask,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.drawImage(U.blurVariables.canvasBlurred,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.finalCanvasCtx.drawImage(U.blurVariables.canvasSegmented,0,0,U.blurVariables.width,U.blurVariables.height),U.blurVariables.canvasSegmentedCtx.restore(),U.blurVariables.canvasBlurredCtx.restore(),U.blurVariables.finalCanvasCtx.restore()}},{key:"startBlur",value:function(){var O=this;return new Promise(function(U,de){Pt.debug("startBlur"),O.blurVariables={},O.blurVariables.stopBlur=!1;var fe=O.data.getVideoTracks();if(1===fe.length){var H=fe[0].getSettings();O.blurVariables.height=H.height,O.blurVariables.width=H.width}O.blurVariables.srcVideoElement=document.createElement("video"),O.blurVariables.srcVideoElement.srcObject=O.data,O.blurVariables.srcVideoElement.height=O.blurVariables.height,O.blurVariables.srcVideoElement.width=O.blurVariables.width,O.blurVariables.srcVideoElement.play(),O.blurVariables.canvasSegmented=document.createElement("canvas"),O.blurVariables.canvasSegmentedCtx=O.blurVariables.canvasSegmented.getContext("2d"),O.blurVariables.canvasSegmented.height=O.blurVariables.height,O.blurVariables.canvasSegmented.width=O.blurVariables.width,O.blurVariables.canvasBlurred=document.createElement("canvas"),O.blurVariables.canvasBlurredCtx=O.blurVariables.canvasBlurred.getContext("2d"),O.blurVariables.canvasBlurred.height=O.blurVariables.height,O.blurVariables.canvasBlurred.width=O.blurVariables.width,O.blurVariables.canvasBlurredCtx.filter="blur(15px)",O.blurVariables.finalCanvas=document.createElement("canvas"),O.blurVariables.finalCanvasCtx=O.blurVariables.finalCanvas.getContext("2d"),O.blurVariables.finalCanvas.height=O.blurVariables.height,O.blurVariables.finalCanvas.width=O.blurVariables.width;var a=O;O.loadBlurAPI().then(function(){a.blurVariables.selfieSegmentation=new SelfieSegmentation({locateFile:function(o){return"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(o)}}),a.blurVariables.selfieSegmentation.setOptions({selfieMode:!1,modelSelection:1,effect:"background"}),a.blurVariables.selfieSegmentation.onResults(function(o){a.processBlur(o,a)}),a.blurVariables.srcVideoElement.requestVideoFrameCallback(function o(){return new Promise(function(k,F){a.blurVariables.stopBlur||a.blurVariables.selfieSegmentation.send({image:a.blurVariables.srcVideoElement}).then(function(){a.blurVariables.srcVideoElement.requestVideoFrameCallback(o),k()}).catch(function(z){F(z)})})}),U(a.blurVariables.finalCanvas.captureStream())})})}},{key:"stopBlur",value:function(){Pt.debug("stopBlur"),this.blurVariables.stopBlur=!0,this.blurVariables.selfieSegmentation.close()}},{key:"blur",value:function(){var O=this;return new Promise(function(U,de){if(!("requestVideoFrameCallback"in HTMLVideoElement.prototype))return de("Your navigator is not compatible with this function");if(O.childrenTypeExists("blur"))return de("This stream already has a sub instance running for this");var fe=O;O.startBlur().then(function(H){var a,o=Pa(fe.data.getAudioTracks());try{for(o.s();!(a=o.n()).done;)H.addTrack(a.value)}catch(F){o.e(F)}finally{o.f()}fe.createChildStreamFromStream(H,"blur").then(function(F){O.addChildren(F,"blur"),U(F)})})})}},{key:"unblur",value:function(){this.childrenTypeExists("blur")?(this.stopBlur(),this.releaseChildren("blur"),this.removeChildren("blur")):Pt.error("No blurred instance found for this stream")}},{key:"createMediaStreamTrackProcessor",value:function(){var O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Pt.debug("mediaStreamTrackProcessor kind: ".concat(O?"audio":"video"," created")),O){var U=this.data.getAudioTracks();if(U.length)return new MediaStreamTrackProcessor({track:U[0]});throw new Error("No audio tracks found")}var de=this.data.getVideoTracks();if(de.length)return new MediaStreamTrackProcessor({track:de[0]});throw new Error("No video tracks found")}},{key:"createMediaStreamTrackGenerator",value:function(){var O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Pt.debug("mediaStreamTrackGenerator kind: ".concat(O?"audio":"video"," created")),O?new MediaStreamTrackGenerator({kind:"audio"}):new MediaStreamTrackGenerator({kind:"video"})}},{key:"loadSegmentationAPI",value:function(){return new Promise(function(O,U){apiCC.resourcesLoader.loadjs(["http://dev.cdn.apizee.com/apiRTC/lib/mergereality/v1.0/merge_reality.js"],"merge-reality",{async:!0,numRetries:20,reqdelay:200,success:function(){Pt.debug("Segmentation API loaded"),mergeReality.then(O)},error:function(fe){U("Resources loading failed, depsNotFound: "+fe)},retrycb:function(fe,H){Pt.warn("Blur API model loading retry :"+fe+" ,delay before retry :"+H)}})})}},{key:"startMergeReality",value:function(O){var U=this;this.mergeRealityData={},this.mergeRealityLib=O,this.mergeRealityData.stop=!1,this.mergeRealityData.WIDTH=this.getSettings().width,this.mergeRealityData.HEIGHT=this.getSettings().height,this.mergeRealityData.WEBCAM_CANVAS=new OffscreenCanvas(this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WEBCAM_CTX=this.mergeRealityData.WEBCAM_CANVAS.getContext("2d",{alpha:!1}),this.mergeRealityData.MASK_CANVAS=new OffscreenCanvas(this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.MASK_CTX=this.mergeRealityData.MASK_CANVAS.getContext("2d",{alpha:!0}),this.mergeRealityData.SCREEN_VIDEO=document.createElement("video"),this.mergeRealityData.BG_SUB=new this.mergeRealityLib.BackgroundSubtractor,this.mergeRealityData.background=new this.mergeRealityLib.BackgroundImage(this.mergeRealityData.WEBCAM_CTX.getImageData(0,0,this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.MSTP=this.createMediaStreamTrackProcessor().readable,this.mergeRealityData.MSTG=this.createMediaStreamTrackGenerator(),this.mergeRealityData.SINK=this.mergeRealityData.MSTG.writable,this.mergeRealityData.MASK_TRANSFORMER=new TransformStream({transform:function(de,fe){U.mergeRealityData.stop||(U.mergeRealityData.MASK_CTX.save(),U.mergeRealityData.MASK_CTX.clearRect(0,0,U.mergeRealityData.WIDTH,U.mergeRealityData.HEIGHT),U.mergeRealityData.WEBCAM_CTX.clearRect(0,0,U.mergeRealityData.WIDTH,U.mergeRealityData.HEIGHT),U.mergeRealityData.WEBCAM_CTX.drawImage(de,0,0),U.mergeRealityData.MASK_DATA=U.mergeRealityData.BG_SUB.computeMask(U.mergeRealityData.WEBCAM_CTX.getImageData(0,0,U.mergeRealityData.WIDTH,U.mergeRealityData.HEIGHT),U.mergeRealityData.background),U.mergeRealityData.RES=U.mergeRealityData.BG_SUB.applyTransparency(U.mergeRealityData.WEBCAM_CTX.getImageData(0,0,U.mergeRealityData.WIDTH,U.mergeRealityData.HEIGHT),U.mergeRealityData.MASK_DATA),U.mergeRealityData.MASK_CTX.putImageData(U.mergeRealityData.RES,0,0),U.mergeRealityData.MASK_CTX.globalCompositeOperation="destination-atop",U.mergeRealityData.MASK_CTX.drawImage(U.mergeRealityData.SCREEN_VIDEO,0,0,U.mergeRealityData.WIDTH,U.mergeRealityData.HEIGHT),U.mergeRealityData.MASK_CTX.restore(),fe.enqueue(new VideoFrame(U.mergeRealityData.MASK_CANVAS))),de.close()}}),this.mergeRealityData.RES_MS=new MediaStream}},{key:"stopMergeReality",value:function(){this.mergeRealityData.stop=!0}},{key:"calibrateBackground",value:function(){this.childrenTypeExists("merge")?this.mergeRealityData.background=new this.mergeRealityLib.BackgroundImage(this.mergeRealityData.WEBCAM_CTX.getImageData(0,0,this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT),this.mergeRealityData.WIDTH,this.mergeRealityData.HEIGHT):Pt.error("No merged instance found for this stream")}},{key:"mergeReality",value:function(O){var U=this;return new Promise(function(de,fe){return void 0===window.MediaStreamTrackGenerator||void 0===window.MediaStreamTrackProcessor||void 0===window.TransformStream?fe("Your browser does not support InsertableStreams"):U.childrenTypeExists("merge")?fe("This stream already has a sub instance running for this"):void U.loadSegmentationAPI().then(function(H){U.startMergeReality(H),O.attachToElement(U.mergeRealityData.SCREEN_VIDEO),U.mergeRealityData.SCREEN_VIDEO.autoplay=!0,U.mergeRealityData.MSTP.pipeThrough(U.mergeRealityData.MASK_TRANSFORMER).pipeTo(U.mergeRealityData.SINK),U.mergeRealityData.RES_MS.addTrack(U.mergeRealityData.MSTG);var a,o=Pa(U.data.getAudioTracks());try{for(o.s();!(a=o.n()).done;)U.mergeRealityData.RES_MS.addTrack(a.value)}catch(z){o.e(z)}finally{o.f()}var F=U;U.createChildStreamFromStream(U.mergeRealityData.RES_MS,"merge").then(function(z){F.addChildren(z,"merge"),de(z)})})})}},{key:"unmergeReality",value:function(){this.childrenTypeExists("merge")?(this.stopMergeReality(),this.releaseChildren("merge"),this.removeChildren("merge")):Pt.error("No merged instance found for this stream")}},{key:"addPendingPromise",value:function(O,U,de){var fe=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,H=function(){de("Timeout problem during ".concat(O," process on a remote stream"))},a=setTimeout(H,fe);return this.promises.push({timeout:a,resolve:U,reject:de}),a}},{key:"resolvePendingPromise",value:function(O,U){this.promises.forEach(function(de){O===de.timeout&&(clearTimeout(O),de.resolve(U))})}},{key:"rejectPendingPromise",value:function(O,U){this.promises.forEach(function(de){O===de.timeout&&(clearTimeout(O),de.reject(U))})}},{key:"sendAudioFlowStatusChanged",value:function(){var O=this.getAudioFlowStatus();he.get(this).emit("audioFlowStatusChanged",O)}},{key:"sendVideoFlowStatusChanged",value:function(){var O=this.getVideoFlowStatus();he.get(this).emit("videoFlowStatusChanged",O)}},{key:"sendRemoteAudioFlowStatusChanged",value:function(O){O.enabled=!O.enabled,he.get(this).emit("remoteAudioFlowStatusChanged",O)}},{key:"sendRemoteVideoFlowStatusChanged",value:function(O){O.enabled=!O.enabled,he.get(this).emit("remoteVideoFlowStatusChanged",O)}}],[{key:"getAvailableEvents",value:function(){return Co}},{key:"createStreamFromUserMedia",value:function(O,U,de){var fe=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Pt.debug("createStreamFromUserMedia"),Pt.debug("audioInput :",O),Pt.debug("videoInput :",U),Pt.debug("constraints :",de),Pt.debug("options :",fe),new Promise(function(H,a){var o=!1!==O&&(null!==O||de&&de.hasOwnProperty("audio")),k=!1!==U&&(null!==U||de&&de.hasOwnProperty("video")),F={type:i.g.STREAM_TYPE_NO_INPUT,audioInput:O,videoInput:U},z="media";k?F.type=i.g.STREAM_TYPE_VIDEO:o&&(F.type=i.g.STREAM_TYPE_AUDIO),o&&!k?z="audio":!o&&k&&(z="videoOnly"),o&&!0===fe.enhancedAudioActivated&&(Pt.debug("Enhanced Audio is activated"),"Chrome"!==apiRTC.browser?Pt.debug("enhancedAudioActivated option is only available for Chrome"):(void 0===de&&(de={}),de.audio&&"object"===or(de.audio)||(de.audio={}),void 0===de.video&&(de.video={}),de.audio.echoCancellation=!1,de.audio.autoGainControl=!1,de.audio.noiseSuppression=!1)),apiRTC.createUserMediaStream({audioSourceId:O,videoSourceId:U,facingMode:fe.facingMode,gum_config:de,filters:fe.filters,type:z,success:function($){Pt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+$.userMediaStreamId),F.constructor=!0,F.userMediaStreamId=$.userMediaStreamId,H(new Y($.stream,F))},failure:function($,X){Pt.debug("[createStreamFromUserMedia] failure :",X),a(X)}})})}},{key:"createStreamFromMediaStream",value:function(O){return Pt.debug("createStreamFromMediaStream"),new Promise(function(U,de){var fe={};fe.type=i.g.STREAM_TYPE_NO_INPUT,O.getAudioTracks().length>0&&(fe.type=i.g.STREAM_TYPE_AUDIO),O.getVideoTracks().length>0&&(fe.type=i.g.STREAM_TYPE_VIDEO),apiRTC.createUserMediaStream({type:"media",stream:O,success:function(H){Pt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+H.userMediaStreamId),fe.constructor=!0,fe.userMediaStreamId=H.userMediaStreamId,U(new Y(H.stream,fe))},failure:function(H,a){Pt.debug("[createStreamFromUserMedia] failure :",a),de()}})})}},{key:"createScreensharingStream",value:function(O){return new Promise(function(U,de){apiRTC.createUserMediaStream({type:"screenSharing",captureSourceType:O,success:function(fe){Pt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+fe.userMediaStreamId);var H=new Y(fe.stream,{constructor:!0,type:i.g.STREAM_TYPE_VIDEO,userMediaStreamId:fe.userMediaStreamId});sr.set(H,!0),U(H)},failure:function(fe,H){Pt.debug("[createStreamFromUserMedia] failure :",H),de(H)}})})}},{key:"createDisplayMediaStream",value:function(O,U){return new Promise(function(de,fe){apiRTC.createUserMediaStream({type:"screenSharing",captureSourceType:O,displayMediaStreamConstraints:O,forceExtensionOnChrome:U,success:function(H){Pt.debug("[createStreamFromUserMedia] success; userMediaStreamId: "+H.userMediaStreamId);var a=new Y(H.stream,{constructor:!0,type:i.g.STREAM_TYPE_VIDEO,userMediaStreamId:H.userMediaStreamId});sr.set(a,!0),de(a)},failure:function(H,a){Pt.debug("[createStreamFromUserMedia] failure :",a),fe(a)}})})}},{key:"getLocalStreams",value:function(){return Fn.values()}},{key:"getStream",value:function(O){return null!=O&&Fn.has(O.toString())?Fn.get(O.toString()):null}}]),Y}(ke),bo=function(D){Wr(Y,D);var _=jr(Y);function Y(O,U,de,fe){var H;return Ur(this,Y),(H=_.call(this,O,U)).parent=de,H.childType=fe,H}return xr(Y,[{key:"release",value:function(){this.parent.stopBlur(),this.parent.removeChildren(this.childType);var O=this.data.getAudioTracks();O.length>0&&this.data.removeTrack(O[0]),vr(Ua(Y.prototype),"release",this).call(this)}}]),Y}(Tn);function lr(D,_){var Y="undefined"!=typeof Symbol&&D[Symbol.iterator]||D["@@iterator"];if(!Y){if(Array.isArray(D)||(Y=function(a,o){if(a){if("string"==typeof a)return Vr(a,o);var k=Object.prototype.toString.call(a).slice(8,-1);return"Object"===k&&a.constructor&&(k=a.constructor.name),"Map"===k||"Set"===k?Array.from(a):"Arguments"===k||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Vr(a,o):void 0}}(D))||_&&D&&"number"==typeof D.length){Y&&(D=Y);var O=0,U=function(){};return{s:U,n:function(){return O>=D.length?{done:!0}:{done:!1,value:D[O++]}},e:function(a){throw a},f:U}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var de,fe=!0,H=!1;return{s:function(){Y=Y.call(D)},n:function(){var a=Y.next();return fe=a.done,a},e:function(a){H=!0,de=a},f:function(){try{fe||null==Y.return||Y.return()}finally{if(H)throw de}}}}function Vr(D,_){(null==_||_>D.length)&&(_=D.length);for(var Y=0,O=new Array(_);Y<_;Y++)O[Y]=D[Y];return O}function Fr(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}var kn=R.Y.get("Session"),yo=ie.get(),da=new pe.Z,Sr=Mn.get(),Tr=Dn.get(),So=Symbol("ENTERPRISE_NOT_LOADED"),Ir=Symbol("ENTERPRISE_LOADED"),Br=new WeakMap,Gr=new WeakMap,qr=new WeakMap,dr=function(){function D(U,de,fe){if(function(H,a){if(!(H instanceof a))throw new TypeError("Cannot call a class as a function")}(this,D),kn.info("Create Enterprise"),!(fe instanceof Ui))throw"Cannot create Enterprise without a session";Br.set(this,fe),qr.set(this,de),Gr.set(this,U),this.status=So}var _,Y,O;return _=D,Y=[{key:"getSession",value:function(){return Br.get(this)}},{key:"getId",value:function(){return Gr.get(this).toString()}},{key:"getApiKey",value:function(){return qr.get(this).toString()}},{key:"load",value:function(){var U=this;return new Promise(function(de,fe){da.getEnterpriseUserList(U.getId(),U.getSession().getToken()).then(function(H){kn.info("Enterprise loaded!",H);var a,o=lr(H.users);try{for(o.s();!(a=o.n()).done;){var k=a.value;if(U.getSession().user.userId.toString()!==k.id.toString()){var F=Sr.getOrCreateContact(k.id);F.profile=k,F.enterprise=U,null===F.userData.get("username")&&F.userData.setProp("username",k.username),null===F.userData.get("photo_url")&&F.userData.setProp("photo_url",k.photo_url)}}}catch(z){o.e(z)}finally{o.f()}U.status=Ir,de()}).catch(function(H){var a="load() - Enterprise load error",o={error:new Error(a),code:i.g.ERROR_OTHER};H.hasOwnProperty("code")?o.code=H.code:H.hasOwnProperty("http_code")&&(o.code=H.http_code.toString().startsWith("4")?i.g.ERROR_INVALID_CREDENTIALS:i.g.ERROR_SERVER_UNAVAILABLE),kn.error(a,H),fe(o)})})}},{key:"getContacts",value:function(){var U={};if(this.status!==Ir)kn.error("Enterprise is not loaded, unable to getContacts");else{var de,fe=Sr.getContacts(),H=lr(fe.keys());try{for(H.s();!(de=H.n()).done;){var o=fe.get(de.value);null!==o.enterprise&&o.enterprise.id.toString()===this.getId()&&(U[o.getId()]=o)}}catch(k){H.e(k)}finally{H.f()}}return U}},{key:"getConfiguration",value:function(){return null}},{key:"uploadFile",value:function(U){var de=this,fe=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(H,a){kn.info("uploadFile()"),de.status===Ir?da.uploadFile(U,de.getSession().getToken(),fe).then(function(o){H(o.url)}).catch(function(o){kn.error(o),a(o)}):(kn.error("Enterprise is not loaded, cannot upload file"),a(new Error("Enterprise is not loaded, cannot upload file")))})}},{key:"getAvailableConferences",value:function(){var U=this;return kn.info("getAvailableConferences()"),new Promise(function(de,fe){var H={};da.getConferenceList(U.getSession().getToken()).then(function(a){var o,k=lr(a);try{for(k.s();!(o=k.n()).done;){var F=o.value;H[F.hash]=Tr.getOrCreateConference(F.hash),H[F.hash].friendlyName=F.friendlyName}}catch(z){k.e(z)}finally{k.f()}de(H)}).catch(function(a){kn.error(a),fe(a)})})}},{key:"getConference",value:function(U){var de=this;return new Promise(function(fe,H){var a={};a.token=de.getSession().getToken(),da.getWebconf(U,a).then(function(o){return fe(Tr.getOrCreateConference(o.hash))}).catch(function(o){return kn.error("getConference",o),H(o)})})}},{key:"createPrivateConference",value:function(){var U=this,de=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kn.info("createPrivateConference()"),new Promise(function(fe,H){var a=de.hasOwnProperty("friendlyName")?de.friendlyName:x.g.guid(),o=null,k=U.getSession().getToken();da.createConference(k,a,de).then(function(F){(o=Tr.getOrCreateConference(F.hash)).friendlyName=a;var z=de.hasOwnProperty("password")?de.password:"";return o.join({password:z,session:U.getSession()})}).then(function(){fe(o)}).catch(function(F){var z="createPrivateConference() - Could not create conference";kn.error(z,F),H(new Error(z))})})}},{key:"getTags",value:function(U){var de=this;return new Promise(function(fe,H){var a={};U&&U.hasOwnProperty("webconfId")&&(a.webconfId=U.webconfId),da.getEnterpriseTagList(de.getId(),de.getSession().getToken(),a).then(function(o){return o.hasOwnProperty("tags")&&Array.isArray(o.tags)?fe(o.tags):H(x.g.createError(i.g.ERROR_OTHER,"getTags() - unexpected response",kn))}).catch(function(o){return H(x.g.createError(i.g.ERROR_OTHER,"getTags() - cannot get tags",kn,{fromError:o}))})})}}],O=[{key:"fetchEnterpriseInformation",value:function(){var U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U.hasOwnProperty("cloudUrl")&&da.setCloudURL(U.cloudUrl),da.getEnterpriseInformation(U)}},{key:"fetchSiteAgents",value:function(U){var de=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(fe,H){de.hasOwnProperty("cloudUrl")&&da.setCloudURL(de.cloudUrl);var a=[];da.getSiteAgents(yo.getActiveApiKey(),U,de).then(function(o){var k,F=lr(o);try{for(F.s();!(k=F.n()).done;){var z=k.value;a.push({contact:Sr.getOrCreateContact(z.id),title:z.title,nickname:z.nickname,isPrefered:z.isPrefered})}}catch($){F.e($)}finally{F.f()}fe(a)}).catch(function(o){H(x.g.createError(i.g.ERROR_OTHER,"fetchSiteAgents() - could not fetch site agents",kn))})})}}],Y&&Fr(_.prototype,Y),O&&Fr(_,O),D}();function Rr(D){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}function To(D,_){if(!(D instanceof _))throw new TypeError("Cannot call a class as a function")}function Hr(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}function wr(D,_){return(wr=Object.setPrototypeOf||function(Y,O){return Y.__proto__=O,Y})(D,_)}function Io(D,_){if(_&&("object"===Rr(_)||"function"==typeof _))return _;if(void 0!==_)throw new TypeError("Derived constructors may only return object or undefined");return wa(D)}function wa(D){if(void 0===D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}function cr(D){return(cr=Object.setPrototypeOf?Object.getPrototypeOf:function(_){return _.__proto__||Object.getPrototypeOf(_)})(D)}e(3123);var Yt=R.Y.get("UserAgent"),Jt=ie.get(),Bn=new pe.Z,Ro="apizee:",wo="apirtc:",Ao="apzkey:",Mo="apiKey:",Qa=new WeakMap,Oo=["mediaDeviceChanged","externalJsLoadingStatus","ccsConnectionStatus","userMediaError"],Jr=function(D){!function(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&wr(a,o)}(H,D);var _,Y,O,U,de,fe=(U=H,de=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}(),function(){var a,o=cr(U);if(de){var k=cr(this).constructor;a=Reflect.construct(o,arguments,k)}else a=o.apply(this,arguments);return Io(this,a)});function H(){var a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};To(this,H),a=fe.call(this,Yt),Yt.debug("Create UserAgent"),a.uri=o.hasOwnProperty("uri")?o.uri:null,a.userId=null,a.username=null,a.profile=null,a.preRegisterUserData=new Ke,a.callStatsMonitoringEnabled=null,a.callStatsMonitoringInterval=null,a.meshModeEnabled=null,a.apiRTCMediaDeviceDetectionEnabled=!!o.hasOwnProperty("apiRTCMediaDeviceDetectionEnabled")&&o.apiRTCMediaDeviceDetectionEnabled,a.apiRTCMediaDeviceDetectionDelay=o.hasOwnProperty("apiRTCMediaDeviceDetectionDelay")?o.apiRTCMediaDeviceDetectionDelay:i.g.APIRTC_MEDIA_DEVICE_DETECTION_DELAY,a.targetBandwidthUsage=0,a.videoBandwidthSettings={overallIncoming:3e3,overallOutgoing:3e3},a.currentSession=null,a.enterprise=null,a.capabilities={whiteboardCursor:"ON",mediaDeviceChanged:"ON",webRTCCompliant:"ON",screenSharingCompliant:"ON",qoSStatCompliant:"ON",backgroundRemoval:"ON",streamCapabilities:"ON"},a.browser=apiRTC.browser,a.browser_major_version=apiRTC.browser_major_version,a.browser_version=apiRTC.browser_version,a.osName=apiRTC.osName,a.osVersion=apiRTC.osVersion,a.browserInfo=apiRTC.browserInfo,a.browserDetails=apiRTC.browserDetails,Qa.set(wa(a),null),Jt.createWhiteBoard(),apiCC.activateScreenSharing();var k=function(X){he.get(wa(a)).emit("mediaDeviceChanged",{added:X.detail.diff.added,removed:X.detail.diff.removed,updated:X.detail.diff.updated,updateReason:X.detail.updateReason,firstMediaDeviceListInitialization:X.detail.firstMediaDeviceListInitialization})};apiRTC.addEventListener("mediaDeviceChanged",k);var F=function(X){he.get(wa(a)).emit("externalJsLoadingStatus",{extjs:X.detail.extjs,status:X.detail.status})};apiRTC.addEventListener("externalJsLoadingStatus",F);var z=function(X){var se=null;"onChannelOpened"===X.detail.channelEvent?se="connected":"onChannelDisconnect"===X.detail.channelEvent?se="disconnected":"onChannelReconnecting"===X.detail.channelEvent?se="retry":("onChannelConnectError"===X.detail.channelEvent||"onChannelError"===X.detail.channelEvent)&&(se="error"),null!==se&&he.get(wa(a)).emit("ccsConnectionStatus",{status:se})};apiRTC.addEventListener("channelEvent",z);var $=function(X){var se={error:X.detail.error};"media"===X.detail.callType?(se.audio=!0,se.video=!0,se.screenSharing=!1):"audio"===X.detail.callType?(se.audio=!0,se.video=!1,se.screenSharing=!1):"videoOnly"===X.detail.callType?(se.audio=!1,se.video=!0,se.screenSharing=!1):"screenSharing"===X.detail.callType?(se.audio=!1,se.video=!0,se.screenSharing=!0):"screenSharingWithAudio"===X.detail.callType&&(se.audio=!0,se.video=!0,se.screenSharing=!0),he.get(wa(a)).emit("userMediaError",se)};return apiRTC.addEventListener("userMediaError",$),a.checkUACapabilities(),"OFF"===a.capabilities.mediaDeviceChanged&&(Yt.debug("mediaDeviceChanged is not supported"),!0===a.apiRTCMediaDeviceDetectionEnabled&&(Yt.debug("apiRTCMediaDeviceDetectionEnabled is activated, starting process"),setInterval(function(){apiCC.mediaDeviceMgr.getMediaDevices()},a.apiRTCMediaDeviceDetectionDelay))),apiRTC.userAgentInstance=wa(a),a}return _=H,Y=[{key:"fetchUserMediaDevices",value:function(){return Yt.warn("DEPRECATION WARNING : fetchUserMediaDevices() is now deprecated, use getUserMediaDevices() instead"),new Promise(function(a,o){"IE"===apiCC.browser&&apiCC.browser_version>8?(apiCC.getMediaDevicesWithCB(apiCC.mediaDeviceMgr.gotSources),a(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray)):apiCC.getMediaDevices().then(function(k){apiCC.mediaDeviceMgr.gotSources(k),a(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray)}).catch(function(){Yt.log("Error on MediaDeviceManager::getMediaDevices"),apiCC.mediaDeviceMgr.gotSources(null),o(x.g.createError(i.g.ERROR_OTHER,"fetchUserMediaDevices() - Could not get media devices",Yt))})})}},{key:"getUserMediaDevices",value:function(){return apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray}},{key:"createStream",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Yt.info("createStream() with option :",a),Tn.createStreamFromUserMedia(a.audioInputId,a.videoInputId,a.constraints,a)}},{key:"createStreamFromMediaStream",value:function(a){return Yt.info("createStreamFromMediaStream()"),Tn.createStreamFromMediaStream(a)}},{key:"fetchNetworkInformation_v2",value:function(a,o){Yt.debug("fetchNetworkInformation Version 2 :",a);var k=Bn.cloudUrl;null!=a&&(k=a);var F={testServer:k,httpPing:{},upload:{},download:{}};return null!=o&&Array.isArray(o)?(apiRTC.bandwidthRatingThresholds=o,Yt.debug("New bandwidthRatingThresholds is defined :",apiRTC.bandwidthRatingThresholds)):Yt.debug("Using default bandwidthRatingThresholds :",apiRTC.bandwidthRatingThresholds),apiRTC.bandwidthTestServer=k,Yt.info("Start Network test"),new Promise(function(z,$){apiRTC.testUserPing(function(X,se){null!==X?$(X):(F.httpPing=se,apiRTC.testUserUpload(25e4,function(Me,Fe){null!==Me?$(Me):(F.upload.kbps=8*Fe.kBPerSec,F.upload.rating=Fe.rating,apiRTC.testUserUploadLoop(5e5,F.upload,function(bt,ht){null!==bt?$(bt):(F.upload.kbps=8*ht.kBPerSec,F.upload.rating=ht.rating,apiRTC.testUserDownload(256,function(Dt,Ut){null!==Dt?$(Dt):(F.download.kbps=8*Ut.kBPerSec,F.download.rating=Ut.rating,apiRTC.testUserDownloadLoop(1e3,F.download,function(gi,dn){null!==gi?$(gi):(F.download.kbps=8*dn.kBPerSec,F.download.rating=dn.rating,z(F))}))}))}))}))})})}},{key:"fetchNetworkInformation_v1",value:function(a,o){Yt.debug("fetchNetworkInformation Version 1 :",a);var k=Bn.cloudUrl;null!=a&&(k=a);var F={testServer:k,httpPing:{},upload:{},download:{}};return null!=o&&Array.isArray(o)?(apiRTC.bandwidthRatingThresholds=o,Yt.debug("New bandwidthRatingThresholds is defined :",apiRTC.bandwidthRatingThresholds)):Yt.debug("Using default bandwidthRatingThresholds :",apiRTC.bandwidthRatingThresholds),apiRTC.bandwidthTestServer=k,Yt.info("Start Network test"),new Promise(function(z,$){apiRTC.testUserPing(function(X,se){null!==X?$(X):(F.httpPing=se,apiRTC.testUserUpload(25e4,function(Me,Fe){null!==Me?$(Me):(F.upload.kbps=8*Fe.kBPerSec,F.upload.rating=Fe.rating,F.upload.kbps>=1e3&&apiRTC.testUserUpload(5e5,function(bt,ht){null!==bt?$(bt):(F.upload.kbps=8*ht.kBPerSec,F.upload.rating=ht.rating)}),apiRTC.testUserDownload(256,function(bt,ht){null!==bt?$(bt):(F.download.kbps=8*ht.kBPerSec,F.download.rating=ht.rating,F.download.kbps>=500&&F.download.kbps<1500?apiRTC.testUserDownload(500,function(Dt,Ut){null!==Dt?$(Dt):(F.download.kbps=8*Ut.kBPerSec,F.download.rating=Ut.rating,z(F))}):F.download.kbps>=1500?apiRTC.testUserDownload(768,function(Dt,Ut){null!==Dt?$(Dt):(F.download.kbps=8*Ut.kBPerSec,F.download.rating=Ut.rating,z(F))}):z(F))}))}))})})}},{key:"fetchNetworkInformation",value:function(a,o){return this.fetchNetworkInformation_v1(a,o)}},{key:"fetchGeolocationInformation",value:function(a){return null==a&&(a={enableHighAccuracy:!1,timeout:1/0,maximumAge:0}),new Promise(function(o,k){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(F){o(F)},function(F){k(F)},a)})}},{key:"setUserData",value:function(a){this.currentSession&&this.currentSession.setUserData(a)}},{key:"setUsername",value:function(a){this.currentSession?this.currentSession.setUsername(a):this.preRegisterUserData.setProp("username",a)}},{key:"setPhotoUrl",value:function(a){this.currentSession?this.currentSession.setPhotoUrl(a):this.preRegisterUserData.setProp("photo_url",a)}},{key:"getUserData",value:function(){return this.currentSession?this.currentSession.getUserData():this.preRegisterUserData}},{key:"getUsername",value:function(){return this.currentSession?this.currentSession.getUsername():null!==this.preRegisterUserData.get("username")?this.preRegisterUserData.get("username"):null!==this.preRegisterUserData.get("nickname")?this.preRegisterUserData.get("nickname"):this.username}},{key:"getPhotoUrl",value:function(){return this.currentSession?this.currentSession.getPhotoUrl():null!==this.preRegisterUserData.get("photo_url")?this.preRegisterUserData.get("photo_url"):null!==this.preRegisterUserData.get("photoUrl")?this.preRegisterUserData.get("photoUrl"):this.userId?Bn.getUserPhotoUrl(this.userId):null}},{key:"fetchProfileInformation",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(k,F){var z=null;null===a.profile||o?a.userId&&null!==(z=Jt.getActiveApiKey())?Bn.getUserProfile(z,a.userId).then(function($){a.profile=$,k($)}).catch(F):F("fetchProfileInformation() - missing registration"):k(a.profile)})}},{key:"getEnterprise",value:function(){return Qa.get(this)}},{key:"getCurrentSession",value:function(){return this.currentSession}},{key:"getEventCenter",value:function(){return apiRTC.eventCenter}},{key:"startWhiteboard",value:function(a,o){Yt.trace("startWhiteboard()"),Jt.whiteBoardClient.start(),Jt.whiteBoardClient.setCanvas(a),null!=o&&Jt.whiteBoardClient.setUserCursorColor(o)}},{key:"stopWhiteboard",value:function(){Yt.trace("stopWhiteboard()"),Jt.whiteBoardClient.stop()}},{key:"getWhiteboardClient",value:function(){return Yt.trace("getWhiteboardClient()"),Jt.whiteBoardClient}},{key:"register",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(k,F){if(Yt.info("Register "+a.uri),o.hasOwnProperty("uri")&&(a.uri=o.uri),o.hasOwnProperty("cloudUrl")&&Bn.setCloudURL(o.cloudUrl),o.hasOwnProperty("cloudFetchRetries")&&Bn.setFetchRetries(o.cloudFetchRetries),o.hasOwnProperty("cloudFetchRetryDelay")&&Bn.setFetchRetryDelay(o.cloudFetchRetryDelay),null!==a.uri)if(a.currentSession)F(x.g.createError(i.g.ERROR_APIRTC_SESSION_ALREADY_ON,"register() - Session already ON",Yt));else if(a.uri.startsWith("token:"))Do(a,o,k,F);else if(a.uri.startsWith(Ro)||a.uri.startsWith(wo))_o(a,o,k,F);else if(a.uri.startsWith(Ao)||a.uri.startsWith(Mo))ko(a,o,k,F);else{var z=a.uri.split(":")[0];F(x.g.createError(i.g.ERROR_REGISTRATION_URI_INVALID,"register() - prefix invalid used for uri :"+z,Yt))}else F(x.g.createError(i.g.ERROR_REGISTRATION_URI_INVALID,"register() - Cannot register UserAgent, no uri was specified",Yt))})}},{key:"unregister",value:function(){var a=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{invalidateUserToken:!0};return new Promise(function(k,F){null!==a.currentSession?a.currentSession.disconnect(o).then(function(){a.currentSession=null,Qa.set(a,null),k()}).catch(function(z){F(x.g.createError(i.g.ERROR_OTHER,"unregister() - unregistration error",Yt))}):F(x.g.createError(i.g.ERROR_OTHER,"unregister() - no current session",Yt))})}},{key:"isRegistered",value:function(){return null!==this.currentSession}},{key:"getDefaultDevices",value:function(){return{audioInput:apiCC.mediaDeviceMgr.defaultAudioInput,audioOutput:apiCC.mediaDeviceMgr.defaultAudioOuput,videoInput:apiCC.mediaDeviceMgr.defaultVideoInput}}},{key:"enableCallStatsMonitoring",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};["chrome","firefox"].indexOf(apiCC.browserDetails.type)<0?Yt.warn("enableCallStatsMonitoring() is only supported on Chrome and Firefox, support on other browsers will be added soon"):!0===a?(this.callStatsMonitoringEnabled=!0,x.g.isPropertyTypeof(o,"interval","number")&&o.interval>=1e3&&(this.callStatsMonitoringInterval=o.interval),this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.enableCallStatsMonitoring(!0,this.callStatsMonitoringInterval)):(this.callStatsMonitoringEnabled=!1,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.enableCallStatsMonitoring(!1))}},{key:"enableActiveSpeakerDetecting",value:function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!0===a?x.g.isPropertyTypeof(o,"threshold","number")&&o.threshold>0?apiRTC.enableActiveSpeakerDetecting(!0,o.threshold):apiRTC.enableActiveSpeakerDetecting(!0):apiRTC.enableActiveSpeakerDetecting(!1)}},{key:"enableMeshRoomMode",value:function(a){!1===a||!0===a?(this.meshModeEnabled=a,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.enableMeshRoomMode(a)):Yt.error("Wrong value",a)}},{key:"setTargetBandwidthUsage",value:function(a){"number"!=typeof a&&!isNaN(a)&&a>0?(this.targetBandwidthUsage=a,this.isRegistered&&Jt.webRTCClient.setVideoBandwidth(a)):Yt.error("Unvalid target bandwidth usage value",a)}},{key:"setOverallIncomingVideoBandwidth",value:function(a){a>0?(this.videoBandwidthSettings.overallIncoming=a,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setOverallIncomingVideoBandwidth(a)):(delete this.videoBandwidthSettings.overallIncoming,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setOverallIncomingVideoBandwidth(0))}},{key:"setOverallOutgoingVideoBandwidth",value:function(a){a>0?(this.videoBandwidthSettings.overallOutgoing=a,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setOverallOutgoingVideoBandwidth(a)):(delete this.videoBandwidthSettings.overallOutgoing,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setOverallOutgoingVideoBandwidth(0))}},{key:"setPerCallIncomingVideoBandwidth",value:function(a){a>0?(this.videoBandwidthSettings.perCallIncoming=a,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setPerCallIncomingVideoBandwidth(a)):(delete this.videoBandwidthSettings.perCallIncoming,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setPerCallIncomingVideoBandwidth(0))}},{key:"setPerCallOutgoingVideoBandwidth",value:function(a){a>0?(this.videoBandwidthSettings.perCallOutgoing=a,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setPerCallOutgoingVideoBandwidth(a)):(delete this.videoBandwidthSettings.perCallOutgoing,this.isRegistered&&Jt.webRTCClient&&Jt.webRTCClient.setPerCallOutgoingVideoBandwidth(0))}},{key:"updateMediaOnCall",value:function(a,o){Jt.webRTCClient.updateMediaDeviceOnCall(a,o)}},{key:"getCapabilities",value:function(){return this.capabilities}},{key:"getBrowser",value:function(){return this.capabilities}},{key:"getBrowserMajorVersion",value:function(){return this.browser_major_version}},{key:"getBrowserVersion",value:function(){return this.browser_version}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getBrowserInfo",value:function(){return this.browserInfo}},{key:"getBrowserDetails",value:function(){return this.browserDetails}},{key:"checkUACapabilities",value:function(){Yt.debug("checkUACapabilities"),"iOS"===apiRTC.osName&&(Yt.debug("Deactivating whiteboardCursor for iOS"),this.capabilities.whiteboardCursor="OFF"),"Android"===apiRTC.osName&&"Chrome"===apiRTC.browser&&(Yt.debug("mediaDeviceChanged not supported on Chrome/Android"),this.capabilities.mediaDeviceChanged="OFF"),"Safari"!==y.Xh&&"Mobile Safari"!==y.Xh||(Yt.debug("mediaDeviceChanged not supported on Safari"),this.capabilities.mediaDeviceChanged="OFF"),!1===apiRTC.webRTCCompliant&&(Yt.debug("WebRTC not compliant"),this.capabilities.webRTCCompliant="OFF"),!1===apiRTC.screenSharingCompliant&&(Yt.debug("screenSharing not compliant"),this.capabilities.screenSharingCompliant="OFF"),!1===apiRTC.qoSStatCompliant&&(Yt.debug("qoS Stat not compliant"),this.capabilities.qoSStatCompliant="OFF"),"requestVideoFrameCallback"in HTMLVideoElement.prototype||(Yt.debug("background removal not compliant"),this.capabilities.backgroundRemoval="OFF"),"getCapabilities"in MediaStreamTrack.prototype||(Yt.debug("Stream capabilities not compliant"),this.capabilities.streamCapabilities="OFF")}},{key:"startPrecallTest",value:function(a,o,k,F,z){Jt.webRTCClient.startPrecallTest(a,o,k,F,z)}},{key:"sendLogToCloud",value:function(a,o,k,F){apiCC.sendLogToCloud(a,o,k,F)}}],O=[{key:"getAvailableEvents",value:function(){return Oo}}],Y&&Hr(_.prototype,Y),O&&Hr(_,O),H}(ke),_o=function(D,_,Y,O){var U=D.uri.split(":");Yt.debug("register() - Registration using prefix :"+U[0]),null!==_.password&&"string"==typeof _.password?Bn.authentication(U[1],_.password).then(function(fe){return Yr(D,fe.token,_)}).then(function(fe){Y(fe)}).catch(function(fe){var H="register() - An error occured during cloud credentials registration :"+JSON.stringify(fe),a={error:new Error(H),code:i.g.ERROR_OTHER};Yt.error(H,fe),fe.hasOwnProperty("code")?a.code=fe.code:fe.hasOwnProperty("http_code")&&(a.code=fe.http_code.toString().startsWith("4")?i.g.ERROR_INVALID_CREDENTIALS:i.g.ERROR_SERVER_UNAVAILABLE),O(a)}):O(x.g.createError(i.g.ERROR_INVALID_CREDENTIALS,"register() - No password was specified for apizee: UserAgent registration",Yt))},Do=function(D,_,Y,O){Yt.debug("register() - Registration using prefix :token:");var U=D.uri.split(":")[1];Bn.checkUserToken(U).then(function(de){return Yr(D,U,_)}).then(Y).catch(function(de){O(x.g.createError(i.g.ERROR_OTHER,"register() - An error occured during cloud token registration",Yt))})},ko=function(D,_,Y,O){var U=D.uri.split(":");Yt.debug("register() - Registration using prefix :"+U[0]);var de=U[1];new Promise(function(fe,H){_.ccs?fe(_.ccs):Bn.getPreferredCCS(de).then(function(a){fe(a.ccs)}).catch(function(){H(x.g.createError(i.g.ERROR_OTHER,"register() - Could not get preferred CCS",Yt))})}).then(function(fe){D.currentSession=new Ui(D),D.currentSession.user=D,D.currentSession.token=null,D.username=x.g.isPropertyTypeof(_,"nickname","string")?_.nickname:"guest-"+x.g.guid().substr(0,13),D.preRegisterUserData.setProp("username",D.username),D.preRegisterUserData.setProp("userConfId",D.username+Date.now()),_.userData&&D.preRegisterUserData.setProps(_.userData);var H={apiKey:de,MCUActivated:!0,mcu:_.hasOwnProperty("mcu")?_.mcu:i.g.DEFAULT_MCU,nickname:D.username,ccsServer:fe,bandwidthTestServer:Bn.cloudUrl,webRTCPluginActivated:!0,userData:D.preRegisterUserData,tryAudioCallAfterUserMediaError:!0,extJsLoadingRetryNb:_.extJsLoadingRetryNb,extJsLoadingRetryDelay:_.extJsLoadingRetryDelay,ccsConnectionRetryNb:_.ccsConnectionRetryNb,ccsConnectionRetryDelay:_.ccsConnectionRetryDelay,turnServerAddress:_.turnServerAddress,userAcceptOnIncomingDataCall:_.userAcceptOnIncomingDataCall,userAcceptOnIncomingScreenSharingCall:_.userAcceptOnIncomingScreenSharingCall};return _.hasOwnProperty("id")&&(H.apiCCId=_.id),x.g.isPropertyTypeof(_,"idPersistenceTimeout","number")&&_.idPersistenceTimeout>=0&&(H.apiCCIdPersistenceTimeout=_.idPersistenceTimeout),_.hasOwnProperty("groups")&&(H.presenceGroup=_.groups),_.hasOwnProperty("subscribeTo")&&(H.subscribeToPresenceGroup=_.subscribeTo),_.hasOwnProperty("contactDisconnectionDelay")&&(Yt.debug("Setting contactDisconnectionDelay :",_.contactDisconnectionDelay),Jt.contactDisconnectionDelay=_.contactDisconnectionDelay),H.idConversionActivated=!1,_.hasOwnProperty("idConversionActivated")&&(H.idConversionActivated=_.idConversionActivated),_.hasOwnProperty("conversationSpace")&&(H.conversationSpace=_.conversationSpace),_.hasOwnProperty("token")&&(H.token=_.token,D.currentSession.ccsToken=_.token),Jt.initializeApiRTC(H)}).then(function(fe){!1!==D.callStatsMonitoringEnabled&&!0!==D.callStatsMonitoringEnabled||Jt.webRTCClient.enableCallStatsMonitoring(D.callStatsMonitoringEnabled,D.callStatsMonitoringInterval),!1!==D.meshModeEnabled&&!0!==D.meshModeEnabled||Jt.webRTCClient.enableMeshRoomMode(D.meshModeEnabled),D.targetBandwidthUsage>0&&Jt.webRTCClient.setVideoBandwidth(D.targetBandwidthUsage),D.videoBandwidthSettings.overallIncoming>0&&Jt.webRTCClient.setOverallIncomingVideoBandwidth(D.videoBandwidthSettings.overallIncoming),D.videoBandwidthSettings.overallOutgoing>0&&Jt.webRTCClient.setOverallOutgoingVideoBandwidth(D.videoBandwidthSettings.overallOutgoing),D.videoBandwidthSettings.perCallIncoming>0&&Jt.webRTCClient.setPerCallIncomingVideoBandwidth(D.videoBandwidthSettings.perCallIncoming),D.videoBandwidthSettings.perCallOutgoing>0&&Jt.webRTCClient.setPerCallOutgoingVideoBandwidth(D.videoBandwidthSettings.perCallOutgoing),D.userId=fe,D.currentSession.init(fe),Yt.log("register() - APIRTC init OK",fe),null!=Jt.apiRTCSession.userData&&(D.currentSession.userData=new Ke(Jt.apiRTCSession.userData)),Y(D.currentSession)}).catch(function(fe){O(x.g.createError(i.g.ERROR_APIRTC_INITIALISATION_FAILED,"register() - ApiRTC Initialization error : "+fe,Yt)),delete D.currentSession,D.currentSession=null})},Yr=function(D,_){var Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=null,U=null;return Yt.debug("initializeCloudUASession :",Y),new Promise(function(de,fe){Bn.getConnectedUserInformation(_).then(function(H){if(U=H,Yt.debug("Connected user information : ",H),D.currentSession=new Ui(D),D.currentSession.user=D,D.currentSession.token=H.token,Y.hasOwnProperty("idPersistenceTimeout")&&(D.currentSession.idPersistenceTimeout=Y.idPersistenceTimeout),D.username=H.nickname,D.preRegisterUserData.setProp("username",D.username),D.preRegisterUserData.setProp("nickname",D.username),D.preRegisterUserData.setProp("photo_url",H.photo_url),H.mail&&D.preRegisterUserData.setProp("mail",H.mail),D.preRegisterUserData.setProp("userConfId",D.username+Date.now()),Y.userData&&D.preRegisterUserData.setProps(Y.userData),!Y.hasOwnProperty("overLoadedApiRTCKey")||null==Y.overLoadedApiRTCKey||H.apiKey===Y.overLoadedApiRTCKey)return D.userId=H.userId,O=new dr(H.enterpriseId,H.apiKey,D.currentSession),Qa.set(D,O),O.load();Yt.debug("overLoadedApiRTCKey is defined :",Y.overLoadedApiRTCKey),O=new dr(H.enterpriseId,Y.overLoadedApiRTCKey,D.currentSession),delete Y.id,D.userId=null,Qa.set(D,O),Yt.debug("... no enterprise users data loading")}).then(function(){var H={apiKey:O.getApiKey(),ccsServer:Y.ccs||U.ccs,MCUActivated:!0,mcu:Y.hasOwnProperty("mcu")?Y.mcu:i.g.DEFAULT_MCU,nickname:D.username,bandwidthTestServer:Bn.cloudUrl,webRTCPluginActivated:!0,apiCCId:Y.hasOwnProperty("id")?Y.id:D.userId,userData:D.preRegisterUserData,tryAudioCallAfterUserMediaError:!0,presenceGroup:["agent"],subscribeToPresenceGroup:["agent","visitor"],extJsLoadingRetryNb:Y.extJsLoadingRetryNb,extJsLoadingRetryDelay:Y.extJsLoadingRetryDelay,ccsConnectionRetryNb:Y.ccsConnectionRetryNb,ccsConnectionRetryDelay:Y.ccsConnectionRetryDelay,turnServerAddress:Y.turnServerAddress,userAcceptOnIncomingDataCall:Y.userAcceptOnIncomingDataCall,userAcceptOnIncomingScreenSharingCall:Y.userAcceptOnIncomingScreenSharingCall};return x.g.isPropertyTypeof(Y,"idPersistenceTimeout","number")&&Y.idPersistenceTimeout>=0&&(H.apiCCIdPersistenceTimeout=Y.idPersistenceTimeout),Y.hasOwnProperty("groups")&&(H.presenceGroup=Y.groups),Y.hasOwnProperty("subscribeTo")&&(H.subscribeToPresenceGroup=Y.subscribeTo),Y.hasOwnProperty("contactDisconnectionDelay")&&(Yt.debug("Setting contactDisconnectionDelay :",Y.contactDisconnectionDelay),Jt.contactDisconnectionDelay=Y.contactDisconnectionDelay),H.idConversionActivated=!1,Y.hasOwnProperty("idConversionActivated")&&(H.idConversionActivated=Y.idConversionActivated),Y.hasOwnProperty("conversationSpace")&&(H.conversationSpace=Y.conversationSpace),Jt.initializeApiRTC(H)}).then(function(H){!1!==D.callStatsMonitoringEnabled&&!0!==D.callStatsMonitoringEnabled||Jt.webRTCClient.enableCallStatsMonitoring(D.callStatsMonitoringEnabled,D.callStatsMonitoringInterval),!1!==D.meshModeEnabled&&!0!==D.meshModeEnabled||Jt.webRTCClient.enableMeshRoomMode(D.meshModeEnabled),D.targetBandwidthUsage>0&&Jt.webRTCClient.setVideoBandwidth(D.targetBandwidthUsage),D.videoBandwidthSettings.overallIncoming>0&&Jt.webRTCClient.setOverallIncomingVideoBandwidth(D.videoBandwidthSettings.overallIncoming),D.videoBandwidthSettings.overallOutgoing>0&&Jt.webRTCClient.setOverallOutgoingVideoBandwidth(D.videoBandwidthSettings.overallOutgoing),D.videoBandwidthSettings.perCallIncoming>0&&Jt.webRTCClient.setPerCallIncomingVideoBandwidth(D.videoBandwidthSettings.perCallIncoming),D.videoBandwidthSettings.perCallOutgoing>0&&Jt.webRTCClient.setPerCallOutgoingVideoBandwidth(D.videoBandwidthSettings.perCallOutgoing),D.currentSession.init(H),Yt.info("APIRTC init OK",H),null!=Jt.apiRTCSession.userData&&(D.currentSession.userData=new Ke(Jt.apiRTCSession.userData)),de(D.currentSession)}).catch(function(H){Yt.error(H),fe(H)})})},xa=R.Y.get("ResourcesLoader"),Po=function(){function D(){(function(O,U){if(!(O instanceof U))throw new TypeError("Cannot call a class as a function")})(this,D),this.loadedJsLinks=[]}var _,Y;return _=D,Y=[{key:"loadjs",value:function(O){function U(de,fe,H){return O.apply(this,arguments)}return U.toString=function(){return O.toString()},U}(function(O,U,de){var fe=this;xa.info("Load js resources",O),xa.debug("Already loaded js",this.loadedJsLinks);var H=de.success;if(0===(O=O.filter(function(a){return!fe.loadedJsLinks.includes(a)})).length)return xa.debug("Skip resources loading, all resources previously loaded"),void(H instanceof Function&&H());xa.debug("Filtered resources to load",O),de.success=function(){fe.loadedJsLinks.push.apply(fe.loadedJsLinks,O),H instanceof Function&&H()},loadjs(O,U,de)})},{key:"unloadjs",value:function(O){var U=this;xa.info("Unload js",O),O.forEach(function(de){var fe=document.querySelector('script[src="'+de+'"]');void 0!==fe&&(fe.remove(),U.loadedJsLinks=U.loadedJsLinks.filter(function(H){return H!==de}))}),xa.debug("Scripts unloaded, currently loaded js",this.loadedJsLinks)}},{key:"reset",value:function(){unloadjs(this.loadedJsLinks),this.loadedJsLinks=[]}}],Y&&function(D,_){for(var Y=0;Y<_.length;Y++){var O=_[Y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(D,O.key,O)}}(_.prototype,Y),D}();!function(D){var _,Y,O=null,U=null,de=[];function fe(){return Math.random().toString(36).substr(2)}_=function(){if("undefined"!=typeof apiRTC_React)return"react-native";var H,a=navigator.appName,o=navigator.userAgent,k=o.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return k&&null!==(H=o.match(/version\/([\.\d]+)/i))&&(k[2]=H[1]),(k=k?[k[1],k[2]]:[a,navigator.appVersion,"-?"])[0]}(),Y=function(){if("undefined"!=typeof apiRTC_React)return 1;var H,a=navigator.appName,o=navigator.userAgent,k=o.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return k&&null!==(H=o.match(/version\/([\.\d]+)/i))&&(k[2]=H[1]),(k=k?[k[1],k[2]]:[a,navigator.appVersion,"-?"])[1]}(),U=new function(){("MSIE"===_&&Y>8||"Netscape"===_)&&function(){function H(a,o){o=o||{bubbles:!1,cancelable:!1,detail:void 0};var k=document.createEvent("CustomEvent");return k.initCustomEvent(a,o.bubbles,o.cancelable,o.detail),k}H.prototype=D.CustomEvent.prototype,D.CustomEvent=H}(),this.eventDispatchMgr=function(H,a){if("undefined"!=typeof apiRTC_React)eventManager.dispatchEvent({type:H,detail:a});else if("MSIE"===_&&Y<=8)"undefined"!=typeof $jqApz?$jqApz.event.trigger({type:H,detail:a}):"undefined"!=typeof jQuery&&jQuery.event.trigger({type:H,detail:a});else{var k=new CustomEvent(H,{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(k)}},this.createGetUserFromIdAnswerEvent=function(H){var a={eventType:"getUserFromIdAnswer",time:new Date,message:H};this.eventDispatchMgr("getUserFromIdAnswer",a)},this.createGetAllUsersAnswerEvent=function(H){var a={eventType:"getAllUsersAnswer",time:new Date,message:H};this.eventDispatchMgr("getAllUsersAnswer",a)},this.createErrorEvent=function(H){var a={eventType:"error :",time:new Date,errorInfo:H};this.eventDispatchMgr("error",a)},this.createSearchUserAnswerEvent=function(H,a,o){var k={eventType:"searchUserAnswer :",time:new Date,searchStr:H,searchAnswerList:a,group:o};this.eventDispatchMgr("searchUserAnswer",k)}},(O={version:"1.0.4",description:"ApiRTC DataBase Library"}).init=function(H){this.socket=H,this.socket.on("getUserFromIdAnswer",this.callback(this,"onGetUserFromIdAnswer")).on("getAllUsersAnswer",this.callback(this,"onGetAllUsersAnswer")).on("searchUserAnswer",this.callback(this,"onSearchUserAnswer"))},O.createUser=function(H){if(null!==H&&null!==H.mail&&null!==H.id){var a=JSON.stringify(H);this.socket.emit("createUser",a)}},O.searchUserInGroup=function(H,a,o,k){var F=null,z=null,$=fe();(void 0===a||"all"!==a&&"connected"!==a&&"disconnected"!==a)&&(a="all"),null!==H&&(F={searchStr:H,presenceState:a,group:o},void 0!==k&&(F.callbackId=$,de[$]=k),z=JSON.stringify(F),this.socket.emit("searchUser",z))},O.searchUser=function(H,a,o,k){"function"==typeof o?O.searchUserInGroup(H,a,void 0,o):O.searchUserInGroup(H,a,o,k)},O.onSearchUserAnswer=function(H){var a=JSON.parse(H);void 0!==a.callbackId&&a.callbackId in de?(de[a.callbackId](a.searchStr,a.searchAnswerList),de.splice(a.callbackId,1)):U.createSearchUserAnswerEvent(a.searchStr,a.searchAnswerList,a.group)},O.getUserFromId=function(H,a){var o=null,k=null,F=fe();null!==H&&(o={id:H},void 0!==a&&(o.callbackId=F,de[F]=a),k=JSON.stringify(o),this.socket.emit("getUserFromId",k))},O.onGetUserFromIdAnswer=function(H){null!==H&&void 0!==H.callbackId&&H.callbackId in de?(de[H.callbackId](H),de.splice(H.callbackId,1)):U.createGetUserFromIdAnswerEvent(H)},O.getAllUsers=function(){var a;a=JSON.stringify({}),this.socket.emit("getAllUsers",a)},O.onGetAllUsersAnswer=function(H){U.createGetAllUsersAnswerEvent(H)},O.setPresenceStatus=function(H,a,o){var F;F=JSON.stringify({id:H,presenceStatus:a,commentStatus:o}),this.socket.emit("setPresenceStatus",F)},O.setUserStatus=function(H,a){var o;a.id=H,o=JSON.stringify(a),this.socket.emit("setUserStatus",o)},O.setUserInfos=function(H){var o;o=JSON.stringify(H),this.socket.emit("setUserInfos",o)},O.addEventListener=function(H,a){"undefined"!=typeof apiRTC_React?eventManager.addEventListener(H,a):"getUserFromIdAnswer"!==H||"error"!==H||"getAllUsersAnswer"!==H||"searchUserAnswer"!==H?document.addEventListener(H,a,!1):U.createErrorEvent("ERROR: Trying to add a listener on an unknow event")},O.callback=function(H,a){return this.closureHandler=function(o){return H[a](o)},this.closureHandler},D.apiDB=O}(window);var oi=R.Y.get("Init"),ln=R.Y.get("MediaDeviceManager");function Er(D){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(D)}V=e.hmd(V),null!=console&&console.info&&console.info("Loading APIRTC_MODULE"),window.Prototype&&delete Array.prototype.toJSON;var zr=new pe.Z;f.version="4.7.1",f.utils={},f.eventCenter=new b,f.resourcesLoader=new Po;for(var Ar=0,Xr=Object.keys(i.g);Ar<Xr.length;Ar++){var Kr=Xr[Ar];f[Kr]=i.g[Kr]}f.utils.EventEmitter=w,f.utils.EventCenter=b,f.MediaDevice=le,f.Stream=Tn,f.Call=Zi,f.Conversation=qt,f.ConversationCall=Va,f.Conference=nr,f.Contact=ci,f.Enterprise=dr,f.SentInvitation=ft,f.ReceivedInvitation=v,f.ReceivedCallInvitation=Di,f.ReceivedConversationJoinRequest=Yn,f.ReceivedConversationInvitation=L,f.ReceivedFileTransferInvitation=Rn,f.ReceivedWhiteboardInvitation=Bt,f.ReceivedDataChannelInvitation=mn,f.ReceivedPointerSharingInvitation=Q,f.PointerSharingRoom=gr,f.Session=Ui,f.UserAgent=Jr,f.UserData=Ke,f.CloudApi=zr,f.DataChannel=Kn,f.Observable=ke,f.setLogLevel=function(D){R.Y.setLogLevel(D)};var Qr=!1;if(void 0===window.apiRTC){if("object"===Er(V)&&V.exports)V.exports=f;else if("function"==typeof define&&e.amdO){var Uo=f;define(function(){return window.apiRTC2=window.apiRTC=Uo})}window.apiRTC2=window.apiRTC=window.apiCC=window.CC=f,Qr=!0}else console.info("APIRTC_MODULE already loaded with version :",apiRTC.version);!0===Qr&&(f.init=function(D){var _,Y;if(oi.info("apiRTC initialization, version is :"+apiCC.version),oi.info("osName :"+apiCC.osName),oi.info("osVersion :"+apiCC.osVersion),oi.info("browser :"+apiCC.browser),oi.info("browser_version :"+apiCC.browser_version),Y=!0,oi.info("apiKey :",_=D.apiKey),-1!==_.indexOf("[")&&(Y=!1),!0===Y)if(D.hasOwnProperty("apiCCId")&&null!==D.apiCCId&&""!==D.apiCCId&&!0!==function(de){if(null!==de){var fe=de;if("number"==typeof fe&&(fe=String(fe)),"string"==typeof fe)return fe.length<=128}return!1}(D.apiCCId))oi.error("apiCCId format is not correct, leaving connection process");else{var O="";O=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol&&"https:"!=window.location.protocol?"http":"https","iOS"!==y.ag.name&&"Android"!==y.ag.name||(oi.log(y.ag.name+" detected forcing protocol to https"),O="https"),void 0===D.ccsServer?(oi.debug("Setting ccsServer"),D.ccsServer=void 0!==window&&void 0!==window.location&&void 0!==window.location.protocol?"https:"==window.location.protocol||"iOS"===y.ag.name||"Android"===y.ag.name?"ccs5.apizee.com:443":"ccs5.apizee.com:80":"ccs5.apizee.com:443"):oi.log("ccsServer is defined on init()"),null!=D.bandwidthTestServer?(oi.log("bandwidthTestServer is defined :",D.bandwidthTestServer),apiCC.bandwidthTestServer=D.bandwidthTestServer):oi.log("bandwidthTestServer is not defined"),void 0!==D.userData&&oi.log("userData :",D.userData),apiCC.extJsLoadingRetryNb=D.extJsLoadingRetryNb,apiCC.extJsLoadingRetryDelay=D.extJsLoadingRetryDelay,!1===apiCC.jsLoaded?(apiCC.initApiKey=D.apiKey,apiCC.initApiCCId=D.apiCCId,apiRTC_sioLoader.load(O,D,{success:function(){oi.log("sio loaded"),apiCC.jsLoaded=!0,apiCC.session=new apiCC.ApiCCSession(D),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","loaded")},error:function(){oi.error("sio loading error"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","error")},retrycb:function(){oi.warn("sio retry"),apiCC.myWebRTC_Event.createExternalJsLoadingStatusEvent("sio","retry")}})):(oi.log("apiRTC JS Librairies already loaded"),oi.log("initParameters have changed, need to reload session connection"),apiCC.addEventListener("sessionReady",D.onReady),oi.log("initParameters.userData :",D.userData),void 0!==D.apiCCId&&""!==D.apiCCId&&null!==D.apiCCId||(oi.log("keeping apiCCId defined by apiRTC :"+D.apiCCId),D.apiCCId=apiCC.session.apiCCId),oi.log("initParameters.apiCCId :"+D.apiCCId),null!=D.userData?(oi.log("userData is defined :",D.userData),apiCC.session.userData=D.userData):oi.log("userData is not defined"),oi.log("apiCC.session.userData :",apiCC.session.userData),null!=D.token?(oi.log("token is defined :"+D.token),apiCC.session.token=D.token):(oi.log("token is not defined"),apiCC.session.token=null),null!=D.conversationSpace?(oi.log("conversationSpace is defined :"+D.conversationSpace),apiCC.session.conversationSpace=D.conversationSpace):(oi.log("conversationSpace is not defined"),apiCC.session.conversationSpace=null),apiCC.session.reOpenChannel(D.apiCCId,D.apiKey),null!=D.nickname?(oi.log("Nickname is defined :"+D.nickname),apiCC.session.nickname=D.nickname):(oi.log("Nickname is not defined, setting to apiCCId value :"+apiCC.session.apiCCId),apiCC.session.nickname=apiCC.session.apiCCId),null!=D.photoURL?(oi.log("photoURL is defined :"+D.photoURL),apiCC.session.photoURL=D.photoURL):(oi.log("photoURL is not defined"),apiCC.session.photoURL=null),null!=D.presenceGroup?(oi.log("presenceGroup is defined :"+D.presenceGroup),JSON.stringify(apiCC.session.presenceGroup)!==JSON.stringify(D.presenceGroup)&&(oi.log("presenceGroup updated on initParameters"),apiCC.session.channel.updatePresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldPresenceGroup&&(apiCC.session.channel.oldPresenceGroup=apiCC.session.presenceGroup),apiCC.session.channel.newPresenceGroup=D.presenceGroup,apiCC.session.presenceGroup=D.presenceGroup)):(oi.log('presenceGroup is not defined, setting to ["default"]'),JSON.stringify(apiCC.session.presenceGroup)!==JSON.stringify(["default"])&&(oi.log("presenceGroup updated on initParameters"),apiCC.session.channel.updatePresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldPresenceGroup&&(apiCC.session.channel.oldPresenceGroup=apiCC.session.presenceGroup),apiCC.session.channel.newPresenceGroup=["default"],apiCC.session.presenceGroup=["default"])),null!=D.subscribeToPresenceGroup?(oi.log("subscribeToPresenceGroup is defined :"+D.subscribeToPresenceGroup),JSON.stringify(apiCC.session.subscribeToPresenceGroup)!==JSON.stringify(D.subscribeToPresenceGroup)&&(oi.log("subscribeToPresenceGroup updated on initParameters"),apiCC.session.channel.updateSubscribeToPresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldSubscribeToPresenceGroup&&(apiCC.session.channel.oldSubscribeToPresenceGroup=apiCC.session.subscribeToPresenceGroup),apiCC.session.channel.newSubscribeToPresenceGroup=D.subscribeToPresenceGroup,apiCC.session.subscribeToPresenceGroup=D.subscribeToPresenceGroup)):(oi.log('subscribeToPresenceGroup is not defined, setting to ["default"]'),JSON.stringify(apiCC.session.subscribeToPresenceGroup)!==JSON.stringify(["default"])&&(oi.log("subscribeToPresenceGroup updated on initParameters"),apiCC.session.channel.updateSubscribeToPresenceGroupIsNeeded=!0,null===apiCC.session.channel.oldSubscribeToPresenceGroup&&(apiCC.session.channel.oldSubscribeToPresenceGroup=apiCC.session.subscribeToPresenceGroup),apiCC.session.channel.newSubscribeToPresenceGroup=["default"],apiCC.session.subscribeToPresenceGroup=["default"])),apiCC.initApiKey=D.apiKey,apiCC.initApiCCId=D.apiCCId)}else oi.error("Apikey format is not correct, leaving connection process")},e(2719),f.mediaDeviceMgr=new function(){this.audioDevicePresent=!0,this.videoDevicePresent=!0,this.audioOutputPresent=!0,this.mediaSourceInfos=null,this.mediaDeviceChangedDetected=!1,this.mediaDeviceSourceInfosArray={audioinput:{},audiooutput:{},videoinput:{}},this.mediaDeviceSourceInfosArrayBeforeGotSources=null,this.defaultVideoInput=null,this.defaultAudioInput=null,this.defaultAudioOuput=null,this.realMediaDevicesListInitialization=!1,this.realMediaDevicesListInitializationWasAlreadyDone=!1,ln.debug("MediaDeviceManager"),null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=function(D){ln.debug("Media device have changed"),apiCC.mediaDeviceMgr.getMediaDevices("updatedOnDeviceChange")}),this.gotSources=function(D,_){ln.debug("gotSources : sourceInfos :",D),apiCC.mediaDeviceMgr.audioDevicePresent=!1,apiCC.mediaDeviceMgr.videoDevicePresent=!1,apiCC.mediaDeviceMgr.audioOutputPresent=!1;var Y=!1;apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources=apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray;var O={},U=!1;(0,m.fS)(apiCC.mediaDeviceMgr.mediaSourceInfos,D)||(ln.debug("MediaDevices change detected"),Y=!0);var de,fe=null,H=0,a=0,o=0,k=null;if(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray={audioinput:{},audiooutput:{},videoinput:{}},apiCC.mediaDeviceMgr.mediaSourceInfos=D,null!==D)for(de=0;de!==D.length;++de)null!==(fe=D[de]).deviceId&&""!==fe.deviceId?(k=new le(fe.deviceId,fe.kind),null!=fe.label&&(this.realMediaDevicesListInitialization=!0)):(ln.debug("MediaDevices change but deviceId is not correct, using fakedeviceId :",de),k=new le(de,fe.kind)),"audio"===fe.kind||"audioinput"===fe.kind?(apiCC.mediaDeviceMgr.audioDevicePresent||(apiCC.mediaDeviceMgr.audioDevicePresent=!0),k.label=fe.label||"microphone "+ ++H,null===apiCC.mediaDeviceMgr.defaultAudioInput&&(apiCC.mediaDeviceMgr.defaultAudioInput=k),null!=fe.getCapabilities?k.capabilities=fe.getCapabilities():ln.debug("getCapabilities not defined")):"video"===fe.kind||"videoinput"===fe.kind?(apiCC.mediaDeviceMgr.videoDevicePresent||(apiCC.mediaDeviceMgr.videoDevicePresent=!0),k.label=fe.label||"camera "+ ++a,null===apiCC.mediaDeviceMgr.defaultVideoInput&&(apiCC.mediaDeviceMgr.defaultVideoInput=k),null!=fe.getCapabilities?k.capabilities=fe.getCapabilities():ln.debug("getCapabilities not defined")):"audiooutput"===fe.kind?(apiCC.mediaDeviceMgr.audioOutputPresent||(apiCC.mediaDeviceMgr.audioOutputPresent=!0),k.label=fe.label||"audio output "+ ++o,null===apiCC.mediaDeviceMgr.defaultAudioOuput&&(apiCC.mediaDeviceMgr.defaultAudioOuput=k)):(k.label=fe.label||"other source "+fe.deviceId,ln.trace("Detected some other kind of source : "+fe.kind)),ln.trace("Local device : "+k.label+" - "+k.id),void 0===apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[k.type]&&(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[k.type]={}),apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray[k.type][k.id]=k;else ln.warn("Media detection is not supported by browser, considering micro and camera present"),apiCC.mediaDeviceMgr.audioDevicePresent=!0,apiCC.mediaDeviceMgr.videoDevicePresent=!0,apiCC.mediaDeviceMgr.audioOutputPresent=!0;if(ln.log("Audio device detected :"+apiCC.mediaDeviceMgr.audioDevicePresent),ln.log("Video device detected :"+apiCC.mediaDeviceMgr.videoDevicePresent),ln.log("audio Output device detected :"+apiCC.mediaDeviceMgr.audioOutputPresent),ln.debug("mediaDeviceSourceInfosArray :",apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray),!1===apiCC.mediaDeviceMgr.audioDevicePresent?!1===apiCC.mediaDeviceMgr.videoDevicePresent?apiCC.myWebRTC_Event.createErrorEvent("Video device is not present","NO_AUDIO_NO_VIDEO_DEVICE"):apiCC.myWebRTC_Event.createErrorEvent("Audio device is not present","NO_AUDIO_DEVICE"):!1===apiCC.mediaDeviceMgr.videoDevicePresent&&apiCC.myWebRTC_Event.createErrorEvent("Video device is not present","NO_VIDEO_DEVICE"),(0,m.fS)(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources)||(ln.debug("mediaDeviceSourceInfosArray change detected"),Y=!0),!0===Y){ln.debug("fireMediaChangedEvent :",Y);var F=this.getMediaDeviceListsDiff(apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArray,apiCC.mediaDeviceMgr.mediaDeviceSourceInfosArrayBeforeGotSources);!0===this.realMediaDevicesListInitialization&&!1===this.realMediaDevicesListInitializationWasAlreadyDone&&(ln.debug("This is the first real initialization of media device list"),U=!0),!0===this.realMediaDevicesListInitialization&&(this.realMediaDevicesListInitializationWasAlreadyDone=!0),this.mediaDeviceChangedDetected=!0,null!==apiCC.myWebRTC_Event&&apiCC.myWebRTC_Event.createMediaDeviceChangedEvent(F,_,U),ln.debug("fireMediaChangedEvent :",apiCC.mediaDeviceMgr.mediaSourceInfos)}apiCC.session&&apiCC.session.apiCCWebRTCClient&&(apiCC.session.apiCCWebRTCClient.webRTCClient.setGumConfigWithDevicePresent(),O.audioDevicePresent=apiCC.mediaDeviceMgr.audioDevicePresent,O.videoDevicePresent=apiCC.mediaDeviceMgr.videoDevicePresent,apiCC.session.setUserData(O))},this.getMediaDevices=function(D){ln.debug("MediaDeviceManager::getMediaDevices : updateReason :",D),"IE"===apiCC.browser&&apiCC.browser_version>8?apiCC.getMediaDevicesWithCB(apiCC.mediaDeviceMgr.gotSources):apiCC.getMediaDevices().then(function(_){apiCC.mediaDeviceMgr.gotSources(_,D)}).catch(function(){ln.log("Error on MediaDeviceManager::getMediaDevices"),apiCC.mediaDeviceMgr.gotSources(null,D)})},this.getMediaDeviceListsDiff=function(D,_){void 0!==_&&_||(_={}),void 0!==D&&D||(D={});for(var Y=[],O=[],U=[],de=0,fe=Object.keys(_);de<fe.length;de++){var H=fe[de];if(void 0===D[H])O[H]=_[H];else for(var a=0,o=Object.keys(_[H]);a<o.length;a++){var k=o[a];void 0===D[H][k]&&(void 0===O[H]&&(O[H]={}),O[H][k]=_[H][k])}}for(var F=0,z=Object.keys(D);F<z.length;F++)for(var $=z[F],X=0,se=Object.keys(D[$]);X<se.length;X++){var Me=se[X];void 0!==_[$]&&void 0!==_[$][Me]||(void 0===Y[$]&&(Y[$]={}),Y[$][Me]=D[$][Me]),void 0!==_[$]&&void 0!==_[$][Me]&&D[$][Me].label!==_[$][Me].label&&(void 0===U[$]&&(U[$]={}),U[$][Me]=D[$][Me])}return{added:Object.keys(Y).length>0?Y:null,removed:Object.keys(O).length>0?O:null,updated:Object.keys(U).length>0?U:null}}},f.mediaDeviceMgr.getMediaDevices(),f.webRTCCompliant=f.isWebRTCCompliant(),f.qoSStatCompliant=f.isQoSStatCompliant(),f.screenSharingCompliant=f.isScreenSharingCompliant());const Lo=apiRTC},1549:(V,J,e)=>{"use strict";e.d(J,{Y:()=>S}),e(6992),e(1532),e(1539),e(8783),e(3948),e(2772),e(4916),e(5306),e(2222),e(5268),e(3710),e(3161),e(9653),e(9070),e(9753),e(2526),e(1817),e(2165),e(1038),e(7042),e(8309);var i=e(3173);function d(n){return function(y){if(Array.isArray(y))return h(y)}(n)||function(y){if("undefined"!=typeof Symbol&&null!=y[Symbol.iterator]||null!=y["@@iterator"])return Array.from(y)}(n)||function(y,R){if(y){if("string"==typeof y)return h(y,R);var m=Object.prototype.toString.call(y).slice(8,-1);return"Object"===m&&y.constructor&&(m=y.constructor.name),"Map"===m||"Set"===m?Array.from(y):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?h(y,R):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(n,y){(null==y||y>n.length)&&(y=n.length);for(var R=0,m=new Array(y);R<y;R++)m[R]=n[R];return m}function P(n,y){for(var R=0;R<y.length;R++){var m=y[R];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(n,m.key,m)}}var w=new Map,M=i.g.LOG_LEVEL_WARN,C=function(n){var y,R=null,m=null;for(y=0;y<n.length;y++)"string"==typeof n[y]&&(-1!==n[y].indexOf('"type":"invite"')?n[y]=-1===n[y].indexOf("candidate")?-1===n[y].indexOf("S->C:")?"invite C->S: without candidate":"invite S->C: without candidate":-1===n[y].indexOf("S->C:")?"invite C->S: with candidate":"invite S->C: with candidate":-1!==n[y].indexOf('"type":"200OK"')?n[y]=-1===n[y].indexOf("candidate")?-1===n[y].indexOf("S->C:")?"200OK C->S: without candidate":"200OK S->C: without candidate":-1===n[y].indexOf("S->C:")?"200OK C->S: with candidate":"200OK S->C: with candidate":-1!==n[y].indexOf('"type":"candidate"')&&(-1===n[y].indexOf("S->C:")?(R=n[y].replace(/C->S: /g,""),m=JSON.parse(R),n[y]="candidate C->S:"+m.candidate):(R=n[y].replace(/onChannelMessage S->C: /g,""),m=JSON.parse(R),n[y]="candidate S->C:"+m.candidate)));return n},S=function(){function n(u){if(function(f,I){if(!(f instanceof I))throw new TypeError("Cannot call a class as a function")}(this,n),w.has(u))throw new Error("Cannot construct singleton Logger");this.category=u,w.set(u,this)}var y,R,m;return y=n,R=[{key:"trace",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_TRACE].concat(f))}},{key:"log",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_DEBUG].concat(f))}},{key:"debug",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_DEBUG].concat(f))}},{key:"info",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_INFO].concat(f))}},{key:"warn",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_WARN].concat(f))}},{key:"error",value:function(){for(var u=arguments.length,f=new Array(u),I=0;I<u;I++)f[I]=arguments[I];this.logMessage.apply(this,[i.g.LOG_LEVEL_ERROR].concat(f))}},{key:"logMessage",value:function(u){for(var f=arguments.length,I=new Array(f>1?f-1:0),c=1;c<f;c++)I[c-1]=arguments[c];if(null!=console){if(u<=M){var j="[".concat((new Date).toISOString(),"]");switch(u in i.g.LOG_LEVEL_LABELS&&(j+="[".concat(i.g.LOG_LEVEL_LABELS[u],"]")),j+=i.g.LOG_PREFIX+"(".concat(this.category,")"),u){case i.g.LOG_LEVEL_ERROR:var q;console.error&&(q=console).error.apply(q,[j].concat(d(I)));break;case i.g.LOG_LEVEL_WARN:var b;console.warn&&(b=console).warn.apply(b,[j].concat(d(I)));break;case i.g.LOG_LEVEL_INFO:var T;console.info&&(T=console).info.apply(T,[j].concat(d(I)));break;default:var Z;console.log&&(Z=console).log.apply(Z,[j].concat(d(I)))}}"undefined"!=typeof apiCC&&apiCC.logStorageActivated&&u<=apiCC.logStorageLevel&&(I=C(I),apiCC.logStorage.push(JSON.stringify({name:"log",args:{0:"(".concat(this.category,")")+":"+I}})))}}}],m=[{key:"get",value:function(u){return w.has(u)?w.get(u):new n(u)}},{key:"setLogLevel",value:function(u){if(!Number.isInteger(u)||u<0)throw"Log level invalid";M=u}},{key:"getLogLevel",value:function(){return M}}],R&&P(y.prototype,R),m&&P(y,m),n}()},3173:(V,J,e)=>{"use strict";e.d(J,{g:()=>i}),e(2526),e(1817),e(1539);var i={LOG_PREFIX:"apiRTC",LOG_LEVEL_OFF:0,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL_TRACE:5,LOG_LEVEL_LABELS:{}};i.LOG_LEVEL_LABELS[i.LOG_LEVEL_ERROR]="ERROR",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_WARN]="WARN",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_INFO]="INFO",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_DEBUG]="DEBUG",i.LOG_LEVEL_LABELS[i.LOG_LEVEL_TRACE]="TRACE",i.ERROR_OTHER=0,i.ERROR_INVALID_CREDENTIALS=1,i.ERROR_NETWORK_UNAVAILABLE=2,i.ERROR_SERVER_UNAVAILABLE=3,i.ERROR_UNAUTHORIZED=4,i.ERROR_APIRTC_INITIALISATION_FAILED=5,i.ERROR_APIRTC_SESSION_ALREADY_ON=6,i.ERROR_REGISTRATION_URI_INVALID=7,i.ERROR_NOT_FOUND=8,i.ERROR_BAD_PARAMETER=9,i.ERROR_INVITATION_STATE_INVALID=10,i.ERROR_TIMED_OUT=11,i.ERROR_STREAM_RECORD=12,i.ERROR_HTTP=13,i.ERROR_NOT_ALLOWED=14,i.ERROR_OPERATION_CANCELED=15,i.ERROR_WRONG_STATE=16,i.MEDIA_TYPE_PHOTO=0,i.MEDIA_TYPE_VIDEO=1,i.MEDIA_TYPE_AUDIO=2,i.MEDIA_TYPE_DOC=3,i.CONTACT_SEND_DATA_IDENTIFIER="contact_data",i.CONTACT_NEW_MEDIA_IDENTIFIER="contact_new_media",i.CONTACT_SEND_FILEINFO_IDENTIFIER="contact_file_info",i.CONTACT_DATACHANNEL_INVITATION="contact_datachannel_invitation",i.CONTACT_EVENTCENTER_DATA_REQUEST="contact_event_center_data_request",i.CONTACT_EVENTCENTER_DATA_ANSWER="contact_event_center_data_answer",i.CONTACT_GET_CAPABILITIES_IDENTIFIER="contact_get_capabilities",i.CONTACT_GET_CAPABILITIES_RESULT_IDENTIFIER="contact_get_capabilities_result",i.CONTACT_GET_SETTINGS_IDENTIFIER="contact_get_settings",i.CONTACT_GET_SETTINGS_RESULT_IDENTIFIER="contact_get_settings_result",i.CONTACT_GET_CONSTRAINTS_IDENTIFIER="contact_get_constraints",i.CONTACT_GET_CONSTRAINTS_RESULT_IDENTIFIER="contact_get_constraints_result",i.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_IDENTIFIER="contact_get_remote_audio_flow_status",i.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_IDENTIFIER="contact_get_remote_video_flow_status",i.CONTACT_GET_REMOTE_AUDIO_FLOW_STATUS_RESULT_IDENTIFIER="contact_get_remote_audio_flow_status_result",i.CONTACT_GET_REMOTE_VIDEO_FLOW_STATUS_RESULT_IDENTIFIER="contact_get_remote_video_flow_status_result",i.CONTACT_GET_REMOTE_ERROR="contact_get_remote_error",i.CONTACT_APPLY_CONSTRAINTS_IDENTIFIER="contact_apply_constraints_identifier",i.CONTACT_APPLY_CONSTRAINTS_RESULT_IDENTIFIER="contact_apply_constraints_result_identifier",i.CONVERSATION_ACCESS_GRANTED="GRANTED",i.CONVERSATION_NEED_MODERATOR_ACCEPTATION="NEED_MODERATOR_ACCEPTATION",i.CONVERSATION_ROLE_MODERATOR="moderator",i.CONVERSATION_ROLE_CONTRIBUTOR="contributor",i.CONVERSATION_ROLE_GUEST="guest",i.CONVERSATION_WAITING_ROOM_PREFIX="waiting-room-",i.CONVERSATION_SEND_DATA_IDENTIFIER="conv_data",i.CONVERSATION_PERSISTENT_DATA_UPDATE_IDENTIFIER="conv_persistent_data_update",i.CONVERSATION_JOIN_REQUEST_IDENTIFIER="conv_join_req",i.CONVERSATION_JOIN_ANSWER_IDENTIFIER="conv_join_ans",i.CONVERSATION_MODERATOR_CONNECTED_IDENTIFIER="conv_moderator_connected",i.CONVERSATION_NEW_MEDIA_IDENTIFIER="conv_new_media",i.CONVERSATION_CLOSED_IDENTIFIER="conv_closed",i.CONVERSATION_INVITATION_IDENTIFIER="conv_invite",i.INVITATION_ANSWER_IDENTIFIER="invite_ans",i.RECORD_BASE_URL="https://data2.apizee.com:10000/videoManager",i.RECORD_PLAY_URL=i.RECORD_BASE_URL+"?action=play&recordedFileName=",i.DEFAULT_MCU="mcu4.apizee.com",i.DEFAULT_TURNADDRESS="mp1.apizee.com",i.CALL_STATUS_WAITING_FOR_CALLEE=Symbol("CALL_STATUS_WAITING_FOR_CALLEE"),i.CALL_STATUS_ONGOING=Symbol("CALL_STATUS_ONGOING"),i.CALL_STATUS_ENDED=Symbol("CALL_STATUS_ENDED"),i.DATACHANNEL_STATUS_WAITING=Symbol("DATACHANNEL_STATUS_WAITING"),i.DATACHANNEL_STATUS_ONGOING=Symbol("DATACHANNEL_STATUS_ONGOING"),i.DATACHANNEL_STATUS_ENDED=Symbol("DATACHANNEL_STATUS_ENDED"),i.DATACHANNEL_TYPE_RECEIVE=Symbol("DATACHANNEL_TYPE_RECEIVE"),i.DATACHANNEL_TYPE_SEND=Symbol("DATACHANNEL_TYPE_SEND"),i.CONVERSATION_STATUS_JOINED=Symbol("CONVERSATION_STATUS_JOINED"),i.CONVERSATION_STATUS_NOT_JOINED=Symbol("CONVERSATION_STATUS_NOT_JOINED"),i.CONVERSATION_STATUS_WAITING=Symbol("CONVERSATION_STATUS_WAITING"),i.CONVERSATION_STATUS_JOINING=Symbol("CONVERSATION_STATUS_JOINING"),i.CONVERSATION_WHITEBOARD_STARTED=Symbol("CONVERSATION_WHITEBOARD_STARTED"),i.CONVERSATION_WHITEBOARD_NOT_STARTED=Symbol("CONVERSATION_WHITEBOARD_NOT_STARTED"),i.STATE_IDLE=Symbol("STATE_IDLE"),i.STATE_JOINING=Symbol("STATE_JOINING"),i.STATE_ACTIVE=Symbol("STATE_ACTIVE"),i.STATE_LEAVING=Symbol("STATE_LEAVING"),i.INVITATION_STATUS_ACCEPTED=Symbol("INVITATION_STATUS_ACCEPTED"),i.INVITATION_STATUS_DECLINED=Symbol("INVITATION_STATUS_DECLINED"),i.INVITATION_STATUS_STANDBY=Symbol("INVITATION_STATUS_STANDBY"),i.INVITATION_STATUS_EXPIRED=Symbol("INVITATION_STATUS_EXPIRED"),i.INVITATION_STATUS_CANCELLED=Symbol("INVITATION_STATUS_CANCELLED"),i.INVITATION_STATUS_ENDED=Symbol("INVITATION_STATUS_ENDED"),i.STREAM_TYPE_NO_INPUT="no_input",i.STREAM_TYPE_AUDIO="audio",i.STREAM_TYPE_VIDEO="video",i.STREAM_AUDIO_ANALYSIS_THRESHOLD=100,i.CONTACT_DISCONNECTION_DELAY=1e4,i.CONVERSATION_JOIN_REQUEST_INTERVAL=5e3,i.APIRTC_MEDIA_DEVICE_DETECTION_DELAY=1e4,i.CONVERSATION_GROUP_CHAT_MEMBER_UPDATE_DELAY=5e3,i.CONVERSATION_WHITEBOARD_START_DELAY=5e3,i.CONVERSATION_RECORDING_STARTED_DELAY=1e4,i.CONVERSATION_RECORDING_STOPPED_DELAY=5e3,i.CONVERSATION_STREAMING_STARTED_DELAY=1e4,i.CONVERSATION_STREAMING_STOPPED_DELAY=1e4,i.CONVERSATION_PARTICIPANT_EJECTION_DELAY=5e3,i.JOIN_WAITING_ROOM_PRESENCE_GROUP_TIMEOUT=3e3},1215:(V,J,e)=>{"use strict";function i(w){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(w)}function d(w,M){return 3===arguments.length?h(arguments[0],arguments[1],arguments[2]):"null"===M?null===w:"array"===M?null!==w&&"object"===i(w)&&Array.isArray(w):null!==w&&i(w)===M}function h(w,M,C){if(null!==M&&"object"===i(M)&&Array.isArray(M)&&M.length>=1){var S=M[0];if(M.length>1)return d(w,"object")&&d(S,"string")&&w.hasOwnProperty(S)&&d(w[S],"object")&&h(w[S],M.slice(1),C);M=S}return"undefined"===C?d(w,"object")&&d(M,"string")&&!w.hasOwnProperty(M)&&d(w[M],C):d(w,"object")&&d(M,"string")&&w.hasOwnProperty(M)&&d(w[M],C)}e.d(J,{g:()=>P}),e(4916),e(5306),e(3710),e(1539),e(9714),e(7941),e(9575),e(6716),e(9554),e(6992),e(1532),e(8783),e(3948),e(9753),e(7042),e(3843),e(2564),e(2526),e(1817),e(2165);var P={assignObject:function(w,M){var C,S,n;for(null==w&&(w={}),C=1;C<arguments.length;C+=1)for(S in n=arguments[C])n.hasOwnProperty(S)&&(w[S]=n[S]);return w},throttle:function(w,M){var C,S,n,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=null,m=0,u=function(){m=!1===y.leading?0:Date.now(),R=null,n=w.apply(C,S),R||(C=S=null)};return function(){var f=Date.now();m||!1!==y.leading||(m=f);var I=M-(f-m);return C=this,S=arguments,I<=0||I>M?(R&&(clearTimeout(R),R=null),m=f,n=w.apply(C,S),R||(C=S=null)):R||!1===y.trailing||(R=setTimeout(u,I)),n}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(w){var M=16*Math.random()|0;return("x"===w?M:3&M|8).toString(16)})},hashString:function(w){for(var M=0,C=0,S=w.length;C<S;)M=(M<<5)-M+w.charCodeAt(C++)<<0;return Math.abs(M)},arrayBuffertoString:function(w){var M=new DataView(w);return new TextDecoder("utf-8").decode(M)},getAudioContext:function(){return apiRTC.getAudioContext()},parseRecordingEvent:function(w,M){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return["roomName","callId","recordType","convId","mediaId","mediaURL","recordedFileName"].forEach(function(S){M.hasOwnProperty(S)&&(C[S]=String(M[S]))}),"AUDIO-ONLY"===M.mediaType?(C.audioOnly=!0,C.videoOnly=!1):"VIDEO-ONLY"===M.mediaType?(C.audioOnly=!1,C.videoOnly=!0):(C.audioOnly=!1,C.videoOnly=!1),"composite"===C.recordType&&(C.mode=M.hasOwnProperty("mode")?M.mode:"complete",M.hasOwnProperty("labelEnabled")?(C.labelEnabled=!0===M.labelEnabled,!0===C.labelEnabled&&M.hasOwnProperty("labels")&&(C.labels=M.labels)):C.labelEnabled=!1),C},paramsToQueryString:function(w){for(var M="",C=0,S=Object.keys(w);C<S.length;C++){var n=S[C];M+=""===M?"?":"&",null==w[n]?console.warn("apiRTC Utils - paramsToQueryString : "+n+" is undefined!"):M+=n+"="+w[n].toString()}return M},createError:function(w,M,C){var S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};C&&C.error(M);var n={code:w};return n.error=M instanceof String?new Error(M):M instanceof Error?M:new Error(String(M)),d(S,"object")&&(S.hasOwnProperty("fromError")&&(n.fromError=S.fromError),S.hasOwnProperty("httpCode")&&(n.httpCode=S.httpCode)),n},isSet:function(w){return null!=w},isTypeof:d,isPropertyTypeof:h,_private:{dataCallsOnHold:new Map,dataChannelInvitations:new Map,dataCallsFileInfo:new Map}}},9662:(V,J,e)=>{var i=e(7854),d=e(614),h=e(6330),P=i.TypeError;V.exports=function(w){if(d(w))return w;throw P(h(w)+" is not a function")}},9483:(V,J,e)=>{var i=e(7854),d=e(4411),h=e(6330),P=i.TypeError;V.exports=function(w){if(d(w))return w;throw P(h(w)+" is not a constructor")}},6077:(V,J,e)=>{var i=e(7854),d=e(614),h=i.String,P=i.TypeError;V.exports=function(w){if("object"==typeof w||d(w))return w;throw P("Can't set "+h(w)+" as a prototype")}},1223:(V,J,e)=>{var i=e(5112),d=e(30),h=e(3070),P=i("unscopables"),w=Array.prototype;null==w[P]&&h.f(w,P,{configurable:!0,value:d(null)}),V.exports=function(M){w[P][M]=!0}},1530:(V,J,e)=>{"use strict";var i=e(8710).charAt;V.exports=function(d,h,P){return h+(P?i(d,h).length:1)}},5787:(V,J,e)=>{var i=e(7854),d=e(7976),h=i.TypeError;V.exports=function(P,w){if(d(w,P))return P;throw h("Incorrect invocation")}},9670:(V,J,e)=>{var i=e(7854),d=e(111),h=i.String,P=i.TypeError;V.exports=function(w){if(d(w))return w;throw P(h(w)+" is not an object")}},4019:V=>{V.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:(V,J,e)=>{"use strict";var i,d,h,P=e(4019),w=e(9781),M=e(7854),C=e(614),S=e(111),n=e(2597),y=e(648),R=e(6330),m=e(8880),u=e(1320),f=e(3070).f,I=e(7976),c=e(9518),j=e(7674),q=e(5112),b=e(9711),T=M.Int8Array,Z=T&&T.prototype,le=M.Uint8ClampedArray,x=le&&le.prototype,Se=T&&c(T),Ee=Z&&c(Z),he=Object.prototype,ue=M.TypeError,ke=q("toStringTag"),Ne=b("TYPED_ARRAY_TAG"),ze=b("TYPED_ARRAY_CONSTRUCTOR"),Ve=P&&!!j&&"Opera"!==y(M.opera),et=!1,_e={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},gt={BigInt64Array:8,BigUint64Array:8},mt=function(ot){if(!S(ot))return!1;var at=y(ot);return n(_e,at)||n(gt,at)};for(i in _e)(h=(d=M[i])&&d.prototype)?m(h,ze,d):Ve=!1;for(i in gt)(h=(d=M[i])&&d.prototype)&&m(h,ze,d);if((!Ve||!C(Se)||Se===Function.prototype)&&(Se=function(){throw ue("Incorrect invocation")},Ve))for(i in _e)M[i]&&j(M[i],Se);if((!Ve||!Ee||Ee===he)&&(Ee=Se.prototype,Ve))for(i in _e)M[i]&&j(M[i].prototype,Ee);if(Ve&&c(x)!==Ee&&j(x,Ee),w&&!n(Ee,ke))for(i in et=!0,f(Ee,ke,{get:function(){return S(this)?this[Ne]:void 0}}),_e)M[i]&&m(M[i],Ne,i);V.exports={NATIVE_ARRAY_BUFFER_VIEWS:Ve,TYPED_ARRAY_CONSTRUCTOR:ze,TYPED_ARRAY_TAG:et&&Ne,aTypedArray:function(ot){if(mt(ot))return ot;throw ue("Target is not a typed array")},aTypedArrayConstructor:function(ot){if(C(ot)&&(!j||I(Se,ot)))return ot;throw ue(R(ot)+" is not a typed array constructor")},exportTypedArrayMethod:function(ot,at,yt){if(w){if(yt)for(var Et in _e){var ie=M[Et];if(ie&&n(ie.prototype,ot))try{delete ie.prototype[ot]}catch(dt){}}Ee[ot]&&!yt||u(Ee,ot,yt?at:Ve&&Z[ot]||at)}},exportTypedArrayStaticMethod:function(ot,at,yt){var Et,ie;if(w){if(j){if(yt)for(Et in _e)if((ie=M[Et])&&n(ie,ot))try{delete ie[ot]}catch(dt){}if(Se[ot]&&!yt)return;try{return u(Se,ot,yt?at:Ve&&Se[ot]||at)}catch(dt){}}for(Et in _e)!(ie=M[Et])||ie[ot]&&!yt||u(ie,ot,at)}},isView:function(ot){if(!S(ot))return!1;var at=y(ot);return"DataView"===at||n(_e,at)||n(gt,at)},isTypedArray:mt,TypedArray:Se,TypedArrayPrototype:Ee}},3331:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=e(9781),P=e(4019),w=e(6530),M=e(8880),C=e(2248),S=e(7293),n=e(5787),y=e(9303),R=e(7466),m=e(7067),u=e(1179),f=e(9518),I=e(7674),c=e(8006).f,j=e(3070).f,q=e(1285),b=e(206),T=e(8003),Z=e(9909),le=w.PROPER,x=w.CONFIGURABLE,Se=Z.get,Ee=Z.set,he="ArrayBuffer",ue="Wrong index",ke=i.ArrayBuffer,Ne=ke,ze=Ne&&Ne.prototype,Ve=i.DataView,et=Ve&&Ve.prototype,_e=Object.prototype,gt=i.Array,mt=i.RangeError,ot=d(q),at=d([].reverse),yt=u.pack,Et=u.unpack,ie=function(s){return[255&s]},dt=function(s){return[255&s,s>>8&255]},Mt=function(s){return[255&s,s>>8&255,s>>16&255,s>>24&255]},Rt=function(s){return s[3]<<24|s[2]<<16|s[1]<<8|s[0]},je=function(s){return yt(s,23,4)},xt=function(s){return yt(s,52,8)},Wt=function(s,v){j(s.prototype,v,{get:function(){return Se(this)[v]}})},Gt=function(s,v,r,g){var E=m(r),te=Se(s);if(E+v>te.byteLength)throw mt(ue);var ae=Se(te.buffer).bytes,Re=E+te.byteOffset,Ce=b(ae,Re,Re+v);return g?Ce:at(Ce)},kt=function(s,v,r,g,E,te){var ae=m(r),Re=Se(s);if(ae+v>Re.byteLength)throw mt(ue);for(var Ce=Se(Re.buffer).bytes,re=ae+Re.byteOffset,K=g(+E),L=0;L<v;L++)Ce[re+L]=K[te?L:v-L-1]};if(P){var Xe=le&&ke.name!==he;if(S(function(){ke(1)})&&S(function(){new ke(-1)})&&!S(function(){return new ke,new ke(1.5),new ke(NaN),Xe&&!x}))Xe&&x&&M(ke,"name",he);else{(Ne=function(s){return n(this,ze),new ke(m(s))}).prototype=ze;for(var zt,G=c(ke),A=0;G.length>A;)(zt=G[A++])in Ne||M(Ne,zt,ke[zt]);ze.constructor=Ne}I&&f(et)!==_e&&I(et,_e);var t=new Ve(new Ne(2)),l=d(et.setInt8);t.setInt8(0,2147483648),t.setInt8(1,2147483649),!t.getInt8(0)&&t.getInt8(1)||C(et,{setInt8:function(s,v){l(this,s,v<<24>>24)},setUint8:function(s,v){l(this,s,v<<24>>24)}},{unsafe:!0})}else ze=(Ne=function(s){n(this,ze);var v=m(s);Ee(this,{bytes:ot(gt(v),0),byteLength:v}),h||(this.byteLength=v)}).prototype,et=(Ve=function(s,v,r){n(this,et),n(s,ze);var g=Se(s).byteLength,E=y(v);if(E<0||E>g)throw mt("Wrong offset");if(E+(r=void 0===r?g-E:R(r))>g)throw mt("Wrong length");Ee(this,{buffer:s,byteLength:r,byteOffset:E}),h||(this.buffer=s,this.byteLength=r,this.byteOffset=E)}).prototype,h&&(Wt(Ne,"byteLength"),Wt(Ve,"buffer"),Wt(Ve,"byteLength"),Wt(Ve,"byteOffset")),C(et,{getInt8:function(s){return Gt(this,1,s)[0]<<24>>24},getUint8:function(s){return Gt(this,1,s)[0]},getInt16:function(s){var v=Gt(this,2,s,arguments.length>1?arguments[1]:void 0);return(v[1]<<8|v[0])<<16>>16},getUint16:function(s){var v=Gt(this,2,s,arguments.length>1?arguments[1]:void 0);return v[1]<<8|v[0]},getInt32:function(s){return Rt(Gt(this,4,s,arguments.length>1?arguments[1]:void 0))},getUint32:function(s){return Rt(Gt(this,4,s,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(s){return Et(Gt(this,4,s,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(s){return Et(Gt(this,8,s,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(s,v){kt(this,1,s,ie,v)},setUint8:function(s,v){kt(this,1,s,ie,v)},setInt16:function(s,v){kt(this,2,s,dt,v,arguments.length>2?arguments[2]:void 0)},setUint16:function(s,v){kt(this,2,s,dt,v,arguments.length>2?arguments[2]:void 0)},setInt32:function(s,v){kt(this,4,s,Mt,v,arguments.length>2?arguments[2]:void 0)},setUint32:function(s,v){kt(this,4,s,Mt,v,arguments.length>2?arguments[2]:void 0)},setFloat32:function(s,v){kt(this,4,s,je,v,arguments.length>2?arguments[2]:void 0)},setFloat64:function(s,v){kt(this,8,s,xt,v,arguments.length>2?arguments[2]:void 0)}});T(Ne,he),T(Ve,"DataView"),V.exports={ArrayBuffer:Ne,DataView:Ve}},1048:(V,J,e)=>{"use strict";var i=e(7908),d=e(1400),h=e(6244),P=Math.min;V.exports=[].copyWithin||function(w,M){var C=i(this),S=h(C),n=d(w,S),y=d(M,S),R=arguments.length>2?arguments[2]:void 0,m=P((void 0===R?S:d(R,S))-y,S-n),u=1;for(y<n&&n<y+m&&(u=-1,y+=m-1,n+=m-1);m-- >0;)y in C?C[n]=C[y]:delete C[n],n+=u,y+=u;return C}},1285:(V,J,e)=>{"use strict";var i=e(7908),d=e(1400),h=e(6244);V.exports=function(P){for(var w=i(this),M=h(w),C=arguments.length,S=d(C>1?arguments[1]:void 0,M),n=C>2?arguments[2]:void 0,y=void 0===n?M:d(n,M);y>S;)w[S++]=P;return w}},8533:(V,J,e)=>{"use strict";var i=e(2092).forEach,d=e(9341)("forEach");V.exports=d?[].forEach:function(h){return i(this,h,arguments.length>1?arguments[1]:void 0)}},7745:V=>{V.exports=function(J,e){for(var i=0,d=e.length,h=new J(d);d>i;)h[i]=e[i++];return h}},8457:(V,J,e)=>{"use strict";var i=e(7854),d=e(9974),h=e(6916),P=e(7908),w=e(3411),M=e(7659),C=e(4411),S=e(6244),n=e(6135),y=e(8554),R=e(1246),m=i.Array;V.exports=function(u){var f=P(u),I=C(this),c=arguments.length,j=c>1?arguments[1]:void 0,q=void 0!==j;q&&(j=d(j,c>2?arguments[2]:void 0));var b,T,Z,le,x,Se,Ee=R(f),he=0;if(!Ee||this==m&&M(Ee))for(b=S(f),T=I?new this(b):m(b);b>he;he++)Se=q?j(f[he],he):f[he],n(T,he,Se);else for(x=(le=y(f,Ee)).next,T=I?new this:[];!(Z=h(x,le)).done;he++)Se=q?w(le,j,[Z.value,he],!0):Z.value,n(T,he,Se);return T.length=he,T}},1318:(V,J,e)=>{var i=e(5656),d=e(1400),h=e(6244),P=function(w){return function(M,C,S){var n,y=i(M),R=h(y),m=d(S,R);if(w&&C!=C){for(;R>m;)if((n=y[m++])!=n)return!0}else for(;R>m;m++)if((w||m in y)&&y[m]===C)return w||m||0;return!w&&-1}};V.exports={includes:P(!0),indexOf:P(!1)}},2092:(V,J,e)=>{var i=e(9974),d=e(1702),h=e(8361),P=e(7908),w=e(6244),M=e(5417),C=d([].push),S=function(n){var y=1==n,R=2==n,m=3==n,u=4==n,f=6==n,I=7==n,c=5==n||f;return function(j,q,b,T){for(var Z,le,x=P(j),Se=h(x),Ee=i(q,b),he=w(Se),ue=0,ke=T||M,Ne=y?ke(j,he):R||I?ke(j,0):void 0;he>ue;ue++)if((c||ue in Se)&&(le=Ee(Z=Se[ue],ue,x),n))if(y)Ne[ue]=le;else if(le)switch(n){case 3:return!0;case 5:return Z;case 6:return ue;case 2:C(Ne,Z)}else switch(n){case 4:return!1;case 7:C(Ne,Z)}return f?-1:m||u?u:Ne}};V.exports={forEach:S(0),map:S(1),filter:S(2),some:S(3),every:S(4),find:S(5),findIndex:S(6),filterReject:S(7)}},6583:(V,J,e)=>{"use strict";var i=e(2104),d=e(5656),h=e(9303),P=e(6244),w=e(9341),M=Math.min,C=[].lastIndexOf,S=!!C&&1/[1].lastIndexOf(1,-0)<0,n=w("lastIndexOf");V.exports=S||!n?function(R){if(S)return i(C,this,arguments)||0;var m=d(this),u=P(m),f=u-1;for(arguments.length>1&&(f=M(f,h(arguments[1]))),f<0&&(f=u+f);f>=0;f--)if(f in m&&m[f]===R)return f||0;return-1}:C},1194:(V,J,e)=>{var i=e(7293),d=e(5112),h=e(7392),P=d("species");V.exports=function(w){return h>=51||!i(function(){var M=[];return(M.constructor={})[P]=function(){return{foo:1}},1!==M[w](Boolean).foo})}},9341:(V,J,e)=>{"use strict";var i=e(7293);V.exports=function(d,h){var P=[][d];return!!P&&i(function(){P.call(null,h||function(){throw 1},1)})}},3671:(V,J,e)=>{var i=e(7854),d=e(9662),h=e(7908),P=e(8361),w=e(6244),M=i.TypeError,C=function(S){return function(n,y,R,m){d(y);var u=h(n),f=P(u),I=w(u),c=S?I-1:0,j=S?-1:1;if(R<2)for(;;){if(c in f){m=f[c],c+=j;break}if(c+=j,S?c<0:I<=c)throw M("Reduce of empty array with no initial value")}for(;S?c>=0:I>c;c+=j)c in f&&(m=y(m,f[c],c,u));return m}};V.exports={left:C(!1),right:C(!0)}},206:(V,J,e)=>{var i=e(1702);V.exports=i([].slice)},4362:(V,J,e)=>{var i=e(206),d=Math.floor,h=function(M,C){var S=M.length,n=d(S/2);return S<8?P(M,C):w(M,h(i(M,0,n),C),h(i(M,n),C),C)},P=function(M,C){for(var S,n,y=M.length,R=1;R<y;){for(n=R,S=M[R];n&&C(M[n-1],S)>0;)M[n]=M[--n];n!==R++&&(M[n]=S)}return M},w=function(M,C,S,n){for(var y=C.length,R=S.length,m=0,u=0;m<y||u<R;)M[m+u]=m<y&&u<R?n(C[m],S[u])<=0?C[m++]:S[u++]:m<y?C[m++]:S[u++];return M};V.exports=h},7475:(V,J,e)=>{var i=e(7854),d=e(3157),h=e(4411),P=e(111),w=e(5112)("species"),M=i.Array;V.exports=function(C){var S;return d(C)&&(h(S=C.constructor)&&(S===M||d(S.prototype))||P(S)&&null===(S=S[w]))&&(S=void 0),void 0===S?M:S}},5417:(V,J,e)=>{var i=e(7475);V.exports=function(d,h){return new(i(d))(0===h?0:h)}},3411:(V,J,e)=>{var i=e(9670),d=e(9212);V.exports=function(h,P,w,M){try{return M?P(i(w)[0],w[1]):P(w)}catch(C){d(h,"throw",C)}}},7072:(V,J,e)=>{var i=e(5112)("iterator"),d=!1;try{var h=0,P={next:function(){return{done:!!h++}},return:function(){d=!0}};P[i]=function(){return this},Array.from(P,function(){throw 2})}catch(w){}V.exports=function(w,M){if(!M&&!d)return!1;var C=!1;try{var S={};S[i]=function(){return{next:function(){return{done:C=!0}}}},w(S)}catch(n){}return C}},4326:(V,J,e)=>{var i=e(1702),d=i({}.toString),h=i("".slice);V.exports=function(P){return h(d(P),8,-1)}},648:(V,J,e)=>{var i=e(7854),d=e(1694),h=e(614),P=e(4326),w=e(5112)("toStringTag"),M=i.Object,C="Arguments"==P(function(){return arguments}());V.exports=d?P:function(S){var n,y,R;return void 0===S?"Undefined":null===S?"Null":"string"==typeof(y=function(m,u){try{return m[u]}catch(f){}}(n=M(S),w))?y:C?P(n):"Object"==(R=P(n))&&h(n.callee)?"Arguments":R}},5631:(V,J,e)=>{"use strict";var i=e(3070).f,d=e(30),h=e(2248),P=e(9974),w=e(5787),M=e(408),C=e(654),S=e(6340),n=e(9781),y=e(2423).fastKey,R=e(9909),m=R.set,u=R.getterFor;V.exports={getConstructor:function(f,I,c,j){var q=f(function(x,Se){w(x,b),m(x,{type:I,index:d(null),first:void 0,last:void 0,size:0}),n||(x.size=0),null!=Se&&M(Se,x[j],{that:x,AS_ENTRIES:c})}),b=q.prototype,T=u(I),Z=function(x,Se,Ee){var he,ue,ke=T(x),Ne=le(x,Se);return Ne?Ne.value=Ee:(ke.last=Ne={index:ue=y(Se,!0),key:Se,value:Ee,previous:he=ke.last,next:void 0,removed:!1},ke.first||(ke.first=Ne),he&&(he.next=Ne),n?ke.size++:x.size++,"F"!==ue&&(ke.index[ue]=Ne)),x},le=function(x,Se){var Ee,he=T(x),ue=y(Se);if("F"!==ue)return he.index[ue];for(Ee=he.first;Ee;Ee=Ee.next)if(Ee.key==Se)return Ee};return h(b,{clear:function(){for(var x=T(this),Se=x.index,Ee=x.first;Ee;)Ee.removed=!0,Ee.previous&&(Ee.previous=Ee.previous.next=void 0),delete Se[Ee.index],Ee=Ee.next;x.first=x.last=void 0,n?x.size=0:this.size=0},delete:function(x){var Ee=T(this),he=le(this,x);if(he){var ue=he.next,ke=he.previous;delete Ee.index[he.index],he.removed=!0,ke&&(ke.next=ue),ue&&(ue.previous=ke),Ee.first==he&&(Ee.first=ue),Ee.last==he&&(Ee.last=ke),n?Ee.size--:this.size--}return!!he},forEach:function(x){for(var Se,Ee=T(this),he=P(x,arguments.length>1?arguments[1]:void 0);Se=Se?Se.next:Ee.first;)for(he(Se.value,Se.key,this);Se&&Se.removed;)Se=Se.previous},has:function(x){return!!le(this,x)}}),h(b,c?{get:function(x){var Se=le(this,x);return Se&&Se.value},set:function(x,Se){return Z(this,0===x?0:x,Se)}}:{add:function(x){return Z(this,x=0===x?0:x,x)}}),n&&i(b,"size",{get:function(){return T(this).size}}),q},setStrong:function(f,I,c){var j=I+" Iterator",q=u(I),b=u(j);C(f,I,function(T,Z){m(this,{type:j,target:T,state:q(T),kind:Z,last:void 0})},function(){for(var T=b(this),Z=T.kind,le=T.last;le&&le.removed;)le=le.previous;return T.target&&(T.last=le=le?le.next:T.state.first)?"keys"==Z?{value:le.key,done:!1}:"values"==Z?{value:le.value,done:!1}:{value:[le.key,le.value],done:!1}:(T.target=void 0,{value:void 0,done:!0})},c?"entries":"values",!c,!0),S(I)}}},9320:(V,J,e)=>{"use strict";var i=e(1702),d=e(2248),h=e(2423).getWeakData,P=e(9670),w=e(111),M=e(5787),C=e(408),S=e(2092),n=e(2597),y=e(9909),R=y.set,m=y.getterFor,u=S.find,f=S.findIndex,I=i([].splice),c=0,j=function(T){return T.frozen||(T.frozen=new q)},q=function(){this.entries=[]},b=function(T,Z){return u(T.entries,function(le){return le[0]===Z})};q.prototype={get:function(T){var Z=b(this,T);if(Z)return Z[1]},has:function(T){return!!b(this,T)},set:function(T,Z){var le=b(this,T);le?le[1]=Z:this.entries.push([T,Z])},delete:function(T){var Z=f(this.entries,function(le){return le[0]===T});return~Z&&I(this.entries,Z,1),!!~Z}},V.exports={getConstructor:function(T,Z,le,x){var Se=T(function(ke,Ne){M(ke,Ee),R(ke,{type:Z,id:c++,frozen:void 0}),null!=Ne&&C(Ne,ke[x],{that:ke,AS_ENTRIES:le})}),Ee=Se.prototype,he=m(Z),ue=function(ke,Ne,ze){var Ve=he(ke),et=h(P(Ne),!0);return!0===et?j(Ve).set(Ne,ze):et[Ve.id]=ze,ke};return d(Ee,{delete:function(ke){var Ne=he(this);if(!w(ke))return!1;var ze=h(ke);return!0===ze?j(Ne).delete(ke):ze&&n(ze,Ne.id)&&delete ze[Ne.id]},has:function(ke){var Ne=he(this);if(!w(ke))return!1;var ze=h(ke);return!0===ze?j(Ne).has(ke):ze&&n(ze,Ne.id)}}),d(Ee,le?{get:function(ke){var Ne=he(this);if(w(ke)){var ze=h(ke);return!0===ze?j(Ne).get(ke):ze?ze[Ne.id]:void 0}},set:function(ke,Ne){return ue(this,ke,Ne)}}:{add:function(ke){return ue(this,ke,!0)}}),Se}}},7710:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(1702),P=e(4705),w=e(1320),M=e(2423),C=e(408),S=e(5787),n=e(614),y=e(111),R=e(7293),m=e(7072),u=e(8003),f=e(9587);V.exports=function(I,c,j){var q=-1!==I.indexOf("Map"),b=-1!==I.indexOf("Weak"),T=q?"set":"add",Z=d[I],le=Z&&Z.prototype,x=Z,Se={},Ee=function(Ve){var et=h(le[Ve]);w(le,Ve,"add"==Ve?function(_e){return et(this,0===_e?0:_e),this}:"delete"==Ve?function(_e){return!(b&&!y(_e))&&et(this,0===_e?0:_e)}:"get"==Ve?function(_e){return b&&!y(_e)?void 0:et(this,0===_e?0:_e)}:"has"==Ve?function(_e){return!(b&&!y(_e))&&et(this,0===_e?0:_e)}:function(_e,gt){return et(this,0===_e?0:_e,gt),this})};if(P(I,!n(Z)||!(b||le.forEach&&!R(function(){(new Z).entries().next()}))))x=j.getConstructor(c,I,q,T),M.enable();else if(P(I,!0)){var he=new x,ue=he[T](b?{}:-0,1)!=he,ke=R(function(){he.has(1)}),Ne=m(function(Ve){new Z(Ve)}),ze=!b&&R(function(){for(var Ve=new Z,et=5;et--;)Ve[T](et,et);return!Ve.has(-0)});Ne||((x=c(function(Ve,et){S(Ve,le);var _e=f(new Z,Ve,x);return null!=et&&C(et,_e[T],{that:_e,AS_ENTRIES:q}),_e})).prototype=le,le.constructor=x),(ke||ze)&&(Ee("delete"),Ee("has"),q&&Ee("get")),(ze||ue)&&Ee(T),b&&le.clear&&delete le.clear}return Se[I]=x,i({global:!0,forced:x!=Z},Se),u(x,I),b||j.setStrong(x,I,q),x}},9920:(V,J,e)=>{var i=e(2597),d=e(3887),h=e(1236),P=e(3070);V.exports=function(w,M){for(var C=d(M),S=P.f,n=h.f,y=0;y<C.length;y++){var R=C[y];i(w,R)||S(w,R,n(M,R))}}},4964:(V,J,e)=>{var i=e(5112)("match");V.exports=function(d){var h=/./;try{"/./"[d](h)}catch(P){try{return h[i]=!1,"/./"[d](h)}catch(w){}}return!1}},8544:(V,J,e)=>{var i=e(7293);V.exports=!i(function(){function d(){}return d.prototype.constructor=null,Object.getPrototypeOf(new d)!==d.prototype})},4994:(V,J,e)=>{"use strict";var i=e(3383).IteratorPrototype,d=e(30),h=e(9114),P=e(8003),w=e(7497),M=function(){return this};V.exports=function(C,S,n){var y=S+" Iterator";return C.prototype=d(i,{next:h(1,n)}),P(C,y,!1,!0),w[y]=M,C}},8880:(V,J,e)=>{var i=e(9781),d=e(3070),h=e(9114);V.exports=i?function(P,w,M){return d.f(P,w,h(1,M))}:function(P,w,M){return P[w]=M,P}},9114:V=>{V.exports=function(J,e){return{enumerable:!(1&J),configurable:!(2&J),writable:!(4&J),value:e}}},6135:(V,J,e)=>{"use strict";var i=e(4948),d=e(3070),h=e(9114);V.exports=function(P,w,M){var C=i(w);C in P?d.f(P,C,h(0,M)):P[C]=M}},5573:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=e(7293),P=e(6650).start,w=i.RangeError,M=Math.abs,C=Date.prototype,S=C.toISOString,n=d(C.getTime),y=d(C.getUTCDate),R=d(C.getUTCFullYear),m=d(C.getUTCHours),u=d(C.getUTCMilliseconds),f=d(C.getUTCMinutes),I=d(C.getUTCMonth),c=d(C.getUTCSeconds);V.exports=h(function(){return"0385-07-25T07:06:39.999Z"!=S.call(new Date(-50000000000001))})||!h(function(){S.call(new Date(NaN))})?function(){if(!isFinite(n(this)))throw w("Invalid time value");var j=this,q=R(j),b=u(j),T=q<0?"-":q>9999?"+":"";return T+P(M(q),T?6:4,0)+"-"+P(I(j)+1,2,0)+"-"+P(y(j),2,0)+"T"+P(m(j),2,0)+":"+P(f(j),2,0)+":"+P(c(j),2,0)+"."+P(b,3,0)+"Z"}:S},654:(V,J,e)=>{"use strict";var i=e(2109),d=e(6916),h=e(1913),P=e(6530),w=e(614),M=e(4994),C=e(9518),S=e(7674),n=e(8003),y=e(8880),R=e(1320),m=e(5112),u=e(7497),f=e(3383),I=P.PROPER,c=P.CONFIGURABLE,j=f.IteratorPrototype,q=f.BUGGY_SAFARI_ITERATORS,b=m("iterator"),T="keys",Z="values",le="entries",x=function(){return this};V.exports=function(Se,Ee,he,ue,ke,Ne,ze){M(he,Ee,ue);var Ve,et,_e,gt=function(dt){if(dt===ke&&Et)return Et;if(!q&&dt in at)return at[dt];switch(dt){case T:case Z:case le:return function(){return new he(this,dt)}}return function(){return new he(this)}},mt=Ee+" Iterator",ot=!1,at=Se.prototype,yt=at[b]||at["@@iterator"]||ke&&at[ke],Et=!q&&yt||gt(ke),ie="Array"==Ee&&at.entries||yt;if(ie&&(Ve=C(ie.call(new Se)))!==Object.prototype&&Ve.next&&(h||C(Ve)===j||(S?S(Ve,j):w(Ve[b])||R(Ve,b,x)),n(Ve,mt,!0,!0),h&&(u[mt]=x)),I&&ke==Z&&yt&&yt.name!==Z&&(!h&&c?y(at,"name",Z):(ot=!0,Et=function(){return d(yt,this)})),ke)if(et={values:gt(Z),keys:Ne?Et:gt(T),entries:gt(le)},ze)for(_e in et)(q||ot||!(_e in at))&&R(at,_e,et[_e]);else i({target:Ee,proto:!0,forced:q||ot},et);return h&&!ze||at[b]===Et||R(at,b,Et,{name:ke}),u[Ee]=Et,et}},7235:(V,J,e)=>{var i=e(857),d=e(2597),h=e(6061),P=e(3070).f;V.exports=function(w){var M=i.Symbol||(i.Symbol={});d(M,w)||P(M,w,{value:h.f(w)})}},9781:(V,J,e)=>{var i=e(7293);V.exports=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},317:(V,J,e)=>{var i=e(7854),d=e(111),h=i.document,P=d(h)&&d(h.createElement);V.exports=function(w){return P?h.createElement(w):{}}},8324:V=>{V.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(V,J,e)=>{var i=e(317)("span").classList,d=i&&i.constructor&&i.constructor.prototype;V.exports=d===Object.prototype?void 0:d},8886:(V,J,e)=>{var i=e(8113).match(/firefox\/(\d+)/i);V.exports=!!i&&+i[1]},7871:V=>{V.exports="object"==typeof window},256:(V,J,e)=>{var i=e(8113);V.exports=/MSIE|Trident/.test(i)},1528:(V,J,e)=>{var i=e(8113),d=e(7854);V.exports=/ipad|iphone|ipod/i.test(i)&&void 0!==d.Pebble},6833:(V,J,e)=>{var i=e(8113);V.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},2805:(V,J,e)=>{var i=e(4326),d=e(7854);V.exports="process"==i(d.process)},1036:(V,J,e)=>{var i=e(8113);V.exports=/web0s(?!.*chrome)/i.test(i)},8113:(V,J,e)=>{var i=e(5005);V.exports=i("navigator","userAgent")||""},7392:(V,J,e)=>{var i,d,h=e(7854),P=e(8113),w=h.process,M=h.Deno,C=w&&w.versions||M&&M.version,S=C&&C.v8;S&&(d=(i=S.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!d&&P&&(!(i=P.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=P.match(/Chrome\/(\d+)/))&&(d=+i[1]),V.exports=d},8008:(V,J,e)=>{var i=e(8113).match(/AppleWebKit\/(\d+)\./);V.exports=!!i&&+i[1]},748:V=>{V.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(V,J,e)=>{var i=e(7854),d=e(1236).f,h=e(8880),P=e(1320),w=e(3505),M=e(9920),C=e(4705);V.exports=function(S,n){var y,R,m,u,f,I=S.target,c=S.global,j=S.stat;if(y=c?i:j?i[I]||w(I,{}):(i[I]||{}).prototype)for(R in n){if(u=n[R],m=S.noTargetGet?(f=d(y,R))&&f.value:y[R],!C(c?R:I+(j?".":"#")+R,S.forced)&&void 0!==m){if(typeof u==typeof m)continue;M(u,m)}(S.sham||m&&m.sham)&&h(u,"sham",!0),P(y,R,u,S)}}},7293:V=>{V.exports=function(J){try{return!!J()}catch(e){return!0}}},7007:(V,J,e)=>{"use strict";e(4916);var i=e(1702),d=e(1320),h=e(2261),P=e(7293),w=e(5112),M=e(8880),C=w("species"),S=RegExp.prototype;V.exports=function(n,y,R,m){var u=w(n),f=!P(function(){var q={};return q[u]=function(){return 7},7!=""[n](q)}),I=f&&!P(function(){var q=!1,b=/a/;return"split"===n&&((b={}).constructor={},b.constructor[C]=function(){return b},b.flags="",b[u]=/./[u]),b.exec=function(){return q=!0,null},b[u](""),!q});if(!f||!I||R){var c=i(/./[u]),j=y(u,""[n],function(q,b,T,Z,le){var x=i(q),Se=b.exec;return Se===h||Se===S.exec?f&&!le?{done:!0,value:c(b,T,Z)}:{done:!0,value:x(T,b,Z)}:{done:!1}});d(String.prototype,n,j[0]),d(S,u,j[1])}m&&M(S[u],"sham",!0)}},6677:(V,J,e)=>{var i=e(7293);V.exports=!i(function(){return Object.isExtensible(Object.preventExtensions({}))})},2104:V=>{var J=Function.prototype,e=J.apply,d=J.call;V.exports="object"==typeof Reflect&&Reflect.apply||(J.bind?d.bind(e):function(){return d.apply(e,arguments)})},9974:(V,J,e)=>{var i=e(1702),d=e(9662),h=i(i.bind);V.exports=function(P,w){return d(P),void 0===w?P:h?h(P,w):function(){return P.apply(w,arguments)}}},7065:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=e(9662),P=e(111),w=e(2597),M=e(206),C=i.Function,S=d([].concat),n=d([].join),y={},R=function(m,u,f){if(!w(y,u)){for(var I=[],c=0;c<u;c++)I[c]="a["+c+"]";y[u]=C("C,a","return new C("+n(I,",")+")")}return y[u](m,f)};V.exports=C.bind||function(m){var u=h(this),f=u.prototype,I=M(arguments,1),c=function(){var j=S(I,M(arguments));return this instanceof c?R(u,j.length,j):u.apply(m,j)};return P(f)&&(c.prototype=f),c}},6916:V=>{var J=Function.prototype.call;V.exports=J.bind?J.bind(J):function(){return J.apply(J,arguments)}},6530:(V,J,e)=>{var i=e(9781),d=e(2597),h=Function.prototype,P=i&&Object.getOwnPropertyDescriptor,w=d(h,"name"),M=w&&"something"===function(){}.name,C=w&&(!i||i&&P(h,"name").configurable);V.exports={EXISTS:w,PROPER:M,CONFIGURABLE:C}},1702:V=>{var J=Function.prototype,e=J.bind,i=J.call,d=e&&e.bind(i);V.exports=e?function(h){return h&&d(i,h)}:function(h){return h&&function(){return i.apply(h,arguments)}}},5005:(V,J,e)=>{var i=e(7854),d=e(614),h=function(P){return d(P)?P:void 0};V.exports=function(P,w){return arguments.length<2?h(i[P]):i[P]&&i[P][w]}},1246:(V,J,e)=>{var i=e(648),d=e(8173),h=e(7497),P=e(5112)("iterator");V.exports=function(w){if(null!=w)return d(w,P)||d(w,"@@iterator")||h[i(w)]}},8554:(V,J,e)=>{var i=e(7854),d=e(6916),h=e(9662),P=e(9670),w=e(6330),M=e(1246),C=i.TypeError;V.exports=function(S,n){var y=arguments.length<2?M(S):n;if(h(y))return P(d(y,S));throw C(w(S)+" is not iterable")}},8173:(V,J,e)=>{var i=e(9662);V.exports=function(d,h){var P=d[h];return null==P?void 0:i(P)}},647:(V,J,e)=>{var i=e(1702),d=e(7908),h=Math.floor,P=i("".charAt),w=i("".replace),M=i("".slice),C=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,S=/\$([$&'`]|\d{1,2})/g;V.exports=function(n,y,R,m,u,f){var I=R+n.length,c=m.length,j=S;return void 0!==u&&(u=d(u),j=C),w(f,j,function(q,b){var T;switch(P(b,0)){case"$":return"$";case"&":return n;case"`":return M(y,0,R);case"'":return M(y,I);case"<":T=u[M(b,1,-1)];break;default:var Z=+b;if(0===Z)return q;if(Z>c){var le=h(Z/10);return 0===le?q:le<=c?void 0===m[le-1]?P(b,1):m[le-1]+P(b,1):q}T=m[Z-1]}return void 0===T?"":T})}},7854:(V,J,e)=>{var i=function(d){return d&&d.Math==Math&&d};V.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof e.g&&e.g)||function(){return this}()||Function("return this")()},2597:(V,J,e)=>{var i=e(1702),d=e(7908),h=i({}.hasOwnProperty);V.exports=Object.hasOwn||function(P,w){return h(d(P),w)}},3501:V=>{V.exports={}},842:(V,J,e)=>{var i=e(7854);V.exports=function(d,h){var P=i.console;P&&P.error&&(1==arguments.length?P.error(d):P.error(d,h))}},490:(V,J,e)=>{var i=e(5005);V.exports=i("document","documentElement")},4664:(V,J,e)=>{var i=e(9781),d=e(7293),h=e(317);V.exports=!i&&!d(function(){return 7!=Object.defineProperty(h("div"),"a",{get:function(){return 7}}).a})},1179:(V,J,e)=>{var i=e(7854).Array,d=Math.abs,h=Math.pow,P=Math.floor,w=Math.log,M=Math.LN2;V.exports={pack:function(C,S,n){var y,R,m,u=i(n),f=8*n-S-1,I=(1<<f)-1,c=I>>1,j=23===S?h(2,-24)-h(2,-77):0,q=C<0||0===C&&1/C<0?1:0,b=0;for((C=d(C))!=C||C===1/0?(R=C!=C?1:0,y=I):(y=P(w(C)/M),C*(m=h(2,-y))<1&&(y--,m*=2),(C+=y+c>=1?j/m:j*h(2,1-c))*m>=2&&(y++,m/=2),y+c>=I?(R=0,y=I):y+c>=1?(R=(C*m-1)*h(2,S),y+=c):(R=C*h(2,c-1)*h(2,S),y=0));S>=8;u[b++]=255&R,R/=256,S-=8);for(y=y<<S|R,f+=S;f>0;u[b++]=255&y,y/=256,f-=8);return u[--b]|=128*q,u},unpack:function(C,S){var n,y=C.length,R=8*y-S-1,m=(1<<R)-1,u=m>>1,f=R-7,I=y-1,c=C[I--],j=127&c;for(c>>=7;f>0;j=256*j+C[I],I--,f-=8);for(n=j&(1<<-f)-1,j>>=-f,f+=S;f>0;n=256*n+C[I],I--,f-=8);if(0===j)j=1-u;else{if(j===m)return n?NaN:c?-1/0:1/0;n+=h(2,S),j-=u}return(c?-1:1)*n*h(2,j-S)}}},8361:(V,J,e)=>{var i=e(7854),d=e(1702),h=e(7293),P=e(4326),w=i.Object,M=d("".split);V.exports=h(function(){return!w("z").propertyIsEnumerable(0)})?function(C){return"String"==P(C)?M(C,""):w(C)}:w},9587:(V,J,e)=>{var i=e(614),d=e(111),h=e(7674);V.exports=function(P,w,M){var C,S;return h&&i(C=w.constructor)&&C!==M&&d(S=C.prototype)&&S!==M.prototype&&h(P,S),P}},2788:(V,J,e)=>{var i=e(1702),d=e(614),h=e(5465),P=i(Function.toString);d(h.inspectSource)||(h.inspectSource=function(w){return P(w)}),V.exports=h.inspectSource},2423:(V,J,e)=>{var i=e(2109),d=e(1702),h=e(3501),P=e(111),w=e(2597),M=e(3070).f,C=e(8006),S=e(1156),n=e(9711),y=e(6677),R=!1,m=n("meta"),u=0,f=Object.isExtensible||function(){return!0},I=function(j){M(j,m,{value:{objectID:"O"+u++,weakData:{}}})},c=V.exports={enable:function(){c.enable=function(){},R=!0;var j=C.f,q=d([].splice),b={};b[m]=1,j(b).length&&(C.f=function(T){for(var Z=j(T),le=0,x=Z.length;le<x;le++)if(Z[le]===m){q(Z,le,1);break}return Z},i({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:S.f}))},fastKey:function(j,q){if(!P(j))return"symbol"==typeof j?j:("string"==typeof j?"S":"P")+j;if(!w(j,m)){if(!f(j))return"F";if(!q)return"E";I(j)}return j[m].objectID},getWeakData:function(j,q){if(!w(j,m)){if(!f(j))return!0;if(!q)return!1;I(j)}return j[m].weakData},onFreeze:function(j){return y&&R&&f(j)&&!w(j,m)&&I(j),j}};h[m]=!0},9909:(V,J,e)=>{var i,d,h,P=e(8536),w=e(7854),M=e(1702),C=e(111),S=e(8880),n=e(2597),y=e(5465),R=e(6200),m=e(3501),u="Object already initialized",f=w.TypeError;if(P||y.state){var c=y.state||(y.state=new(0,w.WeakMap)),j=M(c.get),q=M(c.has),b=M(c.set);i=function(Z,le){if(q(c,Z))throw new f(u);return le.facade=Z,b(c,Z,le),le},d=function(Z){return j(c,Z)||{}},h=function(Z){return q(c,Z)}}else{var T=R("state");m[T]=!0,i=function(Z,le){if(n(Z,T))throw new f(u);return le.facade=Z,S(Z,T,le),le},d=function(Z){return n(Z,T)?Z[T]:{}},h=function(Z){return n(Z,T)}}V.exports={set:i,get:d,has:h,enforce:function(Z){return h(Z)?d(Z):i(Z,{})},getterFor:function(Z){return function(le){var x;if(!C(le)||(x=d(le)).type!==Z)throw f("Incompatible receiver, "+Z+" required");return x}}}},7659:(V,J,e)=>{var i=e(5112),d=e(7497),h=i("iterator"),P=Array.prototype;V.exports=function(w){return void 0!==w&&(d.Array===w||P[h]===w)}},3157:(V,J,e)=>{var i=e(4326);V.exports=Array.isArray||function(d){return"Array"==i(d)}},614:V=>{V.exports=function(J){return"function"==typeof J}},4411:(V,J,e)=>{var i=e(1702),d=e(7293),h=e(614),P=e(648),w=e(5005),M=e(2788),C=function(){},S=[],n=w("Reflect","construct"),y=/^\s*(?:class|function)\b/,R=i(y.exec),m=!y.exec(C),u=function(f){if(!h(f))return!1;try{return n(C,S,f),!0}catch(I){return!1}};V.exports=!n||d(function(){var f;return u(u.call)||!u(Object)||!u(function(){f=!0})||f})?function(f){if(!h(f))return!1;switch(P(f)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return m||!!R(y,M(f))}:u},5032:(V,J,e)=>{var i=e(2597);V.exports=function(d){return void 0!==d&&(i(d,"value")||i(d,"writable"))}},4705:(V,J,e)=>{var i=e(7293),d=e(614),h=/#|\.prototype\./,P=function(n,y){var R=M[w(n)];return R==S||R!=C&&(d(y)?i(y):!!y)},w=P.normalize=function(n){return String(n).replace(h,".").toLowerCase()},M=P.data={},C=P.NATIVE="N",S=P.POLYFILL="P";V.exports=P},5988:(V,J,e)=>{var i=e(111),d=Math.floor;V.exports=Number.isInteger||function(h){return!i(h)&&isFinite(h)&&d(h)===h}},111:(V,J,e)=>{var i=e(614);V.exports=function(d){return"object"==typeof d?null!==d:i(d)}},1913:V=>{V.exports=!1},7850:(V,J,e)=>{var i=e(111),d=e(4326),h=e(5112)("match");V.exports=function(P){var w;return i(P)&&(void 0!==(w=P[h])?!!w:"RegExp"==d(P))}},2190:(V,J,e)=>{var i=e(7854),d=e(5005),h=e(614),P=e(7976),w=e(3307),M=i.Object;V.exports=w?function(C){return"symbol"==typeof C}:function(C){var S=d("Symbol");return h(S)&&P(S.prototype,M(C))}},408:(V,J,e)=>{var i=e(7854),d=e(9974),h=e(6916),P=e(9670),w=e(6330),M=e(7659),C=e(6244),S=e(7976),n=e(8554),y=e(1246),R=e(9212),m=i.TypeError,u=function(I,c){this.stopped=I,this.result=c},f=u.prototype;V.exports=function(I,c,j){var q,b,T,Z,le,x,Se,he=!(!j||!j.AS_ENTRIES),ue=!(!j||!j.IS_ITERATOR),ke=!(!j||!j.INTERRUPTED),Ne=d(c,j&&j.that),ze=function(et){return q&&R(q,"normal",et),new u(!0,et)},Ve=function(et){return he?(P(et),ke?Ne(et[0],et[1],ze):Ne(et[0],et[1])):ke?Ne(et,ze):Ne(et)};if(ue)q=I;else{if(!(b=y(I)))throw m(w(I)+" is not iterable");if(M(b)){for(T=0,Z=C(I);Z>T;T++)if((le=Ve(I[T]))&&S(f,le))return le;return new u(!1)}q=n(I,b)}for(x=q.next;!(Se=h(x,q)).done;){try{le=Ve(Se.value)}catch(et){R(q,"throw",et)}if("object"==typeof le&&le&&S(f,le))return le}return new u(!1)}},9212:(V,J,e)=>{var i=e(6916),d=e(9670),h=e(8173);V.exports=function(P,w,M){var C,S;d(P);try{if(!(C=h(P,"return"))){if("throw"===w)throw M;return M}C=i(C,P)}catch(n){S=!0,C=n}if("throw"===w)throw M;if(S)throw C;return d(C),M}},3383:(V,J,e)=>{"use strict";var i,d,h,P=e(7293),w=e(614),M=e(30),C=e(9518),S=e(1320),n=e(5112),y=e(1913),R=n("iterator"),m=!1;[].keys&&("next"in(h=[].keys())?(d=C(C(h)))!==Object.prototype&&(i=d):m=!0),null==i||P(function(){var u={};return i[R].call(u)!==u})?i={}:y&&(i=M(i)),w(i[R])||S(i,R,function(){return this}),V.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:m}},7497:V=>{V.exports={}},6244:(V,J,e)=>{var i=e(7466);V.exports=function(d){return i(d.length)}},5948:(V,J,e)=>{var i,d,h,P,w,M,C,S,n=e(7854),y=e(9974),R=e(1236).f,m=e(261).set,u=e(6833),f=e(1528),I=e(1036),c=e(2805),j=n.MutationObserver||n.WebKitMutationObserver,q=n.document,b=n.process,T=n.Promise,Z=R(n,"queueMicrotask"),le=Z&&Z.value;le||(i=function(){var x,Se;for(c&&(x=b.domain)&&x.exit();d;){Se=d.fn,d=d.next;try{Se()}catch(Ee){throw d?P():h=void 0,Ee}}h=void 0,x&&x.enter()},u||c||I||!j||!q?!f&&T&&T.resolve?((C=T.resolve(void 0)).constructor=T,S=y(C.then,C),P=function(){S(i)}):c?P=function(){b.nextTick(i)}:(m=y(m,n),P=function(){m(i)}):(w=!0,M=q.createTextNode(""),new j(i).observe(M,{characterData:!0}),P=function(){M.data=w=!w})),V.exports=le||function(x){var Se={fn:x,next:void 0};h&&(h.next=Se),d||(d=Se,P()),h=Se}},3366:(V,J,e)=>{var i=e(7854);V.exports=i.Promise},133:(V,J,e)=>{var i=e(7392),d=e(7293);V.exports=!!Object.getOwnPropertySymbols&&!d(function(){var h=Symbol();return!String(h)||!(Object(h)instanceof Symbol)||!Symbol.sham&&i&&i<41})},590:(V,J,e)=>{var i=e(7293),d=e(5112),h=e(1913),P=d("iterator");V.exports=!i(function(){var w=new URL("b?a=1&b=2&c=3","http://a"),M=w.searchParams,C="";return w.pathname="c%20d",M.forEach(function(S,n){M.delete("b"),C+=n+S}),h&&!w.toJSON||!M.sort||"http://a/c%20d?a=1&c=3"!==w.href||"3"!==M.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!M[P]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==C||"x"!==new URL("http://x",void 0).host})},8536:(V,J,e)=>{var i=e(7854),d=e(614),h=e(2788),P=i.WeakMap;V.exports=d(P)&&/native code/.test(h(P))},8523:(V,J,e)=>{"use strict";var i=e(9662),d=function(h){var P,w;this.promise=new h(function(M,C){if(void 0!==P||void 0!==w)throw TypeError("Bad Promise constructor");P=M,w=C}),this.resolve=i(P),this.reject=i(w)};V.exports.f=function(h){return new d(h)}},3929:(V,J,e)=>{var i=e(7854),d=e(7850),h=i.TypeError;V.exports=function(P){if(d(P))throw h("The method doesn't accept regular expressions");return P}},3009:(V,J,e)=>{var i=e(7854),d=e(7293),h=e(1702),P=e(1340),w=e(3111).trim,M=e(1361),C=i.parseInt,S=i.Symbol,n=S&&S.iterator,y=/^[+-]?0x/i,R=h(y.exec),m=8!==C(M+"08")||22!==C(M+"0x16")||n&&!d(function(){C(Object(n))});V.exports=m?function(u,f){var I=w(P(u));return C(I,f>>>0||(R(y,I)?16:10))}:C},1574:(V,J,e)=>{"use strict";var i=e(9781),d=e(1702),h=e(6916),P=e(7293),w=e(1956),M=e(5181),C=e(5296),S=e(7908),n=e(8361),y=Object.assign,R=Object.defineProperty,m=d([].concat);V.exports=!y||P(function(){if(i&&1!==y({b:1},y(R({},"a",{enumerable:!0,get:function(){R(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var u={},f={},I=Symbol(),c="abcdefghijklmnopqrst";return u[I]=7,c.split("").forEach(function(j){f[j]=j}),7!=y({},u)[I]||w(y({},f)).join("")!=c})?function(u,f){for(var I=S(u),c=arguments.length,j=1,q=M.f,b=C.f;c>j;)for(var T,Z=n(arguments[j++]),le=q?m(w(Z),q(Z)):w(Z),x=le.length,Se=0;x>Se;)T=le[Se++],i&&!h(b,Z,T)||(I[T]=Z[T]);return I}:y},30:(V,J,e)=>{var i,d=e(9670),h=e(6048),P=e(748),w=e(3501),M=e(490),C=e(317),S=e(6200)("IE_PROTO"),n=function(){},y=function(u){return"<script>"+u+"<\/script>"},R=function(u){u.write(y("")),u.close();var f=u.parentWindow.Object;return u=null,f},m=function(){try{i=new ActiveXObject("htmlfile")}catch(c){}var u,f;m="undefined"!=typeof document?document.domain&&i?R(i):((f=C("iframe")).style.display="none",M.appendChild(f),f.src=String("javascript:"),(u=f.contentWindow.document).open(),u.write(y("document.F=Object")),u.close(),u.F):R(i);for(var I=P.length;I--;)delete m.prototype[P[I]];return m()};w[S]=!0,V.exports=Object.create||function(u,f){var I;return null!==u?(n.prototype=d(u),I=new n,n.prototype=null,I[S]=u):I=m(),void 0===f?I:h(I,f)}},6048:(V,J,e)=>{var i=e(9781),d=e(3070),h=e(9670),P=e(5656),w=e(1956);V.exports=i?Object.defineProperties:function(M,C){h(M);for(var S,n=P(C),y=w(C),R=y.length,m=0;R>m;)d.f(M,S=y[m++],n[S]);return M}},3070:(V,J,e)=>{var i=e(7854),d=e(9781),h=e(4664),P=e(9670),w=e(4948),M=i.TypeError,C=Object.defineProperty;J.f=d?C:function(S,n,y){if(P(S),n=w(n),P(y),h)try{return C(S,n,y)}catch(R){}if("get"in y||"set"in y)throw M("Accessors not supported");return"value"in y&&(S[n]=y.value),S}},1236:(V,J,e)=>{var i=e(9781),d=e(6916),h=e(5296),P=e(9114),w=e(5656),M=e(4948),C=e(2597),S=e(4664),n=Object.getOwnPropertyDescriptor;J.f=i?n:function(y,R){if(y=w(y),R=M(R),S)try{return n(y,R)}catch(m){}if(C(y,R))return P(!d(h.f,y,R),y[R])}},1156:(V,J,e)=>{var i=e(4326),d=e(5656),h=e(8006).f,P=e(206),w="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];V.exports.f=function(M){return w&&"Window"==i(M)?function(C){try{return h(C)}catch(S){return P(w)}}(M):h(d(M))}},8006:(V,J,e)=>{var i=e(6324),d=e(748).concat("length","prototype");J.f=Object.getOwnPropertyNames||function(h){return i(h,d)}},5181:(V,J)=>{J.f=Object.getOwnPropertySymbols},9518:(V,J,e)=>{var i=e(7854),d=e(2597),h=e(614),P=e(7908),w=e(6200),M=e(8544),C=w("IE_PROTO"),S=i.Object,n=S.prototype;V.exports=M?S.getPrototypeOf:function(y){var R=P(y);if(d(R,C))return R[C];var m=R.constructor;return h(m)&&R instanceof m?m.prototype:R instanceof S?n:null}},7976:(V,J,e)=>{var i=e(1702);V.exports=i({}.isPrototypeOf)},6324:(V,J,e)=>{var i=e(1702),d=e(2597),h=e(5656),P=e(1318).indexOf,w=e(3501),M=i([].push);V.exports=function(C,S){var n,y=h(C),R=0,m=[];for(n in y)!d(w,n)&&d(y,n)&&M(m,n);for(;S.length>R;)d(y,n=S[R++])&&(~P(m,n)||M(m,n));return m}},1956:(V,J,e)=>{var i=e(6324),d=e(748);V.exports=Object.keys||function(h){return i(h,d)}},5296:(V,J)=>{"use strict";var e={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,d=i&&!e.call({1:2},1);J.f=d?function(h){var P=i(this,h);return!!P&&P.enumerable}:e},7674:(V,J,e)=>{var i=e(1702),d=e(9670),h=e(6077);V.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var P,w=!1,M={};try{(P=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),w=M instanceof Array}catch(C){}return function(C,S){return d(C),h(S),w?P(C,S):C.__proto__=S,C}}():void 0)},4699:(V,J,e)=>{var i=e(9781),d=e(1702),h=e(1956),P=e(5656),w=d(e(5296).f),M=d([].push),C=function(S){return function(n){for(var y,R=P(n),m=h(R),u=m.length,f=0,I=[];u>f;)y=m[f++],i&&!w(R,y)||M(I,S?[y,R[y]]:R[y]);return I}};V.exports={entries:C(!0),values:C(!1)}},288:(V,J,e)=>{"use strict";var i=e(1694),d=e(648);V.exports=i?{}.toString:function(){return"[object "+d(this)+"]"}},2140:(V,J,e)=>{var i=e(7854),d=e(6916),h=e(614),P=e(111),w=i.TypeError;V.exports=function(M,C){var S,n;if("string"===C&&h(S=M.toString)&&!P(n=d(S,M))||h(S=M.valueOf)&&!P(n=d(S,M))||"string"!==C&&h(S=M.toString)&&!P(n=d(S,M)))return n;throw w("Can't convert object to primitive value")}},3887:(V,J,e)=>{var i=e(5005),d=e(1702),h=e(8006),P=e(5181),w=e(9670),M=d([].concat);V.exports=i("Reflect","ownKeys")||function(C){var S=h.f(w(C)),n=P.f;return n?M(S,n(C)):S}},857:(V,J,e)=>{var i=e(7854);V.exports=i},2534:V=>{V.exports=function(J){try{return{error:!1,value:J()}}catch(e){return{error:!0,value:e}}}},9478:(V,J,e)=>{var i=e(9670),d=e(111),h=e(8523);V.exports=function(P,w){if(i(P),d(w)&&w.constructor===P)return w;var M=h.f(P);return(0,M.resolve)(w),M.promise}},2248:(V,J,e)=>{var i=e(1320);V.exports=function(d,h,P){for(var w in h)i(d,w,h[w],P);return d}},1320:(V,J,e)=>{var i=e(7854),d=e(614),h=e(2597),P=e(8880),w=e(3505),M=e(2788),C=e(9909),S=e(6530).CONFIGURABLE,n=C.get,y=C.enforce,R=String(String).split("String");(V.exports=function(m,u,f,I){var c,j=!!I&&!!I.unsafe,q=!!I&&!!I.enumerable,b=!!I&&!!I.noTargetGet,T=I&&void 0!==I.name?I.name:u;d(f)&&("Symbol("===String(T).slice(0,7)&&(T="["+String(T).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!h(f,"name")||S&&f.name!==T)&&P(f,"name",T),(c=y(f)).source||(c.source=R.join("string"==typeof T?T:""))),m!==i?(j?!b&&m[u]&&(q=!0):delete m[u],q?m[u]=f:P(m,u,f)):q?m[u]=f:w(u,f)})(Function.prototype,"toString",function(){return d(this)&&n(this).source||M(this)})},7651:(V,J,e)=>{var i=e(7854),d=e(6916),h=e(9670),P=e(614),w=e(4326),M=e(2261),C=i.TypeError;V.exports=function(S,n){var y=S.exec;if(P(y)){var R=d(y,S,n);return null!==R&&h(R),R}if("RegExp"===w(S))return d(M,S,n);throw C("RegExp#exec called on incompatible receiver")}},2261:(V,J,e)=>{"use strict";var i,d,h=e(6916),P=e(1702),w=e(1340),M=e(7066),C=e(2999),S=e(2309),n=e(30),y=e(9909).get,R=e(9441),m=e(7168),u=S("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,I=f,c=P("".charAt),j=P("".indexOf),q=P("".replace),b=P("".slice),T=(d=/b*/g,h(f,i=/a/,"a"),h(f,d,"a"),0!==i.lastIndex||0!==d.lastIndex),Z=C.UNSUPPORTED_Y||C.BROKEN_CARET,le=void 0!==/()??/.exec("")[1];(T||le||Z||R||m)&&(I=function(x){var Se,Ee,he,ue,ke,Ne,ze,Ve=this,et=y(Ve),_e=w(x),gt=et.raw;if(gt)return gt.lastIndex=Ve.lastIndex,Se=h(I,gt,_e),Ve.lastIndex=gt.lastIndex,Se;var mt=et.groups,ot=Z&&Ve.sticky,at=h(M,Ve),yt=Ve.source,Et=0,ie=_e;if(ot&&(at=q(at,"y",""),-1===j(at,"g")&&(at+="g"),ie=b(_e,Ve.lastIndex),Ve.lastIndex>0&&(!Ve.multiline||Ve.multiline&&"\n"!==c(_e,Ve.lastIndex-1))&&(yt="(?: "+yt+")",ie=" "+ie,Et++),Ee=new RegExp("^(?:"+yt+")",at)),le&&(Ee=new RegExp("^"+yt+"$(?!\\s)",at)),T&&(he=Ve.lastIndex),ue=h(f,ot?Ee:Ve,ie),ot?ue?(ue.input=b(ue.input,Et),ue[0]=b(ue[0],Et),ue.index=Ve.lastIndex,Ve.lastIndex+=ue[0].length):Ve.lastIndex=0:T&&ue&&(Ve.lastIndex=Ve.global?ue.index+ue[0].length:he),le&&ue&&ue.length>1&&h(u,ue[0],Ee,function(){for(ke=1;ke<arguments.length-2;ke++)void 0===arguments[ke]&&(ue[ke]=void 0)}),ue&&mt)for(ue.groups=Ne=n(null),ke=0;ke<mt.length;ke++)Ne[(ze=mt[ke])[0]]=ue[ze[1]];return ue}),V.exports=I},7066:(V,J,e)=>{"use strict";var i=e(9670);V.exports=function(){var d=i(this),h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),d.dotAll&&(h+="s"),d.unicode&&(h+="u"),d.sticky&&(h+="y"),h}},2999:(V,J,e)=>{var i=e(7293),d=e(7854).RegExp;J.UNSUPPORTED_Y=i(function(){var h=d("a","y");return h.lastIndex=2,null!=h.exec("abcd")}),J.BROKEN_CARET=i(function(){var h=d("^r","gy");return h.lastIndex=2,null!=h.exec("str")})},9441:(V,J,e)=>{var i=e(7293),d=e(7854).RegExp;V.exports=i(function(){var h=d(".","s");return!(h.dotAll&&h.exec("\n")&&"s"===h.flags)})},7168:(V,J,e)=>{var i=e(7293),d=e(7854).RegExp;V.exports=i(function(){var h=d("(?<a>b)","g");return"b"!==h.exec("b").groups.a||"bc"!=="b".replace(h,"$<a>c")})},4488:(V,J,e)=>{var i=e(7854).TypeError;V.exports=function(d){if(null==d)throw i("Can't call method on "+d);return d}},1150:V=>{V.exports=Object.is||function(J,e){return J===e?0!==J||1/J==1/e:J!=J&&e!=e}},3505:(V,J,e)=>{var i=e(7854),d=Object.defineProperty;V.exports=function(h,P){try{d(i,h,{value:P,configurable:!0,writable:!0})}catch(w){i[h]=P}return P}},6340:(V,J,e)=>{"use strict";var i=e(5005),d=e(3070),h=e(5112),P=e(9781),w=h("species");V.exports=function(M){var C=i(M);P&&C&&!C[w]&&(0,d.f)(C,w,{configurable:!0,get:function(){return this}})}},8003:(V,J,e)=>{var i=e(3070).f,d=e(2597),h=e(5112)("toStringTag");V.exports=function(P,w,M){P&&!d(P=M?P:P.prototype,h)&&i(P,h,{configurable:!0,value:w})}},6200:(V,J,e)=>{var i=e(2309),d=e(9711),h=i("keys");V.exports=function(P){return h[P]||(h[P]=d(P))}},5465:(V,J,e)=>{var i=e(7854),d=e(3505),h="__core-js_shared__",P=i[h]||d(h,{});V.exports=P},2309:(V,J,e)=>{var i=e(1913),d=e(5465);(V.exports=function(h,P){return d[h]||(d[h]=void 0!==P?P:{})})("versions",[]).push({version:"3.19.0",mode:i?"pure":"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})},6707:(V,J,e)=>{var i=e(9670),d=e(9483),h=e(5112)("species");V.exports=function(P,w){var M,C=i(P).constructor;return void 0===C||null==(M=i(C)[h])?w:d(M)}},8710:(V,J,e)=>{var i=e(1702),d=e(9303),h=e(1340),P=e(4488),w=i("".charAt),M=i("".charCodeAt),C=i("".slice),S=function(n){return function(y,R){var m,u,f=h(P(y)),I=d(R),c=f.length;return I<0||I>=c?n?"":void 0:(m=M(f,I))<55296||m>56319||I+1===c||(u=M(f,I+1))<56320||u>57343?n?w(f,I):m:n?C(f,I,I+2):u-56320+(m-55296<<10)+65536}};V.exports={codeAt:S(!1),charAt:S(!0)}},6650:(V,J,e)=>{var i=e(1702),d=e(7466),h=e(1340),P=e(8415),w=e(4488),M=i(P),C=i("".slice),S=Math.ceil,n=function(y){return function(R,m,u){var f,I,c=h(w(R)),j=d(m),q=c.length,b=void 0===u?" ":h(u);return j<=q||""==b?c:((I=M(b,S((f=j-q)/b.length))).length>f&&(I=C(I,0,f)),y?c+I:I+c)}};V.exports={start:n(!1),end:n(!0)}},3197:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=2147483647,P=/[^\0-\u007E]/,w=/[.\u3002\uFF0E\uFF61]/g,M="Overflow: input needs wider integers to process",C=i.RangeError,S=d(w.exec),n=Math.floor,y=String.fromCharCode,R=d("".charCodeAt),m=d([].join),u=d([].push),f=d("".replace),I=d("".split),c=d("".toLowerCase),j=function(T){return T+22+75*(T<26)},q=function(T,Z,le){var x=0;for(T=le?n(T/700):T>>1,T+=n(T/Z);T>455;x+=36)T=n(T/35);return n(x+36*T/(T+38))},b=function(T){var le,x,Z=[],Se=(T=function(at){for(var yt=[],Et=0,ie=at.length;Et<ie;){var dt=R(at,Et++);if(dt>=55296&&dt<=56319&&Et<ie){var Mt=R(at,Et++);56320==(64512&Mt)?u(yt,((1023&dt)<<10)+(1023&Mt)+65536):(u(yt,dt),Et--)}else u(yt,dt)}return yt}(T)).length,Ee=128,he=0,ue=72;for(le=0;le<T.length;le++)(x=T[le])<128&&u(Z,y(x));var ke=Z.length,Ne=ke;for(ke&&u(Z,"-");Ne<Se;){var ze=h;for(le=0;le<T.length;le++)(x=T[le])>=Ee&&x<ze&&(ze=x);var Ve=Ne+1;if(ze-Ee>n((h-he)/Ve))throw C(M);for(he+=(ze-Ee)*Ve,Ee=ze,le=0;le<T.length;le++){if((x=T[le])<Ee&&++he>h)throw C(M);if(x==Ee){for(var et=he,_e=36;;_e+=36){var gt=_e<=ue?1:_e>=ue+26?26:_e-ue;if(et<gt)break;var mt=et-gt,ot=36-gt;u(Z,y(j(gt+mt%ot))),et=n(mt/ot)}u(Z,y(j(et))),ue=q(he,Ve,Ne==ke),he=0,++Ne}}++he,++Ee}return m(Z,"")};V.exports=function(T){var Z,le,x=[],Se=I(f(c(T),w,"."),".");for(Z=0;Z<Se.length;Z++)u(x,S(P,le=Se[Z])?"xn--"+b(le):le);return m(x,".")}},8415:(V,J,e)=>{"use strict";var i=e(7854),d=e(9303),h=e(1340),P=e(4488),w=i.RangeError;V.exports=function(M){var C=h(P(this)),S="",n=d(M);if(n<0||n==1/0)throw w("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(C+=C))1&n&&(S+=C);return S}},6091:(V,J,e)=>{var i=e(6530).PROPER,d=e(7293),h=e(1361);V.exports=function(P){return d(function(){return!!h[P]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[P]()||i&&h[P].name!==P})}},3111:(V,J,e)=>{var i=e(1702),d=e(4488),h=e(1340),P=e(1361),w=i("".replace),M="["+P+"]",C=RegExp("^"+M+M+"*"),S=RegExp(M+M+"*$"),n=function(y){return function(R){var m=h(d(R));return 1&y&&(m=w(m,C,"")),2&y&&(m=w(m,S,"")),m}};V.exports={start:n(1),end:n(2),trim:n(3)}},261:(V,J,e)=>{var i,d,h,P,w=e(7854),M=e(2104),C=e(9974),S=e(614),n=e(2597),y=e(7293),R=e(490),m=e(206),u=e(317),f=e(6833),I=e(2805),c=w.setImmediate,j=w.clearImmediate,q=w.process,b=w.Dispatch,T=w.Function,Z=w.MessageChannel,le=w.String,x=0,Se={};try{i=w.location}catch(Ne){}var Ee=function(Ne){if(n(Se,Ne)){var ze=Se[Ne];delete Se[Ne],ze()}},he=function(Ne){return function(){Ee(Ne)}},ue=function(Ne){Ee(Ne.data)},ke=function(Ne){w.postMessage(le(Ne),i.protocol+"//"+i.host)};c&&j||(c=function(Ne){var ze=m(arguments,1);return Se[++x]=function(){M(S(Ne)?Ne:T(Ne),void 0,ze)},d(x),x},j=function(Ne){delete Se[Ne]},I?d=function(Ne){q.nextTick(he(Ne))}:b&&b.now?d=function(Ne){b.now(he(Ne))}:Z&&!f?(P=(h=new Z).port2,h.port1.onmessage=ue,d=C(P.postMessage,P)):w.addEventListener&&S(w.postMessage)&&!w.importScripts&&i&&"file:"!==i.protocol&&!y(ke)?(d=ke,w.addEventListener("message",ue,!1)):d="onreadystatechange"in u("script")?function(Ne){R.appendChild(u("script")).onreadystatechange=function(){R.removeChild(this),Ee(Ne)}}:function(Ne){setTimeout(he(Ne),0)}),V.exports={set:c,clear:j}},863:(V,J,e)=>{var i=e(1702);V.exports=i(1..valueOf)},1400:(V,J,e)=>{var i=e(9303),d=Math.max,h=Math.min;V.exports=function(P,w){var M=i(P);return M<0?d(M+w,0):h(M,w)}},7067:(V,J,e)=>{var i=e(7854),d=e(9303),h=e(7466),P=i.RangeError;V.exports=function(w){if(void 0===w)return 0;var M=d(w),C=h(M);if(M!==C)throw P("Wrong length or index");return C}},5656:(V,J,e)=>{var i=e(8361),d=e(4488);V.exports=function(h){return i(d(h))}},9303:V=>{var J=Math.ceil,e=Math.floor;V.exports=function(i){var d=+i;return d!=d||0===d?0:(d>0?e:J)(d)}},7466:(V,J,e)=>{var i=e(9303),d=Math.min;V.exports=function(h){return h>0?d(i(h),9007199254740991):0}},7908:(V,J,e)=>{var i=e(7854),d=e(4488),h=i.Object;V.exports=function(P){return h(d(P))}},4590:(V,J,e)=>{var i=e(7854),d=e(3002),h=i.RangeError;V.exports=function(P,w){var M=d(P);if(M%w)throw h("Wrong offset");return M}},3002:(V,J,e)=>{var i=e(7854),d=e(9303),h=i.RangeError;V.exports=function(P){var w=d(P);if(w<0)throw h("The argument can't be less than 0");return w}},7593:(V,J,e)=>{var i=e(7854),d=e(6916),h=e(111),P=e(2190),w=e(8173),M=e(2140),C=e(5112),S=i.TypeError,n=C("toPrimitive");V.exports=function(y,R){if(!h(y)||P(y))return y;var m,u=w(y,n);if(u){if(void 0===R&&(R="default"),m=d(u,y,R),!h(m)||P(m))return m;throw S("Can't convert object to primitive value")}return void 0===R&&(R="number"),M(y,R)}},4948:(V,J,e)=>{var i=e(7593),d=e(2190);V.exports=function(h){var P=i(h,"string");return d(P)?P:P+""}},1694:(V,J,e)=>{var i={};i[e(5112)("toStringTag")]="z",V.exports="[object z]"===String(i)},1340:(V,J,e)=>{var i=e(7854),d=e(648),h=i.String;V.exports=function(P){if("Symbol"===d(P))throw TypeError("Cannot convert a Symbol value to a string");return h(P)}},6330:(V,J,e)=>{var i=e(7854).String;V.exports=function(d){try{return i(d)}catch(h){return"Object"}}},9843:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(6916),P=e(9781),w=e(3832),M=e(260),C=e(3331),S=e(5787),n=e(9114),y=e(8880),R=e(5988),m=e(7466),u=e(7067),f=e(4590),I=e(4948),c=e(2597),j=e(648),q=e(111),b=e(2190),T=e(30),Z=e(7976),le=e(7674),x=e(8006).f,Se=e(7321),Ee=e(2092).forEach,he=e(6340),ue=e(3070),ke=e(1236),Ne=e(9909),ze=e(9587),Ve=Ne.get,et=Ne.set,_e=ue.f,gt=ke.f,mt=Math.round,ot=d.RangeError,at=C.ArrayBuffer,yt=at.prototype,Et=C.DataView,ie=M.NATIVE_ARRAY_BUFFER_VIEWS,dt=M.TYPED_ARRAY_CONSTRUCTOR,Mt=M.TYPED_ARRAY_TAG,Rt=M.TypedArray,je=M.TypedArrayPrototype,xt=M.aTypedArrayConstructor,Wt=M.isTypedArray,Gt="BYTES_PER_ELEMENT",kt="Wrong length",Xe=function(s,v){xt(s);for(var r=0,g=v.length,E=new s(g);g>r;)E[r]=v[r++];return E},zt=function(s,v){_e(s,v,{get:function(){return Ve(this)[v]}})},G=function(s){var v;return Z(yt,s)||"ArrayBuffer"==(v=j(s))||"SharedArrayBuffer"==v},A=function(s,v){return Wt(s)&&!b(v)&&v in s&&R(+v)&&v>=0},t=function(s,v){return v=I(v),A(s,v)?n(2,s[v]):gt(s,v)},l=function(s,v,r){return v=I(v),!(A(s,v)&&q(r)&&c(r,"value"))||c(r,"get")||c(r,"set")||r.configurable||c(r,"writable")&&!r.writable||c(r,"enumerable")&&!r.enumerable?_e(s,v,r):(s[v]=r.value,s)};P?(ie||(ke.f=t,ue.f=l,zt(je,"buffer"),zt(je,"byteOffset"),zt(je,"byteLength"),zt(je,"length")),i({target:"Object",stat:!0,forced:!ie},{getOwnPropertyDescriptor:t,defineProperty:l}),V.exports=function(s,v,r){var g=s.match(/\d+$/)[0]/8,E=s+(r?"Clamped":"")+"Array",te="get"+s,ae="set"+s,Re=d[E],Ce=Re,re=Ce&&Ce.prototype,K={},L=function(ne,ee){_e(ne,ee,{get:function(){return me=ee,(Te=Ve(this)).view[te](me*g+Te.byteOffset,!0);var me,Te},set:function(ce){return Te=ee,ge=ce,Ie=Ve(this),r&&(ge=(ge=mt(ge))<0?0:ge>255?255:255&ge),void Ie.view[ae](Te*g+Ie.byteOffset,ge,!0);var Te,ge,Ie},enumerable:!0})};ie?w&&(Ce=v(function(ne,ee,ce,me){return S(ne,re),ze(q(ee)?G(ee)?void 0!==me?new Re(ee,f(ce,g),me):void 0!==ce?new Re(ee,f(ce,g)):new Re(ee):Wt(ee)?Xe(Ce,ee):h(Se,Ce,ee):new Re(u(ee)),ne,Ce)}),le&&le(Ce,Rt),Ee(x(Re),function(ne){ne in Ce||y(Ce,ne,Re[ne])}),Ce.prototype=re):(Ce=v(function(ne,ee,ce,me){S(ne,re);var Te,ge,Ie,we=0,Pe=0;if(q(ee)){if(!G(ee))return Wt(ee)?Xe(Ce,ee):h(Se,Ce,ee);Te=ee,Pe=f(ce,g);var We=ee.byteLength;if(void 0===me){if(We%g||(ge=We-Pe)<0)throw ot(kt)}else if((ge=m(me)*g)+Pe>We)throw ot(kt);Ie=ge/g}else Ie=u(ee),Te=new at(ge=Ie*g);for(et(ne,{buffer:Te,byteOffset:Pe,byteLength:ge,length:Ie,view:new Et(Te)});we<Ie;)L(ne,we++)}),le&&le(Ce,Rt),re=Ce.prototype=T(je)),re.constructor!==Ce&&y(re,"constructor",Ce),y(re,dt,Ce),Mt&&y(re,Mt,E),K[E]=Ce,i({global:!0,forced:Ce!=Re,sham:!ie},K),Gt in Ce||y(Ce,Gt,g),Gt in re||y(re,Gt,g),he(E)}):V.exports=function(){}},3832:(V,J,e)=>{var i=e(7854),d=e(7293),h=e(7072),P=e(260).NATIVE_ARRAY_BUFFER_VIEWS,w=i.ArrayBuffer,M=i.Int8Array;V.exports=!P||!d(function(){M(1)})||!d(function(){new M(-1)})||!h(function(C){new M,new M(null),new M(1.5),new M(C)},!0)||d(function(){return 1!==new M(new w(2),1,void 0).length})},3074:(V,J,e)=>{var i=e(7745),d=e(6304);V.exports=function(h,P){return i(d(h),P)}},7321:(V,J,e)=>{var i=e(9974),d=e(6916),h=e(9483),P=e(7908),w=e(6244),M=e(8554),C=e(1246),S=e(7659),n=e(260).aTypedArrayConstructor;V.exports=function(y){var R,m,u,f,I,c,j=h(this),q=P(y),b=arguments.length,T=b>1?arguments[1]:void 0,Z=void 0!==T,le=C(q);if(le&&!S(le))for(c=(I=M(q,le)).next,q=[];!(f=d(c,I)).done;)q.push(f.value);for(Z&&b>2&&(T=i(T,arguments[2])),m=w(q),u=new(n(j))(m),R=0;m>R;R++)u[R]=Z?T(q[R],R):q[R];return u}},6304:(V,J,e)=>{var i=e(260),d=e(6707),h=i.TYPED_ARRAY_CONSTRUCTOR,P=i.aTypedArrayConstructor;V.exports=function(w){return P(d(w,w[h]))}},9711:(V,J,e)=>{var i=e(1702),d=0,h=Math.random(),P=i(1..toString);V.exports=function(w){return"Symbol("+(void 0===w?"":w)+")_"+P(++d+h,36)}},3307:(V,J,e)=>{var i=e(133);V.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},6061:(V,J,e)=>{var i=e(5112);J.f=i},5112:(V,J,e)=>{var i=e(7854),d=e(2309),h=e(2597),P=e(9711),w=e(133),M=e(3307),C=d("wks"),S=i.Symbol,n=S&&S.for,y=M?S:S&&S.withoutSetter||P;V.exports=function(R){if(!h(C,R)||!w&&"string"!=typeof C[R]){var m="Symbol."+R;C[R]=w&&h(S,R)?S[R]:M&&n?n(m):y(m)}return C[R]}},1361:V=>{V.exports="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"},8264:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(3331),P=e(6340),w=h.ArrayBuffer;i({global:!0,forced:d.ArrayBuffer!==w},{ArrayBuffer:w}),P("ArrayBuffer")},9575:(V,J,e)=>{"use strict";var i=e(2109),d=e(1702),h=e(7293),P=e(3331),w=e(9670),M=e(1400),C=e(7466),S=e(6707),n=P.ArrayBuffer,y=P.DataView,R=y.prototype,m=d(n.prototype.slice),u=d(R.getUint8),f=d(R.setUint8);i({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:h(function(){return!new n(2).slice(1,void 0).byteLength})},{slice:function(I,c){if(m&&void 0===c)return m(w(this),I);for(var j=w(this).byteLength,q=M(I,j),b=M(void 0===c?j:c,j),T=new(S(this,n))(C(b-q)),Z=new y(this),le=new y(T),x=0;q<b;)f(le,x++,u(Z,q++));return T}})},2222:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(7293),P=e(3157),w=e(111),M=e(7908),C=e(6244),S=e(6135),n=e(5417),y=e(1194),R=e(5112),m=e(7392),u=R("isConcatSpreadable"),f=9007199254740991,I="Maximum allowed index exceeded",c=d.TypeError,j=m>=51||!h(function(){var T=[];return T[u]=!1,T.concat()[0]!==T}),q=y("concat"),b=function(T){if(!w(T))return!1;var Z=T[u];return void 0!==Z?!!Z:P(T)};i({target:"Array",proto:!0,forced:!j||!q},{concat:function(T){var Z,le,x,Se,Ee,he=M(this),ue=n(he,0),ke=0;for(Z=-1,x=arguments.length;Z<x;Z++)if(b(Ee=-1===Z?he:arguments[Z])){if(ke+(Se=C(Ee))>f)throw c(I);for(le=0;le<Se;le++,ke++)le in Ee&&S(ue,ke,Ee[le])}else{if(ke>=f)throw c(I);S(ue,ke++,Ee)}return ue.length=ke,ue}})},3290:(V,J,e)=>{var i=e(2109),d=e(1285),h=e(1223);i({target:"Array",proto:!0},{fill:d}),h("fill")},7327:(V,J,e)=>{"use strict";var i=e(2109),d=e(2092).filter;i({target:"Array",proto:!0,forced:!e(1194)("filter")},{filter:function(h){return d(this,h,arguments.length>1?arguments[1]:void 0)}})},9826:(V,J,e)=>{"use strict";var i=e(2109),d=e(2092).find,h=e(1223),P="find",w=!0;P in[]&&Array(1).find(function(){w=!1}),i({target:"Array",proto:!0,forced:w},{find:function(M){return d(this,M,arguments.length>1?arguments[1]:void 0)}}),h(P)},9554:(V,J,e)=>{"use strict";var i=e(2109),d=e(8533);i({target:"Array",proto:!0,forced:[].forEach!=d},{forEach:d})},1038:(V,J,e)=>{var i=e(2109),d=e(8457);i({target:"Array",stat:!0,forced:!e(7072)(function(h){Array.from(h)})},{from:d})},6699:(V,J,e)=>{"use strict";var i=e(2109),d=e(1318).includes,h=e(1223);i({target:"Array",proto:!0},{includes:function(P){return d(this,P,arguments.length>1?arguments[1]:void 0)}}),h("includes")},2772:(V,J,e)=>{"use strict";var i=e(2109),d=e(1702),h=e(1318).indexOf,P=e(9341),w=d([].indexOf),M=!!w&&1/w([1],1,-0)<0,C=P("indexOf");i({target:"Array",proto:!0,forced:M||!C},{indexOf:function(S){var n=arguments.length>1?arguments[1]:void 0;return M?w(this,S,n)||0:h(this,S,n)}})},9753:(V,J,e)=>{e(2109)({target:"Array",stat:!0},{isArray:e(3157)})},6992:(V,J,e)=>{"use strict";var i=e(5656),d=e(1223),h=e(7497),P=e(9909),w=e(654),M="Array Iterator",C=P.set,S=P.getterFor(M);V.exports=w(Array,"Array",function(n,y){C(this,{type:M,target:i(n),index:0,kind:y})},function(){var n=S(this),y=n.target,R=n.kind,m=n.index++;return!y||m>=y.length?(n.target=void 0,{value:void 0,done:!0}):"keys"==R?{value:m,done:!1}:"values"==R?{value:y[m],done:!1}:{value:[m,y[m]],done:!1}},"values"),h.Arguments=h.Array,d("keys"),d("values"),d("entries")},9600:(V,J,e)=>{"use strict";var i=e(2109),d=e(1702),h=e(8361),P=e(5656),w=e(9341),M=d([].join),C=h!=Object,S=w("join",",");i({target:"Array",proto:!0,forced:C||!S},{join:function(n){return M(P(this),void 0===n?",":n)}})},1249:(V,J,e)=>{"use strict";var i=e(2109),d=e(2092).map;i({target:"Array",proto:!0,forced:!e(1194)("map")},{map:function(h){return d(this,h,arguments.length>1?arguments[1]:void 0)}})},7042:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(3157),P=e(4411),w=e(111),M=e(1400),C=e(6244),S=e(5656),n=e(6135),y=e(5112),R=e(1194),m=e(206),u=R("slice"),f=y("species"),I=d.Array,c=Math.max;i({target:"Array",proto:!0,forced:!u},{slice:function(j,q){var b,T,Z,le=S(this),x=C(le),Se=M(j,x),Ee=M(void 0===q?x:q,x);if(h(le)&&((P(b=le.constructor)&&(b===I||h(b.prototype))||w(b)&&null===(b=b[f]))&&(b=void 0),b===I||void 0===b))return m(le,Se,Ee);for(T=new(void 0===b?I:b)(c(Ee-Se,0)),Z=0;Se<Ee;Se++,Z++)Se in le&&n(T,Z,le[Se]);return T.length=Z,T}})},2707:(V,J,e)=>{"use strict";var i=e(2109),d=e(1702),h=e(9662),P=e(7908),w=e(6244),M=e(1340),C=e(7293),S=e(4362),n=e(9341),y=e(8886),R=e(256),m=e(7392),u=e(8008),f=[],I=d(f.sort),c=d(f.push),j=C(function(){f.sort(void 0)}),q=C(function(){f.sort(null)}),b=n("sort"),T=!C(function(){if(m)return m<70;if(!(y&&y>3)){if(R)return!0;if(u)return u<603;var Z,le,x,Se,Ee="";for(Z=65;Z<76;Z++){switch(le=String.fromCharCode(Z),Z){case 66:case 69:case 70:case 72:x=3;break;case 68:case 71:x=4;break;default:x=2}for(Se=0;Se<47;Se++)f.push({k:le+Se,v:x})}for(f.sort(function(he,ue){return ue.v-he.v}),Se=0;Se<f.length;Se++)le=f[Se].k.charAt(0),Ee.charAt(Ee.length-1)!==le&&(Ee+=le);return"DGBEFHACIJK"!==Ee}});i({target:"Array",proto:!0,forced:j||!q||!b||!T},{sort:function(Z){void 0!==Z&&h(Z);var le=P(this);if(T)return void 0===Z?I(le):I(le,Z);var x,Se,Ee=[],he=w(le);for(Se=0;Se<he;Se++)Se in le&&c(Ee,le[Se]);for(S(Ee,function(ue){return function(ke,Ne){return void 0===Ne?-1:void 0===ke?1:void 0!==ue?+ue(ke,Ne)||0:M(ke)>M(Ne)?1:-1}}(Z)),x=Ee.length,Se=0;Se<x;)le[Se]=Ee[Se++];for(;Se<he;)delete le[Se++];return le}})},561:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(1400),P=e(9303),w=e(6244),M=e(7908),C=e(5417),S=e(6135),n=e(1194)("splice"),y=d.TypeError,R=Math.max,m=Math.min,u=9007199254740991,f="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!n},{splice:function(I,c){var j,q,b,T,Z,le,x=M(this),Se=w(x),Ee=h(I,Se),he=arguments.length;if(0===he?j=q=0:1===he?(j=0,q=Se-Ee):(j=he-2,q=m(R(P(c),0),Se-Ee)),Se+j-q>u)throw y(f);for(b=C(x,q),T=0;T<q;T++)(Z=Ee+T)in x&&S(b,T,x[Z]);if(b.length=q,j<q){for(T=Ee;T<Se-q;T++)le=T+j,(Z=T+q)in x?x[le]=x[Z]:delete x[le];for(T=Se;T>Se-q+j;T--)delete x[T-1]}else if(j>q)for(T=Se-q;T>Ee;T--)le=T+j-1,(Z=T+q-1)in x?x[le]=x[Z]:delete x[le];for(T=0;T<j;T++)x[T+Ee]=arguments[T+2];return x.length=Se-q+j,b}})},6716:(V,J,e)=>{var i=e(2109),d=e(3331);i({global:!0,forced:!e(4019)},{DataView:d.DataView})},3843:(V,J,e)=>{var i=e(2109),d=e(7854),h=e(1702),P=d.Date,w=h(P.prototype.getTime);i({target:"Date",stat:!0},{now:function(){return w(new P)}})},5268:(V,J,e)=>{var i=e(2109),d=e(5573);i({target:"Date",proto:!0,forced:Date.prototype.toISOString!==d},{toISOString:d})},5735:(V,J,e)=>{"use strict";var i=e(2109),d=e(7293),h=e(7908),P=e(7593);i({target:"Date",proto:!0,forced:d(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})},{toJSON:function(w){var M=h(this),C=P(M,"number");return"number"!=typeof C||isFinite(C)?M.toISOString():null}})},3710:(V,J,e)=>{var i=e(1702),d=e(1320),h=Date.prototype,P="Invalid Date",w=i(h.toString),M=i(h.getTime);String(new Date(NaN))!=P&&d(h,"toString",function(){var C=M(this);return C==C?w(this):P})},4812:(V,J,e)=>{e(2109)({target:"Function",proto:!0},{bind:e(7065)})},8309:(V,J,e)=>{var i=e(9781),d=e(6530).EXISTS,h=e(1702),P=e(3070).f,w=Function.prototype,M=h(w.toString),C=/^\s*function ([^ (]*)/,S=h(C.exec);i&&!d&&P(w,"name",{configurable:!0,get:function(){try{return S(C,M(this))[1]}catch(n){return""}}})},1532:(V,J,e)=>{"use strict";e(7710)("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},e(5631))},658:(V,J,e)=>{var i=e(2109),d=Math.log,h=Math.LOG10E;i({target:"Math",stat:!0},{log10:function(P){return d(P)*h}})},9653:(V,J,e)=>{"use strict";var i=e(9781),d=e(7854),h=e(1702),P=e(4705),w=e(1320),M=e(2597),C=e(9587),S=e(7976),n=e(2190),y=e(7593),R=e(7293),m=e(8006).f,u=e(1236).f,f=e(3070).f,I=e(863),c=e(3111).trim,j="Number",q=d.Number,b=q.prototype,T=d.TypeError,Z=h("".slice),le=h("".charCodeAt),x=function(Ne){var ze=y(Ne,"number");return"bigint"==typeof ze?ze:Se(ze)},Se=function(Ne){var ze,Ve,et,_e,gt,mt,ot,at,yt=y(Ne,"number");if(n(yt))throw T("Cannot convert a Symbol value to a number");if("string"==typeof yt&&yt.length>2)if(yt=c(yt),43===(ze=le(yt,0))||45===ze){if(88===(Ve=le(yt,2))||120===Ve)return NaN}else if(48===ze){switch(le(yt,1)){case 66:case 98:et=2,_e=49;break;case 79:case 111:et=8,_e=55;break;default:return+yt}for(mt=(gt=Z(yt,2)).length,ot=0;ot<mt;ot++)if((at=le(gt,ot))<48||at>_e)return NaN;return parseInt(gt,et)}return+yt};if(P(j,!q(" 0o1")||!q("0b1")||q("+0x1"))){for(var Ee,he=function(Ne){var ze=arguments.length<1?0:q(x(Ne)),Ve=this;return S(b,Ve)&&R(function(){I(Ve)})?C(Object(ze),Ve,he):ze},ue=i?m(q):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),ke=0;ue.length>ke;ke++)M(q,Ee=ue[ke])&&!M(he,Ee)&&f(he,Ee,u(q,Ee));he.prototype=b,b.constructor=he,w(d,j,he)}},3161:(V,J,e)=>{e(2109)({target:"Number",stat:!0},{isInteger:e(5988)})},4363:(V,J,e)=>{e(2109)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},9601:(V,J,e)=>{var i=e(2109),d=e(1574);i({target:"Object",stat:!0,forced:Object.assign!==d},{assign:d})},8011:(V,J,e)=>{e(2109)({target:"Object",stat:!0,sham:!e(9781)},{create:e(30)})},9070:(V,J,e)=>{var i=e(2109),d=e(9781);i({target:"Object",stat:!0,forced:!d,sham:!d},{defineProperty:e(3070).f})},9720:(V,J,e)=>{var i=e(2109),d=e(4699).entries;i({target:"Object",stat:!0},{entries:function(h){return d(h)}})},5003:(V,J,e)=>{var i=e(2109),d=e(7293),h=e(5656),P=e(1236).f,w=e(9781),M=d(function(){P(1)});i({target:"Object",stat:!0,forced:!w||M,sham:!w},{getOwnPropertyDescriptor:function(C,S){return P(h(C),S)}})},489:(V,J,e)=>{var i=e(2109),d=e(7293),h=e(7908),P=e(9518),w=e(8544);i({target:"Object",stat:!0,forced:d(function(){P(1)}),sham:!w},{getPrototypeOf:function(M){return P(h(M))}})},7941:(V,J,e)=>{var i=e(2109),d=e(7908),h=e(1956);i({target:"Object",stat:!0,forced:e(7293)(function(){h(1)})},{keys:function(P){return h(d(P))}})},8304:(V,J,e)=>{e(2109)({target:"Object",stat:!0},{setPrototypeOf:e(7674)})},1539:(V,J,e)=>{var i=e(1694),d=e(1320),h=e(288);i||d(Object.prototype,"toString",h,{unsafe:!0})},2479:(V,J,e)=>{var i=e(2109),d=e(4699).values;i({target:"Object",stat:!0},{values:function(h){return d(h)}})},1058:(V,J,e)=>{var i=e(2109),d=e(3009);i({global:!0,forced:parseInt!=d},{parseInt:d})},8674:(V,J,e)=>{"use strict";var i,d,h,P,w=e(2109),M=e(1913),C=e(7854),S=e(5005),n=e(6916),y=e(3366),R=e(1320),m=e(2248),u=e(7674),f=e(8003),I=e(6340),c=e(9662),j=e(614),q=e(111),b=e(5787),T=e(2788),Z=e(408),le=e(7072),x=e(6707),Se=e(261).set,Ee=e(5948),he=e(9478),ue=e(842),ke=e(8523),Ne=e(2534),ze=e(9909),Ve=e(4705),et=e(5112),_e=e(7871),gt=e(2805),mt=e(7392),ot=et("species"),at="Promise",yt=ze.get,Et=ze.set,ie=ze.getterFor(at),dt=y&&y.prototype,Mt=y,Rt=dt,je=C.TypeError,xt=C.document,Wt=C.process,Gt=ke.f,kt=Gt,Xe=!!(xt&&xt.createEvent&&C.dispatchEvent),zt=j(C.PromiseRejectionEvent),G="unhandledrejection",A=!1,t=Ve(at,function(){var re=T(Mt),K=re!==String(Mt);if(!K&&66===mt||M&&!Rt.finally)return!0;if(mt>=51&&/native code/.test(re))return!1;var L=new Mt(function(ee){ee(1)}),ne=function(ee){ee(function(){},function(){})};return(L.constructor={})[ot]=ne,!(A=L.then(function(){})instanceof ne)||!K&&_e&&!zt}),l=t||!le(function(re){Mt.all(re).catch(function(){})}),s=function(re){var K;return!(!q(re)||!j(K=re.then))&&K},v=function(re,K){if(!re.notified){re.notified=!0;var L=re.reactions;Ee(function(){for(var ne=re.value,ee=1==re.state,ce=0;L.length>ce;){var me,Te,ge,Ie=L[ce++],we=ee?Ie.ok:Ie.fail,Pe=Ie.resolve,We=Ie.reject,Je=Ie.domain;try{we?(ee||(2===re.rejection&&te(re),re.rejection=1),!0===we?me=ne:(Je&&Je.enter(),me=we(ne),Je&&(Je.exit(),ge=!0)),me===Ie.promise?We(je("Promise-chain cycle")):(Te=s(me))?n(Te,me,Pe,We):Pe(me)):We(ne)}catch(tt){Je&&!ge&&Je.exit(),We(tt)}}re.reactions=[],re.notified=!1,K&&!re.rejection&&g(re)})}},r=function(re,K,L){var ne,ee;Xe?((ne=xt.createEvent("Event")).promise=K,ne.reason=L,ne.initEvent(re,!1,!0),C.dispatchEvent(ne)):ne={promise:K,reason:L},!zt&&(ee=C["on"+re])?ee(ne):re===G&&ue("Unhandled promise rejection",L)},g=function(re){n(Se,C,function(){var K,L=re.facade,ne=re.value;if(E(re)&&(K=Ne(function(){gt?Wt.emit("unhandledRejection",ne,L):r(G,L,ne)}),re.rejection=gt||E(re)?2:1,K.error))throw K.value})},E=function(re){return 1!==re.rejection&&!re.parent},te=function(re){n(Se,C,function(){var K=re.facade;gt?Wt.emit("rejectionHandled",K):r("rejectionhandled",K,re.value)})},ae=function(re,K,L){return function(ne){re(K,ne,L)}},Re=function(re,K,L){re.done||(re.done=!0,L&&(re=L),re.value=K,re.state=2,v(re,!0))},Ce=function(re,K,L){if(!re.done){re.done=!0,L&&(re=L);try{if(re.facade===K)throw je("Promise can't be resolved itself");var ne=s(K);ne?Ee(function(){var ee={done:!1};try{n(ne,K,ae(Ce,ee,re),ae(Re,ee,re))}catch(ce){Re(ee,ce,re)}}):(re.value=K,re.state=1,v(re,!1))}catch(ee){Re({done:!1},ee,re)}}};if(t&&(Rt=(Mt=function(re){b(this,Rt),c(re),n(i,this);var K=yt(this);try{re(ae(Ce,K),ae(Re,K))}catch(L){Re(K,L)}}).prototype,(i=function(re){Et(this,{type:at,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=m(Rt,{then:function(re,K){var L=ie(this),ne=L.reactions,ee=Gt(x(this,Mt));return ee.ok=!j(re)||re,ee.fail=j(K)&&K,ee.domain=gt?Wt.domain:void 0,L.parent=!0,ne[ne.length]=ee,0!=L.state&&v(L,!1),ee.promise},catch:function(re){return this.then(void 0,re)}}),d=function(){var re=new i,K=yt(re);this.promise=re,this.resolve=ae(Ce,K),this.reject=ae(Re,K)},ke.f=Gt=function(re){return re===Mt||re===h?new d(re):kt(re)},!M&&j(y)&&dt!==Object.prototype)){P=dt.then,A||(R(dt,"then",function(re,K){var L=this;return new Mt(function(ne,ee){n(P,L,ne,ee)}).then(re,K)},{unsafe:!0}),R(dt,"catch",Rt.catch,{unsafe:!0}));try{delete dt.constructor}catch(re){}u&&u(dt,Rt)}w({global:!0,wrap:!0,forced:t},{Promise:Mt}),f(Mt,at,!1,!0),I(at),h=S(at),w({target:at,stat:!0,forced:t},{reject:function(re){var K=Gt(this);return n(K.reject,void 0,re),K.promise}}),w({target:at,stat:!0,forced:M||t},{resolve:function(re){return he(M&&this===h?Mt:this,re)}}),w({target:at,stat:!0,forced:l},{all:function(re){var K=this,L=Gt(K),ne=L.resolve,ee=L.reject,ce=Ne(function(){var me=c(K.resolve),Te=[],ge=0,Ie=1;Z(re,function(we){var Pe=ge++,We=!1;Ie++,n(me,K,we).then(function(Je){We||(We=!0,Te[Pe]=Je,--Ie||ne(Te))},ee)}),--Ie||ne(Te)});return ce.error&&ee(ce.value),L.promise},race:function(re){var K=this,L=Gt(K),ne=L.reject,ee=Ne(function(){var ce=c(K.resolve);Z(re,function(me){n(ce,K,me).then(L.resolve,ne)})});return ee.error&&ne(ee.value),L.promise}})},2419:(V,J,e)=>{var i=e(2109),d=e(5005),h=e(2104),P=e(7065),w=e(9483),M=e(9670),C=e(111),S=e(30),n=e(7293),y=d("Reflect","construct"),R=Object.prototype,m=[].push,u=n(function(){function c(){}return!(y(function(){},[],c)instanceof c)}),f=!n(function(){y(function(){})}),I=u||f;i({target:"Reflect",stat:!0,forced:I,sham:I},{construct:function(c,j){w(c),M(j);var q=arguments.length<3?c:w(arguments[2]);if(f&&!u)return y(c,j,q);if(c==q){switch(j.length){case 0:return new c;case 1:return new c(j[0]);case 2:return new c(j[0],j[1]);case 3:return new c(j[0],j[1],j[2]);case 4:return new c(j[0],j[1],j[2],j[3])}var b=[null];return h(m,b,j),new(h(P,c,b))}var T=q.prototype,Z=S(C(T)?T:R),le=h(c,Z,j);return C(le)?le:Z}})},4819:(V,J,e)=>{var i=e(2109),d=e(6916),h=e(111),P=e(9670),w=e(5032),M=e(1236),C=e(9518);i({target:"Reflect",stat:!0},{get:function S(n,y){var R,m,u=arguments.length<3?n:arguments[2];return P(n)===u?n[y]:(R=M.f(n,y))?w(R)?R.value:void 0===R.get?void 0:d(R.get,u):h(m=C(n))?S(m,y,u):void 0}})},4603:(V,J,e)=>{var i=e(9781),d=e(7854),h=e(1702),P=e(4705),w=e(9587),M=e(8880),C=e(3070).f,S=e(8006).f,n=e(7976),y=e(7850),R=e(1340),m=e(7066),u=e(2999),f=e(1320),I=e(7293),c=e(2597),j=e(9909).enforce,q=e(6340),b=e(5112),T=e(9441),Z=e(7168),le=b("match"),x=d.RegExp,Se=x.prototype,Ee=d.SyntaxError,he=h(m),ue=h(Se.exec),ke=h("".charAt),Ne=h("".replace),ze=h("".indexOf),Ve=h("".slice),et=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,_e=/a/g,gt=/a/g,mt=new x(_e)!==_e,ot=u.UNSUPPORTED_Y;if(P("RegExp",i&&(!mt||ot||T||Z||I(function(){return gt[le]=!1,x(_e)!=_e||x(gt)==gt||"/a/i"!=x(_e,"i")})))){for(var at=function(dt,Mt){var Rt,je,xt,Wt,Gt,kt,Xe=n(Se,this),zt=y(dt),G=void 0===Mt,A=[],t=dt;if(!Xe&&zt&&G&&dt.constructor===at)return dt;if((zt||n(Se,dt))&&(dt=dt.source,G&&(Mt="flags"in t?t.flags:he(t))),dt=void 0===dt?"":R(dt),Mt=void 0===Mt?"":R(Mt),t=dt,T&&"dotAll"in _e&&(je=!!Mt&&ze(Mt,"s")>-1)&&(Mt=Ne(Mt,/s/g,"")),Rt=Mt,ot&&"sticky"in _e&&(xt=!!Mt&&ze(Mt,"y")>-1)&&(Mt=Ne(Mt,/y/g,"")),Z&&(dt=(Wt=function(l){for(var s,v=l.length,r=0,g="",E=[],te={},ae=!1,Re=!1,Ce=0,re="";r<=v;r++){if("\\"===(s=ke(l,r)))s+=ke(l,++r);else if("]"===s)ae=!1;else if(!ae)switch(!0){case"["===s:ae=!0;break;case"("===s:ue(et,Ve(l,r+1))&&(r+=2,Re=!0),g+=s,Ce++;continue;case">"===s&&Re:if(""===re||c(te,re))throw new Ee("Invalid capture group name");te[re]=!0,E[E.length]=[re,Ce],Re=!1,re="";continue}Re?re+=s:g+=s}return[g,E]}(dt))[0],A=Wt[1]),Gt=w(x(dt,Mt),Xe?this:Se,at),(je||xt||A.length)&&(kt=j(Gt),je&&(kt.dotAll=!0,kt.raw=at(function(l){for(var s,v=l.length,r=0,g="",E=!1;r<=v;r++)"\\"!==(s=ke(l,r))?E||"."!==s?("["===s?E=!0:"]"===s&&(E=!1),g+=s):g+="[\\s\\S]":g+=s+ke(l,++r);return g}(dt),Rt)),xt&&(kt.sticky=!0),A.length&&(kt.groups=A)),dt!==t)try{M(Gt,"source",""===t?"(?:)":t)}catch(l){}return Gt},yt=function(dt){dt in at||C(at,dt,{configurable:!0,get:function(){return x[dt]},set:function(Mt){x[dt]=Mt}})},Et=S(x),ie=0;Et.length>ie;)yt(Et[ie++]);Se.constructor=at,at.prototype=Se,f(d,"RegExp",at)}q("RegExp")},4916:(V,J,e)=>{"use strict";var i=e(2109),d=e(2261);i({target:"RegExp",proto:!0,forced:/./.exec!==d},{exec:d})},9714:(V,J,e)=>{"use strict";var i=e(1702),d=e(6530).PROPER,h=e(1320),P=e(9670),w=e(7976),M=e(1340),C=e(7293),S=e(7066),n="toString",y=RegExp.prototype,R=y.toString,m=i(S);(C(function(){return"/a/b"!=R.call({source:"a",flags:"b"})})||d&&R.name!=n)&&h(RegExp.prototype,n,function(){var I=P(this),c=M(I.source),j=I.flags;return"/"+c+"/"+M(void 0===j&&w(y,I)&&!("flags"in y)?m(I):j)},{unsafe:!0})},189:(V,J,e)=>{"use strict";e(7710)("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},e(5631))},2023:(V,J,e)=>{"use strict";var i=e(2109),d=e(1702),h=e(3929),P=e(4488),w=e(1340),M=e(4964),C=d("".indexOf);i({target:"String",proto:!0,forced:!M("includes")},{includes:function(S){return!!~C(w(P(this)),w(h(S)),arguments.length>1?arguments[1]:void 0)}})},8783:(V,J,e)=>{"use strict";var i=e(8710).charAt,d=e(1340),h=e(9909),P=e(654),w="String Iterator",M=h.set,C=h.getterFor(w);P(String,"String",function(S){M(this,{type:w,string:d(S),index:0})},function(){var S,n=C(this),y=n.string,R=n.index;return R>=y.length?{value:void 0,done:!0}:(S=i(y,R),n.index+=S.length,{value:S,done:!1})})},4723:(V,J,e)=>{"use strict";var i=e(6916),d=e(7007),h=e(9670),P=e(7466),w=e(1340),M=e(4488),C=e(8173),S=e(1530),n=e(7651);d("match",function(y,R,m){return[function(u){var f=M(this),I=null==u?void 0:C(u,y);return I?i(I,u,f):new RegExp(u)[y](w(f))},function(u){var f=h(this),I=w(u),c=m(R,f,I);if(c.done)return c.value;if(!f.global)return n(f,I);var j=f.unicode;f.lastIndex=0;for(var q,b=[],T=0;null!==(q=n(f,I));){var Z=w(q[0]);b[T]=Z,""===Z&&(f.lastIndex=S(I,P(f.lastIndex),j)),T++}return 0===T?null:b}]})},5306:(V,J,e)=>{"use strict";var i=e(2104),d=e(6916),h=e(1702),P=e(7007),w=e(7293),M=e(9670),C=e(614),S=e(9303),n=e(7466),y=e(1340),R=e(4488),m=e(1530),u=e(8173),f=e(647),I=e(7651),c=e(5112)("replace"),j=Math.max,q=Math.min,b=h([].concat),T=h([].push),Z=h("".indexOf),le=h("".slice),x="$0"==="a".replace(/./,"$0"),Se=!!/./[c]&&""===/./[c]("a","$0");P("replace",function(Ee,he,ue){var ke=Se?"$":"$0";return[function(Ne,ze){var Ve=R(this),et=null==Ne?void 0:u(Ne,c);return et?d(et,Ne,Ve,ze):d(he,y(Ve),Ne,ze)},function(Ne,ze){var Ve=M(this),et=y(Ne);if("string"==typeof ze&&-1===Z(ze,ke)&&-1===Z(ze,"$<")){var _e=ue(he,Ve,et,ze);if(_e.done)return _e.value}var gt=C(ze);gt||(ze=y(ze));var mt=Ve.global;if(mt){var ot=Ve.unicode;Ve.lastIndex=0}for(var at=[];;){var yt=I(Ve,et);if(null===yt||(T(at,yt),!mt))break;""===y(yt[0])&&(Ve.lastIndex=m(et,n(Ve.lastIndex),ot))}for(var Et,ie="",dt=0,Mt=0;Mt<at.length;Mt++){for(var Rt=y((yt=at[Mt])[0]),je=j(q(S(yt.index),et.length),0),xt=[],Wt=1;Wt<yt.length;Wt++)T(xt,void 0===(Et=yt[Wt])?Et:String(Et));var Gt=yt.groups;if(gt){var kt=b([Rt],xt,je,et);void 0!==Gt&&T(kt,Gt);var Xe=y(i(ze,void 0,kt))}else Xe=f(Rt,et,je,xt,Gt,ze);je>=dt&&(ie+=le(et,dt,je)+Xe,dt=je+Rt.length)}return ie+le(et,dt)}]},!!w(function(){var Ee=/./;return Ee.exec=function(){var he=[];return he.groups={a:"7"},he},"7"!=="".replace(Ee,"$<a>")})||!x||Se)},4765:(V,J,e)=>{"use strict";var i=e(6916),d=e(7007),h=e(9670),P=e(4488),w=e(1150),M=e(1340),C=e(8173),S=e(7651);d("search",function(n,y,R){return[function(m){var u=P(this),f=null==m?void 0:C(m,n);return f?i(f,m,u):new RegExp(m)[n](M(u))},function(m){var u=h(this),f=M(m),I=R(y,u,f);if(I.done)return I.value;var c=u.lastIndex;w(c,0)||(u.lastIndex=0);var j=S(u,f);return w(u.lastIndex,c)||(u.lastIndex=c),null===j?-1:j.index}]})},3123:(V,J,e)=>{"use strict";var i=e(2104),d=e(6916),h=e(1702),P=e(7007),w=e(7850),M=e(9670),C=e(4488),S=e(6707),n=e(1530),y=e(7466),R=e(1340),m=e(8173),u=e(206),f=e(7651),I=e(2261),c=e(2999),j=e(7293),q=c.UNSUPPORTED_Y,b=4294967295,T=Math.min,Z=[].push,le=h(/./.exec),x=h(Z),Se=h("".slice),Ee=!j(function(){var he=/(?:)/,ue=he.exec;he.exec=function(){return ue.apply(this,arguments)};var ke="ab".split(he);return 2!==ke.length||"a"!==ke[0]||"b"!==ke[1]});P("split",function(he,ue,ke){var Ne;return Ne="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(ze,Ve){var et=R(C(this)),_e=void 0===Ve?b:Ve>>>0;if(0===_e)return[];if(void 0===ze)return[et];if(!w(ze))return d(ue,et,ze,_e);for(var gt,mt,ot,at=[],Et=0,ie=new RegExp(ze.source,(ze.ignoreCase?"i":"")+(ze.multiline?"m":"")+(ze.unicode?"u":"")+(ze.sticky?"y":"")+"g");(gt=d(I,ie,et))&&!((mt=ie.lastIndex)>Et&&(x(at,Se(et,Et,gt.index)),gt.length>1&&gt.index<et.length&&i(Z,at,u(gt,1)),ot=gt[0].length,Et=mt,at.length>=_e));)ie.lastIndex===gt.index&&ie.lastIndex++;return Et===et.length?!ot&&le(ie,"")||x(at,""):x(at,Se(et,Et)),at.length>_e?u(at,0,_e):at}:"0".split(void 0,0).length?function(ze,Ve){return void 0===ze&&0===Ve?[]:d(ue,this,ze,Ve)}:ue,[function(ze,Ve){var et=C(this),_e=null==ze?void 0:m(ze,he);return _e?d(_e,ze,et,Ve):d(Ne,R(et),ze,Ve)},function(ze,Ve){var et=M(this),_e=R(ze),gt=ke(Ne,et,_e,Ve,Ne!==ue);if(gt.done)return gt.value;var mt=S(et,RegExp),ot=et.unicode,yt=new mt(q?"^(?:"+et.source+")":et,(et.ignoreCase?"i":"")+(et.multiline?"m":"")+(et.unicode?"u":"")+(q?"g":"y")),Et=void 0===Ve?b:Ve>>>0;if(0===Et)return[];if(0===_e.length)return null===f(yt,_e)?[_e]:[];for(var ie=0,dt=0,Mt=[];dt<_e.length;){yt.lastIndex=q?0:dt;var Rt,je=f(yt,q?Se(_e,dt):_e);if(null===je||(Rt=T(y(yt.lastIndex+(q?dt:0)),_e.length))===ie)dt=n(_e,dt,ot);else{if(x(Mt,Se(_e,ie,dt)),Mt.length===Et)return Mt;for(var xt=1;xt<=je.length-1;xt++)if(x(Mt,je[xt]),Mt.length===Et)return Mt;dt=ie=Rt}}return x(Mt,Se(_e,ie)),Mt}]},!Ee,q)},6755:(V,J,e)=>{"use strict";var i,d=e(2109),h=e(1702),P=e(1236).f,w=e(7466),M=e(1340),C=e(3929),S=e(4488),n=e(4964),y=e(1913),R=h("".startsWith),m=h("".slice),u=Math.min,f=n("startsWith");d({target:"String",proto:!0,forced:!(!y&&!f&&(i=P(String.prototype,"startsWith"),i&&!i.writable)||f)},{startsWith:function(I){var c=M(S(this));C(I);var j=w(u(arguments.length>1?arguments[1]:void 0,c.length)),q=M(I);return R?R(c,q,j):m(c,j,j+q.length)===q}})},3210:(V,J,e)=>{"use strict";var i=e(2109),d=e(3111).trim;i({target:"String",proto:!0,forced:e(6091)("trim")},{trim:function(){return d(this)}})},1817:(V,J,e)=>{"use strict";var i=e(2109),d=e(9781),h=e(7854),P=e(1702),w=e(2597),M=e(614),C=e(7976),S=e(1340),n=e(3070).f,y=e(9920),R=h.Symbol,m=R&&R.prototype;if(d&&M(R)&&(!("description"in m)||void 0!==R().description)){var u={},f=function(){var Z=arguments.length<1||void 0===arguments[0]?void 0:S(arguments[0]),le=C(m,this)?new R(Z):void 0===Z?R():R(Z);return""===Z&&(u[le]=!0),le};y(f,R),f.prototype=m,m.constructor=f;var I="Symbol(test)"==String(R("test")),c=P(m.toString),j=P(m.valueOf),q=/^Symbol\((.*)\)[^)]+$/,b=P("".replace),T=P("".slice);n(m,"description",{configurable:!0,get:function(){var Z=j(this),le=c(Z);if(w(u,Z))return"";var x=I?T(le,7,-1):b(le,q,"$1");return""===x?void 0:x}}),i({global:!0,forced:!0},{Symbol:f})}},2165:(V,J,e)=>{e(7235)("iterator")},2526:(V,J,e)=>{"use strict";var i=e(2109),d=e(7854),h=e(5005),P=e(2104),w=e(6916),M=e(1702),C=e(1913),S=e(9781),n=e(133),y=e(7293),R=e(2597),m=e(3157),u=e(614),f=e(111),I=e(7976),c=e(2190),j=e(9670),q=e(7908),b=e(5656),T=e(4948),Z=e(1340),le=e(9114),x=e(30),Se=e(1956),Ee=e(8006),he=e(1156),ue=e(5181),ke=e(1236),Ne=e(3070),ze=e(5296),Ve=e(206),et=e(1320),_e=e(2309),gt=e(6200),mt=e(3501),ot=e(9711),at=e(5112),yt=e(6061),Et=e(7235),ie=e(8003),dt=e(9909),Mt=e(2092).forEach,Rt=gt("hidden"),je="Symbol",xt=at("toPrimitive"),Wt=dt.set,Gt=dt.getterFor(je),kt=Object.prototype,Xe=d.Symbol,zt=Xe&&Xe.prototype,G=d.TypeError,A=d.QObject,t=h("JSON","stringify"),l=ke.f,s=Ne.f,v=he.f,r=ze.f,g=M([].push),E=_e("symbols"),te=_e("op-symbols"),ae=_e("string-to-symbol-registry"),Re=_e("symbol-to-string-registry"),Ce=_e("wks"),re=!A||!A.prototype||!A.prototype.findChild,K=S&&y(function(){return 7!=x(s({},"a",{get:function(){return s(this,"a",{value:7}).a}})).a})?function(we,Pe,We){var Je=l(kt,Pe);Je&&delete kt[Pe],s(we,Pe,We),Je&&we!==kt&&s(kt,Pe,Je)}:s,L=function(we,Pe){var We=E[we]=x(zt);return Wt(We,{type:je,tag:we,description:Pe}),S||(We.description=Pe),We},ne=function(we,Pe,We){we===kt&&ne(te,Pe,We),j(we);var Je=T(Pe);return j(We),R(E,Je)?(We.enumerable?(R(we,Rt)&&we[Rt][Je]&&(we[Rt][Je]=!1),We=x(We,{enumerable:le(0,!1)})):(R(we,Rt)||s(we,Rt,le(1,{})),we[Rt][Je]=!0),K(we,Je,We)):s(we,Je,We)},ee=function(we,Pe){j(we);var We=b(Pe),Je=Se(We).concat(ge(We));return Mt(Je,function(tt){S&&!w(ce,We,tt)||ne(we,tt,We[tt])}),we},ce=function(we){var Pe=T(we),We=w(r,this,Pe);return!(this===kt&&R(E,Pe)&&!R(te,Pe))&&(!(We||!R(this,Pe)||!R(E,Pe)||R(this,Rt)&&this[Rt][Pe])||We)},me=function(we,Pe){var We=b(we),Je=T(Pe);if(We!==kt||!R(E,Je)||R(te,Je)){var tt=l(We,Je);return!tt||!R(E,Je)||R(We,Rt)&&We[Rt][Je]||(tt.enumerable=!0),tt}},Te=function(we){var Pe=v(b(we)),We=[];return Mt(Pe,function(Je){R(E,Je)||R(mt,Je)||g(We,Je)}),We},ge=function(we){var Pe=we===kt,We=v(Pe?te:b(we)),Je=[];return Mt(We,function(tt){!R(E,tt)||Pe&&!R(kt,tt)||g(Je,E[tt])}),Je};if(n||(Xe=function(){if(I(zt,this))throw G("Symbol is not a constructor");var we=arguments.length&&void 0!==arguments[0]?Z(arguments[0]):void 0,Pe=ot(we),We=function(Je){this===kt&&w(We,te,Je),R(this,Rt)&&R(this[Rt],Pe)&&(this[Rt][Pe]=!1),K(this,Pe,le(1,Je))};return S&&re&&K(kt,Pe,{configurable:!0,set:We}),L(Pe,we)},et(zt=Xe.prototype,"toString",function(){return Gt(this).tag}),et(Xe,"withoutSetter",function(we){return L(ot(we),we)}),ze.f=ce,Ne.f=ne,ke.f=me,Ee.f=he.f=Te,ue.f=ge,yt.f=function(we){return L(at(we),we)},S&&(s(zt,"description",{configurable:!0,get:function(){return Gt(this).description}}),C||et(kt,"propertyIsEnumerable",ce,{unsafe:!0}))),i({global:!0,wrap:!0,forced:!n,sham:!n},{Symbol:Xe}),Mt(Se(Ce),function(we){Et(we)}),i({target:je,stat:!0,forced:!n},{for:function(we){var Pe=Z(we);if(R(ae,Pe))return ae[Pe];var We=Xe(Pe);return ae[Pe]=We,Re[We]=Pe,We},keyFor:function(we){if(!c(we))throw G(we+" is not a symbol");if(R(Re,we))return Re[we]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),i({target:"Object",stat:!0,forced:!n,sham:!S},{create:function(we,Pe){return void 0===Pe?x(we):ee(x(we),Pe)},defineProperty:ne,defineProperties:ee,getOwnPropertyDescriptor:me}),i({target:"Object",stat:!0,forced:!n},{getOwnPropertyNames:Te,getOwnPropertySymbols:ge}),i({target:"Object",stat:!0,forced:y(function(){ue.f(1)})},{getOwnPropertySymbols:function(we){return ue.f(q(we))}}),t&&i({target:"JSON",stat:!0,forced:!n||y(function(){var we=Xe();return"[null]"!=t([we])||"{}"!=t({a:we})||"{}"!=t(Object(we))})},{stringify:function(we,Pe,We){var Je=Ve(arguments),tt=Pe;if((f(Pe)||void 0!==we)&&!c(we))return m(Pe)||(Pe=function(Ft,si){if(u(tt)&&(si=w(tt,this,Ft,si)),!c(si))return si}),Je[1]=Pe,P(t,null,Je)}}),!zt[xt]){var Ie=zt.valueOf;et(zt,xt,function(we){return w(Ie,this)})}ie(Xe,je),mt[Rt]=!0},2990:(V,J,e)=>{"use strict";var i=e(1702),d=e(260),h=i(e(1048)),P=d.aTypedArray;(0,d.exportTypedArrayMethod)("copyWithin",function(w,M){return h(P(this),w,M,arguments.length>2?arguments[2]:void 0)})},8927:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).every,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("every",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},3105:(V,J,e)=>{"use strict";var i=e(260),d=e(6916),h=e(1285),P=i.aTypedArray;(0,i.exportTypedArrayMethod)("fill",function(w){var M=arguments.length;return d(h,P(this),w,M>1?arguments[1]:void 0,M>2?arguments[2]:void 0)})},5035:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).filter,h=e(3074),P=i.aTypedArray;(0,i.exportTypedArrayMethod)("filter",function(w){var M=d(P(this),w,arguments.length>1?arguments[1]:void 0);return h(this,M)})},7174:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).findIndex,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("findIndex",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},4345:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).find,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("find",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},2846:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).forEach,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("forEach",function(P){d(h(this),P,arguments.length>1?arguments[1]:void 0)})},4731:(V,J,e)=>{"use strict";var i=e(260),d=e(1318).includes,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("includes",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},7209:(V,J,e)=>{"use strict";var i=e(260),d=e(1318).indexOf,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("indexOf",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},6319:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=e(6530).PROPER,P=e(260),w=e(6992),M=e(5112)("iterator"),C=i.Uint8Array,S=d(w.values),n=d(w.keys),y=d(w.entries),R=P.aTypedArray,m=P.exportTypedArrayMethod,u=C&&C.prototype[M],f=!!u&&"values"===u.name,I=function(){return S(R(this))};m("entries",function(){return y(R(this))}),m("keys",function(){return n(R(this))}),m("values",I,h&&!f),m(M,I,h&&!f)},8867:(V,J,e)=>{"use strict";var i=e(260),d=e(1702),h=i.aTypedArray,P=i.exportTypedArrayMethod,w=d([].join);P("join",function(M){return w(h(this),M)})},7789:(V,J,e)=>{"use strict";var i=e(260),d=e(2104),h=e(6583),P=i.aTypedArray;(0,i.exportTypedArrayMethod)("lastIndexOf",function(w){var M=arguments.length;return d(h,P(this),M>1?[w,arguments[1]]:[w])})},3739:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).map,h=e(6304),P=i.aTypedArray;(0,i.exportTypedArrayMethod)("map",function(w){return d(P(this),w,arguments.length>1?arguments[1]:void 0,function(M,C){return new(h(M))(C)})})},4483:(V,J,e)=>{"use strict";var i=e(260),d=e(3671).right,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduceRight",function(P){var w=arguments.length;return d(h(this),P,w,w>1?arguments[1]:void 0)})},9368:(V,J,e)=>{"use strict";var i=e(260),d=e(3671).left,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("reduce",function(P){var w=arguments.length;return d(h(this),P,w,w>1?arguments[1]:void 0)})},2056:(V,J,e)=>{"use strict";var i=e(260),d=i.aTypedArray,P=Math.floor;(0,i.exportTypedArrayMethod)("reverse",function(){for(var w,M=this,C=d(M).length,S=P(C/2),n=0;n<S;)w=M[n],M[n++]=M[--C],M[C]=w;return M})},3462:(V,J,e)=>{"use strict";var i=e(7854),d=e(260),h=e(6244),P=e(4590),w=e(7908),M=e(7293),C=i.RangeError,S=d.aTypedArray;(0,d.exportTypedArrayMethod)("set",function(n){S(this);var y=P(arguments.length>1?arguments[1]:void 0,1),R=this.length,m=w(n),u=h(m),f=0;if(u+y>R)throw C("Wrong length");for(;f<u;)this[y+f]=m[f++]},M(function(){new Int8Array(1).set({})}))},678:(V,J,e)=>{"use strict";var i=e(260),d=e(6304),h=e(7293),P=e(206),w=i.aTypedArray;(0,i.exportTypedArrayMethod)("slice",function(M,C){for(var S=P(w(this),M,C),n=d(this),y=0,R=S.length,m=new n(R);R>y;)m[y]=S[y++];return m},h(function(){new Int8Array(1).slice()}))},7462:(V,J,e)=>{"use strict";var i=e(260),d=e(2092).some,h=i.aTypedArray;(0,i.exportTypedArrayMethod)("some",function(P){return d(h(this),P,arguments.length>1?arguments[1]:void 0)})},3824:(V,J,e)=>{"use strict";var i=e(7854),d=e(1702),h=e(7293),P=e(9662),w=e(4362),M=e(260),C=e(8886),S=e(256),n=e(7392),y=e(8008),R=i.Array,m=M.aTypedArray,u=M.exportTypedArrayMethod,f=i.Uint16Array,I=f&&d(f.prototype.sort),c=!(!I||h(function(){I(new f(2),null)})&&h(function(){I(new f(2),{})})),j=!!I&&!h(function(){if(n)return n<74;if(C)return C<67;if(S)return!0;if(y)return y<602;var q,b,T=new f(516),Z=R(516);for(q=0;q<516;q++)b=q%4,T[q]=515-q,Z[q]=q-2*b+3;for(I(T,function(le,x){return(le/4|0)-(x/4|0)}),q=0;q<516;q++)if(T[q]!==Z[q])return!0});u("sort",function(q){return void 0!==q&&P(q),j?I(this,q):w(m(this),(b=q,function(T,Z){return void 0!==b?+b(T,Z)||0:Z!=Z?-1:T!=T?1:0===T&&0===Z?1/T>0&&1/Z<0?1:-1:T>Z}));var b},!j||c)},5021:(V,J,e)=>{"use strict";var i=e(260),d=e(7466),h=e(1400),P=e(6304),w=i.aTypedArray;(0,i.exportTypedArrayMethod)("subarray",function(M,C){var S=w(this),n=S.length,y=h(M,n);return new(P(S))(S.buffer,S.byteOffset+y*S.BYTES_PER_ELEMENT,d((void 0===C?n:h(C,n))-y))})},2974:(V,J,e)=>{"use strict";var i=e(7854),d=e(2104),h=e(260),P=e(7293),w=e(206),M=i.Int8Array,C=h.aTypedArray,S=h.exportTypedArrayMethod,n=[].toLocaleString,y=!!M&&P(function(){n.call(new M(1))});S("toLocaleString",function(){return d(n,y?w(C(this)):C(this),w(arguments))},P(function(){return[1,2].toLocaleString()!=new M([1,2]).toLocaleString()})||!P(function(){M.prototype.toLocaleString.call([1,2])}))},5016:(V,J,e)=>{"use strict";var i=e(260).exportTypedArrayMethod,d=e(7293),h=e(7854),P=e(1702),w=h.Uint8Array,M=w&&w.prototype||{},C=[].toString,S=P([].join);d(function(){C.call({})})&&(C=function(){return S(this)}),i("toString",C,M.toString!=C)},2472:(V,J,e)=>{e(9843)("Uint8",function(i){return function(d,h,P){return i(this,d,h,P)}})},9743:(V,J,e)=>{e(9843)("Uint8",function(i){return function(d,h,P){return i(this,d,h,P)}},!0)},4129:(V,J,e)=>{"use strict";var i,d=e(7854),h=e(1702),P=e(2248),w=e(2423),M=e(7710),C=e(9320),S=e(111),n=e(9909).enforce,y=e(8536),R=!d.ActiveXObject&&"ActiveXObject"in d,m=Object.isExtensible,u=function(T){return function(){return T(this,arguments.length?arguments[0]:void 0)}},f=M("WeakMap",u,C);if(y&&R){i=C.getConstructor(u,"WeakMap",!0),w.enable();var I=f.prototype,c=h(I.delete),j=h(I.has),q=h(I.get),b=h(I.set);P(I,{delete:function(T){if(S(T)&&!m(T)){var Z=n(this);return Z.frozen||(Z.frozen=new i),c(this,T)||Z.frozen.delete(T)}return c(this,T)},has:function(T){if(S(T)&&!m(T)){var Z=n(this);return Z.frozen||(Z.frozen=new i),j(this,T)||Z.frozen.has(T)}return j(this,T)},get:function(T){if(S(T)&&!m(T)){var Z=n(this);return Z.frozen||(Z.frozen=new i),j(this,T)?q(this,T):Z.frozen.get(T)}return q(this,T)},set:function(T,Z){if(S(T)&&!m(T)){var le=n(this);le.frozen||(le.frozen=new i),j(this,T)?b(this,T,Z):le.frozen.set(T,Z)}else b(this,T,Z);return this}})}},4747:(V,J,e)=>{var i=e(7854),d=e(8324),h=e(8509),P=e(8533),w=e(8880),M=function(S){if(S&&S.forEach!==P)try{w(S,"forEach",P)}catch(n){S.forEach=P}};for(var C in d)d[C]&&M(i[C]&&i[C].prototype);M(h)},3948:(V,J,e)=>{var i=e(7854),d=e(8324),h=e(8509),P=e(6992),w=e(8880),M=e(5112),C=M("iterator"),S=M("toStringTag"),n=P.values,y=function(m,u){if(m){if(m[C]!==n)try{w(m,C,n)}catch(I){m[C]=n}if(m[S]||w(m,S,u),d[u])for(var f in P)if(m[f]!==P[f])try{w(m,f,P[f])}catch(I){m[f]=P[f]}}};for(var R in d)y(i[R]&&i[R].prototype,R);y(h,"DOMTokenList")},2564:(V,J,e)=>{var i=e(2109),d=e(7854),h=e(2104),P=e(614),w=e(8113),M=e(206),C=/MSIE .\./.test(w),S=d.Function,n=function(y){return function(R,m){var u=arguments.length>2,f=u?M(arguments,2):void 0;return y(u?function(){h(P(R)?R:S(R),this,f)}:R,m)}};i({global:!0,bind:!0,forced:C},{setTimeout:n(d.setTimeout),setInterval:n(d.setInterval)})},1637:(V,J,e)=>{"use strict";e(6992);var i=e(2109),d=e(7854),h=e(5005),P=e(6916),w=e(1702),M=e(590),C=e(1320),S=e(2248),n=e(8003),y=e(4994),R=e(9909),m=e(5787),u=e(614),f=e(2597),I=e(9974),c=e(648),j=e(9670),q=e(111),b=e(1340),T=e(30),Z=e(9114),le=e(8554),x=e(1246),Se=e(5112),Ee=e(4362),he=Se("iterator"),ue="URLSearchParams",ke="URLSearchParamsIterator",Ne=R.set,ze=R.getterFor(ue),Ve=R.getterFor(ke),et=h("fetch"),_e=h("Request"),gt=h("Headers"),mt=_e&&_e.prototype,ot=gt&&gt.prototype,at=d.RegExp,yt=d.TypeError,Et=d.decodeURIComponent,ie=d.encodeURIComponent,dt=w("".charAt),Mt=w([].join),Rt=w([].push),je=w("".replace),xt=w([].shift),Wt=w([].splice),Gt=w("".split),kt=w("".slice),Xe=/\+/g,zt=Array(4),G=function(ee){return zt[ee-1]||(zt[ee-1]=at("((?:%[\\da-f]{2}){"+ee+"})","gi"))},A=function(ee){try{return Et(ee)}catch(ce){return ee}},t=function(ee){var ce=je(ee,Xe," "),me=4;try{return Et(ce)}catch(Te){for(;me;)ce=je(ce,G(me--),A);return ce}},l=/[!'()~]|%20/g,s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},v=function(ee){return s[ee]},r=function(ee){return je(ie(ee),l,v)},g=function(ee,ce){if(ce)for(var me,Te,ge=Gt(ce,"&"),Ie=0;Ie<ge.length;)(me=ge[Ie++]).length&&(Te=Gt(me,"="),Rt(ee,{key:t(xt(Te)),value:t(Mt(Te,"="))}))},E=function(ee){this.entries.length=0,g(this.entries,ee)},te=function(ee,ce){if(ee<ce)throw yt("Not enough arguments")},ae=y(function(ee,ce){Ne(this,{type:ke,iterator:le(ze(ee).entries),kind:ce})},"Iterator",function(){var ee=Ve(this),ce=ee.kind,me=ee.iterator.next(),Te=me.value;return me.done||(me.value="keys"===ce?Te.key:"values"===ce?Te.value:[Te.key,Te.value]),me}),Re=function(){m(this,Ce);var ee,ce,me,Te,ge,Ie,we,Pe,We,Je=arguments.length>0?arguments[0]:void 0,tt=this,Ft=[];if(Ne(tt,{type:ue,entries:Ft,updateURL:function(){},updateSearchParams:E}),void 0!==Je)if(q(Je))if(ee=x(Je))for(me=(ce=le(Je,ee)).next;!(Te=P(me,ce)).done;){if(Ie=(ge=le(j(Te.value))).next,(we=P(Ie,ge)).done||(Pe=P(Ie,ge)).done||!P(Ie,ge).done)throw yt("Expected sequence with length 2");Rt(Ft,{key:b(we.value),value:b(Pe.value)})}else for(We in Je)f(Je,We)&&Rt(Ft,{key:We,value:b(Je[We])});else g(Ft,"string"==typeof Je?"?"===dt(Je,0)?kt(Je,1):Je:b(Je))},Ce=Re.prototype;if(S(Ce,{append:function(ee,ce){te(arguments.length,2);var me=ze(this);Rt(me.entries,{key:b(ee),value:b(ce)}),me.updateURL()},delete:function(ee){te(arguments.length,1);for(var ce=ze(this),me=ce.entries,Te=b(ee),ge=0;ge<me.length;)me[ge].key===Te?Wt(me,ge,1):ge++;ce.updateURL()},get:function(ee){te(arguments.length,1);for(var ce=ze(this).entries,me=b(ee),Te=0;Te<ce.length;Te++)if(ce[Te].key===me)return ce[Te].value;return null},getAll:function(ee){te(arguments.length,1);for(var ce=ze(this).entries,me=b(ee),Te=[],ge=0;ge<ce.length;ge++)ce[ge].key===me&&Rt(Te,ce[ge].value);return Te},has:function(ee){te(arguments.length,1);for(var ce=ze(this).entries,me=b(ee),Te=0;Te<ce.length;)if(ce[Te++].key===me)return!0;return!1},set:function(ee,ce){te(arguments.length,1);for(var me,Te=ze(this),ge=Te.entries,Ie=!1,we=b(ee),Pe=b(ce),We=0;We<ge.length;We++)(me=ge[We]).key===we&&(Ie?Wt(ge,We--,1):(Ie=!0,me.value=Pe));Ie||Rt(ge,{key:we,value:Pe}),Te.updateURL()},sort:function(){var ee=ze(this);Ee(ee.entries,function(ce,me){return ce.key>me.key?1:-1}),ee.updateURL()},forEach:function(ee){for(var ce,me=ze(this).entries,Te=I(ee,arguments.length>1?arguments[1]:void 0),ge=0;ge<me.length;)Te((ce=me[ge++]).value,ce.key,this)},keys:function(){return new ae(this,"keys")},values:function(){return new ae(this,"values")},entries:function(){return new ae(this,"entries")}},{enumerable:!0}),C(Ce,he,Ce.entries,{name:"entries"}),C(Ce,"toString",function(){for(var ee,ce=ze(this).entries,me=[],Te=0;Te<ce.length;)ee=ce[Te++],Rt(me,r(ee.key)+"="+r(ee.value));return Mt(me,"&")},{enumerable:!0}),n(Re,ue),i({global:!0,forced:!M},{URLSearchParams:Re}),!M&&u(gt)){var re=w(ot.has),K=w(ot.set),L=function(ee){if(q(ee)){var ce,me=ee.body;if(c(me)===ue)return ce=ee.headers?new gt(ee.headers):new gt,re(ce,"content-type")||K(ce,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),T(ee,{body:Z(0,b(me)),headers:Z(0,ce)})}return ee};if(u(et)&&i({global:!0,enumerable:!0,forced:!0},{fetch:function(ee){return et(ee,arguments.length>1?L(arguments[1]):{})}}),u(_e)){var ne=function(ee){return m(this,mt),new _e(ee,arguments.length>1?L(arguments[1]):{})};mt.constructor=ne,ne.prototype=mt,i({global:!0,forced:!0},{Request:ne})}}V.exports={URLSearchParams:Re,getState:ze}},285:(V,J,e)=>{"use strict";e(8783);var i,d=e(2109),h=e(9781),P=e(590),w=e(7854),M=e(9974),C=e(6916),S=e(1702),n=e(6048),y=e(1320),R=e(5787),m=e(2597),u=e(1574),f=e(8457),I=e(206),c=e(8710).codeAt,j=e(3197),q=e(1340),b=e(8003),T=e(1637),Z=e(9909),le=Z.set,x=Z.getterFor("URL"),Se=T.URLSearchParams,Ee=T.getState,he=w.URL,ue=w.TypeError,ke=w.parseInt,Ne=Math.floor,ze=Math.pow,Ve=S("".charAt),et=S(/./.exec),_e=S([].join),gt=S(1..toString),mt=S([].pop),ot=S([].push),at=S("".replace),yt=S([].shift),Et=S("".split),ie=S("".slice),dt=S("".toLowerCase),Mt=S([].unshift),Rt="Invalid scheme",je="Invalid host",xt="Invalid port",Wt=/[a-z]/i,Gt=/[\d+-.a-z]/i,kt=/\d/,Xe=/^0x/i,zt=/^[0-7]+$/,G=/^\d+$/,A=/^[\da-f]+$/i,t=/[\0\t\n\r #%/:<>?@[\\\]^|]/,l=/[\0\t\n\r #/:<>?@[\\\]^|]/,s=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,v=/[\t\n\r]/g,r=function(Oe,ct){var It,rt,Bt;if("["==Ve(ct,0)){if("]"!=Ve(ct,ct.length-1)||!(It=E(ie(ct,1,-1))))return je;Oe.host=It}else if(ne(Oe)){if(ct=j(ct),et(t,ct)||null===(It=g(ct)))return je;Oe.host=It}else{if(et(l,ct))return je;for(It="",rt=f(ct),Bt=0;Bt<rt.length;Bt++)It+=K(rt[Bt],ae);Oe.host=It}},g=function(Oe){var ct,It,rt,Bt,lt,vi,pi,ri=Et(Oe,".");if(ri.length&&""==ri[ri.length-1]&&ri.length--,(ct=ri.length)>4)return Oe;for(It=[],rt=0;rt<ct;rt++){if(""==(Bt=ri[rt]))return Oe;if(lt=10,Bt.length>1&&"0"==Ve(Bt,0)&&(lt=et(Xe,Bt)?16:8,Bt=ie(Bt,8==lt?1:2)),""===Bt)vi=0;else{if(!et(10==lt?G:8==lt?zt:A,Bt))return Oe;vi=ke(Bt,lt)}ot(It,vi)}for(rt=0;rt<ct;rt++)if(vi=It[rt],rt==ct-1){if(vi>=ze(256,5-ct))return null}else if(vi>255)return null;for(pi=mt(It),rt=0;rt<It.length;rt++)pi+=It[rt]*ze(256,3-rt);return pi},E=function(Oe){var ct,It,rt,Bt,lt,vi,pi,ri=[0,0,0,0,0,0,0,0],wt=0,jt=null,Vt=0,fi=function(){return Ve(Oe,Vt)};if(":"==fi()){if(":"!=Ve(Oe,1))return;Vt+=2,jt=++wt}for(;fi();){if(8==wt)return;if(":"!=fi()){for(ct=It=0;It<4&&et(A,fi());)ct=16*ct+ke(fi(),16),Vt++,It++;if("."==fi()){if(0==It||(Vt-=It,wt>6))return;for(rt=0;fi();){if(Bt=null,rt>0){if(!("."==fi()&&rt<4))return;Vt++}if(!et(kt,fi()))return;for(;et(kt,fi());){if(lt=ke(fi(),10),null===Bt)Bt=lt;else{if(0==Bt)return;Bt=10*Bt+lt}if(Bt>255)return;Vt++}ri[wt]=256*ri[wt]+Bt,2!=++rt&&4!=rt||wt++}if(4!=rt)return;break}if(":"==fi()){if(Vt++,!fi())return}else if(fi())return;ri[wt++]=ct}else{if(null!==jt)return;Vt++,jt=++wt}}if(null!==jt)for(vi=wt-jt,wt=7;0!=wt&&vi>0;)pi=ri[wt],ri[wt--]=ri[jt+vi-1],ri[jt+--vi]=pi;else if(8!=wt)return;return ri},te=function(Oe){var ct,It,rt,Bt;if("number"==typeof Oe){for(ct=[],It=0;It<4;It++)Mt(ct,Oe%256),Oe=Ne(Oe/256);return _e(ct,".")}if("object"==typeof Oe){for(ct="",rt=function(lt){for(var vi=null,pi=1,ri=null,wt=0,jt=0;jt<8;jt++)0!==lt[jt]?(wt>pi&&(vi=ri,pi=wt),ri=null,wt=0):(null===ri&&(ri=jt),++wt);return wt>pi&&(vi=ri,pi=wt),vi}(Oe),It=0;It<8;It++)Bt&&0===Oe[It]||(Bt&&(Bt=!1),rt===It?(ct+=It?":":"::",Bt=!0):(ct+=gt(Oe[It],16),It<7&&(ct+=":")));return"["+ct+"]"}return Oe},ae={},Re=u({},ae,{" ":1,'"':1,"<":1,">":1,"`":1}),Ce=u({},Re,{"#":1,"?":1,"{":1,"}":1}),re=u({},Ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),K=function(Oe,ct){var It=c(Oe,0);return It>32&&It<127&&!m(ct,Oe)?Oe:encodeURIComponent(Oe)},L={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ne=function(Oe){return m(L,Oe.scheme)},ee=function(Oe){return""!=Oe.username||""!=Oe.password},ce=function(Oe){return!Oe.host||Oe.cannotBeABaseURL||"file"==Oe.scheme},me=function(Oe,ct){var It;return 2==Oe.length&&et(Wt,Ve(Oe,0))&&(":"==(It=Ve(Oe,1))||!ct&&"|"==It)},Te=function(Oe){var ct;return Oe.length>1&&me(ie(Oe,0,2))&&(2==Oe.length||"/"===(ct=Ve(Oe,2))||"\\"===ct||"?"===ct||"#"===ct)},ge=function(Oe){var ct=Oe.path,It=ct.length;!It||"file"==Oe.scheme&&1==It&&me(ct[0],!0)||ct.length--},Ie=function(Oe){return"."===Oe||"%2e"===dt(Oe)},we={},Pe={},We={},Je={},tt={},Ft={},si={},Pi={},yi={},Ti={},_i={},Zi={},ki={},$t={},ni={},ai={},Ci={},Ii={},wi={},Ei={},Ai={},Vi=function(Oe,ct,It,rt){var Bt,lt,vi,pi,ri,wt=It||we,jt=0,Vt="",fi=!1,qn=!1,ia=!1;for(It||(Oe.scheme="",Oe.username="",Oe.password="",Oe.host=null,Oe.port=null,Oe.path=[],Oe.query=null,Oe.fragment=null,Oe.cannotBeABaseURL=!1,ct=at(ct,s,"")),ct=at(ct,v,""),Bt=f(ct);jt<=Bt.length;){switch(lt=Bt[jt],wt){case we:if(!lt||!et(Wt,lt)){if(It)return Rt;wt=We;continue}Vt+=dt(lt),wt=Pe;break;case Pe:if(lt&&(et(Gt,lt)||"+"==lt||"-"==lt||"."==lt))Vt+=dt(lt);else{if(":"!=lt){if(It)return Rt;Vt="",wt=We,jt=0;continue}if(It&&(ne(Oe)!=m(L,Vt)||"file"==Vt&&(ee(Oe)||null!==Oe.port)||"file"==Oe.scheme&&!Oe.host))return;if(Oe.scheme=Vt,It)return void(ne(Oe)&&L[Oe.scheme]==Oe.port&&(Oe.port=null));Vt="","file"==Oe.scheme?wt=$t:ne(Oe)&&rt&&rt.scheme==Oe.scheme?wt=Je:ne(Oe)?wt=Pi:"/"==Bt[jt+1]?(wt=tt,jt++):(Oe.cannotBeABaseURL=!0,ot(Oe.path,""),wt=wi)}break;case We:if(!rt||rt.cannotBeABaseURL&&"#"!=lt)return Rt;if(rt.cannotBeABaseURL&&"#"==lt){Oe.scheme=rt.scheme,Oe.path=I(rt.path),Oe.query=rt.query,Oe.fragment="",Oe.cannotBeABaseURL=!0,wt=Ai;break}wt="file"==rt.scheme?$t:Ft;continue;case Je:if("/"!=lt||"/"!=Bt[jt+1]){wt=Ft;continue}wt=yi,jt++;break;case tt:if("/"==lt){wt=Ti;break}wt=Ii;continue;case Ft:if(Oe.scheme=rt.scheme,lt==i)Oe.username=rt.username,Oe.password=rt.password,Oe.host=rt.host,Oe.port=rt.port,Oe.path=I(rt.path),Oe.query=rt.query;else if("/"==lt||"\\"==lt&&ne(Oe))wt=si;else if("?"==lt)Oe.username=rt.username,Oe.password=rt.password,Oe.host=rt.host,Oe.port=rt.port,Oe.path=I(rt.path),Oe.query="",wt=Ei;else{if("#"!=lt){Oe.username=rt.username,Oe.password=rt.password,Oe.host=rt.host,Oe.port=rt.port,Oe.path=I(rt.path),Oe.path.length--,wt=Ii;continue}Oe.username=rt.username,Oe.password=rt.password,Oe.host=rt.host,Oe.port=rt.port,Oe.path=I(rt.path),Oe.query=rt.query,Oe.fragment="",wt=Ai}break;case si:if(!ne(Oe)||"/"!=lt&&"\\"!=lt){if("/"!=lt){Oe.username=rt.username,Oe.password=rt.password,Oe.host=rt.host,Oe.port=rt.port,wt=Ii;continue}wt=Ti}else wt=yi;break;case Pi:if(wt=yi,"/"!=lt||"/"!=Ve(Vt,jt+1))continue;jt++;break;case yi:if("/"!=lt&&"\\"!=lt){wt=Ti;continue}break;case Ti:if("@"==lt){fi&&(Vt="%40"+Vt),fi=!0,vi=f(Vt);for(var na=0;na<vi.length;na++){var ca=vi[na];if(":"!=ca||ia){var Pn=K(ca,re);ia?Oe.password+=Pn:Oe.username+=Pn}else ia=!0}Vt=""}else if(lt==i||"/"==lt||"?"==lt||"#"==lt||"\\"==lt&&ne(Oe)){if(fi&&""==Vt)return"Invalid authority";jt-=f(Vt).length+1,Vt="",wt=_i}else Vt+=lt;break;case _i:case Zi:if(It&&"file"==Oe.scheme){wt=ai;continue}if(":"!=lt||qn){if(lt==i||"/"==lt||"?"==lt||"#"==lt||"\\"==lt&&ne(Oe)){if(ne(Oe)&&""==Vt)return je;if(It&&""==Vt&&(ee(Oe)||null!==Oe.port))return;if(pi=r(Oe,Vt))return pi;if(Vt="",wt=Ci,It)return;continue}"["==lt?qn=!0:"]"==lt&&(qn=!1),Vt+=lt}else{if(""==Vt)return je;if(pi=r(Oe,Vt))return pi;if(Vt="",wt=ki,It==Zi)return}break;case ki:if(!et(kt,lt)){if(lt==i||"/"==lt||"?"==lt||"#"==lt||"\\"==lt&&ne(Oe)||It){if(""!=Vt){var Hn=ke(Vt,10);if(Hn>65535)return xt;Oe.port=ne(Oe)&&Hn===L[Oe.scheme]?null:Hn,Vt=""}if(It)return;wt=Ci;continue}return xt}Vt+=lt;break;case $t:if(Oe.scheme="file","/"==lt||"\\"==lt)wt=ni;else{if(!rt||"file"!=rt.scheme){wt=Ii;continue}if(lt==i)Oe.host=rt.host,Oe.path=I(rt.path),Oe.query=rt.query;else if("?"==lt)Oe.host=rt.host,Oe.path=I(rt.path),Oe.query="",wt=Ei;else{if("#"!=lt){Te(_e(I(Bt,jt),""))||(Oe.host=rt.host,Oe.path=I(rt.path),ge(Oe)),wt=Ii;continue}Oe.host=rt.host,Oe.path=I(rt.path),Oe.query=rt.query,Oe.fragment="",wt=Ai}}break;case ni:if("/"==lt||"\\"==lt){wt=ai;break}rt&&"file"==rt.scheme&&!Te(_e(I(Bt,jt),""))&&(me(rt.path[0],!0)?ot(Oe.path,rt.path[0]):Oe.host=rt.host),wt=Ii;continue;case ai:if(lt==i||"/"==lt||"\\"==lt||"?"==lt||"#"==lt){if(!It&&me(Vt))wt=Ii;else if(""==Vt){if(Oe.host="",It)return;wt=Ci}else{if(pi=r(Oe,Vt))return pi;if("localhost"==Oe.host&&(Oe.host=""),It)return;Vt="",wt=Ci}continue}Vt+=lt;break;case Ci:if(ne(Oe)){if(wt=Ii,"/"!=lt&&"\\"!=lt)continue}else if(It||"?"!=lt)if(It||"#"!=lt){if(lt!=i&&(wt=Ii,"/"!=lt))continue}else Oe.fragment="",wt=Ai;else Oe.query="",wt=Ei;break;case Ii:if(lt==i||"/"==lt||"\\"==lt&&ne(Oe)||!It&&("?"==lt||"#"==lt)){if(".."===(ri=dt(ri=Vt))||"%2e."===ri||".%2e"===ri||"%2e%2e"===ri?(ge(Oe),"/"==lt||"\\"==lt&&ne(Oe)||ot(Oe.path,"")):Ie(Vt)?"/"==lt||"\\"==lt&&ne(Oe)||ot(Oe.path,""):("file"==Oe.scheme&&!Oe.path.length&&me(Vt)&&(Oe.host&&(Oe.host=""),Vt=Ve(Vt,0)+":"),ot(Oe.path,Vt)),Vt="","file"==Oe.scheme&&(lt==i||"?"==lt||"#"==lt))for(;Oe.path.length>1&&""===Oe.path[0];)yt(Oe.path);"?"==lt?(Oe.query="",wt=Ei):"#"==lt&&(Oe.fragment="",wt=Ai)}else Vt+=K(lt,Ce);break;case wi:"?"==lt?(Oe.query="",wt=Ei):"#"==lt?(Oe.fragment="",wt=Ai):lt!=i&&(Oe.path[0]+=K(lt,ae));break;case Ei:It||"#"!=lt?lt!=i&&("'"==lt&&ne(Oe)?Oe.query+="%27":Oe.query+="#"==lt?"%23":K(lt,ae)):(Oe.fragment="",wt=Ai);break;case Ai:lt!=i&&(Oe.fragment+=K(lt,Re))}jt++}},cn=function(Oe){var ct,It,rt=R(this,Hi),Bt=arguments.length>1?arguments[1]:void 0,lt=q(Oe),vi=le(rt,{type:"URL"});if(void 0!==Bt)try{ct=x(Bt)}catch(wt){if(It=Vi(ct={},q(Bt)))throw ue(It)}if(It=Vi(vi,lt,null,ct))throw ue(It);var pi=vi.searchParams=new Se,ri=Ee(pi);ri.updateSearchParams(vi.query),ri.updateURL=function(){vi.query=q(pi)||null},h||(rt.href=C(Ji,rt),rt.origin=C(un,rt),rt.protocol=C(hn,rt),rt.username=C(Di,rt),rt.password=C(en,rt),rt.host=C(In,rt),rt.hostname=C(Yi,rt),rt.port=C(xn,rt),rt.pathname=C(Nn,rt),rt.search=C(Ki,rt),rt.searchParams=C(Xn,rt),rt.hash=C(Rn,rt))},Hi=cn.prototype,Ji=function(){var Oe=x(this),ct=Oe.scheme,It=Oe.username,rt=Oe.password,Bt=Oe.host,lt=Oe.port,vi=Oe.path,pi=Oe.query,ri=Oe.fragment,wt=ct+":";return null!==Bt?(wt+="//",ee(Oe)&&(wt+=It+(rt?":"+rt:"")+"@"),wt+=te(Bt),null!==lt&&(wt+=":"+lt)):"file"==ct&&(wt+="//"),wt+=Oe.cannotBeABaseURL?vi[0]:vi.length?"/"+_e(vi,"/"):"",null!==pi&&(wt+="?"+pi),null!==ri&&(wt+="#"+ri),wt},un=function(){var Oe=x(this),ct=Oe.scheme,It=Oe.port;if("blob"==ct)try{return new cn(ct.path[0]).origin}catch(rt){return"null"}return"file"!=ct&&ne(Oe)?ct+"://"+te(Oe.host)+(null!==It?":"+It:""):"null"},hn=function(){return x(this).scheme+":"},Di=function(){return x(this).username},en=function(){return x(this).password},In=function(){var Oe=x(this),ct=Oe.host,It=Oe.port;return null===ct?"":null===It?te(ct):te(ct)+":"+It},Yi=function(){var Oe=x(this).host;return null===Oe?"":te(Oe)},xn=function(){var Oe=x(this).port;return null===Oe?"":q(Oe)},Nn=function(){var Oe=x(this),ct=Oe.path;return Oe.cannotBeABaseURL?ct[0]:ct.length?"/"+_e(ct,"/"):""},Ki=function(){var Oe=x(this).query;return Oe?"?"+Oe:""},Xn=function(){return x(this).searchParams},Rn=function(){var Oe=x(this).fragment;return Oe?"#"+Oe:""},Fi=function(Oe,ct){return{get:Oe,set:ct,configurable:!0,enumerable:!0}};if(h&&n(Hi,{href:Fi(Ji,function(Oe){var ct=x(this),It=q(Oe),rt=Vi(ct,It);if(rt)throw ue(rt);Ee(ct.searchParams).updateSearchParams(ct.query)}),origin:Fi(un),protocol:Fi(hn,function(Oe){var ct=x(this);Vi(ct,q(Oe)+":",we)}),username:Fi(Di,function(Oe){var ct=x(this),It=f(q(Oe));if(!ce(ct)){ct.username="";for(var rt=0;rt<It.length;rt++)ct.username+=K(It[rt],re)}}),password:Fi(en,function(Oe){var ct=x(this),It=f(q(Oe));if(!ce(ct)){ct.password="";for(var rt=0;rt<It.length;rt++)ct.password+=K(It[rt],re)}}),host:Fi(In,function(Oe){var ct=x(this);ct.cannotBeABaseURL||Vi(ct,q(Oe),_i)}),hostname:Fi(Yi,function(Oe){var ct=x(this);ct.cannotBeABaseURL||Vi(ct,q(Oe),Zi)}),port:Fi(xn,function(Oe){var ct=x(this);ce(ct)||(""==(Oe=q(Oe))?ct.port=null:Vi(ct,Oe,ki))}),pathname:Fi(Nn,function(Oe){var ct=x(this);ct.cannotBeABaseURL||(ct.path=[],Vi(ct,q(Oe),Ci))}),search:Fi(Ki,function(Oe){var ct=x(this);""==(Oe=q(Oe))?ct.query=null:("?"==Ve(Oe,0)&&(Oe=ie(Oe,1)),ct.query="",Vi(ct,Oe,Ei)),Ee(ct.searchParams).updateSearchParams(ct.query)}),searchParams:Fi(Xn),hash:Fi(Rn,function(Oe){var ct=x(this);""!=(Oe=q(Oe))?("#"==Ve(Oe,0)&&(Oe=ie(Oe,1)),ct.fragment="",Vi(ct,Oe,Ai)):ct.fragment=null})}),y(Hi,"toJSON",function(){return C(Ji,this)},{enumerable:!0}),y(Hi,"toString",function(){return C(Ji,this)},{enumerable:!0}),he){var ta=he.createObjectURL,tn=he.revokeObjectURL;ta&&y(cn,"createObjectURL",M(ta,he)),tn&&y(cn,"revokeObjectURL",M(tn,he))}b(cn,"URL"),d({global:!0,forced:!P,sham:!h},{URL:cn})},3753:(V,J,e)=>{"use strict";var i=e(2109),d=e(6916);i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return d(URL.prototype.toString,this)}})},7987:function(V,J,e){var i,d;i=function(h){"use strict";var P,w,M={template:"[%t] %l:",levelFormatter:function(n){return n.toUpperCase()},nameFormatter:function(n){return n||"root"},timestampFormatter:function(n){return n.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},C={},S={reg:function(n){if(!n||!n.getLogger)throw new TypeError("Argument is not a root logger");P=n},apply:function(n,y){if(!n||!n.setLevel)throw new TypeError("Argument is not a logger");var R=n.methodFactory,m=n.name||"",u=C[m]||C[""]||M;return C[m]||(n.methodFactory=function(f,I,c){var j=R(f,I,c),q=C[c]||C[""],b=-1!==q.template.indexOf("%t"),T=-1!==q.template.indexOf("%l"),Z=-1!==q.template.indexOf("%n");return function(){for(var le="",x=arguments.length,Se=Array(x),Ee=0;Ee<x;Ee++)Se[Ee]=arguments[Ee];if(m||!C[c]){var he=q.timestampFormatter(new Date),ue=q.levelFormatter(f),ke=q.nameFormatter(c);q.format?le+=q.format(ue,ke,he):(le+=q.template,b&&(le=le.replace(/%t/,he)),T&&(le=le.replace(/%l/,ue)),Z&&(le=le.replace(/%n/,ke))),Se.length&&"string"==typeof Se[0]?Se[0]=le+" "+Se[0]:Se.unshift(le)}j.apply(void 0,Se)}}),(y=y||{}).template&&(y.format=void 0),C[m]=function(f){for(var I,c=1,j=arguments.length;c<j;c++)for(I in arguments[c])Object.prototype.hasOwnProperty.call(arguments[c],I)&&(f[I]=arguments[c][I]);return f}({},u,y),n.setLevel(n.getLevel()),P||n.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),n}};return h&&(w=h.prefix,S.noConflict=function(){return h.prefix===S&&(h.prefix=w),S}),S},void 0===(d=i.call(J,e,J,V))||(V.exports=d)},2043:function(V,J,e){var i,d;!function(h,P){"use strict";i=function(){var w=function(){},M="undefined",C=typeof window!==M&&typeof window.navigator!==M&&/Trident\/|MSIE /.test(window.navigator.userAgent),S=["trace","debug","info","warn","error"];function n(b,T){var Z=b[T];if("function"==typeof Z.bind)return Z.bind(b);try{return Function.prototype.bind.call(Z,b)}catch(le){return function(){return Function.prototype.apply.apply(Z,[b,arguments])}}}function y(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function R(b){return"debug"===b&&(b="log"),typeof console!==M&&("trace"===b&&C?y:void 0!==console[b]?n(console,b):void 0!==console.log?n(console,"log"):w)}function m(b,T){for(var Z=0;Z<S.length;Z++){var le=S[Z];this[le]=Z<b?w:this.methodFactory(le,b,T)}this.log=this.debug}function u(b,T,Z){return function(){typeof console!==M&&(m.call(this,T,Z),this[b].apply(this,arguments))}}function f(b,T,Z){return R(b)||u.apply(this,arguments)}function I(b,T,Z){var le,x=this;T=null==T?"WARN":T;var Se="loglevel";function Ee(){var ue;if(typeof window!==M&&Se){try{ue=window.localStorage[Se]}catch(ze){}if(typeof ue===M)try{var ke=window.document.cookie,Ne=ke.indexOf(encodeURIComponent(Se)+"=");-1!==Ne&&(ue=/^([^;]+)/.exec(ke.slice(Ne))[1])}catch(ze){}return void 0===x.levels[ue]&&(ue=void 0),ue}}"string"==typeof b?Se+=":"+b:"symbol"==typeof b&&(Se=void 0),x.name=b,x.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},x.methodFactory=Z||f,x.getLevel=function(){return le},x.setLevel=function(ue,ke){if("string"==typeof ue&&void 0!==x.levels[ue.toUpperCase()]&&(ue=x.levels[ue.toUpperCase()]),!("number"==typeof ue&&ue>=0&&ue<=x.levels.SILENT))throw"log.setLevel() called with invalid level: "+ue;if(le=ue,!1!==ke&&function(Ne){var ze=(S[Ne]||"silent").toUpperCase();if(typeof window!==M&&Se){try{return void(window.localStorage[Se]=ze)}catch(Ve){}try{window.document.cookie=encodeURIComponent(Se)+"="+ze+";"}catch(Ve){}}}(ue),m.call(x,ue,b),typeof console===M&&ue<x.levels.SILENT)return"No console available for logging"},x.setDefaultLevel=function(ue){T=ue,Ee()||x.setLevel(ue,!1)},x.resetLevel=function(){x.setLevel(T,!1),function(){if(typeof window!==M&&Se){try{return void window.localStorage.removeItem(Se)}catch(ue){}try{window.document.cookie=encodeURIComponent(Se)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(ue){}}}()},x.enableAll=function(ue){x.setLevel(x.levels.TRACE,ue)},x.disableAll=function(ue){x.setLevel(x.levels.SILENT,ue)};var he=Ee();null==he&&(he=T),x.setLevel(he,!1)}var c=new I,j={};c.getLogger=function(b){if("symbol"!=typeof b&&"string"!=typeof b||""===b)throw new TypeError("You must supply a name when creating a logger.");var T=j[b];return T||(T=j[b]=new I(b,c.getLevel(),c.methodFactory)),T};var q=typeof window!==M?window.log:void 0;return c.noConflict=function(){return typeof window!==M&&window.log===c&&(window.log=q),c},c.getLoggers=function(){return j},c.default=c,c},void 0===(d=i.call(J,e,J,V))||(V.exports=d)}()}},Lt={};function Ze(V){var J=Lt[V];if(void 0!==J)return J.exports;var e=Lt[V]={id:V,loaded:!1,exports:{}};return nt[V].call(e.exports,e,e.exports,Ze),e.loaded=!0,e.exports}return Ze.amdO={},Ze.n=V=>{var J=V&&V.__esModule?()=>V.default:()=>V;return Ze.d(J,{a:J}),J},Ze.d=(V,J)=>{for(var e in J)Ze.o(J,e)&&!Ze.o(V,e)&&Object.defineProperty(V,e,{enumerable:!0,get:J[e]})},Ze.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(V){if("object"==typeof window)return window}}(),Ze.hmd=V=>((V=Object.create(V)).children||(V.children=[]),Object.defineProperty(V,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+V.id)}}),V),Ze.o=(V,J)=>Object.prototype.hasOwnProperty.call(V,J),Ze.r=V=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})},Ze(8274)})()});
//# sourceMappingURL=scripts.2833af0969414b9d.js.map